if(b4w.module_check("game_example_main"))throw"Failed to register module: game_example_main";
b4w.register("game_example_main",function(A,f){function F(a,c){if(c){var k=x.get_std_assets_path()+"tutorials/making_a_game_p5-6/game_example.json";G.load(k,H)}else console.log("b4w init failure")}function H(){l=g.get_first_character();h=g.get_object_by_dupli_name("character","character_rig");r=100;var b=a.create_custom_sensor(0),c=a.create_custom_sensor(0),k=a.create_custom_sensor(0),e=a.create_custom_sensor(0),d=a.create_custom_sensor(0),t=a.create_elapsed_sensor();y()&&(I(b,k,c,e,d),document.getElementById("control_jump").style.visibility=
"visible");J(k,e);K(b,c,t);L(d);M(t);N(t);b=g.get_active_camera();O.append_semi_soft_cam(b,l,P,.2)}function J(b,c){function k(a,b,e){if(1==e)switch(b){case "FORWARD":var c=1;d.apply(h,"character_run");break;case "BACKWARD":c=-1,d.apply(h,"character_run")}else c=0,d.apply(h,"character_idle_01");w.set_character_move_dir(a,c,0);d.play(h);d.set_behavior(h,d.AB_CYCLIC)}var e=a.create_keyboard_sensor(a.KEY_W),f=a.create_keyboard_sensor(a.KEY_S),t=a.create_keyboard_sensor(a.KEY_UP),Q=a.create_keyboard_sensor(a.KEY_DOWN),
e=[e,t,b,f,Q,c];a.create_sensor_manifold(l,"FORWARD",a.CT_TRIGGER,e,function(a){return a[0]||a[1]||a[2]},k);a.create_sensor_manifold(l,"BACKWARD",a.CT_TRIGGER,e,function(a){return a[3]||a[4]||a[5]},k);d.apply(h,"character_idle_01");d.play(h);d.set_behavior(h,d.AB_CYCLIC)}function K(b,c,k){function e(b,e,c){var k=a.get_sensor_value(b,"LEFT",6);if(1==c)switch(e){case "LEFT":w.character_rotation_inc(b,1.5*k,0);break;case "RIGHT":w.character_rotation_inc(b,1.5*-k,0)}}var d=a.create_keyboard_sensor(a.KEY_A),
f=a.create_keyboard_sensor(a.KEY_D),h=a.create_keyboard_sensor(a.KEY_LEFT),g=a.create_keyboard_sensor(a.KEY_RIGHT);b=[d,h,c,f,g,b,k];a.create_sensor_manifold(l,"LEFT",a.CT_CONTINUOUS,b,function(a){return a[0]||a[1]||a[2]},e);a.create_sensor_manifold(l,"RIGHT",a.CT_CONTINUOUS,b,function(a){return a[3]||a[4]||a[5]},e)}function L(b){var c=a.create_keyboard_sensor(a.KEY_SPACE);a.create_sensor_manifold(l,"JUMP",a.CT_SHOT,[c,b],function(a){return a[0]||a[1]},function(a){w.character_jump(a)})}function I(b,
c,k,e,d){function f(m){m.preventDefault();m=m.changedTouches;for(var h=0;h<m.length;h++)m[h].identifier==l?(a.set_custom_sensor(c,0),a.set_custom_sensor(e,0),a.set_custom_sensor(k,0),a.set_custom_sensor(b,0),n.style.visibility="hidden",u.style.visibility="hidden",l=null):m[h].identifier==g&&(a.set_custom_sensor(d,0),g=null)}var h=new Float32Array(2),l,g,n=document.getElementById("control_tap"),u=document.getElementById("control_circle"),p=n.clientWidth/2,v=u.clientWidth/2;document.getElementById("canvas3d").addEventListener("touchstart",
function(a){a.preventDefault();var b=window.innerWidth;a=a.changedTouches;for(var e=0;e<a.length;e++){var c=a[e],d=c.clientX,k=c.clientY;if(d>b/2)break;h[0]=d;h[1]=k;l=c.identifier;n.style.visibility="visible";n.style.left=d-p+"px";n.style.top=k-p+"px";u.style.visibility="visible";u.style.left=d-v+"px";u.style.top=k-v+"px"}},!1);document.getElementById("control_jump").addEventListener("touchstart",function(b){b.preventDefault();b=b.changedTouches;for(var e=0;e<b.length;e++){var c=b[e];a.set_custom_sensor(d,
1);g=c.identifier}},!1);document.getElementById("canvas3d").addEventListener("touchmove",function(d){d.preventDefault();a.set_custom_sensor(c,0);a.set_custom_sensor(e,0);a.set_custom_sensor(k,0);a.set_custom_sensor(b,0);var f=window.innerWidth;d=d.changedTouches;for(var l=0;l<d.length;l++){var g=d[l],q=g.clientX,g=g.clientY;if(q>f/2)break;n.style.left=q-p+"px";n.style.top=g-p+"px";var q=q-h[0],g=g-h[1],t=Math.sqrt(q*q+g*g);if(16>t)break;q/=t;g=-g/t;q>Math.cos(3*Math.PI/8)?a.set_custom_sensor(b,1):
q<-Math.cos(3*Math.PI/8)&&a.set_custom_sensor(k,1);g>Math.sin(Math.PI/8)?a.set_custom_sensor(c,1):g<-Math.sin(Math.PI/8)&&a.set_custom_sensor(e,1)}},!1);document.getElementById("canvas3d").addEventListener("touchend",f,!1);document.getElementById("controls").addEventListener("touchend",f,!1)}function M(b){function c(b,e){var c=a.get_sensor_value(b,e,0),d=g.get_object_name(b);n[d]+=c;.5>=n[d]||(d=z,p.get_translation(b,d),d[2]-=2*c,p.set_translation_v(b,d))}function k(b,e,c,f){c=z;p.get_translation(l,
c);var k=a.get_sensor_value(b,e,0)?0:1;e=a.get_sensor_payload(b,e,k).coll_pos;c=R.distance(c,e);p.set_translation_v(f,e);d.set_frame(f,0);d.play(f);h(b);.75>c&&E(20);b=g.get_object_name(b);n[b]=0}function e(b,e,c,d){c=z;e=a.get_sensor_payload(b,e,0).hit_fract;var f=g.get_object_name(b);.5>=n[f]&&(p.get_translation(b,c),c[2]-=10*e-.01,p.set_translation_v(d,c));p.set_scale(d,1-e)}function h(a){var b=z;b[0]=8*Math.random()-4;b[1]=8*Math.random()-4;b[2]=4*Math.random()+2;p.set_translation_v(a,b)}for(var f=
["lava_rock","lava_rock.001"],r=["rock_01","rock_02","rock_03"],w=["burst_emitter_01","burst_emitter_02","burst_emitter_03"],x=["mark_01","mark_02","mark_03"],n={},u=0;u<f.length;u++)for(var B=f[u],v=0;v<r.length;v++){var m=r[v],C=w[v],D=x[v],m=g.get_object_by_dupli_name(B,m),C=g.get_object_by_dupli_name(B,C),D=g.get_object_by_dupli_name(B,D),y=a.create_collision_sensor(m,"LAVA",!0),q=a.create_collision_sensor(m,"ISLAND",!0),A=a.create_ray_sensor(m,[0,0,0],[0,0,-10],"ANY",!0);a.create_sensor_manifold(m,
"ROCK_FALL",a.CT_CONTINUOUS,[b],null,c);a.create_sensor_manifold(m,"ROCK_CRASH",a.CT_SHOT,[q,y],function(a){return a[0]||a[1]},k,C);a.create_sensor_manifold(m,"MARK_POS",a.CT_CONTINUOUS,[A],null,e,D);h(m);m=g.get_object_name(m);n[m]=0}}function N(b){var c=0,d=a.create_ray_sensor(l,[0,0,0],[0,0,-.3],"LAVA",!0);a.create_sensor_manifold(l,"LAVA_COLLISION",a.CT_CONTINUOUS,[d,b],function(a){return a[0]},function(b,d,f){1==f?(b=a.get_sensor_value(b,d,1),c+=b,.01<=c&&(E(.01>b?1:Math.floor(b/.01)),c=0)):
c=0})}function E(b){if(!(0>=r)){r-=b;b=document.getElementById("life_bar_green");var c=document.getElementById("life_bar_red"),f=document.getElementById("life_bar_mid"),e=Math.max(1.92*r,0),g=Math.min(1.92*(100-r),192);b.style.width=e+"px";c.style.width=g+"px";f.style.left=e+19+"px";0>=r&&(d.apply(h,"character_death"),d.play(h),d.set_behavior(h,d.AB_FINISH_STOP),w.set_character_move_dir(l,0,0),a.remove_sensor_manifold(l))}}function y(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||
navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}var d=f("animation"),S=f("app"),x=f("config");f("main");var G=f("data");f("container");var a=f("controls"),w=f("physics"),O=f("constraints");f("input");var g=f("scenes"),p=f("transform");f("print");var R=f("vec3"),P=new Float32Array([0,4,1.5]),l=null,h=null,r,z=new Float32Array(3);A.init=function(){var a=
y()?x.P_LOW:x.P_HIGH;S.init({canvas_container_id:"canvas3d",callback:F,physics_enabled:!0,quality:a,show_fps:!0,autoresize:!0,alpha:!1})}});b4w.require("game_example_main").init();
