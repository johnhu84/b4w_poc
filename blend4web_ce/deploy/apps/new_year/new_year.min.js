b4w.register("new_year_language",function(v,e){var w="en",C={default_text:{ru:"\u0423\u0432\u0430\u0436\u0430\u0435\u043c\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438!\n\u041d\u0430 \u044d\u0442\u043e\u0442 \u041d\u043e\u0432\u044b\u0439 \u0433\u043e\u0434 \u043c\u044b \u043f\u0440\u0438\u0433\u043e\u0442\u043e\u0432\u0438\u043b\u0438 \u0434\u043b\u044f \u0432\u0430\u0441 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u0434\u0430\u0440\u043e\u043a.\n\u042d\u0442\u043e\u0439 \u0442\u0440\u0451\u0445\u043c\u0435\u0440\u043d\u043e\u0439 \u043e\u0442\u043a\u0440\u044b\u0442\u043a\u043e\u0439 \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u0432\u043e\u0438\u0445 \u0431\u043b\u0438\u0437\u043a\u0438\u0445, \u0437\u043d\u0430\u043a\u043e\u043c\u044b\u0445 \u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u0432\u0441\u0435\u0445 \u0442\u0435\u0445, \u043a\u0442\u043e \u043f\u043e\u0441\u0435\u0442\u0438\u0442 \u0432\u0430\u0448\u0443 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0432 \u0441\u043e\u0446\u0441\u0435\u0442\u0438 \u0438\u043b\u0438 \u0432 \u0431\u043b\u043e\u0433\u0435.\n\u0416\u0435\u043b\u0430\u0435\u043c \u0412\u0430\u043c \u043f\u0440\u043e\u0446\u0432\u0435\u0442\u0430\u043d\u0438\u044f \u0438 \u0431\u043b\u0430\u0433\u043e\u043f\u043e\u043b\u0443\u0447\u0438\u044f \u0432 2015 \u0433\u043e\u0434\u0443!",
en:"Dear users!\nFor this New Year's we have prepared a special gift for you.\nWith this 3D greeting card you can congratulate your family, friends and the visitors of your blog or social account.\nWe wish you happiness and prosperity in the coming 2015!"},title:{ru:"\u0421 \u041d\u043e\u0432\u044b\u043c \u0413\u043e\u0434\u043e\u043c! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0434\u0430\u0440\u043a\u0438, \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0432\u0438\u0437\u043e\u0440, \u043e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0434\u0440\u0443\u0437\u044c\u044f\u043c \u0441\u0432\u043e\u0435 \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435!",
en:"Happy New Year! Try opening the presents, turn on the TV and even send a personal greeting!"}};v.set_language=function(e){w=e};v.get_language=function(){return w};v.get_translation=function(e){var t=C[e];return t?(t=t[w])?t:"[TRANSLATION FOR "+e+": NO SUCH LANGUAGE]":"[TRANSLATION FOR "+e+": NO SUCH KEY]"}});b4w.register("new_year_main",function(v,e){function w(a,b){b?(C(),z.detect_mobile()||a.addEventListener("mousedown",N),a.addEventListener("touchstart",N),window.onresize=O,O(),P=l?"../../deploy/assets/new_year/":"../../assets/new_year/",ba.load(P+"christmas_tree.json",t,ca,!0)):console.log("b4w init failure")}function C(){z.pause();var a=document.querySelector("#pl_cont"),b=a.querySelector("#pl_frame");Q=document.querySelector("#pl_bar");R=document.querySelector("#pl_caption");m.css_animate(a,"opacity",
0,1,500,"","",function(){z.resume();b.style.opacity=1})}function M(){for(var a=document.getElementsByTagName("a"),b=0;b<a.length;b++)a[b].href=a[b].href.replace("&amp;","&")}function t(a){window.Ya?new Ya.share({element:"yandex_icons",elementStyle:{type:"none",quickServices:"facebook twitter vkontakte odnoklassniki gplus moimir".split(" ")},onready:function(a){da();document.getElementById("send_button").onclick=function(){S();a.updateShareLink(window.location.href+" via Blend4Web",r.get_translation("title"));
M()};a.updateShareLink(window.location.href+" via Blend4Web",r.get_translation("title"));M()}}):document.getElementById("send_button").onclick=function(){S()};document.getElementById("mail_to").onclick=function(){this.href=onclick="mailto:yourfriends?subject="+r.get_translation("title")+"&body="+window.location.href.replace("&","%26")};m.enable_camera_controls();ea();fa();x.enable_mouse_hover_outline()}function ea(){var a=d.get_active_camera();D=p.get_translation(a);var b=new Float32Array(3);p.target_get_pivot(a,
b);T=U.dist(b,D);E=p.get_camera_angles(a);var a=d.get_object_by_name("letter"),b=d.get_object_by_dupli_name("letter","armature_letter"),q=d.get_object_by_dupli_name("gift","Armature.001");c.apply(a,"letter_fly_group");c.apply(q,"cap_fly");c.apply(b,"letter_fly_fin");c.set_behavior(a,c.AB_FINISH_STOP);c.set_behavior(b,c.AB_FINISH_STOP);c.set_behavior(q,c.AB_FINISH_STOP);a=d.get_object_by_dupli_name("gift_monkey","Armature_gift_monkey");b=d.get_object_by_dupli_name("gift_monkey.001","Armature");c.apply(a,
"cap_fly");c.set_behavior(a,c.AB_FINISH_STOP);c.set_first_frame(b);c.apply(b,"jump_B4W_BAKED");c.set_behavior(b,c.AB_FINISH_STOP);g.push(d.get_object_by_dupli_name("confetti","Cylinder"));g.push(d.get_object_by_dupli_name("confetti","Cylinder.001"));g.push(d.get_object_by_dupli_name("confetti","Cylinder.002"));g.push(d.get_object_by_dupli_name("confetti","Cylinder.003"));g.push(d.get_object_by_dupli_name("confetti","Cylinder.004"));g.push(d.get_object_by_dupli_name("confetti","Cylinder.005"));a=d.get_object_by_dupli_name("gift_5",
"Armature_gift_5");c.apply(a,"cap_fly");c.set_behavior(a,c.AB_FINISH_STOP);for(a=0;a<g.length;a++)c.apply(g[a],"ParticleSystem 3"),c.set_behavior(g[a],c.AB_FINISH_STOP);a=d.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above");b=d.get_object_by_dupli_name("confetti","ribbons_from_below");c.apply(a,"Shader NodetreeAction.004");c.set_behavior(a,c.AB_FINISH_STOP);c.apply(b,"Shader NodetreeAction");c.set_behavior(b,c.AB_FINISH_STOP);a=d.get_object_by_dupli_name("bear","bear");c.apply(a,"bear_wiggle");
c.set_behavior(a,c.AB_FINISH_STOP);c.set_first_frame(a);F(!0);G(!0);A(!0);(a=m.get_url_params())&&a.lang&&"ru"==a.lang?(r.set_language(a.lang),document.body.className="lang_ru"):document.body.className="lang_en";a=a&&a.text?a.text:null;V();ga(a)}function da(){var a=m.get_url_params();a&&a.lang&&"ru"==a.lang&&r.set_language(a.lang)}function V(){var a=d.get_object_by_dupli_name("letter","letter"),b=n.get_canvas_ctx(a,"canvas_texture");b&&(b.clearRect(0,0,b.canvas.width,b.canvas.height),b.globalAlpha=
.95,b.globalAlpha=1,b.font="44px congratulatory_font, 'URW Chancery L', cursive",b.fillStyle="#ffffff",n.update_canvas_ctx(a,"canvas_texture"))}function F(a){var b=d.get_object_by_dupli_name("letter","letter"),c=d.get_object_by_dupli_name("letter","wax_seal_rope");a?(d.hide_object(b),d.hide_object(c)):(d.show_object(b),d.show_object(c))}function G(a){var b=d.get_object_by_dupli_name("gift_monkey.001","monkey"),c=d.get_object_by_dupli_name("gift_monkey.001","monkey.001");a?(d.hide_object(b),d.hide_object(c)):
(d.show_object(b),d.show_object(c))}function A(a){var b=d.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above"),c=d.get_object_by_dupli_name("confetti","ribbons_from_below");if(a)for(d.hide_object(b),d.hide_object(c),a=0;a<g.length;a++)d.hide_object(g[a]);else for(d.show_object(b),d.show_object(c),a=0;a<g.length;a++)d.show_object(g[a])}function ga(a){var b=document.getElementById("text_element");b.oninput=function(){300<b.value.length&&(b.value=b.value.substr(0,300))};var c=d.get_object_by_dupli_name("letter",
"letter"),c=n.get_canvas_ctx(c,"canvas_texture");b.value=a?ha(a):r.get_translation("default_text");a=W(b.value,c);X(a)}function ia(){var a=document.getElementById("container"),b=document.getElementById("open_button"),q=document.getElementById("close_button"),f=document.getElementById("text_container"),h=document.getElementById("icons");h.style.visibility="visible";b.addEventListener("click",function(){f.style.visibility="visible";q.style.visibility="hidden";b.style.visibility="hidden";V();var a=document.getElementById("open_button"),
c=document.getElementById("text_element"),d=document.getElementById("text_container");c.disabled=!1;a.style.visibility="hidden";d.style.visibility="visible"},!1);q.addEventListener("click",function(){H=!1;x.enable_mouse_hover_outline();a.style.visibility="hidden";f.style.visibility="hidden";h.style.visibility="hidden";var b=d.get_object_by_name("letter"),q=d.get_object_by_dupli_name("letter","armature_letter"),e=d.get_object_by_dupli_name("gift","Armature.001");c.set_speed(b,-2);c.set_speed(e,-2);
c.set_speed(q,-2);c.play(b);c.play(e,F);c.play(q);m.enable_camera_controls()},!1);a.style.visibility="visible"}function S(){var a=document.getElementById("text_element"),b=document.getElementById("text_container"),c=document.getElementById("open_button"),f=document.getElementById("close_button"),a=a.value,h=d.get_object_by_dupli_name("letter","letter"),h=n.get_canvas_ctx(h,"canvas_texture"),h=W(a,h);X(h);b.style.visibility="hidden";c.style.visibility="inherit";f.style.visibility="inherit";for(var f=
"",h=300<a.length?300:a.length,e=0;e<h;e++){for(var b=a[e].charCodeAt(0).toString(16),c=4-b.length,g=0;g<c;g++)b="0"+b;f+=b}a=f;window.history.pushState("","","?lang="+r.get_language()+"&text="+a)}function O(){ja.resize_to_container();var a=window.innerHeight,b=window.innerWidth;document.getElementById("text_element").style.fontSize=(.025*a).toString()+"px";if(-1==navigator.userAgent.indexOf("iPad")){var c=document.getElementsByTagName("html")[0];c.style.height=a.toString()+"px";c.style.width=b.toString()+
"px"}if(c=document.getElementById("background_image_container"))c.style.height=a.toString()+"px",c.style.width=b.toString()+"px";if(c=document.getElementById("simple_preloader_container"))c.style.height=a.toString()+"px",c.style.width=b.toString()+"px";b=document.getElementById("container");b.style.width=(.5*a).toString()+"px";b.style.height=(.6*a).toString()+"px";b.style.top=(.03*a).toString()+"px"}function W(a,b){for(var c=a.split(""),d="",h="",e=[],g=0;g<c.length;g++){if(300<=g){h+="...";break}"\n"==
c[g]?(d+=h,e.push(d),h=d=""):-1<" ,.-+!?".indexOf(c[g])?(515<b.measureText(d+h).width&&(e.push(d),d=""),d+=h,h="",d+=c[g]):(h+=c[g],515<b.measureText(h).width&&(d+=h,e.push(d),d=h=""))}e.push(d+h);12<e.length&&(e.length=12,e.push("..."));return e}function X(a){if(a){for(var b=d.get_object_by_dupli_name("letter","letter"),c=n.get_canvas_ctx(b,"canvas_texture"),f=c.font.split("px"),f=parseInt(f[0]),e=0;e<a.length;e++)c.fillText(a[e],235,Math.round(1.25*f*e+185));n.update_canvas_ctx(b,"canvas_texture")}}
function ha(a){for(var b="",c="",d=0;d<a.length;d+=4)b+=a[d]+a[d+1]+a[d+2]+a[d+3],c+=String.fromCharCode(parseInt(b,16)),b="";return c}function N(a){if(!H){a.preventDefault&&a.preventDefault();var b=x.get_coords_x(a);a=x.get_coords_y(a);if(b=d.pick_object(b,a))switch(d.get_object_name(b)){case "box":b=d.get_object_by_name("letter");a=d.get_object_by_dupli_name("letter","armature_letter");var e=d.get_object_by_dupli_name("gift","Armature.001"),f=d.get_object_by_dupli_name("gift","letter");F();k.stop(f);
k.play_def(f);H=!0;x.disable_mouse_hover_outline();Y=ka.get_timeline();var f=d.get_active_camera(),h=p.target_get_pivot(f,la),l=p.get_translation(f,ma);Z=U.dist(h,l);p.get_camera_angles(f,u);u[0]>Math.PI&&(u[0]-=2*Math.PI);m.disable_camera_controls();c.set_speed(b,1);c.set_speed(e,1);c.set_speed(a,1);c.play(b,ia);c.play(e);c.play(a);break;case "box_5":e=d.get_object_by_dupli_name("gift_5","Armature_gift_5");b=d.get_object_by_dupli_name("confetti","ribbons_from_below");a=d.get_object_by_dupli_name("confetti_ribbons",
"ribbons_flom_above");f=d.get_object_by_dupli_name("gift_5","fireworks");k.stop(f);if(I){c.set_speed(e,-2);c.play(e);for(f=0;f<g.length;f++)c.stop(g[f]),e=d.get_object_name(g[f]),"Cylinder"==e||"Cylinder.001"==e||"Cylinder.002"==e?c.set_frame(g[f],0):c.set_first_frame(g[f]);c.stop(b);c.set_first_frame(b);c.stop(a);c.set_first_frame(a);A(!0)}else for(A(),c.set_speed(e,1),c.play(e),c.play(b,na),k.play_def(f),f=0;f<g.length;f++)c.play(g[f]);I=!I;break;case "box_6":b=d.get_object_by_dupli_name("gift_monkey",
"Armature_gift_monkey");a=d.get_object_by_dupli_name("gift_monkey.001","Armature");e=d.get_object_by_dupli_name("gift_monkey","monkey");k.stop(e);k.play_def(e);J?(c.set_speed(b,-1.7),c.play(b,G),c.set_speed(a,-3)):(G(),c.set_speed(b,1),c.play(b),c.set_speed(a,1));c.play(a);J=!J;break;case "tv":d.get_object_by_name("lamp");b=d.get_object_by_dupli_name("TV","speaker");K?(n.pause_video("Texture"),n.reset_video("Texture"),k.stop(b)):(n.play_video("Texture"),k.play_def(b));K=!K;break;case "bear":b=d.get_object_by_dupli_name("bear",
"bear"),a=d.get_object_by_dupli_name("bear","spk_bear"),k.stop(a),k.play_def(a),L?c.set_speed(b,-1):c.set_speed(b,1),c.play(b),L=!L}}}function na(){var a=d.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above");c.play(a,A)}function fa(){var a=d.get_active_camera(),b=y.create_timeline_sensor(),c=y.create_elapsed_sensor();y.create_sensor_manifold(a,"CAMERA_MOVE",y.CT_CONTINUOUS,[b,c],function(a){return a[0]-Y<B},function(a,b,c){if(0<c){b=y.get_sensor_value(a,b,1);c=b/B*(E[0]-u[0]);var d=
b/B*(E[1]-u[1]);oa.move_local(a,0,0,b/B*(T-Z));p.target_rotate(a,c,d)}else p.target_set_trans_pivot(a,D,null)})}function ca(a){Q.style.width=a+"%";R.innerHTML=a+"%";if(100==a){var b=document.querySelector("#pl_cont");b.querySelector("#pl_frame").style.opacity=0;m.css_animate(b,"opacity",1,0,2E3,"","",function(){b.parentNode.removeChild(b)})}}var n=e("textures"),ka=e("time"),ba=e("data"),m=e("app"),z=e("main"),pa=e("version"),d=e("scenes"),c=e("animation"),p=e("camera"),U=e("vec3"),ja=e("container"),
y=e("controls"),oa=e("transform");e("util");var k=e("sfx"),x=e("mouse");e("lights");e("preloader");var r=e("new_year_language"),aa=e("config"),P,l="DEBUG"===pa.type(),D,Z,T,E,la,ma=new Float32Array(3),u=new Float32Array(2),Y=0,B=25/24,g=[],I=!1,J=!1,L=!1,K=!1,H=!1,Q=null,R=null;v.init=function(){var a=l,b=m.get_url_params();b&&"show_fps"in b&&(a=!0);z.detect_mobile()&&aa.set("quality",aa.P_LOW);m.init({canvas_container_id:"canvas3d",callback:w,pause_invisible:!1,physics_enabled:!1,show_fps:a,key_pause_enabled:!1,
assets_dds_available:!l,assets_pvr_available:!l,assets_min50_available:!l,console_verbose:l,gl_debug:l})}});b4w.require("new_year_main").init();
