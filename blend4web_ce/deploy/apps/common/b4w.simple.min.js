/**
 * Blend4Web CE 16.10
 * Copyright (C) 2014-2016 Triumph LLC
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
var b4w="object"===typeof b4w?b4w:function(a){var r={};a.module=r;var u={};a.cleanup=function(a,b){var f=r[a];f&&(f._compiled=null);u[b||"__b4w_default"]=null};a.register=function(a,b){r[a]||(r[a]=b)};a.require=function(a,b){if(!r[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";u[b]||(u[b]=function(a){return function(b){var h=r[b];if(!h)throw Error('Module "'+b+'" not found');h._compiled||(h._compiled={});h._compiled[a]||(h._compiled[a]={},h(h._compiled[a],u[a]));return h._compiled[a]}}(b));
return u[b](a)};a.module_check=function(a){return r[a]?!0:!1};a.get_namespace=function(a){for(var b in u)if(u[b]==a)return b;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a,r){function u(){var a=h,b=a.getDate(),b=10>b?"0"+String(b):String(b),q=a.getMonth()+1,q=10>q?"0"+String(q):String(q),e=String(a.getFullYear()),n=a.getHours(),n=10>n?"0"+String(n):String(n),p=a.getMinutes(),p=10>p?"0"+String(p):String(p),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+q+"."+e+" "+n+":"+p+":"+a}var h=new Date(2016,9,27,18,38,42),b=[16,10];a.version=function(){return b};a.version_str=function(){for(var a="",l=0;l<b.length;l++)a=1==l?a+(10>
b[l]?"0"+b[l]:b[l]):a+b[l],l!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return h};a.date_str=u;a.timestamp=function(){var a=u(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.exports&&b4w.module.__version(exports);b4w.module.__config=function(a,r){function u(){return b4w.module_check(a.paths.built_in_data_module)}function h(){for(var l=a.paths,h=null,e=document.getElementsByTagName("script"),n=0;n<e.length;n++){for(var f=e[n].src,B=0;B<l.js_src_search_paths.length;B++)if(0<=f.indexOf(l.js_src_search_paths[B])){h=f;break}if(null!==h)break}h||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),h=document.location.href);l=h.indexOf("?");0<=l&&(h=h.substring(0,l));
return h.substring(0,h.lastIndexOf("/")+1)}var b=r("__print"),f=r("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.P_AUTO=5;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.context_save=f.clone_object_r(a.context);a.defaults={alpha_sort:!0,alpha_sort_threshold:.1,min_format_version:[6,1],max_fps:1E4,console_verbose:!1,do_not_load_resources:!1,use_min50:!1,fps_measurement_interval:1,fps_callback_interval:5,background_color:[0,0,0,0],canvas_resolution_factor:1,texture_min_filter:3,
allow_cors:!1,force_low_quality_nodes:!1,anisotropic_filtering:!0,show_hud_debug_info:!1,depth_textures:!0,shadows:!0,stereo:"NONE",reflections:!0,refractions:!0,ssao:!0,dof:!0,god_rays:!0,bloom:!0,motion_blur:!0,compositing:!0,antialiasing:!0,smaa:!1,debug_view:!1,water_wireframe_debug:!1,foam:!0,parallax:!0,dynamic_grass:!0,water_dynamic:!0,shore_smoothing:!0,shore_distance:!0,use_compression:!0,precision:"highp",quality:a.P_HIGH,allow_vertex_textures:!0,no_phy_interp_hack:!1,shader_constants_hack:!1,
disable_blend_shadows_hack:!1,vert_anim_mix_normals_hack:!1,is_mobile_device:!1,init_wa_context_hack:!1,clear_procedural_sky_hack:!1,sky_update_hack:!1,seq_video_fallback:!1,allow_hidpi:!1,shadows_color_slink_hack:!1,mobile_firefox_media_hack:!1,enable_selectable:!0,enable_outlining:!0,glow_materials:!0,ie11_edge_touchscreen_hack:!1,firefox_tex_reuse_hack:!1,loaded_data_version:[0,0],edge_min_tex_size_hack:!1,quality_aa_method:!0,skinning_hack:!1,url_params:null,webgl2:!0,msaa_samples:4,safari_canvas_alpha_hack:!1,
safari_glow_hack:!1,resize_cubemap_canvas_hack:!1,chrome_html_bkg_music_hack:!1,ie_edge_anchors_floor_hack:!1,ff_disable_anchor_vis_hack:!1,media_auto_activation:!0,max_cast_lamps:4,mac_os_shadow_hack:!1,gl_debug:!1,check_framebuffer_hack:!1,allow_instanced_arrays_ext:!1,allow_vao_ext:!1,compress_format:"dds",shadow_quality:"16x",srgb_type:"SRGB_SIMPLE"};a.defaults_save=f.clone_object_r(a.defaults);a.animation={framerate:-1,frames_blending_hack:!1,frame_steps:1};a.controls={mouse_wheel_notch_multiplier:1/
120};a.assets={path:"",path_default:"B4W_ASSETS_PATH=../../assets/",max_requests:15,prevent_caching:!0,min50_available:!1,dds_available:!1,pvr_available:!1};a.assets_save=f.clone_object_r(a.assets);a.paths={shaders_path:"",shaders_path_default:"../shaders/",shaders_include_dir:"include/",shaders_postp_dir:"postprocessing/",built_in_data_module:"built_in_data",js_src_search_paths:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js B4W_MAIN_MODULE".split(" "),smaa_search_texture_path:"smaa_search_texture.png",
smaa_area_texture_path:"smaa_area_texture.png"};a.hmd_params={webvr:{distortion_coefs:[.22,.28],chromatic_aberration_coefs:[-.015,.02,.025,.02]},nonwebvr:{inter_lens_dist:.064,base_line_dist:.035,screen_to_lens_dist:.039,distortion_coefs:[.34,.55],chromatic_aberration_coefs:[0,0,0,0],width_dist:.11,height_dist:.062,bevel_size:.004}};a.physics={enabled:!0,max_fps:60,uranium_path:"",uranium_path_default:"B4W_URANIUM_PATH=uranium.js",calc_fps:!1,ping:!1,use_workers:!0};a.physics_save=f.clone_object_r(a.physics);
a.scenes={grass_tex_size:1024,cubemap_tex_size:256,cube_reflect_low:32,cube_reflect_medium:128,cube_reflect_high:256,plane_reflect_low:.25,plane_reflect_medium:.5,plane_reflect_high:1};a.scenes_save=f.clone_object_r(a.scenes);a.sfx={webaudio:!0,mix_mode:!1,audio_loading_hack:!1,clamp_playback_rate_hack:!1,disable_playback_rate_hack:!1};a.sfx_save=f.clone_object_r(a.sfx);a.outlining={outlining_overview_mode:!1,outline_color:[1,.4,.05],outline_duration:.2,outline_period:3.8,outline_relapses:1};a.debug_subs=
{enabled:!1,subs_type:0,subs_number:0,slink_type:"COLOR"};a.debug_subs_save=f.clone_object_r(a.debug_subs);a.context_limits={max_combined_texture_image_units:8,max_fragment_uniform_vectors:64,max_texture_image_units:8,max_varying_vectors:8,max_vertex_attribs:15,max_vertex_texture_image_units:0,max_vertex_uniform_vectors:128,max_cube_map_texture_size:1024,max_renderbuffer_size:4096,max_texture_size:4096,max_viewport_dims:[4096,4096]};a.context_limits_save=f.clone_object_r(a.context_limits);a.apply_quality=
function(){var b=a.defaults,h=a.physics,e=a.scenes;switch(b.quality){case a.P_ULTRA:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;e.grass_tex_size=2048;e.cubemap_tex_size=512;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!0;b.enable_outlining=
!0;b.glow_materials=!0;b.msaa_samples=16;b.srgb_type="SRGB_PROPER";h.max_fps=120;break;case a.P_HIGH:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;e.grass_tex_size=1024;e.cubemap_tex_size=256;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=
!1;b.enable_outlining=!0;b.glow_materials=!0;b.srgb_type="SRGB_SIMPLE";b.msaa_samples=4;h.max_fps=60;break;case a.P_LOW:b.shadows=!1;b.shore_smoothing=!1;b.ssao=!1;b.dof=!1;b.god_rays=!1;b.bloom=!1;b.reflections=!1;b.refractions=!1;b.foam=!1;b.parallax=!1;b.dynamic_grass=!1;e.grass_tex_size=512;e.cubemap_tex_size=256;b.texture_min_filter=2;b.anisotropic_filtering=!1;b.use_min50=!0;b.precision="mediump";b.water_dynamic=!1;b.shore_distance=!1;b.antialiasing=!1;b.smaa=!1;b.compositing=!1;b.motion_blur=
!1;b.allow_hidpi=!1;b.enable_outlining=!1;b.glow_materials=!1;b.srgb_type="SRGB_SIMPLE";b.msaa_samples=1;h.max_fps=60;break;case a.P_AUTO:f.panic("Direct AUTO quality profile setting is forbidden")}};a.set=function(h,f){switch(h){case "allow_cors":a.defaults.allow_cors=f;break;case "allow_hidpi":a.defaults.allow_hidpi=f;break;case "alpha":a.context.alpha=f;break;case "alpha_sort":a.defaults.alpha_sort=f;break;case "alpha_sort_threshold":a.defaults.alpha_sort_threshold=f;break;case "anaglyph_use":b.error_deprecated_cfg("anaglyph_use",
"stereo");a.defaults.stereo=f?"ANAGLYPH":a.defaults.stereo;break;case "animation_framerate":a.animation.framerate=f;break;case "anisotropic_filtering":a.defaults.anisotropic_filtering=f;break;case "antialiasing":a.defaults.antialiasing=f;break;case "assets_dir":case "assets_path":a.assets.path=f;break;case "assets_dds_available":a.assets.dds_available=f;break;case "assets_pvr_available":a.assets.pvr_available=f;break;case "assets_min50_available":a.assets.min50_available=f;break;case "audio":a.sfx.webaudio=
f;break;case "background_color":a.defaults.background_color=f;break;case "bloom":a.defaults.bloom=f;break;case "built_in_module_name":a.paths.built_in_data_module=f;break;case "canvas_resolution_factor":a.defaults.canvas_resolution_factor=f;break;case "console_verbose":a.defaults.console_verbose=f;break;case "dof":a.defaults.dof=f;break;case "do_not_load_resources":a.defaults.do_not_load_resources=f;break;case "god_rays":a.defaults.god_rays=f;break;case "stereo":a.defaults.stereo=f;break;case "max_fps":a.defaults.max_fps=
f;break;case "max_fps_physics":a.physics.max_fps=f;break;case "media_auto_activation":a.defaults.media_auto_activation=f;break;case "motion_blur":a.defaults.motion_blur=f;break;case "physics_enabled":a.physics.enabled=f;break;case "physics_uranium_path":a.physics.uranium_path=f;break;case "physics_calc_fps":a.physics.calc_fps=f;break;case "physics_use_workers":a.physics.use_workers=f;break;case "precision":a.defaults.precision=f;break;case "prevent_caching":a.assets.prevent_caching=f;break;case "quality":a.defaults.quality=
f;break;case "reflections":a.defaults.reflections=f;break;case "refractions":a.defaults.refractions=f;break;case "sfx_mix_mode":a.sfx.mix_mode=f;break;case "shaders_dir":case "shaders_path":a.paths.shaders_path=f;break;case "shadows":a.defaults.shadows=f;break;case "show_hud_debug_info":a.defaults.show_hud_debug_info=f;break;case "smaa":a.defaults.smaa=f;break;case "smaa_search_texture_path":a.paths.smaa_search_texture_path=f;break;case "smaa_area_texture_path":a.paths.smaa_area_texture_path=f;break;
case "ssao":a.defaults.ssao=f;break;case "debug_view":a.defaults.debug_view=f;break;case "enable_selectable":a.defaults.enable_selectable=f;break;case "enable_outlining":a.defaults.enable_outlining=f;break;case "outlining_overview_mode":a.outlining.outlining_overview_mode=f;break;case "glow_materials":a.defaults.glow_materials=f;break;case "url_params":a.defaults.url_params=f;break;case "use_min50":a.defaults.use_min50=f;break;case "gl_debug":a.defaults.gl_debug=f;break;case "srgb_type":a.defaults.srgb_type=
f;break;default:b.error("Unknown config property: "+h)}};a.get=function(h){switch(h){case "allow_cors":return a.defaults.allow_cors;case "allow_hidpi":return a.defaults.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.defaults.alpha_sort;case "alpha_sort_threshold":return a.defaults.alpha_sort_threshold;case "anaglyph_use":return"ANAGLYPH"==a.defaults.stereo;case "animation_framerate":return a.animation.framerate;case "anisotropic_filtering":return a.defaults.anisotropic_filtering;
case "antialiasing":return a.defaults.antialiasing;case "assets_dir":case "assets_path":return a.assets.path;case "assets_dds_available":return a.assets.dds_available;case "assets_pvr_available":return a.assets.pvr_available;case "assets_min50_available":return a.assets.min50_available;case "audio":return a.sfx.webaudio;case "background_color":return a.defaults.background_color;case "bloom":return a.defaults.bloom;case "built_in_module_name":return a.paths.built_in_data_module;case "canvas_resolution_factor":return a.defaults.canvas_resolution_factor;
case "console_verbose":return a.defaults.console_verbose;case "dof":return a.defaults.dof;case "do_not_load_resources":return a.defaults.do_not_load_resources;case "is_mobile_device":return a.defaults.is_mobile_device;case "god_rays":return a.defaults.god_rays;case "stereo":return a.defaults.stereo;case "max_fps":return a.defaults.max_fps;case "max_fps_physics":return a.physics.max_fps;case "media_auto_activation":return a.defaults.media_auto_activation;case "motion_blur":return a.defaults.motion_blur;
case "physics_enabled":return a.physics.enabled;case "physics_uranium_path":return a.physics.uranium_path;case "physics_calc_fps":return a.physics.calc_fps;case "physics_use_workers":return a.physics.use_workers;case "precision":return a.defaults.precision;case "prevent_caching":return a.assets.prevent_caching;case "quality":return a.defaults.quality;case "reflections":return a.defaults.reflections;case "refractions":return a.defaults.refractions;case "sfx_mix_mode":return a.sfx.mix_mode;case "shaders_dir":case "shaders_path":return a.paths.shaders_path;
case "shadows":return a.defaults.shadows;case "show_hud_debug_info":return a.defaults.show_hud_debug_info;case "smaa":return a.defaults.smaa;case "smaa_search_texture_path":return a.paths.smaa_search_texture_path;case "smaa_area_texture_path":return a.paths.smaa_area_texture_path;case "ssao":return a.defaults.ssao;case "debug_view":return a.defaults.debug_view;case "enable_selectable":return a.defaults.enable_selectable;case "enable_outlining":return a.defaults.enable_outlining;case "outlining_overview_mode":return a.outlining.outlining_overview_mode;
case "glow_materials":return a.defaults.glow_materials;case "url_params":return a.defaults.url_params;case "use_min50":return a.defaults.use_min50;case "gl_debug":return a.defaults.gl_debug;case "srgb_type":return a.defaults.srgb_type;default:b.error("Unknown config property: "+h)}};a.reset=function(){for(var b in a.context_save)a.context[b]=a.context_save[b];for(b in a.defaults_save)a.defaults[b]=a.defaults_save[b];for(b in a.assets_save)a.assets[b]=a.assets_save[b];for(b in a.physics_save)a.physics[b]=
a.physics_save[b];for(b in a.scenes_save)a.scenes[b]=a.scenes_save[b];for(b in a.sfx_save)a.sfx[b]=a.sfx_save[b];for(b in a.debug_subs_save)a.debug_subs[b]=a.debug_subs_save[b]};a.reset_limits=function(){for(var b in a.context_limits_save)a.context_limits[b]=a.context_limits_save[b]};a.is_built_in_data=u;a.set_paths=function(){var b=a.paths,f=a.physics;u()||""!=b.shaders_path||(b.shaders_path=h()+b.shaders_path_default);f.enabled&&""==f.uranium_path&&(f.uranium_path=h()+f.uranium_path_default.replace("B4W_URANIUM_PATH=",
""))};a.get_std_assets_path=function(){var b=a.assets;if(b.path)return b.path;var b=b.path_default.replace("B4W_ASSETS_PATH=",""),f;f=b?/^(((.*?)\/\/)|(\/))/.test(b):!1;return f?b:h()+b}};b4w.module.__anchors=function(a,r){function u(){x=!0;A.get_container().addEventListener("mouseup",function(a){function b(){return"visible"==c.style.visibility&&!H&&!f}if(!g&&!C&&(a=M))if("visible"==a.lastElementChild.style.visibility)h(),M=null;else if(1==a.style.opacity){var c=a.lastElementChild;a=a.firstElementChild;var m=c.firstElementChild,d=m.innerHTML;c.style.visibility="visible";var k=Math.min(parseInt(c.style.width)||200,q(d)-24),t=e(d,k),H=!0,f=!0;a.style.display="none";g=!0;D.animate(0,
k,200,function(a){a==k&&(H=!1,f||(g=!1),b&&(m.style.visibility="visible"));c.style.width=a+"px"});D.animate(0,t,200,function(a){a==t&&(f=!1,H||(g=!1),b&&(m.style.visibility="visible"));c.style.height=a+"px"})}})}function h(){var a=M.lastElementChild;M.firstElementChild.style.display="";a.style.visibility="hidden";a.firstElementChild.style.visibility="hidden"}function b(a){a.style.cssText+="color:       #fff;font-family: Arial;font-size:   12px;font-weight: bold;line-height: 15px;"}function f(a){a.style.cssText+=
"background-color:   #000;border-radius:      20px 20px 20px 0px;bottom:             0;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);font-size:          12px;left:               0;line-height:        15px;opacity:            1.0;overflow:           hidden;padding:            8px 12px;position:           absolute;z-index:            2;"}function l(a,c,m){var d=document.createElement("div"),k=document.createElement("span");m&&(d.style.width=
m+"px");f(d);b(k);k.innerHTML=a;d.style.visibility="hidden";k.style.visibility="hidden";d.appendChild(k);c.appendChild(d);c.addEventListener("mousedown",function(a){g||c==M||1!=c.style.opacity||C||(M&&"visible"==M.lastElementChild.style.visibility&&h(),M=c)})}function q(a){var g=document.createElement("div"),c=document.createElement("span");c.innerHTML=a;b(c);f(g);g.appendChild(c);document.body.appendChild(g);a=g.offsetWidth+1;document.body.removeChild(g);return a}function e(a,g){var c=document.createElement("div"),
d=document.createElement("span");d.innerHTML=a;b(d);f(c);c.style.width=g+"px";c.style.display="inline-block";c.appendChild(d);document.body.appendChild(c);d=c.offsetHeight-16;document.body.removeChild(c);return d}function n(){for(var a=0,g=0;g<t.length;g++)t[g].detect_visibility&&a++;H=new Float32Array(3*a)}function p(a,g){return g.depth-a.depth}function B(a,g,b,c){a=a.element;d.ie_edge_anchors_floor_hack&&(g=Math.floor(g),b=Math.floor(b));"transform"in a.style?a.style.transform="translate3d("+g+
"px, "+b+"px, 0px)":"webkitTransform"in a.style?a.style.webkitTransform="translate3d("+g+"px, "+b+"px, 0px)":(a.style.left=g+"px",a.style.top=b+"px")}var c=r("__batch"),k=r("__camera"),m=r("__config"),A=r("__container"),E=r("__objects"),w=r("__print"),v=r("__renderer"),z=r("__scenes"),y=r("__subscene"),D=r("__time"),K=r("__tsr"),d=m.defaults,t=[],C=!1,M=null,x=!1,g=!1,H=new Float32Array(0),G=new Uint8Array(16),ba=new Float32Array(2),L=new Float32Array(3);a.append=function(a){var g;a:{for(g=0;g<t.length;g++)if(t[g].obj==
a){g=!0;break a}g=!1}if(!g){g=a.anchor.detect_visibility&&Boolean(z.get_subs(z.get_main(),y.ANCHOR_VISIBILITY));g={type:a.anchor.type,obj:a,x:0,y:0,depth:0,appearance:"out",detect_visibility:g,element:null,move_cb:null,annotation_max_width:a.anchor.max_width,element_id:a.anchor.element_id};switch(g.type){case "ANNOTATION":var c=g.obj;a=A.get_container();var d=E.get_meta_tags(c),c=c.name,m=document.createElement("div"),k=m.cloneNode(),e=document.createElement("span"),H="";m.style.cssText+="position:           absolute;transform-style:    preserve-3d;";
k.style.cssText+="background-color:   #000;border-radius:      20px 20px 20px 0px;box-shadow:         0px 0px 10px rgb(180, 180, 200);-webkit-box-shadow: 0px 0px 10px rgb(180, 180, 200);font-size:          12px;line-height:        15px;opacity:            1.0;bottom:             0;left:               0;padding:            8px 12px;position:           absolute;";m.style.visibility="hidden";d&&(H=d.description||H,c=d.title||c);e.innerHTML=c;e.style.cssText+="-webkit-touch-callout: none;-webkit-user-select:   none;-khtml-user-select:    none;-moz-user-select:      none;-ms-user-select:       none;user-select:           none;cursor:                default;";
b(e);e.style.whiteSpace="nowrap";k.appendChild(e);m.appendChild(k);H&&l(H,m,g.annotation_max_width);a.appendChild(m);g.element=m;break;case "ELEMENT":if(g.element=document.getElementById(a.anchor.element_id),g.element)for(d=0;d<t.length;d++)"ELEMENT"==t[d].type&&t[d].element_id==a.anchor.element_id&&(w.warn("Anchor with the id '"+a.anchor.element_id+"' already exists, making the new anchor generic."),g.type="GENERIC");else w.warn("Anchor HTML element with the id '"+a.anchor.element_id+"' was not found, making it generic."),
g.type="GENERIC"}t.push(g);n();x||u()}};a.remove=function(a){for(var g=0;g<t.length;g++){var b=t[g];if(b.obj==a){"ANNOTATION"==b.type&&(a=b,A.get_container().removeChild(a.element));t.splice(g,1);n();break}}};a.update=function(a){for(var g=0,b=t.length;b--;){var d=t[b];if(d.detect_visibility){var m=K.get_trans_view(d.obj.render.world_tsr);H.set(m,3*g++)}var e;e=d;var m=L,f=z.get_camera(z.get_main());e=K.get_trans_view(e.obj.render.world_tsr);e=m=k.project_point(f,e,m);m=e[0];f=e[1];e=e[2];if(a||m!=
d.x||f!=d.y||e!=d.depth){switch(d.type){case "ANNOTATION":var h=m,G=f;B(d,h,G);break;case "ELEMENT":G=d.element.getBoundingClientRect(),h=m-G.width/2,G=f-G.height/2,B(d,h,G)}d.x=m;d.y=f;d.depth=e;d.move_cb&&d.move_cb(m,f,d.appearance,d.obj,d.element)}}t.sort(p);for(b=0;b<t.length;b++)d=t[b],"GENERIC"!=d.type&&(d.element.style.zIndex=M==d.element?t.length:b);0<g&&(a=z.get_subs(z.get_main(),y.ANCHOR_VISIBILITY),g=a.draw_data[0].bundles[0],c.update_anchor_visibility_batch(g.batch,H),y.append_draw_data(a,
g))};a.update_visibility=function(){for(var a=A.get_container(),g=t.length;g--;){var b=t[g],c=b.obj,d=b.x,m=b.y,k=b.depth,k=0>d||0>m||0>k||1<k||z.is_hidden(c)||d>=a.clientWidth||m>=a.clientHeight?"out":"visible";if(b.detect_visibility&&"out"!=k){var k=b,e=z.get_subs(z.get_main(),y.ANCHOR_VISIBILITY).camera,H=A.canvas_to_viewport_coords(k.x,k.y,ba,e);v.read_pixels(e.framebuffer,H[0],e.height-H[1],2,2,G);k=1020==G[0]+G[4]+G[8]+G[12]?"visible":"out"==k.appearance||0==G[0]+G[4]+G[8]+G[12]?"covered":k.appearance}if(k!=
b.appearance){switch(b.type){case "ANNOTATION":case "ELEMENT":var f=b.element;if(!f)break;"out"==k?(f.style.visibility="hidden",f.children.length&&(f.children[0].style.visibility="hidden")):"visible"==k?(f.style.visibility="visible",f.children.length&&(f.children[0].style.visibility="visible"),f.style.opacity=1):(f.style.visibility="visible",f.style.opacity=.1,f.children.length&&(f.children[0].style.visibility="visible"),"ANNOTATION"==b.type&&1<f.children.length&&"visible"==f.lastElementChild.style.visibility&&
(h(),f==M&&(M=null)))}b.appearance=k;b.move_cb&&b.move_cb(d,m,b.appearance,c,f)}}};a.attach_move_cb=function(a,g){for(var b=0;b<t.length;b++)t[b].obj==a&&(t[b].move_cb=g)};a.detach_move_cb=function(a){for(var g=0;g<t.length;g++)t[g].obj==a&&(t[g].move_cb=null)};a.cleanup=function(){for(var a=0;a<t.length;a++){var g=t[a];"ANNOTATION"==g.type&&A.get_container().removeChild(g.element)}t.length=0};a.is_anchor=function(a){for(var g=0;g<t.length;g++)if(t[g].obj==a)return!0;return!1};a.get_element_id=function(a){for(var g=
0;g<t.length;g++)if(t[g].obj==a)return t[g].element_id;return!1};a.pause=function(){C=!0};a.resume=function(){C=!1};a.pick_anchor=function(a,g){for(var b=-1,d=0;d<t.length;d++){var c;if(c="visible"==t[d].appearance){var m=t[d];c=a;var k=g;if(m.element)var e=Math.round(m.element.offsetWidth)||0,H=Math.round(m.element.offsetHeight)||0;else H=e=0;var f=m.x,m=m.y;c=c>=f&&c<=f+e&&k<m&&k>=m-H?!0:!1}if(c)if(0>b)var I=t[d].depth,b=d;else t[d].depth<I&&(b=d,I=t[d].depth)}return 0>b?null:t[b].obj}};b4w.module.__armature=function(a,r){function u(a){a=a.render;for(var b=a.skinned_renders,c=a.mesh_to_arm_bone_maps,k=0;k<b.length;k++){for(var e=b[k],f=c[k],h=0;h<f.length;h+=2)for(var n=f[h],l=f[h+1],d=0;4>d;d++)e.quats_before[n+d]=a.quats_before[l+d],e.quats_after[n+d]=a.quats_after[l+d],e.trans_before[n+d]=a.trans_before[l+d],e.trans_after[n+d]=a.trans_after[l+d];e.frame_factor=a.frame_factor}}function h(a,b,c,k){var e=a.tsr_bone_pose,l=a.tsr_local_rest,B=a.tsr_local_pose,q=a.parent_bone_ptr;q?
(q=q.tsr_local_pose,b?f.multiply(q,e,B):(b=p,f.invert(q,b),f.multiply(b,B,e))):b?f.copy(e,B):f.copy(B,e);e=n;f.invert(l,e);f.multiply(B,e,e);l=a.bone_index;c[4*l]=e[0];c[4*l+1]=e[1];c[4*l+2]=e[2];c[4*l+3]=e[3];k[4*l]=e[4];k[4*l+1]=e[5];k[4*l+2]=e[6];k[4*l+3]=e[7];a=a.descend_bones_ptrs;for(l=0;l<a.length;l++)B=a[l],B.constraint||h(B,!0,c,k)}var b=r("__util"),f=r("__tsr"),l=r("__quat"),q=r("__mat4"),e=r("__vec3"),n=f.create(),p=f.create(),B=new Float32Array(4),c=new Float32Array(4),k=new Float32Array(4);
a.update_object=function(a,c){for(var k=a.data.bones,h=a.pose.bones,l={},p=0;p<h.length;p++){var B=h[p],D=B.bone,K=D.name,d=K,K={bone_index:0,vgroup_index:-1,parent_bone_ptr:null,descend_bones_ptrs:[],chain:[],constraint:null,tsr_bone_rest:f.create(),tsr_bone_pose:f.create(),tsr_local_rest:f.create(),tsr_local_pose:f.create(),tsr_basis:f.create(),tsr_channel_cache:f.create(),tsr_channel_cache_valid:!1,tail:new Float32Array(3)},d=l[d]=K,K=new Float32Array(D.matrix_local),t=new Float32Array(16);q.invert(K,
t);var B=new Float32Array(B.matrix_basis),C=d.tail;e.subtract(b.f32(D.tail_local),b.f32(D.head_local),C);b.vecdir_multiply_matrix(C,t,C);f.from_mat4(K,d.tsr_local_rest);f.from_mat4(B,d.tsr_basis);f.copy(d.tsr_local_rest,d.tsr_local_pose)}for(p=0;p<k.length;p++){K=k[p].name;B=b.keysearch("name",K,h);d=l[K];D=B.parent_recursive;d.chain.push(d);for(B=0;B<D.length;B++)t=D[B],t=t.name,t=l[t],d.chain.push(t);D.length?(t=D[0],t=t.name,t=l[t],d.parent_bone_ptr=t,f.invert(t.tsr_local_rest,n),f.multiply(n,
d.tsr_local_rest,d.tsr_bone_rest),t.descend_bones_ptrs.push(d)):f.copy(d.tsr_local_rest,d.tsr_bone_rest);d.bone_index=p;d.name=K;f.multiply(d.tsr_bone_rest,d.tsr_basis,d.tsr_bone_pose)}c.render.bone_pointers=l};a.get_bone_tsr=function(a,b,e,h,v){var z=a.render,y=z.frame_factor;b=z.bone_pointers[b];var q=b.bone_index;a=b.tsr_local_rest;var K=z.trans_before,d=z.trans_after,t=z.quats_before,z=z.quats_after,C=K[4*q+1],M=K[4*q+2],x=K[4*q+3],g=d[4*q+1],H=d[4*q+2],G=d[4*q+3];B[0]=(1-y)*K[4*q]+y*d[4*q];B[1]=
(1-y)*C+y*g;B[2]=(1-y)*M+y*H;B[3]=(1-y)*x+y*G;c[0]=t[4*q];c[1]=t[4*q+1];c[2]=t[4*q+2];c[3]=t[4*q+3];k[0]=z[4*q];k[1]=z[4*q+1];k[2]=z[4*q+2];k[3]=z[4*q+3];l.slerp(c,k,y,c);y=n;f.set_transcale(B,y);f.set_quat(c,y);e?(e=p,f.translate(a,b.tail,e),f.multiply(y,e,y)):f.multiply(y,a,y);if(h){if(h=b.parent_bone_ptr)e=p,f.invert(h.tsr_local_pose,e),f.multiply(e,y,y);h=p;f.invert(b.tsr_bone_rest,h);f.multiply(h,y,y)}f.copy(y,v)};a.set_bone_tsr=function(a,b,c,k){var e=a.render;b=e.bone_pointers[b];var n=e.trans_before,
l=e.quats_before;k?f.multiply(b.tsr_bone_rest,c,b.tsr_bone_pose):f.copy(c,b.tsr_local_pose);h(b,k,n,l);e.frame_factor=0;u(a)};a.update_skinned_renders=u;a.update_bone_tsr_r=h;a.check_bone=function(a,b){return b in a.render.bone_pointers}};b4w.module.__boundings=function(a,r){function u(a){return{max_x:0,min_x:0,max_y:0,min_y:0,max_z:0,min_z:0}}function h(){return{center:new Float32Array(3),axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3)}}function b(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z;return b}function f(a,b){for(var c=a[0],d=a[1],k=a[2],m=a[0],t=a[1],e=a[2],f=3;f<a.length;f+=3)var h=a[f],n=a[f+1],l=a[f+2],c=Math.max(c,h),d=Math.max(d,
n),k=Math.max(k,l),m=Math.min(m,h),t=Math.min(t,n),e=Math.min(e,l);b.max_x=c;b.max_y=d;b.max_z=k;b.min_x=m;b.min_y=t;b.min_z=e;return b}function l(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,k=a.max_z,m=a.min_x,t=a.min_y,e=a.min_z;b[0]=m;b[1]=t;b[2]=e;b[3]=c;b[4]=t;b[5]=e;b[6]=c;b[7]=d;b[8]=e;b[9]=m;b[10]=d;b[11]=e;b[12]=m;b[13]=t;b[14]=k;b[15]=c;b[16]=t;b[17]=k;b[18]=c;b[19]=d;b[20]=k;b[21]=m;b[22]=d;b[23]=k;return b}function q(){return{center:new Float32Array(3),radius:0}}function e(a,
b){b.center[0]=a.center[0];b.center[1]=a.center[1];b.center[2]=a.center[2];b.radius=a.radius}function n(){return{axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3),center:new Float32Array(3)}}function p(a,b){w.copy(a.axis_x,b.axis_x);w.copy(a.axis_y,b.axis_y);w.copy(a.axis_z,b.axis_z);w.copy(a.center,b.center);return b}function B(a){var b=n();p(a,b);return b}function c(a,b,c,d){return{axis_x:new Float32Array(a),axis_y:new Float32Array(b),axis_z:new Float32Array(c),center:new Float32Array([d[0],
d[1],d[2]])}}function k(a,b){var k=v.calk_average_position(a,t),k=b?v.calc_covariance_matrix(a,k,M):z.identity(M),k=v.find_eigenvectors(k,5E-4,C);w.copy(a,D);w.transformMat3(D,k,D);for(var m=D[0],e=m,f=D[1],h=f,n=D[2],l=n,p=0,A=0,B=0,q=0,y=0,E=0,I=3;I<a.length;I+=3)D[0]=a[I],D[1]=a[I+1],D[2]=a[I+2],w.transformMat3(D,k,D),p=D[0],A=D[1],B=D[2],p>m&&(m=p),p<e&&(e=p),A>f&&(f=A),A<h&&(h=A),B>n&&(n=B),B<l&&(l=B);f-=h;n-=l;m=Math.max(m-e,1E-9);f=Math.max(f,1E-9);n=Math.max(n,1E-9);e=z.identity(M);e[0]=0!=
m?1/m:1E8;e[4]=0!=f?1/f:1E8;e[8]=0!=n?1/n:1E8;z.transpose(k,x);D[0]=a[0];D[1]=a[1];D[2]=a[2];w.transformMat3(D,k,D);w.transformMat3(D,e,D);w.transformMat3(D,x,D);p=D[0];A=D[0];B=D[1];q=D[1];y=D[2];E=D[2];for(I=3;I<a.length;I+=3)D[0]=a[I],D[1]=a[I+1],D[2]=a[I+2],w.transformMat3(D,k,D),w.transformMat3(D,e,D),w.transformMat3(D,x,D),p=Math.max(p,D[0]),A=Math.min(A,D[0]),B=Math.max(B,D[1]),q=Math.min(q,D[1]),y=Math.max(y,D[2]),E=Math.min(E,D[2]);I=Math.sqrt((p-A)*(p-A)+(B-q)*(B-q)+(y-E)*(y-E))/2;I=Math.min(I,
1);d[0]=(p+A)/2;d[1]=(B+q)/2;d[2]=(y+E)/2;p=d;e=z.identity(M);e[0]=m;e[4]=f;e[8]=n;w.transformMat3(p,k,p);w.transformMat3(p,e,p);w.transformMat3(p,x,p);e=[k[0],k[3],k[6]];A=[k[1],k[4],k[7]];k=[k[2],k[5],k[8]];w.scale(e,m*I,e);w.scale(A,f*I,A);w.scale(k,n*I,k);return c(e,A,k,p)}function m(a,b,c){w.add(b,c,a.center);w.scale(a.center,.5,a.center);a.radius=w.distance(a.center,b);return a}var A=r("__tsr"),E=r("__util"),w=r("__vec3"),v=r("__math"),z=r("__mat3"),y=new Float32Array(24),D=new Float32Array(3),
K=new Float32Array(3),d=new Float32Array(3),t=new Float32Array(3),C=new Float32Array(9),M=new Float32Array(9),x=new Float32Array(9);new Float32Array(9);a.create_bb=u;a.create_rot_bb=h;a.copy_bb=b;a.big_bounding_box=function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.zero_bounding_box=function(a){a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.clone_bb=function(a){var c=u();b(a,c);return c};a.calc_min_bb_side=function(a){var b=a.max_x-
a.min_x,c=a.max_y-a.min_y;c<b&&(b=c);a=a.max_z-a.min_z;a<b&&(b=a);return b};a.expand_bounding_box=function(a,b){var c=a.max_y,d=a.max_z,k=a.min_x,m=a.min_y,t=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,k);a.min_y=Math.min(b.min_y,m);a.min_z=Math.min(b.min_z,t);return a};a.bb_from_coords=f;a.bounding_box_transform=function(a,b,c){c||(c=u());a=l(a,y);A.transform_vectors(a,b,a);return f(a,c)};a.extract_bb_corners=l;a.shrink_bounding_box=
function(a,b,c){c||(c=u());var d=b.min_x,k=b.max_x,m=b.min_y,t=b.max_y,e=b.min_z;b=b.max_z;if(d>=a.max_x||k<=a.min_x||m>=a.max_y||t<=a.min_y||e>=a.max_z||b<=a.min_z)return c.min_x=-.1,c.max_x=.1,c.min_y=-.1,c.max_y=.1,c.min_z=-.2,c.max_z=-.1,c;c.min_x=Math.max(a.min_x,d);c.max_x=Math.min(a.max_x,k);c.min_y=Math.max(a.min_y,m);c.max_y=Math.min(a.max_y,t);c.min_z=Math.max(a.min_z,e);c.max_z=Math.min(a.max_z,b);return c};a.stretch_bounding_box=function(a,b,c){c||(c=u());var d=a.max_x-a.min_x,k=a.max_y-
a.min_y,m=a.max_z-a.min_z;c.min_x=a.min_x-.5*(b-1)*d;c.max_x=a.max_x+.5*(b-1)*d;c.min_y=a.min_y-.5*(b-1)*k;c.max_y=a.max_y+.5*(b-1)*k;c.min_z=a.min_z-.5*(b-1)*m;c.max_z=a.max_z+.5*(b-1)*m;return c};a.bounding_sphere_transform=function(a,b,c){c||(c=q());A.transform_vec3(a.center,b,c.center);c.radius=a.radius*A.get_scale(b);return c};a.bounding_ellipsoid_transform=function(a,b,c){c||(c=n());A.transform_vec3(a.center,b,c.center);w.copy(a.axis_x,c.axis_x);w.copy(a.axis_y,c.axis_y);w.copy(a.axis_z,c.axis_z);
A.transform_dir_vec3(c.axis_x,b,c.axis_x);A.transform_dir_vec3(c.axis_y,b,c.axis_y);A.transform_dir_vec3(c.axis_z,b,c.axis_z);return c};a.bounding_rot_box_transform=function(a,b,c){c||(c=h());A.transform_vec3(a.center,b,c.center);w.copy(a.axis_x,c.axis_x);w.copy(a.axis_y,c.axis_y);w.copy(a.axis_z,c.axis_z);A.transform_dir_vec3(c.axis_x,b,c.axis_x);A.transform_dir_vec3(c.axis_y,b,c.axis_y);A.transform_dir_vec3(c.axis_z,b,c.axis_z);return c};a.bs_from_values=function(a,b){var c=q();w.copy(b,c.center);
c.radius=a;return c};a.rot_bb_from_values=function(a,b,c,d,k){var m=h();w.copy(a,m.center);w.copy(b,m.axis_x);w.copy(c,m.axis_y);w.copy(d,m.axis_z);w.scale(m.axis_x,k[0],m.axis_x);w.scale(m.axis_y,k[1],m.axis_y);w.scale(m.axis_z,k[2],m.axis_z);return m};a.create_bs=q;a.copy_bs=e;a.create_be=n;a.copy_be=p;a.clone_be=B;a.clone_bs=function(a){var b=q();e(a,b);return b};a.be_from_values=c;a.big_bounding_sphere=function(a){a||(a=q());w.set(0,0,0,a.center);a.radius=1E12;return a};a.expand_bounding_sphere=
function(a,b){var c=w.subtract(b.center,a.center,w.create());0==w.length(c)&&w.set(1,0,0,c);var d=w.normalize(c,w.create()),c=w.scale(d,a.radius,w.create());w.add(c,a.center,c);var k=w.scale(d,-a.radius,w.create());w.add(k,a.center,k);var m=w.scale(d,b.radius,w.create());w.add(m,b.center,m);var t=w.scale(d,-b.radius,w.create());w.add(t,b.center,t);c=[c,k,m,t];d=w.normalize(d,w.create());k=c[0];m=c[0];for(t=1;t<c.length;t++){var e=w.dot(c[t],d);e<w.dot(k,d)&&(k=c[t]);e>w.dot(m,d)&&(m=c[t])}d=[k,m];
c=d[0];d=d[1];a.center=w.scale(w.add(c,d,w.create()),.5,w.create());a.radius=w.length(w.subtract(d,c,w.create()))/2};a.extract_rot_bb_corners=function(a,b){w.add(a.center,a.axis_y,D);w.add(D,a.axis_x,D);w.add(D,a.axis_z,D);b.push(D[0],D[1],D[2]);w.add(a.center,a.axis_y,D);w.add(D,a.axis_x,D);w.subtract(D,a.axis_z,D);b.push(D[0],D[1],D[2]);w.add(a.center,a.axis_y,D);w.subtract(D,a.axis_x,D);w.add(D,a.axis_z,D);b.push(D[0],D[1],D[2]);w.add(a.center,a.axis_y,D);w.subtract(D,a.axis_x,D);w.subtract(D,
a.axis_z,D);b.push(D[0],D[1],D[2]);w.subtract(a.center,a.axis_y,D);w.add(D,a.axis_x,D);w.add(D,a.axis_z,D);b.push(D[0],D[1],D[2]);w.subtract(a.center,a.axis_y,D);w.add(D,a.axis_x,D);w.subtract(D,a.axis_z,D);b.push(D[0],D[1],D[2]);w.subtract(a.center,a.axis_y,D);w.subtract(D,a.axis_x,D);w.add(D,a.axis_z,D);b.push(D[0],D[1],D[2]);w.subtract(a.center,a.axis_y,D);w.subtract(D,a.axis_x,D);w.subtract(D,a.axis_z,D);b.push(D[0],D[1],D[2])};a.create_be_by_bb=k;a.create_bbr_by_be=function(a){var b=h();w.copy(a.axis_x,
b.axis_x);w.copy(a.axis_y,b.axis_y);w.copy(a.axis_z,b.axis_z);w.copy(a.center,b.center);return b};a.create_bs_by_be=function(a){var b=q(),c=0,c=w.length(a.axis_x),d=w.length(a.axis_y),k=w.length(a.axis_z),c=c>d?c:d;b.center=a.center;b.radius=k>c?k:c;return b};a.calc_be_local_by_tsr=function(a,b){var c=B(a),d=A.get_trans(b,t);w.subtract(c.center,d,c.center);return c};a.is_be_optimized=function(a,b){var c=w.length(a.axis_x),d=w.length(a.axis_y),k=w.length(a.axis_z);return.75*b.radius*b.radius*b.radius>
c*d*k};a.bcap_from_values=function(a,b){var c=b.max_z,d=b.min_z,k=Math.max(0,c-d-2*a);return{radius:a,height:k,center:new Float32Array([0,0,(c+d)/2])}};a.bcyl_from_values=function(a,b){var c=b.max_z,d=b.min_z,k=Math.max(0,c-d);return{radius:a,height:k,center:new Float32Array([0,0,(c+d)/2])}};a.bcon_from_values=function(a,b){var c=b.max_z,d=b.min_z,k=Math.max(0,c-d);return{radius:a,height:k,center:new Float32Array([0,0,(c+d)/2])}};a.check_bb_intersection=function(a,b){return a.min_x>b.max_x||a.max_x<
b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.recalculate_mesh_boundings=function(a){for(var b=0,c=0,d=0,m=0,t=0,e=0,f=0,h=0,n=0,l=0,p=0,A=0,B=0,v=0,I=0;I<a.submeshes.length;I++){var C=a.submeshes[I];if(C.position.length){b=m=C.position[0];c=t=C.position[1];d=e=C.position[2];break}}for(I=0;I<a.submeshes.length;I++){for(var C=a.submeshes[I],x=C.position,f=l=C.position[0],h=p=C.position[1],n=A=C.position[2],w=0;w<x.length/3;w++)var z=x[3*w],q=x[3*w+1],S=x[3*
w+2],b=Math.max(z,b),c=Math.max(q,c),d=Math.max(S,d),m=Math.min(z,m),t=Math.min(q,t),e=Math.min(S,e),f=Math.max(z,f),h=Math.max(q,h),n=Math.max(S,n),l=Math.min(z,l),p=Math.min(q,p),A=Math.min(S,A),B=Math.max(Math.sqrt(z*z+q*q+S*S),B),v=Math.max(Math.sqrt(z*z+q*q),v);x=C.boundings.bb;x.max_x=f;x.min_x=l;x.max_y=h;x.min_y=p;x.max_z=n;x.min_z=A;x=y;x[0]=l;x[1]=p;x[2]=A;x[3]=f;x[4]=p;x[5]=A;x[6]=f;x[7]=h;x[8]=A;x[9]=l;x[10]=h;x[11]=A;x[12]=l;x[13]=p;x[14]=n;x[15]=f;x[16]=p;x[17]=n;x[18]=f;x[19]=h;x[20]=
n;x[21]=l;x[22]=h;x[23]=n;f=k(x,!1);C.boundings.be_cen=f.center;C.boundings.be_ax=[f.axis_x[0],f.axis_y[1],f.axis_z[2]]}I=a.b4w_boundings.bb;I.max_x=b;I.min_x=m;I.max_y=c;I.min_y=t;I.max_z=d;I.min_z=e;I=a.b4w_boundings.bb_src;I.max_x=b;I.min_x=m;I.max_y=c;I.min_y=t;I.max_z=d;I.min_z=e;a.b4w_boundings.bs_rad=B;a.b4w_boundings.bc_rad=v;x=y;x[0]=m;x[1]=t;x[2]=e;x[3]=b;x[4]=t;x[5]=e;x[6]=b;x[7]=c;x[8]=e;x[9]=m;x[10]=c;x[11]=e;x[12]=m;x[13]=t;x[14]=d;x[15]=b;x[16]=t;x[17]=d;x[18]=b;x[19]=c;x[20]=d;x[21]=
m;x[22]=c;x[23]=d;f=k(x,!1);a.b4w_boundings.be_cen=f.center;a.b4w_boundings.be_ax=[f.axis_x[0],f.axis_y[1],f.axis_z[2]]};a.get_frustum_mec=function(a){var b=a.subarray(0,3),c=a.subarray(6,9),k=a.subarray(12,15),t=a.subarray(18,21);a=w.subtract(c,b,D);w.normalize(a,a);var e=E.get_plane_normal(b,c,k,K),e=w.cross(e,a,e);w.normalize(e,e);var f=w.create(),h=w.create();w.subtract(c,b,d);h[0]=w.dot(d,a);h[1]=w.dot(d,e);c=w.create();w.subtract(k,b,d);c[0]=w.dot(d,a);c[1]=w.dot(d,e);k=w.create();w.subtract(t,
b,d);k[0]=w.dot(d,a);k[1]=w.dot(d,e);t=q();k=[f,h,c,k];f=m(t,k[0],k[1]);for(t=2;t<k.length;t++)if(w.distance(f.center,k[t])>f.radius){for(var n=f,f=k,h=k[t],c=t-1,n=m(n,h,f[0]),l=1;l<=c;l++)if(w.distance(n.center,f[l])>n.radius){for(var p=n,n=f,A=h,B=f[l],x=l-1,p=m(p,A,B),v=0;v<=x;v++)if(w.distance(p.center,n[v])>p.radius){var I=A,C=B,z=n[v],y=w.subtract(C,z,d),y=w.squaredLength(y),M=w.subtract(I,z,d),ra=w.squaredLength(M),M=w.subtract(I,C,d),S=w.squaredLength(M),M=y*(ra+S-y),R=ra*(S+y-ra),y=S*(y+
ra-S),ra=M+R+y;w.copy(I,p.center);w.scale(p.center,M/ra,p.center);w.scaleAndAdd(p.center,C,R/ra,p.center);w.scaleAndAdd(p.center,z,y/ra,p.center);p.radius=w.distance(p.center,I)}n=p}f=n}t=f;a=w.scale(a,t.center[0],d);w.scaleAndAdd(a,e,t.center[1],a);w.add(a,b,t.center);return t}};b4w.module.__compat=function(a,r){function u(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function h(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var f=r("__config"),l=r("__debug"),q=r("__extensions"),
e=r("__print"),n=r("__renderer"),p="R600;RV610;RV630;RV620;RV635;RV670;RS780;RS880;RV770;RV730;RV710;RV740;CEDAR;REDWOOD;JUNIPER;CYPRESS;PALM (Wrestler/Ontario);SUMO (Llano);SUMO2 (Llano);ARUBA (Trinity/Richland);BARTS;TURKS;CAICOS;CAYMAN".split(";");a.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE=256;var B=f.animation,c=f.defaults,k=f.context,m=f.context_limits,A=f.sfx,E=f.physics,w=f.assets;a.detect_tegra_invalid_enum_issue=function(a){a.getError()==a.INVALID_ENUM&&e.warn("Possible Tegra invalid enum issue detected, ignoring")};
a.set_hardware_defaults=function(v,z){var y=function(a){z&&e.warn(a)};m.max_combined_texture_image_units=v.getParameter(v.MAX_COMBINED_TEXTURE_IMAGE_UNITS);m.max_fragment_uniform_vectors=v.getParameter(v.MAX_FRAGMENT_UNIFORM_VECTORS);m.max_texture_image_units=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);m.max_varying_vectors=v.getParameter(v.MAX_VARYING_VECTORS);m.max_vertex_attribs=v.getParameter(v.MAX_VERTEX_ATTRIBS);m.max_vertex_texture_image_units=v.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
m.max_vertex_uniform_vectors=v.getParameter(v.MAX_VERTEX_UNIFORM_VECTORS);m.max_cube_map_texture_size=v.getParameter(v.MAX_CUBE_MAP_TEXTURE_SIZE);m.max_renderbuffer_size=v.getParameter(v.MAX_RENDERBUFFER_SIZE);m.max_texture_size=v.getParameter(v.MAX_TEXTURE_SIZE);m.max_viewport_dims=v.getParameter(v.MAX_VIEWPORT_DIMS);c.webgl2?(c.msaa_samples=Math.min(c.msaa_samples,v.getParameter(v.MAX_SAMPLES)),u("Firefox")&&(y("Firefox and WebGL 2 detected, applying framebuffer hack, disabling anchor visibility"),
c.check_framebuffer_hack=!0,c.ff_disable_anchor_vis_hack=!0)):c.msaa_samples=1;u("Firefox")&&"NONE"!==c.stereo&&(y("Firefox and Stereo rendering detected, disable texture reusage"),c.firefox_tex_reuse_hack=!0);if(c.webgl2&&l.check_multisample_issue()||u("Firefox"))y("Firefox detected, disabling multisample"),c.msaa_samples=1;n.set_draw_methods();var D=Boolean(q.get_depth_texture());u("Firefox/28.0")&&(u("Linux")||u("Macintosh"))&&(y("Firefox 28 detected, applying depth hack"),D=!1);u("Windows Phone")||
(u("iPad")||u("iPhone")?(y("iOS detected, applying alpha hack, applying vertex animation mix normals hack, disable smaa. Disable ssao for performance. Initialize WebAudio context with empty sound. Applying glow hack."),k.alpha||(c.background_color[3]=1),c.safari_glow_hack=!0,c.vert_anim_mix_normals_hack=!0,c.smaa=!1,c.ssao=!1,c.precision="highp",c.init_wa_context_hack=!0,Boolean(q.get_pvr())&&w.pvr_available&&(c.compress_format="pvr")):u("Mac OS X")&&u("Safari")&&!u("Chrome")&&(y("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures. Applying canvas alpha hack."),
c.safari_canvas_alpha_hack=!0,A.audio_loading_hack=!0,A.clamp_playback_rate_hack=!0));u("Windows")&&(u("Chrome/40")||u("Firefox/33")||u("Firefox/34")||u("Firefox/35")||u("Firefox/36"))&&(y("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),c.clear_procedural_sky_hack=!0);u("Chrome")&&!h()&&f.is_built_in_data()&&(y('Chrome (non-mobile) was detected for a single HTML-exported file. "Background Music" speakers were changed to "Background Sound".'),c.chrome_html_bkg_music_hack=
!0);u("Mac OS X")&&(c.mac_os_shadow_hack=!0,y("OS X detected, applying shadows hack."));h()&&(y("Mobile detected, applying various hacks for video textures."),c.is_mobile_device=!0,u("iPad")||u("iPhone")||u("Windows Phone")||(y("Mobile (not iOS) detected, disable playback rate for video textures."),A.disable_playback_rate_hack=!0));(u("Firefox/35.0")||u("Firefox/36.0"))&&u("Windows")&&(y("Windows/Firefox 35/36 detected, applying shadows slink hack"),c.shadows_color_slink_hack=!0);if(u("iPhone")||
b()||u("Edge"))y("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),c.seq_video_fallback=!0;10>m.max_varying_vectors&&(y("Not enough varyings, disable shadows on blend objects"),c.disable_blend_shadows_hack=!0);u("Windows Phone")&&(y("Windows Phone detected. Disable debug view mode, glow materials, ssao, smaa, shadows, reflections, refractions."),c.debug_view=!1,c.precision="highp",c.glow_materials=!1,c.ssao=!1,c.smaa=!1,c.shadows=!1,c.reflections=!1,c.refractions=
!1,c.quality_aa_method=!1);if(u("UCBrowser")||(u("Chrome")||u("Firefox"))&&c.is_mobile_device)y("Mobile Firefox, mobile Chrome or UCBrowser detected, disable workers."),E.use_workers=!1;var K=q.get_renderer_info();if(K){var d=v.getParameter(K.UNMASKED_VENDOR_WEBGL),K=v.getParameter(K.UNMASKED_RENDERER_WEBGL),t=/\b4\d{2}\b/;-1<d.indexOf("ARM")&&t.test(K)&&(y("ARM Mali-400 series detected, applying depth and frames blending hacks"),D=!1,B.frames_blending_hack=!0);-1<d.indexOf("ARM")&&-1<K.indexOf("Mali-T604")&&
(y('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),c.precision="highp",c.shadows=!1);-1<d.indexOf("ARM")&&-1<K.indexOf("Mali-T760")&&(y('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),c.precision="highp",c.ssao=!1,c.skinning_hack=!0,c.webgl2&&(c.msaa_samples=1,y("ARM Mali-T760 and WebGL 2 detected, switch MSAA samples to 1.")));-1<d.indexOf("Qualcomm")&&-1<K.indexOf("Adreno")&&(y("Qualcomm Adreno detected, applying shader constants hack."),c.shader_constants_hack=
!0,-1<K.indexOf("305")&&(y('Qualcomm Adreno305 detected, set "highp" precision.'),c.precision="highp"),-1<K.indexOf("330")&&(y('Qualcomm Adreno330 detected, set "highp" precision.'),c.precision="highp"),-1<K.indexOf("420")&&(y("Qualcomm Adreno420 detected, setting max cubemap size to 4096, setting max texture size to 4096."),m.max_texture_size=4096,m.max_cube_map_texture_size=4096));-1<d.indexOf("NVIDIA")&&-1<K.indexOf("Tegra 3")&&(y("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
c.force_low_quality_nodes=!0);u("Windows")&&u("Chrome")&&!u("Edge")&&(K.match(/NVIDIA GeForce 8..0/)||K.match(/NVIDIA GeForce 9..0/)||K.match(/NVIDIA GeForce( (G|GT|GTS|GTX))? 2../))&&(y("Chrome / Windows / NVIDIA GeForce 8/9/200 series detected, setting max cubemap size to 256, use canvas for resizing."),m.max_cube_map_texture_size=a.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE,c.resize_cubemap_canvas_hack=!0);-1<K.indexOf("PowerVR")&&(y("PowerVR series detected, use canvas for resizing. Disable shadows. Apply skinning hack, disable skin blending between frames."),
c.resize_cubemap_canvas_hack=!0,c.skinning_hack=!0,c.shadows=!1);d="";for(t=0;t<p.length;t++)if(-1<K.indexOf(p[t])){d=p[t];break}d&&(y("Architecture "+d+" detected. Blending between frames and shadows on blend objects will be disabled."),c.skinning_hack=!0,c.disable_blend_shadows_hack=!0)}0==m.max_vertex_texture_image_units&&(y("Vertex textures are not allowed. Disabling vertex textures"),c.allow_vertex_textures=!1);D||(c.foam=!1,c.dynamic_grass=!1,c.water_dynamic=!1,c.shore_smoothing=!1,c.shore_distance=
!1,c.smaa=!1);c.use_compression=Boolean(q.get_s3tc())||"pvr"==c.compress_format;c.depth_tex_available=D;if(v.getShaderPrecisionFormat)var C=v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.HIGH_FLOAT);v.getShaderPrecisionFormat&&0!==C.precision||(c.precision="mediump");if(b()&&u("Touch")||u("Edge"))y("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),c.ie11_edge_touchscreen_hack=!0;if(b()||u("Edge"))c.ie_edge_anchors_floor_hack=!0;h()&&u("Firefox")&&(e.log("Mobile firefox detected. Applying autoplay media hack.Setting max cubemap size to 4096, setting max texture size to 4096."),
c.mobile_firefox_media_hack=!0,m.max_texture_size=4096,m.max_cube_map_texture_size=4096);u("Edge")&&(y("Microsoft Edge detected, set up new minimal texture size."),c.edge_min_tex_size_hack=!0)};a.check_user_agent=u;a.detect_mobile=h;a.apply_context_alpha_hack=function(){u("Firefox/35.0")&&u("Windows")&&(e.warn("Windows/Firefox 35 detected, forcing context's alpha"),f.context.alpha=!0)};a.is_ie11=b};b4w.module.__constraints=function(a,r){function u(a){var b={};b.type=a;return b}function h(a,c){a.constraint&&a.constraint.obj_parent&&b(a.constraint.obj_parent,a);if(c.obj_parent){var d=c.obj_parent;-1==d.cons_descends.indexOf(a)?d.cons_descends.push(a):A.panic("Descendant object override is forbidden")}a.constraint=c}function b(a,b){var c=a.cons_descends.indexOf(b);-1!=c?a.cons_descends.splice(c,1):A.panic("No descendant object")}function f(a,b,c){switch(b.type){case 1:var f=m.get_quat_view(a.render.world_tsr),
h=b.obj_parent.render.world_tsr;c=m.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(k.copy(b.rotation_offset,f),k.multiply(c,f,f)):k.copy(c,f);var l=m.transform_vec3(b.offset,h,z);m.set_trans(l,a.render.world_tsr);l=m.get_scale(b.obj_parent.render.world_tsr);m.set_scale(b.scale_offset*l,a.render.world_tsr);break;case 9:l=m.get_trans_view(a.render.world_tsr);f=m.get_quat_view(a.render.world_tsr);h=b.obj_parent.render.world_tsr;c=m.get_quat_view(b.obj_parent.render.world_tsr);k.multiply(k.invert(b.parent_prev_rotation,
b.parent_prev_rotation),f,f);k.multiply(c,f,f);m.transform_vec3(b.offset,h,l);k.copy(c,b.parent_prev_rotation);break;case 10:l=m.get_trans_view(a.render.world_tsr);f=m.get_quat_view(a.render.world_tsr);h=b.obj_parent.render.world_tsr;c=m.get_quat_view(b.obj_parent.render.world_tsr);k.multiply(k.invert(b.parent_prev_rotation,b.parent_prev_rotation),f,f);k.multiply(c,f,f);m.transform_vec3(b.offset,h,l);k.copy(c,b.parent_prev_rotation);l=m.get_quat_view(a.render.world_tsr);f=m.get_quat_view(b.obj_parent.render.world_tsr);
f=k.multiply(f,b.rotation_offset,d);f=p.get_camera_angles_from_quat(f,w);c=p.get_camera_angles_from_quat(l,v);l=A.calc_returning_angle(c[0],f[0]+b.clamp_right,f[0]+b.clamp_left);f=A.calc_returning_angle(c[1],f[1]+b.clamp_down,f[1]+b.clamp_up);p.rotate_eye_camera(a,l,f);break;case 13:var l=m.get_trans_view(a.render.world_tsr),f=m.get_quat_view(a.render.world_tsr),h=b.obj_parent.render.world_tsr,y=m.get_trans_view(h),Q=b.softness,T=z,W=d;m.transform_vec3(b.offset,h,T);A.smooth_v(T,l,c,Q,l);h=z;E.sub(y,
l,h);E.normalize(h,h);var D=f,l=t,y=l.subarray(0,3),T=l.subarray(3,6),Y=l.subarray(6,9);E.copy(h,Y);E.negate(Y,Y);E.normalize(Y,Y);Boolean(.999999<Math.abs(E.dot(h,A.AXIS_Z)))?(h=B.fromQuat(k.normalize(D,W),C),E.copy(h.subarray(0,3),y)):E.cross(A.AXIS_Z,Y,y);E.normalize(y,y);E.cross(Y,y,T);E.normalize(T,T);k.fromMat3(l,W);k.normalize(W,W);A.smooth_q(W,f,c,.16*Q,f);break;case 2:f=m.get_quat_view(a.render.world_tsr);c=M;n.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,c);m.multiply(b.obj_parent.render.world_tsr,
c,c);f[0]=c[4];f[1]=c[5];f[2]=c[6];f[3]=c[7];b.rotation_offset&&(k.copy(b.rotation_offset,f),k.multiply(f,b.rotation_offset,f));m.set_scale(b.scale_offset*c[3],a.render.world_tsr);l=m.get_trans_view(a.render.world_tsr);m.transform_vec3(b.offset,c,l);break;case 3:l=m.get_trans_view(a.render.world_tsr);f=m.get_quat_view(a.render.world_tsr);c=m.get_trans_view(b.obj_parent.render.world_tsr);q(l,f,c);break;case 4:l=m.get_trans_view(a.render.world_tsr);f=m.get_quat_view(a.render.world_tsr);c=b.target;q(l,
f,c);break;case 5:l=m.get_trans_view(a.render.world_tsr);f=m.get_quat_view(a.render.world_tsr);c=m.get_trans_view(b.obj_parent.render.world_tsr);q(l,f,c);f=E.dist(l,c);if(f=f>b.dist_max?f-b.dist_max:f<b.dist_min?f-b.dist_min:0)E.sub(c,l,z),E.normalize(z,z),E.scale(z,f,z),E.add(l,z,l);break;case 6:l=m.get_trans_view(a.render.world_tsr);f=m.get_quat_view(a.render.world_tsr);c=b.target;q(l,f,c);f=E.dist(l,c);if(f=f>b.dist_max?f-b.dist_max:f<b.dist_min?f-b.dist_min:0)E.sub(c,l,z),E.normalize(z,z),E.scale(z,
f,z),E.add(l,z,l);break;case 7:h=b.obj_parent.render.world_tsr;l=m.get_trans_view(a.render.world_tsr);m.transform_vec3(b.offset,h,l);break;case 8:y=m.get_trans_view(b.obj_parent.render.world_tsr);l=m.get_trans_view(a.render.world_tsr);E.add(y,b.offset,l);break;case 14:f=m.get_quat_view(a.render.world_tsr);h=b.obj_parent.render.world_tsr;c=m.get_quat_view(b.obj_parent.render.world_tsr);b.rotation_offset?(k.copy(b.rotation_offset,f),k.multiply(c,f,f)):k.copy(c,f);l=m.get_trans_view(a.render.world_tsr);
m.transform_vec3(b.offset,h,l);break;case 11:m.multiply(b.obj_parent.render.world_tsr,b.tsr_offset,a.render.world_tsr);break;case 12:l=b.tsr_offset;c=M;n.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,c);m.multiply(b.obj_parent.render.world_tsr,c,c);m.multiply(c,l,a.render.world_tsr);break;case 15:f=b.obj_parent,c=p.get_first_cam(f),l=m.get_trans_view(a.render.world_tsr),h=p.get_edge(c,"LEFT"),y=p.get_edge(c,"RIGHT"),Q=p.get_edge(c,"TOP"),W=p.get_edge(c,"BOTTOM"),T="heights"==b.hor_units?Q-W:y-h,b.left_edge?
(h=p.get_edge(c,"LEFT"),l[0]=h+T*b.left_right_dist):(y=p.get_edge(c,"RIGHT"),l[0]=y-T*b.left_right_dist),h="heights"==b.vert_units?Q-W:y-h,l[1]=b.top_edge?Q-h*b.top_bottom_dist:W+h*b.top_bottom_dist,p.is_ortho(c)?l[2]=-b.distance:(l[2]=-1,E.normalize(l,l),c=b.distance/Math.abs(l[2]),E.scale(l,c,l)),m.transform_dir_vec3(l,f.render.world_tsr,l),c=m.get_trans_view(f.render.world_tsr),E.add(c,l,l),l=m.get_quat_view(a.render.world_tsr),f=m.get_quat_view(f.render.world_tsr),b.rotation_offset?(k.copy(b.rotation_offset,
l),k.multiply(f,l,l)):k.copy(f,l)}"CAMERA"==a.render.type&&(l=a.render.vertical_axis,10==b.type&&(c=m.get_quat_view(b.obj_parent.render.world_tsr),l=E.transformQuat(l,c,x)),p.update_camera_upside_down(a),e(a,l))}function l(a,b){switch(b.type){case 1:var c=b.target.render.world_tsr,d=M;m.invert(a.render.world_tsr,d);m.multiply(d,c,d);n.set_bone_tsr(a,b.bone_name,d,!1)}a.need_update_transform=!0}function q(a,b,c){var d=z;A.quat_to_dir(b,A.AXIS_MZ,d);E.normalize(d,d);var m=y;E.subtract(c,a,m);E.normalize(m,
m);a=A.rotation_to_stable(d,m,K);k.multiply(a,b,b);k.normalize(b,b)}function e(a,b,c){var t=a.render,e=m.get_quat_view(t.world_tsr),f=A.quat_to_dir(e,A.AXIS_Z,z);E.normalize(f,f);if(.999999<Math.abs(E.dot(b,f)))f=k.identity(d);else{var h=E.cross(b,f,y);E.normalize(h,h);t.move_style==p.MS_TARGET_CONTROLS?t.target_cam_upside_down&&E.negate(h,h):(t=A.quat_to_dir(e,A.AXIS_MY,D),0<E.dot(t,b)&&E.negate(h,h));t=A.quat_to_dir(e,A.AXIS_X,D);E.normalize(t,t);var n=A.clamp(E.dot(t,h),-1,1);-.999999>=n?(h=Math.acos(n),
f=k.setAxisAngle(f,h,d)):f=k.rotationTo(t,h,d);k.normalize(f,f)}k.multiply(f,e,e);c&&(c=A.quat_to_dir(e,A.AXIS_Y,z),0>E.dot(b,c)&&k.rotateZ(e,Math.PI,e));p.update_camera_upside_down(a)}var n=r("__armature"),p=r("__camera"),B=r("__mat3"),c=r("__print"),k=r("__quat"),m=r("__tsr"),A=r("__util"),E=r("__vec3");a.CONS_TYPE_STIFF_OBJ=1;a.CONS_TYPE_STIFF_BONE=2;a.CONS_TYPE_TRACK_OBJ=3;a.CONS_TYPE_TRACK_POINT=4;a.CONS_TYPE_FOLLOW_OBJ=5;a.CONS_TYPE_FOLLOW_POINT=6;a.CONS_TYPE_STIFF_TRANS_OBJ=7;a.CONS_TYPE_COPY_TRANS_OBJ=
8;a.CONS_TYPE_SEMI_STIFF_OBJ=9;a.CONS_TYPE_SEMI_STIFF_CAM_OBJ=10;a.CONS_TYPE_CHILD_OF=11;a.CONS_TYPE_CHILD_OF_BONE=12;a.CONS_TYPE_SEMI_SOFT_CAM_OBJ=13;a.CONS_TYPE_STIFF_TRANS_ROT_OBJ=14;a.CONS_TYPE_STIFF_VIEWPORT=15;a.BONE_CONS_TYPE_STIFF_OBJ=1;var w=new Float32Array(2),v=new Float32Array(2),z=new Float32Array(3),y=new Float32Array(3),D=new Float32Array(3),K=new Float32Array(4),d=new Float32Array(4),t=new Float32Array(9),C=new Float32Array(9),M=m.create(),x=new Float32Array(3);a.append_stiff_obj=
function(a,b,c,d,k){var m=u(1);m.obj_parent=b;m.offset=new Float32Array(c);m.rotation_offset=d?new Float32Array(d):null;m.scale_offset=k;h(a,m);f(a,m,0)};a.append_stiff_bone=function(a,b,c,d,k,m){var t=u(2);t.obj_parent=b;t.bone_name=c;t.offset=new Float32Array(d);t.rotation_offset=k?new Float32Array(k):null;t.scale_offset=m;h(a,t);f(a,t,0)};a.append_semi_stiff_obj=function(a,b,c,d){var t=u(9),e=m.get_quat_view(a.render.world_tsr),n=m.get_quat_view(b.render.world_tsr);t.obj_parent=b;t.offset=new Float32Array(c);
t.parent_prev_rotation=new Float32Array(n);d&&(k.copy(d,e),k.multiply(n,e,e));h(a,t);f(a,t,0)};a.append_semi_stiff_cam_obj=function(a,b,c,d,t,e,n,l){var p=u(10),B=m.get_quat_view(a.render.world_tsr),x=m.get_quat_view(b.render.world_tsr);p.obj_parent=b;p.offset=new Float32Array(c);p.parent_prev_rotation=new Float32Array(x);p.clamp_left=A.angle_wrap_0_2pi(t);p.clamp_right=A.angle_wrap_0_2pi(e);p.clamp_up=A.angle_wrap_periodic(n,-Math.PI,Math.PI);p.clamp_down=A.angle_wrap_periodic(l,-Math.PI,Math.PI);
d?(p.rotation_offset=new Float32Array(d),k.copy(d,B),k.multiply(x,B,B)):p.rotation_offset=k.create();h(a,p);f(a,p,0)};a.append_semi_soft_cam_obj=function(a,b,c,d){var k=u(13);k.obj_parent=b;k.offset=new Float32Array(c);k.softness=d;h(a,k);f(a,k,0)};a.append_stiff_trans_rot_obj=function(a,b,c,d,k){var m=u(14);m.obj_parent=b;m.offset=new Float32Array(c);m.scale_offset=k||1;m.rotation_offset=d?new Float32Array(d):null;h(a,m);f(a,m,0)};a.remove_parent_descendant=b;a.append_track_obj=function(a,b){var c=
u(3);c.obj_parent=b;h(a,c);f(a,c,0)};a.append_track_point=function(a,b){var c=u(4);c.target=new Float32Array(b);h(a,c);f(a,c,0)};a.append_follow_obj=function(a,b,c,d){var k=u(5);k.obj_parent=b;k.dist_min=c;k.dist_max=d;h(a,k);f(a,k,0)};a.append_follow_point=function(a,b,c,d){var k=u(6);k.target=new Float32Array(b);k.dist_min=c;k.dist_max=d;h(a,k);f(a,k,0)};a.append_stiff_trans_obj=function(a,b,c){var d=u(7);d.obj_parent=b;d.offset=new Float32Array(c);h(a,d);f(a,d,0)};a.append_copy_trans_obj=function(a,
b,c){var d=u(8);d.obj_parent=b;d.offset=new Float32Array(c);h(a,d);f(a,d,0)};a.append_child_of=function(a,b,c){var d=u(11);d.obj_parent=b;d.tsr_offset=new Float32Array(c);h(a,d);f(a,d,0)};a.append_child_of_bone=function(a,b,c,d){var k=u(12);k.obj_parent=b;k.bone_name=c;k.tsr_offset=new Float32Array(d);h(a,k);f(a,k,0)};a.append_stiff_viewport=function(a,b,d){var k=u(15);k.obj_parent=b;if(A.isdef(d.left))k.left_edge=!0,k.left_right_dist=d.left;else if(A.isdef(d.right))k.left_edge=!1,k.left_right_dist=
d.right;else{c.error("append_stiff_viewport: Wrong positioning params");return}if(A.isdef(d.top))k.top_edge=!0,k.top_bottom_dist=d.top;else if(A.isdef(d.bottom))k.top_edge=!1,k.top_bottom_dist=d.bottom;else{c.error("append_stiff_viewport: Wrong positioning params");return}A.isdef(d.distance)?(k.distance=d.distance,A.isdef(d.rotation)?k.rotation_offset=new Float32Array(d.rotation):k.rotation_offset=null,A.isdef(d.hor_units)?k.hor_units=d.hor_units:k.hor_units="widths",A.isdef(d.vert_units)?k.vert_units=
d.vert_units:k.vert_units="heights",h(a,k),f(a,k,0)):c.error("append_stiff_viewport: Wrong positioning params")};a.update_constraint=function(a,b){a.constraint&&f(a,a.constraint,b)};a.append_stiff_bone_to_obj=function(a,b,c,d,k,m){var t=u(1);t.bone_name=c;t.target=b;t.offset=new Float32Array(d);t.rotation_offset=k?new Float32Array(k):null;t.scale_offset=m;b=t.target;c=t.bone_name;d=a.render.bone_pointers[c];k=b.cons_armat_bone_descends;for(m=0;m<k;m++){var e=k[m];if(e[0]==a&&e[1]==c){k.splice(m,1);
break}}b.cons_armat_bone_descends.push([a,c]);d.constraint=t;l(a,t)};a.update_bone_constraint=function(a,b){var c=a.render.bone_pointers[b];c.constraint&&l(a,c.constraint)};a.rotate_to=q;a.correct_up=e;a.check_constraint=function(a){return a.constraint?!0:!1};a.remove=function(a){a.constraint.obj_parent&&b(a.constraint.obj_parent,a);a.constraint=null};a.get_type=function(a){return a.constraint?a.constraint.type:null};a.has_child_of=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?!1:!0};
a.get_child_of_parent_tsr=function(a){if((a=a.constraint)&&11==a.type)return a.obj_parent.render.world_tsr;if(a&&12==a.type){var b=M;n.get_bone_tsr(a.obj_parent,a.bone_name,!0,!1,b);m.multiply(a.obj_parent.render.world_tsr,b,b);return b}return null};a.get_child_of_offset=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?null:a.tsr_offset}};b4w.module.__container=function(a,r){var u,h,b,f,l;function q(a,b){u=a;h=b}function e(){var a=t.getBoundingClientRect();q(a.left,a.top)}function n(){return D.allow_hidpi&&2<=window.devicePixelRatio?!0:!1}function p(b,c,e){if(!b||!c){b=a.DEFAULT_CANVAS_W;c=a.DEFAULT_CANVAS_H;var f=M;f.style.width=a.DEFAULT_CANVAS_W+"px";f.style.height=a.DEFAULT_CANVAS_H+"px"}var f=t,h=C;!1!==e&&(f.style.width=b+"px",f.style.height=c+"px",h&&(h.style.width=b+"px",h.style.height=c+"px"));h&&(h.width=b,h.height=c,m.update_dim());
e=Math.floor(b*D.canvas_resolution_factor);c=Math.floor(c*D.canvas_resolution_factor);n()&&(e*=window.devicePixelRatio,c*=window.devicePixelRatio);if(h=w.get_main())h=h._render,e=Math.floor(e*h.resolution_factor),c=Math.floor(c*h.resolution_factor);f.width=e;f.height=c;var h=Math.min(d.drawingBufferWidth,K.max_renderbuffer_size,K.max_viewport_dims[0]),l=Math.min(d.drawingBufferHeight,K.max_renderbuffer_size,K.max_viewport_dims[1]);if(e>h||c>l)E.warn("Canvas size exceeds platform limits, downscaling"),
h=Math.min(h/e,l/c),e*=h,c*=h,f.width=e,f.height=c;w.setup_dim(e,c,e/b);w.check_active()&&z.update_transform(w.get_active()._camera);k.update_media_controls(f.width,f.height);k.is_primary_loaded()&&(B.update(),w.update(v.get_timeline(),0),B.update_visibility())}var B=r("__anchors"),c=r("__config"),k=r("__data"),m=r("__hud"),A=r("__input"),E=r("__print"),w=r("__scenes"),v=r("__time"),z=r("__transform"),y=r("__util"),D=c.defaults,K=c.context_limits,d=null,t=null,C=null,M=null,x=!1;f=b=0;l=1;u=h=0;a.DEFAULT_CANVAS_W=
320;a.DEFAULT_CANVAS_H=240;a.setup_context=function(a){d=a};a.get_canvas=function(){return t};a.get_canvas_hud=function(){return C};a.get_container=function(){return M};a.init=function(a,b){a&&a.parentNode?(t=a,C=b,M=a.parentNode):y.panic("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":M.insertBefore(a,M.firstElementChild);break;case "JUST_BEFORE_CANVAS":M.insertBefore(a,t);break;case "JUST_AFTER_CANVAS":t.nextElementSibling?M.insertBefore(a,
t.nextElementSibling):M.appendChild(a,t);break;case "LAST":M.appendChild(a,t);break;default:E.error(b+" invalid stack order")}};a.get_viewport_width=function(){return b};a.get_viewport_height=function(){return f};a.set_canvas_offsets=q;a.update_canvas_offsets=e;a.setup_viewport_dim=function(a,c,d){b=a;f=c;l=d;e()};a.force_offsets_updating=function(){x=!0};a.client_to_canvas_coords=function(a,b,c){c||(c=new Float32Array(2));var d=c;x&&(e(),x=!1);d[0]=a-u;a=c;x&&(e(),x=!1);a[1]=b-h;return c};a.canvas_to_viewport_coords=
function(a,c,d,k){d||(d=new Float32Array(2));d[0]=a*l;d[1]=c*l;k&&(a=k.width/b,d[0]*=a,d[1]*=a);return d};a.viewport_to_canvas_coords=function(a,c,d,k){d||(d=new Float32Array(2));d[0]=a/l;d[1]=c/l;k&&(a=k.width/b,d[0]/=a,d[1]/=a);return d};a.is_child=function(b){return b&&b.parentNode?b.parentNode==M?!0:a.is_child(b.parentNode):!1};a.is_hidpi=n;a.find_script=function(a){var b=document.getElementsByTagName("script");a=y.normpath_preserve_protocol(a);for(var c=0;c<b.length;c++)if(b[c].src==a)return b[c];
return null};a.resize=p;a.resize_to_container=function(a){var b=M,c=t,d=b.clientWidth,b=b.clientHeight;if(a||d!=c.clientWidth||b!=c.clientHeight)(a="HMD"===D.stereo&&A.get_webvr_display())&&a.isPresenting||p(d,b,!0)};a.reset=function(){M=C=t=d=null}};b4w.module.__controls=function(a,r){function u(a,b){b||(b=k.get_container());return{type:a,value:0,payload:null,element:b,do_activation:!1,key:0,collision_id:"",calc_pos_norm:!1,collision_obj:null,collision_cb:function(){},col_imp_obj:null,col_imp_cb:function(){},source_object:null,from:new Float32Array(3),to:new Float32Array(3),is_binary_value:!1,ign_src_rot:!1,ray_test_id:0,ray_test_cb:function(){},axis:"",time_last:0,trans_last:new Float32Array(3),quat_last:new Float32Array(4),threshold:0,quat_temp:new Float32Array(4),
avg_linear_vel:0,avg_angular_vel:0,rotation_threshold:0,avg_vertical_vel:0,period:0,repeat:!1,enable_toggle_switch:!1,gamepad_id:0,callback:function(){}}}function h(a){function b(){return{coord:new Float32Array(2),is_updated:!0,obj:null,identifier:-1,is_released:!0}}a||(a=k.get_container());for(var c=0;c<H.length;c++){var g=H[c];if(a==g.element)return g}g={element:a,is_updated_keyboard:!0,is_mouse_downed:!1,is_touch_ended:!0,mouse_last_x:0,mouse_last_y:0,mouse_curr_x:0,mouse_curr_y:0,touches_last_x:new Float32Array(2),
touches_curr_x:new Float32Array(2),touches_last_y:new Float32Array(2),touches_curr_y:new Float32Array(2),touch_zoom_curr_dist:0,touch_zoom_last_dist:0,touch_start_rot:0,downed_keys:new Uint8Array(256),wheel_delta:0,global_selected_obj:null,mouse_select_data:b(),touch_select_dlist:Array(10),is_updated_gyro_quat:!1,gyro_quat:v.create(),gyro_gamma_new:0,gyro_beta_new:0,gyro_alpha_new:0,gyro_gamma_last:0,gyro_beta_last:0,gyro_alpha_last:Infinity,orientation_quat_cb:null,orientation_angles_cb:null,mouse_wheel_cb:null,
mouse_down_which_cb:null,mouse_select_cb:null,touch_select_start_cb:null,touch_select_end_cb:null,mouse_up_which_cb:null,mouse_location_cb:null,keyboard_downed_keys_cb:null,touch_start_cb:null,touch_move_cb:null,touch_end_cb:null,registered_accum_values:{}};for(c=0;10>c;++c)g.touch_select_dlist[c]=b();g.orientation_quat_cb=function(a){g.is_updated_gyro_quat||(m.gyro_angles_to_quat(a,g.gyro_quat),g.is_updated_gyro_quat=!0)};g.orientation_angles_cb=function(a){a=K.copy(a,L);g.gyro_alpha_new=a[0];g.gyro_beta_new=
a[1];g.gyro_gamma_new=a[2];Infinity==g.gyro_alpha_last&&(g.gyro_alpha_last=a[0],g.gyro_beta_last=a[1],g.gyro_gamma_last=a[2])};g.mouse_wheel_cb=function(a){g.wheel_delta+=a*d.mouse_wheel_notch_multiplier};g.mouse_down_which_cb=function(a){var b=m.get_device_by_type_element(m.DEVICE_MOUSE,g.element),b=m.get_vector_param(b,m.MOUSE_LOCATION,G);g.mouse_last_x=b[0];g.mouse_last_y=b[1];g.mouse_curr_x=b[0];g.mouse_curr_y=b[1];g.is_mouse_downed=!0;g.which=a};g.mouse_select_cb=function(a){a=m.get_device_by_type_element(m.DEVICE_MOUSE,
g.element);a=m.get_vector_param(a,m.MOUSE_LOCATION,G);a=k.client_to_canvas_coords(a[0],a[1],G);g.mouse_select_data.is_updated=!1;g.mouse_select_data.coord[0]=a[0];g.mouse_select_data.coord[1]=a[1]};g.touch_select_start_cb=function(a){for(var b=0;b<a.length;++b){for(var c=a[b],d=null,m=null,t=0;t<g.touch_select_dlist.length;t++){var e=g.touch_select_dlist[t];if(e.identifier==c.identifier){e.is_released&&(m=e);break}else!d&&e.is_released&&(d=e,d.identifier=c.identifier)}if(c=m||d)d=k.client_to_canvas_coords(a[b].clientX,
a[b].clientY,G),c.is_updated=!1,c.is_released=!1,c.coord[0]=d[0],c.coord[1]=d[1]}};g.touch_select_end_cb=function(a){for(var b=0;b<g.touch_select_dlist.length;++b){for(var c=g.touch_select_dlist[b],d=!1,k=0;k<a.length;++k)if(a[k].identifier==c.identifier){d=!0;break}d||(c.is_updated=!0,c.is_released=!0,c.obj=null)}};g.mouse_up_which_cb=function(a){g.is_mouse_downed=!1};g.mouse_location_cb=function(a){if(!t.ie11_edge_touchscreen_hack||g.is_mouse_downed)g.mouse_curr_x=a[0],g.mouse_curr_y=a[1]};g.keyboard_down_keys_cb=
function(a){2!=g.downed_keys[a]&&(g.downed_keys[a]=1,g.is_updated_keyboard=!1)};g.keyboard_down_mod_keys_cb=function(a){for(a=0;a<g.downed_keys.length;a++)0!=g.downed_keys[a]&&(g.downed_keys[a]=3,g.is_updated_keyboard=!1)};g.keyboard_up_keys_cb=function(a){1==g.downed_keys[a]?g.downed_keys[a]=0:(g.is_updated_keyboard&=0,g.downed_keys[a]=3)};g.touch_start_cb=function(a){g.is_touch_ended=!1;if(1==a.length)g.touches_last_x[0]=a[0].clientX,g.touches_last_x[1]=-1,g.touches_last_y[0]=a[0].clientY,g.touches_last_y[1]=
-1;else if(1<a.length){var b=p(a);g.touch_zoom_curr_dist=g.touch_zoom_last_dist=b;g.touches_last_x[0]=a[0].clientX;g.touches_last_x[1]=a[1].clientX;g.touches_last_y[0]=a[0].clientY;g.touches_last_y[1]=a[1].clientY;var b=g,c=a[0];a=a[1];a=Math.atan2(c.clientY-a.clientY,c.clientX-a.clientX);b.touch_start_rot=a}g.touches_curr_x.set(g.touches_last_x);g.touches_curr_y.set(g.touches_last_y)};g.touch_move_cb=function(a){1===a.length?(g.touches_curr_x[0]=a[0].clientX,g.touches_curr_x[1]=-1,g.touches_curr_y[0]=
a[0].clientY,g.touches_curr_y[1]=-1):1<a.length&&(g.touches_curr_x[0]=a[0].clientX,g.touches_curr_x[1]=a[1].clientX,g.touches_curr_y[0]=a[0].clientY,g.touches_curr_y[1]=a[1].clientY,a=p(a),g.touch_zoom_curr_dist=a)};g.touch_end_cb=function(a){0==a.length&&(g.is_touch_ended=!0)};H.push(g);return g}function b(a,b){if(b in a.registered_accum_values&&0<a.registered_accum_values[b])a.registered_accum_values[b]+=1;else switch(a.registered_accum_values[b]=1,b){case "orientation_quat":var c=m.get_device_by_type_element(m.DEVICE_GYRO);
c&&m.attach_param_cb(c,m.GYRO_ORIENTATION_ANGLES,a.orientation_quat_cb);break;case "orientation_angles":(c=m.get_device_by_type_element(m.DEVICE_GYRO))&&m.attach_param_cb(c,m.GYRO_ORIENTATION_ANGLES,a.orientation_angles_cb);break;case "mouse_wheel":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.attach_param_cb(c,m.MOUSE_WHEEL,a.mouse_wheel_cb);break;case "mouse_down_which":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.attach_param_cb(c,m.MOUSE_DOWN_WHICH,a.mouse_down_which_cb);
break;case "mouse_select":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.attach_param_cb(c,m.MOUSE_DOWN_WHICH,a.mouse_select_cb);break;case "touch_select":if(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))m.attach_param_cb(c,m.TOUCH_START,a.touch_select_start_cb),m.attach_param_cb(c,m.TOUCH_END,a.touch_select_end_cb);break;case "mouse_up_which":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.attach_param_cb(c,m.MOUSE_UP_WHICH,a.mouse_up_which_cb);break;case "mouse_location":(c=
m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.attach_param_cb(c,m.MOUSE_LOCATION,a.mouse_location_cb);break;case "keyboard_downed_keys":if(c=m.get_device_by_type_element(m.DEVICE_KEYBOARD,a.element))m.attach_param_cb(c,m.KEYBOARD_DOWN,a.keyboard_down_keys_cb),m.attach_param_cb(c,m.KEYBOARD_DOWN_MODIFIED,a.keyboard_down_mod_keys_cb),m.attach_param_cb(c,m.KEYBOARD_UP,a.keyboard_up_keys_cb);break;case "touch_start":(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))&&m.attach_param_cb(c,
m.TOUCH_START,a.touch_start_cb);break;case "touch_move":(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))&&m.attach_param_cb(c,m.TOUCH_MOVE,a.touch_move_cb);break;case "touch_end":(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))&&m.attach_param_cb(c,m.TOUCH_END,a.touch_end_cb)}}function f(a,b){if(!(!b in a.registered_accum_values)&&0<a.registered_accum_values[b]&&(--a.registered_accum_values[b],!a.registered_accum_values[b]))switch(b){case "orientation_quat":var c=m.get_device_by_type_element(m.DEVICE_GYRO);
c&&m.detach_param_cb(c,m.GYRO_ORIENTATION_QUAT,a.orientation_quat_cb);break;case "orientation_angles":(c=m.get_device_by_type_element(m.DEVICE_GYRO))&&m.detach_param_cb(c,m.GYRO_ORIENTATION_ANGLES,a.orientation_angles_cb);break;case "mouse_wheel":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.detach_param_cb(c,m.MOUSE_WHEEL,a.mouse_wheel_cb);break;case "mouse_down_which":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.detach_param_cb(c,m.MOUSE_DOWN_WHICH,a.mouse_down_which_cb);
break;case "mouse_select":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.detach_param_cb(c,m.MOUSE_DOWN_WHICH,a.mouse_select_cb);break;case "touch_select":if(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))m.detach_param_cb(c,m.TOUCH_START,a.touch_select_start_cb),m.detach_param_cb(c,m.TOUCH_END,a.touch_select_end_cb);break;case "mouse_up_which":(c=m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.detach_param_cb(c,m.MOUSE_UP_WHICH,a.mouse_up_which_cb);break;case "mouse_location":(c=
m.get_device_by_type_element(m.DEVICE_MOUSE,a.element))&&m.detach_param_cb(c,m.MOUSE_LOCATION,a.mouse_location_cb);break;case "keyboard_downed_keys":if(c=m.get_device_by_type_element(m.DEVICE_KEYBOARD,a.element))m.detach_param_cb(c,m.KEYBOARD_DOWN,a.keyboard_down_keys_cb),m.detach_param_cb(c,m.KEYBOARD_DOWN_MODIFIED,a.keyboard_down_mod_keys_cb),m.detach_param_cb(c,m.KEYBOARD_UP,a.keyboard_up_keys_cb);break;case "touch_start":(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))&&m.detach_param_cb(c,
m.TOUCH_START,a.touch_start_cb);break;case "touch_move":(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))&&m.detach_param_cb(c,m.TOUCH_MOVE,a.touch_move_cb);break;case "touch_end":(c=m.get_device_by_type_element(m.DEVICE_TOUCH,a.element))&&m.detach_param_cb(c,m.TOUCH_END,a.touch_end_cb)}}function l(a,b){a.value=Number(b)}function q(a){for(var b=a.sensors,c=a.sensor_values,g=0;g<b.length;g++)c[g]=b[g].value;return a.logic_fun(c)}function e(a,b){a=a||M;var c=a.sensor_manifolds;if(c){var d=
a.sensor_manifolds_arr;if(b){var k=c[b];if(k){for(var m=k.sensors,t=0;t<m.length;t++){var f=m[t],h;h=g;var l=x.indexOf(f);h=-1<l?h[l]:[];1==h.length?(n(f),f=x.indexOf(f),-1<f?(x.splice(f,1),g.splice(f,1)):D.panic("Sensors cache is corrupted")):1<h.length&&h.splice(h.indexOf(k),1)}delete c[b];t=d.indexOf(k);-1<t?d.splice(t,1):D.panic("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||(c=C.indexOf(a),-1<c?C.splice(c,1):E.error("Wrong object"))}}else{d=[];for(b in c)d.push(b);for(t=0;t<
d.length;t++)e(a,d[t])}U=!0}}function n(a){switch(a.type){case 90:w.remove_collision_test(a.collision_obj,a.collision_id,a.collision_cb);a.do_activation=!0;break;case 100:w.clear_collision_impulse_test(a.col_imp_obj);a.do_activation=!0;break;case 110:w.remove_ray_test(a.ray_test_id);a.do_activation=!0;break;case 140:a.do_activation=!0;break;case 20:var b=h(a.element);f(b,"keyboard_downed_keys");a.do_activation=!0;break;case 30:b=h(a.element);f(b,"mouse_wheel");a.do_activation=!0;break;case 40:b=h(a.element);
f(b,"mouse_down_which");f(b,"mouse_up_which");f(b,"mouse_location");a.do_activation=!0;break;case 50:b=h(a.element);f(b,"mouse_down_which");f(b,"mouse_up_which");a.do_activation=!0;break;case 60:b=h(a.element);f(b,"touch_start");f(b,"touch_move");f(b,"touch_end");a.do_activation=!0;break;case 70:b=h(a.element);f(b,"touch_start");f(b,"touch_move");a.do_activation=!0;break;case 75:b=h(a.element);f(b,"touch_start");f(b,"touch_move");a.do_activation=!0;break;case 80:b=h(a.element);f(b,"touch_start");
f(b,"touch_end");a.do_activation=!0;break;case 170:b=h(a.element);f(b,"mouse_select");f(b,"touch_select");f(b,"touch_start");f(b,"touch_end");f(b,"mouse_down_which");f(b,"mouse_up_which");a.do_activation=!0;break;case 180:case 190:b=h(a.element);f(b,"orientation_angles");a.do_activation=!0;break;case 200:b=h(a.element);f(b,"orientation_quat");a.do_activation=!0;break;case 210:case 220:a.do_activation=!0}}function p(a){var b=a[0],c=a[1];a=b.clientX-c.clientX;b=b.clientY-c.clientY;return Math.sqrt(a*
a+b*b)}function B(a){return 0==a?m.get_device_by_type_element(m.DEVICE_GAMEPAD0):1==a?m.get_device_by_type_element(m.DEVICE_GAMEPAD1):2==a?m.get_device_by_type_element(m.DEVICE_GAMEPAD2):m.get_device_by_type_element(m.DEVICE_GAMEPAD3)}var c=r("__config"),k=r("__container"),m=r("__input"),A=r("__objects"),E=r("__print"),w=r("__physics"),v=r("__quat"),z=r("__time"),y=r("__tsr"),D=r("__util"),K=r("__vec3"),d=c.controls,t=c.defaults,C=[],M={},x=[],g=[],H=[],G=new Float32Array(2),ba=new Float32Array(2),
L=K.create(),F=v.create(),U=!1,Q=0;a.CT_POSITIVE=10;a.CT_CONTINUOUS=20;a.CT_TRIGGER=30;a.CT_SHOT=40;a.CT_LEVEL=50;a.CT_CHANGE=60;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.PL_MULTITOUCH_MOVE_ROTATE=3;a.update=function(b,c){for(var g=0;g<H.length;g++){var d=H[g];d.mouse_select_data.is_updated||(d.mouse_select_data.obj=A.pick_object(d.mouse_select_data.coord[0],d.mouse_select_data.coord[1]),d.mouse_select_data.is_updated=!0,d.global_selected_obj=d.mouse_select_data.obj);
for(var k=0;10>k;++k){var e=d.touch_select_dlist[k];e.is_updated||(e.obj=A.pick_object(e.coord[0],e.coord[1]),e.is_updated=!0,d.global_selected_obj=e.obj)}}for(g=0;g<x.length;g++)if(d=x[g],k=b,e=c)switch(d.type){case 120:var f=d.source_object,I=y.get_trans(f.render.world_tsr,L),f=y.get_quat(f.render.world_tsr,F),n=K.dist(d.trans_last,I),p=d.quat_temp;v.invert(d.quat_last,p);v.multiply(f,p,p);v.normalize(p,p);p=Math.abs(2*Math.acos(p[3]));n/=e;d.avg_linear_vel=D.smooth(n,d.avg_linear_vel,e,.3);d.payload[0]=
n;n=p/e;d.avg_angular_vel=D.smooth(n,d.avg_angular_vel,e,.3);d.payload[1]=n;d.avg_linear_vel>=d.threshold||d.avg_angular_vel>=d.rotation_threshold?l(d,1):l(d,0);K.copy(I,d.trans_last);v.copy(f,d.quat_last);d.time_last=k;break;case 130:f=d.source_object;I=y.get_trans(f.render.world_tsr,L);f=Math.abs(I[1]-d.trans_last[1])/e;d.avg_vertical_vel=D.smooth(f,d.avg_vertical_vel,e,.3);d.payload=f;d.avg_vertical_vel>=d.threshold?l(d,1):l(d,0);K.copy(I,d.trans_last);d.time_last=k;break;case 140:!d.do_activation&&
0<=d.period&&k-d.time_last>=d.period&&(l(d,1),d.repeat?d.time_last=k:d.period=-d.period);break;case 150:d.time_last||(d.time_last=k);l(d,k-d.time_last);d.time_last=k;break;case 160:l(d,k);break;case 180:k=h(d.element);d.payload[0]=k.gyro_gamma_new-k.gyro_gamma_last;d.payload[1]=k.gyro_beta_new-k.gyro_beta_last;d.payload[2]=k.gyro_alpha_new-k.gyro_alpha_last;break;case 190:k=h(d.element);d.payload[0]=k.gyro_gamma_new;d.payload[1]=k.gyro_beta_new;d.payload[2]=k.gyro_alpha_new;break;case 200:k=h(d.element);
v.copy(k.gyro_quat,d.payload);break;case 210:k=m.get_device_by_type_element(m.DEVICE_HMD);m.get_vector_param(k,m.HMD_ORIENTATION_QUAT,d.payload);break;case 220:k=m.get_device_by_type_element(m.DEVICE_HMD);m.get_vector_param(k,m.HMD_POSITION,d.payload);break;case 240:k=B(d.gamepad_id);d.value=m.get_gamepad_btn_value(k,d.key);break;case 250:k=B(d.gamepad_id);d.value=m.get_gamepad_axis_value(k,d.key);break;case 230:l(d,d.callback());break;case 30:k=h(d.element);l(d,k.wheel_delta);break;case 40:k=h(d.element);
if(!t.ie11_edge_touchscreen_hack||k.is_mouse_downed)switch(e=k.mouse_curr_x-k.mouse_last_x,I=k.mouse_curr_y-k.mouse_last_y,d.payload.coords[0]=k.mouse_curr_x,d.payload.coords[1]=k.mouse_curr_y,d.axis){case "X":l(d,e);break;case "Y":l(d,I);break;case "XY":f=Math.sqrt(e*e+I*I),l(d,f)}break;case 50:k=h(d.element);l(d,k.is_mouse_downed);d.payload.which=k.which;d.payload.coords[0]=k.mouse_curr_x;d.payload.coords[1]=k.mouse_curr_y;break;case 170:k=h(d.element);l(d,0);if(d.enable_toggle_switch)k.global_selected_obj==
d.source_object&&l(d,1);else if(k.is_mouse_downed&&k.mouse_select_data.obj==d.source_object)l(d,1);else if(!k.is_touch_ended)for(e=0;10>e;++e)if(k.touch_select_dlist[e].obj==d.source_object){l(d,1);break}break;case 20:k=h(d.element);d.payload=k.downed_keys[d.key];1==d.payload||k.downed_keys[0]&&16==d.key?l(d,1):d.payload&&3!=d.payload||l(d,0);break;case 60:k=h(d.element);if(-1==k.touches_curr_x[1]&&-1==k.touches_curr_y[1]){e=k.touches_curr_x[0]-k.touches_last_x[0];I=k.touches_curr_y[0]-k.touches_last_y[0];
f=Math.sqrt(e*e+I*I);if(-1!=k.touches_last_x[1]&&-1!=k.touches_last_y[1]){var n=k.touches_curr_x[0]-k.touches_last_x[1],p=k.touches_curr_y[0]-k.touches_last_y[1],w=Math.sqrt(n*n+p*p);w<f&&(e=n,I=p,f=w)}d.payload.gesture=a.PL_SINGLE_TOUCH_MOVE}else I=G,I[0]=(k.touches_curr_x[0]+k.touches_curr_x[1])/2,I[1]=(k.touches_curr_y[0]+k.touches_curr_y[1])/2,f=ba,f[0]=(k.touches_last_x[0]+k.touches_last_x[1])/2,f[1]=(k.touches_last_y[0]+k.touches_last_y[1])/2,e=I[0]-f[0],I=I[1]-f[1],f=Math.sqrt(e*e+I*I),d.payload.gesture=
a.PL_MULTITOUCH_MOVE_PAN;d.payload.coords[0]=k.touches_curr_x[0];d.payload.coords[1]=k.touches_curr_y[0];switch(d.axis){case "X":l(d,e);break;case "Y":l(d,I);break;case "XY":l(d,f)}break;case 70:k=h(d.element);k=k.touch_zoom_curr_dist-k.touch_zoom_last_dist;d.payload=a.PL_MULTITOUCH_MOVE_ZOOM;l(d,k);break;case 75:k=h(d.element);-1!=k.touches_curr_x[1]&&(e=Math.atan2(k.touches_curr_y[0]-k.touches_curr_y[1],k.touches_curr_x[0]-k.touches_curr_x[1]),d.payload=a.PL_MULTITOUCH_MOVE_ROTATE,l(d,e-k.touch_start_rot));
break;case 80:k=h(d.element),d.payload.coords[0]=k.touches_curr_x[0],d.payload.coords[1]=k.touches_curr_y[0],k.is_touch_ended?l(d,0):l(d,1)}for(g=0;g<C.length;g++)for(e=C[g],d=e.sensor_manifolds_arr,k=0;k<d.length;k++)if(I=d[k],I.update_counter!=Q){I.update_counter=Q;p=I;f=0;switch(p.type){case a.CT_POSITIVE:f=(n=q(p))?1:0;break;case a.CT_CONTINUOUS:f=p.last_pulse;(n=q(p))?(f=1,p.last_pulse=1):1==f?(f=-1,p.last_pulse=-1):f=0;break;case a.CT_TRIGGER:f=p.last_pulse;(n=q(p))&&-1==f?(f=1,p.last_pulse=
1):n||1!=f?f=0:(f=-1,p.last_pulse=-1);break;case a.CT_SHOT:f=p.last_pulse;(n=q(p))&&-1==f?(f=1,p.last_pulse=1):n||1!=f?f=0:(f=0,p.last_pulse=-1);break;case a.CT_LEVEL:n=q(p);p.last_logic_result!=n?(f=1,p.last_logic_result=n):f=0;break;case a.CT_CHANGE:n=p.sensors;p=p.last_sensor_values;for(w=0;w<n.length;w++){var z=n[w].value;f||z==p[w]||(f=1);p[w]=z}break;default:D.panic("Wrong sensor manifold type: "+p.type)}if(f&&(n=e==M?null:e,U=!1,I.callback(n,I.id,f,I.callback_param),U)){g=-1;break}}for(g=0;g<
C.length;g++)for(e=C[g],d=e.sensor_manifolds_arr,k=0;k<d.length;k++)for(I=d[k],e=I.sensors,I=0;I<e.length;I++)switch(f=e[I],f.type){case 30:l(f,0);break;case 40:l(f,0);break;case 60:l(f,0);break;case 70:l(f,0);break;case 75:l(f,0);break;case 80:l(f,0);break;case 140:l(f,0)}for(g=0;g<H.length;g++){d=H[g];if(!d.is_updated_keyboard){for(k=0;k<d.downed_keys.length;k++)1==d.downed_keys[k]?d.downed_keys[k]=2:3==d.downed_keys[k]&&(d.downed_keys[k]=0);d.is_updated_keyboard=!0}d.wheel_delta=0;d.mouse_last_x=
d.mouse_curr_x;d.mouse_last_y=d.mouse_curr_y;d.downed_keys[0]=!1;d.touches_last_x.set(d.touches_curr_x);d.touches_last_y.set(d.touches_curr_y);d.touch_zoom_last_dist=d.touch_zoom_curr_dist;d.gyro_gamma_last=d.gyro_gamma_new;d.gyro_beta_last=d.gyro_beta_new;d.gyro_alpha_last=d.gyro_alpha_new;d.is_updated_gyro_quat=!1}Q++};a.create_custom_sensor=function(a){var b=u(10);l(b,a);return b};a.create_keyboard_sensor=function(a){var b=u(20,document);b.key=a;b.do_activation=!0;return b};a.create_gamepad_btn_sensor=
function(a,b){var c=u(240,document);b=b||m.get_first_gmpd_id();c.gamepad_id=b;c.key=a;c.do_activation=!0;return c};a.create_gamepad_axis_sensor=function(a,b){var c=u(250,document);b=void 0==b?m.get_first_gmpd_id():b;c.gamepad_id=b;c.key=a;c.do_activation=!0;return c};a.create_collision_sensor=function(a,b,c){if(!a||!w.obj_has_physics(a))return E.error("Wrong collision object"),null;var d=u(90);d.collision_obj=a;d.collision_id=b;d.calc_pos_norm=c;d.payload={coll_obj:null,coll_pos:c?new Float32Array(3):
null,coll_norm:c?new Float32Array(3):null,coll_dist:0};d.collision_cb=function(a,b,c,g,k){l(d,a);a=d.payload;a.coll_obj=b;d.calc_pos_norm&&(a.coll_pos.set(c),a.coll_norm.set(g),a.coll_dist=k)};d.do_activation=!0;return d};a.create_collision_impulse_sensor=function(a){if(!a||!a.physics)return E.error("Wrong collision impulse object"),null;var b=u(100);b.col_imp_obj=a;b.col_imp_cb=function(a){l(b,a)};b.do_activation=!0;return b};a.create_ray_sensor=function(a,b,c,d,g,k,m){var t=u(110);t.source_object=
a;t.from=b;t.to=c;t.collision_id=d;t.is_binary_value=g;t.calc_pos_norm=k;t.ign_src_rot=m;t.payload={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),ray_test_id:0};t.ray_test_cb=function(a,b,c,d,g,k){t.is_binary_value?l(t,-1==b?0:1):l(t,b);t.payload.hit_fract=b;t.payload.obj_hit=c;t.payload.hit_time=d;t.calc_pos_norm&&(t.payload.hit_pos.set(g),t.payload.hit_norm.set(k))};t.do_activation=!0;return t};a.create_mouse_click_sensor=function(a){a=u(50,a);a.do_activation=
!0;a.payload={coords:new Float32Array(2),which:null};return a};a.create_mouse_wheel_sensor=function(a){a=u(30,a);a.do_activation=!0;return a};a.create_mouse_move_sensor=function(a,b){var c=u(40,b);c.axis=a||"XY";c.payload={coords:new Float32Array(2)};c.do_activation=!0;return c};a.create_touch_move_sensor=function(a,b){var c=u(60,b);c.axis=a||"XY";c.payload={coords:new Float32Array(2),gesture:0};c.do_activation=!0;return c};a.create_touch_zoom_sensor=function(a){a=u(70,a);a.payload=0;a.do_activation=
!0;return a};a.create_touch_rotate_sensor=function(a){a=u(75,a);a.payload=0;a.do_activation=!0;return a};a.create_touch_click_sensor=function(a){a=u(80,a);a.payload={coords:new Float32Array(2)};a.do_activation=!0;return a};a.create_motion_sensor=function(a,b,c){if(!a)return E.error("Wrong collision object"),null;var d=u(120);d.source_object=a;var g=y.get_trans_view(a.render.world_tsr);a=y.get_quat_view(a.render.world_tsr);d.quat_temp=new Float32Array(4);d.trans_last=new Float32Array(g);d.quat_last=
new Float32Array(a);d.avg_linear_vel=0;d.avg_angular_vel=0;d.threshold=b||.1;d.rotation_threshold=c||.1;d.time_last=0;d.payload=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=function(a,b){if(!a)return E.error("Wrong collision object"),null;var c=u(130);c.source_object=a;var d=y.get_trans_view(a.render.world_tsr),g=y.get_quat_view(a.render.world_tsr);c.trans_last=new Float32Array(d);c.quat_last=new Float32Array(g);c.avg_vertical_vel=0;c.threshold=b||1;c.time_last=0;c.payload=
0;return c};a.create_timer_sensor=function(a,b){var c=u(140);c.period=a;c.repeat=b;c.do_activation=!0;return c};a.reset_timer_sensor=function(a,b,c,d){a=a||M;a=a.sensor_manifolds;if(!a||!a[b])return E.error("reset_timer_sensor(): wrong object"),null;b=a[b].sensors[c];if(!b)return E.error("reset_timer_sensor(): sensor not found"),null;b.time_last=z.get_timeline();b.period=d};a.create_elapsed_sensor=function(){var a=u(150);a.time_last=0;return a};a.create_gyro_delta_sensor=function(){var a=u(180,window);
a.payload=new Float32Array(3);m.get_device_by_type_element(m.DEVICE_GYRO)?l(a,1):l(a,0);a.do_activation=!0;return a};a.create_gyro_angles_sensor=function(){var a=u(190,window);a.payload=new Float32Array(3);m.get_device_by_type_element(m.DEVICE_GYRO)?l(a,1):l(a,0);a.do_activation=!0;return a};a.create_gyro_quat_sensor=function(){var a=u(200,window);a.payload=v.create();m.get_device_by_type_element(m.DEVICE_GYRO)?l(a,1):l(a,0);a.do_activation=!0;return a};a.create_hmd_quat_sensor=function(){var a=u(210,
window);a.payload=v.create();m.get_device_by_type_element(m.DEVICE_HMD)?l(a,1):l(a,0);a.do_activation=!0;return a};a.create_hmd_position_sensor=function(){var a=u(220,window);a.payload=K.create();m.get_device_by_type_element(m.DEVICE_HMD)?l(a,1):l(a,0);a.do_activation=!0;return a};a.create_timeline_sensor=function(){return u(160)};a.create_selection_sensor=function(a,b){var c=u(170);c.source_object=a;c.enable_toggle_switch=b;c.do_activation=!0;return c};a.create_callback_sensor=function(a,b){var c=
u(230);c.callback=a;l(c,b);return c};a.sensor_set_value=l;a.get_sensor_value=function(a,b,c){a=a||M;a=a.sensor_manifolds;if(!a||!a[b])return E.error("get_sensor_value(): wrong object"),null;b=a[b].sensors[c];return b?b.value:(E.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,c){a=a||M;a=a.sensor_manifolds;if(!a||!a[b])return E.error("get_sensor_payload(): wrong object"),null;b=a[b].sensors[c];return b?b.payload:(E.error("get_sensor_payload(): sensor not found"),
null)};a.cleanup=function(){C=[];M={};for(var a=0;a<x.length;a++)n(x[a]);x.length=0;g.length=0};a.check_sensor_manifold=function(a,b){a=a||M;if(!a.sensor_manifolds)return!1;if(b&&a.sensor_manifolds[b])return!0;if(!b)for(var c in a.sensor_manifolds)return!0;return!1};a.create_sensor_manifold=function(a,c,d,k,t,f,n){a=a||M;a.sensor_manifolds_arr=a.sensor_manifolds_arr||[];a.sensor_manifolds=a.sensor_manifolds||{};var I=a.sensor_manifolds,l=a.sensor_manifolds_arr;I[c]&&e(a,c);d={id:c,type:d,sensors:k.slice(0),
logic_fun:t,sensor_values:Array(k.length),callback:f,callback_param:n,last_pulse:-1,last_logic_result:0,last_sensor_values:Array(k.length),update_counter:-1};I[c]=d;l.push(d);-1==C.indexOf(a)&&C.push(a);k=d.sensors;for(a=0;a<k.length;a++){I=c=k[a];if(I.do_activation){switch(I.type){case 90:w.append_collision_test(I.collision_obj,I.collision_id,I.collision_cb,I.calc_pos_norm);break;case 100:w.apply_collision_impulse_test(I.col_imp_obj,I.col_imp_cb);break;case 110:I.ray_test_id=w.append_ray_test(I.source_object,
I.from,I.to,I.collision_id,I.ray_test_cb,!1,!1,I.calc_pos_norm,I.ign_src_rot);I.payload.ray_test_id=I.ray_test_id;break;case 140:I.time_last=z.get_timeline();0>I.period&&(I.period=-I.period);break;case 20:l=h(I.element);b(l,"keyboard_downed_keys");break;case 30:l=h(I.element);b(l,"mouse_wheel");break;case 40:l=h(I.element);b(l,"mouse_down_which");b(l,"mouse_up_which");b(l,"mouse_location");break;case 50:l=h(I.element);b(l,"mouse_down_which");b(l,"mouse_up_which");break;case 60:l=h(I.element);b(l,
"touch_start");b(l,"touch_move");b(l,"touch_end");break;case 70:l=h(I.element);b(l,"touch_start");b(l,"touch_move");break;case 75:l=h(I.element);b(l,"touch_start");b(l,"touch_move");break;case 80:l=h(I.element);b(l,"touch_start");b(l,"touch_end");break;case 170:l=h(I.element);b(l,"mouse_select");b(l,"touch_select");b(l,"touch_start");b(l,"touch_end");b(l,"mouse_down_which");b(l,"mouse_up_which");break;case 180:case 190:l=h(I.element);b(l,"orientation_angles");break;case 200:l=h(I.element);b(l,"orientation_quat");
break;case 240:0==I.gamepad_id?m.get_device_by_type_element(m.DEVICE_GAMEPAD0):1==I.gamepad_id?m.get_device_by_type_element(m.DEVICE_GAMEPAD1):2==I.gamepad_id?m.get_device_by_type_element(m.DEVICE_GAMEPAD2):m.get_device_by_type_element(m.DEVICE_GAMEPAD3)}I.do_activation=!1}I=x.indexOf(c);-1==I?(x.push(c),g.push([d])):g[I].push(d)}U=!0};a.default_AND_logic_fun=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.default_OR_logic_fun=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];
return a[a.length-1]};a.remove_sensor_manifold=e;a.reset=function(){for(var a=0;a<C.length;a++){var b=C[a],c=b.sensor_manifolds,b=b.sensor_manifolds_arr,d;for(d in c)delete c[d];b.length=0}for(a=0;a<x.length;a++)n(x[a]);C.length=0;x.length=0;g.length=0};a.debug=function(){E.log(String(C.length)+" objects with manifolds",C);E.log(String(x.length)+" sensors",x);for(var a=[],b=[],c=0;c<x.length;c++){var d=x[c];90==d.type&&a.push(d);110==d.type&&b.push(d)}E.log(String(a.length)+" collision sensors",a);
E.log(String(b.length)+" ray sensors",b)}};b4w.module.__curve=function(a,r){function u(a,b,f,c,k){var m=c.length;k||(k=new Float32Array(m));for(var e=m+a,h=new Float32Array(e),l=1;l<=e-1;l++)h[l-1]=b>=f[l-1]&&b<f[l+1-1]?1:0;for(var v=2;v<=a;v++)for(l=1;l<=e-v;l++)h[l-1]=(0!=h[l-1]?(b-f[l-1])*h[l-1]/(f[l+v-1-1]-f[l-1]):0)+(0!=h[l+1-1]?(f[l+v-1]-b)*h[l+1-1]/(f[l+v-1]-f[l+1-1]):0);b==f[e-1]&&(h[m-1]=1);a=0;for(l=1;l<=m;l++)a+=h[l-1]*c[l-1];for(l=1;l<=m;l++)k[l-1]=0!=a?h[l-1]*c[l-1]/a:0;return k}function h(a){a=a.knot;return a[a.length-1]}function b(a){a=
a.cumulative_length;return a[a.length-1]}function f(a,b,e,c,k,m,h,q){var w=a+(b-a)/2,v=l(w,c,k,m,h)-e;q=q?q:.01;return Math.abs(v)<q?w:0<v?f(a,w,e,c,k,m,h,q):f(w,b,e,c,k,m,h,q)}function l(a,b,f,c,k){var m=1-a;return b*m*m*m+3*f*m*m*a+3*c*m*a*a+k*a*a*a}r("__print");var q=r("__util"),e=r("__vec3");a.create_spline=function(a){var b={},f=a.data;a=f.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var c=a.order_u;b.order=c;a=a.points;var k=a.length/5,m=[],e=k+c,k=k+2;m[0]=0;for(var h=2;h<=
e;h++)m[h-1]=h>c&&h<k?m[h-2]+1:m[h-2];b.knot=m;"2D"==f.dimensions?b.is_3d=!1:"3D"==f.dimensions?b.is_3d=!0:q.panic("Wrong curve dimensions");c=[];m=[];for(f=0;f<a.length;f+=5)c.push(a[f]),c.push(a[f+1]),c.push(a[f+2]),b.is_3d&&c.push(a[f+3]),m.push(a[f+4]);b.cpoints=c;b.weights=m;a=[];for(var f=b.cpoints,c=b.is_3d?4:3,m=b.weights,e=b.knot,k=b.order,h=f.length/c,l=h+k,v=0,z=e[l-1]/999,y=0;1E3>y;y++){5E-6>e[l-1]-v&&(v=e[l-1]);for(var D=u(k,v,e,m),K=0;K<c;K++)for(var d=a[c*y+K]=0;d<h;d++)a[c*y+K]+=D[d]*
f[c*d+K];v+=z}c=b.is_3d?4:3;m=new Float32Array(1E3);m[0]=0;for(f=1;1E3>f;f+=1)e=a[(f-1)*c],k=a[(f-1)*c+1],h=a[(f-1)*c+2],l=a[f*c],v=a[f*c+1],z=a[f*c+2],e=Math.sqrt((l-e)*(l-e)+(v-k)*(v-k)+(z-h)*(z-h)),m[f]=m[f-1]+e;b.cumulative_length=m;return b};a.spline_point=function(a,b,f){f||(f=[]);var c=b,k=Math.max(c,0),k=h(a);b=k=Math.min(c,k);var c=a.cpoints,k=a.is_3d?4:3,m=a.weights,e=a.knot,l=a.order;a=c.length/k;var w=a+l;5E-6>e[w-1]-b&&(b=e[w-1]);w=new Float32Array(a);u(l,b,e,m,w);for(b=0;b<k;b++)for(m=
f[b]=0;m<a;m++)f[b]+=w[m]*c[k*m+b];return f};a.spline_derivative=function(a,b,f){f||(f=[]);var c=a.cpoints,k=a.is_3d?4:3,m=a.weights,e=a.knot,h=a.order;a=c.length/k;var l=a+h;5E-6>e[l-1]-b&&(b=e[l-1]);var l=new Float32Array(a),v=b;b=l;var z=m.length;b||(b=new Float32Array(z));var y=new Float32Array(z),q=new Float32Array(z),K=y,d=q;K||(K=new Float32Array(z));d||(d=new Float32Array(z));for(var t=z+h,C=new Float32Array(t),M=new Float32Array(t),x=1;x<=t-1;x++)C[x-1]=v>=e[x-1]&&v<e[x+1-1]?1:0;v==e[t-1]&&
(C[z-1]=1);for(var g=2;g<=h;g++)for(x=1;x<=t-g;x++){var H=0!=C[x-1]?C[x-1]/(e[x+g-1-1]-e[x-1]):0,G=0!=C[x+1-1]?-C[x+1-1]/(e[x+g-1]-e[x+1-1]):0,r=0!=M[x-1]?(v-e[x-1])*M[x-1]/(e[x+g-1-1]-e[x-1]):0,L=0!=M[x+1-1]?(e[x+g-1]-v)*M[x+1-1]/(e[x+g-1]-e[x+1-1]):0;C[x-1]=(0!=C[x-1]?(v-e[x-1])*C[x-1]/(e[x+g-1-1]-e[x-1]):0)+(0!=C[x+1-1]?(e[x+g-1]-v)*C[x+1-1]/(e[x+g-1]-e[x+1-1]):0);M[x-1]=H+G+r+L}for(x=1;x<=z;x++)K[x-1]=C[x-1],d[x-1]=M[x-1];e=0;for(h=1;h<=z;h++)e+=y[h-1]*m[h-1];v=0;for(h=1;h<=z;h++)v+=q[h-1]*m[h-
1];for(h=1;h<=z;h++)b[h-1]=0!=e?q[h-1]*m[h-1]/e+y[h-1]*m[h-1]*v/(e*e):0;for(m=0;m<k;m++)for(e=f[m]=0;e<a;e++)f[m]+=l[e]*c[k*e+m];return f};a.spline_max_t=h;a.spline_length=b;a.spline_len_to_t=function(a,e){if(0>=e)return 0;var f=h(a);if(e>=b(a))return f;var c=a.cumulative_length,k=q.binary_search_max(c,e,0,c.length-1);return f*(k+(e-c[k])/(c[k+1]-c[k]))/1E3};a.linear_interpolation=function(a,b,e,c,k){return e+(k-c)*(a-e)/(b-c)};a.linear=function(a,b,e){var c=b[0];b=b[1];e=(e[1]-b)/(e[0]-c);return e*
a+(b-e*c)};a.bezier=function(a,b,e,c,k,m){a=f(0,1,a,b[0],e[0],c[0],k[0],m);return l(a,b[1],e[1],c[1],k[1])};a.calchandle_curvemap=function(a,b,f,c,k){var m=new Float32Array(3),h=new Float32Array(3),l=new Float32Array(3),w=new Float32Array(3),v=new Float32Array(3),z=new Float32Array(3);e.copy(a[1],h);null==b?(e.copy(f[1],l),m[0]=2*h[0]-l[0],m[1]=2*h[1]-l[1]):e.copy(b[1],m);null==f?(e.copy(b[1],m),l[0]=2*h[0]-m[0],l[1]=2*h[1]-m[1]):e.copy(f[1],l);e.subtract(h,m,w);e.subtract(l,h,v);b=e.length(w);f=
e.length(v);0==b&&(b=1);0==f&&(f=1);if("AUTO"==c||"AUTO"==k)z[0]=v[0]/f+w[0]/b,z[1]=v[1]/f+w[1]/b,m=2.5614*e.length(z),0!=m&&("AUTO"==c&&e.scaleAndAdd(h,z,-(b/m),a[0]),"AUTO"==k&&e.scaleAndAdd(h,z,f/m,a[2]));"VECTOR"==c&&e.scaleAndAdd(h,w,-1/3,a[0]);"VECTOR"==k&&e.scaleAndAdd(h,v,1/3,a[2])};a.correct_bezpart=function(a,b,e,c){var k=[],m=[],f,h,l;k[0]=a[0]-b[0];k[1]=a[1]-b[1];m[0]=c[0]-e[0];m[1]=c[1]-e[1];l=c[0]-a[0];f=Math.abs(k[0]);h=Math.abs(m[0]);0!=f+h&&f+h>l&&(f=l/(f+h),b[0]=a[0]-f*k[0],b[1]=
a[1]-f*k[1],e[0]=c[0]-f*m[0],e[1]=c[1]-f*m[1])}};b4w.module.__debug=function(a,r){function u(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function h(){var a=B.get_disjoint_timer_query();if(a){var b=a.createQueryEXT();a.beginQueryEXT(a.TIME_ELAPSED_EXT,b)}else b=performance.now();return b}function b(){var b=C;return b&&b.debug_view_mode==a.DV_RENDER_TIME}function f(a,b,c){var d=B.get_disjoint_timer_query(),g=0;if(d)for(c&&d.endQueryEXT(d.TIME_ELAPSED_EXT),c=0;c<a.length;c++){var k=a[c],m=d.getQueryObjectEXT(k,
d.QUERY_RESULT_AVAILABLE_EXT),e=y.getParameter(d.GPU_DISJOINT_EXT);m&&!e&&(g=d.getQueryObjectEXT(k,d.QUERY_RESULT_EXT)/1E6,b&&(g=w.smooth(g,b,1,10)),a.splice(c,1),c--)}else g=performance.now()-a.pop(),b&&(g=w.smooth(g,b,1,10));return g}function l(a,b){q(a)||w.panic("Structure assertion failed: invalid first object value");q(b)||w.panic("Structure assertion failed: invalid second object value");e(a,b)||w.panic("Structure assertion failed: incompatible types");if(!(null==a||null==b||"object"!=typeof a||
w.is_arr_buf_view(a)||a instanceof Array)){for(var c in a)q(a[c])||w.panic("Structure assertion failed: invalid value for key in the first object: "+c),c in b||w.panic("Structure assertion failed: missing key in the first object: "+c);for(c in b)q(b[c])||w.panic("Structure assertion failed: invalid value for key in the second object: "+c),c in a||w.panic("Structure assertion failed: missing key in the second object: "+c),e(a[c],b[c])||w.panic("Structure assertion failed: incompatible types for key "+
c)}}function q(a){return"undefined"==typeof a?!1:"number"==typeof a&&isNaN(a)?!1:!0}function e(a,b){if(typeof a!=typeof b)return!1;if(null!=a&&null!=b&&"object"==typeof a){var c=a instanceof Array,d=b instanceof Array;if(c&&!d||!c&&d)return!1;c=w.is_arr_buf_view(a);d=w.is_arr_buf_view(b);if(c&&!d||!c&&d)return!1}return!0}var n=r("__compat"),p=r("__config"),B=r("__extensions"),c=r("__graph"),k=r("__print"),m=r("__subscene"),A=r("__textures"),E=r("__time"),w=r("__util"),v=p.defaults,z={},y=null,D={},
K=[],d=-1,t=-1,C=null,M=null,x=!1,g={};a.DV_NONE=0;a.DV_OPAQUE_WIREFRAME=1;a.DV_TRANSPARENT_WIREFRAME=2;a.DV_FRONT_BACK_VIEW=3;a.DV_BOUNDINGS=4;a.DV_CLUSTERS_VIEW=5;a.DV_BATCHES_VIEW=6;a.DV_RENDER_TIME=7;a.setup_context=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(z[a[d]]=d)}y=a};a.set_debug_view_subs=function(a){C=a};a.get_debug_view_subs=function(){return C};a.fill_vbo_garbage_info=
function(a,b,c,d,k){g[a]||(g[a]={shaders:b,attrs:{}});c in g[a].attrs||(g[a].attrs[c]=d);k&&(g[a].attrs[c]=0)};a.calc_vbo_garbage_byte_size=function(){var a=0,b;for(b in g)for(var c in g[b].attrs)a+=g[b].attrs[c];return a};a.show_vbo_garbage_info=function(){var a={},b;for(b in g)for(var c in g[b].attrs){var d=g[b].attrs[c];if(d){var m=g[b].shaders;m in a||(a[m]={total_size:0,attrs:{}});c in a[m].attrs||(a[m].attrs[c]=0);a[m].attrs[c]+=d;a[m].total_size+=d}}for(m in a){k.groupCollapsed(m,a[m].total_size);
for(c in a[m].attrs)k.log_raw(c,a[m].attrs[c]);k.groupEnd()}};a.check_gl=function(a){if(v.gl_debug){var b=y.getError();b!=y.NO_ERROR&&(b in z?w.panic("GL Error: "+b+", gl."+z[b]+" ("+a+")"):w.panic("Unknown GL error: "+b+" ("+a+")"))}};a.check_bound_fb=function(){if(!v.gl_debug&&!v.check_framebuffer_hack)return!0;switch(y.checkFramebufferStatus(y.FRAMEBUFFER)){case y.FRAMEBUFFER_COMPLETE:return!0;case y.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),
!1;case y.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),!1;case y.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),!1;case y.FRAMEBUFFER_UNSUPPORTED:return k.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;case y.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return k.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MULTISAMPLE"),!1;default:return k.error("FRAMEBUFFER CHECK FAILED"),
!1}};a.check_depth_only_issue=function(){if(-1!=d)return d;var a=y.createFramebuffer();y.bindFramebuffer(y.FRAMEBUFFER,a);a=A.create_texture("DEBUG",A.TT_DEPTH);A.resize(a,1,1);y.framebufferTexture2D(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,a.w_target,a.w_texture,0);y.checkFramebufferStatus(y.FRAMEBUFFER)!=y.FRAMEBUFFER_COMPLETE?(d=!0,k.warn("depth-only issue was found")):d=!1;y.bindFramebuffer(y.FRAMEBUFFER,null);return d};a.check_multisample_issue=function(){if(1==v.msaa_samples)return!1;if(-1!=t)return t;
var a=y.createRenderbuffer();y.bindRenderbuffer(y.RENDERBUFFER,a);y.renderbufferStorageMultisample(y.RENDERBUFFER,v.msaa_samples,y.RGBA8,1,1);a=y.getRenderbufferParameter(y.RENDERBUFFER,y.RENDERBUFFER_SAMPLES);a!=v.msaa_samples?(t=!0,k.warn("multisample issue was found: requested "+v.msaa_samples+", got "+a),y.getError()==y.INVALID_OPERATION&&k.warn("the error from multisample issue detected, ignoring")):t=!1;y.bindRenderbuffer(y.RENDERBUFFER,null);return t};a.check_ff_cubemap_out_of_memory=function(){return n.check_user_agent("Firefox")&&
y.getError()==y.OUT_OF_MEMORY?(k.warn("Firefox/old GPUs cubemap issue was found."),!0):!1};a.report_shader_compiling_error=function(a,b,c){v.gl_debug&&(c=u(c),k.error("shader compilation failed:\n"+c+"\n"+y.getShaderInfoLog(a)+" ("+b+")"))};a.report_shader_linking_error=function(a,b,c,d){v.gl_debug&&(c=u(c),d=u(d),k.error("shader linking failed:\n"+c+"\n\n\n"+d+"\n"+y.getProgramInfoLog(a)+" ("+b+")"))};a.render_time_start_subs=function(a){if(v.show_hud_debug_info||a.type==m.PERFORMANCE)a.do_not_debug||
a.debug_render_time_queries.push(h())};a.render_time_start_batch=function(a){"MAIN"==a.type&&b()&&a.debug_render_time_queries.push(h())};a.render_time_stop_subs=function(a){if((v.show_hud_debug_info||a.type==m.PERFORMANCE)&&!a.do_not_debug){var b=f(a.debug_render_time_queries,a.debug_render_time,!0);b&&(a.debug_render_time=b)}};a.render_time_stop_batch=function(a){if("MAIN"==a.type&&b()){var c=f(a.debug_render_time_queries,a.debug_render_time,!0);c&&(a.debug_render_time=c)}};a.is_debug_view_render_time_mode=
b;a.process_timer_queries=function(a){var b=f(a.debug_render_time_queries,a.debug_render_time,!1);b&&(a.debug_render_time=b)};a.exec_count=function(a){D[a]=a in D?D[a]+1:1};a.update=function(){for(var a in D)k.log(a,D[a]),D[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(w.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}K.push(a)};a.msg=function(){for(var a=1,b=0;b<K.length;b++){var c=K[b];c[1]==arguments[0]&&
a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],w.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);K.push(c)};var H=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),g=0;g<K.length;g++){var m=K[g];a=m[0];if(!(a<d)){var e=String(m[1]);c[e]||(c[e]=H[b++%H.length]);var f=c[e];a=["%c"+(a/1E3).toFixed(6),f,e];for(e=2;e<m.length;e++)a.push(m[e]);
k.log.apply(this,a)}}K.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),d=0;d<K.length;d++){var g=K[d];a=g[0];if(!(a<c))for(var m=2;m<g.length;m++){var e=String(g[1]);3<g.length&&(e+="_"+String(m-2));b[e]||(b[e]=e+"\n");b[e]+=String(a)+" "+g[m]+"\n"}}a="";for(e in b)a+=b[e]+"\n\n";k.log(a);K.splice(0)};a.check_browser=function(a){var b=navigator.userAgent.toLowerCase(),c=function(a){return-1<b.indexOf(a)?!0:!1};switch(a.toLowerCase()){case "chrome":return c("mozilla")&&
c("applewebkit")&&c("chrome");case "firefox":return c("mozilla")&&c("gecko")&&c("firefox");case "msie":return c("mozilla")&&c("trident")&&c("msie");case "opera":return c("opera")&&c("presto");case "safari":return c("mozilla")&&c("applewebkit")&&c("safari")&&!c("chrome");default:return!1}};a.check_finite=function(a){if(w.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.assert_cons=function(a,b){a.constructor!=b&&w.panic("Type assertion failed: value <"+
a+"> has type <"+a.constructor+">, required <"+b+">")};a.assert_structure=l;a.assert_structure_seq=function(a){x?l(a,M):x=!0;M=w.clone_object_nr(a)};a.fake_load=function(a,b,c,d,g){(a=a||null)||w.panic("Stage load callback is undefined");b=b||5E3;c=c||0;d=d||100;100<d&&w.panic("Max percentage must be less than 100");0>c&&w.panic("Min percentage must be greater than 0");c>d&&w.panic("Max percentage must be greater than min percentage");var k=E.animate(c,d,b,function(b){b=b.toFixed();a(b);100==b&&(E.clear_animation(k),
g&&g())})};a.nodegraph_to_dot=function(a,b){if(b)var d=function(a,b){var c=b.type+"("+b.name+")",d=b.inputs,c=c+"\n\nINPUTS:";if(d.length)for(var g=0;g<d.length;g++)c+="\n"+d[g].identifier+": ",c=d[g].is_linked?c+"linked":c+d[g].default_value;else c+="\n---";d=b.outputs;c+="\n\nOUTPUTS:";if(d.length)for(g=0;g<d.length;g++)c+="\n"+d[g].identifier+": ",c=d[g].is_linked?c+("linked(default "+d[g].default_value+")"):c+"not used";else c+="\n---";c+="\n\nDATA:";g="";switch(b.type){case "GEOMETRY_UV":g="\nuv_layer: "+
b.data.value;break;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":g="\ntexture: "+b.data.value.name+"\n("+b.data.value.image.filepath+")"}""==g&&(g="\n---");return c+g},g=function(b,d,g){b=c.get_node_attr(a,b);d=c.get_node_attr(a,d);return b.outputs[g[0]].identifier+"\n==>\n"+d.inputs[g[1]].identifier};else d=function(a,b){return b.type},g=function(b,d,g){b=c.get_node_attr(a,b);d=c.get_node_attr(a,d);return b.outputs[g[0]].identifier+"\n==>\n"+d.inputs[g[1]].identifier};return c.debug_dot(a,d,g)};a.get_gl=
function(){return y};a.cleanup=function(){C=null;g={}};a.reset=function(){y=null}};b4w.module.__extensions=function(a,r){function u(a){if(a in e)return e[a];var b=q.getExtension(a)||null;e[a]=b;f.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}function h(a){if(a in e)return e[a];switch(a){case "WEBGL_depth_texture":case "OES_element_index_uint":case "OES_standard_derivatives":var b={};break;case "ANGLE_instanced_arrays":case "OES_vertex_array_object":b=q}e[a]=b;f.log("%cGET EXTENSION (WebGL 2)","color: #"+(b?"0a0":"a00"),a);return b}var b=r("__config"),f=r("__print"),
l=b.defaults,q=null,e={};a.setup_context=function(a){q=a};a.get_s3tc=function(){return u("WEBGL_compressed_texture_s3tc")||u("WEBKIT_WEBGL_compressed_texture_s3tc")||u("MOZ_WEBGL_compressed_texture_s3tc")};a.get_pvr=function(){return u("WEBKIT_WEBGL_compressed_texture_pvrtc")||u("WEBGL_compressed_texture_pvrtc")};a.get_depth_texture=function(){return l.webgl2?h("WEBGL_depth_texture"):u("WEBGL_depth_texture")||u("WEBKIT_WEBGL_depth_texture")||u("MOZ_WEBGL_depth_texture")};a.get_aniso=function(){return u("EXT_texture_filter_anisotropic")||
u("WEBKIT_EXT_texture_filter_anisotropic")||u("MOZ_EXT_texture_filter_anisotropic")};a.get_debug_shaders=function(){return u("WEBGL_debug_shaders")};a.get_renderer_info=function(){return u("WEBGL_debug_renderer_info")};a.get_elem_index_uint=function(){return l.webgl2?h("OES_element_index_uint"):u("OES_element_index_uint")};a.get_standard_derivatives=function(){return l.webgl2?h("OES_standard_derivatives"):u("OES_standard_derivatives")};a.get_disjoint_timer_query=function(){return u("EXT_disjoint_timer_query")};
a.get_instanced_arrays=function(){if(l.webgl2)return h("ANGLE_instanced_arrays");var a=u("ANGLE_instanced_arrays");return null==a?a:{drawElementsInstanced:function(b,e,c,k,m){a.drawElementsInstancedANGLE(b,e,c,k,m)},vertexAttribDivisor:function(b,e){a.vertexAttribDivisorANGLE(b,e)},drawArraysInstanced:function(b,e,c,k){a.drawArraysInstancedANGLE(b,e,c,k)}}};a.get_vertex_array_object=function(){if(l.webgl2)return h("OES_vertex_array_object");var a=u("OES_vertex_array_object");return null==a?a:{bindVertexArray:function(b){a.bindVertexArrayOES(b)},
createVertexArray:function(){return a.createVertexArrayOES()},deleteVertexArray:function(b){a.deleteVertexArrayOES(b)},isVertexArray:function(b){return a.isVertexArrayOES(b)}}};a.cleanup=function(){e={}};a.reset=function(){q=null}};b4w.module.__graph=function(a,r){function u(a,b,c){c||(c=null);h(a,b)?H.panic("Graph already has node with given ID"):a.nodes.push(b,c)}function h(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,d){d||(d=null);h(a,b)&&h(a,c)?a.edges.push(b,c,d):H.panic("Wrong node IDs")}function f(a,b){h(a,b)||H.panic("Node not found");for(var c=a.nodes,d=0;d<c.length;d+=2)c[d]==b&&(c.splice(d,2),d-=2)}function l(a,b,c,d){C(a,b,c)||H.panic("Edge not found");a=a.edges;for(var g=
0,k=0;k<a.length;k+=3)if(a[k]==b&&a[k+1]==c){if(-1==d)a.splice(k,3);else{if(d==g){a.splice(k,3);break}g++}k-=3}}function q(a){a=a.nodes;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function e(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function n(a){var b=[],c={};p(a,c);for(var d=a.nodes,g=0;g<d.length;g+=2)0==K(a,d[g])&&B(a,d[g],c,b);return{nodes:b,edges:a.edges.slice(0)}}function p(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)b[c[d]]=!1}function B(a,
b,c,g){if(!c[b]){c[b]=!0;for(var k=0;k<D(a,b);k++){var m=d(a,b,k);B(a,m,c,g)}g.unshift(b,y(a,b))}}function c(a,b,g,k){if(!g[b]){g[b]=!0;if(10==k||30==k)for(var m=0;m<D(a,b);m++){var e=d(a,b,m);c(a,e,g,k)}if(20==k||30==k)for(m=0;m<K(a,b);m++)e=t(a,b,m),c(a,e,g,k)}}function k(a){for(var b=a.edges,c=0;c<b.length;c+=3){var d=b[c+1];h(a,b[c])&&h(a,d)||(b.splice(c,3),c-=3)}}function m(a){for(var b=[],c=a.nodes,d=0;d<c.length;d+=2){var g=c[d];D(a,g)||b.push(g)}return b}function A(a){var b=a.nodes;a=a.edges;
for(var c=[],d=[],g=[],k=0;k<b.length;k++)g[b[2*k]]=k,c.push(k,b[2*k+1]);for(k=0;k<a.length;k+=3)d.push(g[a[k]],g[a[k+1]],a[k+2]);return{nodes:c,edges:d}}function E(a,b,c){if(c.core_len==c.n1){for(var g=0,k=0;g<c.n1;g++)-1!=c.core_1[g]&&(a[k]=g,b[k]=c.core_1[g],k++);return!0}if(c.n1>c.n2||c.t1both_len>c.t2both_len||c.t1out_len>c.t2out_len||c.t1in_len>c.t2in_len)return!1;for(var k=g=-1,m=!1;!m&&w(c,G,g,k);)if(g=G[0],k=G[1],v(c,g,k)){var e;e=c;m={};m.g1=e.g1;m.g2=e.g2;m.node_comp=e.node_comp;m.edge_comp=
e.edge_comp;m.n1=e.n1;m.n2=e.n2;m.order=e.order;m.core_len=m.orig_core_len=e.core_len;m.t1in_len=e.t1in_len;m.t1out_len=e.t1out_len;m.t1both_len=e.t1both_len;m.t2in_len=e.t2in_len;m.t2out_len=e.t2out_len;m.t2both_len=e.t2both_len;m.added_node1=-1;m.core_1=e.core_1;m.core_2=e.core_2;m.in_1=e.in_1;m.in_2=e.in_2;m.out_1=e.out_1;m.out_2=e.out_2;m.share_count=e.share_count;e.share_count[0]+=1;var m=e=m,f=g,h=k,l=m.g1,n=m.g2,p=m.n1,I=m.n2,A=m.core_1,x=m.core_2,C=m.in_1,B=m.in_2,H=m.out_1,S=m.out_2;z(f<
p);z(h<I);z(m.core_len<p);z(m.core_len<I);p=++m.core_len;m.added_node1=f;C[f]||(C[f]=p,m.t1in_len++,H[f]&&m.t1both_len++);H[f]||(H[f]=p,m.t1out_len++,C[f]&&m.t1both_len++);B[h]||(B[h]=p,m.t2in_len++,S[h]&&m.t2both_len++);S[h]||(S[h]=p,m.t2out_len++,B[h]&&m.t2both_len++);A[f]=h;x[h]=f;for(A=0;A<K(l,f);A++)x=t(l,f,A),C[x]||(C[x]=p,m.t1in_len++,H[x]&&m.t1both_len++);for(A=0;A<D(l,f);A++)x=d(l,f,A),H[x]||(H[x]=p,m.t1out_len++,C[x]&&m.t1both_len++);for(A=0;A<K(n,h);A++)x=t(n,h,A),B[x]||(B[x]=p,m.t2in_len++,
S[x]&&m.t2both_len++);for(A=0;A<D(n,h);A++)x=d(n,h,A),S[x]||(S[x]=p,m.t2out_len++,B[x]&&m.t2both_len++);m=E(a,b,e);z(1>=e.core_len-e.orig_core_len);z(-1!=e.added_node1);x=e.g1;f=e.g2;h=e.core_len;l=e.added_node1;n=e.core_1;C=e.core_2;p=e.in_1;B=e.in_2;I=e.out_1;H=e.out_2;if(e.orig_core_len<h){p[l]==h&&(p[l]=0);for(S=0;S<K(x,l);S++)A=t(x,l,S),p[A]==h&&(p[A]=0);I[l]==h&&(I[l]=0);for(S=0;S<D(x,l);S++)A=d(x,l,S),I[A]==h&&(I[A]=0);x=n[l];B[x]==h&&(B[x]=0);for(S=0;S<K(f,x);S++)A=t(f,x,S),B[A]==h&&(B[A]=
0);H[x]==h&&(H[x]=0);for(S=0;S<D(f,x);S++)A=d(f,x,S),H[A]==h&&(H[A]=0);n[l]=-1;C[x]=-1;e.core_len=e.orig_core_len;e.added_node1=-1}}return m}function w(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var g=a.t1both_len,k=a.t2both_len,m=a.t1out_len,e=a.t2out_len,f=a.t1in_len,t=a.t2in_len,h=a.core_len,l=a.n1,I=a.n2,n=a.core_1,p=a.core_2,A=a.in_1,x=a.in_2,C=a.out_1,v=a.out_2;if(g>h&&k>h)for(;c<l&&(-1!=n[c]||0==C[c]||0==A[c]);)c++,d=0;else if(m>h&&e>h)for(;c<l&&(-1!=n[c]||0==C[c]);)c++,d=0;else if(f>h&&t>h)for(;c<
l&&(-1!=n[c]||0==A[c]);)c++,d=0;else if(0==c&&0!=a.order){for(A=0;A<l&&-1!=n[c=a.order[A]];)A++;A==l&&(c=l)}else for(;c<l&&-1!=n[c];)c++,d=0;if(g>h&&k>h)for(;d<I&&(-1!=p[d]||0==v[d]||0==x[d]);)d++;else if(m>h&&e>h)for(;d<I&&(-1!=p[d]||0==v[d]);)d++;else if(f>h&&t>h)for(;d<I&&(-1!=p[d]||0==x[d]);)d++;else for(;d<I&&-1!=p[d];)d++;return c<l&&d<I?(b[0]=c,b[1]=d,!0):!1}function v(a,b,c){var g=a.g1,k=a.g2,m=a.n2,e=a.core_1,f=a.core_2,h=a.in_1,l=a.in_2,n=a.out_1,p=a.out_2;z(b<a.n1);z(c<m);z(-1==e[b]);z(-1==
f[c]);m=(0,a.node_comp)(y(g,b),y(k,c))?!0:!1;if(!m)return!1;for(var I=m=0,A=0,x=0,v=0,B=0,H=0;H<D(g,b);H++){var S=d(g,b,H);if(-1!=e[S]){var R=e[S];if(!C(k,c,R)||!M(a.edge_comp,g,b,S,k,c,R))return!1}else h[S]&&A++,n[S]&&m++,h[S]||n[S]||v++}for(H=0;H<K(g,b);H++)if(S=t(g,b,H),-1!=e[S]){if(R=e[S],!C(k,R,c)||!M(a.edge_comp,g,S,b,k,R,c))return!1}else h[S]&&A++,n[S]&&m++,h[S]||n[S]||v++;for(H=0;H<D(k,c);H++)if(R=d(k,c,H),-1!=f[R]){if(S=f[R],!C(g,b,S))return!1}else l[R]&&x++,p[R]&&I++,l[R]||p[R]||B++;for(H=
0;H<K(k,c);H++)if(R=t(k,c,H),-1!=f[R]){if(S=f[R],!C(g,S,b))return!1}else l[R]&&x++,p[R]&&I++,l[R]||p[R]||B++;return A<=x&&m<=I&&v<=B}function z(a){a||H.panic("Assertion failed")}function y(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function D(a,b){for(var c=a.edges,d=0,g=0;g<c.length;g+=3)c[g]==b&&d++;return d}function K(a,b){for(var c=a.edges,d=0,g=0;g<c.length;g+=3)c[g+1]==b&&d++;return d}function d(a,b,c){a=a.edges;for(var d=0,g=0;g<a.length;g+=3)if(a[g]==b){if(d==
c)return a[g+1];d++}return-1}function t(a,b,c){a=a.edges;for(var d=0,g=0;g<a.length;g+=3)if(a[g+1]==b){if(d==c)return a[g];d++}return-1}function C(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function M(a,b,c,d,k,m,e){for(var f=x(b,c,d),t=x(k,m,e),h=0;h<f;h++){for(var l=!1,n=0;n<t;n++)if(a(g(b,c,d,h),g(k,m,e,n))){l=!0;break}if(!l)return!1}return!0}function x(a,b,c){var d=0;a=a.edges;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&d++;return d}function g(a,b,
c,d){a=a.edges;for(var g=0,k=0;k<a.length;k+=3)if(a[k]==b&&a[k+1]==c){if(g==d)return a[k+2];g++}return null}r("__print");var H=r("__util"),G=[-1,-1];a.NULL_NODE=-1;a.FORWARD_DIR=10;a.BACKWARD_DIR=20;a.TWO_WAY=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var g=a[d];switch(g.length){case 2:b.push(g[0],g[1]);break;case 3:c.push(g[0],g[1],g[2]);break;default:H.panic("Wrong graph constructor params")}}return{nodes:b,edges:c}};a.clone=function(a,b,c){if(b)for(var d=Array(a.nodes.length),
g=0;g<a.nodes.length;g+=2)d[g]=a.nodes[g],d[g+1]=b(a.nodes[g+1]);else d=H.clone_object_r(a.nodes);if(c)for(b=Array(a.edges.length),g=0;g<a.edges.length;g+=3)b[g]=a.edges[g],b[g+1]=a.edges[g+1],b[g+2]=c(a.edges[g+2]);else b=H.clone_object_r(a.edges);return a={nodes:d,edges:b}};a.create_node_edge_arr=function(a,b){for(var c=[],d=[],g=0;g<a.length;g++)c.push(a[g][0],a[g][1]);for(g=0;g<b.length;g++)d.push(b[g][0],b[g][1],b[g][2]);return{nodes:c,edges:d}};a.append_node=u;a.has_node=h;a.append_edge=b;a.remove_node=
f;a.remove_edge=l;a.remove_edge_by_attr=function(a,b,c,d){C(a,b,c)||H.panic("Edge not found");a=a.edges;for(var g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c&&a[g+2][0]==d[0]&&a[g+2][1]==d[1]){a.splice(g,3);break}};a.append_node_attr=function(a,b){if(-1==e(a,b)){var c=q(a);u(a,c,b);return c}H.panic("Non-unique attribute")};a.replace_edge_attr=function(a,b,c,d,g){a=a.edges;for(var k=0;k<a.length;k+=3)a[k]==b&&a[k+1]==c&&a[k+2]==d&&(a[k+2]=g)};a.append_subgraph=function(a,c,d,g){d=d||[];g=g||[];for(var k=
{},m=0;m<a.nodes.length;m+=2){var e=a.nodes[m],f=a.nodes[m+1],t=q(c);u(c,t,f);k[e]=t}for(m=0;m<a.edges.length;m+=3)f=k[a.edges[m]],t=k[a.edges[m+1]],e=a.edges[m+2],b(c,f,t,e);for(m=0;m<d.length;m+=3)f=k[d[m]],a=d[m+1],e=d[m+2],b(c,f,a,e);for(m=0;m<g.length;m+=3)d=g[m],t=k[g[m+1]],e=g[m+2],b(c,d,t,e)};a.gen_node_id=q;a.node_by_attr=e;a.append_edge_attr=function(a,c,d,g){c=e(a,c);d=e(a,d);-1!=c&&-1!=d?b(a,c,d,g):H.panic("Attributes not found")};a.traverse=function(a,b){for(var c=a.nodes,d=0;d<c.length&&
!b(c[d],c[d+1]);d+=2);};a.traverse_edges=function(a,b){for(var c=a.edges,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.traverse_inputs=function(a,b,c){for(var d=a.edges,g=0;g<d.length;g+=3)if(d[g+1]==b){var k=d[g];if(c(k,y(a,k),d[g+2]))break}};a.traverse_outputs=function(a,b,c){for(var d=a.edges,g=0;g<d.length;g+=3)if(d[g]==b){var k=d[g+1];if(c(k,y(a,k),d[g+2]))break}};a.topsort=n;a.topsort_attr=function(a){a=n(a).nodes;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.is_connected=function(a){};
a.subgraph_node_conn=function(a,b,d){h(a,b)||H.panic("No such node");var g={};p(a,g);c(a,b,g,d);b=[];for(var m in g)g[m]&&(m=Number(m),b.push(m,y(a,m)));a={nodes:b,edges:a.edges.slice(0)};k(a);return a};a.cleanup_loose_edges=k;a.get_source_nodes=function(a){for(var b=[],c=a.nodes,d=0;d<c.length;d+=2){var g=c[d];K(a,g)||b.push(g)}return b};a.get_sink_nodes=m;a.match=function(a,b,c,d){var g={};g.g1=A(a);g.g2=A(b);g.node_comp=c||function(a,b){return a==b};g.edge_comp=d||function(a,b){return a==b};d=
a.nodes.length/2;var k=b.nodes.length/2;g.n1=d;g.n2=k;g.order=0;g.core_len=g.orig_core_len=0;g.t1both_len=g.t1in_len=g.t1out_len=0;g.t2both_len=g.t2in_len=g.t2out_len=0;g.added_node1=-1;g.core_1=Array(d);g.core_2=Array(k);g.in_1=Array(d);g.in_2=Array(k);g.out_1=Array(d);g.out_2=Array(k);g.share_count=[1];for(c=0;c<d;c++)g.core_1[c]=-1,g.in_1[c]=0,g.out_1[c]=0;for(c=0;c<k;c++)g.core_2[c]=-1,g.in_2[c]=0,g.out_2[c]=0;k=Array(d);d=Array(d);if(E(k,d,g)){for(c=0;c<k.length;c++)k[c]=a.nodes[2*k[c]],d[c]=
b.nodes[2*d[c]];return[k,d]}return null};a.get_node_id=function(a,b){for(var c=a.nodes,d=1;d<c.length;d+=2)if(c[d]==b)return c[d-1];return null};a.get_node_attr=y;a.out_edge_count=D;a.in_edge_count=K;a.get_out_edge=d;a.get_in_edge=t;a.get_edge_count=x;a.get_edge_attr=g;a.replace=function(a,b,c){for(var d=a.edges,g=q(a),k=0;k<b.length;k++){var m=b[k];f(a,m);for(var e=0;e<d.length;e+=3)d[e]==m&&(d[e]=g),d[e+1]==m&&(d[e+1]=g),d[e]==d[e+1]&&(d.splice(e,3),e-=3)}u(a,g,c)};a.reconnect_edges=function(a,
b,c,d,g){C(a,b,c)||H.panic("Edge not found");a=a.edges;for(var k=0;k<a.length;k+=3)a[k]==b&&a[k+1]==c&&(a[k]=d,a[k+1]=g)};a.enforce_acyclic=function(a,b){function c(a,b){if(-1!=f.indexOf(a)){var d=f.slice(f.indexOf(a));if(-1!=g[d[d.length-1]].indexOf(d[0])){t.push([a,d[d.length-1]]);return}}f.push(a);for(d=0;d<b.length;d++)b[d]in g&&c(b[d],g[b[d]])}b||(b=m(a)[0]);var d=a.edges;if(!d.length||-1==d.indexOf(b))return a;for(var g={},k=0,e=0;e<d.length;e+=3)d[e+1]in g?g[d[e+1]].push(d[e]):g[d[e+1]]=[d[e]],
k++;var f=[],t=[];c(b,g[b]);for(e=0;e<t.length;e++)for(var h=k=0;h<d.length;h+=3)t[e][1]==d[h+1]&&t[e][0]==d[h]&&l(a,d[h],d[h+1],k),k++;return a};a.debug_dot=function(a,b,c){var d=a.nodes;a=a.edges;var g;g="digraph debug {\n    node [shape=box];\n";for(var k=0;k<d.length;k+=2){var m=d[k],e=d[k+1],e=b?b(m,e):String(m);g+="    ";g+=String(m)+' [label="'+e.replace(/\"/g,'\\"')+'"];\n'}for(k=0;k<a.length;k+=3)b=a[k],d=a[k+1],e=a[k+2],g+="    ",g+=String(b)+" -> "+String(d),c&&(g+=' [label="'+c(b,d,e)+
'"]'),g+=";\n";return g+="}"}};b4w.module.__ipc=function(a,r){function u(a,b,m){for(var e=0;e<k.length;e+=2)k[e+1]==a&&(c[e+Number(!b)]=m)}function h(a){for(var b=0;b<a.length;b++){var c=a[b],k=0,m;for(m in c){var e=c[m];switch(e.constructor){case Float32Array:k+=e.length;break;case Number:k+=1}}--k;c.len=k}}var b=!0;a.IN_LOADED=0;var f=a.IN_COLLISION=1,l=a.IN_COLLISION_POS_NORM=2;a.IN_COLLISION_IMPULSE=3;a.IN_ERROR=4;a.IN_FBMSG=5;a.IN_FLOATER_BOB_TRANSFORM=6;a.IN_LOG=7;var q=a.IN_PROP_OFFSET=8,e=a.IN_RAY_HIT=9,n=a.IN_RAY_HIT_POS_NORM=
10;a.IN_REMOVE_RAY_TEST=11;var p=a.IN_TRANSFORM=12;a.IN_VEHICLE_SPEED=13;a.IN_PING=14;a.IN_FPS=15;a.IN_DEBUG_STATS=16;a.OUT_INIT=100;a.OUT_ACTIVATE=101;a.OUT_ADD_BOAT_BOB=102;a.OUT_ADD_CAR_WHEEL=103;a.OUT_ADD_FLOATER_BOB=104;a.OUT_APPEND_BOUNDING_BODY=105;a.OUT_APPEND_BOAT=106;a.OUT_APPEND_CAR=107;a.OUT_APPEND_CHARACTER=108;a.OUT_APPEND_COLLISION_TEST=109;a.OUT_APPEND_CONSTRAINT=110;a.OUT_APPEND_FLOATER=111;a.OUT_APPEND_GHOST_MESH_BODY=112;a.OUT_APPEND_STATIC_MESH_BODY=113;a.OUT_APPEND_WATER=114;
a.OUT_REMOVE_BODY=115;a.OUT_APPLY_CENTRAL_FORCE=116;a.OUT_APPLY_COLLISION_IMPULSE_TEST=117;a.OUT_APPLY_TORQUE=118;a.OUT_CHARACTER_JUMP=119;a.OUT_CHARACTER_ROTATION_INCREMENT=120;a.OUT_CLEAR_COLLISION_IMPULSE_TEST=121;a.OUT_DISABLE_SIMULATION=122;a.OUT_ENABLE_SIMULATION=123;a.OUT_PAUSE=124;a.OUT_APPEND_RAY_TEST=125;a.OUT_REMOVE_RAY_TEST=126;a.OUT_CHANGE_RAY_TEST_FROM_TO=127;a.OUT_REMOVE_COLLISION_TEST=128;a.OUT_REMOVE_CONSTRAINT=129;a.OUT_RESUME=130;a.OUT_SET_CHARACTER_FLY_VELOCITY=131;a.OUT_SET_CHARACTER_HOR_ROTATION=
132;a.OUT_SET_CHARACTER_MOVE_DIR=133;a.OUT_SET_CHARACTER_MOVE_TYPE=134;a.OUT_SET_CHARACTER_ROTATION=135;a.OUT_SET_CHARACTER_RUN_VELOCITY=136;a.OUT_SET_CHARACTER_VERT_ROTATION=137;a.OUT_SET_CHARACTER_WALK_VELOCITY=138;a.OUT_SET_GRAVITY=139;a.OUT_SET_LINEAR_VELOCITY=140;var B=a.OUT_SET_TRANSFORM=141;a.OUT_SET_WATER_TIME=142;a.OUT_ADD_WATER_WRAPPER=143;a.OUT_UPDATE_BOAT_CONTROLS=144;a.OUT_UPDATE_CAR_CONTROLS=145;a.OUT_PING=146;a.OUT_DEBUG=147;a.OUT_UPDATE_WORLD=148;var c=b4w.worker_listeners,k=b4w.worker_namespaces,
m={msg_id:p,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),len:0},A={msg_id:q,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},E={msg_id:e,id:0,body_id_hit:0,hit_fract:0,hit_time:0,len:0},w={msg_id:n,id:0,body_id_hit:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},v={msg_id:f,body_id_a:0,body_id_b:0,result:0,len:0},z={msg_id:l,body_id_a:0,body_id_b:0,
result:0,coll_point:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},y={msg_id:B,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},D=[m,A,E,w,v,z,y];a.create_worker=function(a,d){var m={is_main:a?!0:!1,web_worker:null,buf_arr:[],fb_worker_ns:""};if(d)if(m.web_worker={addEventListener:function(a,b,c){"message"!=a&&panic("Wrong web worker event");u(m.fb_worker_ns,m.is_main,b)},removeEventListener:function(a,b,c){"message"!=a&&panic("Wrong web worker event");u(m.fb_worker_ns,
m.is_main,null)},postMessage:function(a,b){var d;a:{for(d=0;d<k.length;d+=2)if(k[d+1]==m.fb_worker_ns){d=c[d+Number(!!m.is_main)];break a}d=null}d({data:a})},terminate:function(){for(var a=0;a<k.length;a+=2)if(k[a+1]==m.fb_worker_ns){c.splice(a,2);k.splice(a,2);break}}},m.is_main){var e=r("__util"),f=r("__container"),h=b4w.get_namespace(r),e=e.unique_name(h+"_worker");k.push(h);k.push(e);c.push(null);c.push(null);m.fb_worker_ns=e;(f=f.find_script(a))?b?f.addEventListener("load",function(){b4w.require("__bindings",
m.fb_worker_ns)},!1):(b4w.cleanup("__bindings",m.fb_worker_ns),b4w.cleanup("__ipc",m.fb_worker_ns),b4w.require("__bindings",m.fb_worker_ns)):(f=document.createElement("script"),f.src=a,f.defer="defer",f.async="async",f.addEventListener("load",function(){b=!1;b4w.require("__bindings",m.fb_worker_ns)},!1),document.head.appendChild(f))}else m.fb_worker_ns=b4w.get_namespace(r);else m.web_worker=a?new Worker(a):self;return m};a.attach_handler=function(a,b){h(D);var c=function(k){if(k.constructor==ArrayBuffer)k=
new Float32Array(k);else if(k[0].constructor==ArrayBuffer){for(var h=0;h<k.length;h++)c(k[h]);return}h=k[0]|0;switch(h){case p:var x=m;x.body_id=k[1]|0;x.time=k[2];x.trans[0]=k[3];x.trans[1]=k[4];x.trans[2]=k[5];x.quat[0]=k[6];x.quat[1]=k[7];x.quat[2]=k[8];x.quat[3]=k[9];x.linvel[0]=k[10];x.linvel[1]=k[11];x.linvel[2]=k[12];x.angvel[0]=k[13];x.angvel[1]=k[14];x.angvel[2]=k[15];break;case q:x=A;x.chassis_hull_body_id=k[1]|0;x.prop_ind=k[2]|0;x.trans[0]=k[3];x.trans[1]=k[4];x.trans[2]=k[5];x.quat[0]=
k[6];x.quat[1]=k[7];x.quat[2]=k[8];x.quat[3]=k[9];break;case e:x=E;x.id=k[1]|0;x.body_id_hit=k[2]|0;x.hit_fract=k[3];x.hit_time=k[4];break;case n:x=w;x.id=k[1]|0;x.body_id_hit=k[2]|0;x.hit_fract=k[3];x.hit_time=k[4];x.hit_pos[0]=k[5];x.hit_pos[1]=k[6];x.hit_pos[2]=k[7];x.hit_norm[0]=k[8];x.hit_norm[1]=k[9];x.hit_norm[2]=k[10];break;case f:x=v;x.body_id_a=k[1]|0;x.body_id_b=k[2]|0;x.result=!!k[3];break;case l:x=z;x.body_id_a=k[1]|0;x.body_id_b=k[2]|0;x.result=!!k[3];x.coll_point[0]=k[4];x.coll_point[1]=
k[5];x.coll_point[2]=k[6];x.coll_norm[0]=k[7];x.coll_norm[1]=k[8];x.coll_norm[2]=k[9];x.coll_dist=k[10];break;case B:x=y;x.body_id=k[1]|0;x.trans[0]=k[2];x.trans[1]=k[3];x.trans[2]=k[4];x.quat[0]=k[5];x.quat[1]=k[6];x.quat[2]=k[7];x.quat[3]=k[8];break;default:x=k}b(a,h,x)};a.web_worker.addEventListener("message",function(a){c(a.data)},!1)};a.cleanup=function(){};a.post_msg=function(a,b){if(a)switch(b){case p:var c=m,k=new Float32Array(c.len);k[0]=c.msg_id;k[1]=c.body_id;k[2]=c.time;k[3]=c.trans[0];
k[4]=c.trans[1];k[5]=c.trans[2];k[6]=c.quat[0];k[7]=c.quat[1];k[8]=c.quat[2];k[9]=c.quat[3];k[10]=c.linvel[0];k[11]=c.linvel[1];k[12]=c.linvel[2];k[13]=c.angvel[0];k[14]=c.angvel[1];k[15]=c.angvel[2];a.buf_arr.push(k.buffer);break;case q:c=A;k=new Float32Array(c.len);k[0]=c.msg_id;k[1]=c.chassis_hull_body_id;k[2]=c.prop_ind;k[3]=c.trans[0];k[4]=c.trans[1];k[5]=c.trans[2];k[6]=c.quat[0];k[7]=c.quat[1];k[8]=c.quat[2];k[9]=c.quat[3];a.buf_arr.push(k.buffer);break;case e:c=E;k=new Float32Array(c.len);
k[0]=c.msg_id;k[1]=c.id;k[2]=c.body_id_hit;k[3]=c.hit_fract;k[4]=c.hit_time;a.buf_arr.push(k.buffer);break;case n:c=w;k=new Float32Array(c.len);k[0]=c.msg_id;k[1]=c.id;k[2]=c.body_id_hit;k[3]=c.hit_fract;k[4]=c.hit_time;k[5]=c.hit_pos[0];k[6]=c.hit_pos[1];k[7]=c.hit_pos[2];k[8]=c.hit_norm[0];k[9]=c.hit_norm[1];k[10]=c.hit_norm[2];a.buf_arr.push(k.buffer);break;case f:c=v;k=new Float32Array(c.len);k[0]=c.msg_id;k[1]=c.body_id_a;k[2]=c.body_id_b;k[3]=c.result;a.buf_arr.push(k.buffer);break;case l:c=
z;k=new Float32Array(c.len);k[0]=c.msg_id;k[1]=c.body_id_a;k[2]=c.body_id_b;k[3]=c.result;k[4]=c.coll_point[0];k[5]=c.coll_point[1];k[6]=c.coll_point[2];k[7]=c.coll_norm[0];k[8]=c.coll_norm[1];k[9]=c.coll_norm[2];k[10]=c.coll_dist;a.buf_arr.push(k.buffer);break;case B:c=y;k=new Float32Array(c.len);k[0]=c.msg_id;k[1]=c.body_id;k[2]=c.trans[0];k[3]=c.trans[1];k[4]=c.trans[2];k[5]=c.quat[0];k[6]=c.quat[1];k[7]=c.quat[2];k[8]=c.quat[3];a.buf_arr.push(k.buffer);break;default:k=[];for(c=1;c<arguments.length;c++)k.push(arguments[c]);
a.web_worker.postMessage(k)}};a.post_msg_arr=function(a){a&&a.buf_arr.length&&(a.web_worker.postMessage(a.buf_arr),a.buf_arr.length=0)};a.get_msg_cache=function(a){switch(a){case p:return m;case q:return A;case e:return E;case n:return w;case f:return v;case l:return z;case B:return y;default:return null}};a.terminate=function(a){a.web_worker.terminate();a.web_worker=null};a.is_active=function(a){return!!a.web_worker};a.is_fallback=function(a){return!!a.fb_worker_ns}};b4w.module.__hud=function(a,r){function u(a){a.font="bold 15px Courier New";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function h(a){b(' SCENE "'+a.name+'"');b(" Active                 Subscene   Lamps   Size   RenderCalls   Time");if(a._render){var c=0,k=0,e=0;n.traverse(a._render.graph,function(a,m){if(m.type!=p.SINK){for(var f=Math.round(m.camera.width)+"x"+Math.round(m.camera.height),h=0,l=0;l<m.draw_data.length;l++)h+=m.draw_data[l].bundles.length;l=m.debug_render_calls;if(m.type==
p.MAIN_CUBE_REFLECT||m.type==p.MAIN_CUBE_REFLECT_BLEND)h*=6;var d=m.do_render,t=d?m.debug_render_time:0;m.enqueue||(m.debug_render_time=0);var n=d?" (\u2713)":" (\u2715)",B=p.subs_label(m);b(n,B,m.num_lights,f,l,"of",h,"  ",t.toFixed(3));m.debug_render_calls=0;d&&(c+=h,k+=l,e+=t)}});return[c,k,e]}b("No INFO")}function b(){for(var a=80+20*k[0],b=arguments[0],e=1;e<arguments.length;e++){for(var f=B[e]-String(arguments[e]).length,h="",l=0;l<f;l++)h+=" ";b+=h+arguments[e]}k[0]++;c.fillText(b,30,a)}function f(a,
b,c,k,e){e.x=a;e.y=b;e.w=c;e.h=k;return e}function l(a,b,c){b*=a.w;c.x=a.x+b;c.y=a.y;c.w=a.w-2*b;c.h=a.h;return c}function q(a){return a.x+a.w/2}function e(a){var b=c,k={x:0,y:0,w:0,h:0};f(0,0,b.canvas.width,b.canvas.height,k);l(k,.01,k);b=.02*k.h;k.x=k.x;k.y+=b;k.w=k.w;k.h-=2*b;b=k.w/8;k.x+=b*a;k.y=k.y;k.w=b;k.h=k.h;l(k,.02,k);return k}var n=r("__graph");r("__print");var p=r("__subscene"),B=[5,30,4,10,5,3,5],c=null,k=[0,0];a.init=function(a){a=a.getContext("2d");u(a);return c=a};a.update_dim=function(){c&&
u(c)};a.reset=function(){var a=c;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),k[0]=0,k[1]=0)};a.show_debug_info=function(a,e){var f=c;if(f){f.textAlign="left";f.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/e).toFixed(2));k[0]++;for(var l=f=0,n=0,p=0;p<a.length;p++){var B=h(a[p]),f=f+B[0],l=l+B[1],n=n+B[2];k[0]++}b(" ----------------------------------------------------------------");b("    ","TOTAL ACTIVE","","",l,"of",
f,"  ",n.toFixed(3))}};a.print=function(){var a=c;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,k,f,h,l,n){var p=c;if(p){b=e(b);var B=b.h/5;b.x=b.x;b.y+=4*B;b.w=b.w;b.h=B;p.textAlign="center";p.fillStyle="#00FF00";c.fillText(a,q(b),b.y-10);p.strokeStyle="#00FF00";p.lineWidth=.5;p.beginPath();p.moveTo(b.x,b.y);p.lineTo(b.x+b.w,b.y);p.lineTo(b.x+b.w,b.y+b.h);p.lineTo(b.x,b.y+b.h);p.closePath();p.stroke();if(!l&&!n)for(l=1E6,n=-1E6,a=0;a<k.length;a++)l=
Math.min(l,k[a]),n=Math.max(n,k[a]);p.textAlign="right";c.fillText(String(l),b.x-10,b.y+b.h);c.fillText(String(n),b.x-10,b.y);p.textAlign="center";c.fillText(String(f),b.x,b.y+b.h+15);c.fillText(String(h),b.x+b.w,b.y+b.h+15);p.strokeStyle="#FF0000";p.lineWidth=1.5;p.beginPath();f=b.w/(k.length-1);n=b.h/(n-l);for(a=0;a<k.length;a++)h=b.x+f*a,B=b.y+b.h-(k[a]-l)*n,0==a?p.moveTo(h,B):p.lineTo(h,B);p.stroke()}};a.draw_mixer_strip=function(a,b,k,h,l,n,p){var B=c;if(B)for(B.textAlign="center",B.fillStyle=
"#00FF00",B.font="bold 12px Courier",k=e(k),c.fillText(b?"["+a+"]":a,q(k),k.y),0<=n&&c.fillText(n?"[M]":"[ ]",q(k)-15,k.y+30),0<=p&&c.fillText(p?"[S]":"[ ]",q(k)+15,k.y+30),a={x:0,y:0,w:0,h:0},b=0;b<h.length;b++){var K=h[b];(p="VOLUME"==K[0])?f(k.x,k.y+350,k.w,250,a):f(k.x,k.y+50+50*b,k.w,k.h,a);n=B;var d=a,t=b==l,C=K[0],M=K[1],x=K[2],g=K[3],H=K[5],K=(g-x)/K[4],K=1>K?Math.floor(1/K-1E-5).toFixed(0).length:0,H=H?Math.log(M/x)/Math.log(g/x):(M-x)/(g-x);n.textAlign="center";t?n.fillText("["+C+"]",q(d),
d.y):n.fillText(C,q(d),d.y);n.strokeStyle="#00FF00";n.lineWidth=p?3:1;p?(n.textAlign="right",n.fillText(g.toFixed(K),q(d)-10,d.y+15),n.textAlign="right",n.fillText(x.toFixed(K),q(d)-10,d.y+d.h-15)):(n.textAlign="right",n.fillText(x.toFixed(K),d.x+28,d.y+15),n.textAlign="left",n.fillText(g.toFixed(K),d.x+d.w-28,d.y+15));n.beginPath();if(p){var G=d.y+15+(d.h-30)*(1-H);n.moveTo(q(d),d.y+15);n.lineTo(q(d),d.y+d.h-15);n.moveTo(q(d)-5,d.y+15);n.lineTo(q(d)+5,d.y+15);n.moveTo(q(d)-5,d.y+d.h-15);n.lineTo(q(d)+
5,d.y+d.h-15);n.moveTo(q(d)-5,G);n.lineTo(q(d)+5,G)}else{var r=d.x+30+(d.w-60)*H;n.moveTo(d.x+30,d.y+15);n.lineTo(d.x+d.w-30,d.y+15);n.moveTo(d.x+30,d.y+15-5);n.lineTo(d.x+30,d.y+15+5);n.moveTo(d.x+d.w-30,d.y+15-5);n.lineTo(d.x+d.w-30,d.y+15+5);n.moveTo(r,d.y+15-5);n.lineTo(r,d.y+15+5)}n.stroke();"EQ_Q"==C?(t=M,t=1+1/(2*t*t)+Math.sqrt((2+1/(t*t))*(2+1/(t*t))/4-1),t=Math.log(t)/Math.log(2),p?(n.textAlign="left",n.fillText(M.toFixed(K),q(d)+10,G),n.textAlign="left",n.fillText("("+t.toFixed(K+1)+")",
q(d)+10,G+10)):(n.textAlign="right",n.fillText(M.toFixed(K),r,d.y+30),n.textAlign="left",n.fillText("("+t.toFixed(K+1)+")",r,d.y+30))):p?(n.textAlign="left",n.fillText(M.toFixed(K),q(d)+10,G)):(n.textAlign="center",n.fillText(M.toFixed(K),r,d.y+30))}}};b4w.module.__renderer=function(a,r){function u(a){for(var d=a.camera,k=a.draw_data,g=null,e=E.get_trans(d.world_tsr,ba),f=0;f<k.length;f++){var h=k[f];if(h.do_render){var n=h.shader,h=h.bundles;if(n.program!=g){C.useProgram(n.program);for(var g=a,I=d,x=n,B=x.transient_sc_uniform_setters,A=B.length;A--;){var v=B[A];v.fun(C,v.loc,g,I)}if(x.need_uniforms_update&&!x.no_permanent_uniforms)for(x.permanent_sc_uniform_setters.length||l(x),x=x.permanent_sc_uniform_setters,A=x.length;A--;)v=x[A],v.fun(C,v.loc,
g,I);g=n.program}for(I=0;I<h.length;I++)if(B=h[I],B.do_render){x=B.obj_render;A=B.batch;p.render_time_start_batch(A);p.is_debug_view_render_time_mode()&&"DEBUG_VIEW"==A.type&&(A.debug_main_batch_render_time=w.smooth(q.batch_get_debug_storage(A.debug_main_batch_id),A.debug_main_batch_render_time,1,15));if(U.alpha_sort&&A.z_sort){var v=x,B=B.info_for_z_sort_updates,H=e,S=A.bufs_data,R=z.dist(H,B.zsort_eye_last),y=U.alpha_sort_threshold*Math.min(B.bb_min_side,1);if(R>y||v.force_zsort)c.update_buffers_movable(S,
B,v.world_tsr,H),z.copy(H,B.zsort_eye_last),v.force_zsort=!1}v=a;B=A;H=n;y=H.transient_uniform_setters;for(S=y.length;S--;)R=y[S],R.fun(C,R.loc,x,B);if(H.need_uniforms_update&&!H.no_permanent_uniforms){H.permanent_uniform_setters.length||l(H);y=H.permanent_uniform_setters;for(S=y.length;S--;)R=y[S],R.fun(C,R.loc,x,B);H.need_uniforms_update=!1}C.depthMask(B.depth_mask);B.use_backface_culling?C.enable(C.CULL_FACE):C.disable(C.CULL_FACE);S=B.textures;R=C;for(y=0;y<S.length;y++){var va=S[y];R.activeTexture(R.TEXTURE0+
y);R.bindTexture(va.w_target,va.w_texture)}if(v.type==m.SKY){x=v;H=H.uniforms;S=x.camera.color_attachment.w_texture;R=x.cube_view_matrices;for(y=0;6>y;y++)if(va=b(y),U.clear_procedural_sky_hack?(C.bindTexture(C.TEXTURE_CUBE_MAP,S),C.texImage2D(va,0,C.RGBA,1,1,0,C.RGBA,C.UNSIGNED_BYTE,t)):(C.uniformMatrix4fv(H.u_cube_view_matrix,!1,R[y]),C.uniform4fv(H.u_sky_tex_fac,x.sky_tex_fac),C.uniform3fv(H.u_sky_tex_color,x.sky_tex_color),C.uniform1f(H.u_sky_tex_dvar,x.sky_tex_default_value),C.uniform3fv(H.u_horizon_color,
x.horizon_color),C.uniform3fv(H.u_zenith_color,x.zenith_color),C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,va,S,0),G(B,0)),x.need_fog_update&&3!=y){var va=x,M=y,J=F;U.clear_procedural_sky_hack?J.set(t):(C.readPixels(191,191,1,1,C.RGBA,C.UNSIGNED_BYTE,J),255!=J[0]&&255!=J[1]&&255!=J[2]||C.readPixels(191,220,1,1,C.RGBA,C.UNSIGNED_BYTE,J));var D=J[0],za=J[1],J=J[2],D=D/255,za=za/255,J=J/255;2===M?(va.cube_fog[3]=D,va.cube_fog[7]=za,va.cube_fog[11]=J):2>M?(va.cube_fog[4*M]=D,va.cube_fog[4*
M+1]=za,va.cube_fog[4*M+2]=J):(va.cube_fog[4*(M-2)]=D,va.cube_fog[4*(M-2)+1]=za,va.cube_fog[4*(M-2)+2]=J)}v.debug_render_calls+=6}else G(B,x.va_frame),v.debug_render_calls++;p.render_time_stop_batch(A);p.is_debug_view_render_time_mode()&&"MAIN"==A.type&&q.batch_set_debug_storage(A.id,A.debug_render_time)}}}}function h(a){if(a){var b=(a.clear_color?C.COLOR_BUFFER_BIT:0)|(a.clear_depth?C.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case m.MAIN_GLOW:a=d;break;case m.SHADOW_CAST:a=y;break;case m.SHADOW_RECEIVE:a=
D;break;case m.COLOR_PICKING:case m.COLOR_PICKING_XRAY:case m.ANCHOR_VISIBILITY:a=K;break;case m.OUTLINE_MASK:case m.SMAA_BLENDING_WEIGHT_CALCULATION:case m.SMAA_EDGE_DETECTION:a=d;break;default:a=U.background_color}}else b=C.COLOR_BUFFER_BIT|C.DEPTH_BUFFER_BIT,a=U.background_color;C.colorMask(!0,!0,!0,!0);C.depthMask(!0);C.clearColor(a[0],a[1],a[2],a[3]);C.clear(b)}function b(a){switch(a){case 0:return C.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return C.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return C.TEXTURE_CUBE_MAP_POSITIVE_Y;
case 3:return C.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return C.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return C.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function f(a){var b=B.get_vertex_array_object(),c=a.attribute_setters,d=a.bufs_data,k=d.pointers;a.vaos.length=0;var g=1,m;for(m in k)g=Math.max(g,k[m].frames);for(k=0;k<g;k++){m=b.createVertexArray();H(m);d.ibo&&C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,d.ibo);for(var e=0;e<d.vbo_data.length;e++){C.bindBuffer(C.ARRAY_BUFFER,d.vbo_data[e].vbo);for(var f=0;f<c.length;f++){var h=
c[f];h.vbo_type==d.vbo_data[e].type&&(C.enableVertexAttribArray(h.loc),C.vertexAttribPointer(h.loc,h.num_comp,h.gl_type,h.gl_type==C.FLOAT?!1:!0,h.stride,h.base_offset+h.frame_length*k),x(h.loc,h.divisor))}}H(null);a.vaos.push(m)}}function l(a){var b=a.uniforms,c=a.transient_uniform_setters,d=a.permanent_uniform_setters,k=a.transient_sc_uniform_setters,g=a.permanent_sc_uniform_setters;c.length=0;d.length=0;k.length=0;g.length=0;for(var m in b){var e=!1,f=null,h=null;switch(m){case "u_proj_matrix":f=
function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.proj_matrix)};e=!0;break;case "u_view_refl_matrix":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.view_refl_matrix)};e=!0;break;case "u_view_tsr":case "u_view_tsr_frag":f=function(a,b,c,d){d.reflection_plane?a.uniformMatrix3fv(b,!1,d.real_view_tsr):a.uniformMatrix3fv(b,!1,d.view_tsr)};e=!0;break;case "u_view_tsr_inverse":f=function(a,b,c,d){d.reflection_plane?a.uniformMatrix3fv(b,!1,d.real_view_tsr_inv):a.uniformMatrix3fv(b,!1,d.view_tsr_inv)};e=!0;break;
case "u_shadow_cast_billboard_view_tsr":f=function(a,b,c,d){a.uniformMatrix3fv(b,!1,d.shadow_cast_billboard_view_tsr)};e=!0;break;case "u_view_proj_prev":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.prev_view_proj_matrix)};e=!0;break;case "u_view_proj_matrix":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.view_proj_matrix)};e=!0;break;case "u_view_proj_inverse":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.view_proj_inv_matrix)};e=!0;break;case "u_sky_vp_inverse":f=function(a,b,c,d){a.uniformMatrix4fv(b,
!1,d.sky_vp_inv_matrix)};e=!0;break;case "u_camera_eye":case "u_camera_eye_frag":f=function(a,b,c,d){a.uniform3fv(b,E.get_trans(d.world_tsr,ba))};e=!0;break;case "u_camera_quat":f=function(a,b,c,d){a.uniform4fv(b,E.get_quat(d.world_tsr,L))};e=!0;break;case "u_view_max_depth":f=function(a,b,c,d){a.uniform1f(b,d.far)};e=!0;break;case "u_camera_range":f=function(a,b,c,d){a.uniform2f(b,d.near,d.far)};break;case "u_csm_center_dists":f=function(a,b,c,d){a.uniform4fv(b,d.csm_center_dists)};break;case "u_height":f=
function(a,b,c,d){a.uniform1f(b,d.height)};e=!0;break;case "u_pcf_blur_radii":f=function(a,b,c,d){a.uniform4fv(b,d.pcf_blur_radii)};break;case "u_dof_dist":f=function(a,b,c,d){d.dof_on?a.uniform1f(b,d.dof_distance):a.uniform1f(b,0)};e=!0;break;case "u_dof_front_start":f=function(a,b,c,d){a.uniform1f(b,d.dof_front_start)};e=!0;break;case "u_dof_front_end":f=function(a,b,c,d){a.uniform1f(b,d.dof_front_end)};e=!0;break;case "u_dof_rear_start":f=function(a,b,c,d){a.uniform1f(b,d.dof_rear_start)};e=!0;
break;case "u_dof_rear_end":f=function(a,b,c,d){a.uniform1f(b,d.dof_rear_end)};e=!0;break;case "u_dof_bokeh_intensity":f=function(a,b,c,d){a.uniform1f(b,d.dof_bokeh_intensity)};e=!0;break;case "u_cam_water_depth":f=function(a,b,c,d){a.uniform1f(b,c.cam_water_depth)};e=!0;break;case "u_waves_height":f=function(a,b,c,d){a.uniform1f(b,c.water_waves_height)};break;case "u_waves_length":f=function(a,b,c,d){a.uniform1f(b,c.water_waves_length)};break;case "u_fog_color_density":f=function(a,b,c,d){a.uniform4fv(b,
c.fog_color_density)};break;case "u_fog_params":f=function(a,b,c,d){a.uniform4fv(b,c.fog_params)};break;case "u_underwater_fog_color_density":f=function(a,b,c,d){a.uniform4fv(b,c.water_fog_color_density)};break;case "u_bloom_key":f=function(a,b,c,d){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":f=function(a,b,c,d){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":f=function(a,b,c,d){a.uniform1f(b,c.time)};e=!0;break;case "u_wind":f=function(a,b,c,d){a.uniform3fv(b,c.wind)};e=!0;break;
case "u_sky_tex_dvar":f=function(a,b,c,d){a.uniform1f(b,c.sky_tex_default_value)};break;case "u_sky_tex_fac":f=function(a,b,c,d){a.uniform4fv(b,c.sky_tex_fac)};break;case "u_sky_tex_color":f=function(a,b,c,d){a.uniform3fv(b,c.sky_tex_color)};break;case "u_horizon_color":f=function(a,b,c,d){a.uniform3fv(b,c.horizon_color)};break;case "u_zenith_color":f=function(a,b,c,d){a.uniform3fv(b,c.zenith_color)};break;case "u_environment_energy":f=function(a,b,c,d){a.uniform1f(b,c.environment_energy)};break;
case "u_sky_color":f=function(a,b,c,d){a.uniform3fv(b,c.sky_color)};break;case "u_rayleigh_brightness":f=function(a,b,c,d){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":f=function(a,b,c,d){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":f=function(a,b,c,d){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":f=function(a,b,c,d){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":f=function(a,b,c,d){a.uniform1f(b,c.rayleigh_strength)};
break;case "u_mie_strength":f=function(a,b,c,d){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":f=function(a,b,c,d){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":f=function(a,b,c,d){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":f=function(a,b,c,d){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":f=function(a,b,c,d){a.uniform4fv(b,c.light_positions)};break;case "u_light_directions":f=function(a,b,c,
d){a.uniform3fv(b,c.light_directions)};break;case "u_light_color_intensities":f=function(a,b,c,d){a.uniform4fv(b,c.light_color_intensities)};break;case "u_sun_quaternion":f=function(a,b,c,d){a.uniform4fv(b,c.sun_quaternion)};break;case "u_sun_intensity":f=function(a,b,c,d){a.uniform3fv(b,c.sun_intensity)};break;case "u_sun_direction":f=function(a,b,c,d){a.uniform3fv(b,c.sun_direction)};break;case "u_debug_view_mode":f=function(a,b,c,d){a.uniform1i(b,c.debug_view_mode)};break;case "u_debug_colors_seed":f=
function(a,b,c,d){a.uniform1f(b,c.debug_colors_seed)};break;case "u_debug_render_time_threshold":f=function(a,b,c,d){a.uniform1f(b,c.debug_render_time_threshold)};break;case "u_subpixel_jitter":f=function(a,b,c,d){a.uniform2fv(b,c.jitter_projection_space)};e=!0;break;case "u_subsample_indices":f=function(a,b,c,d){a.uniform4fv(b,c.jitter_subsample_ind)};e=!0;break;case "u_radial_blur_step":f=function(a,b,c,d){a.uniform1f(b,c.radial_blur_step)};break;case "u_god_rays_intensity":f=function(a,b,c,d){a.uniform1f(b,
c.god_rays_intensity)};break;case "u_ssao_radius_increase":f=function(a,b,c,d){a.uniform1f(b,c.ssao_radius_increase)};break;case "u_ssao_blur_discard_value":f=function(a,b,c,d){a.uniform1f(b,c.ssao_blur_discard_value)};e=!0;break;case "u_ssao_influence":f=function(a,b,c,d){a.uniform1f(b,c.ssao_influence)};break;case "u_ssao_dist_factor":f=function(a,b,c,d){a.uniform1f(b,c.ssao_dist_factor)};break;case "u_texel_size":f=function(a,b,c,d){a.uniform2fv(b,c.texel_size)};e=!0;break;case "u_normal_offset":f=
function(a,b,c,d){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_v_light_ts":f=function(a,b,c,d){a.uniform4fv(b,c.v_light_ts)};e=!0;break;case "u_v_light_r":f=function(a,b,c,d){a.uniform4fv(b,c.v_light_r)};e=!0;break;case "u_v_light_tsr":f=function(a,b,c,d){a.uniformMatrix3fv(b,!1,c.v_light_tsr)};e=!0;break;case "u_p_light_matrix0":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,c.p_light_matrix[0])};e=!0;break;case "u_p_light_matrix1":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,c.p_light_matrix[1])};
e=!0;break;case "u_p_light_matrix2":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,c.p_light_matrix[2])};e=!0;break;case "u_p_light_matrix3":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,c.p_light_matrix[3])};e=!0;break;case "u_outline_color":f=function(a,b,c,d){a.uniform3fv(b,c.outline_color)};break;case "u_draw_outline":f=function(a,b,c,d){a.uniform1f(b,c.draw_outline_flag)};e=!0;break;case "u_glow_mask_small_coeff":f=function(a,b,c,d){a.uniform1f(b,c.small_glow_mask_coeff)};e=!0;break;case "u_glow_mask_large_coeff":f=
function(a,b,c,d){a.uniform1f(b,c.large_glow_mask_coeff)};e=!0;break;case "u_brightness":f=function(a,b,c,d){a.uniform1f(b,c.brightness)};break;case "u_contrast":f=function(a,b,c,d){a.uniform1f(b,c.contrast)};break;case "u_exposure":f=function(a,b,c,d){a.uniform1f(b,c.exposure)};break;case "u_saturation":f=function(a,b,c,d){a.uniform1f(b,c.saturation)};break;case "u_enable_hmd_stereo":f=function(a,b,c,d){a.uniform1i(b,c.enable_hmd_stereo)};break;case "u_distortion_params":f=function(a,b,c,d){a.uniform4fv(b,
c.distortion_params)};break;case "u_chromatic_aberration_coefs":f=function(a,b,c,d){a.uniform4fv(b,c.chromatic_aberration_coefs)};break;case "u_motion_blur_exp":f=function(a,b,c,d){a.uniform1f(b,c.motion_blur_exp)};e=!0;break;case "u_motion_blur_decay_threshold":f=function(a,b,c,d){a.uniform1f(b,c.mb_decay_threshold)};e=!0;break;case "u_model_tsr":h=function(a,b,c,d){a.uniformMatrix3fv(b,!1,c.world_tsr)};e=!0;break;case "u_model_tsr_inverse":h=function(a,b,c,d){a.uniformMatrix3fv(b,!1,c.world_tsr_inv)};
e=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,c.trans_before)};e=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,c.trans_after)};e=!0;break;case "u_arm_rel_trans":h=function(a,b,c,d){a.uniform4fv(b,c.arm_rel_trans)};e=!0;break;case "u_arm_rel_quat":h=function(a,b,c,d){a.uniform4fv(b,c.arm_rel_quat)};e=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,E.get_quat(c.world_tsr,L))};e=!0;break;case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,c.quats_before)};e=!0;
break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,c.quats_after)};e=!0;break;case "u_frame_factor":h=function(a,b,c,d){a.uniform1f(b,c.frame_factor)};e=!0;break;case "au_center_pos":h=function(a,b,c,d){};e=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,c.wind_bending_amp)};e=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,c.wind_bending_freq)};e=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,c.detail_bending_freq)};e=!0;
break;case "au_detail_bending_amp":h=function(a,b,c,d){a.uniform1f(b,c.detail_bending_amp)};e=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,c.branch_bending_amp)};e=!0;break;case "u_node_values":h=function(a,b,c,d){a.uniform1fv(b,d.node_values)};e=!0;break;case "u_node_rgbs":h=function(a,b,c,d){a.uniform3fv(b,d.node_rgbs)};e=!0;break;case "u_diffuse_color":h=function(a,b,c,d){a.uniform4fv(b,d.diffuse_color)};e=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d){a.uniform1f(b,
d.diffuse_intensity)};e=!0;break;case "u_diffuse_params":h=function(a,b,c,d){a.uniform2fv(b,d.diffuse_params)};e=!0;break;case "u_emit":h=function(a,b,c,d){a.uniform1f(b,d.emit)};e=!0;break;case "u_ambient":h=function(a,b,c,d){a.uniform1f(b,d.ambient)};e=!0;break;case "u_specular_color":h=function(a,b,c,d){a.uniform3fv(b,d.specular_color)};e=!0;break;case "u_specular_alpha":h=function(a,b,c,d){a.uniform1f(b,d.specular_alpha)};e=!0;break;case "u_specular_params":h=function(a,b,c,d){a.uniform3fv(b,
d.specular_params)};e=!0;break;case "u_reflect_factor":h=function(a,b,c,d){a.uniform1f(b,d.reflect_factor)};e=!0;break;case "u_mirror_factor":h=function(a,b,c,d){a.uniform1f(b,d.mirror_factor)};e=!0;break;case "u_grass_map_dim":h=function(a,b,c,d){a.uniform3fv(b,d.grass_map_dim)};e=!0;break;case "u_grass_size":h=function(a,b,c,d){a.uniform1f(b,d.grass_size)};e=!0;break;case "u_scale_threshold":h=function(a,b,c,d){a.uniform1f(b,d.grass_scale_threshold)};e=!0;break;case "u_cube_fog":h=function(a,b,
c,d){a.uniformMatrix4fv(b,!1,d.cube_fog)};break;case "u_jitter_amp":h=function(a,b,c,d){a.uniform1f(b,d.jitter_amp)};e=!0;break;case "u_jitter_freq":h=function(a,b,c,d){a.uniform1f(b,d.jitter_freq)};e=!0;break;case "u_wireframe_edge_color":h=function(a,b,c,d){a.uniform3fv(b,d.wireframe_edge_color)};break;case "u_cluster_id":h=function(a,b,c,d){a.uniform1f(b,d.cluster_id)};e=!0;break;case "u_batch_debug_id_color":h=function(a,b,c,d){a.uniform1f(b,d.debug_id_color)};e=!0;break;case "u_batch_debug_main_render_time":h=
function(a,b,c,d){a.uniform1f(b,d.debug_main_batch_render_time)};e=!0;break;case "u_refr_bump":h=function(a,b,c,d){a.uniform1f(b,d.refr_bump)};e=!0;break;case "u_line_width":h=function(a,b,c,d){a.uniform1f(b,d.line_width)};e=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d){a.uniform3fv(b,d.lamp_light_positions)};break;case "u_lamp_light_directions":h=function(a,b,c,d){a.uniform3fv(b,d.lamp_light_directions)};break;case "u_lamp_light_color_intensities":h=function(a,b,c,d){a.uniform3fv(b,
d.lamp_light_color_intensities)};break;case "u_halo_size":h=function(a,b,c,d){a.uniform1f(b,d.halo_size)};e=!0;break;case "u_halo_hardness":h=function(a,b,c,d){a.uniform1f(b,d.halo_hardness)};e=!0;break;case "u_halo_rings_color":h=function(a,b,c,d){a.uniform3fv(b,d.halo_rings_color)};e=!0;break;case "u_halo_lines_color":h=function(a,b,c,d){a.uniform3fv(b,d.halo_lines_color)};e=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d){a.uniform1f(b,d.halo_stars_blend)};e=!0;break;case "u_halo_stars_height":h=
function(a,b,c,d){a.uniform1f(b,d.halo_stars_height)};e=!0;break;case "u_fresnel_params":h=function(a,b,c,d){a.uniform4fv(b,d.fresnel_params)};e=!0;break;case "u_texture_scale":h=function(a,b,c,d){a.uniform3fv(b,d.texture_scale)};e=!0;break;case "u_parallax_scale":h=function(a,b,c,d){a.uniform1f(b,d.parallax_scale)};e=!0;break;case "u_color_id":h=function(a,b,c,d){a.uniform3fv(b,c.color_id)};e=!0;break;case "u_line_points":h=function(a,b,c,d){a.uniform3fv(b,d.line_points)};e=!0;break;case "u_diffuse_color_factor":h=
function(a,b,c,d){a.uniform1f(b,d.diffuse_color_factor)};e=!0;break;case "u_alpha_factor":h=function(a,b,c,d){a.uniform1f(b,d.alpha_factor)};e=!0;break;case "u_specular_color_factor":h=function(a,b,c,d){a.uniform1f(b,d.specular_color_factor)};e=!0;break;case "u_normal_factor":h=function(a,b,c,d){a.uniform1f(b,d.normal_factor)};e=!0;break;case "u_normalmap0_scale":h=function(a,b,c,d){a.uniform2fv(b,d.normalmap_scales[0])};e=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d){a.uniform2fv(b,d.normalmap_scales[1])};
e=!0;break;case "u_normalmap2_scale":h=function(a,b,c,d){a.uniform2fv(b,d.normalmap_scales[2])};e=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d){a.uniform2fv(b,d.normalmap_scales[3])};e=!0;break;case "u_foam_factor":h=function(a,b,c,d){a.uniform1f(b,d.foam_factor)};e=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d){a.uniform2fv(b,d.foam_uv_freq)};e=!0;break;case "u_foam_mag":h=function(a,b,c,d){a.uniform2fv(b,d.foam_mag)};e=!0;break;case "u_foam_scale":h=function(a,b,c,d){a.uniform2fv(b,
d.foam_scale)};e=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d){a.uniform1f(b,d.water_norm_uv_velocity)};e=!0;break;case "u_shallow_water_col":h=function(a,b,c,d){a.uniform3fv(b,d.shallow_water_col)};e=!0;break;case "u_shore_water_col":h=function(a,b,c,d){a.uniform3fv(b,d.shore_water_col)};e=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d){a.uniform1f(b,d.shallow_water_col_fac)};e=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d){a.uniform1f(b,d.shore_water_col_fac)};
e=!0;break;case "u_p_length":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.time_length)};e=!0;break;case "u_p_cyclic":h=function(a,b,c,d){a.uniform1i(b,d.particles_data.cyclic)};e=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.lifetime)};e=!0;break;case "u_p_fade_in":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.fade_in)};e=!0;break;case "u_p_fade_out":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.fade_out)};e=!0;break;case "u_p_size":h=function(a,
b,c,d){a.uniform1f(b,d.particles_data.size)};e=!0;break;case "u_p_alpha_start":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.alpha_start)};e=!0;break;case "u_p_alpha_end":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.alpha_end)};e=!0;break;case "u_p_nfactor":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.nfactor)};e=!0;break;case "u_p_gravity":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.gravity)};e=!0;break;case "u_p_mass":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.mass)};
e=!0;break;case "u_p_color_ramp":h=function(a,b,c,d){a.uniform4fv(b,d.particles_data.color_ramp)};e=!0;break;case "u_p_wind_fac":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.wind_factor)};e=!0;break;case "u_p_time":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.time)};e=!0;break;case "u_p_tilt":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.tilt)};e=!0;break;case "u_p_tilt_rand":h=function(a,b,c,d){a.uniform1f(b,d.particles_data.tilt_rand)};e=!0;break;case "u_position":h=function(a,
b,c,d){a.uniform3fv(b,d.anchor_positions)};e=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,c.va_frame_factor)};e=!0;break;case "u_refl_plane":h=function(a,b,c,d){a.uniform4fv(b,c.reflection_plane)};e=!0;break;case "u_outline_intensity":h=function(a,b,c,d){a.uniform1f(b,c.outline_intensity)},e=!0}h&&(h={name:m,fun:h,loc:b[m]},e?c.push(h):d.push(h));f&&(h={name:m,fun:f,loc:b[m]},e?k.push(h):g.push(h))}if(d.length||g.length){a=a.permanent_uniform_setters_table;for(var t in a)delete a[t];
for(t=0;t<d.length;t++)h=d[t],a[h.name]=h;for(t=0;t<g.length;t++)h=g[t],a[h.name]=h}else a.no_permanent_uniforms=!0}var q=r("__batch"),e=r("__camera"),n=r("__config"),p=r("__debug"),B=r("__extensions"),c=r("__geometry"),k=r("__quat"),m=r("__subscene"),A=r("__textures"),E=r("__tsr"),w=r("__util"),v=r("__version"),c=r("__geometry"),z=r("__vec3"),y=[1,1,1,1],D=[1,1,1,1],K=[0,0,0,1],d=[0,0,0,0],t=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,
1,1,0]);new Float32Array([2,2,2,0]);var C=null,M=null,x=null,g=null,H=null,G=null,ba=new Float32Array(3),L=k.create(),F=new Uint8Array(4),U=n.defaults;a.setup_context=function(a){var b=U.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);C=a};a.draw=function(a){if(a.do_render)if(a.type==m.RESOLVE){p.render_time_start_subs(a);
var c=a.camera;C.bindFramebuffer(C.READ_FRAMEBUFFER,c.framebuffer_prev);C.bindFramebuffer(C.DRAW_FRAMEBUFFER,c.framebuffer);var d=0;c.color_attachment&&(d|=C.COLOR_BUFFER_BIT);c.depth_attachment&&(d|=C.DEPTH_BUFFER_BIT);C.blitFramebuffer(0,0,c.width,c.height,0,0,c.width,c.height,d,C.NEAREST);p.render_time_stop_subs(a);p.check_gl("draw resolve")}else if(a.type==m.COPY)p.render_time_start_subs(a),c=a.camera,C.bindFramebuffer(C.FRAMEBUFFER,c.framebuffer_prev),C.bindTexture(C.TEXTURE_2D,c.color_attachment.w_texture),
C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,c.width,c.height,0),p.render_time_stop_subs(a),p.check_gl("draw copy");else{p.render_time_start_subs(a);c=a.camera;C.bindFramebuffer(C.FRAMEBUFFER,c.framebuffer);a.assign_texture&&(d=c.color_attachment,C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,d.w_target,d.w_texture,0));C.viewport(0,0,c.width,c.height);a.type!=m.MAIN_CUBE_REFLECT&&a.type!=m.MAIN_CUBE_REFLECT_BLEND&&h(a);a.blend?C.enable(C.BLEND):C.disable(C.BLEND);a.depth_test?C.enable(C.DEPTH_TEST):
C.disable(C.DEPTH_TEST);switch(a.type){case m.SHADOW_CAST:C.enable(C.POLYGON_OFFSET_FILL);C.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);C.cullFace(C.BACK);break;case m.MAIN_PLANE_REFLECT:case m.MAIN_PLANE_REFLECT_BLEND:C.disable(C.POLYGON_OFFSET_FILL);C.cullFace(C.FRONT);break;case m.DEBUG_VIEW:C.enable(C.POLYGON_OFFSET_FILL);C.polygonOffset(-4,-4);C.cullFace(C.BACK);break;case m.MAIN_GLOW:if(1<U.msaa_samples||U.safari_glow_hack){C.enable(C.POLYGON_OFFSET_FILL);C.polygonOffset(-2,
-2);break}default:C.disable(C.POLYGON_OFFSET_FILL),C.cullFace(C.BACK)}if(a.type==m.MAIN_CUBE_REFLECT||a.type==m.MAIN_CUBE_REFLECT_BLEND)for(var c=a.camera,d=c.color_attachment.w_texture,k=0;6>k;k++){var g=b(k);c.view_matrix=a.cube_view_matrices[k];E.from_mat4(c.view_matrix,c.view_tsr);e.calc_sky_vp_inverse(c);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,g,d,0);h(a);for(var g=a.draw_data,f=0;f<g.length;f++)for(var t=0;t<g[f].bundles.length;t++){var l=g[f].bundles[t];l.do_render=l.do_render_cube[k]}u(a)}else u(a);
p.render_time_stop_subs(a);p.check_gl("draw subscene: "+m.subs_label(a))}};a.clear=function(a){C.bindFramebuffer(C.FRAMEBUFFER,a.camera.framebuffer);h(a)};a.assign_attribute_setters=function(a){var b=a.attribute_setters;b.length=0;var d=a.bufs_data,k=d.pointers,g=a.shader.attributes,e;for(e in g){var m=k[e],h=c.get_vbo_type_by_attr_name(e),t=c.get_gl_type_by_attr_name(e),l=c.get_type_size_by_attr_name(e);b.push({vbo_type:h,gl_type:t,loc:g[e],base_offset:m.offset*l,frame_length:1<m.frames?m.length*
l:0,num_comp:m.num_comp,stride:m.stride*l,divisor:m.divisor})}if("DEBUG"==v.type())for(e in k)h=c.get_vbo_type_by_attr_name(e),b=c.search_vbo_index_by_type(d.vbo_data,h),b=d.vbo_data[b],m=a.shaders_info.vert+" | "+a.shaders_info.frag,h=k[e].length*k[e].frames*c.get_type_size_by_attr_name(e),p.fill_vbo_garbage_info(b.debug_id,m,e,h,e in g);U.allow_vao_ext&&f(a)};a.assign_vao=f;a.cleanup_vao=function(a){for(var b=B.get_vertex_array_object(),c=0;c<a.vaos.length;c++)b.deleteVertexArray(a.vaos[c]);a.vaos.length=
0};a.clone_attribute_setters=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b};a.assign_uniform_setters=l;a.assign_texture_uniforms=function(a){var b=a.shader,c=a.textures;a=a.texture_names;C.useProgram(b.program);for(var d=0;d<c.length;d++)C.uniform1i(b.uniforms[a[d]],d)};a.read_pixels=function(a,b,c,d,k,g){d||(d=1);k||(k=1);g||(g=new Uint8Array(4*d*k));g.length!=4*d*k&&w.panic("read_pixels(): Wrong storage");C.bindFramebuffer(C.FRAMEBUFFER,a);C.readPixels(b,c,d,k,C.RGBA,C.UNSIGNED_BYTE,
g);C.bindFramebuffer(C.FRAMEBUFFER,null);return g};a.update_batch_permanent_uniform=function(a,b){var c=a.shader;c.no_permanent_uniforms||(C.useProgram(c.program),c.permanent_uniform_setters.length||l(c),c=c.permanent_uniform_setters_table[b],c.fun(C,c.loc,null,a))};a.render_target_create=function(a,b){var c=C.createFramebuffer();C.bindFramebuffer(C.FRAMEBUFFER,c);if(A.is_renderbuffer(a)){var d=a.w_renderbuffer;C.framebufferRenderbuffer(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.RENDERBUFFER,d)}else if(A.is_texture(a)){var k=
a,d=k.w_texture,k=k.w_target==C.TEXTURE_CUBE_MAP?C.TEXTURE_CUBE_MAP_NEGATIVE_Z:k.w_target;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,k,d,0)}A.is_renderbuffer(b)?(d=b.w_renderbuffer,C.framebufferRenderbuffer(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.RENDERBUFFER,d)):A.is_texture(b)&&(k=b,d=k.w_texture,k=k.w_target,C.framebufferTexture2D(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,k,d,0));p.check_bound_fb();C.bindFramebuffer(C.FRAMEBUFFER,null);return c};a.render_target_cleanup=function(a,b,c,d,k){null==
a?(C.bindFramebuffer(C.FRAMEBUFFER,a),C.viewport(0,0,d,k),C.clear(C.COLOR_BUFFER_BIT|C.DEPTH_BUFFER_BIT)):(A.is_renderbuffer(b)?C.deleteRenderbuffer(b.w_renderbuffer):A.is_texture(b)&&C.deleteTexture(b.w_texture),A.is_renderbuffer(c)?C.deleteRenderbuffer(c.w_renderbuffer):A.is_texture(c)&&C.deleteTexture(c.w_texture),C.deleteFramebuffer(a))};a.increment_subpixel_index=function(){};a.draw_resized_cubemap_texture=function(a,b,c,d,k,g){a=a.w_texture;C.viewport(0,0,c,c);C.framebufferTexture2D(C.FRAMEBUFFER,
C.COLOR_ATTACHMENT0,b,a,0);b=q.create_postprocessing_batch("FLIP_CUBEMAP_COORDS");a=b.shader;C.activeTexture(C.TEXTURE0);C.bindTexture(C.TEXTURE_2D,k);var e=k=0;c!=d&&(k=1/(6*d),e=1/(4*d));C.uniform1i(a.uniforms.u_tex_number,g);C.uniform2fv(a.uniforms.u_delta,[k,e]);C.useProgram(a.program);G(b,0);C.bindTexture(C.TEXTURE_2D,null)};a.draw_resized_texture=function(a,b,c,d,k,g){C.bindFramebuffer(C.FRAMEBUFFER,d);d=a.w_texture;a=a.w_target;C.bindTexture(a,d);C.viewport(0,0,b,c);C.texImage2D(a,0,C.RGBA,
b,c,0,C.RGBA,C.UNSIGNED_BYTE,null);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,a,d,0);b=q.create_postprocessing_batch(g);c=b.shader;C.activeTexture(C.TEXTURE0);C.bindTexture(a,k);C.useProgram(c.program);G(b,0);C.bindFramebuffer(C.FRAMEBUFFER,null);C.bindTexture(a,null)};a.cleanup=function(){};a.set_draw_methods=function(){var a=B.get_instanced_arrays(),b=B.get_vertex_array_object();U.allow_instanced_arrays_ext=a?!0:!1;U.allow_vao_ext=b?!0:!1;a?(M=function(b,c,d,k,g){a.drawElementsInstanced(b,
c,d,k,g)},x=function(b,c){a.vertexAttribDivisor(b,c)},g=function(b,c,d,k){a.drawArraysInstanced(b,c,d,k)}):(M=function(a,b,c,d){C.drawElements(a,b,c,d)},x=function(a,b){},g=function(a,b,c,d){C.drawArrays(a,b,c)});b?(H=function(a){b.bindVertexArray(a)},G=function(a,b){var c=a.bufs_data;H(a.vaos[b]);c.ibo?M(c.mode,c.count,c.ibo_type,0,c.instance_count):g(c.mode,0,c.count,c.instance_count);H(null)}):G=function(a,b){for(var c=a.bufs_data,d=a.attribute_setters,k=0;k<c.vbo_data.length;k++){C.bindBuffer(C.ARRAY_BUFFER,
c.vbo_data[k].vbo);for(var e=0;e<d.length;e++){var m=d[e];m.vbo_type==c.vbo_data[k].type&&(C.enableVertexAttribArray(m.loc),C.vertexAttribPointer(m.loc,m.num_comp,m.gl_type,m.gl_type==C.FLOAT?!1:!0,m.stride,m.base_offset+m.frame_length*b),x(m.loc,m.divisor))}}c.ibo?(C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,c.ibo),M(c.mode,c.count,c.ibo_type,0,c.instance_count)):g(c.mode,0,c.count,c.instance_count);for(k=0;k<d.length;k++)m=d[k],C.disableVertexAttribArray(m.loc)}};a.reset=function(){H=g=x=M=C=null}};b4w.module.__shaders=function(a,r){function u(a,b,c){var d=a.directives;"string"==typeof c?(a=h(a,c))&&(c=a[1]):c=String(c);for(a=0;a<d.length;a++)if(d[a][0]==b){d[a][1]=c;break}}function h(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(!(c in F)){var d=m(H.shaders_path,a),k=m(H.shaders_path,b),d=E(d),k=E(k),g;for(g in k)d[g]=k[g];k=[];for(g in d)k.push([g,d[g]]);F[c]=k}return F[c]}function f(a,b){return a+b}function l(a,b){return(a.split(";").map(function(a){return(a=
a.match(b))&&(a[3]?parseInt(a[3]):1)}).filter(function(a){return a})||[]).reduce(f,0)}function q(a,b){var c=k(a.type),d=k(b.type),g=a.array_size,e=b.array_size;return c>d?-1:c<d?1:g>e?-1:g<e?1:0}function e(a){if(x.webgl2){a=a.replace(/(.*?)\([^()]*?\)(.*?)/g,"$1$2");var b=W}else b=ha;a=a.split(";").map(function(a){return(a=a.match(b))&&{type:a[2],array_size:a[4]?parseInt(a[4]):1}}).filter(function(a){return a});return p(a,Z,g.max_varying_vectors)}function n(a,b,c){a=a.split(";").map(function(a){return(a=
a.match(T))&&{type:a[2],array_size:a[4]?parseInt(a[4]):1}}).filter(function(a){return a});return p(a,b,c)}function p(a,b,d){function g(){for(var d=0;l<a.length;){var e=a[l];if(3!=k(e.type))break;d+=c(e.type)*e.array_size;l++}h=t+d;if(h>ma)return!1;B(b,t,d,0,3);return!0}function e(){for(var d=ma-h,g=d,m=d;l<a.length;){var f=a[l];if(2!=k(f.type))break;f=c(f.type)*f.array_size;if(f<=g)g-=f;else if(f<=m)m-=f;else return!1;l++}m=d-m;B(b,h,d-g,0,2);B(b,ma-m,m,2,2);return!0}function m(){for(;l<a.length;){for(var k=
a[l],k=c(k.type)*k.array_size,g=-1,e=d+1,f=-1,h=0;4>h;h++){var t=Y;t[0]=0;t[1]=1;var n;n=b;for(var p=h,x=k,A=t;I<n.length&&15===n[I];)I++;for(;0<ma&&15===n[ma];)ma--;if(ma-I<x)n=!1;else{for(var p=1<<p,J=0,v=-1,va=n.length+1,H=!1,q=I;q<=ma;q++)q<ma&&!(n[q]&p)?H||(J=q,H=!0):(H&&(H=q-J,H>=x&&H<va&&(va=H,v=J)),H=!1);0>v?n=!1:(A[0]=v,A[1]=va,n=!0)}n&&t[1]<e&&(f=t[0],e=t[1],g=h)}if(0>g)return!1;B(b,f,k,g,1);l++}return!0}if(!a.length)return!0;for(var f=0;f<d;f++)b[f]=0;ma=d;a.sort(q);var h=0,t=0,l=0;return function(){for(;l<
a.length;){var d=a[l];if(4!=k(d.type))break;t+=c(d.type)*d.array_size;l++}if(t>ma)return!1;I=t;B(b,0,t,0,4);return!0}()&&g()&&e()&&m()}function B(a,b,c,d,k){for(var g=0,e=0;e<k;e++)g|=1<<d+e;for(e=0;e<c;e++)a[b+e]|=g}function c(a){var b=0;switch(a){case "mat4":b=4;break;case "mat3":b=3;break;case "mat2":b=2;break;default:b=1}return b}function k(a){var b=0;switch(a){case "mat4":case "vec4":case "ivec4":case "bvec4":case "mat2":b=4;break;case "mat3":case "vec3":case "ivec3":case "bvec3":b=3;break;case "vec2":case "ivec2":case "bvec2":b=
2;break;default:b=1}return b}function m(a,b){var c=a+b;if(ba[c])return ba[c];if(L){var d=L[b];if(!d)return null;d=r("__gpp_parser").parser.parse(d)}else if(d=r("shader_texts")[b],!d)return null;return ba[c]=d}function A(a,b){for(var c={},d=b.directives||[],k=0;k<d.length;k++)c[d[k][0]]=[d[k][1]];for(k=0;k<b.node_elements.length;k++)c["USE_NODE_"+b.node_elements[k].id]=["1"];x.webgl2?(c.GLSL1=["0"],c.GLSL3=["1"],c.GLSL_VERSION=["300 es"],c.GLSL_IN=["in"],c.GLSL_OUT=["out"],c.GLSL_OUT_FRAG_COLOR=["glsl_out_frag_color"],
c.GLSL_TEXTURE=["texture"],c.GLSL_TEXTURE_CUBE=["texture"],c.GLSL_TEXTURE_PROJ=["textureProj"],c.GLSL_SMPLR2D_SHDW=["sampler2DShadow"]):(c.GLSL1=["1"],c.GLSL3=["0"],c.GLSL_VERSION=["100"],c.GLSL_IN="vert"==a?["attribute"]:["varying"],c.GLSL_OUT="vert"==a?["varying"]:[""],c.GLSL_OUT_FRAG_COLOR=["gl_FragColor"],c.GLSL_TEXTURE=["texture2D"],c.GLSL_TEXTURE_CUBE=["textureCube"],c.GLSL_TEXTURE_PROJ=["texture2DProj"],c.GLSL_SMPLR2D_SHDW=["sampler2D"]);for(var g in c)c[g][0].constructor!=String&&C.warn("Warning! The value of a directive '"+
g+"' is not of type string.");return c}function E(a){function b(a,c,d){if(a instanceof Array)for(var k=0;k<a.length;k++)b(a[k],c,d);else if(a instanceof Object&&a){c&&c(a);for(k in a)b(a[k],c,d);d&&d(a)}}var c={},d=function(a){"var"==a.TYPE?c[a.NAME]=a.TOKENS.join(""):"include"==a.TYPE&&(a=m(H.shaders_path,H.shaders_include_dir+a.FILE),b(a,d))};b(a,d);return c}function w(a,b,c){function d(b){b=b.PARTS;for(var c=0;c<b.length;c++){var P=b[c];switch(P.TYPE){case "cond":a:for(var P=P.PARTS,t=0;t<P.length;t++){var Ba=
P[t];switch(Ba.TYPE){case "if":case "elif":if(k(Ba.EXPRESSION)){d(Ba.GROUP);break a}break;case "else":d(Ba.GROUP);break a;case "ifdef":Ba.NAME in p&&d(Ba.GROUP);break;case "ifndef":Ba.NAME in p||d(Ba.GROUP)}}break;case "include":P=P.FILE;t=m(H.shaders_path,H.shaders_include_dir+P);B.push("include/"+P);d(t);B.pop();break;case "var":break;case "define":p[P.NAME]=P.TOKENS;break;case "error":M.panic("Shader error: #error "+P.TOKENS.join(" "));break;case "line":break;case "pragma":n.push("#pragma "+P.NAME+
" "+P.TOKENS.join(" "));break;case "undef":delete p[P.NAME];break;case "warning":C.warn("Shader warning: #warning "+P.TOKENS.join(" "));break;case "extension":P=h(P.TOKENS,p,I,!1);n.push("#extension "+P.join(" "));break;case "version":P=h(P.TOKENS,p,I,!1),n.push("#version "+P.join(" "));case "#":break;case "node":q[P.NAME]=P;break;case "nodes_global":P=l;for(t=0;t<P.length;t++){var Ba=P[t],x=q[Ba.id];if(x)for(var A=0,v=0;v<x.DECLARATIONS.length;v++){var R=x.DECLARATIONS[v];if("node_param"==R.TYPE){var w;
w=Ba;if("PARTICLE_INFO"==w.id&&R.IS_OPTIONAL)if(1==p.PARTICLE_BATCH){var z=!1;switch(A){case 0:z=D(w.dirs,"PART_INFO_IND")||D(w.dirs,"PART_INFO_AGE")||D(w.dirs,"PART_INFO_LT")||D(w.dirs,"PART_INFO_SIZE");break;case 1:z=D(w.dirs,"PART_INFO_LOC");break;case 2:z=D(w.dirs,"PART_INFO_VEL");break;case 3:z=D(w.dirs,"PART_INFO_A_VEL");break;case 4:z=D(w.dirs,"PART_INFO_IND")}w=z}else w=!1;else w=!0;w&&(R=R.QUALIFIER.join(" ")+" ","vert"==a?R+=Ba.vparams[A]:"frag"==a&&(R+=Ba.params[A],null!==Ba.param_values[A]&&
(R+="="+Ba.param_values[A])),R+=";",f(e(R)));A++}}}break;case "nodes_main":P=l;for(t=0;t<P.length;t++)if(Ba=P[t],x=q[Ba.id]){A={};xa=G=ia=0;v=x;R=Ba;w=v;for(var z={},E=0;E<w.NODE_VARS.length;E++){var K=w.NODE_VARS[E];z[K.NAME]=[K.TOKENS.join("")]}w=z;for(z=0;z<R.dirs.length;z++)E=R.dirs[z][0],E in w&&(w[E]=[R.dirs[z][1]]);for(z=E=0;z<v.DECLARATIONS.length;z++)if(K=v.DECLARATIONS[z],"node_out"==K.TYPE){var F=-1<y.indexOf(R.outputs[E])|0;w["USE_OUT_"+K.NAME]=[F];E++}v=w;R=Ba;w=x.DECLARATIONS;z=A;E=
v;for(K=0;K<w.length;K++)switch(F=w[K],F.TYPE){case "node_in":var r=R.inputs[ia];if(null!==R.input_values[ia]){if(("MATERIAL_BEGIN"==R.id&&3===ia||!E.MATERIAL_EXT&&("MATERIAL_BEGIN"==R.id&&4===ia||"MATERIAL_END"==R.id&&3===ia||"MATERIAL_END"==R.id&&4===ia||"MATERIAL_END"==R.id&&5===ia)||"TEXTURE_COLOR"==R.id||"TEXTURE_NORMAL"==R.id)&&F.IS_OPTIONAL){z[F.NAME]=R.input_values[ia];ia++;continue}var S=F.QUALIFIER.join(" ")+" ",S=S+(r+"="+R.input_values[ia]+";");f(e(S))}z[F.NAME]=r;ia++;break;case "node_out":r=
R.outputs[G];if(!F.IS_OPTIONAL||-1<y.indexOf(r))S=F.QUALIFIER.join(" ")+" ",S+=r+";",f(e(S)),z[F.NAME]=r;G++;break;case "node_param":"vert"==a?r=R.vparams[xa]:"frag"==a&&(r=R.params[xa]),z[F.NAME]=r,xa++}n.push("{");g(Ba,x.STATEMENTS,A,v);n.push("}")}break;case "txt":f(P.TOKENS);break;default:M.panic("Unknown element type: "+P.TYPE)}}}function k(a,b){var c;c=h(a,p,I,!0,b);for(var d=[],g=0;g<c.length;g++)if(c[g]instanceof Object)switch(c[g].TYPE){case "conditional_expr":var e=d.pop(),m=d.pop();d.pop()?
d.push(m):d.push(e);break;case "logical_or_expr":for(var m=d.pop(),f=0;f<c[g].PLACES-1;f++)e=d.pop(),m=m||e;d.push(m);break;case "logical_and_expr":m=d.pop();for(f=0;f<c[g].PLACES-1;f++)e=d.pop(),m=m&&e;d.push(m);break;case "logical_bitor_expr":m=d.pop();for(f=0;f<c[g].PLACES-1;f++)m|=d.pop();d.push(m);break;case "logical_bitxor_expr":m=d.pop();for(f=0;f<c[g].PLACES-1;f++)m^=d.pop();d.push(m);break;case "logical_bitand_expr":m=d.pop();for(f=0;f<c[g].PLACES-1;f++)m&=d.pop();d.push(m);break;case "equal_expr":e=
d.pop();m=d.pop();d.push(m==e);break;case "non_equal_expr":e=d.pop();m=d.pop();d.push(m!=e);break;case "le_expr":e=d.pop();m=d.pop();d.push(m<=e);break;case "ge_expr":e=d.pop();m=d.pop();d.push(m>=e);break;case "l_expr":e=d.pop();m=d.pop();d.push(m<e);break;case "g_expr":e=d.pop();m=d.pop();d.push(m>e);break;case "left_shift_expr":m=d.pop();e=d.pop();d.push(m<<e);break;case "right_shift_expr":m=d.pop();e=d.pop();d.push(m>>e);break;case "add_expr":m=d.pop();e=d.pop();d.push(m+e);break;case "sub_expr":m=
d.pop();e=d.pop();d.push(m-e);break;case "mul_expr":m=d.pop();e=d.pop();d.push(m*e);break;case "div_expr":m=d.pop();e=d.pop();d.push(m/e);break;case "mod_expr":m=d.pop();e=d.pop();d.push(m%e);break;case "pre_inc_expr":case "post_inc_expr":e=d.pop();d.push(++e);break;case "pre_dec_expr":case "post_dec_expr":e=d.pop();d.push(--e);break;case "positive_expr":e=d.pop();d.push(+e);break;case "negative_expr":e=d.pop();d.push(-e);break;case "one_compl_expr":e=d.pop();d.push(~e);break;case "logic_negative_expr":e=
d.pop();d.push(!e);break;default:M.panic("Unknown operation type: "+c[g].TYPE)}else e=c[g],/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(e)?(d.push(0),0!=e.indexOf("USE_NODE_")&&(m=B[B.length-1],m in v||(v[m]=[]),-1==v[m].indexOf(e)&&(v[m].push(e),C.error("Undefined directive '"+e+"' in shader '"+m+"'. Should it be defined with #var/#node_var or #define?")))):d.push(parseFloat(c[g]));1==d.length?c=d[0]:(M.panic("Incorrect expression: "+c.join(" ")),c=void 0);return c}function g(a,b,c,d){for(var e=0;e<b.length;e++){var m=
b[e];switch(m.TYPE){case "node_cond":a:for(var h=a,m=m.PARTS,t=c,l=d,n=0;n<m.length;n++){var I=m[n];switch(I.TYPE){case "node_if":case "node_elif":if(k(I.EXPRESSION,l)){g(h,I.STATEMENTS,t,l);break a}break;case "node_else":g(h,I.STATEMENTS,t,l);break a;case "node_ifdef":(I.NAME in p||I.NAME in l)&&g(h,I.STATEMENTS,t,l);break;case "node_ifndef":I.NAME in p||I.NAME in l||g(h,I.STATEMENTS,t,l)}}break;case "txt":h=[];for(t=0;t<m.TOKENS.length;t++)l=m.TOKENS[t],l in c?h.push(c[l]):h.push(l);f(h,d)}}}function e(a){return a.match(/([\d]+\.[\d]+|[\w]+|[^\s])/g)}
function f(b,c){var d=b;x.webgl2||"frag"!=a||(d=d.join(" "),E&&(d.match(/[^;]*;/)?(d=d.replace(/[^;]*;/,""),E=!1):d=""),d=d.replace(/GLSL_OUT [^;]*;/g,""),d.match(/GLSL_OUT(?:$| [^;]*)/)&&(d=d.replace(/GLSL_OUT(?:$| [^;]*)/,""),E=!0),d=d.replace(/ {2,}/g," "),d=(d=d.trim())?d.split(" "):[]);b=d;b.length&&(d=h(b,p,I,!1,c),n.push(d.join(" ")))}function h(a,b,c,d,k){var g=[];t(a,b,c,d,g,k);return g}function t(a,b,c,d,k,g){for(var e=0;e<a.length;e++){var m=a[e];if(g&&m in g)m=g[m];else if(m in b)m=b[m];
else{k.push(m);continue}0==m.length&&d?k.push(0):t(m,b,c,d,k,g)}}var l=c.node_elements,n=[],p=A(a,c),I={},B=[c[a]],v={},q={},y=[],w;for(w in l)for(var z in l[w].inputs)y.push(l[w].inputs[z]);var E=!1;d(b);var ia=0,G=0,xa=0;return n.join("\n")}function v(a){fa.deleteProgram(a.program);fa.deleteShader(a.vshader);fa.deleteShader(a.fshader);delete G[a.shader_id]}function z(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return y(a);case 2:return"vec2("+y(a[0])+","+y(a[1])+")";case 3:return"vec3("+
y(a[0])+","+y(a[1])+","+y(a[2])+")";case 4:return"vec4("+y(a[0])+","+y(a[1])+","+y(a[2])+","+y(a[3])+")";case 9:return"mat3("+y(a[0])+","+y(a[1])+","+y(a[2])+","+y(a[3])+","+y(a[4])+","+y(a[5])+","+y(a[6])+","+y(a[7])+","+y(a[8])+")";case 16:return"mat4("+y(a[0])+","+y(a[1])+","+y(a[2])+","+y(a[3])+","+y(a[4])+","+y(a[5])+","+y(a[6])+","+y(a[7])+","+y(a[8])+","+y(a[9])+","+y(a[10])+","+y(a[11])+","+y(a[12])+","+y(a[13])+","+y(a[14])+","+y(a[15])+")";default:M.panic("Wrong glsl value dimension")}}
function y(a){return a%1?String(a):String(a)+".0"}function D(a,b){for(var c=0;c<a.length;c++)if(a[c][0]==b)return!0;return!1}var K=r("__assets"),d=r("__config"),t=r("__debug"),C=r("__print"),M=r("__util"),x=d.defaults,g=d.context_limits,H=d.paths,G={},ba={},L=null,F={},U="anchors.glslf anchors.glslv color_id.glslf color_id.glslv shadow.glslf shadow.glslv error.glslf error.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv line.glslf line.glslv main.glslf main.glslv main_stack.glslf particle_system.glslf particle_system_stack.glslf particle_system.glslv proc_skybox.glslf skybox.glslv lens_flares.glslf lens_flares.glslv sky.glslf sky.glslv water.glslf water.glslv tex_skybox.glslf debug_view.glslf debug_view.glslv postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/coc.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/performance.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf postprocessing/stereo.glslf include/blending.glslf include/caustics.glslf include/color_util.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/fxaa.glslf include/halo_color.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/particles_nodes.glslf include/particles_nodes.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/sky_blending.glslf include/std.glsl include/to_world.glslv include/wind_bending.glslv".split(" ");
a.VALID=0;a.INVALID_TEX_IMAGE_UNITS=1;a.INVALID_F_UNIFORM_VECTORS=2;a.INVALID_V_UNIFORM_VECTORS=4;a.INVALID_VERTEX_ATTRIBS=8;a.INVALID_VARYING_VECTORS=16;a.COMPILATION_ERROR=32;var Q=/(?:^|[^a-zA-Z_])uniform.*?(sampler2D|samplerCube)(?=\s)(.*?\[\s*([0-9]*)\s*\])?/,T=/(?:^|[^a-zA-Z_])(uniform)(?=\s)\s*(float|vec2|vec3|vec4|ivec2|ivec3|ivec4|bvec2|bvec3|bvec4|mat2|mat3|mat4|sampler2D|samplerCube)\s*(.*?\[\s*([0-9]*)\s*\])?/,W=/(?:^|[^a-zA-Z_])(in)(?=\s)\s*(float|vec2|vec3|vec4|mat2|mat3|mat4)\s*(.*?\[\s*([0-9]*)\s*\])?/,
ha=/(?:^|[^a-zA-Z_])(varying)(?=\s)\s*(float|vec2|vec3|vec4|mat2|mat3|mat4)\s*(.*?\[\s*([0-9]*)\s*\])?/,Y=new Int16Array(2),Z=null,N=null,ca=null,I=0,ma=0,da=[],fa=null,Aa=!1;a.setup_context=function(a){fa=a};a.set_directive=u;a.get_directive=h;a.set_default_directives=function(a){a.directives=M.clone_object_json(b(a.vert,a.frag));u(a,"PRECISION",d.defaults.precision);"highp"==d.defaults.precision?u(a,"EPSILON",z(1E-6)):u(a,"EPSILON",z(1E-4));u(a,"CONSTANTS_HACK",x.shader_constants_hack|0);u(a,"SRGB",
x.srgb_type)};a.get_vname=function(a){return a.vert};a.get_fname=function(a){return a.frag};a.get_compiled_shader=function(a){var b=JSON.stringify(a.vert)+JSON.stringify(a.frag)+JSON.stringify(a.directives)+JSON.stringify(a.node_elements),c=G[b];if(c)return c;var d=a.frag,k=m(H.shaders_path,a.vert),d=m(H.shaders_path,d);if(!k||!d)return null;var k=w("vert",k,a),d=w("frag",d,a),c=0,f=l(d,Q);a.texture_count=f;f>g.max_texture_image_units&&(c|=1);Z||(Z=new Uint32Array(g.max_varying_vectors));N||(N=new Uint32Array(g.max_fragment_uniform_vectors));
ca||(ca=new Uint32Array(g.max_vertex_uniform_vectors));n(d,N,g.max_fragment_uniform_vectors)||(c|=2);n(k,ca,g.max_vertex_uniform_vectors)||(c|=4);f=x.webgl2?(k.replace(/(.*?)\([^()]*?\)(.*?)/g,"$1$2").match(/(?:^|[^a-zA-Z_])in(?=\s)/g)||[]).length:(k.match(/(?:^|[^a-zA-Z_])attribute(?=\s)/g)||[]).length;a.attribute_count=f;f>g.max_vertex_attribs&&(c|=8);e(d)||(c|=16);a.status=c;if(0===a.status){var c=fa,h=c.createShader(c.VERTEX_SHADER);c.shaderSource(h,k);c.compileShader(h);var p=c.createShader(c.FRAGMENT_SHADER);
c.shaderSource(p,d);c.compileShader(p);f=c.createProgram();c.attachShader(f,h);c.attachShader(f,p);c.linkProgram(f);for(var h={vshader:h,fshader:p,program:f,attributes:{},uniforms:{},permanent_uniform_setters:M.create_non_smi_array(),permanent_sc_uniform_setters:M.create_non_smi_array(),permanent_uniform_setters_table:{},need_uniforms_update:!0,no_permanent_uniforms:!1,transient_uniform_setters:M.create_non_smi_array(),transient_sc_uniform_setters:M.create_non_smi_array(),shaders_info:M.clone_object_json(a),
shader_id:b,cleanup_gl_data_on_unload:!0},I=c.getProgramParameter(f,c.ACTIVE_ATTRIBUTES),p=0;p<I;p++){var B=c.getActiveAttrib(f,p).name,A=c.getAttribLocation(f,B);h.attributes[B]=A}I=c.getProgramParameter(f,c.ACTIVE_UNIFORMS);for(p=0;p<I;p++)B=c.getActiveUniform(f,p).name.split("[0]").join(""),A=c.getUniformLocation(f,B),h.uniforms[B]=A;G[b]=c=h;f=!fa.getShaderParameter(c.fshader,fa.COMPILE_STATUS);h=!fa.getShaderParameter(c.vshader,fa.COMPILE_STATUS);p=!fa.getProgramParameter(c.program,fa.LINK_STATUS);
f?t.report_shader_compiling_error(c.fshader,b,d):h?t.report_shader_compiling_error(c.vshader,b,k):p&&t.report_shader_linking_error(c.program,b,k,d);if(f||h||p)a.status|=32,c=null}else c=null;return c};a.load_shaders=function(){Aa=!1;if(b4w.module_check("shader_texts"))Aa=!0;else{for(var a=[],b=K.AT_TEXT,c=0;c<U.length;c++){var d=M.normpath_preserve_protocol(H.shaders_path+U[c]);a.push({id:U[c],type:b,url:d})}b=function(a,b,c,d){L||(L={});L[b]=a};a.length?K.enqueue(a,b,function(){Aa=!0}):C.error("Shaders have not been found.")}};
a.check_shaders_loaded=function(){return Aa};a.debug_get_compilation_stats=function(){return da};a.get_compiled_shaders=function(){return G};a.cleanup=function(){for(var a in G)v(G[a]);for(var b in ba)delete ba[b];for(var c in da)delete da[c];ca=N=Z=null;F={}};a.cleanup_shader=v;a.debug_shaders_info=function(a){var b=a.directives;C.log("Shader: "+a.vert+" "+a.frag+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)C.log("  "+b[a][0],b[a][1])};a.glsl_value=z;a.check_uniform=function(a,b){return b in
a.uniforms?!0:!1};a.reset=function(){fa=null}};b4w.module.__geometry=function(a,r){function u(){return{length:0,frames:1,num_comp:0,stride:0,offset:0,divisor:0}}function h(a,b){for(var c=b.a_tbn_quat,d=b.a_position,k=c.length,g=d.length,e=1;e<a.shape_keys.length;e++)for(var m=a.shape_keys[e].geometry,f=a.shape_keys[e].init_value,m=m.a_position,h=0;h<g;h++)d[h]+=f*m[h];d=fa;for(e=0;e<k;e+=4){g=c.subarray(e,e+4);d.set(N.QUAT4_IDENT);for(h=1;h<a.shape_keys.length;h++)m=a.shape_keys[h].geometry,f=a.shape_keys[h].init_value,f=Y.slerp(N.QUAT4_IDENT,
m.a_tbn_quat,f,Aa),Y.normalize(f,f),Y.multiply(f,d,d);Y.multiply(d,g,g)}}function b(a){return 65536<a.base_length?W.get_elem_index_uint()?!1:!0:!1}function f(a){return 0<a.indices.length?!0:!1}function l(a,b,c){if(!f(a))return a;c||ha.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.base_length*(b||1)+", will use drawArrays","color: #aa0");b=a.indices;c=a.base_length;var d=a.va_common,k=a.va_frames,g;for(g in d){var e=d[g],m=y(e,c);d[g]=q(b,e,m)}for(d=0;d<k.length;d++){var h=
k[d];for(g in h)e=h[g],m=y(e,c),h[g]=q(b,e,m)}for(d=0;d<a.shape_keys.length;d++){g=a.shape_keys[d].geometry;for(var t in g)e=g[t],m=y(e,c),g[t]=q(b,e,m)}a.base_length=b.length;a.indices=new Uint16Array(0);return a}function q(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),k=0;k<a.length;k++)for(var g=a[k],e=0;e<c;e++)d[c*k+e]=b[c*g+e];return d}function e(){return{ibo_array:null,vbo_source_data:g(),ibo_type:0,count:0,pointers:{},mode:0,usage:0,debug_ibo_bytes:0,
debug_vbo_bytes:0,vbo_data:[],ibo:null,shape_keys:null,instance_count:1,cleanup_gl_data_on_unload:!0}}function n(a,b){var c=a.pointers[b];if(c){var d=U(b);return L(a.vbo_source_data,d).subarray(c.offset,c.offset+c.length)}N.panic("extract_array() failed; invalid name: "+b)}function p(b,c){var d,k;switch(c){case a.DM_DEFAULT:case a.DM_TRIANGLES:d=S.TRIANGLES;k=S.STATIC_DRAW;break;case a.DM_POINTS:d=S.POINTS;k=S.STATIC_DRAW;break;case a.DM_DYNAMIC_TRIANGLES:d=S.TRIANGLES;k=S.DYNAMIC_DRAW;break;case a.DM_DYNAMIC_POINTS:d=
S.POINTS;k=S.DYNAMIC_DRAW;break;case a.DM_LINES:d=S.LINES;k=S.STATIC_DRAW;break;default:N.panic("Wrong draw_mode")}b.mode=d;b.usage=k}function B(a,b,c){var d={},k=function(a,b){d[a]||(d[a]=0);d[a]+=b},g;for(g in a[0]){var e=a[0][g],m=U(g);k(m,e.length*a.length)}for(g in b)e=b[g],m=U(g),k(m,e.length);if(c){a=c.tsr_array.length;m=U("a_part_ts");k(m,4*a);m=U("a_part_r");k(m,4*a);b=c.part_inh_attrs;for(g in b)m=U(g),k(m,b[g].num_comp*a);c=c.submesh_params;for(g in c)m=U(g),k(m,a)}return d}function c(a){a.ibo_array?
(a.ibo||(a.ibo=S.createBuffer()),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,a.ibo),S.bufferData(S.ELEMENT_ARRAY_BUFFER,a.ibo_array,a.usage),a.debug_ibo_bytes=a.ibo_array.byteLength):a.debug_ibo_bytes=0;for(var b=a.debug_vbo_bytes=0;b<a.vbo_source_data.length;b++){var c=a.vbo_source_data[b].type,d=G(a.vbo_data,c);-1==d&&(a.vbo_data.push({vbo:null,type:c,debug_id:N.unique_id()}),d=a.vbo_data.length-1);c=a.vbo_data[d];c.vbo||(c.vbo=S.createBuffer());S.bindBuffer(S.ARRAY_BUFFER,c.vbo);S.bufferData(S.ARRAY_BUFFER,
a.vbo_source_data[b].vbo_source,a.usage);a.debug_vbo_bytes+=a.vbo_source_data[b].vbo_source.byteLength}}function k(a,b){a.bb_local=T.bounding_box_transform(a.bb_local,b);a.be_local=T.bounding_ellipsoid_transform(a.be_local,b);a.bs_local=T.bounding_sphere_transform(a.bs_local,b);a.bbr_local=T.bounding_rot_box_transform(a.bbr_local,b)}function m(a){for(var b=a[0],c=a[0],d=x("JOIN_"+a.length+"_SUBMESHES"),k=0,g=0;g<a.length;g++)k+=a[g].indices.length;d.indices=new Uint32Array(k);var e=k=0;if(0<a[0].shape_keys.length)for(var m=
0;m<a[0].shape_keys.length;m++){for(g=0;g<a.length;g++)k+=a[g].shape_keys[m].geometry.a_position.length,e+=a[g].shape_keys[m].geometry.a_tbn_quat.length;g={a_position:new Float32Array(k),a_tbn_quat:new Float32Array(e)};d.shape_keys.push({init_value:a[0].shape_keys[m].init_value,geometry:g})}for(g=k=0;g<a.length;g++)k+=a[g].base_length;d.base_length=k;for(var f in c.va_common){for(g=k=0;g<a.length;g++)k+=a[g].va_common[f].length;d.va_common[f]=new Float32Array(k)}for(f in c.va_frames[0]){for(g=k=0;g<
a.length;g++)k+=a[g].va_frames[0][f].length;for(g=0;g<c.va_frames.length;g++)d.va_frames[g]=d.va_frames[g]||{},d.va_frames[g][f]=new Float32Array(k)}g=d.submesh_bd;g.bb_local=T.clone_bb(b.submesh_bd.bb_local);e=k=0;m=[];for(c=0;c<a.length;c++){var h=a[c],t=h.indices,l=h.base_length,n=h.va_common;f=h.submesh_bd.bs_local;T.expand_bounding_box(g.bb_local,h.submesh_bd.bb_local);T.expand_bounding_sphere(g.bs_local,f);T.extract_rot_bb_corners(h.submesh_bd.bbr_local,m);for(f=0;f<t.length;f++)d.indices[k+
f]=t[f]+e;var k=k+t.length,p;for(p in n){var t=n[p],I=e*y(t,l);d.va_common[p].set(t,I)}for(f=0;f<h.va_frames.length;f++){var n=h.va_frames[f],B=d.va_frames[f];for(p in n)t=n[p],I=e*y(t,l),B[p].set(t,I)}e+=l}g.be_local=T.create_be_by_bb(N.f32(m),!0);if(0<d.shape_keys.length)for(c=0;c<d.shape_keys.length;c++)for(p=d.shape_keys[c].geometry,f=k=g=0;f<a.length;f++)e=a[f].shape_keys[c].geometry,p.a_position.set(e.a_position,g),p.a_tbn_quat.set(e.a_tbn_quat,k),g+=e.a_position.length,k+=e.a_tbn_quat.length;
a[0].instanced_array_data&&(d.instanced_array_data={tsr_array:b.instanced_array_data.tsr_array,stat_part_em_tsr:b.instanced_array_data.stat_part_em_tsr,static_hair:!0,submesh_params:b.instanced_array_data.submesh_params,part_inh_attrs:b.instanced_array_data.part_inh_attrs,dyn_grass:b.instanced_array_data.dyn_grass});return d}function A(a,b,c){b=b.submesh_bd;for(var d=T.create_bb(),k=T.create_rot_bb(),g=[],e=0;e<c.length;e++)T.bounding_box_transform(a.submesh_bd.bb_local,c[e],d),T.expand_bounding_box(b.bb_local,
d),T.bounding_rot_box_transform(a.submesh_bd.bbr_local,c[e],k),T.extract_rot_bb_corners(k,g);b.be_local=T.create_be_by_bb(N.f32(g),!0);b.bbr_local=T.create_bbr_by_be(b.be_local);b.bs_local=T.create_bs_by_be(b.be_local)}function E(a,b,c,d,k,g){var e=a.submeshes[b],m=e.base_length,f=x("SUBMESH_"+a.name+"_"+a.materials[b].name);f.base_length=m;var h=!1;if(v(c,"a_texcoord")){var n=null,p=a.materials[b];b=a.submeshes[b];if(p.texture_slots.length)switch(p=p.texture_slots[0],p.texture_coords){case "UV":p=
a.uv_textures.indexOf(p.uv_layer);0==p?n=new Float32Array(b.texcoord):1==p&&(n=new Float32Array(b.texcoord2));break;case "ORCO":for(var I=a.b4w_boundings.bb_src,n=new Float32Array(2*b.base_length),p=(I.max_x+I.min_x)/2,B=(I.max_y+I.min_y)/2,A=I.max_x-I.min_x,I=I.max_y-I.min_y,H=0,q=0;q<b.position.length;q+=3)n[H++]=(b.position[q]-p)/A+.5,n[H++]=(b.position[q+1]-B)/I+.5}null===n&&(n=new Float32Array(2*b.base_length));b=n}else b=new Float32Array(0);if(v(c,"a_orco_tex_coord")){n=a.b4w_boundings.bb_src;
p=new Float32Array(3*e.base_length);B=n.max_x-n.min_x;A=n.max_y-n.min_y;I=n.max_z-n.min_z;for(q=H=0;q<e.position.length;q+=3)0==B?p[H++]=.5:p[H++]=N.clamp(parseFloat(((e.position[q]-n.min_x)/B).toFixed(5)),0,1),0==A?p[H++]=.5:p[H++]=N.clamp(parseFloat(((e.position[q+1]-n.min_y)/A).toFixed(5)),0,1),0==I?p[H++]=.5:p[H++]=N.clamp(parseFloat(((e.position[q+2]-n.min_z)/I).toFixed(5)),0,1);n=p}else n=new Float32Array(0);p=e.group;if(v(c,"a_influence")&&d){B=new Float32Array(4*m);A=p.length/m;I=new Float32Array(A);
for(H=0;H<A;H++){I[H]=-1;for(var y in d)if(q=d[y],q.vgroup_index===H){I[H]=q.deform_bone_index;break}}var M=3<A?A:4;d=new Float32Array(M);y=new Uint32Array(M);for(var H=new Float32Array(4),q=new Float32Array(M),M=new Uint32Array(M),ia=new Float32Array(4),C=0;C<m;C++)d.set(q),y.set(M),H.set(ia),B.set(z(p,A,C,m,I,d,y,H),4*C)}else B=new Float32Array(0);d=B;k=k?N.clone_object_r(k):{};k.a_color={generate_buffer:!0};v(c,"a_color")&&a.active_vcol_name?k.a_color.src=[{name:a.active_vcol_name,mask:7}]:k.a_color.src=
[];f.va_common.a_texcoord=b;f.va_common.a_influence=d;f.va_common.a_orco_tex_coord=n;d=f.va_common;y=e.vertex_colors;b=e.color;n=a.name;p=[];for(B=0;B<y.length;B++)p.push(y[B].name);for(var E in k)if(B=k[E].src,B.length){for(I=A=0;I<B.length;I++)A+=N.rgb_mask_get_channels_count(B[I].mask);d[E]=new Float32Array(A*m);for(I=H=0;I<B.length;I++){var D=B[I].name,q=B[I].mask,M=N.rgb_mask_get_channels_presence(q),G=p.indexOf(D);-1==G&&N.panic('vertex color "'+D+'" for mesh "'+n+'" not found.');ia=y[G].mask;
C=N.rgb_mask_get_channels_count(ia);(q&ia)!==q&&ha.error("Wrong color extraction from "+D+" to "+E+".");for(var D=y,P=m,la=0,Ba=0;Ba<G;Ba++)la+=N.rgb_mask_get_channels_count(D[Ba].mask);D=la*P;for(G=0;G<m;G++)for(P=0;3>P;P++)M[P]&&(la=H+N.rgb_mask_get_channel_presence_index(q,P),Ba=N.rgb_mask_get_channel_presence_index(ia,P),d[E][G*A+la]=b[D+G*C+Ba]);H+=C}}else d[E]=new Float32Array(0);E=a.uv_textures;k=e.texcoord;d=e.texcoord2;y=f.va_common;if(g)for(var Ma in g){b=E.indexOf(Ma);if(0==b)var Fa=new Float32Array(k);
else 1==b&&(Fa=new Float32Array(d));y[g[Ma]]=Fa}f.indices=new Uint32Array(e.indices);Ma=e.position.length/m/3;Fa=v(c,"a_tbn_quat")&&e.tbn_quat.length?!0:!1;E=v(c,"a_shade_tangs")&&e.shade_tangs.length?!0:!1;0<a.b4w_shape_keys.length&&(h=!0);for(k=0;k<Ma;k++){g=w(e,m,Fa,E,k);if(h)if(d={},d.name=a.b4w_shape_keys[k].name,f.shape_keys.push(d),0!=k){d.geometry=g;d.init_value=a.b4w_shape_keys[k].value;continue}else d.geometry=w(e,m,Fa,E,k),d.init_value=1;f.va_frames.push(g)}if(1<Ma&&!h){a=f.va_frames[0];
g={};for(var ta in a)g[ta]=new Float32Array(a[ta]);f.va_frames.push(g)}v(c,"a_polyindex")&&(l(f,1,!0),f.va_common.a_polyindex=t(f));e=e.boundings;c=f.submesh_bd;c.bb_local=T.create_bb();c.bb_local.max_x=e.bb.max_x;c.bb_local.max_y=e.bb.max_y;c.bb_local.max_z=e.bb.max_z;c.bb_local.min_x=e.bb.min_x;c.bb_local.min_y=e.bb.min_y;c.bb_local.min_z=e.bb.min_z;ta=e.rbb;a=e.caxis_x;m=e.caxis_y;h=e.caxis_z;g=e.be_ax;c.be_local=T.be_from_values(a,m,h,e.be_cen);ca.scale(c.be_local.axis_x,g[0],c.be_local.axis_x);
ca.scale(c.be_local.axis_y,g[1],c.be_local.axis_y);ca.scale(c.be_local.axis_z,g[2],c.be_local.axis_z);c.bs_local=T.create_bs_by_be(c.be_local);ca.copy(ta.rbb_c,c.bbr_local.center);ca.copy(a,c.bbr_local.axis_x);ca.copy(m,c.bbr_local.axis_y);ca.copy(h,c.bbr_local.axis_z);e=ta.rbb_s;ca.scale(c.bbr_local.axis_x,e[0],c.bbr_local.axis_x);ca.scale(c.bbr_local.axis_y,e[1],c.bbr_local.axis_y);ca.scale(c.bbr_local.axis_z,e[2],c.bbr_local.axis_z);return f}function w(a,b,c,d,k){var g={},e=new Float32Array(3*
b),m=new Float32Array(c?4*b:0),f=k*b*3;e.set(a.position.subarray(f,f+3*b),0);c&&(f=k*b*4,m.set(a.tbn_quat.subarray(f,f+4*b),0));d&&(c=new Float32Array(3*b),c.set(a.shade_tangs.subarray(0,3*b),0),g.a_shade_tangs=c);g.a_position=e;g.a_tbn_quat=m;return g}function v(a,b){return-1<a.indexOf(b)?!0:!1}function z(b,c,d,k,g,e,m,f){for(var h=!0,t=0;t<c;t++){var l=b[t*k+d];if(-1!==l){var n=g[t];-1!==n&&(e[t]=l,m[t]=n,h=!1)}}if(h)return f;D(e,m,a.SORT_NUMERIC,!1);for(t=b=0;4>t;t++)b+=e[t];if(.01>b)return f;
for(t=0;4>t;t++)e[t]/=b;if(.01>Math.abs(e[0]-1))f[0]=m[0]+1;else for(t=0;4>t;t++)f[t]=m[t]+e[t];return f}function y(a,b){if(0==b)return 0;var c=a.length,d=c/b;d!=Math.floor(d)&&N.panic("Array size mismatch during geometry calculation: array length="+c+", base length="+b);return d}function D(b,c,d,k){for(var g=b.length,e=g,m=!1,f=k?-1:1;1<e||m;){1<e&&(e=Math.floor(e/1.247330950103979));for(var m=!1,h=0;e+h<g;h++)if(d==a.SORT_NUMERIC?0>f*(b[h]-b[h+e]):b[h]<b[h+e]&&k)m=b[h],b[h]=b[h+e],b[h+e]=m,m=c[h],
c[h]=c[h+e],c[h+e]=m,m=!0}}function K(a,b,c){var d=[],k=[];ca.subtract(b,a,d);ca.subtract(c,a,k);ca.normalize(d,d);ca.normalize(k,k);a=N.clamp(ca.dot(d,k),-1,1);return Math.acos(a)}function d(a,b,c){if(f(b)){b=b.indices;for(var d=b.length/3,k=0;k<d;k++){var g=new Float32Array(9),e=b[3*k];g[0]=a[3*e];g[1]=a[3*e+1];g[2]=a[3*e+2];e=b[3*k+1];g[3]=a[3*e];g[4]=a[3*e+1];g[5]=a[3*e+2];e=b[3*k+2];g[6]=a[3*e];g[7]=a[3*e+1];g[8]=a[3*e+2];c[k]=g}}else for(k=0;k<a.length;k++)g=new Float32Array(9),g[0]=a[9*k],
g[1]=a[9*k+1],g[2]=a[9*k+2],g[3]=a[9*k+3],g[4]=a[9*k+4],g[5]=a[9*k+5],g[6]=a[9*k+6],g[7]=a[9*k+7],g[8]=a[9*k+8],c[k]=g;return c}function t(a){for(var b=new Float32Array(a.base_length),c=0;c<a.base_length;c++)b[c]=c%3/2;return b}function C(a,b,c){var d=ca.dist(a,b);a=ca.dist(a,c);b=ca.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function M(a){for(var b=new Float32Array([0,0,0,1,1,1,1,0]),c=new Float32Array(8*a),d=0;d<a;d++)c.set(b,8*d);return c}function x(a){var b={a_influence:new Float32Array(0),
a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,base_length:0,indices:null,va_frames:[],va_common:b,shape_keys:[],submesh_bd:{bb_local:T.create_bb(),be_local:T.create_be(),bs_local:T.create_bs(),bbr_local:T.create_rot_bb()},instanced_array_data:null}}function g(a){var b=[],c;for(c in a)b.push(H(c,a[c]));return b}function H(a,b){return{vbo_source:new (F(a))(b),type:a}}function G(a,b){for(var c=0;c<a.length;c++)if(a[c].type==b)return c;return-1}function ba(a,b){var c=G(a,b);
return-1==c?null:a[c].vbo}function L(a,b){var c=G(a,b);return-1==c?null:a[c].vbo_source}function F(a){switch(a){case "float":return Float32Array;case "short":return Int16Array;case "unsigned_byte":return Uint8Array;default:return Float32Array}}function U(a){a=a.replace(/_next$/,"");a=a.replace(/param_GEOMETRY_VC_a_\w+/,"param_GEOMETRY_VC_a");switch(a){case "a_tbn_quat":case "a_shade_tangs":return"short";case "a_color":case "a_bending_col_main":case "a_bending_col_detail":case "a_grass_size":case "a_grass_color":case "param_GEOMETRY_VC_a":case "a_polyindex":case "a_p_bb_vertex":case "a_halo_bb_vertex":case "a_bb_vertex":return"unsigned_byte";
default:return"float"}}function Q(a,b,c,d){var k=U(b);b=G(a,k);switch(k){case "float":a[b].vbo_source.set(c,d);break;case "short":for(k=0;k<c.length;k++)a[b].vbo_source[d+k]=N.float_to_short(c[k]);break;case "unsigned_byte":for(k=0;k<c.length;k++)a[b].vbo_source[d+k]=N.ufloat_to_ubyte(c[k])}}var T=r("__boundings"),W=r("__extensions"),ha=r("__print"),Y=r("__quat"),Z=r("__tsr"),N=r("__util"),ca=r("__vec3");new Float32Array(2);var I=new Float32Array(3),ma=new Float32Array(3),da=new Float32Array(3),fa=
new Float32Array(4),Aa=new Float32Array(4),ra=new Float32Array(8);a.DM_TRIANGLES=10;a.DM_POINTS=20;a.DM_DYNAMIC_TRIANGLES=30;a.DM_DYNAMIC_POINTS=40;a.DM_LINES=50;a.SORT_NUMERIC=0;a.SORT_STRING=1;a.DM_DEFAULT=a.DM_TRIANGLES;var S=null;a.VBO_FLOAT="float";a.VBO_SHORT="short";a.VBO_UBYTE="unsigned_byte";a.setup_context=function(a){S=a};a.submesh_to_bufs_data=function(a,d,k,m){b(a)&&l(a);var f=a.indices,t=a.base_length,n=a.va_frames,I={},x;for(x in a.va_common)x in k&&!k[x].generate_buffer||(I[x]=a.va_common[x]);
k=e();0<a.shape_keys.length&&h(a,n[0]);x=a.instanced_array_data;if(f.length)if(m=f.length,65536>=t)var f=new Uint16Array(f),A=S.UNSIGNED_SHORT;else f=new Uint32Array(f),A=S.UNSIGNED_INT;else m=t,f=null;for(var v=B(n,I,x),v=g(v),H={},q=0;q<v.length;q++)H[v[q].type]=0;var w={},z;for(z in I){var M=I[z],C=M.length;if(C){var E=U(z),q=w[z]=u();q.length=C;q.num_comp=y(M,t);q.offset=H[E];Q(v,z,M,H[E]);H[E]+=C}}I=n.length;for(z in n[0])if(M=n[0][z],E=U(z),C=M.length,M=y(M,t),C)for(q=w[z]=u(),q.length=C,q.frames=
I,q.num_comp=M,q.offset=H[E],1<I&&(q=w[z+"_next"]=u(),q.length=C,q.frames=I,q.num_comp=M,q.offset=H[E]+C),q=0;q<I;q++)M=n[q][z],E=U(z),Q(v,z,M,H[E]),H[E]+=C;if(x){t=x.tsr_array;n=x.stat_part_em_tsr;I=x.part_inh_attrs;C=x.submesh_params;t=x.tsr_array;n=x.stat_part_em_tsr;I=x.part_inh_attrs;C=x.submesh_params;E=x.static_hair;z={a_part_ts:{data:[],num_comp:4},a_part_r:{data:[],num_comp:4}};for(var D in I)z[D]={data:[],num_comp:I[D].num_comp};for(D in C)z[D]={data:[],num_comp:1};for(M=0;M<t.length;M++){q=
t[M];E&&n&&!x.dyn_grass&&(q=Z.multiply(n,t[M],ra));!E&&x.dyn_grass&&ca.subtract(t[M],n,t[M]);z.a_part_ts.data.push(q[0],q[1],q[2],q[3]);z.a_part_r.data.push(q[4],q[5],q[6],q[7]);for(D in I)for(var q=I[D].num_comp,ia=0;ia<q;ia++)z[D].data.push(I[D].data[M*q+ia]);for(D in C)z[D].data.push(C[D][0])}for(D in z)t=U(D),Q(v,D,z[D].data,H[t]),n=u(),n.num_comp=z[D].num_comp,n.offset=H[t],n.divisor=1,n.length=z[D].data.length,w[D]=n,H[t]+=n.length;k.instance_count=x.tsr_array.length}k.count=m;k.ibo_array=f;
k.vbo_source_data=v;k.ibo_type=A;k.pointers=w;p(k,d);c(k);k.shape_keys=a.shape_keys;return k};a.submesh_init_shape_keys=h;a.is_long_submesh=b;a.is_indexed=f;a.submesh_drop_indices=l;a.update_bufs_data_index_array=function(a,b,c){p(a,b);a.count=c.length;a.ibo_array=c;a.ibo_type=c instanceof Uint16Array?S.UNSIGNED_SHORT:S.UNSIGNED_INT;return a};a.update_bufs_data_array=function(a,b,d,k){var g=a.pointers,e=g[b],m=U(b);if(e)d&&e.num_comp!=d&&N.panic('invalid num_comp for "'+b+'"'),Q(a.vbo_source_data,
b,k,e.offset);else{e=G(a.vbo_source_data,m);-1==e&&(a.vbo_source_data.push(H(m,0)),e=a.vbo_source_data.length-1);var m=a.vbo_source_data[e].vbo_source,f=new m.constructor(m.length+k.length);f.set(m);a.vbo_source_data[e].vbo_source=f;Q(a.vbo_source_data,b,k,m.length);b=g[b]=u();b.num_comp=d;b.offset=m.length;b.length=k.length}c(a);return a};a.extract_array=n;a.make_static=function(a){a.usage=S.STATIC_DRAW};a.make_dynamic=function(a){a.usage=S.DYNAMIC_DRAW};a.update_gl_buffers=c;a.cleanup_bufs_data=
function(a){a.ibo&&S.deleteBuffer(a.ibo);for(var b=0;b<a.vbo_data.length;b++)a.vbo_data[b].vbo&&S.deleteBuffer(a.vbo_data[b].vbo);a.vbo_data.length=0};a.has_empty_submesh=function(a,b){return a.submeshes[b].base_length?!1:!0};a.submesh_apply_transform=function(a,b){for(var c=0;c<a.va_frames.length;c++){var d=a.va_frames[c].a_position;Z.transform_vectors(d,b,d,0);d=a.va_frames[c].a_tbn_quat;0<d.length&&Z.transform_quats(d,b,d,0);(d=a.va_frames[c].a_shade_tangs)&&0<d.length&&Z.transform_dir_vectors(d,
b,d,0)}(c=a.va_common.au_center_pos)&&c.length&&Z.transform_vectors(c,b,c,0);k(a.submesh_bd,b);return a};a.submesh_apply_particle_transform=function(a,b){var c=a.va_common.au_center_pos;if(c&&c.length){var d=new Float32Array(c);Z.transform_vectors(d,b,d,0);for(var g=0;g<a.va_frames.length;g++)for(var e=0;e<d.length;e++)a.va_frames[g].a_position[e]+=d[e]-c[e];c.set(d)}else N.panic('Attribute "au_center_pos" is missing in particle submesh');k(a.submesh_bd,b);return a};a.bounding_data_apply_transform=
k;a.submesh_apply_params=function(a,b){var c=a.base_length,d;for(d in b){var k=b[d].length;a.va_common[d]=new Float32Array(k*c);for(var g=0;g<c;g++)for(var e=0;e<k;e++)a.va_common[d][g*k+e]=b[d][e]}return a};a.submesh_list_join=m;a.make_clone_submesh=function(a,b,c){if(!a.base_length)return x("EMPTY");var d=c.length;65536<a.base_length*d&&!W.get_elem_index_uint()&&l(a,d);var k=a.indices,g=a.base_length,e=a.va_common,m=a.va_frames,f;for(f in b){var h=b[f].length,t=h*g;e[f]=new Float32Array(t);for(var n=
0;n<g;n++)for(t=0;t<h;t++)e[f][n*h+t]=b[f][t]}b=x("CLONE_"+d+"_SUBMESHES");b.base_length=g*d;b.indices=new Uint32Array(k.length*d);for(n=0;n<d;n++)for(h=k.length*n,f=g*n,t=0;t<k.length;t++)b.indices[h+t]=k[t]+f;for(var p in e)for(k=e[p],t=k.length*d,h=y(k,g),b.va_common[p]=new Float32Array(t),n=0;n<d;n++)f=g*h*n,b.va_common[p].set(k,f);for(p in m[0])for(n=0;n<m.length;n++)for(k=m[n][p],t=k.length*d,h=y(k,g),b.va_frames[n]=b.va_frames[n]||{},b.va_frames[n][p]=new Float32Array(t),t=0;t<d;t++)switch(e=
c[t],f=g*h*t,p){case "a_position":Z.transform_vectors(k,e,b.va_frames[n][p],f);break;case "a_tbn_quat":Z.transform_quats(k,e,b.va_frames[n][p],f);break;case "a_shade_tangs":Z.transform_tangents(k,e,b.va_frames[n][p],f);break;default:N.panic("Wrong attribute name: "+p)}A(a,b,c);return b};a.calc_unit_boundings=A;a.extract_submesh=E;a.extract_halo_submesh=function(a){var b=a.base_length,c=a.va_frames[0].a_position,d=new Float32Array(12*b);a=new Uint32Array(4*a.indices.length);for(var k=new Float32Array(4*
b),g=0;g<b;g++){d[12*g]=c[3*g];d[12*g+1]=c[3*g+1];d[12*g+2]=c[3*g+2];d[12*g+3]=c[3*g];d[12*g+4]=c[3*g+1];d[12*g+5]=c[3*g+2];d[12*g+6]=c[3*g];d[12*g+7]=c[3*g+1];d[12*g+8]=c[3*g+2];d[12*g+9]=c[3*g];d[12*g+10]=c[3*g+1];d[12*g+11]=c[3*g+2];a[6*g]=4*g+2;a[6*g+1]=4*g+1;a[6*g+2]=4*g;a[6*g+3]=4*g+2;a[6*g+4]=4*g;a[6*g+5]=4*g+3;var e=Math.random();k[4*g]=e;k[4*g+1]=e;k[4*g+2]=e;k[4*g+3]=e}c=x("HALO");c.va_frames[0]={};c.base_length=4*b;c.va_frames[0].a_position=d;c.va_common.a_halo_bb_vertex=M(b);c.va_common.a_random_vals=
k;c.indices=a;return c};a.has_attr=v;a.extract_submesh_all_mats=function(a,b,c){for(var d=[],k=0;k<a.submeshes.length;k++){var g=E(a,k,b,null,c,null);g.base_length&&d.push(g)}return 0==d.length?x("EMPTY"):1==d.length?d[0]:m(d)};a.update_buffers_movable=function(a,b,c,d){var k=a.ibo_array,g=n(a,"a_position"),e=b.median_cache,m=b.median_world_cache;b=b.dist_cache;for(var f=k,h=f.length/3,t=0;t<h;t++){var l=f[3*t],p=f[3*t+1],I=f[3*t+2],x=g[3*l+1],B=g[3*l+2],A=g[3*p+1],v=g[3*p+2],H=g[3*I+1],q=g[3*I+2];
e[3*t]=(g[3*l]+g[3*p]+g[3*I])/3;e[3*t+1]=(x+A+H)/3;e[3*t+2]=(B+v+q)/3}Z.transform_vectors(e,c,m);c=m.length/3;for(g=0;g<c;g++)e=m[3*g]-d[0],f=m[3*g+1]-d[1],h=m[3*g+2]-d[2],b[g]=e*e+f*f+h*h;d=k;k=b.length;if(!(2>k))for(m=k,g=!1;1<m||g;)for(1<m&&(m=Math.floor(m/1.247330950103979)),g=!1,c=0;m+c<k;c++)0>b[c]-b[c+m]&&(g=b[c],b[c]=b[c+m],b[c+m]=g,g=d,e=c,f=c+m,h=g[3*e],t=g[3*e+1],l=g[3*e+2],g[3*e]=g[3*f],g[3*e+1]=g[3*f+1],g[3*e+2]=g[3*f+2],g[3*f]=h,g[3*f+1]=t,g[3*f+2]=l,g=!0);k=d;S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,
a.ibo);S.bufferData(S.ELEMENT_ARRAY_BUFFER,k,S.DYNAMIC_DRAW)};a.sort_two_arrays=D;a.calc_normals=function(a,b,c){for(var d=b.length/3,k=a.length/3,g=[],e=Array(3),m=Array(3),f=Array(3),h=0;h<k;h++){for(var t=a[3*h],l=a[3*h+1],n=a[3*h+2],p=0;3>p;p++)e[p]=b[3*t+p],m[p]=b[3*l+p],f[p]=b[3*n+p];if(c)var p=K(e,m,f),I=K(m,f,e),x=Math.PI-p-I;else x=I=p=1;var B=g,A;A=e;var v=f,H=[],q=[],w=[];ca.subtract(m,A,H);ca.subtract(v,A,q);ca.cross(H,q,w);ca.normalize(w,w);A=w;for(v=0;3>v;v++)H=3*l+v,q=3*n+v,B[3*t+v]=
p*A[v],B[H]=I*A[v],B[q]=x*A[v]}if(c)for(var y in c)for(h=c[y],a=0;3>a;a++){b=3*h[0]+a;for(k=1;k<h.length;k++)e=3*h[k]+a,g[b]+=g[e];for(k=1;k<h.length;k++)e=3*h[k]+a,g[e]=g[b]}for(h=0;h<d;h++){c=h;y=g;a=new Float32Array(3);for(b=0;3>b;b++)k=3*c+b,a[b]=y[k];ca.normalize(a,a);for(b=0;3>b;b++)k=3*c+b,y[k]=a[b]}return g};a.calc_shared_indices=function(a,b,c){for(var d={},k=b.length/3,g=0;g<k;g++){var e=String(b[3*g])+String(b[3*g+1])+String(b[3*g+2]);d[e]=[]}k=a.length;for(g=0;g<k;g++)b=a[g],e=String(c[3*
b])+String(c[3*b+1])+String(c[3*b+2]),e in d&&d[e].push(b);return d};a.geometry_random_points=function(a,b,c,k){var g;g=null;g=[];g=d(a.va_frames[0].a_position,a,g);if(c){var e;e=null;e=[];for(var m=a.va_frames[0].a_tbn_quat,f=m.length/4,h=new Float32Array(3*f),t=0;t<f;t++){var l=fa;l[0]=m[4*t];l[1]=m[4*t+1];l[2]=m[4*t+2];l[3]=m[4*t+3];l=ca.transformQuat(N.AXIS_Y,l,I);h[3*t]=l[0];h[3*t+1]=l[1];h[3*t+2]=l[2]}e=d(h,a,e)}f=g.length;h=new Float32Array(f);for(a=0;a<f;a++)t=g[a],I.set(t.subarray(0,3)),
ma.set(t.subarray(3,6)),da.set(t.subarray(6)),h[a]=Math.sqrt(C(I,ma,da));m=new Float32Array(f);m[0]=h[0];for(a=1;a<f;a++)m[a]=m[a-1]+h[a];f=m[h.length-1];h=[];for(a=0;a<b;a++){var t=f*N.rand_r(k),t=N.binary_search_max(m,t,0,m.length-1),n=t=c?e[t]:g[t],p=k;(t=I)||(t=new Float32Array(3));var l=n[0],x=n[1],B=n[2],A=n[3],v=n[4],H=n[5],q=n[6],w=n[7],y=n[8],n=N.rand_r(p),p=N.rand_r(p);1<n+p&&(n=1-n,p=1-p);var z=1-n-p,x=z*x+n*v+p*w,B=z*B+n*H+p*y;t[0]=z*l+n*A+p*q;t[1]=x;t[2]=B;c?(h[a]=new Float32Array(4),
ca.normalize(t,t),t=Y.rotationTo(N.AXIS_Y,t,fa),h[a][0]=t[0],h[a][1]=t[1],h[a][2]=t[2],h[a][3]=t[3]):(h[a]=new Float32Array(3),h[a][0]=t[0],h[a][1]=t[1],h[a][2]=t[2])}return h};a.extract_polyindices=t;a.triangle_area_squared=C;a.gen_bb_vertices=M;a.scale_submesh_xyz=function(a,b,c){a=a.va_frames[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.apply_shape_key=function(a,b,c){var d=a.scenes_data[0].batches;a=a.render.shape_keys_values;
for(var k=1;k<a.length;k++)a[k].name==b&&(a[k].value=c);for(k=0;k<d.length;k++)if(!d[k].forked_batch&&d[k].use_shape_keys&&!d[k].debug_sphere){b=d[k].bufs_data;var g=U("a_position");c=ba(b.vbo_data,g);g=L(b.vbo_source_data,g);S.bindBuffer(S.ARRAY_BUFFER,c);var e=b.pointers.a_position;c=d[k];var m=a;if(e){for(var f=e.offset,e=e.length+f,h=c.bufs_data.shape_keys[0].geometry.a_position,t=f;t<e;t++)g[t]=h[t-f];for(t=1;t<c.bufs_data.shape_keys.length;t++){var h=c.bufs_data.shape_keys[t].geometry.a_position,
l=m[t].value;if(l)for(var n=f;n<e;n++)g[n]+=l*h[n-f]}S.bufferSubData(S.ARRAY_BUFFER,N.FLOAT_SIZE*f,g.subarray(f))}g=U("a_tbn_quat");c=ba(b.vbo_data,g);g=L(b.vbo_source_data,g);S.bindBuffer(S.ARRAY_BUFFER,c);f=b.pointers.a_tbn_quat;b=d[k];c=g;g=a;if(f){m=f.offset;f=f.length+m;e=b.bufs_data.shape_keys[0].geometry.a_tbn_quat;t=fa;for(h=m;h<f;h+=4){t[0]=0;t[1]=0;t[2]=0;for(l=t[3]=1;l<b.bufs_data.shape_keys.length;l++){var n=b.bufs_data.shape_keys[l].geometry.a_tbn_quat,p=g[l].value;if(p){var I=Aa;I[0]=
n[h-m];I[1]=n[h+1-m];I[2]=n[h+2-m];I[3]=n[h+3-m];n=Y.slerp(N.QUAT4_IDENT,I,p,Aa);Y.multiply(n,t,t)}}l=Aa;l[0]=e[h-m];l[1]=e[h-m+1];l[2]=e[h-m+2];l[3]=e[h-m+3];n=0<l[3];Y.multiply(t,l,l);(0<l[3]&&!n||0>l[3]&&n)&&Y.scale(l,-1,l);c[h]=N.float_to_short(l[0]);c[h+1]=N.float_to_short(l[1]);c[h+2]=N.float_to_short(l[2]);c[h+3]=N.float_to_short(l[3])}S.bufferSubData(S.ARRAY_BUFFER,N.FLOAT_SIZE*m,c.subarray(m))}}};a.check_shape_keys=function(a){return a.render.use_shape_keys};a.get_shape_keys_names=function(a){var b=
[];if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)b.push(a.render.shape_keys_values[c].name);return b};a.get_shape_key_value=function(a,b){if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)if(b==a.render.shape_keys_values[c].name)return a.render.shape_keys_values[c].value;return 0};a.has_shape_key=function(a,b){var c=a.render.shape_keys_values;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.has_dyn_geom=function(a){return a&&a.render&&a.render.dynamic_geometry?
!0:!1};a.draw_line=function(b,d,k){var e=b.bufs_data;if(e){for(var m=k?d.length/3/2:d.length/3-1,f=new Float32Array(12*m),h=new Float32Array(12*m),t=new Uint16Array(6*m),l=0;l<m;l++){if(k)var n=6*l,p=6*l+3;else n=3*l,p=3*(l+1);var I=d[n],x=d[n+1],n=d[n+2],B=d[p],A=d[p+1],p=d[p+2],v=B-I,H=A-x,q=p-n;f[12*l]=I;f[12*l+1]=x;f[12*l+2]=n;h[12*l]=v;h[12*l+1]=H;h[12*l+2]=q;f[12*l+3]=B;f[12*l+4]=A;f[12*l+5]=p;h[12*l+3]=-v;h[12*l+4]=-H;h[12*l+5]=-q;f[12*l+6]=I;f[12*l+7]=x;f[12*l+8]=n;h[12*l+6]=-v;h[12*l+7]=
-H;h[12*l+8]=-q;f[12*l+9]=B;f[12*l+10]=A;f[12*l+11]=p;h[12*l+9]=v;h[12*l+10]=H;h[12*l+11]=q;t[6*l]=4*l;t[6*l+1]=4*l+1;t[6*l+2]=4*l+2;t[6*l+3]=4*l;t[6*l+4]=4*l+3;t[6*l+5]=4*l+1}k=0;for(var w in e.pointers)d=e.pointers[w],k+=f.length/3*d.num_comp;d={};d["float"]=k;k=e.vbo_source_data=g(d);a.update_bufs_data_index_array(e,b.draw_mode,t);b=0;for(w in e.pointers)switch(d=e.pointers[w],w){case "a_position":Q(k,w,f,b);d.offset=b;d.length=f.length;b+=d.length;break;case "a_direction":Q(k,w,h,b);d.offset=
b;d.length=h.length;b+=d.length;break;default:d.offset=b,d.length=f.length/3*d.num_comp,t=new Float32Array(d.length),Q(k,w,t,b),b+=d.length}c(e)}};a.clone_bufs_data=function(a){var b=e();if(a.ibo_array)switch(a.ibo_type){case S.UNSIGNED_SHORT:b.ibo_array=new Uint16Array(a.ibo_array);break;case S.UNSIGNED_INT:b.ibo_array=new Uint32Array(a.ibo_array)}else b.ibo_array=null;for(var c=a.vbo_source_data,d=[],k=0;k<c.length;k++){var g=c[k].vbo_source,m=c[k].type;d.push({vbo_source:new g.constructor(g),type:m})}b.vbo_source_data=
d;b.ibo_type=a.ibo_type;b.count=a.count;b.pointers=N.clone_object_r(a.pointers);b.mode=a.mode;b.usage=a.usage;b.debug_ibo_bytes=a.debug_ibo_bytes;b.debug_vbo_bytes=a.debug_vbo_bytes;b.ibo=null;b.info_for_z_sort_updates=N.clone_object_r(a.info_for_z_sort_updates);b.shape_keys=N.clone_object_r(a.shape_keys);b.instance_count=a.instance_count;b.cleanup_gl_data_on_unload=a.cleanup_gl_data_on_unload;return b};a.init_submesh=x;a.reset=function(){S=null};a.init_vbo_source_data=g;a.search_vbo_index_by_type=
G;a.get_vbo_by_type=ba;a.get_vbo_source_by_type=L;a.get_constructor_by_type=F;a.get_vbo_type_by_attr_name=U;a.get_type_size_by_attr_name=function(a){switch(U(a)){case "float":return N.FLOAT_SIZE;case "short":return N.SHORT_SIZE;case "unsigned_byte":return N.BYTE_SIZE;default:return N.FLOAT_SIZE}};a.get_gl_type_by_attr_name=function(a){switch(U(a)){case "float":return S.FLOAT;case "short":return S.SHORT;case "unsigned_byte":return S.UNSIGNED_BYTE;default:return S.FLOAT}};a.vbo_source_data_set_attr=
Q};b4w.module.__objects=function(a,r){function u(a){var b=a.scenes_data;a=a.render;for(var c=0;c<b.length;c++){var d=b[c].scene;d._render.outline&&a.outline_intensity&&H.request_outline(d)}}function h(a){a.render.outline_intensity=0;a=fa.indexOf(a);-1!=a&&fa.splice(a,1)}function b(a){if(a.field)for(var b=a.scenes_data,c=0;c<b.length;c++)H.update_force_scene(b[c].scene,a)}function f(a,b){for(var c=a.scenes_data,k=b.scenes_data,g=0;g<c.length;g++){for(var e=!1,m=0;m<k.length;m++)if(c[g].scene==k[m].scene){e=
!0;break}e||l(b,c[g].scene)&&d.append_scene_data(b,c[g].scene)}}function l(a,b){return!b._is_main&&"SPEAKER"==a.type||!b._is_primary_thread&&("LAMP"==a.type||"CAMERA"==a.type)?!1:!0}function q(a,b){if(a.b4w_hidden_on_load||a.dg_parent&&a.dg_parent._is_dynamic||a.parent&&a.parent._is_dynamic)return!0;switch(a.type){case "MESH":var c=k.bpy_obj_is_animatable(a,b),d=a.b4w_do_not_batch,g=a.b4w_collision,m=a.b4w_vehicle,f=a.b4w_floating,h=a.b4w_character,l=t.has_dynamic_grass_particles(a),n=D.bpy_obj_has_nla(a),
p=0<a.data.b4w_shape_keys.length,I=a.b4w_dynamic_geometry;if(!(c=c||d||g||m||p||f||l||h||n||I))a:{c=a.data;for(d=0;d<c.materials.length;d++)if(g=c.materials[d],g.b4w_lens_flares||e(g.node_tree)){c=!0;break a}c=!1}return c;case "EMPTY":return c=k.bpy_obj_is_animatable(a,b),d=D.bpy_obj_has_nla(a),g=a.b4w_do_not_batch,m=Boolean(a.b4w_anchor),c||d||g||m;default:return!0}}function e(a){if(!a)return!1;a=a.nodes;for(var b=0;b<a.length;b++){var c=a[b];if("VECT_TRANSFORM"==c.type){var d=c.convert_from,k=c.convert_to,
g=c.outputs[0];if(!(!g.is_linked||"WORLD"==d&&"CAMERA"==k||"CAMERA"==d&&"WORLD"==k||"OBJECT"==d&&"OBJECT"==k))return!0}if("NORMAL_MAP"==c.type&&(d=c.space,g=c.outputs[0],g.is_linked&&("OBJECT"==d||"BLENDER_OBJECT"==d)))return!0}return!1}function n(a,b){var c=a.animation_data,d=a.data?a.data.animation_data:null;c&&c.action&&(c=c.action,(c._render.type==k.OBJ_ANIM_TYPE_OBJECT||c._render.type==k.OBJ_ANIM_TYPE_ARMATURE&&"ARMATURE"==b.type||c._render.type==k.OBJ_ANIM_TYPE_LIGHT&&"LAMP"==b.type||c._render.type==
k.OBJ_ANIM_TYPE_ENVIRONMENT&&"WORLD"==b.type)&&b.def_action_slots.push(k.init_action_slot(null,c)));d&&d.action&&("SPEAKER"==b.type||"LAMP"==b.type)&&b.def_action_slots.push(k.init_action_slot(null,d.action));"MESH"==b.type&&b.def_action_slots.push.apply(b.def_action_slots,k.get_bpy_material_actions(a))}function p(a,b,c){b=N[b]||[];for(var d=[],k=0;k<b.length;k++){var g=b[k];if(g.render.data_id==c||-1==c)for(var e=g.scenes_data,m=0;m<e.length;m++)e[m].scene==a&&d.push(g)}return d}function B(a,b,c,
k){for(var g=null,e=0;e<b.length;e++){var m=b[e];if((c?m.origin_name:m.name)==a&&(m.render.data_id==k||-1==k)&&(g=m,!d.get_dg_parent(g)))break}return g}function c(a){N.ALL.push(a);N[a.type]||(N[a.type]=[]);N[a.type].push(a);var b=a.render.plane_reflection_id;if(null!=b)for(var c=0;c<da.length;c++){var d=da[c];d.render.plane_reflection_id==b&&d.reflective_objs.push(a)}}var k=r("__animation"),m=r("__batch"),A=r("__boundings"),E=r("__camera"),w=r("__config"),v=r("__constraints"),z=r("__geometry"),y=
r("__lights"),D=r("__nla"),K=r("__nodemat"),d=r("__obj_util"),t=r("__particles"),C=r("__physics"),M=r("__print"),x=r("__primitives"),g=r("__quat"),H=r("__scenes"),G=r("__sfx"),ba=r("__transform"),L=r("__textures"),F=r("__tsr"),U=r("__util"),Q=r("__vec3"),T=r("__armature"),W=r("__anchors"),ha=r("__renderer"),Y=w.defaults,Z=w.outlining,N={ALL:[]},ca=new Float32Array(24),I=0,ma=0,da=[],fa=[],Aa=new Float32Array(3),ra=new Float32Array(4);a.GET_OBJECT_BY_NAME=0;a.GET_OBJECT_BY_DUPLI_NAME=1;a.GET_OBJECT_BY_DUPLI_NAME_LIST=
2;a.DATA_ID_ALL=-1;a.update=function(a,b){for(var c=N.ARMATURE,d=0;d<fa.length;d++){var k=fa[d];var g=k,e=a,m=0,f=g.outline_animation;0==f.time_start&&(f.time_start=e);e-=f.time_start;if(f.relapses&&e/f.period>=f.relapses)h(g);else{e%=f.period;if(e<f.outline_time)switch(f=e/(f.outline_time/5),e=Math.floor(f),e){case 0:m=(f-e)/2;break;case 1:m=(f-e)/2+.5;break;case 2:m=1;break;case 3:m=1-(f-e)/2;break;case 4:m=.5-(f-e)/2}g.render.outline_intensity=m}k.render.outline_intensity&&u(k)}if(c)for(d=0;d<
c.length;d++)k=c[d],k.need_update_transform&&(ba.update_transform(k),k.need_update_transform=!1)};a.set_outline_intensity=function(a,b){a.render.outline_intensity=b;u(a)};a.apply_outline_anim=function(a,b,c,d){var k=a.outline_animation;k.time_start=0;k.outline_time=b;k.period=c;k.relapses=d;-1==fa.indexOf(a)&&fa.push(a)};a.clear_outline_anim=h;a.update_object=function(a,b){b.uuid=a.uuid;b.bpy_origin=!0;n(a,b);a._is_dynamic=b.is_dynamic=q(a,b);a._is_updated=!0;b.is_vehicle=a.b4w_vehicle;b.is_character=
a.b4w_character;b.is_floating=a.b4w_floating;b.use_obj_physics=a.b4w_collision;b.collision_id=a.b4w_collision_id;b.correct_bounding_offset=a.b4w_correct_bounding_offset;var g=a.game;b.physics_settings={physics_type:g.physics_type,use_ghost:g.use_ghost,use_sleep:g.use_sleep,mass:g.mass,velocity_min:g.velocity_min,velocity_max:g.velocity_max,damping:g.damping,rotation_damping:g.rotation_damping,lock_location_x:g.lock_location_x,lock_location_y:g.lock_location_y,lock_location_z:g.lock_location_z,lock_rotation_x:g.lock_rotation_x,
lock_rotation_y:g.lock_rotation_y,lock_rotation_z:g.lock_rotation_z,collision_margin:g.collision_margin,collision_group:g.collision_group,collision_mask:g.collision_mask,use_collision_bounds:g.use_collision_bounds,collision_bounds_type:g.collision_bounds_type,use_collision_compound:g.use_collision_compound};if(g=a.b4w_vehicle_settings)b.vehicle_settings={name:g.name,part:g.part,suspension_rest_length:g.suspension_rest_length,suspension_compression:g.suspension_compression,suspension_stiffness:g.suspension_stiffness,
suspension_damping:g.suspension_damping,wheel_friction:g.wheel_friction,roll_influence:g.roll_influence,max_suspension_travel_cm:g.max_suspension_travel_cm,force_max:g.force_max,brake_max:g.brake_max,steering_max:g.steering_max,max_speed_angle:g.max_speed_angle,delta_tach_angle:g.delta_tach_angle,speed_ratio:g.speed_ratio,steering_ratio:g.steering_ratio,inverse_control:g.inverse_control,floating_factor:g.floating_factor,water_lin_damp:g.water_lin_damp,water_rot_damp:g.water_rot_damp,synchronize_position:g.synchronize_position};
if(g=a.b4w_floating_settings)b.floating_settings={name:g.name,part:g.part,floating_factor:g.floating_factor,water_lin_damp:g.water_lin_damp,water_rot_damp:g.water_rot_damp,synchronize_position:g.synchronize_position};if(g=a.b4w_character_settings)b.character_settings={walk_speed:g.walk_speed,run_speed:g.run_speed,step_height:g.step_height,jump_strength:g.jump_strength,waterline:g.waterline};for(g=0;g<a.constraints.length;g++){var e=a.constraints[g];"RIGID_BODY_JOINT"==e.type&&b.physics_constraints.push({target:e.target._object,
pivot_type:e.pivot_type,pivot_x:e.pivot_x,pivot_y:e.pivot_y,pivot_z:e.pivot_z,axis_x:e.axis_x,axis_y:e.axis_y,axis_z:e.axis_z,use_limit_x:e.use_limit_x,use_limit_y:e.use_limit_y,use_limit_z:e.use_limit_z,use_angular_limit_x:e.use_angular_limit_x,use_angular_limit_y:e.use_angular_limit_y,use_angular_limit_z:e.use_angular_limit_z,limit_max_x:e.limit_max_x,limit_max_y:e.limit_max_y,limit_max_z:e.limit_max_z,limit_min_x:e.limit_min_x,limit_min_y:e.limit_min_y,limit_min_z:e.limit_min_z,limit_angle_max_x:e.limit_angle_max_x,
limit_angle_max_y:e.limit_angle_max_y,limit_angle_max_z:e.limit_angle_max_z,limit_angle_min_x:e.limit_angle_min_x,limit_angle_min_y:e.limit_angle_min_y,limit_angle_min_z:e.limit_angle_min_z})}g=b.render=d.create_render("MESH"===b.type?b.is_dynamic?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent._object,"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.parent_bone=a.parent_bone),a.pinverse_tsr&&(b.pinverse_tsr=F.create(),F.copy(a.pinverse_tsr,b.pinverse_tsr))):a.dg_parent&&(b.parent=a.dg_parent._object,
b.parent_is_dupli=!0);var e=a.location,f=a.scale[0];U.quat_bpy_b4w(a.rotation_quaternion,ra);ba.set_translation(b,e);ba.set_rotation(b,ra);ba.set_scale(b,f);b.use_default_animation=a.b4w_use_default_animation;b.anim_behavior_def=k.anim_behavior_bpy_b4w(a.b4w_anim_behavior);a.b4w_object_tags&&(b.metatags={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});a.b4w_viewport_alignment&&(b.viewport_alignment={alignment:a.b4w_viewport_alignment.alignment,
distance:a.b4w_viewport_alignment.distance});switch(a.type){case "ARMATURE":T.update_object(a,b);e=g.bone_pointers;f=k.calc_pose_data(e);a.b4w_animation_mixing?(g.quats_before=new Float32Array(f.quats),g.quats_after=new Float32Array(f.quats),g.trans_before=new Float32Array(f.trans),g.trans_after=new Float32Array(f.trans)):(g.quats_before=f.quats,g.quats_after=f.quats,g.trans_before=f.trans,g.trans_after=f.trans);for(var h in e){var t=e[h];1==t.chain.length&&T.update_bone_tsr_r(t,!0,f.trans,f.quats)}g.pose_data=
f;g.frame_factor=0;g.anim_mixing=a.b4w_animation_mixing;break;case "MESH":g.do_not_render=a.b4w_do_not_render;g.bb_original=m.bb_bpy_to_b4w(a.data.b4w_boundings.bb);g.selectable=Z.outlining_overview_mode||a.b4w_selectable;g.origin_selectable=a.b4w_selectable;g.outlining=Z.outlining_overview_mode||a.b4w_outlining;g.origin_outlining=a.b4w_outlining;g.outline_on_select=Z.outlining_overview_mode||a.b4w_outline_on_select;g.billboard=a.b4w_billboard;g.billboard_pres_glob_orientation=a.b4w_pres_glob_orientation;
g.billboard_type="BASIC";g.billboard_spherical="SPHERICAL"==a.b4w_billboard_geometry;h=g.outline_anim_settings_default;h.outline_duration=a.b4w_outline_settings.outline_duration;h.outline_period=a.b4w_outline_settings.outline_period;h.outline_relapses=a.b4w_outline_settings.outline_relapses;g.selectable&&(g.color_id=U.gen_color_id(I),I++);for(h=0;h<a.data.b4w_vertex_anim.length;h++)e=a.data.b4w_vertex_anim[h],b.vertex_anim.push({name:e.name,frame_start:e.frame_start,frame_end:e.frame_end,averaging:e.averaging,
averaging_interval:e.averaging_interval,allow_nla:e.allow_nla});b.render.vertex_anim=b.vertex_anim.length?!0:!1;"MESH"!=a.type&&U.panic("Wrong object type: "+a.name);h=b.render;if(a.data.b4w_shape_keys.length)for(h.use_shape_keys=!0,e=0;e<a.data.b4w_shape_keys.length;e++)f={},f.value=a.data.b4w_shape_keys[e].value,f.name=a.data.b4w_shape_keys[e].name,h.shape_keys_values.push(f);else h.use_shape_keys=!1;g.shadow_cast=a.b4w_shadow_cast;g.shadow_receive=a.b4w_shadow_receive;g.shadow_cast_only=a.b4w_shadow_cast_only&&
g.shadow_cast;g.reflexible=a.b4w_reflexible;g.reflexible_only=a.b4w_reflexible_only&&g.reflexible;g.reflective=a.b4w_reflective;g.reflection_type=a.b4w_reflection_type;g.caustics=a.b4w_caustics;if(g.wind_bending=a.b4w_wind_bending)g.wind_bending_angle=a.b4w_wind_bending_angle,h=m.wb_angle_to_amp(a.b4w_wind_bending_angle,g.bb_original,a.scale[0]),g.wind_bending_amp=h,g.wind_bending_freq=a.b4w_wind_bending_freq,g.detail_bending_freq=a.b4w_detail_bending_freq,g.detail_bending_amp=a.b4w_detail_bending_amp,
g.branch_bending_amp=a.b4w_branch_bending_amp,g.main_bend_col=a.b4w_main_bend_stiffness_col,h=a.b4w_detail_bend_colors,g.detail_bend_col={},g.detail_bend_col.leaves_stiffness=h.leaves_stiffness_col,g.detail_bend_col.leaves_phase=h.leaves_phase_col,g.detail_bend_col.overall_stiffness=h.overall_stiffness_col;g.hide=a.b4w_hidden_on_load;g.do_not_cull=a.b4w_do_not_cull;g.disable_fogging=a.b4w_disable_fogging;g.dynamic_geometry=a.b4w_dynamic_geometry;"MESH"!==a.type&&U.panic("Wrong object");h=a.data.materials[0];
g.friction=h.physics.friction;g.elasticity=h.physics.elasticity;g.lod_dist_min=0;g.lod_dist_max=d.LOD_DIST_MAX_INFINITY;g.lod_transition_ratio=a.b4w_lod_transition;g.last_lod=!0;break;case "LINE":g.do_not_cull=!0;g.bb_local=A.create_bb();g.be_local=A.create_be();g.bb_world=A.create_bb();g.be_world=A.create_be();break;case "CAMERA":E.camera_object_to_camera(a,b);E.assign_boundings(b);break;case "LAMP":y.lamp_to_light(a,b);break;case "SPEAKER":b.sfx=G.create_sfx();g=!1;for(h=0;h<b.scenes_data.length;h++)if(b.scenes_data[h].scene._sfx){g=
!0;break}g&&G.update_object(a,b);break;case "EMPTY":h=A.create_bb(),g.bb_local=h,h=A.create_bs(),g.bs_local=h,a.field&&(b.field={type:a.field.type,strength:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,detect_visibility:a.b4w_anchor.detect_visibility,element_id:a.b4w_anchor.element_id,max_width:a.b4w_anchor.max_width})}c(b)};a.update_world=function(a,b){b.uuid=a.uuid;b.bpy_origin=!0;n(a,b);a._is_dynamic=b.is_dynamic=q(a,b);a._is_updated=!0;b.render=d.create_render(b.type);b.use_default_animation=
a.b4w_use_default_animation;b.anim_behavior_def=k.anim_behavior_bpy_b4w(a.b4w_anim_behavior);c(b)};a.update_object_relations=function(a,b){var e=b.render;if(b.parent){!b.parent_is_dupli&&b.physics_settings.use_collision_compound&&b.parent.physics_settings.use_collision_compound&&(b.use_obj_physics=!1);for(var m=!1,h=0;h<b.scenes_data.length;h++)if(b.scenes_data[h].scene._physics){m=!0;break}if(h=m)h=b.physics_settings,h=b.is_vehicle||b.is_floating||C.is_character(b)||b.use_obj_physics&&!h.use_ghost&&
0<h.mass&&("DYNAMIC"==h.physics_type||"RIGID_BODY"==h.physics_type);if(h)h=b.parent_is_dupli?F.copy(e.world_tsr,F.create()):e.world_tsr,F.multiply(b.parent.render.world_tsr,h,e.world_tsr),ba.set_translation(b,F.get_trans_view(e.world_tsr)),ba.set_scale(b,F.get_scale(e.world_tsr)),ba.set_rotation(b,F.get_quat_view(e.world_tsr));else if(b.parent_is_dupli||!b.parent_bone)if(h=F.copy(e.world_tsr,F.create()),b.viewport_alignment&&"CAMERA"==b.parent.type){h={distance:b.viewport_alignment.distance,rotation:F.get_quat_view(h)};
switch(b.viewport_alignment.alignment){case "TOP_LEFT":h.top=0;h.left=0;break;case "TOP":h.top=0;h.left=.5;break;case "TOP_RIGHT":h.top=0;h.right=0;break;case "LEFT":h.top=.5;h.left=0;break;case "CENTER":h.top=.5;h.left=.5;break;case "RIGHT":h.top=.5;h.right=0;break;case "BOTTOM_LEFT":h.bottom=0;h.left=0;break;case "BOTTOM":h.bottom=0;h.left=.5;break;case "BOTTOM_RIGHT":h.bottom=0,h.right=0}v.append_stiff_viewport(b,b.parent,h)}else v.append_child_of(b,b.parent,h);else h=F.copy(e.world_tsr,F.create()),
v.append_child_of_bone(b,b.parent,b.parent_bone,h)}if("ARMATURE"==b.type)for(m=a.pose.bones,h=0;h<m.length;h++){var t=m[h],l=t.constraints;if(l)for(var n=0;n<l.length;n++){var p=l[n];"COPY_TRANSFORMS"!=p.type||p.subtarget||p.mute||v.append_stiff_bone_to_obj(b,p.target._object,t.name,U.VEC3_IDENT,U.QUAT4_IDENT,1)}}if("MESH"==b.type)var I=k.get_bpy_armobj(a);if(I){l=I._object;h=l.render.pose_data;m=b.render;t=a.data;b.armobj=l;t=t.vertex_groups;if(t.length){var l=l.render.bone_pointers,n=0,p={},x;for(x in l){var B=
U.keysearch("name",x,t);B&&(p[x]={vgroup_index:B.index,bone_index:l[x].bone_index,deform_bone_index:n++})}m.bone_skinning_info=p;x=n;t=k.get_max_bones();m.max_bones=x;x>2*t?(m.is_skinning=!1,M.error('too many bones for "'+a.name+'" / '+m.max_bones+" bones (max "+t+" with blending, "+2*t+" without blending). Skinning will be disabled.")):m.is_skinning=!0}x=k.extract_skinned_pose_data(h.trans,h.quats,e.bone_skinning_info);I.b4w_animation_mixing?(e.quats_before=new Float32Array(x.quats),e.quats_after=
new Float32Array(x.quats),e.trans_before=new Float32Array(x.trans),e.trans_after=new Float32Array(x.trans)):(e.quats_before=x.quats,e.quats_after=x.quats,e.trans_before=x.trans,e.trans_after=x.trans);e.arm_rel_trans=new Float32Array(4);e.arm_rel_quat=g.create();e.pose_data=x;e.frame_factor=0}if(e.reflective)if(e=b.render,"CUBE"==e.reflection_type)e.cube_reflection_id=ma++;else if("PLANE"==e.reflection_type){a:{I=a.constraints;for(x=0;x<I.length;x++)if(h=I[x],"LOCKED_TRACK"==h.type&&"REFLECTION PLANE"==
h.name){if(h.target._object){I=h.target._object;break a}M.warn('Reflection plane target "'+h.target.name+'" for object: "'+b.name+"\" is not present on the scene. Using object's Z-axis.")}I=null}I||(I=U.unique_name("%reflection%"),I=d.create_object(I,"EMPTY"),x=d.create_render("EMPTY"),I.render=x,f(b,I),v.append_stiff_obj(I,b,[0,0,0],null,1),c(I));x=null;for(h=0;h<da.length;h++)if(da[h]==I){x=h;break}null==x&&(x=da.length,da.push(I));I.render.plane_reflection_id=x;e.plane_reflection_id=x;I.reflective_objs.push(b)}};
a.update_force=b;a.copy_scene_data=f;a.check_bpy_obj_scene_compatibility=l;a.update_objects_dynamics=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.render||"DYNAMIC"!=c.render.type&&"CAMERA"!=c.render.type||ba.update_transform(c);c.use_default_animation&&k.obj_is_animatable(c)&&(k.apply_def(c),c.anim_slots.length&&k.play(c,null,k.SLOT_ALL))}};a.get_meta_tags=function(a){return U.clone_object_r(a.metatags)};a.cleanup=function(){ma=I=0;da.length=0;fa.length=0;N={ALL:[]}};a.copy=function(a,b,
g){var k=b,e=d.get_dg_parent(a);b=e?d.gen_dupli_name(e.name,b):b;if(B(b,N.ALL,!1,-1)){for(var e=1,h;;){h="."+(3>String(e).length?("000"+String(e)).slice(-3):String(e));if(!B(b+h,N.ALL,!1,-1))break;e++}M.error('Object "'+b+'" already exists. Name was replaced by "'+b+h+'".');k+=h;b+=h}k=d.create_object(b,a.type,k);k.bpy_origin=a.bpy_origin;k.is_dynamic=a.is_dynamic;k.is_hair_dupli=a.is_hair_dupli;k.use_default_animation=a.use_default_animation;k.def_action_slots=a.def_action_slots;k.render=d.clone_render(a.render);
k.metatags=d.copy_object_props_by_value(a.metatags);f(a,k);k.action_anim_cache=d.copy_bpy_object_props_by_link(a.action_anim_cache);k.parent=d.copy_bpy_object_props_by_link(a.parent);k.parent_is_dupli=a.parent_is_dupli;k.parent_bone=a.parent_bone;k.vertex_anim=d.copy_bpy_object_props_by_link(a.vertex_anim);k.anim_behavior_def=a.anim_behavior_def;!a.physics||a.is_vehicle||a.is_character||a.is_floating||(k.use_obj_physics=a.use_obj_physics,k.physics=null);k.collision_id=a.collision_id;k.correct_bounding_offset=
a.correct_bounding_offset;k.physics_settings=d.copy_object_props_by_value(a.physics_settings);b=[];for(e=0;e<a.scenes_data.length;e++){var t=k.scenes_data[e];h=a.scenes_data[e].batches;if(g){for(var t=t.batches,l=0;l<h.length;l++)if(!h[l].forked_batch){var n=d.copy_object_props_by_value(h[l]);n.bufs_data=z.clone_bufs_data(h[l].bufs_data);t.push(n);b.push(h[l].bufs_data)}for(l=0;l<h.length;l++)if(h[l].forked_batch){n=d.copy_object_props_by_value(h[l]);t.push(n);for(var p=0;p<b.length;p++)b[p]==h[l].bufs_data&&
(n.bufs_data=t[p].bufs_data)}for(l=0;l<t.length;l++)t[l].bufs_data&&z.update_gl_buffers(t[l].bufs_data),Y.allow_vao_ext&&ha.assign_vao(t[l]),t[l].odd_id_prop=k.uuid,m.update_batch_id(t[l],m.calculate_render_id(k.render));L.share_batch_canvas_textures(t)}else t.batches=h}g||(k.render.use_batches_boundings=!1);d.scene_data_set_active(k,!1);c(k);k.render.is_copied=!0;k.render.is_copied_deep=g;k.render.color_id=U.gen_color_id(I);I++;return k};a.update_boundings=function(a){for(var b=a.render,c=a.scenes_data[0].batches,
d,g,k,e,f,h,t,l,n,p,I,B,v=[],H=0;H<c.length;H++){var q=c[H];if("MAIN"==q.type){var w=z.get_vbo_type_by_attr_name("a_position"),w=z.get_vbo_source_by_type(q.bufs_data.vbo_source_data,w),y=q.bufs_data.pointers.a_position.offset;d=e=w[y];g=f=w[y+1];k=h=w[y+2]}}for(H=0;H<c.length;H++)if(q=c[H],q.bufs_data&&q.be_world&&q.bb_world){var w=z.get_vbo_type_by_attr_name("a_position"),w=z.get_vbo_source_by_type(q.bufs_data.vbo_source_data,w),y=q.bufs_data.pointers.a_position.offset,ia=q.bufs_data.pointers.a_position.length+
y;t=p=w[y];l=I=w[y+1];n=B=w[y+2];for(var M=y;M<ia;M+=3){var y=w[M],C=w[M+1],E=w[M+2];t=Math.max(y,t);l=Math.max(C,l);n=Math.max(E,n);p=Math.min(y,p);I=Math.min(C,I);B=Math.min(E,B)}q.bb_local.max_x=t.toFixed(3);q.bb_local.max_y=l.toFixed(3);q.bb_local.max_z=n.toFixed(3);q.bb_local.min_x=p.toFixed(3);q.bb_local.min_y=I.toFixed(3);q.bb_local.min_z=B.toFixed(3);A.bounding_box_transform(q.bb_local,b.world_tsr,q.bb_world);A.extract_bb_corners(q.bb_world,ca);for(w=v.length=0;w<ca.length;w++)v.push(ca[w]);
q.be_world=A.create_be_by_bb(v,!0);q.be_local=A.calc_be_local_by_tsr(q.be_world,b.world_tsr);q.bs_local=A.create_bs_by_be(q.be_local);q.bs_world=A.create_bs_by_be(q.be_world);q.use_be=A.is_be_optimized(q.be_local,q.bs_local);"MAIN"==q.type&&(d=Math.max(t,d),g=Math.max(l,g),k=Math.max(n,k),e=Math.min(p,e),f=Math.min(I,f),h=Math.min(B,h))}v={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(g.toFixed(3)),max_z:parseFloat(k.toFixed(3)),min_x:parseFloat(e.toFixed(3)),min_y:parseFloat(f.toFixed(3)),min_z:parseFloat(h.toFixed(3))};
p=d-e;l=g-f;t=k-h;e=.5*(d+e);n=.5*(g+f);I=.5*(k+h);var D=e,P=I;f=Math.max(p,Math.max(l,t))/2;h=Math.max(p,t)/2;var la=[e/(p?p:1),n/(l?l:1),I/(t?t:1)];B=.5;if(b.billboard)y=Math.max(Math.abs(v.max_x),Math.abs(v.min_x)),C=Math.max(Math.abs(v.max_y),Math.abs(v.min_y)),E=Math.max(Math.abs(v.max_z),Math.abs(v.min_z)),k=Math.sqrt(y*y+C*C+E*E),H=Math.sqrt(y*y+C*C),v.max_x=v.max_y=v.max_z=k,v.min_x=v.min_y=v.min_z=-k,h=H,f=k,y=new Float32Array([0,0,0]),d=new Float32Array([f,f,f]),k=new Float32Array([0,0,
0]);else{for(H=0;H<c.length;H++)if(q=c[H],"MAIN"==q.type)for(w=z.get_vbo_type_by_attr_name("a_position"),w=z.get_vbo_source_by_type(q.bufs_data.vbo_source_data,w),ia=c[H].bufs_data.pointers,y=ia.a_position.offset,ia=ia.a_position.length+y,M=y;M<ia;M+=3){var y=w[M],C=w[M+1],E=w[M+2],Ba=Math.sqrt((e-y)*(e-y)+(n-C)*(n-C)+(I-E)*(I-E));if(Ba>f){var q=e-f*(y-e)/Ba,Ma=n-f*(C-n)/Ba,Ba=I-f*(E-I)/Ba;e=(q+y)/2;n=(Ma+C)/2;I=(Ba+E)/2;f=Math.sqrt((e-y)*(e-y)+(n-C)*(n-C)+(I-E)*(I-E))}Ma=Math.sqrt((D-y)*(D-y)+(P-
E)*(P-E));Ma>h&&(q=D-h*(y-D)/Ma,Ba=P-h*(E-P)/Ma,D=(q+y)/2,P=(Ba+E)/2,h=Math.sqrt((D-y)*(D-y)+(P-E)*(P-E)));y/=p?p:1;C/=l?l:1;E/=t?t:1;Ba=Math.sqrt((la[0]-y)*(la[0]-y)+(la[1]-C)*(la[1]-C)+(la[2]-E)*(la[2]-E));Ba>B&&(q=la[0]-B*(y-la[0])/Ba,Ma=la[1]-B*(C-la[1])/Ba,Ba=la[2]-B*(E-la[2])/Ba,la[0]=(q+y)/2,la[1]=(Ma+C)/2,la[2]=(Ba+E)/2,B=Math.sqrt((la[0]-y)*(la[0]-y)+(la[1]-C)*(la[1]-C)+(la[2]-E)*(la[2]-E)))}H=p?p*la[0]:d;g=l?l*la[1]:g;k=t?t*la[2]:k;d=B*p;w=B*l;ia=B*t;y=new Float32Array([e,n,I]);d=new Float32Array([d,
w,ia]);k=new Float32Array([H,g,k]);h=parseFloat(h.toFixed(3))}b.bb_local=v;m.set_local_cylinder_capsule(b,h,h,v);v=A.bs_from_values(f,y);b.bs_local=v;v=A.be_from_values([d[0],0,0],[0,d[1],0],[0,0,d[2]],k);b.be_local=v;ba.update_transform(a);if(Y.debug_view)for(H=0;H<c.length;H++)if("DEBUG_VIEW"===c[H].type&&c[H].debug_sphere){a=x.generate_uv_sphere(16,8,1,v.center,!1,!1);z.scale_submesh_xyz(a,[v.axis_x[0],v.axis_y[1],v.axis_z[2]],v.center);z.submesh_drop_indices(a,1,!0);a.va_common.a_polyindex=z.extract_polyindices(a);
m.update_batch_geometry(c[H],a);break}};a.get_scene_objs=p;a.get_scene_objs_derived=function(a,b,c){b=N[b]||[];for(var d=[],g=0;g<b.length;g++){var k=b[g];if((k.render.data_id==c||-1==c)&&k.bpy_origin)for(var e=k.scenes_data,m=0;m<e.length;m++)e[m].scene==a&&d.push(k)}return d};a.get_all_objects=function(a){var b=N.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var g=b[d];g.render.data_id==a&&c.push(g)}return c};a.get_first_character=function(a){for(var b=N.MESH,c=0;c<b.length;c++){var d=
b[c];if(C.is_character(d))for(var g=d.scenes_data,k=0;k<g.length;k++)if(g[k].scene==a)return d}return null};a.sort_lamps=function(a){var b=p(a,"LAMP",-1);if(b.length==a._render.num_lamps_added){for(var c=[],g=0;g<b.length;g++){var k=b[g],k=d.get_scene_data(k,a);c[k.light_index]=g}for(g=0;g<c.length-1;g++)for(k=g+1;k<c.length;k++){var e;e=b[c[g]].light;var m=b[c[k]].light;e=!m.use_diffuse||!m.use_specular||e.use_diffuse&&e.use_specular?!e.use_diffuse&&(m.use_diffuse||!e.use_specular&&m.use_specular)?
!0:!1:!0;e&&(e=c[g],c[g]=c[k],c[k]=e)}for(g=0;g<c.length;g++)k=b[c[g]],d.get_scene_data(k,a).light_index=g,H.update_lamp_scene(b[c[g]],a)}};a.obj_switch_cleanup_flags=function(a,b,c,d,g){for(var k=0;k<a.scenes_data.length;k++)for(var e=a.scenes_data[k].batches,m=0;m<e.length;m++){for(var f=e[m],h=0;h<f.textures.length;h++)f.textures[h].cleanup_gl_data_on_unload=b;f.bufs_data.cleanup_gl_data_on_unload=c;f.cleanup_gl_data_on_unload=c;f.shader.cleanup_gl_data_on_unload=d;""!==f.ngraph_proxy_id&&(f=K.get_ngraph_proxy_cached(f.ngraph_proxy_id))&&
(f.cleanup_on_unload=g)}};a.get_selectable_objects=function(){for(var a=[],b=N.MESH,c=0;c<b.length;c++){var d=b[c];d.render.selectable&&d.bpy_origin&&a.push(d)}return a};a.get_outlining_objects=function(){for(var a=[],b=N.MESH,c=0;c<b.length;c++){var d=b[c];d.render.outlining&&d.bpy_origin&&a.push(d)}return a};a.get_object=function(b,c,g,k){var e=null,m=N.ALL;switch(b){case a.GET_OBJECT_BY_NAME:e=B(c,m,!0,g);break;case a.GET_OBJECT_BY_DUPLI_NAME:a:{for(b=0;b<m.length;b++)if(e=m[b],e.origin_name==
g&&(e.render.data_id==k||-1==k)){var f=d.get_dg_parent(e);if(f&&f.origin_name==c)break a}e=null}break;case a.GET_OBJECT_BY_DUPLI_NAME_LIST:a:{for(k=0;k<m.length;k++){b=m[k];for(var e=c.length-1,f=b,h=!0;0<=e&&h;)h=f&&f.origin_name==c[e]&&(f.render.data_id==g||-1==g),f&&(f=d.get_dg_parent(f)),e--;if(h&&!f){e=b;break a}}e=null}}return e};a.get_world_by_name=function(a,b){return B("%meta_world%"+a,N.WORLD,!0,b)};a.pick_object=function(b,c){var d=H.get_main();if(!d)return M.error("No active scene"),null;
var g=W.pick_anchor(b,c);if(g)return g;g=H.pick_color(d,b,c);if(!g)return null;for(var d=p(d,"MESH",-1),k=0;k<d.length;k++){var e=d[k].render,m=e.color_id;if(m&&3>Math.abs(255*m[0]-g[0])&&3>Math.abs(255*m[1]-g[1])&&3>Math.abs(255*m[2]-g[2]))return e.outlining&&e.outline_on_select&&(Z.outlining_overview_mode?a.apply_outline_anim(d[k],Z.outline_duration,Z.outline_period,Z.outline_relapses):(g=e.outline_anim_settings_default,a.apply_outline_anim(d[k],g.outline_duration,g.outline_period,g.outline_relapses))),
d[k]}return null};a.set_wind_params=function(a,c){for(var d=p(a,"EMPTY",-1),g=0;g<d.length;g++){var k=d[g];if(k.field&&"WIND"===k.field.type){var e=k;break}}if(!e)return M.error("There is no wind on the scene"),0;"number"==typeof c.wind_dir&&(d=U.deg_to_rad(c.wind_dir),Q.set(Math.sin(d),-Math.cos(d),0,Aa),U.dir_to_quat(Aa,U.AXIS_Z,ra),ba.set_rotation(e,ra));"number"==typeof c.wind_strength&&(e.field.strength=c.wind_strength);b(e)};a.remove_object=function(a){v.check_constraint(a)&&v.remove(a);var b=
N.ALL,c=N[a.type],d=b.indexOf(a);a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)};a.objects_storage_add=c;a.objects_storage_check=function(a){return N[a.type]&&-1<N[a.type].indexOf(a)}};b4w.module.__obj_util=function(a,r){function u(a){a={type:a,id:0,data_id:0,world_tsr:e.create_ext(),world_tsr_inv:e.create_ext(),pivot:new Float32Array(3),hover_pivot:new Float32Array(3),init_dist:0,init_top:0,is_copied:!1,is_copied_deep:!1,color_id:null,outline_intensity:0,target_cam_upside_down:!1,vertical_axis:p.create(),use_panning:!1,move_style:0,velocity_trans:1,velocity_rot:1,velocity_zoom:1,dof_distance:0,dof_front_start:0,dof_front_end:0,dof_rear_start:0,dof_rear_end:0,dof_power:0,dof_bokeh_intensity:0,
dof_bokeh:!1,dof_foreground_blur:!1,dof_object:null,underwater:!1,horizontal_limits:null,vertical_limits:null,distance_limits:null,hover_vert_trans_limits:null,hover_horiz_trans_limits:null,pivot_limits:null,enable_hover_hor_rotation:!0,outline_anim_settings_default:{outline_duration:1,outline_period:1,outline_relapses:0},cube_reflection_id:-1,plane_reflection_id:-1,reflection_plane:new Float32Array(4),friction:0,elasticity:0,lod_dist_max:-1,lod_dist_min:0,lod_transition_ratio:0,do_not_render:!1,
shadow_cast:!1,shadow_receive:!1,shadow_cast_only:!1,reflexible:!1,reflexible_only:!1,reflective:!1,reflection_type:"",caustics:!1,wind_bending:!1,disable_fogging:!1,dynamic_geometry:!1,dynamic_grass:!1,do_not_cull:!1,hide:!1,last_lod:!1,selectable:!1,origin_selectable:!1,outlining:!1,origin_outlining:!1,outline_on_select:!1,is_hair_particles:!1,is_visible:!1,force_zsort:!1,wind_bending_angle:0,wind_bending_amp:0,wind_bending_freq:0,detail_bending_freq:0,detail_bending_amp:0,branch_bending_amp:0,
main_bend_col:"",detail_bend_col:null,bend_center_only:!1,billboard:!1,billboard_pres_glob_orientation:!1,billboard_type:"",billboard_spherical:!1,frame_factor:0,time:0,va_frame:0,va_frame_factor:0,max_bones:0,frames_blending:!1,vertex_anim:!1,use_shape_keys:!1,shape_keys_values:[],is_skinning:!1,anim_mixing:!1,anim_mix_factor:1,anim_mix_factor_change_speed:0,anim_destination_mix_factor:1,two_last_skeletal_slots:new Int8Array([-1,-1]),skinned_renders:[],mesh_to_arm_bone_maps:[],skinning_data_cache:[],
quats_before:null,quats_after:null,trans_before:null,trans_after:null,bone_pointers:null,bone_skinning_info:null,pose_data:null,arm_rel_trans:null,arm_rel_quat:null,bb_original:null,bb_local:l.create_bb(),bb_world:l.create_bb(),bs_local:l.create_bs(),bs_world:l.create_bs(),be_local:l.create_be(),be_world:l.create_be(),bbr_local:l.create_rot_bb(),bbr_world:l.create_rot_bb(),bcyl_local:null,bcap_local:null,bcon_local:null,use_batches_boundings:!0,use_be:!1};p.copy(n.AXIS_Z,a.vertical_axis);return a}
function h(a){if(!(a instanceof Object))return a;var b=null,c=null,e=null,f=null,l=null;a.textures&&(b=a.textures,a.textures=null);a.texture_names&&(c=a.texture_names,a.texture_names=null);a.shape_keys&&(e=a.shape_keys,a.shape_keys=null);a.shader&&(f=a.shader,a.shader=null);a.vaos&&(l=a.vaos,a.vaos=null);var p;p=a.constructor;switch(p){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:p=new p(a);break;case Array:p=
new p(a.length);for(var B=0;B<a.length;B++)p[B]=h(a[B]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:p=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:p=null;break;case Function:p=a;break;default:for(B in p=new p,a)p[B]=h(a[B])}b&&(p.textures=b,a.textures=b);c&&(p.texture_names=c,a.texture_names=c);e&&(p.shape_keys=e,a.shape_keys=e);f&&(p.shader=f,a.shader=f);l&&(p.vaos=n.create_non_smi_array(),a.vaos=l);return p}function b(a,b){for(var c=a.scenes_data,e=0;e<
c.length;e++){var f=c[e];if(f.scene==b)return f}return null}function f(a){return a.parent_is_dupli?a.parent:a.parent?f(a.parent):null}var l=r("__boundings"),q=r("__config"),e=r("__tsr"),n=r("__util"),p=r("__vec3"),B=r("__vec4"),c=q.defaults;new Float32Array(4);new Float32Array(4);new Float32Array(4);e.create();e.create();a.LOD_DIST_MAX_INFINITY=-1;a.create_render=u;a.clone_render=function(a){var b=u(a.type);b.id=a.id;b.data_id=a.data_id;e.copy(a.world_tsr,b.world_tsr);e.copy(a.world_tsr_inv,b.world_tsr_inv);
p.copy(a.pivot,b.pivot);p.copy(a.hover_pivot,b.hover_pivot);b.init_dist=a.init_dist;b.init_top=a.init_top;b.is_copied=a.is_copied;b.is_copied_deep=a.is_copied_deep;a.color_id&&(b.color_id=p.clone(a.color_id));b.outline_intensity=a.outline_intensity;b.target_cam_upside_down=a.target_cam_upside_down;p.copy(a.vertical_axis,b.vertical_axis);b.use_panning=a.use_panning;b.move_style=a.move_style;b.velocity_trans=a.velocity_trans;b.velocity_rot=a.velocity_rot;b.velocity_zoom=a.velocity_zoom;b.dof_distance=
a.dof_distance;b.dof_front_start=a.dof_front_start;b.dof_front_end=a.dof_front_end;b.dof_rear_start=a.dof_rear_start;b.dof_rear_end=a.dof_rear_end;b.dof_power=a.dof_power;b.dof_bokeh_intensity=a.dof_bokeh_intensity;b.dof_bokeh=a.dof_bokeh;b.dof_foreground_blur=a.dof_foreground_blur;b.dof_object=a.dof_object;b.horizontal_limits=n.clone_object_r(a.horizontal_limits);b.vertical_limits=n.clone_object_r(a.vertical_limits);b.distance_limits=n.clone_object_r(a.distance_limits);b.hover_vert_trans_limits=
n.clone_object_r(a.hover_vert_trans_limits);b.hover_horiz_trans_limits=n.clone_object_r(a.hover_horiz_trans_limits);b.pivot_limits=a.pivot_limits;b.enable_hover_hor_rotation=a.enable_hover_hor_rotation;b.outline_anim_settings_default.outline_duration=a.outline_anim_settings_default.outline_duration;b.outline_anim_settings_default.outline_period=a.outline_anim_settings_default.outline_period;b.outline_anim_settings_default.outline_relapses=a.outline_anim_settings_default.outline_relapses;b.cube_reflection_id=
a.cube_reflection_id;b.plane_reflection_id=a.plane_reflection_id;b.reflection_plane=a.reflection_plane;b.friction=a.friction;b.elasticity=a.elasticity;b.lod_dist_max=a.lod_dist_max;b.lod_dist_min=a.lod_dist_min;b.lod_transition_ratio=a.lod_transition_ratio;b.do_not_render=a.do_not_render;b.shadow_cast=a.shadow_cast;b.shadow_receive=a.shadow_receive;b.shadow_cast_only=a.shadow_cast_only;b.reflexible=a.reflexible;b.reflexible_only=a.reflexible_only;b.reflective=a.reflective;b.reflection_type=a.reflection_type;
b.caustics=a.caustics;b.wind_bending=a.wind_bending;b.disable_fogging=a.disable_fogging;b.dynamic_geometry=a.dynamic_geometry;b.dynamic_grass=a.dynamic_grass;b.do_not_cull=a.do_not_cull;b.hide=a.hide;b.last_lod=a.last_lod;b.selectable=a.selectable;b.origin_selectable=a.origin_selectable;b.outlining=a.outlining;b.origin_outlining=a.origin_outlining;b.outline_on_select=a.outline_on_select;b.is_hair_particles=a.is_hair_particles;b.is_visible=a.is_visible;b.force_zsort=a.force_zsort;b.wind_bending_angle=
a.wind_bending_angle;b.wind_bending_amp=a.wind_bending_amp;b.wind_bending_freq=a.wind_bending_freq;b.detail_bending_freq=a.detail_bending_freq;b.detail_bending_amp=a.detail_bending_amp;b.branch_bending_amp=a.branch_bending_amp;b.main_bend_col=a.main_bend_col;b.detail_bend_col=a.detail_bend_col;b.bend_center_only=a.bend_center_only;b.billboard=a.billboard;b.billboard_pres_glob_orientation=a.billboard_pres_glob_orientation;b.billboard_type=a.billboard_type;b.billboard_spherical=a.billboard_spherical;
b.frame_factor=a.frame_factor;b.time=a.time;b.va_frame=a.va_frame;b.va_frame_factor=a.va_frame_factor;b.max_bones=a.max_bones;b.frames_blending=a.frames_blending;b.vertex_anim=a.vertex_anim;b.use_shape_keys=a.use_shape_keys;b.shape_keys_values=n.clone_object_r(a.shape_keys_values);b.is_skinning=a.is_skinning;b.anim_mixing=a.anim_mixing;b.anim_mix_factor=a.anim_mix_factor;b.anim_mix_factor_change_speed=a.anim_mix_factor_change_speed;b.anim_destination_mix_factor=a.anim_destination_mix_factor;b.two_last_skeletal_slots.set(a.two_last_skeletal_slots);
b.skinned_renders=n.clone_object_r(a.skinned_renders);b.mesh_to_arm_bone_maps=n.clone_object_r(a.mesh_to_arm_bone_maps);b.skinning_data_cache=n.clone_object_r(a.skinning_data_cache);b.quats_before=n.clone_object_r(a.quats_before);b.quats_after=n.clone_object_r(a.quats_after);b.trans_before=n.clone_object_r(a.trans_before);b.trans_after=n.clone_object_r(a.trans_after);b.bone_pointers=n.clone_object_r(a.bone_pointers);b.bone_skinning_info=n.clone_object_r(a.bone_skinning_info);b.pose_data=n.clone_object_r(a.pose_data);
b.arm_rel_trans=n.clone_object_r(a.arm_rel_trans);b.arm_rel_quat=n.clone_object_r(a.arm_rel_quat);b.bb_original=n.clone_object_r(a.bb_original);l.copy_bb(a.bb_local,b.bb_local);l.copy_bb(a.bb_world,b.bb_world);l.copy_bs(a.bs_local,b.bs_local);l.copy_bs(a.bs_world,b.bs_world);l.copy_be(a.be_local,b.be_local);l.copy_be(a.be_world,b.be_world);b.bcyl_local=n.clone_object_r(a.bcyl_local);b.bcap_local=n.clone_object_r(a.bcap_local);b.bcon_local=n.clone_object_r(a.bcon_local);b.use_batches_boundings=a.use_batches_boundings;
return b};a.create_object=function(a,b,c){c||(c=a);return{name:a,uuid:n.gen_uuid(),origin_name:c,type:b,bpy_origin:!1,is_dynamic:!1,is_hair_dupli:!1,use_default_animation:!1,render:null,constraint:null,sfx:null,light:null,armobj:null,anchor:null,field:null,metatags:null,scenes_data:[],vertex_anim:[],cons_descends:n.create_non_smi_array(),cons_armat_bone_descends:n.create_non_smi_array(),anim_slots:[],reflective_objs:[],nla_events:[],action_anim_cache:[],sensor_manifolds:null,sensor_manifolds_arr:[],
parent:null,parent_is_dupli:!1,parent_bone:"",viewport_alignment:null,pinverse_tsr:null,use_obj_physics:!1,collision_id:"",correct_bounding_offset:"AUTO",is_vehicle:!1,is_character:!1,is_floating:!1,bob_synchronize_pos:!1,physics:null,vehicle:null,floater:null,vehicle_settings:null,floating_settings:null,character_settings:null,physics_constraints:[],physics_settings:{physics_type:"NO_COLLISION",use_ghost:!1,use_sleep:!1,mass:0,velocity_min:0,velocity_max:0,damping:0,rotation_damping:0,lock_location_x:!1,
lock_location_y:!1,lock_location_z:!1,lock_rotation_x:!1,lock_rotation_y:!1,lock_rotation_z:!1,collision_margin:0,collision_group:0,collision_mask:0,use_collision_bounds:!1,collision_bounds_type:"BOX",use_collision_compound:!1},outline_animation:{time_start:0,outline_time:0,period:0,relapses:0},anim_behavior_def:0,def_action_slots:[],need_update_transform:!1,need_inv_zup_tsr:!1,meta_objects:[]}};a.copy_bpy_object_props_by_link=function(a){return a instanceof Array?a.slice():a};a.copy_batches_props_by_link_nr=
function(a){for(var b=[],c=0;c<a.length;c++){var e=a[c],f={},l;for(l in e)e[l]==e.bb_world?f.bb_world=h(e.bb_world):e[l]==e.be_world?f.be_world=h(e.be_world):f[l]=e[l];b.push(f)}return b};a.copy_object_props_by_value=h;a.is_dynamic=function(a){return a.is_dynamic};a.is_dynamic_mesh=function(a){return"MESH"==a.type&&a.is_dynamic};a.append_scene_data=function(a,b){a.scenes_data.push({scene:b,is_active:!1,batches:[],plane_refl_subs:[],cube_refl_subs:null,shadow_subscenes:[],light_index:0,obj_has_nla_on_scene:!1,
cameras:[],shadow_cameras:[]})};a.append_batch=function(a,c,e){b(a,c).batches.push(e)};a.remove_scene_data=function(a,b){for(var c=a.scenes_data,e=0;e<c.length;e++)if(c[e].scene==b){c.splice(e,1);break}};a.get_scene_data=b;a.update_refl_objects=function(a,b){for(var c=0;c<a.length;c++)B.copy(b,a[c].render.reflection_plane)};a.scene_data_set_active=function(a,b,c){for(var e=0;e<a.scenes_data.length;e++){var f=a.scenes_data[e];c&&f.scene!=c||(f.is_active=b)}};a.get_shadow_lamps=function(a,b){for(var e=
[],f=b?c.max_cast_lamps-1:c.max_cast_lamps,h=0;h<a.length;h++){var l=a[h];l.light.generate_shadows&&e.length<f&&e.push(l)}return e.length?e:a[0]?[a[0]]:[]};a.check_obj_soft_particles_accessibility=function(a,b){if(b.b4w_enable_soft_particles&&0<b.b4w_particles_softness){var c=b.material-1,e=a.data.materials;if(0<=c&&c<e.length&&("ADD"==e[c].game_settings.alpha_blend||"ALPHA"==e[c].game_settings.alpha_blend||"ALPHA_SORT"==e[c].game_settings.alpha_blend))return!0}return!1};a.check_inv_zup_tsr_is_needed=
function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,e=0;e<c.length;e++)for(var f=c[e].shaders_info.directives,h=0;h<f.length;h++){var l=f[h];if("USE_MODEL_MATRIX_INVERSE"==l[0]&&"1"==l[1])return!0}return!1};a.gen_dupli_name=function(a,b){return a+"*"+b};a.get_parent=function(a){return a.parent_is_dupli?null:a.parent};a.get_dg_parent=f;a.get_dg_objects=function(a,b){for(var c=[],e=0;e<b.length;e++){var h=b[e];f(h)==a&&c.push(h)}return c};a.get_object_data_id=function(a){return a.render.data_id};
a.is_mesh=function(a){return"MESH"===a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===a.type};a.is_line=function(a){return"LINE"===a.type};a.is_world=function(a){return"WORLD"===a.type}};b4w.module.__particles=function(a,r){function u(a,b,c,e,f,d){var h=a.delay_attrs,l=a.emitter_tsr_snapshots,p=a.time;a=a.prev_time;for(var x=0;x<h.length;x+=4){var g=h[x];if(p>a&&p>=g&&g>a||p<a&&(g>a||p>=g))for(g=0;8>g;g++)l[8*x+g]=e[g],m[g]=e[g];else for(g=0;8>g;g++)m[g]=l[8*x+g];g=A;g[0]=b[3*x];g[1]=b[3*x+1];g[2]=b[3*x+2];n.transform_vec3(g,m,g);f[3*x]=g[0];f[3*x+1]=g[1];f[3*x+2]=g[2];var B=k;B[0]=c[4*x];B[1]=c[4*x+1];B[2]=c[4*x+2];B[3]=c[4*x+3];n.transform_quat(B,m,B);d[4*x]=B[0];d[4*x+1]=B[1];
d[4*x+2]=B[2];d[4*x+3]=B[3];for(g=1;4>g;g++)f[3*(x+g)]=f[3*x],f[3*(x+g)+1]=f[3*x+1],f[3*(x+g)+2]=f[3*x+2],d[4*(x+g)]=B[0],d[4*(x+g)+1]=B[1],d[4*(x+g)+2]=B[2],d[4*(x+g)+3]=B[3]}}function h(a){a?(p.srand(a),w=function(){return p.rand()}):w=function(){return Math.random()}}var b=r("__config"),f=r("__batch"),l=r("__geometry"),q=r("__textures"),e=r("__time"),n=r("__tsr"),p=r("__util"),B=r("__vec3"),c=b.defaults,k=new Float32Array(4),m=new Float32Array(8),A=new Float32Array(3),E=[],w=function(){p.panic("_rand() undefined")};
a.update=function(){for(var a=0;a<E.length;a++)for(var b=E[a],c=b.scenes_data,k=0;k<c.length;k++)for(var e=b,d=c[k].batches,f=0;f<d.length;f++){var h=d[f],m=h.particles_data;m&&m.use_world_space&&!h.forked_batch&&(u(m,m.positions,m.tbn_quats,e.render.world_tsr,m.positions_cache,m.tbn_quats_cache),m.need_buffers_update=!0)}};a.obj_has_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,k=0;k<c.length;k++)if(c[k].particles_data)return!0;return!1};a.obj_has_anim_particles=
function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,k=0;k<c.length;k++){var e=c[k].particles_data;if(e&&"EMITTER"==e.p_type)return!0}return!1};a.bpy_obj_has_particles=function(a){return 0<a.particle_systems.length};a.bpy_obj_has_anim_particles=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.has_dynamic_grass_particles=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;
if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.init_particles_data=function(a,b,k){var m=a.particles_data={name:b.name,p_type:b.settings.type,time:0,prev_time:-1,use_world_space:!1,frame_start:0,frame_end:0,time_length:0,lifetime_frames:0,lifetime:0,cyclic:0,mass:0,nfactor:0,gravity:0,fade_in:0,fade_out:0,wind_factor:0,size:0,alpha_start:0,alpha_end:0,color_ramp_length:0,color_ramp:new Float32Array(16),need_buffers_update:!1,positions:null,positions_cache:null,tbn_quats:null,tbn_quats_cache:null,
delay_attrs:null,delay_attrs_masked:null,emitter_tsr_snapshots:null,p_data:null,tilt:0,tilt_rand:0};m.frame_start=b.settings.frame_start;m.frame_end=b.settings.frame_end;m.time_length=(m.frame_end-m.frame_start)/e.get_framerate();m.lifetime_frames=b.settings.lifetime;m.lifetime=m.lifetime_frames/e.get_framerate();m.cyclic=b.settings.b4w_cyclic?1:0;m.mass=b.settings.mass;m.nfactor=b.settings.normal_factor;m.gravity=9.81*b.settings.effector_weights.gravity;m.fade_in=b.settings.b4w_fade_in/e.get_framerate();
m.fade_out=b.settings.b4w_fade_out/e.get_framerate();m.wind_factor=b.settings.effector_weights.wind;m.use_world_space="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var h,d,t;a.halo_particles?(h=k.halo.size,d=k.halo.hardness,30>d?(d=.5,t=.9):40>d?(d=.1,t=1):50>d?(d=0,t=.8):(d=0,t=.5)):(h=b.settings.particle_size,t=d=1);m.size=h;m.alpha_start=d;m.alpha_end=t;k.use_nodes&&"BILLBOARD"==b.settings.render_type&&(f.set_batch_directive(a,"NODES",1),f.set_batch_directive(a,"PARTICLE_BATCH",1),a.use_nodes=
!0,a.has_nodes=!0);b=b.settings.texture_slots;b[0]&&b[0].use_map_size&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp&&c.allow_vertex_textures&&(h=[],q.calc_color_ramp_data(b[0].texture.color_ramp,q.PART_COLORRAMP_TEXT_SIZE,h),h=new Uint8Array(h.map(function(a){return p.clamp(255*a,0,255)})),f.append_texture_to_batch(a,h,"u_color_ramp_tex",q.PART_COLORRAMP_TEXT_SIZE),f.set_batch_directive(a,"USE_COLOR_RAMP",1));k=k.texture_slots;a=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(k[0]&&
"STRAND"==k[0].texture_coords&&k[0].texture&&"BLEND"==k[0].texture.type&&k[0].texture.use_color_ramp){k=k[0].texture.color_ramp.elements;b=Math.min(4*k.length,a.length);for(h=0;h<b;h+=4)d=k[h/4],a[h]=d.position,a[h+1]=d.color[0],a[h+2]=d.color[1],a[h+3]=d.color[2];m.color_ramp_length=k.length}m.color_ramp.set(a)};a.generate_emitter_particles_submesh=function(a,b,c,k){var f=a.particles_data,d=k.world_tsr,m=c.settings.count,n=c.settings.frame_start/e.get_framerate(),A=c.settings.frame_end/e.get_framerate(),
x=c.settings.lifetime/e.get_framerate(),g=c.settings.lifetime_random,H=c.settings.emit_from,q=c.settings.factor_random;if(c.settings.use_rotations)var E=c.settings.angular_velocity_mode,r=c.settings.angular_velocity_factor;else E="NONE",r=0;var F=c.settings.b4w_randomize_emission,U=c.settings.b4w_cyclic;f.tilt=c.settings.billboard_tilt;f.tilt_rand=c.settings.billboard_tilt_random;h(c.seed);var Q;b=l.extract_submesh_all_mats(b,["a_position","a_tbn_quat"],null,k);switch(H){case "VERT":var T=b.va_frames[0].a_position;
Q=b.va_frames[0].a_tbn_quat;b=T.length/3;H=[];for(c=0;c<m;c++)k=Math.round((b-1)*w()),H.push(k),H.push(k),H.push(k),H.push(k);b=[];for(c=0;c<H.length;c++)b.push(T[3*H[c]]),b.push(T[3*H[c]+1]),b.push(T[3*H[c]+2]);T=new Float32Array(b);b=[];for(c=0;c<H.length;c++)b.push(Q[4*H[c]]),b.push(Q[4*H[c]+1]),b.push(Q[4*H[c]+2]),b.push(Q[4*H[c]+3]);Q=new Float32Array(b);break;case "FACE":T=[];Q=[];c=[];p.init_rand_r_seed(0,c);H=l.geometry_random_points(b,m,!1,c);p.init_rand_r_seed(0,c);b=l.geometry_random_points(b,
m,!0,c);for(c=0;c<H.length;c++)T.push(H[c][0],H[c][1],H[c][2]),T.push(H[c][0],H[c][1],H[c][2]),T.push(H[c][0],H[c][1],H[c][2]),T.push(H[c][0],H[c][1],H[c][2]),Q.push(b[c][0],b[c][1],b[c][2],b[c][3]),Q.push(b[c][0],b[c][1],b[c][2],b[c][3]),Q.push(b[c][0],b[c][1],b[c][2],b[c][3]),Q.push(b[c][0],b[c][1],b[c][2],b[c][3]);T=new Float32Array(T);Q=new Float32Array(Q);break;case "VOLUME":p.panic("Particle emission from volume is not supported");break;default:p.panic("Wrong emit from option")}Q=[T,Q];T=Q[0];
Q=Q[1];f.positions=new Float32Array(T);f.tbn_quats=new Float32Array(Q);f.positions_cache=new Float32Array(T.length);f.tbn_quats_cache=new Float32Array(Q.length);H=[];A=(A-n)/m;for(b=0;b<m;b++)c=F?A*b+10*A*(.5-w()):A*b,U||(c+=n),H.push(c),H.push(c),H.push(c),H.push(c);n=new Float32Array(H);f.delay_attrs=new Float32Array(n);f.delay_attrs_masked=new Float32Array(n);if(f.use_world_space){f.emitter_tsr_snapshots=new Float32Array(8*n.length);for(F=0;F<8*n.length;F++)for(U=0;8>U;U++)f.emitter_tsr_snapshots[8*
F+U]=d[U];u(f,T,Q,d,T,Q)}d=l.init_submesh("EMITTER_PARTICLES");F=p.create_empty_va_frame();F.a_position=T;F.a_tbn_quat=Q;d.va_frames[0]=F;a.draw_mode=l.DM_DYNAMIC_TRIANGLES;a=[];for(F=0;F<m;F++)a.push(4*F,4*F+2,4*F+1,4*F,4*F+3,4*F+2);a=new Uint16Array(a);d.indices=a;d.va_common.a_p_bb_vertex=l.gen_bb_vertices(m);d.base_length=T.length/3;a=[];g*=x;for(F=0;F<m;F++)U=g*w(),a.push(x-U),a.push(x-U),a.push(x-U),a.push(x-U);x=d.va_common;g=[];for(F=0;F<m;F++)U=Math.random(),g.push(a[4*F],n[4*F],U),g.push(a[4*
F+1],n[4*F+1],U),g.push(a[4*F+2],n[4*F+2],U),g.push(a[4*F+3],n[4*F+3],U);g=new Float32Array(g);x.a_p_data=g;x=d.va_common;g=[];for(a=0;a<m;a++){n=[w()-.5,w()-.5,w()-.5];B.normalize(n,n);g.push(q*n[0]);g.push(q*n[1]);g.push(q*n[2]);switch(E){case "NONE":g.push(0);break;case "SPIN":case "VELOCITY":g.push(r);break;case "RAND":g.push(2*r*(w()-.5));break;default:p.panic("Undefined velocity factor")}n=g.slice(-4);for(F=0;12>F;F++)g.push(n[F%4])}m=new Float32Array(g);x.a_p_vels=m;f.p_data=new Float32Array(d.va_common.a_p_data);
return d};a.set_time=function(a,b,c){a=a.scenes_data;for(var k=0;k<a.length;k++)for(var e=a[k].batches,d=0;d<e.length;d++){var f=e[d].particles_data;f&&f.name==b&&!e[d].forked_batch&&(f.prev_time=f.time,f.time=c)}};a.prepare_lens_flares=function(a){for(var b=a.base_length,c=a.va_frames[0].a_position,k=[],e=[],d=0;d<b;d++)e.push(c[3*d]),k.push(c[3*d+1]),e.push(c[3*d+2]);k=new Float32Array(k);e=new Float32Array(e);a.va_common.a_lf_dist=k;a.va_common.a_lf_bb_vertex=e;return a};a.set_size=function(a,
b,c){a=a.scenes_data;for(var k=0;k<a.length;k++)for(var e=a[k].batches,d=0;d<e.length;d++){var f=e[d].particles_data;f&&f.name==b&&(f.size=c)}};a.set_normal_factor=function(a,b,c){a=a.scenes_data;for(var k=0;k<a.length;k++)for(var e=a[k].batches,d=0;d<e.length;d++){var f=e[d].particles_data;f&&f.name==b&&(f.nfactor=c)}};a.set_factor=function(a,b,c){a=a.scenes_data;for(var k=0;k<a.length;k++)for(var e=a[k].batches,d=0;d<e.length;d++){var f=e[d],m=f.particles_data;if(m&&m.name==b){var h=m.delay_attrs;
if(1==c)var n=h;else if(0==c)for(var n=m.delay_attrs_masked,g=0;g<n.length;g+=4)n[g]=1E4,n[g+1]=n[g],n[g+2]=n[g],n[g+3]=n[g];else for(var p=4/c,n=m.delay_attrs_masked,B=0,g=0;g<n.length;g+=4)g>=B?(n[g]=h[g],B+=p):n[g]=1E4,n[g+1]=n[g],n[g+2]=n[g],n[g+3]=n[g];f=f.bufs_data;if(f.pointers.a_p_data){m=m.p_data;for(g=0;g<m.length;g+=3)m[g+1]=n[Math.round(g/3)];l.update_bufs_data_array(f,"a_p_data",3,m)}}}};a.update_start_pos=function(a,b,c){a=a.scenes_data;for(var k=0;k<a.length;k++)for(var e=a[k].batches,
d=0;d<e.length;d++){var f=e[d].particles_data;if(f&&f.use_world_space)for(var m=0;m<8*f.delay_attrs.length;m++)f.emitter_tsr_snapshots[8*m]=b[0],f.emitter_tsr_snapshots[8*m+1]=b[1],f.emitter_tsr_snapshots[8*m+2]=b[2],f.emitter_tsr_snapshots[8*m+3]=b[3],f.emitter_tsr_snapshots[8*m+4]=c[0],f.emitter_tsr_snapshots[8*m+5]=c[1],f.emitter_tsr_snapshots[8*m+6]=c[2],f.emitter_tsr_snapshots[8*m+7]=c[3]}};a.update_particles_submesh=function(a,b,c,k){k=[];for(var e=0;e<c;e++)k.push(0,0,0,1,0,0,0,1,0,0,0,1,0,
0,0,1);a.va_common.a_tbn_quat=new Float32Array(k);if(b.part_node_data){k=[];for(e=0;e<c;e++)k.push(e,e,e,e);a.va_common[b.part_node_data.name]=new Float32Array(k)}};a.update_particles_objs_cache=function(a){-1==E.indexOf(a)&&E.push(a)};a.remove_obj_from_cache=function(a){a=E.indexOf(a);-1!=a&&E.splice(a,1)};a.cleanup=function(){E.length=0}};b4w.module.__primitives=function(a,r){function u(a,b,c,k){for(var f=[],h=[],l=[],n=[],v=2*c/(a-1),z=2*k/(b-1),y=0;y<a;y++)for(var D=-c+y*v,r=0;r<b;r++)if(h.push(D,-k+r*z,0),n.push(0,0,0,1),l.push(y/(a-1),r/(b-1)),y&&r){var d=y*b+r,t=d-1,C=(y-1)*b+r,M=C-1;f.push(d,t,C);f.push(t,M,C)}a=e.create_empty_va_frame();a.a_position=new Float32Array(h);a.a_tbn_quat=new Float32Array(n);n=q.init_submesh("GRID_PLANE");n.va_frames[0]=a;n.va_common.a_texcoord=new Float32Array(l);n.indices=new Uint32Array(f);n.base_length=
h.length/3;return n}function h(a){var b=a.length;b%4&&e.panic("Wrong array");for(var c=[],k=[],m=0;m<b;m+=4){var h=a[m+1],l=a[m+2],n=a[m+3];f(a[m],k);f(h,k);f(l,k);f(n,k);c.push(m,m+1,m+2);c.push(m,m+2,m+3)}a=e.create_empty_va_frame();a.a_position=new Float32Array(k);b=q.init_submesh("FROM_QUADS");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=k.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function f(a,b){b.push(a[0],a[1],a[2])}var l=r("__config"),q=r("__geometry");
r("__print");var e=r("__util"),n=l.defaults;a.generate_line=function(){var a=q.init_submesh("LINE"),b=e.create_empty_va_frame();b.a_position=new Float32Array(3);b.a_direction=new Float32Array(3);a.va_frames[0]=b;a.indices=new Uint32Array(1);a.base_length=1;return a};a.generate_plane=function(a,b){var c=u(2,2,a,b);c.name="PLANE";return c};a.generate_grid=u;a.generate_cascaded_grid=function(a,b,c){function k(a,b){return 1==a%2&&(0==b||b==w-1)||1==b%2&&(0==a||a==l-1)?!0:!1}var f=c/=Math.pow(2,a-1),h=
c,l=b+1,w=b+1;b=[];c=[];for(var v=[],z=0,y=0,D=-1,r=[],d=0;d<a;d++){for(var t=2*f/(l-1),C=2*h/(w-1),M=[],x=[],g=0,H=0;H<l;H++){for(var G=-f+H*t,u=[],L=0;L<w;L++){var F=-h+L*C;if(G>-z&&G<z&&F>-y&&F<y)u.push(-1),g++;else{for(var U=null,Q=0;Q<r.length;Q+=3)if(G==r[Q]&&F==r[Q+1]){U=r[Q+2];break}Q=null!==U?U:D+1;k(H,L)?(u.push(-2),g++):(null==U&&(0==L||L==w-1||0==H||H==l-1?(U=d==a-1?t:2*t,M.push(G,F,Q)):U=t,c.push(G,F,U),v.push(.707,0,0,.707),D++),u.push(Q));if(H&&L)if(1==H)if(k(H-1,L)){if(1<L){var F=
Q-1,U=x[H-1][L+1],T=U-1;b.push(T,F,Q)}else U=x[H-1][L+1],T=U-1;b.push(U,T,Q)}else k(H,L)||(F=Q-1,U=x[H-1][L],b.push(U,F,Q));else if(H==l-1){if(!k(H,L))if(L==w-1)F=Q-1,U=x[H-1][L-1],T=x[H-2][L],b.push(U,F,Q),b.push(T,U,Q);else{var F=Q-1,U=x[H-1][L],T=U-1,W=U+1;b.push(T,F,Q);b.push(U,T,Q);b.push(W,U,Q);2==L&&(W=x[H-2][L-2],b.push(T,W,F))}}else 1==L?k(H,L-1)?(F=x[H-1][L],U=x[H-1][L-1],b.push(F,U,Q)):(F=u[L-1],U=x[H-1][L],T=x[H-2][L-1],b.push(U,F,Q),b.push(U,T,F)):L==w-1?k(H,L)||(F=u[L-1],U=x[H-1][L-
1],T=x[H-2][L],b.push(U,F,Q),b.push(T,U,Q)):-1!=x[H-1][L]&&-1!=x[H-1][L-1]&&-1!=u[L-1]?(F=u[L-1],U=x[H-1][L],T=x[H-1][L-1],b.push(U,F,Q),b.push(U,T,F),L==w-2&&k(H,L+1)&&(W=x[H-1][L+1],b.push(W,U,Q))):L==w-2&&k(H,L+1)&&(U=x[H-1][L],W=x[H-1][L+1],b.push(W,U,Q))}}x.push(u)}r=M;z=f;y=h;f*=2;h*=2}if(2E4>z)for(a=-(2*z)/(l-1),c.push(-2E4,-2E4,a),c.push(-2E4,2E4,a),c.push(-z,-y,a),c.push(-z,y,a),c.push(2E4,-2E4,a),c.push(2E4,2E4,a),c.push(z,-y,a),c.push(z,y,a),Q=D+1,b.push(Q+1,Q+2,Q+3,Q+1,Q+0,Q+2,Q+2,Q+4,
Q+6,Q+2,Q+0,Q+4,Q+1,Q+7,Q+5,Q+1,Q+3,Q+7,Q+7,Q+4,Q+5,Q+6,Q+4,Q+7),H=0;8>H;H++)v.push(.707,0,0,.707);a=e.create_empty_va_frame();a.a_position=new Float32Array(c);a.a_tbn_quat=new Float32Array(v);f=q.init_submesh("MULTIGRID_PLANE");f.va_frames[0]=a;f.indices=new Uint32Array(b);f.base_length=c.length/3;n.water_wireframe_debug&&(q.submesh_drop_indices(f,1,!0),a.a_polyindex=q.extract_polyindices(f));return f};a.generate_from_triangles=function(a){var b=a.length;b%3&&e.panic("Wrong array");for(var c=[],
k=[],m=0;m<b;m+=3){var h=a[m+1],l=a[m+2];f(a[m],k);f(h,k);f(l,k);c.push(m,m+1,m+2)}a=e.create_empty_va_frame();a.a_position=new Float32Array(k);b=q.init_submesh("FROM_TRIANGLES");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=k.length/3;return b};a.generate_from_quads=h;a.generate_frustum=function(a){a=e.vectorize(a,[]);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],
a[6],a[7]);a=h(b);a.name="FRUSTUM";return a};a.generate_fullscreen_tri=function(){var a=q.init_submesh("FULLSCREEN_TRI"),b=e.create_empty_va_frame();b.a_position=new Float32Array([0,0,1,0,0,1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,1,2]);a.base_length=3;return a};a.generate_fullscreen_quad=function(){var a=q.init_submesh("FULLSCREEN_QUAD"),b=e.create_empty_va_frame();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,1,2,3]);a.base_length=
4;return a};a.generate_billboard=function(){var a=q.init_submesh("BILLBOARD"),b=e.create_empty_va_frame();b.a_bb_vertex=q.gen_bb_vertices(1);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_cube=function(){var a=q.init_submesh("CUBEMAP_BOARD"),b=e.create_empty_va_frame();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_uv_sphere=function(a,h,c,k,m,l){var n=
q.init_submesh("UV_SPHERE"),w,v,z=[],y=[],D=[];for(v=0;v<=h;v++)for(w=0;w<=a;w++){var r=w/a,d=v/h,t=-c*Math.cos(2*r*Math.PI)*Math.sin(d*Math.PI),C=c*Math.cos(d*Math.PI),r=c*Math.sin(2*r*Math.PI)*Math.sin(d*Math.PI);m&&(t=1E-5>Math.abs(t)?0:t,C=1E-5>Math.abs(C)?0:C,r=1E-5>Math.abs(r)?0:r);y.push(t+k[0],C+k[1],r+k[2])}for(v=m=0;v<h;v++)for(w=0;w<a;w++)t=b(y,(a+1)*v+w+1),C=b(y,(a+1)*v+w),r=b(y,(a+1)*(v+1)+w),d=b(y,(a+1)*(v+1)+w+1),Math.abs(t[1])==c+k[1]?(f(t,z),f(r,z),f(d,z),l?D.push(m,m+1,m+1,m+2,m+
2,m):D.push(m,m+1,m+2),m+=3):Math.abs(r[1])==c+k[1]?(f(t,z),f(C,z),f(r,z),l?D.push(m,m+1,m+1,m+2,m+2,m):D.push(m,m+1,m+2),m+=3):(f(t,z),f(C,z),f(r,z),f(d,z),l?(D.push(m,m+1),D.push(m+1,m+2),D.push(m+2,m+3),D.push(m+3,m)):(D.push(m,m+1,m+2),D.push(m,m+2,m+3)),m+=4);a={};a.a_position=z;l?a.a_tbn_quat=[]:(l=q.calc_shared_indices(D,y,z),l=q.calc_normals(D,z,l),a.a_tbn_quat=e.gen_tbn_quats(l));n.va_frames[0]=a;n.indices=D;n.base_length=z.length/3;return n};a.generate_index=function(a){var b=q.init_submesh("INDEX"),
c=e.create_empty_va_frame();c.a_index=new Float32Array(a);for(var k=0;k<a;k++)c.a_index[k]=k;b.va_frames[0]=c;b.indices=new Uint16Array(0);b.base_length=a;return b}};b4w.module.__prerender=function(a,r){function u(a,c){var f=a.obj_render;f.is_visible=!1;if(f.hide)return!1;var h=c.camera,q=c.type==e.SHADOW_CAST?h.lod_eye:n.get_trans(h.world_tsr,k),z=f.lod_dist_min,y=f.lod_dist_max,q=B.dist(f.bs_world.center,q);if(!(q<z?0:y==l.LOD_DIST_MAX_INFINITY||q<y+f.lod_transition_ratio*f.bs_world.radius))return!1;f.is_visible=!0;q=a.batch;if(c.type==e.DEBUG_VIEW)return c.debug_view_mode==b.DV_BOUNDINGS?q.debug_sphere:!q.debug_sphere;if(c.type==e.OUTLINE_MASK&&0==f.outline_intensity)return!1;
f.use_batches_boundings?(z=q.bs_world,y=q.be_world,q=q.use_be):(z=f.bs_world,y=f.be_world,q=f.use_be);if(f=!f.do_not_cull&&!0)h=h.frustum_planes,f=y,y=q,q=z.center,p.sphere_is_out_of_frustum(q,h,z.radius)?f=!0:y?(q=f.center,f=p.ellipsoid_is_out_of_frustum(q,h,f.axis_x,f.axis_y,f.axis_z)):f=!1;return f?!1:!0}function h(a){var b=a.particles_data;if(b&&b.need_buffers_update){a=a.bufs_data;f.make_dynamic(a);var c=a.pointers,k=c.a_position.offset;f.vbo_source_data_set_attr(a.vbo_source_data,"a_position",
b.positions_cache,k);k=c.a_tbn_quat.offset;f.vbo_source_data_set_attr(a.vbo_source_data,"a_tbn_quat",b.tbn_quats_cache,k);f.update_gl_buffers(a)}}r("__config");var b=r("__debug"),f=r("__geometry"),l=r("__obj_util"),q=r("__renderer"),e=r("__subscene"),n=r("__tsr"),p=r("__util"),B=r("__vec3"),c=[e.MAIN_OPAQUE,e.MAIN_BLEND,e.MAIN_PLANE_REFLECT,e.MAIN_CUBE_REFLECT,e.MAIN_PLANE_REFLECT_BLEND,e.MAIN_CUBE_REFLECT_BLEND,e.MAIN_GLOW,e.MAIN_XRAY,e.SHADOW_CAST,e.SHADOW_RECEIVE,e.OUTLINE_MASK,e.DEBUG_VIEW,e.COLOR_PICKING,
e.COLOR_PICKING_XRAY],k=new Float32Array(3);a.prerender_subs=function(a){if(-1<c.indexOf(a.type)){for(var b=!1,k=a.type==e.MAIN_CUBE_REFLECT||a.type==e.MAIN_CUBE_REFLECT_BLEND,f=a.draw_data,l=0;l<f.length;l++){for(var n=f[l],p=n.bundles,B=!1,r=0;r<p.length;r++){var d=p[r],t=d.batch;if(k)for(var C=0;6>C;C++)a.camera.frustum_planes=a.cube_cam_frustums[C],d.do_render_cube[C]=u(d,a),d.do_render_cube[C]&&(B=b=!0,h(t));else d.do_render=u(d,a),d.do_render&&(B=b=!0,h(t));a.need_perm_uniforms_update&&(t.shader.need_uniforms_update=
!0)}n.do_render=B}a.need_perm_uniforms_update=!1;switch(a.type){case e.DEBUG_VIEW:break;default:a.type==e.MAIN_OPAQUE||a.type==e.SHADOW_RECEIVE||a.type==e.MAIN_GLOW||a.type==e.MAIN_PLANE_REFLECT||a.type==e.MAIN_CUBE_REFLECT||b?a.do_render=!0:(a.do_render&&q.clear(a),a.do_render=!1)}}else if(a.need_perm_uniforms_update){f=a.draw_data;for(l=0;l<f.length;l++)for(p=f[l].bundles,r=0;r<p.length;r++)d=p[r],t=d.batch,t.shader.need_uniforms_update=!0;a.need_perm_uniforms_update=!1}a.need_draw_data_sort&&e.sort_draw_data(a)}};b4w.module.__print=function(a,r){function u(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var k=1;k<a.length;k++)c.push(a[k]);return c}function h(){q++;var a=u(arguments,"B4W ERROR");console.error.apply(console,a)}function b(a){a in n||(n[a]=a,h([a]))}function f(a,e){b(a+"() is deprecated, use "+e+"() instead.")}var l=!1,q=0,e=0,n={};a.set_verbose=function(a){l=a};a.log_raw=function(){console.log.apply(console,arguments)};a.log=function(){if(l){var a=
u(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=h;a.error_once=b;a.error_deprecated=f;a.error_deprecated_arr=function(a,e){switch(1<e.length){case !0:b(a+"() is deprecated, use "+e.slice(0,-1).join("(), ")+"() or "+e[e.length-1]+"() instead.");break;case !1:f(a,e[0])}};a.error_deprecated_cfg=function(a,e){b('Config option "'+a+'" is deprecated, use "'+e+'" instead.')};a.warn=function(){e++;var a=u(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=u(arguments,
"B4W INFO");console.info.apply(console,a)};a.export_error=function(){q++;var a=u(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.export_warn=function(){e++;var a=u(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){l&&console.time.apply(console,arguments)};a.timeEnd=function(){l&&console.timeEnd.apply(console,arguments)};a.group=function(){console.group.apply(console,arguments)};a.groupCollapsed=function(){console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.get_warning_count=function(){return e};a.get_error_count=function(){return q};a.clear_errors_warnings=function(){q=e=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,r){function u(a){switch(a.type){case "VALTORGB":a.color_ramp||(a.color_ramp={elements:[{position:.5,color:[1,1,1,1]}]},b("node Color Ramp",a,"color_ramp"));break;case "CURVE_RGB":a.curve_mapping||(a.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},b("node RGB Curves",a,
"curve_mapping"));break;case "CURVE_VEC":a.curve_mapping||(a.curve_mapping={curves_data:[[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]]],curves_handle_types:["EXTRAPOLATED","EXTRAPOLATED","EXTRAPOLATED"],curve_extend:[["AUTO","AUTO"],["AUTO","AUTO"],["AUTO","AUTO"]]},b("node Vector Curves",a,"curve_mapping"));break;case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in
a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"use_tangent_shading"in a||(a.use_tangent_shading=!1,b("node material",a,"use_tangent_shading"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));
"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",
a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":a.node_tree_name=
a.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}break;case "VECT_TRANSFORM":"convert_from"in a||(a.convert_from="WORLD",b("node "+a.type,a,"convert_from")),"convert_to"in a||(a.convert_to="WORLD",b("node "+
a.type,a,"convert_to")),"vector_type"in a||(a.vector_type="POINT",b("node "+a.type,a,"vector_type"))}}function h(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var k=a[c],e=0;e<k.strips.length;e++){var f=k.strips[e];"action"in f||(f.action=null,b("strip",f,"action"));"action_frame_start"in f||(f.action_frame_start=0,b("strip",f,"action_frame_start"));"action_frame_end"in f||(f.action_frame_end=f.frame_end-f.frame_start,b("strip",f,"action_frame_end"));"repeat"in f||(f.repeat=1,b("strip",f,"repeat"));
"use_reverse"in f||(f.use_reverse=!1,b("strip",f,"use_reverse"));"scale"in f||(f.scale=1,b("strip",f,"scale"))}}function b(a,b,c){c=c+">>"+a;c in z||(z[c]={storage:[],report_type:"undefined",type:a});z[c].storage.push(b.name)}function f(a,b,c){c=c+">>"+a;c in z||(z[c]={storage:[],report_type:"deprecated",type:a});z[c].storage.push(b.name)}function l(a){B.warn(a)}function q(a,b){b||(b=a.name+"_COPY");var c=a.materials,e=a.submeshes;a.materials=null;a.submeshes=null;var f=k.clone_object_json(a);a.materials=
c;a.submeshes=e;f.name=b;f.materials=a.materials.slice(0);f.submeshes=[];for(c=0;c<e.length;c++){var h=k.clone_object_nr(e[c]);f.submeshes.push(h)}return f}var e=r("__boundings"),n=r("__curve"),p=r("__mat4"),B=r("__print"),c=r("__quat"),k=r("__util"),m=r("__vec3"),A=r("__mat3"),E=r("__logic_nodes"),w=r("__animation"),v=[5,4],z={},y=A.create(),D=c.create();a.check_particles_bin_format=function(a){return-1!=k.version_cmp(a,v)};a.check_bpy_data=function(a){z={};var c=a.worlds;if(0==c.length){B.warn('WARNING Datablock world is missing, reexport "'+
a.b4w_filepath_blend+'" scene');var e={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};c.push(e)}for(var c=a.worlds,m=0;m<c.length;m++){e=c[m];"use_sky_blend"in e||(b("world",
e,"use_sky_blend"),e.use_sky_blend=!1);"use_sky_paper"in e||(b("world",e,"use_sky_paper"),e.use_sky_paper=!1);"use_sky_real"in e||(b("world",e,"use_sky_real"),e.use_sky_real=!1);"b4w_sky_settings"in e&&"rayleigh_brightness"in e.b4w_sky_settings||(b("world",e,"rayleigh_brightness"),e.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,
rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in e||(b("world",e,"fog_settings"),e.fog_settings={use_fog:!1,intensity:0,depth:25,start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},"b4w_fog_color"in e&&(e.fog_settings.use_custom_color=!0,e.fog_settings.color=e.b4w_fog_color),"b4w_fog_density"in e&&0<e.b4w_fog_density&&(e.fog_settings.depth=1/e.b4w_fog_density));"render_sky"in e.b4w_sky_settings||(b("world",e,"render_sky"),e.b4w_sky_settings.render_sky=
!1);for(var n=e.texture_slots,p=0;p<n.length;p++){var g=n[p];"blend_type"in g||(g.blend_type="MIX",b("world_texture_slot",g,"blend_type"));"use_map_blend"in g||(g.use_map_blend=!1,b("world_texture_slot",g,"use_map_blend"));"use_map_horizon"in g||(g.use_map_horizon=!0,b("world_texture_slot",g,"use_map_horizon"));"use_map_zenith_up"in g||(g.use_map_zenith_up=!1,b("world_texture_slot",g,"use_map_zenith_up"));"use_rgb_to_intensity"in g||(g.use_rgb_to_intensity=!1,b("world_texture_slot",g,"use_rgb_to_intensity"));
"invert"in g||(g.invert=!1,b("world_texture_slot",g,"invert"));"color"in g||(g.color=[1,0,1],b("world_texture_slot",g,"color"));"blend_factor"in g||(g.blend_factor=0,b("world_texture_slot",g,"blend_factor"));"horizon_factor"in g||(g.horizon_factor=1,b("world_texture_slot",g,"horizon_factor"));"zenith_up_factor"in g||(g.zenith_up_factor=0,b("world_texture_slot",g,"zenith_up_factor"));"zenith_down_factor"in g||(g.zenith_down_factor=0,b("world_texture_slot",g,"zenith_down_factor"));"default_value"in
g||(g.default_value=1,b("world_texture_slot",g,"default_value"))}"b4w_use_default_animation"in e||(b("world",e,"b4w_use_default_animation"),e.b4w_use_default_animation=!1);"b4w_anim_behavior"in e||(b("world",e,"b4w_anim_behavior"),e.b4w_anim_behavior="CYCLIC")}n=a.scenes;for(m=0;m<n.length;m++)g=n[m],p=g.world,"timeline_markers"in g||(g.timeline_markers=null,b("scene",g,"timeline_markers")),"b4w_reflection_quality"in g||(g.b4w_reflection_quality="MEDIUM",b("scene",g,"b4w_reflection_quality")),"b4w_use_nla"in
g||(g.b4w_use_nla=!1,b("scene",g,"b4w_use_nla")),"fps"in g||(g.fps=24,b("scene",g,"fps")),"b4w_nla_cyclic"in g||(g.b4w_nla_cyclic=!1,b("scene",g,"b4w_nla_cyclic")),"b4w_logic_nodes"in g||(g.b4w_logic_nodes=[],b("scene",g,"b4w_logic_nodes")),"b4w_detect_collisions"in g&&(f("scene",g,"b4w_detect_collisions"),delete g.b4w_detect_collisions),"audio_doppler_speed"in g||(g.audio_doppler_speed=343.3),"audio_doppler_factor"in g||(g.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in g||(g.b4w_dynamic_compressor_settings=
{threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",g,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in g||(g.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in g||(g.b4w_enable_bloom=!1,b("scene",g,"b4w_enable_bloom")),"b4w_enable_motion_blur"in g||(g.b4w_enable_motion_blur=!1,b("scene",g,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in g||(g.b4w_enable_color_correction=!1,b("scene",g,"b4w_enable_color_correction")),"b4w_antialiasing_quality"in g||
(g.b4w_antialiasing_quality="MEDIUM",b("scene",g,"b4w_antialiasing_quality")),"b4w_tags"in g||(g.b4w_tags={title:"",description:""},b("scene",g,"b4w_tags")),"b4w_enable_object_selection"in g||(g.b4w_enable_object_selection="AUTO",b("scene",g,"b4w_enable_object_selection")),"b4w_enable_outlining"in g||(g.b4w_enable_outlining="AUTO",b("scene",g,"b4w_enable_outlining")),"b4w_enable_glow_materials"in g||(g.b4w_enable_glow_materials="AUTO",b("scene",g,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in
g||(g.b4w_enable_anchors_visibility="AUTO",b("scene",g,"b4w_enable_anchors_visibility")),"b4w_outline_color"in g||(g.b4w_outline_color=[1,1,1],b("scene",g,"b4w_outline_color")),"b4w_outline_factor"in g||(g.b4w_outline_factor="b4w_glow_factor"in g?g.b4w_glow_factor:1,b("scene",g,"b4w_outline_factor")),"b4w_shadow_settings"in g||(b("scene",g,"b4w_shadow_settings"),c=p.b4w_shadow_settings,g.b4w_shadow_settings=c?c:{csm_resolution:2048,blur_samples:"16x",self_shadow_polygon_offset:1,b4w_enable_csm:!1,
csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),c=g.b4w_shadow_settings,"csm_resolution"in c||(b("scene",g,"b4w_shadow_settings.csm_resolution"),c.csm_resolution=2048),"blur_samples"in c||(b("scene",g,"b4w_shadow_settings.blur_samples"),c.blur_samples="16x"),"soft_shadows"in c||(b("scene",g,"b4w_shadow_settings.soft_shadows"),c.soft_shadows=!0),"self_shadow_polygon_offset"in
c||(b("scene",g,"b4w_shadow_settings.self_shadow_polygon_offset"),c.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in c||(b("scene",g,"b4w_shadow_settings.self_shadow_normal_offset"),c.self_shadow_normal_offset=.01),"b4w_enable_csm"in c||(b("scene",g,"b4w_shadow_settings.b4w_enable_csm"),c.b4w_enable_csm=!1),"csm_num"in c||(b("scene",g,"b4w_shadow_settings.csm_num"),c.csm_num=1),"csm_first_cascade_border"in c||(b("scene",g,"b4w_shadow_settings.csm_first_cascade_border"),c.csm_first_cascade_border=
10),"first_cascade_blur_radius"in c||(b("scene",g,"b4w_shadow_settings.first_cascade_blur_radius"),c.first_cascade_blur_radius=3),"csm_last_cascade_border"in c||(b("scene",g,"b4w_shadow_settings.csm_last_cascade_border"),c.csm_last_cascade_border=100),"last_cascade_blur_radius"in c||(b("scene",g,"b4w_shadow_settings.last_cascade_blur_radius"),c.last_cascade_blur_radius=1.5),"fade_last_cascade"in c||(b("scene",g,"b4w_shadow_settings.fade_last_cascade"),c.fade_last_cascade=!0),"blend_between_cascades"in
c||(b("scene",g,"b4w_shadow_settings.blend_between_cascades"),c.blend_between_cascades=!0),"b4w_ssao_settings"in g||(b("scene",g,"b4w_ssao_settings"),c=p.b4w_ssao_settings,g.b4w_ssao_settings=c?c:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),c=g.b4w_ssao_settings,"dist_factor"in c||(b("scene",g,"b4w_ssao_settings.dist_factor"),c.dist_factor=0),"samples"in c||(b("scene",g,"b4w_ssao_settings.samples"),c.samples=16),"hemisphere"in c||(b("scene",g,"b4w_ssao_settings.hemisphere"),
c.hemisphere=!1),"blur_depth"in c||(b("scene",g,"b4w_ssao_settings.blur_depth"),c.blur_depth=!1),"blur_discard_value"in c||(b("scene",g,"b4w_ssao_settings.blur_discard_value"),c.blur_discard_value=1),"b4w_bloom_settings"in g||(b("scene",g,"b4w_bloom_settings"),c=p.b4w_bloom_settings,g.b4w_bloom_settings=c?c:{key:.2,blur:4,edge_lum:1}),"key"in g.b4w_bloom_settings||(b("scene",g,"b4w_bloom_settings.key"),g.b4w_bloom_settings.key=.2),"blur"in g.b4w_bloom_settings||(b("scene",g,"b4w_bloom_settings.blur"),
g.b4w_bloom_settings.blur=4),"edge_lum"in g.b4w_bloom_settings||(b("scene",g,"b4w_bloom_settings.edge_lum"),g.b4w_bloom_settings.edge_lum=1),"b4w_motion_blur_settings"in g||(b("scene",g,"b4w_motion_blur_settings"),c=p.b4w_motion_blur_settings,g.b4w_motion_blur_settings=c?c:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in g.b4w_motion_blur_settings||(b("scene",g,"b4w_motion_blur_settings.motion_blur_factor"),g.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in
g.b4w_motion_blur_settings||(b("scene",g,"b4w_motion_blur_settings.motion_blur_decay_threshold"),g.b4w_motion_blur_settings.motion_blur_decay_threshold=.01),"b4w_color_correction_settings"in g||(b("scene",g,"b4w_color_correction_settings"),c=p.b4w_color_correction_settings,g.b4w_color_correction_settings=c?c:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in g||(b("scene",g,"b4w_god_rays_settings"),c=p.b4w_god_rays_settings,g.b4w_god_rays_settings=c?c:{intensity:.7,max_ray_length:1,
steps_per_pass:10}),"steps_per_pass"in g.b4w_god_rays_settings||(b("scene",g,"b4w_god_rays_settings.steps_per_pass"),g.b4w_god_rays_settings.steps_per_pass=10),"b4w_glow_settings"in g||(b("scene",g,"b4w_glow_settings"),g.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},c=g.b4w_glow_settings,"b4w_render_glow_over_blend"in p&&(c.render_glow_over_blend=p.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in
p&&(c.small_glow_mask_coeff=p.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in p&&(c.large_glow_mask_coeff=p.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in p&&(c.small_glow_mask_width=p.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in p&&(c.large_glow_mask_width=p.b4w_large_glow_mask_width)),p=g.b4w_render_shadows,"AUTO"!=p&&"OFF"!=p&&"ON"!=p&&(g.b4w_render_shadows=p?"ON":"OFF"),p=g.b4w_render_reflections,"OFF"!=p&&"ON"!=p&&(g.b4w_render_reflections=p?"ON":"OFF"),p=g.b4w_render_refractions,
"AUTO"!=p&&"OFF"!=p&&"ON"!=p&&(g.b4w_render_refractions=p?"ON":"OFF"),"b4w_render_dynamic_grass"in g||(b("scene",g,"b4w_render_dynamic_grass"),g.b4w_render_dynamic_grass="AUTO"),g.b4w_nla_script&&f("scene",g,"b4w_nla_script"),"audio_distance_model"in g||(b("scene",g,"audio_distance_model"),g.audio_distance_model="INVERSE_CLAMPED");n=a.meshes;for(m=0;m<n.length;m++){g=n[m];g.b4w_boundings||(b("mesh",g,"b4w_boundings"),g.b4w_boundings={},c=g.b4w_boundings,c.bb=g.b4w_bounding_box?g.b4w_bounding_box:
{max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0},c.bb_src=g.b4w_bounding_box_source?g.b4w_bounding_box_source:g.b4w_bounding_box,c.bs_cen=g.b4w_bounding_sphere_center?g.b4w_bounding_sphere_center:[0,0,0],c.bc_cen=g.b4w_bounding_cylinder_center?g.b4w_bounding_cylinder_center:[0,0,0],c.be_cen=g.b4w_bounding_ellipsoid_center?g.b4w_bounding_ellipsoid_center:[0,0,0],g.b4w_bounding_ellipsoid_axes?c.be_ax=g.b4w_bounding_ellipsoid_axes:(p=c.bb,c.be_ax=[(p.max_x-p.min_x)/2,(p.max_y-p.min_y)/2,(p.max_z-p.min_z)/
2]),g.b4w_rotated_bounding_box?c.rbb=g.b4w_rotated_bounding_box:(p=c.bb,c.rbb={rbb_c:[(p.max_x+p.min_x)/2,(p.max_y+p.min_y)/2,(p.max_z+p.min_z)/2],rbb_s:[1,1,1]}),c.caxis_x=g.b4w_cov_axis_x?g.b4w_cov_axis_x:[1,0,0],c.caxis_y=g.b4w_cov_axis_y?g.b4w_cov_axis_y:[0,1,0],c.caxis_z=g.b4w_cov_axis_z?g.b4w_cov_axis_z:[0,0,1]);g.uv_textures||(b("mesh",g,"uv_textures"),g.uv_textures=[]);"b4w_shape_keys"in g||(g.b4w_shape_keys=[],b("mesh",g,"b4w_shape_keys"));c=!0;for(e=0;e<g.submeshes.length;e++){var q=g.submeshes[e];
"boundings"in q||(c=!1,q.boundings={be_ax:g.b4w_bounding_ellipsoid_axes,be_cen:g.b4w_bounding_ellipsoid_center,bb:{max_x:g.b4w_bounding_box.max_x,max_y:g.b4w_bounding_box.max_y,max_z:g.b4w_bounding_box.max_z,min_x:g.b4w_bounding_box.min_x,min_y:g.b4w_bounding_box.min_y,min_z:g.b4w_bounding_box.min_z}});"be_ax"in q.boundings||(q.boundings.be_ax=g.b4w_bounding_ellipsoid_axes);"be_cen"in q.boundings||(q.boundings.be_cen=g.b4w_bounding_ellipsoid_center);"bb"in q.boundings||(q.boundings.bb=g.b4w_bounding_box);
"rbb"in q.boundings||(p=g.b4w_bounding_box,q.boundings.rbb={rbb_c:[(p.max_x+p.min_x)/2,(p.max_y+p.min_y)/2,(p.max_z+p.min_z)/2],rbb_s:[1,1,1]});"caxis_x"in q.boundings||(q.boundings.caxis_x=[1,0,0]);"caxis_y"in q.boundings||(q.boundings.caxis_y=[0,1,0]);"caxis_z"in q.boundings||(q.boundings.caxis_z=[0,0,1])}c||b("mesh",g,"submesh_bd");p=g;c=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"];e=null;for(q=0;q<c.length;q++)p[c[q]]&&(e?
(p[c[q]]=!1,B.warn('WARNING property "'+c[q]+'" of object "'+p.name+'" has been set to "false". Foreground property "'+e+'" already exists.')):e=c[q]);for(p=0;p<g.b4w_vertex_anim.length;p++)c=g.b4w_vertex_anim[p],"allow_nla"in c||(b('mesh["b4w_vertex_anim"]',g,"allow_nla"),c.allow_nla=!0)}n=a.cameras;for(m=0;m<n.length;m++)g=n[m],g.type||(g.type="PERSP",b("camera",g,"type")),"b4w_eye_target_dist"in g&&(delete g.b4w_eye_target_dist,f("camera",g,"b4w_eye_target_dist")),"b4w_hover_zero_level"in g||(g.b4w_hover_zero_level=
0,b("camera",g,"b4w_hover_zero_level")),"b4w_trans_velocity"in g||(g.b4w_trans_velocity=1,b("camera",g,"b4w_trans_velocity")),"b4w_rot_velocity"in g||(g.b4w_rot_velocity=1,b("camera",g,"b4w_rot_velocity")),"b4w_zoom_velocity"in g||(g.b4w_zoom_velocity=.1,b("camera",g,"b4w_zoom_velocity")),"b4w_use_target_distance_limits"in g||(g.b4w_use_target_distance_limits=g.b4w_use_distance_limits||!1,b("camera",g,"b4w_use_target_distance_limits")),"b4w_use_zooming"in g||(g.b4w_use_zooming=g.b4w_use_distance_limits||
!1,b("camera",g,"b4w_use_zooming")),"b4w_distance_min"in g||(g.b4w_distance_min=1,b("camera",g,"b4w_distance_min")),"b4w_distance_max"in g||(g.b4w_distance_max=100,b("camera",g,"b4w_distance_max")),"b4w_horizontal_translation_min"in g||(g.b4w_horizontal_translation_min=-100,b("camera",g,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in g||(g.b4w_horizontal_translation_max=100,b("camera",g,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in g||(g.b4w_vertical_translation_min=
-100,b("camera",g,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in g||(g.b4w_vertical_translation_max=100,b("camera",g,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in g||(g.b4w_use_horizontal_clamping=!1,b("camera",g,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in g||(g.b4w_rotation_left_limit=-Math.PI,b("camera",g,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in g||(g.b4w_rotation_right_limit=Math.PI,b("camera",g,"b4w_rotation_right_limit")),
"b4w_horizontal_clamping_type"in g||(g.b4w_horizontal_clamping_type="LOCAL",b("camera",g,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in g||(g.b4w_use_vertical_clamping=!1,b("camera",g,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in g||(g.b4w_rotation_down_limit=-Math.PI/2,b("camera",g,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in g||(g.b4w_rotation_up_limit=Math.PI/2,b("camera",g,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in g||(g.b4w_vertical_clamping_type=
"LOCAL",b("camera",g,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in g||(g.b4w_hover_angle_min=Math.PI/6,b("camera",g,"b4w_hover_angle_min")),"b4w_hover_angle_max"in g||(g.b4w_hover_angle_max=Math.PI/6,b("camera",g,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in g||(g.b4w_enable_hover_hor_rotation=!0,b("camera",g,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in g||(g.b4w_use_panning=!0,b("camera",g,"b4w_use_panning")),"b4w_use_pivot_limits"in g||(g.b4w_use_pivot_limits=!1,g.b4w_pivot_z_min=
0,g.b4w_pivot_z_max=10,b("camera",g,"b4w_use_pivot_limits")),"b4w_dof_bokeh"in g||(g.b4w_dof_bokeh=!1,b("camera",g,"b4w_dof_bokeh")),"b4w_dof_bokeh_intensity"in g||(g.b4w_dof_bokeh_intensity=.3,b("camera",g,"b4w_dof_bokeh_intensity")),"b4w_dof_foreground_blur"in g||(g.b4w_dof_foreground_blur=!1,b("camera",g,"b4w_dof_foreground_blur")),"b4w_dof_front_start"in g||(g.b4w_dof_front_start=0,b("camera",g,"b4w_dof_front_start")),"b4w_dof_front_end"in g||(g.b4w_dof_front_end=g.b4w_dof_front,b("camera",g,
"b4w_dof_front_end")),"b4w_dof_rear_start"in g||(g.b4w_dof_rear_start=0,b("camera",g,"b4w_dof_rear_start")),"b4w_dof_rear_end"in g||(g.b4w_dof_rear_end=g.b4w_dof_rear,b("camera",g,"b4w_dof_rear_end"));n=a.lamps;for(m=0;m<n.length;m++)g=n[m],"b4w_generate_shadows"in g||(g.b4w_generate_shadows=!1,b("lamp",g,"b4w_generate_shadows")),"b4w_dynamic_intensity"in g||(g.b4w_dynamic_intensity=!1,b("lamp",g,"b4w_dynamic_intensity")),"use_diffuse"in g||(g.use_diffuse=!0,b("lamp",g,"use_diffuse")),"use_specular"in
g||(g.use_specular=!0,b("lamp",g,"use_specular")),"clip_start"in g||(g.clip_start=.1,b("lamp",g,"clip_start")),"clip_end"in g||(g.clip_end=30,b("lamp",g,"clip_end")),"POINT"!=g.type&&"SPOT"!=g.type||"use_sphere"in g||(g.use_sphere=!1,b("lamp",g,"use_sphere"));n=a.speakers;for(m=0;m<n.length;m++)g=n[m],"b4w_behavior"in g||(g.b4w_behavior=g.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_auto_play"in g||(g.b4w_auto_play=!1,b("speaker",g,"b4w_auto_play")),"b4w_enable_doppler"in g||(g.b4w_enable_doppler=
!1,b("speaker",g,"b4w_enable_doppler")),"b4w_delay"in g||(g.b4w_delay=0),"b4w_delay_random"in g||(g.b4w_delay_random=0),"b4w_volume_random"in g||(g.b4w_volume_random=0),"b4w_pitch_random"in g||(g.b4w_pitch_random=0),"b4w_fade_in"in g||(g.b4w_fade_in=0),"b4w_fade_out"in g||(g.b4w_fade_out=0),"b4w_loop"in g||(g.b4w_loop=!1),"b4w_loop_start"in g||(g.b4w_loop_start=0,b("speaker",g,"b4w_loop_start")),"b4w_loop_end"in g||(g.b4w_loop_end=0,b("speaker",g,"b4w_loop_end")),g.animation_data&&h(g.animation_data);
n=a.textures;for(m=0;m<n.length;m++)g=n[m],"b4w_anisotropic_filtering"in g||(g.b4w_anisotropic_filtering="OFF",b("texture",g,"b4w_anisotropic_filtering")),"b4w_water_foam"in g||(g.b4w_water_foam=!1,b("texture",g,"b4w_water_foam")),"b4w_foam_uv_freq"in g||(g.b4w_foam_uv_freq=[1,1],b("texture",g,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in g||(g.b4w_foam_uv_magnitude=[1,1],b("texture",g,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in g||(g.b4w_parallax_steps=5,b("material",g,"b4w_parallax_steps")),
"b4w_parallax_lod_dist"in g||(g.b4w_parallax_lod_dist=10,b("material",g,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in g||(g.b4w_shore_dist_map=!1,b("texture",g,"b4w_shore_dist_map")),"b4w_shore_boundings"in g||(g.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",g,"b4w_shore_boundings")),"b4w_max_shore_dist"in g||(g.b4w_max_shore_dist=100,b("texture",g,"b4w_max_shore_dist")),"b4w_disable_compression"in g||(g.b4w_disable_compression=!1,b("texture",g,"b4w_disable_compression")),"b4w_source_type"in
g||(g.b4w_source_type="",b("texture",g,"b4w_source_type")),"b4w_source_id"in g||(g.b4w_source_id="",b("texture",g,"b4w_source_id")),"b4w_source_size"in g||(g.b4w_source_size=1024,b("texture",g,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in g||(g.b4w_enable_canvas_mipmapping=!0,b("texture",g,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in g||(g.b4w_nla_video=!1,b("texture",g,"b4w_nla_video"));n=a.images;for(m=0;m<n.length;m++)g=n[m],"colorspace_settings_name"in g||(g.colorspace_settings_name=
"sRGB",b("image",g,"colorspace_settings_name"));c=a.materials;for(m=0;m<c.length;m++){e=c[m];"ALPHA_ANTIALIASING"==e.game_settings.alpha_blend&&(e.game_settings.alpha_blend="CLIP");"use_tangent_shading"in e||(e.use_tangent_shading=!1,b("material",e,"use_tangent_shading"));"b4w_node_mat_type"in e&&f("material",e,"b4w_node_mat_type");"b4w_skydome"in e&&f("material",e,"b4w_skydome");"b4w_procedural_skydome"in e&&f("material",e,"b4w_procedural_skydome");"b4w_lens_flares"in e||(e.b4w_lens_flares=!1,b("material",
e,"b4w_lens_flares"));"LENS_FLARES"===e.name&&(e.b4w_lens_flares||B.warn('"LENS_FLARES" material name has been found. Enable the "Lens Flare" property for this material.'),e.b4w_lens_flares=!0);e.b4w_water&&("b4w_water_shore_smoothing"in e||(e.b4w_water_shore_smoothing=!1,b("material",e,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in e||(e.b4w_water_dynamic=!1,b("material",e,"b4w_water_dynamic")),"b4w_waves_height"in e||(e.b4w_waves_height=1,b("material",e,"b4w_waves_height")),"b4w_waves_length"in
e||(e.b4w_waves_length=1,b("material",e,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in e||(e.b4w_water_dst_noise_scale0=.05,b("material",e,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in e||(e.b4w_water_dst_noise_scale1=.03,b("material",e,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in e||(e.b4w_water_dst_noise_freq0=1.3,b("material",e,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in e||(e.b4w_water_dst_noise_freq1=1,b("material",e,"b4w_water_dst_noise_freq1")),
"b4w_water_dir_min_shore_fac"in e||(e.b4w_water_dir_min_shore_fac=.4,b("material",e,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in e||(e.b4w_water_dir_freq=.5,b("material",e,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in e||(e.b4w_water_dir_noise_scale=.05,b("material",e,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in e||(e.b4w_water_dir_noise_freq=.07,b("material",e,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in e||(e.b4w_water_dir_min_noise_fac=.5,b("material",
e,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in e||(e.b4w_water_dst_min_fac=.2,b("material",e,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in e||(e.b4w_water_waves_hor_fac=5,b("material",e,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in e||(e.b4w_water_absorb_factor=6,b("material",e,"b4w_water_absorb_factor")),"b4w_water_fog_color"in e||(e.b4w_water_fog_color=[.5,.7,.7],b("material",e,"b4w_water_fog_color")),"b4w_foam_factor"in e||(e.b4w_foam_factor=5,b("material",e,"b4w_foam_factor")),
"b4w_generated_mesh"in e||(e.b4w_generated_mesh=!1,b("material",e,"b4w_generated_mesh")),"b4w_water_num_cascads"in e||(e.b4w_water_num_cascads=5,b("material",e,"b4w_water_num_cascads")),"b4w_water_subdivs"in e||(e.b4w_water_subdivs=64,b("material",e,"b4w_water_subdivs")),"b4w_water_detailed_dist"in e||(e.b4w_water_detailed_dist=1E3,b("material",e,"b4w_water_detailed_dist")),"b4w_water_enable_caust"in e||(e.b4w_water_enable_caust=!1,b("material",e,"b4w_water_enable_caust")),"b4w_water_caust_scale"in
e||(e.b4w_water_caust_scale=.25,b("material",e,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in e||(e.b4w_water_caust_brightness=.5,b("material",e,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in e||(e.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in e||(e.b4w_dynamic_grass_color="");"diffuse_intensity"in e||(e.diffuse_intensity=1,b("material",e,"diffuse_intensity"));"b4w_use_ghost"in e||(e.b4w_use_ghost=!1);"b4w_collision_margin"in e||(e.b4w_collision_margin=.04,b("material",
e,"b4w_collision_margin"));"b4w_collision_group"in e||(e.b4w_collision_group=128,b("material",e,"b4w_collision_group"));"b4w_collision_mask"in e||(e.b4w_collision_mask=127,b("material",e,"b4w_collision_mask"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1,b("material",e,"b4w_do_not_render"));"HALO"!=e.type||"b4w_halo_sky_stars"in e||(e.b4w_halo_sky_stars=!1,b("material",e,"b4w_halo_sky_stars"));"HALO"!=e.type||"b4w_halo_stars_blend_height"in e||(e.b4w_halo_stars_blend_height=10,b("material",e,
"b4w_halo_stars_blend_height"));"HALO"!=e.type||"b4w_halo_stars_min_height"in e||(e.b4w_halo_stars_min_height=0,b("material",e,"b4w_halo_stars_min_height"));"specular_shader"in e||(e.specular_shader="COOKTORR",b("material",e,"specular_shader"));"diffuse_shader"in e||(e.diffuse_shader="LAMBERT",b("material",e,"diffuse_shader"));"roughness"in e||(e.roughness=.5,b("material",e,"roughness"));"diffuse_fresnel"in e||(e.diffuse_fresnel=.1,b("material",e,"diffuse_fresnel"));"diffuse_fresnel_factor"in e||
(e.diffuse_fresnel_factor=.5,b("material",e,"diffuse_fresnel_factor"));"specular_slope"in e||(e.specular_slope=.2,b("material",e,"specular_slope"));"specular_toon_size"in e||(e.specular_toon_size=.5,b("material",e,"specular_toon_size"));"specular_toon_smooth"in e||(e.specular_toon_smooth=.1,b("material",e,"specular_toon_smooth"));"specular_alpha"in e||(e.specular_alpha=1,b("material",e,"specular_alpha"));"b4w_wettable"in e||(e.b4w_wettable=!1,b("material",e,"b4w_wettable"));"b4w_refractive"in e||
(e.b4w_refractive=!1,b("material",e,"b4w_refractive"));"b4w_refr_bump"in e||(e.b4w_refr_bump=0,b("material",e,"b4w_refr_bump"));"b4w_shallow_water_col"in e||(e.b4w_shallow_water_col=[0,.8,.3],b("material",e,"b4w_shallow_water_col"));"b4w_shore_water_col"in e||(e.b4w_shore_water_col=[0,.9,.2],b("material",e,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in e||(e.b4w_shallow_water_col_fac=1,b("material",e,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in e||(e.b4w_shore_water_col_fac=.5,
b("material",e,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in e||(e.b4w_water_sss_strength=5.9,b("material",e,"b4w_water_sss_strength"));"b4w_water_sss_width"in e||(e.b4w_water_sss_width=.45,b("material",e,"b4w_water_sss_width"));"b4w_render_above_all"in e||(e.b4w_render_above_all=!1,b("material",e,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in e||(e.b4w_water_norm_uv_velocity=.05,b("material",e,"b4w_water_norm_uv_velocity"));"specular_ior"in e||(e.specular_ior=1,b("material",e,"specular_ior"));
"darkness"in e||(e.darkness=0,b("material",e,"darkness"));"diffuse_toon_size"in e||(e.diffuse_toon_size=0,b("material",e,"diffuse_toon_size"));"diffuse_toon_smooth"in e||(e.diffuse_toon_smooth=0,b("material",e,"diffuse_toon_smooth"));n=e.texture_slots;for(p=0;p<n.length;p++)g=n[p],"blend_type"in g||(g.blend_type="MIX",b("texture_slot",g,"blend_type"));if(e.node_tree){n=e.node_tree.nodes;for(p=0;p<n.length;p++)u(n[p]);e.node_tree.animation_data&&h(e.node_tree.animation_data)}}g=a.node_groups;for(m=
0;m<g.length;m++)for(n=g[m].node_tree.nodes,p=0;p<n.length;p++)u(n[p]);n=a.objects;for(m=0;m<n.length;m++){g=n[m];switch(g.type){case "MESH":"b4w_dynamic_geometry"in g||(g.b4w_dynamic_geometry=!1);"b4w_reflexible"in g||(g.b4w_reflexible=!1);"b4w_reflexible_only"in g||(g.b4w_reflexible_only=!1);"b4w_reflective"in g||(g.b4w_reflective=!1);"b4w_reflection_type"in g||(g.b4w_reflection_type="PLANE",b("object",g,"b4w_reflection_type"));"b4w_wind_bending"in g||(g.b4w_wind_bending=!1,b("object",g,"b4w_wind_bending"));
"b4w_wind_bending_angle"in g||(g.b4w_wind_bending_angle=10,g.b4w_wind_bending_freq=.25,b("object",g,"wind bending params"));"b4w_detail_bending_amp"in g||(g.b4w_detail_bending_amp=.1,g.b4w_branch_bending_amp=.3,b("object",g,"detail bending params"));"b4w_detail_bending_freq"in g||(g.b4w_detail_bending_freq=1,b("object",g,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in g||(g.b4w_main_bend_stiffness_col="",b("object",g,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in g||(g.b4w_detail_bend_colors=
{leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",g,"b4w_detail_bend_colors"));"b4w_caustics"in g||(g.b4w_caustics=!1);"vertex_groups"in g&&g.vertex_groups.length&&g.data&&0==g.data.vertex_groups.length&&(g.data.vertex_groups=g.vertex_groups,delete g.vertex_groups,b("object",g,"vertex_groups"));"b4w_vertex_anim"in g&&g.b4w_vertex_anim.length&&g.data&&0==g.data.b4w_vertex_anim.length&&(g.data.b4w_vertex_anim=g.b4w_vertex_anim,delete g.b4w_vertex_anim,b("object",g,"b4w_vertex_anim"));
"b4w_do_not_render"in g||(g.b4w_do_not_render=!1);"b4w_hidden_on_load"in g||(g.b4w_hidden_on_load=!1);"use_ghost"in g.game||(g.game.use_ghost=!1);"use_sleep"in g.game||(g.game.use_sleep=!1);"velocity_min"in g.game||(g.game.velocity_min=0);"velocity_max"in g.game||(g.game.velocity_max=0);"collision_group"in g.game||(g.game.collision_group=1);"collision_mask"in g.game||(g.game.collision_mask=255);p=g;c=p.game;e=c.collision_bounds_type;c.use_collision_bounds&&"BOX"!=e&&"CYLINDER"!=e&&"CONE"!=e&&"SPHERE"!=
e&&"CAPSULE"!=e&&"EMPTY"!=e&&(B.error("Wrong collision bounds type "+e+". Disable physics for object "+p.name),p.b4w_collision=!1,p.b4w_floating=!1,p.b4w_vehicle=!1,p.b4w_character=!1);"b4w_vehicle_settings"in g?g.b4w_vehicle_settings&&("steering_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.steering_ratio=10),"steering_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.steering_max=1),"inverse_control"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.inverse_control=!1),"force_max"in
g.b4w_vehicle_settings||(g.b4w_vehicle_settings.force_max=1500),"brake_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.brake_max=100),"speed_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_compression=
4.4),"suspension_stiffness"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in g.b4w_vehicle_settings||
(g.b4w_vehicle_settings.floating_factor=3),"floating_factor"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_rot_damp=.9)):(g.b4w_vehicle_settings=null,b("object",g,"b4w_vehicle_settings"));"b4w_floating_settings"in g?g.b4w_floating_settings&&("floating_factor"in g.b4w_floating_settings||(g.b4w_floating_settings.floating_factor=
3),"water_lin_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_rot_damp=.8)):(g.b4w_floating_settings=null,b("object",g,"b4w_floating_settings"));"b4w_character_settings"in g?g.b4w_character_settings&&("walk_speed"in g.b4w_character_settings||(g.b4w_character_settings.walk_speed=4),"run_speed"in g.b4w_character_settings||(g.b4w_character_settings.run_speed=8),"step_height"in g.b4w_character_settings||
(g.b4w_character_settings.step_height=.25),"jump_strength"in g.b4w_character_settings||(g.b4w_character_settings.jump_strength=5),"waterline"in g.b4w_character_settings||(g.b4w_character_settings.waterline=0)):(g.b4w_character_settings=null,b("object",g,"b4w_character_settings"));"b4w_selectable"in g||(g.b4w_selectable=!1,b("object",g,"b4w_selectable"));"b4w_outlining"in g||(g.b4w_outlining=!1,b("object",g,"b4w_outlining"));"b4w_outline_on_select"in g||(g.b4w_outline_on_select=!1,b("object",g,"b4w_outline_on_select"));
"b4w_billboard"in g||(g.b4w_billboard=!1,b("object",g,"b4w_billboard"));"b4w_billboard_geometry"in g||(g.b4w_billboard_geometry="SPHERICAL",b("object",g,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in g||(g.b4w_pres_glob_orientation=!1,b("object",g,"b4w_pres_glob_orientation"));"b4w_outline_settings"in g||("b4w_glow_settings"in g?g.b4w_outline_settings=g.b4w_glow_settings:(g.b4w_outline_settings={},g.b4w_outline_settings.outline_duration=1,g.b4w_outline_settings.outline_period=1,g.b4w_outline_settings.outline_relapses=
0),b("object",g,"b4w_outline_settings"));"b4w_lod_transition"in g||(g.b4w_lod_transition=.01,b("object",g,"b4w_lod_transition"));"lod_levels"in g||(g.lod_levels=[],b("object",g,"lod_levels"));"b4w_animation_mixing"in g||(g.b4w_animation_mixing=!1,b("object",g,"b4w_animation_mixing"));break;case "EMPTY":"b4w_anchor"in g||(g.b4w_anchor=null,b("object",g,"b4w_anchor")),!g.b4w_anchor||"max_width"in g.b4w_anchor||(g.b4w_anchor.max_width=250)}"collision_margin"in g.game||(g.game.collision_margin=.04,b("object",
g,"collision_margin"));"b4w_anim_behavior"in g||(g.b4w_anim_behavior=g.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",g,"b4w_anim_behavior"));if(!("rotation_quaternion"in g)){p=[0,0,0,1];k.euler_to_quat(g.rotation_euler,p);var c=p,e=p[0],q=p[1],A=p[2];c[0]=p[3];c[1]=e;c[2]=q;c[3]=A;g.rotation_quaternion=p;b("object",g,"rotation_quaternion")}"webgl_do_not_batch"in g&&(g.b4w_do_not_batch=g.webgl_do_not_batch)&&f("object",g,"webgl_do_not_batch");"b4w_shadow_cast_only"in g||(g.b4w_shadow_cast_only=
!1,b("object",g,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in g||(g.b4w_correct_bounding_offset="AUTO",b("object",g,"b4w_correct_bounding_offset"));c=g.particle_systems;for(p=0;p<c.length;p++)e=c[p],q=e.settings,"use_rotation_dupli"in q||(q.use_rotation_dupli=!1,b("particle_settings",q,"use_rotation_dupli")),"use_whole_group"in q||(q.use_whole_group=!1,b("particle_settings",q,"use_whole_group")),e.transforms||(e.transforms=new Float32Array,b("particle_system",e,"transforms")),"b4w_billboard_align"in
q||(q.b4w_billboard_align="VIEW",b("particle_settings",q,"b4w_billboard_align")),"b4w_dynamic_grass"in q||(q.b4w_dynamic_grass=!1,b("object",q,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in q||(q.b4w_dynamic_grass_scale_threshold=.01,b("object",q,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in q||(q.b4w_initial_rand_rotation=!1,b("particle_settings",q,"b4w_initial_rand_rotation")),"b4w_rotation_type"in q||(q.b4w_rotation_type="Z",b("particle_settings",q,"b4w_rotation_type")),
"b4w_rand_rotation_strength"in q||(q.b4w_rand_rotation_strength=1,b("particle_settings",q,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in q||(q.b4w_hair_billboard=!1,b("particle_settings",q,"b4w_hair_billboard")),"b4w_hair_billboard_type"in q||(q.b4w_hair_billboard_type="BASIC",b("particle_settings",q,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in q||(q.b4w_hair_billboard_jitter_amp=0,b("particle_settings",q,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in
q||(q.b4w_hair_billboard_jitter_freq=0,b("particle_settings",q,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in q||(q.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",q,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in q||(q.b4w_wind_bend_inheritance="PARENT",b("particle_settings",q,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in q||(q.b4w_shadow_inheritance="PARENT",b("particle_settings",q,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in
q||(q.b4w_reflection_inheritance="PARENT",b("particle_settings",q,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in q||(q.b4w_vcol_from_name="",b("particle_settings",q,"b4w_vcol_from_name")),"b4w_vcol_to_name"in q||(q.b4w_vcol_to_name="",b("particle_settings",q,"b4w_vcol_to_name")),"b4w_coordinate_system"in q||(q.b4w_coordinate_system="LOCAL",b("particle_settings",q,"b4w_coordinate_system")),"b4w_allow_nla"in q||(q.b4w_allow_nla=!0,b("particle_settings",q,"b4w_allow_nla")),"b4w_enable_soft_particles"in
q||(q.b4w_enable_soft_particles=!1,b("particle_settings",q,"b4w_enable_soft_particles")),"b4w_particles_softness"in q||(q.b4w_particles_softness=1,b("particle_settings",q,"b4w_particles_softness")),"billboard_tilt"in q||(q.billboard_tilt=0,b("particle_settings",q,"billboard_tilt")),"billboard_tilt_random"in q||(q.billboard_tilt_random=0,b("particle_settings",q,"billboard_tilt_random")),"use_rotations"in q||(q.use_rotations=!1,b("particle_settings",q,"use_rotations"));"constraints"in g||(g.constraints=
[],b("object",g,"constraints"));c=g.modifiers;for(p=0;p<c.length;p++){a:{e=c[p];switch(e.type){case "ARRAY":if(!("fit_type"in e)){B.error("WARNING Incomplete modifier "+String(e.type)+' for "'+g.name+'", reexport "'+a.b4w_filepath_blend+'" scene');e=!1;break a}}e=!0}e||(c.splice(p,1),p--)}"animation_data"in g||(g.animation_data={action:null,nla_tracks:[]},b("object",g,"animation_data"));g.animation_data&&("action"in g.animation_data||(g.animation_data.action=null,l("no action in animation data "+
g.name)),"nla_tracks"in g.animation_data||(g.animation_data.nla_tracks=[],l("no NLA in animation data "+g.name)),h(g.animation_data));"b4w_collision_id"in g||(g.b4w_collision_id="",b("object",g,"b4w_collision_id"));"b4w_viewport_alignment"in g||(g.b4w_viewport_alignment=null,b("object",g,"b4w_viewport_alignment"));"pinverse_tsr"in g||(g.pinverse_tsr=null,b("object",g,"pinverse_tsr"));"b4w_cluster_data"in g||(g.b4w_cluster_data={cluster_id:-1},b("object",g,"b4w_cluster_data"));(0>g.scale[0]||0>g.scale[1]||
0>g.scale[2])&&l('negative scale for object "'+g.name+'", can lead to some errors');c=g.scale;0==c[0]&&0==c[1]&&0==c[2]?p=!0:(p=Math.abs((c[0]-c[1])/c[0]),c=Math.abs((c[1]-c[2])/c[1]),p=.005>p&&.005>c);p||l("non-uniform scale for object "+g.name)}for(var v in z)m=z[v],n=v.match(/.*?(?=>>|$)/i)[0],B.warn('Property "'+String(n)+'" is '+m.report_type+' for "'+m.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.check_anim_fcurve_completeness=function(a,b){"num_channels"in a||(a.num_channels=1,
l('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.apply_mesh_modifiers=function(a){var b;a:{b=a.modifiers;for(var f=0;f<b.length;f++){var h=b[f].type;if("ARRAY"==h||"CURVE"==h){b=!0;break a}}b=!1}if(!b)return null;b=q(a.data,a.data.name+"_MOD");a=a.modifiers;for(f=0;f<a.length;f++){var l=a[f];switch(l.type){case "ARRAY":for(var h=b,B=l,g=0,H=0,v=0,w=new Float32Array(16),l=[],z=1;z<B.count;z++){B.use_constant_offset&&(g+=B.constant_offset_displace[0],
H+=B.constant_offset_displace[1],v+=B.constant_offset_displace[2]);if(B.use_relative_offset)var r=h.b4w_bounding_box,g=g+(r.max_x-r.min_x)*B.relative_offset_displace[0],H=H+(r.max_y-r.min_y)*B.relative_offset_displace[1],v=v+(r.max_z-r.min_z)*B.relative_offset_displace[2];k.trans_matrix(g,H,v,w);for(var E=r=q(h),u=w,T=A.fromMat4(u,y),T=c.fromMat3(T,D),W=0;W<E.submeshes.length;W++){var ha=E.submeshes[W];k.positions_multiply_matrix(ha.position,u,ha.position,0);k.quats_multiply_quat(ha.tbn_quat,T,ha.tbn_quat,
0)}l.push(r)}for(z=0;z<l.length;z++)for(B=h,g=l[z],H=0;H<B.submeshes.length;H++){v=B.submeshes[H];w=g.submeshes[H];r=v.base_length;E=v.indices.length;v.base_length+=w.base_length;for(var Y in v)if("base_length"!=Y&&"boundings"!=Y)if("indices"==Y)for(v[Y]=k.uint32_concat(v[Y],w[Y]),u=E;u<v.indices.length;u++)v.indices[u]+=r;else"vertex_colors"!=Y&&(v[Y]=k.float32_concat(v[Y],w[Y]))}break;case "CURVE":for(h=b,z=n.create_spline(l.object),B=new Float32Array(16),H=z.is_3d?4:3,g=new Float32Array(H),H=new Float32Array(H),
v=new Float32Array(3),w=new Float32Array(4),r=new Float32Array(4),E=new Float32Array(3),u=new Float32Array(3),T=new Float32Array(3),new Float32Array(4),new Float32Array(4),W=0;W<h.submeshes.length;W++){var Z=h.submeshes[W],ha=Z.position,Z=Z.tbn_quat,N;a:{N=l.deform_axis;switch(N){case "POS_X":case "NEG_X":N=0;break a;case "POS_Y":case "NEG_Y":N=1;break a;case "POS_Z":case "NEG_Z":N=2;break a;default:k.panic("Wrong deform axis value "+N)}N=void 0}E[0]=0;E[1]=0;E[2]=0;E[N]=1;for(var ca=n.spline_length(z),
I=0;I<ha.length/3;I++){T[0]=ha[3*I];T[1]=ha[3*I+1];T[2]=ha[3*I+2];var ma=T[N],da=n.spline_len_to_t(z,ma);n.spline_point(z,da,g);v[0]=g[0];v[1]=g[1];v[2]=g[2];n.spline_derivative(z,da,H);u[0]=H[0];u[1]=0;u[2]=H[2];m.normalize(u,u);c.rotationTo(E,u,w);0>ma?(g[0]=u[0],g[1]=u[1],g[2]=u[2],m.scale(g,ma,g),m.add(v,g,v)):ma>ca&&(g[0]=u[0],g[1]=u[1],g[2]=u[2],m.scale(g,ma-ca,g),m.add(v,g,v));p.fromRotationTranslation(w,v,B);z.is_3d&&(c.setAxisAngle(E,g[3],r),m.transformQuat(T,r,T));T[N]=0;m.transformMat4(T,
B,T);ha[3*I]=T[0];ha[3*I+1]=T[1];ha[3*I+2]=T[2];Z.length&&(D[0]=Z[4*I],D[1]=Z[4*I+1],D[2]=Z[4*I+2],D[3]=Z[4*I+3],c.multiply(D,w,D),Z[4*I]=D[0],Z[4*I+1]=D[1],Z[4*I+2]=D[2],Z[4*I+3]=D[3])}}}e.recalculate_mesh_boundings(b)}return b};a.create_material=function(a){return{name:a,uuid:k.gen_uuid(),use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:.8,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},
specular_alpha:1,specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_refr_bump:0,b4w_refractive:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,
b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.assign_logic_nodes_object_params=function(a,b,c){function e(b,
c){for(var d in b){var g=b[d],k=g[0];if(1<g.length)for(var f=1;f<g.length;f++)k+="*"+g[f];for(f=0;f<a.length;f++)if(g=a[f],g.name==k)for(var h in c)g[h]=c[h]}}b=c.b4w_logic_nodes;for(var k=0;k<b.length;k++)for(var f=b[k],g=0;g<f.length;g++){var h=f[g],m={register1:"variable1",register2:"variable2",registerd:"variabled"},n;for(n in m)n in h&&(h[m[n]]=h[n]);for(var p in h.variables)"boolean"!=typeof h.variables[p][0]&&(h.variables[p]=[!1,h.variables[p]]);0<=["MATH","CONDJUMP","PAGEPARAM","REGSTORE"].indexOf(h.type)&&
("variable1"in h&&(h.variables.v1=[!1,h.variable1]),"variable2"in h&&(h.variables.v2=[!1,h.variable2]),"variabled"in h&&(h.variables.vd=[!1,h.variabled]));switch(h.type){case "SELECT":for(var q=0;q<a.length;q++)m=a[q],m.name==h.object&&(m.b4w_selectable=!0);h.bools||(h.bools={});h.bools.not_wait||(h.bools.not_wait=!1);l('Logic nodes type "SELECT" is deprecated');break;case "SWITCH_SELECT":e(h.objects_paths,{b4w_selectable:!0});if(h.links instanceof Array){l('Format of a "SWITCH_SELECT" node is outdated. It is recommended to reexport the scene "'+
c.name+'"');var m={},B=0;for(q in h.objects_paths)m[q]=h.links[B],B++;h.links=m}break;case "SELECT_PLAY":l('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport the scene "'+c.name+'"');h.mute=!0;break;case "SELECT_PLAY_ANIM":l('Logic nodes type "SELECT_PLAY_ANIM" is deprecated');break;case "SHOW":case "HIDE":case "SET_SHADER_NODE_PARAM":case "INHERIT_MAT":e(h.objects_paths,{b4w_do_not_batch:!0});break;case "PLAY":c.b4w_use_nla=!0;break;case "MOVE_TO":e(h.objects_paths,
{b4w_do_not_batch:!0});break;case "TRANSFORM_OBJECT":e(h.objects_paths,{b4w_do_not_batch:!0});switch(h.common_usage_names.space_type){case "WORLD":h.common_usage_names.space_type=E.NST_WORLD;break;case "PARENT":h.common_usage_names.space_type=E.NST_PARENT;break;case "LOCAL":h.common_usage_names.space_type=E.NST_LOCAL}break;case "OUTLINE":e(h.objects_paths,{b4w_outlining:!0});break;case "CONDJUMP":h.condition&&(h.common_usage_names.condition=h.condition);if("cnd"in h.floats)h.common_usage_names.condition=
h.floats.cnd;else switch(h.common_usage_names.condition){case "GEQUAL":h.common_usage_names.condition=E.NC_GEQUAL;break;case "LEQUAL":h.common_usage_names.condition=E.NC_LEQUAL;break;case "GREATER":h.common_usage_names.condition=E.NC_GREATER;break;case "LESS":h.common_usage_names.condition=E.NC_LESS;break;case "NOTEQUAL":h.common_usage_names.condition=E.NC_NOTEQUAL;break;case "EQUAL":h.common_usage_names.condition=E.NC_EQUAL}void 0!=h.number1&&(h.input1=h.number1);void 0!=h.number2&&(h.input2=h.number2);
h.bools||(h.bools={});void 0===h.bools.str&&(h.bools.str=!1,h.floats.inp1=h.input1,h.floats.inp2=h.input2);break;case "SEND_REQ":h.bools||(h.bools={});h.strings||(h.strings={});void 0===h.bools.ct&&(h.bools.ct=!1);void 0!=h.url&&(h.bools.url=!1,h.strings.url=h.url);break;case "MATH":void 0!=h.number1&&(h.input1=h.number1);void 0!=h.number2&&(h.input2=h.number2);void 0!=h.input1&&(h.floats.inp1=h.input1);void 0!=h.input2&&(h.floats.inp2=h.input2);break;case "REGSTORE":h.floats||(h.floats={});h.strings||
(h.strings={});void 0!=h.number1&&(h.input1=h.number1);if(void 0!=h.input1)switch(typeof h.input1){case "number":h.floats.inp1=h.input1;h.common_usage_names.variable_type="NUMBER";break;default:h.strings.inp1=h.input1,h.common_usage_names.variable_type="STRING"}switch(h.common_usage_names.variable_type){case "NUMBER":h.common_usage_names.variable_type=E.NT_NUMBER;break;case "STRING":h.common_usage_names.variable_type=E.NT_STRING}break;case "PAGEPARAM":h.bools||(h.bools={});void 0===h.bools.hsh&&(h.bools.hsh=
!1);h.floats||(h.floats={});void 0===h.floats.ptp&&(h.floats.ptp=0);break;case "PLAY_ANIM":e(h.objects_paths,{b4w_do_not_batch:!0});h.bools||(h.bools={});void 0===h.bools.env&&(h.bools.env=!1);(m=h.common_usage_names.param_anim_behavior)||(m="FINISH_STOP");h.common_usage_names.param_anim_behavior=w.anim_behavior_bpy_b4w(m);break;case "STOP_ANIM":h.bools||(h.bools={});void 0===h.bools.env&&(h.bools.env=!1);break;case "STRING":switch(h.common_usage_names.string_operation){case "JOIN":h.common_usage_names.string_operation=
E.NSO_JOIN;break;case "FIND":h.common_usage_names.string_operation=E.NSO_FIND;break;case "REPLACE":h.common_usage_names.string_operation=E.NSO_REPLACE;break;case "SPLIT":h.common_usage_names.string_operation=E.NSO_SPLIT;break;case "COMPARE":h.common_usage_names.string_operation=E.NSO_COMPARE}if("cnd"in h.floats)h.common_usage_names.condition=h.floats.cnd;else switch(h.common_usage_names.condition){case "GEQUAL":h.common_usage_names.condition=E.NC_GEQUAL;break;case "LEQUAL":h.common_usage_names.condition=
E.NC_LEQUAL;break;case "GREATER":h.common_usage_names.condition=E.NC_GREATER;break;case "LESS":h.common_usage_names.condition=E.NC_LESS;break;case "NOTEQUAL":h.common_usage_names.condition=E.NC_NOTEQUAL;break;case "EQUAL":h.common_usage_names.condition=E.NC_EQUAL}break;case "REDIRECT":void 0!=h.url&&(h.bools.url=!1,h.strings.url=h.url);break;case "SET_CAMERA_MOVE_STYLE":switch(h.common_usage_names.camera_move_style){case "STATIC":h.common_usage_names.camera_move_style=E.NCMS_STATIC;break;case "TARGET":h.common_usage_names.camera_move_style=
E.NCMS_TARGET;break;case "EYE":h.common_usage_names.camera_move_style=E.NCMS_EYE;break;case "HOVER":h.common_usage_names.camera_move_style=E.NCMS_HOVER}break;case "ENTRYPOINT":h.bools||(h.bools={});void 0===h.bools.js&&(h.bools.js=!1);h.bools.js&&(h.mute=!0);break;case "JS_CALLBACK":for(n in h=h.common_usage_names.js_cb_params,h)switch(h[n]){case "OBJECT":h[n]=E.NCPT_OBJECT;break;case "VARIABLE":h[n]=E.NCPT_VARIABLE}}}}};b4w.module.__scenegraph=function(a,r){function u(a,b){var c=[];G.traverse_edges(a,function(b,d,e){-1<c.indexOf(e)?G.replace_edge_attr(a,b,d,e,y(e)):c.push(e)});G.traverse(a,function(a,d){for(var e=0;e<d.slinks_internal.length;e++){var g=d.slinks_internal[e];b||d.type!=L.MAIN_PLANE_REFLECT&&d.type!=L.MAIN_CUBE_REFLECT&&d.type!=L.MAIN_XRAY||(g.use_renderbuffer=!0);-1<c.indexOf(g)?d.slinks_internal[e]=y(g):c.push(g)}})}function h(a,c){G.traverse(a,function(b,d){d.type==L.ANTIALIASING&&G.traverse_inputs(a,
b,function(a,b,c){if(b.type==L.MOTION_BLUR)for(a=0;a<b.slinks_internal.length;a++)c=b.slinks_internal[a],c.min_filter=F.TF_LINEAR,c.mag_filter=F.TF_LINEAR});c||G.traverse_inputs(a,b,function(a,b,c){"DEPTH"==c.from&&(c.use_renderbuffer=!0)})});G.traverse(a,function(c,d){var e={};b(a,c,e);for(var g in e){for(var k=e[g],f=k[0],h=0;h<k.length;h++)if(k[h].min_filter==F.TF_LINEAR){f=k[h];break}for(var m=k[0],h=0;h<k.length;h++)if(k[h].mag_filter==F.TF_LINEAR){m=k[h];break}for(var l=k[0],h=0;h<k.length;h++)if(!k[h].use_renderbuffer){l=
k[h];break}for(h=0;h<k.length;h++)k[h].min_filter=f.min_filter,k[h].mag_filter=m.mag_filter,k[h].use_renderbuffer=l.use_renderbuffer}})}function b(a,c,d){G.traverse_inputs(a,c,function(c,e,g){g.active&&g.from==g.to&&(d[g.from]=d[g.from]||[],-1==d[g.from].indexOf(g)&&d[g.from].push(g),b(a,c,d))});G.traverse_outputs(a,c,function(a,b,c){c.active&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});c=G.get_node_attr(a,c);if(c.type==L.MOTION_BLUR)for(var e=0;e<c.slinks_internal.length;e++){var g=
c.slinks_internal[e];d[g.from].push(g)}}function f(a){var b=[L.MOTION_BLUR,L.SMAA_RESOLVE,L.SMAA_NEIGHBORHOOD_BLENDING,L.MAIN_PLANE_REFLECT,L.MAIN_CUBE_REFLECT,L.PERFORMANCE],c=G.topsort(a),d=[];G.traverse(c,function(a,g){for(var k=0;k<g.slinks_internal.length;k++){var f=g.slinks_internal[k];-1<b.indexOf(g.type)&&(f.unique_texture=!0);var h=p(d,f,l(f));f.texture=h;g.textures_internal[k]=h}for(k=0;k<g.textures_internal.length;k++)h=g.textures_internal[k],n(d,h);G.traverse_outputs(c,a,function(k,f,
h){-1<b.indexOf(g.type)&&(h.unique_texture=!0);h.texture||((k=q(c,a,h.from))&&h.active&&!h.texture?e(d,k):k=p(d,h,l(h)),h.texture=k)});G.traverse_inputs(c,a,function(a,b,c){n(d,c.texture)});G.traverse_outputs(c,a,function(a,b,c){c.texture&&"NONE"==c.to&&n(d,c.texture)})})}function l(a){a=U.clone_object_json(a);delete a.to;delete a.active;delete a.texture;return JSON.stringify(a)}function q(a,b,c){var d=null;G.traverse_inputs(a,b,function(a,b,e){if(e.active&&e.from==e.to&&e.from==c&&e.texture)return d=
e.texture,!0});G.traverse_outputs(a,b,function(a,b,e){if(e.active&&e.from==c&&e.texture)return d=e.texture,!0});return d}function e(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tex===b&&d.ref++}}function n(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tex===b&&d.ref&&d.ref--}}function p(a,b,c){if(b.parent_slink)return e(a,b.parent_slink.texture),b.parent_slink.texture;if(b.unique_texture)return B(b);for(var d=null,g=0;g<a.length;g++){var k=a[g];if(k.id==c&&0===k.ref){d=k;break}}if(d&&!T.firefox_tex_reuse_hack)return d.ref++,
d.tex;b=B(b);a.push({id:c,ref:1,tex:b});return b}function B(a){var b=a.size_mult_x*a.size,c=a.size_mult_y*a.size;switch(a.from){case "COLOR":if(a.use_renderbuffer){var d=F.create_texture("COLOR_RB",a.multisample?F.TT_RB_RGBA_MS:F.TT_RB_RGBA,a.use_comparison);F.resize(d,b,c)}else d=F.create_texture("COLOR",F.TT_RGBA_INT,a.use_comparison),F.resize(d,b,c),F.set_filters(d,a.min_filter,a.mag_filter);return d;case "DEPTH":return a.use_renderbuffer?(d=F.create_texture("DEPTH_RB",a.multisample?F.TT_RB_DEPTH_MS:
F.TT_RB_DEPTH,a.use_comparison),F.resize(d,b,c)):(d=F.create_texture("DEPTH_TEX",F.TT_DEPTH,a.use_comparison),F.resize(d,b,c),F.set_filters(d,a.min_filter,a.mag_filter)),d;case "CUBEMAP":return d=F.create_cubemap_texture("CUBEMAP",b);case "SCREEN":case "NONE":return null;default:U.panic("Wrong slink param: "+a.from)}}function c(a,b){var c=!1;G.traverse_edges(a,function(d,e,g){if(g&&(d=G.get_node_attr(a,d),e=G.get_node_attr(a,e),b(g,!1,d,e)))return c=!0});c||G.traverse(a,function(a,c){for(var d=0;d<
c.slinks_internal.length;d++)if(b(c.slinks_internal[d],!0,c,null))return!0})}function k(a){G.traverse(a,function(b,c){if(c.type!=L.SINK){var d=c.camera;G.traverse_outputs(a,b,function(a,b,c){c.active&&c.texture&&(x.set_attachment(d,c.from,c.texture),c.from==c.to&&b.camera&&x.set_attachment(b.camera,c.from,c.texture))});for(var e=0;e<c.slinks_internal.length;e++){var g=c.slinks_internal[e];g.active&&g.from==g.to&&x.set_attachment(d,g.from,c.textures_internal[e])}!d.color_attachment&&!d.depth_attachment||
d.framebuffer||(d.framebuffer=ba.render_target_create(d.color_attachment,d.depth_attachment))}});G.traverse(a,function(b,c){if(c.type==L.RESOLVE||c.type==L.COPY){var e=d(a,c);c.camera.framebuffer_prev=e[0].camera.framebuffer}})}function m(a){var b=null,c=0;G.traverse(a,function(a,d){if(d.type==Q.subs_type){if(c==Q.subs_number)return b=d,!0;c++}});return b}function A(a,b){var c=G.node_by_attr(a,b),d=L.create_subs_postprocessing("NONE"),e=G.append_node_attr(a,d),g=G.get_sink_nodes(a)[0];G.traverse_edges(a,
function(b,c,d){c==g&&G.reconnect_edges(a,b,g,b,e)});var k=E(b,a);G.traverse_edges(a,function(e,g,h){if(e==c){if(k){e=L.create_subs_resolve();G.append_node_attr(a,e);g=z("COLOR","RESOLVE",1,1,1,!0);g.multisample=!0;g.use_renderbuffer=!0;var f=z("DEPTH","RESOLVE",1,1,1,!0);f.multisample=!0;f.use_renderbuffer=!0;G.append_edge_attr(a,b,e,g);G.append_edge_attr(a,b,e,f);b=e}G.append_edge_attr(a,b,d,z(Q.slink_type,"u_color",h.size,h.size_mult_x,h.size_mult_y,h.update_dim));return!0}});G.append_edge(a,e,
g,z("SCREEN","NONE",.5,.5,.5,!0))}function E(a,b){var c=!1,d=G.node_by_attr(b,a);G.out_edge_count(b,d)&&(c=G.get_out_edge(b,d,0),d=G.get_edge_attr(b,d,c,0),"COLOR"==d.from&&"COLOR"==d.to||"DEPTH"==d.from&&"DEPTH"==d.to?(d=G.get_node_attr(b,c),c=E(d,b)):c="RESOLVE"==d.to);return c}function w(a,b,c,d){var e=c.cameras,g=b.hmd_stereo_use,k=b.reflection_params.plane_refl_subs,h=b.reflection_params.plane_refl_subs_blend;b=G.get_node_id(a,d);for(var f=G.subgraph_node_conn(a,b,G.BACKWARD_DIR),m=[],l=[],n=
[],f=G.clone(f,function(b){var d;if(-1<ha.indexOf(b.type))l.push(b),d=b;else{d=L.clone_subs(b);if(d.type==L.MAIN_PLANE_REFLECT)for(var f=0;f<k.length;f++)if(k[f][0]==b){k[f]=[b,d];d.camera.reflection_plane=b.camera.reflection_plane;c.cameras.push(d.camera);break}if(b.type==L.MAIN_PLANE_REFLECT_BLEND)for(f=0;f<k.length;f++){if(h[f][0]==b){h[f]=[b,d];d.camera=k[f][1].camera;break}}else-1<e.indexOf(b.camera)&&(g?(x.make_stereo(b.camera,x.TYPE_HMD_LEFT),x.make_stereo(d.camera,x.TYPE_HMD_RIGHT)):(x.make_stereo(b.camera,
x.TYPE_STEREO_LEFT),x.make_stereo(d.camera,x.TYPE_STEREO_RIGHT)),e.push(d.camera));var t=G.node_by_attr(a,b);G.traverse_inputs(a,t,function(a,b,c){-1<ha.indexOf(b.type)&&m.push([b,d,c])});for(f=0;f<b.slinks_internal.length;f++)d.slinks_internal[f].parent_slink=b.slinks_internal[f];b=!0;for(f=0;f<G.in_edge_count(a,t);f++){var p=G.get_in_edge(a,t,f),p=G.get_node_attr(a,p);-1==ha.indexOf(p.type)&&(b=!1)}b&&n.push(d)}return d},function(a){var b=y(a,!0);b.parent_slink=a;return b}),t=0;t<l.length;t++)G.remove_node(f,
G.node_by_attr(f,l[t]));G.cleanup_loose_edges(f);b=L.create_subs_stereo(g);var t=G.append_node_attr(a,b),p=L.create_subs_copy();G.append_node_attr(a,p);var q=z("COLOR","COPY",1,1,1,!0);G.append_edge_attr(a,d,p,q);var B=z("COLOR","u_sampler_left",1,1,1,!0);B.unique_texture=!0;B.min_filter=F.TF_LINEAR;B.mag_filter=F.TF_LINEAR;G.append_edge_attr(a,p,b,B);d.is_pp||(d=L.create_subs_copy(),G.append_node_attr(f,d),B=z("COLOR","COPY",1,1,1,!0),B.parent_slink=q,q=G.get_sink_nodes(f)[0],q=G.get_node_attr(f,
q),G.append_edge_attr(f,q,d,B));d=z("COLOR","u_sampler_right",1,1,1,!0);d.min_filter=F.TF_LINEAR;d.mag_filter=F.TF_LINEAR;G.append_subgraph(f,a,[G.get_sink_nodes(f)[0],t,d]);for(t=0;t<m.length;t++)G.append_edge_attr(a,m[t][0],m[t][1],m[t][2]);f=z("SCREEN","NONE",0,0,0,!1);for(t=0;t<n.length;t++)G.append_edge_attr(a,p,n[t],f);g&&v(a,.5,1);return b}function v(a,b,c){var d=[];G.traverse(a,function(b,c){if(-1==ha.indexOf(c.type)&&c.slinks_internal.length&&D(a,c,L.STEREO))for(var e=0;e<c.slinks_internal.length;e++){var g=
c.slinks_internal[e];-1==d.indexOf(g)&&d.push(g)}});G.traverse_edges(a,function(b,c,e){b=G.get_node_attr(a,b);c=G.get_node_attr(a,c);-1==ha.indexOf(b.type)&&D(a,c,L.STEREO)&&-1==d.indexOf(e)&&d.push(e)});for(var e=0;e<d.length;e++)d[e].size_mult_x*=b,d[e].size_mult_y*=c}function z(a,b,c,d,e,g){return{from:a,to:b,size:c,size_mult_x:d,size_mult_y:e,update_dim:g,active:!0,texture:null,multisample:!1,use_renderbuffer:!1,min_filter:F.TF_NEAREST,mag_filter:F.TF_NEAREST,unique_texture:!1,use_comparison:!1}}
function y(a,b){if(b){var c=a.texture;a.texture=null}a.texture&&U.panic("Failed to clone slink with attached texture");var d=U.clone_object_json(a);b&&(a.texture=c,d.texture=c);return d}function D(a,b,c){if(b.type==c)return!0;b=t(a,b);for(var d=0;d<b.length;d++)if(D(a,b[d],c))return!0;return!1}function K(a,b,c){if(b.type==c)return!0;b=d(a,b);for(var e=0;e<b.length;e++)if(K(a,b[e],c))return!0;return!1}function d(a,b){var c=G.node_by_attr(a,b);c==G.NULL_NODE&&U.panic("Subscene not in graph");for(var d=
[],e=G.in_edge_count(a,c),g=0;g<e;g++){var k=G.get_in_edge(a,c,g);k!=c&&d.push(G.get_node_attr(a,k))}return d}function t(a,b){var c=G.node_by_attr(a,b);c==G.NULL_NODE&&U.panic("Subscene not in graph");for(var d=[],e=G.out_edge_count(a,c),g=0;g<e;g++){var k=G.get_out_edge(a,c,g);k!=c&&d.push(G.get_node_attr(a,k))}return d}function C(a){var b=[],d=[];c(a,function(a,c,e,g){a.texture&&-1==b.indexOf(a.texture)&&(b.push(a.texture),d.push(a.texture,b.length-1))});return d}function M(a,b,c,d){b=""+(a.from+
"\\n");b+="NONE"!=a.to?a.to+"\\n":"";b+="(";if(a.update_dim){c=a.size_mult_x;var e=a.size_mult_y;Math.round(c)!=c&&(c=c.toFixed(2));Math.round(e)!=e&&(e=e.toFixed(2));b+=(1==c?"":c)+"Sx"+((1==e?"":e)+"S")}else c=a.size_mult_x,e=a.size_mult_y,b+=a.size*c+"x"+a.size*e;if("SCREEN"!=a.from){b+=" ";if(a.use_renderbuffer)b+="RR";else{c=a.min_filter;var e=a.mag_filter,g="";c==F.TF_LINEAR?g+="L":c==F.TF_NEAREST&&(g+="N");e==F.TF_LINEAR?g+="L":e==F.TF_NEAREST&&(g+="N");b+=g}for(c=0;c<d.length;c+=2)d[c]==a.texture&&
(b+=" "+d[c+1])}return b+")\\n"}var x=r("__camera"),g=r("__config"),H=r("__debug"),G=r("__graph"),ba=r("__renderer"),L=r("__subscene"),F=r("__textures"),U=r("__util"),Q=g.debug_subs,T=g.defaults,W=g.scenes,ha=[L.GRASS_MAP,L.SHADOW_CAST,L.MAIN_CUBE_REFLECT,L.MAIN_CUBE_REFLECT_BLEND];a.check_slink_tex_conn=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "NONE":return!1;default:return!0}};a.traverse_slinks=c;a.create_rendering_graph=
function(a,b,c,e){var g=G.create(),l=[],n=[],p=[],q=[],B=[],v=[],M=[],C=[],r=a.lamps_number,E=a.water_params,D=a.shore_smoothing,K=a.soft_particles,za=a.ssao,ha=a.god_rays,ba=a.reflection_params,ga=a.materials_params,X=a.bloom_params,ea=a.motion_blur,aa=a.compositing,Ga=a.antialiasing,ja=a.world_light_set,pa=a.world_fog_set,ya=a.shadow_params,Ea=a.mb_params,Ca=a.cc_params,ia=a.god_rays_params,oa=a.outline_params,xa=a.dof,La=a.depth_tex,Ha=a.refractions,P=Boolean(e.length),la=1<T.msaa_samples,Ba=z("COLOR",
"COLOR",1,1,1,!0),Ma=z("DEPTH","DEPTH",1,1,1,!0);if(la){y(Ma);var Fa=y(Ma);Ba.multisample=!0;Ba.use_renderbuffer=!0;Ma.multisample=!0;Ma.use_renderbuffer=!0}var ta=b.cameras[0];if(ya){x.update_camera_shadows(ta,ya);for(var Ka=0;Ka<ya.lamp_types.length;Ka++)for(var ka=ya.csm_num,Za=0;Za<ka;Za++){var qa=L.create_subs_shadow_cast(Za,Ka,ya,r);G.append_node_attr(g,qa);p.push(qa);var O=ya.csm_resolution,Ia=qa.camera;b.shadow_cameras.push(Ia);Ia.width=O;Ia.height=O;qa.clear_color=!1;var Sa=z("DEPTH","u_shadow_map"+
(0<Ka?Ka:Za),O,1,1,!1);T.webgl2&&(Sa.min_filter=F.TF_LINEAR,Sa.mag_filter=F.TF_LINEAR,Sa.use_comparison=!0);q.push(Sa);(H.check_depth_only_issue()||T.shadows_color_slink_hack)&&qa.slinks_internal.push(z("COLOR","COLOR",O,1,1,!1))}}if(ba&&ba.num_cube_refl&&!P)for(Za=0;Za<ba.num_cube_refl;Za++){Ia=x.create_camera(x.TYPE_PERSP);Ia.width=a.cubemap_refl_size;Ia.height=a.cubemap_refl_size;x.set_frustum(Ia,90,.1,100);x.set_projection(Ia,Ia.aspect);var Ja=L.create_subs_main(L.MAIN_CUBE_REFLECT,Ia,!1,E,r,
pa,ja,null,a.sun_exist);Ja.cube_view_matrices=U.generate_inv_cubemap_matrices();for(Ka=0;6>Ka;Ka++)Ja.cube_cam_frustums.push(x.create_frustum_planes());G.append_node_attr(g,Ja);var Ta=z("CUBEMAP","u_cube_reflection",a.cubemap_refl_size,1,1,!1);Ta.min_filter=F.TF_LINEAR;Ta.mag_filter=F.TF_LINEAR;C.push(Ta);if(ba.has_blend_reflexible){var eb=L.create_subs_main(L.MAIN_CUBE_REFLECT_BLEND,Ia,!1,E,r,pa,ja,null,a.sun_exist);eb.cube_view_matrices=Ja.cube_view_matrices;eb.cube_cam_frustums=Ja.cube_cam_frustums;
G.append_node_attr(g,eb);var Va=z("DEPTH","DEPTH",a.cubemap_refl_size,1,1,!1),Da=z("COLOR","COLOR",a.cubemap_refl_size,1,1,!1);G.append_edge_attr(g,Ja,eb,Va);G.append_edge_attr(g,Ja,eb,Da);M.push(eb);ba.cube_refl_subs_blend.push(eb)}else{var $b=z("DEPTH","DEPTH",a.cubemap_refl_size,1,1,!1);Ja.slinks_internal.push($b);M.push(Ja)}ba.cube_refl_subs.push(Ja)}if(ba&&0<ba.refl_plane_objs.length&&!P)for(Ka=0;Ka<ba.refl_plane_objs.length;Ka++)Ia=x.clone_camera(ta,!0),Ia.reflection_plane=new Float32Array(4),
b.cameras.push(Ia),Ja=L.create_subs_main(L.MAIN_PLANE_REFLECT,Ia,!1,E,r,pa,ja,null,a.sun_exist),G.append_node_attr(g,Ja),Ta=z("COLOR","u_plane_reflection",1,a.plane_refl_size,a.plane_refl_size,!0),Ta.min_filter=F.TF_LINEAR,Ta.mag_filter=F.TF_LINEAR,v.push(Ta),ba.has_blend_reflexible?(eb=L.create_subs_main(L.MAIN_PLANE_REFLECT_BLEND,Ia,!1,E,r,pa,ja,null,a.sun_exist),G.append_node_attr(g,eb),Va=z("DEPTH","DEPTH",1,a.plane_refl_size,a.plane_refl_size,!0),Da=z("COLOR","COLOR",1,a.plane_refl_size,a.plane_refl_size,
!0),Da.min_filter=F.TF_NEAREST,Da.mag_filter=F.TF_NEAREST,G.append_edge_attr(g,Ja,eb,Va),G.append_edge_attr(g,Ja,eb,Da),ba.plane_refl_subs_blend.push([eb]),B.push(eb)):($b=z("DEPTH","DEPTH",1,a.plane_refl_size,a.plane_refl_size,!0),Ja.slinks_internal.push($b),B.push(Ja)),ba.plane_refl_subs.push([Ja]);if(a.dynamic_grass){var nb=L.create_subs_grass_map();G.append_node_attr(g,nb);O=W.grass_tex_size;nb.camera.width=O;nb.camera.height=O;var sb=z("DEPTH","u_grass_map_depth",O,1,1,!1),Lb=z("COLOR","u_grass_map_color",
O,1,1,!1);Lb.min_filter=F.TF_LINEAR;Lb.mag_filter=F.TF_LINEAR}else Lb=sb=nb=null;if(La&&ya){var db=x.clone_camera(ta,!0);b.cameras.push(db);var Qa=L.create_subs_shadow_receive(g,db,r);G.append_node_attr(g,Qa);Qa.self_shadow_normal_offset=ya.self_shadow_normal_offset;for(Za=0;Za<p.length;Za++)qa=p[Za],G.append_edge_attr(g,qa,Qa,q[Za]);var Vb=z("COLOR","u_color",1,1,1,!0),ac=z("DEPTH","u_depth",1,1,1,!0);if(za){var Dc=x.clone_camera(ta,!0);b.cameras.push(Dc);var qb=a.ssao_params,Pa=L.create_subs_ssao(Dc,
pa,qb);G.append_node_attr(g,Pa);var Wb=z("COLOR","u_ssao_mask",1,1,1,!0);G.append_edge_attr(g,Qa,Pa,Vb);G.append_edge_attr(g,Qa,Pa,ac);var pd=x.clone_camera(ta,!0);b.cameras.push(pd);var Ic=L.create_subs_ssao_blur(pd,qb);G.append_node_attr(g,Ic);var gc=z("COLOR","u_shadow_mask",1,1,1,!0);G.append_edge_attr(g,Pa,Ic,Wb);G.append_edge_attr(g,Qa,Ic,ac)}la?Qa.slinks_internal.push(z("DEPTH","DEPTH",1,1,1,!0)):Qa.slinks_internal.push(Ma);nb&&(G.append_edge_attr(g,nb,Qa,sb),G.append_edge_attr(g,nb,Qa,Lb))}else Qa=
null;var Gb=L.create_subs_main(L.MAIN_OPAQUE,ta,!0,E,r,pa,ja,null,a.sun_exist);G.append_node_attr(g,Gb);if(la){var Qb=L.create_subs_resolve();G.append_node_attr(g,Qb);n.push(Qb);var Ab=z("COLOR","RESOLVE",1,1,1,!0);Ab.multisample=!0;Ab.use_renderbuffer=!0;var uc=z("DEPTH","RESOLVE",1,1,1,!0);uc.multisample=!0;uc.use_renderbuffer=!0;G.append_edge_attr(g,Gb,Qb,Ab);G.append_edge_attr(g,Gb,Qb,uc)}else n.push(Gb);Qa&&(Wb?G.append_edge_attr(g,Ic,Gb,gc):ya?G.append_edge_attr(g,Qa,Gb,z("COLOR","u_shadow_mask",
1,1,1,!0)):U.panic("Internal error"));nb&&(G.append_edge_attr(g,nb,Gb,sb),G.append_edge_attr(g,nb,Gb,Lb));if(B.length)for(var Jc=B.length,Ka=0;Ka<Jc;Ka++)G.append_edge_attr(g,B[Ka],Gb,v[Ka]);if(M.length)for(Ka=0;Ka<M.length;Ka++)G.append_edge_attr(g,M[Ka],Gb,C[Ka]);l=n;n=[];if(!P&&a.color_picking){Ia=x.clone_camera(ta,!0);Ia.width=1;Ia.height=1;b.cameras.push(Ia);var vc=L.create_subs_color_picking(Ia,!1,r);G.append_node_attr(g,vc);if(a.xray){Ia=x.clone_camera(ta,!0);Ia.width=1;Ia.height=1;b.cameras.push(Ia);
var Ec=L.create_subs_color_picking(Ia,!0,r);G.append_node_attr(g,Ec);var qd=z("COLOR","COLOR",1,1,1,!1);G.append_edge_attr(g,vc,Ec,qd);var Vc=z("DEPTH","DEPTH",1,1,1,!1);G.append_edge_attr(g,vc,Ec,Vc)}}else vc=null;if(!ga.refractions&&!Ha||P)bc=null;else{if(la)bc=Qb;else{var bc=L.create_subs_copy();G.append_node_attr(g,bc);var Ed=z("COLOR","COPY",1,1,1,!0);G.append_edge_attr(g,l[0],bc,Ed)}var Wc=z("COLOR","u_refractmap",1,1,1,!0)}if(La&&(Ha||D||K)){var rd=x.clone_camera(ta,!0);b.cameras.push(rd);
var Rc=L.create_subs_depth_pack(rd);G.append_node_attr(g,Rc);var Xc=z("DEPTH","u_depth",1,1,1,!0);G.append_edge_attr(g,la?Qb:Gb,Rc,Xc);var hc=z("COLOR","u_scene_depth",1,1,1,!0);hc.min_filter=F.TF_NEAREST;hc.mag_filter=F.TF_NEAREST}else Rc=null;var dd=function(c){var d=x.clone_camera(ta,!0);b.cameras.push(d);d=L.create_subs_main(c,d,!1,E,r,pa,ja,ya,a.sun_exist);G.append_node_attr(g,d);c==L.MAIN_XRAY?(c=z("COLOR","COLOR",1,1,1,!0),G.append_edge_attr(g,l[0],d,c),c=z("DEPTH","DEPTH",1,1,1,!0),d.slinks_internal.push(c)):
(c=la&&l[0].type==L.RESOLVE?Gb:l[0],G.append_edge_attr(g,c,d,Ma),G.append_edge_attr(g,c,d,Ba));nb&&(G.append_edge_attr(g,nb,d,sb),G.append_edge_attr(g,nb,d,Lb));for(c=0;c<p.length;c++)G.append_edge_attr(g,p[c],d,q[c]);Rc&&G.append_edge_attr(g,Rc,d,hc);if(B.length){var e=B.length;for(c=0;c<e;c++)G.append_edge_attr(g,B[c],d,v[c])}if(M.length)for(c=0;c<M.length;c++)G.append_edge_attr(g,M[c],d,C[c]);bc&&G.append_edge_attr(g,bc,d,Wc);return d};if(a.glow_over_blend){var Sc=dd(L.MAIN_BLEND);n.push(Sc);l=
n;n=[]}if(a.glow_materials){var sd=x.clone_camera(ta,!0);b.cameras.push(sd);var ic=L.create_subs_main(L.MAIN_GLOW,sd,!1,E,r,pa,ja);G.append_node_attr(g,ic);Rc&&G.append_edge_attr(g,Rc,ic,hc);bc&&G.append_edge_attr(g,bc,ic,Wc);nb&&(G.append_edge_attr(g,nb,ic,sb),G.append_edge_attr(g,nb,ic,Lb));if(B.length)for(Jc=B.length,Ka=0;Ka<Jc;Ka++)G.append_edge_attr(g,B[Ka],ic,v[Ka]);if(M.length)for(Ka=0;Ka<M.length;Ka++)G.append_edge_attr(g,M[Ka],ic,C[Ka]);G.append_edge_attr(g,la?Qb:Gb,ic,la?Fa:Ma);var ob=L.create_subs_postprocessing("X_GLOW_BLUR");
ob.subtype="GLOW_MASK_SMALL";ob.texel_size_multiplier=a.glow_params.small_glow_mask_width;var wc=z("COLOR","u_color",1,1,1,!0);wc.min_filter=F.TF_LINEAR;wc.mag_filter=F.TF_LINEAR;G.append_node_attr(g,ob);G.append_edge_attr(g,ic,ob,wc);var Bb=L.create_subs_postprocessing("Y_GLOW_BLUR");Bb.subtype="GLOW_MASK_SMALL";Bb.texel_size_multiplier=a.glow_params.small_glow_mask_width;var ib=z("COLOR","u_color",1,.5,.5,!0);ib.min_filter=F.TF_LINEAR;ib.mag_filter=F.TF_LINEAR;G.append_node_attr(g,Bb);G.append_edge_attr(g,
ob,Bb,ib);var ab=L.create_subs_postprocessing("X_GLOW_BLUR");ab.subtype="GLOW_MASK_LARGE";ab.texel_size_multiplier=a.glow_params.large_glow_mask_width;var cc=z("COLOR","u_color",1,.5,.5,!0);cc.min_filter=F.TF_LINEAR;cc.mag_filter=F.TF_LINEAR;G.append_node_attr(g,ab);G.append_edge_attr(g,Bb,ab,cc);var Wa=L.create_subs_postprocessing("Y_GLOW_BLUR");Wa.subtype="GLOW_MASK_LARGE";Wa.texel_size_multiplier=a.glow_params.large_glow_mask_width;var Tc=z("COLOR","u_color",1,.25,.25,!0);Tc.min_filter=F.TF_LINEAR;
Tc.mag_filter=F.TF_LINEAR;G.append_node_attr(g,Wa);G.append_edge_attr(g,ab,Wa,Tc);var jc=x.clone_camera(ta,!0);b.cameras.push(jc);var Mb=L.create_subs_glow_combine(jc,a);G.append_node_attr(g,Mb);var dc=z("COLOR","u_src_color",1,1,1,!0);if(a.glow_over_blend)if(la){var Rb=L.create_subs_resolve();G.append_node_attr(g,Rb);G.append_edge_attr(g,Sc,Rb,Ab);G.append_edge_attr(g,Sc,Rb,uc);G.append_edge_attr(g,Rb,Mb,dc)}else G.append_edge_attr(g,Sc,Mb,dc);else G.append_edge_attr(g,la?Qb:Gb,Mb,dc);G.append_edge_attr(g,
a.glow_over_blend?Sc:Gb,Mb,Ma);var Kc=z("COLOR","u_glow_mask_small",1,.5,.5,!0);Kc.min_filter=F.TF_LINEAR;Kc.mag_filter=F.TF_LINEAR;G.append_edge_attr(g,Bb,Mb,Kc);var kc=z("COLOR","u_glow_mask_large",1,.25,.25,!0);kc.min_filter=F.TF_LINEAR;kc.mag_filter=F.TF_LINEAR;G.append_edge_attr(g,Wa,Mb,kc);l=[Mb];n=[]}a.glow_over_blend||(Sc=dd(L.MAIN_BLEND),n.push(Sc),l=n,n=[]);if(T.debug_view){Ia=x.clone_camera(ta,!0);b.cameras.push(Ia);var rb=L.create_subs_debug_view(Ia);n.push(rb);G.append_node_attr(g,rb);
G.append_edge_attr(g,l[0],rb,Ba);G.append_edge_attr(g,l[0],rb,Ma);nb&&(G.append_edge_attr(g,nb,rb,sb),G.append_edge_attr(g,nb,rb,Lb));H.set_debug_view_subs(rb);l=n;n=[]}if(la){var xc=L.create_subs_resolve();G.append_node_attr(g,xc);n.push(xc);G.append_edge_attr(g,l[0],xc,Ab);G.append_edge_attr(g,l[0],xc,uc);l=n;n=[]}var xb=l.slice(0);if(!P&&a.anchor_visibility&&!T.ff_disable_anchor_vis_hack){Ia=x.clone_camera(ta,!0);b.cameras.push(Ia);var Xb=L.create_subs_anchor_visibility(Ia);G.append_node_attr(g,
Xb);G.append_edge_attr(g,l[0],Xb,la?Fa:Ma)}if(ha&&La&&!P){var lc=ia.max_ray_length,Yc=ia.intensity,pb=ia.steps_per_pass,$a=l[0],bb=E?!0:!1,Cb=z("DEPTH","u_input",1,1,1,!0),Nb=z("COLOR","u_input",1,.25,.25,!0);Nb.min_filter=F.TF_LINEAR;Nb.mag_filter=F.TF_LINEAR;var Sb=lc/pb,ed=x.clone_camera(ta,!0);b.cameras.push(ed);var mc=L.create_subs_god_rays(ed,bb,lc,!0,Sb,r,pb);G.append_node_attr(g,mc);G.append_edge_attr(g,$a,mc,Cb);var Sb=lc/pb*.5,Lc=x.clone_camera(ta,!0);b.cameras.push(Lc);var Hb=L.create_subs_god_rays(Lc,
bb,lc,!1,Sb,r,pb);G.append_node_attr(g,Hb);G.append_edge_attr(g,mc,Hb,Nb);var Sb=lc/pb*.25,Mc=x.clone_camera(ta,!0);b.cameras.push(Mc);var nc=L.create_subs_god_rays(Mc,bb,lc,!1,Sb,r,pb);G.append_node_attr(g,nc);G.append_edge_attr(g,Hb,nc,Nb);var oc=L.create_subs_god_rays_comb(Yc,r);n.push(oc);G.append_node_attr(g,oc);G.append_edge_attr(g,$a,oc,z("COLOR","u_main",1,1,1,!0));G.append_edge_attr(g,nc,oc,z("COLOR","u_god_rays",1,1,1,!0));l=n;n=[]}if(X&&!P){var $a=l[0],pc=L.create_subs_luminance();G.append_node_attr(g,
pc);G.append_edge_attr(g,$a,pc,z("COLOR","u_input",1,1,1,!0));var Ya=L.create_subs_av_luminance();G.append_node_attr(g,Ya);Ya.camera.width=T.edge_min_tex_size_hack?2:1;Ya.camera.height=T.edge_min_tex_size_hack?2:1;var jb=z("COLOR","u_input",1,.25,.25,!0);jb.min_filter=F.TF_LINEAR;jb.mag_filter=F.TF_LINEAR;var Db=z("COLOR","u_luminance",1,.25,.25,!0);Db.min_filter=F.TF_LINEAR;Db.mag_filter=F.TF_LINEAR;G.append_edge_attr(g,pc,Ya,jb);var kb=X.key,Tb=X.edge_lum,Zc=x.clone_camera(ta,!0);b.cameras.push(Zc);
var ec=L.create_subs_luminance_trunced(kb,Tb,r,Zc);G.append_node_attr(g,ec);G.append_edge_attr(g,$a,ec,z("COLOR","u_main",1,1,1,!0));G.append_edge_attr(g,pc,ec,Db);G.append_edge_attr(g,Ya,ec,z("COLOR","u_average_lum",1,1,1,!1));var Ib=z("COLOR","u_color",1,.25,.25,!0);Ib.min_filter=F.TF_LINEAR;Ib.mag_filter=F.TF_LINEAR;ob=L.create_subs_bloom_blur(g,pc,"X_BLUR",!0);G.append_node_attr(g,ob);G.append_edge_attr(g,ec,ob,Ib);Bb=L.create_subs_bloom_blur(g,ob,"Y_BLUR",!0);G.append_node_attr(g,Bb);G.append_edge_attr(g,
ob,Bb,Ib);var mb=L.create_subs_bloom_combine(X.blur);G.append_node_attr(g,mb);var yc=z("COLOR","u_bloom",1,.25,.25,!0);yc.min_filter=F.TF_LINEAR;yc.mag_filter=F.TF_LINEAR;G.append_edge_attr(g,Bb,mb,yc);G.append_edge_attr(g,$a,mb,z("COLOR","u_main",1,1,1,!0));n.push(mb);l=n;n=[]}if(xa&&La&&!P){var $a=l[0],Na=x.clone_camera(ta,!0);b.cameras.push(Na);if(c.dof_bokeh){var tb=z("COLOR","u_color",1,1,1,!0);tb.min_filter=F.TF_LINEAR;tb.mag_filter=F.TF_LINEAR;var Fc=z("DEPTH","u_depth",1,1,1,!0),Jb=z("COLOR",
"u_color",1,.5,.5,!0);Jb.min_filter=F.TF_NEAREST;Jb.mag_filter=F.TF_NEAREST;Ib=z("COLOR","u_color",1,.5,.5,!0);Ib.min_filter=F.TF_NEAREST;Ib.mag_filter=F.TF_NEAREST;var gb=z("COLOR","u_blurred1",1,.5,.5,!0);gb.min_filter=F.TF_LINEAR;gb.mag_filter=F.TF_LINEAR;var zc=z("COLOR","u_blurred2",1,.5,.5,!0);zc.min_filter=F.TF_LINEAR;zc.mag_filter=F.TF_LINEAR;var Oa=xb[0];if(c.dof_foreground_blur){var cb=x.clone_camera(ta,!0);b.cameras.push(cb);var ub=L.create_subs_coc(cb,"COC_FOREGROUND");cb.dof_distance=
c.dof_distance;cb.dof_object=c.dof_object;cb.dof_front_start=c.dof_front_start;cb.dof_front_end=c.dof_front_end;cb.dof_rear_start=c.dof_rear_start;cb.dof_rear_end=c.dof_rear_end;cb.dof_power=c.dof_power;cb.dof_bokeh=c.dof_bokeh;cb.dof_bokeh_intensity=c.dof_bokeh_intensity;cb.dof_foreground_blur=c.dof_foreground_blur;cb.dof_on=!0;G.append_node_attr(g,ub);G.append_edge_attr(g,$a,ub,tb);G.append_edge_attr(g,Oa,ub,Fc);var Ob=L.create_subs_postprocessing("X_ALPHA_BLUR");G.append_node_attr(g,Ob);G.append_edge_attr(g,
ub,Ob,Jb);var Xa=L.create_subs_postprocessing("Y_ALPHA_BLUR");G.append_node_attr(g,Xa);G.append_edge_attr(g,Ob,Xa,Ib);var Ra=x.clone_camera(ta,!0),qc=L.create_subs_coc(Ra,"COC_COMBINE");b.cameras.push(Ra);Ra.dof_distance=c.dof_distance;Ra.dof_object=c.dof_object;Ra.dof_front_start=c.dof_front_start;Ra.dof_front_end=c.dof_front_end;Ra.dof_rear_start=c.dof_rear_start;Ra.dof_rear_end=c.dof_rear_end;Ra.dof_power=c.dof_power;Ra.dof_bokeh=c.dof_bokeh;Ra.dof_bokeh_intensity=c.dof_bokeh_intensity;Ra.dof_foreground_blur=
c.dof_foreground_blur;Ra.dof_on=!0;G.append_node_attr(g,qc);G.append_edge_attr(g,$a,qc,tb);G.append_edge_attr(g,Oa,qc,Fc);G.append_edge_attr(g,Xa,qc,z("COLOR","u_coc_fg",1,.5,.5,!0))}else Ra=x.clone_camera(ta,!0),b.cameras.push(Ra),qc=L.create_subs_coc(Ra,"COC_ALL"),Ra.dof_distance=c.dof_distance,Ra.dof_object=c.dof_object,Ra.dof_front_start=c.dof_front_start,Ra.dof_front_end=c.dof_front_end,Ra.dof_rear_start=c.dof_rear_start,Ra.dof_rear_end=c.dof_rear_end,Ra.dof_power=c.dof_power,Ra.dof_bokeh=c.dof_bokeh,
Ra.dof_bokeh_intensity=c.dof_bokeh_intensity,Ra.dof_foreground_blur=c.dof_foreground_blur,Ra.dof_on=!0,G.append_node_attr(g,qc),G.append_edge_attr(g,$a,qc,tb),G.append_edge_attr(g,Oa,qc,Fc);var Eb=L.create_subs_postprocessing("X_DOF_BLUR");Eb.camera.dof_bokeh_intensity=c.dof_bokeh_intensity;G.append_node_attr(g,Eb);G.append_edge_attr(g,qc,Eb,Jb);var Uc=L.create_subs_postprocessing("Y_DOF_BLUR");Uc.camera.dof_bokeh_intensity=c.dof_bokeh_intensity;G.append_node_attr(g,Uc);G.append_edge_attr(g,Eb,Uc,
Ib);var Ac=L.create_subs_postprocessing("Y_DOF_BLUR");Ac.camera.dof_bokeh_intensity=c.dof_bokeh_intensity;G.append_node_attr(g,Ac);G.append_edge_attr(g,Eb,Ac,Ib);var fb=L.create_subs_dof(Na);Na.dof_distance=c.dof_distance;Na.dof_object=c.dof_object;Na.dof_front_start=c.dof_front_start;Na.dof_front_end=c.dof_front_end;Na.dof_rear_start=c.dof_rear_start;Na.dof_rear_end=c.dof_rear_end;Na.dof_power=c.dof_power;Na.dof_bokeh=c.dof_bokeh;Na.dof_bokeh_intensity=c.dof_bokeh_intensity;Na.dof_foreground_blur=
c.dof_foreground_blur;Na.dof_on=!0;n.push(fb);G.append_node_attr(g,fb);G.append_edge_attr(g,$a,fb,z("COLOR","u_sharp",1,1,1,!0));G.append_edge_attr(g,Uc,fb,gb);G.append_edge_attr(g,Ac,fb,zc)}else{var Ub=z("COLOR","u_color",1,1,1,!0);Ub.min_filter=F.TF_LINEAR;Ub.mag_filter=F.TF_LINEAR;var vb=z("COLOR","u_color",1,1,1,!0);vb.min_filter=F.TF_LINEAR;vb.mag_filter=F.TF_LINEAR;Eb=L.create_subs_postprocessing("X_BLUR");G.append_node_attr(g,Eb);G.append_edge_attr(g,$a,Eb,Ub);var hb=L.create_subs_postprocessing("Y_BLUR");
G.append_node_attr(g,hb);G.append_edge_attr(g,Eb,hb,vb);var Nc=xb[0],fb=L.create_subs_dof(Na);Na.dof_distance=c.dof_distance;Na.dof_object=c.dof_object;Na.dof_front_start=c.dof_front_start;Na.dof_front_end=c.dof_front_end;Na.dof_rear_start=c.dof_rear_start;Na.dof_rear_end=c.dof_rear_end;Na.dof_power=c.dof_power;Na.dof_bokeh=c.dof_bokeh;Na.dof_bokeh_intensity=c.dof_bokeh_intensity;Na.dof_foreground_blur=c.dof_foreground_blur;Na.dof_on=!0;n.push(fb);G.append_node_attr(g,fb);G.append_edge_attr(g,$a,
fb,z("COLOR","u_sharp",1,1,1,!0));G.append_edge_attr(g,hb,fb,z("COLOR","u_blurred",1,1,1,!0));G.append_edge_attr(g,Nc,fb,z("DEPTH","u_depth",1,1,1,!0))}l=n;n=[]}if(a.xray){var Oc=dd(L.MAIN_XRAY);n.push(Oc);l=n;n=[]}if(ea&&!P){var Bc=l[0],Gc=L.create_subs_motion_blur(Ea.mb_decay_threshold,Ea.mb_factor);n.push(Gc);G.append_node_attr(g,Gc);var yb=z("COLOR","u_mb_tex_curr",1,1,1,!0);G.append_edge_attr(g,Bc,Gc,yb);var Pc=z("COLOR","u_mb_tex_accum",1,1,1,!0);Gc.slinks_internal.push(Pc);l=n;n=[]}if(!P&&
a.outline){var $a=l[0],fc=x.clone_camera(ta,!0);b.cameras.push(fc);var rc=L.create_subs_outline_mask(fc,r);G.append_node_attr(g,rc);var wb=L.create_subs_postprocessing("X_EXTEND"),Qc=z("COLOR","u_color",1,1,1,!0),lb=z("COLOR","u_outline_mask",1,1,1,!0);wb.is_for_outline=!0;G.append_node_attr(g,wb);G.append_edge_attr(g,rc,wb,Qc);var Ua=z("COLOR","u_color",1,.5,.5,!0);Ua.min_filter=F.TF_LINEAR;Ua.mag_filter=F.TF_LINEAR;var Kb=L.create_subs_postprocessing("Y_EXTEND");Kb.is_for_outline=!0;G.append_node_attr(g,
Kb);G.append_edge_attr(g,wb,Kb,Ua);Eb=L.create_subs_postprocessing("X_BLUR");Eb.is_for_outline=!0;G.append_node_attr(g,Eb);G.append_edge_attr(g,Kb,Eb,Ua);var fd=z("COLOR","u_color",1,.25,.25,!0);fd.min_filter=F.TF_LINEAR;fd.mag_filter=F.TF_LINEAR;var $c=z("COLOR","u_outline_mask_blurred",1,.25,.25,!0);$c.min_filter=F.TF_LINEAR;$c.mag_filter=F.TF_LINEAR;hb=L.create_subs_postprocessing("Y_BLUR");hb.is_for_outline=!0;G.append_node_attr(g,hb);G.append_edge_attr(g,Eb,hb,fd);var Yb=L.create_subs_outline(oa);
G.append_node_attr(g,Yb);G.append_edge_attr(g,$a,Yb,z("COLOR","u_outline_src",1,1,1,!0));G.append_edge_attr(g,rc,Yb,lb);G.append_edge_attr(g,hb,Yb,$c);n.push(Yb);l=n;n=[]}u(g,La);if((a.anaglyph_use||a.hmd_stereo_use)&&!P){var sc=w(g,a,b,l[0]);n.push(sc);l=n;n=[]}if(aa&&!P){var $a=l[0],Hc=L.create_subs_compositing(Ca.brightness,Ca.contrast,Ca.exposure,Ca.saturation);G.append_node_attr(g,Hc);G.append_edge_attr(g,$a,Hc,z("COLOR","u_color",1,1,1,!0));n.push(Hc);l=n;n=[]}if(Ga){$a=l[0];if(T.smaa){var Cc=
z("COLOR","u_color",1,1,1,!0);Cc.min_filter=F.TF_LINEAR;Cc.mag_filter=F.TF_LINEAR;var ad=L.create_subs_smaa(L.SMAA_EDGE_DETECTION,a);G.append_node_attr(g,ad);G.append_edge_attr(g,$a,ad,Cc);var zb=L.create_subs_smaa(L.SMAA_BLENDING_WEIGHT_CALCULATION,a);G.append_node_attr(g,zb);G.append_edge_attr(g,ad,zb,Cc);var gd=z("COLOR","u_search_tex",1,1,1,!1),Pb=z("COLOR","u_area_tex",1,1,1,!1);gd.min_filter=F.TF_LINEAR;gd.mag_filter=F.TF_LINEAR;Pb.min_filter=F.TF_LINEAR;Pb.mag_filter=F.TF_LINEAR;zb.slinks_internal.push(gd);
zb.slinks_internal.push(Pb);var tc=L.create_subs_smaa(L.SMAA_NEIGHBORHOOD_BLENDING,a);G.append_node_attr(g,tc);G.append_edge_attr(g,$a,tc,Cc);var hd=z("COLOR","u_blend",1,1,1,!0);hd.min_filter=F.TF_LINEAR;hd.mag_filter=F.TF_LINEAR;G.append_edge_attr(g,zb,tc,hd);n.push(tc)}else{var ld=L.create_subs_aa(a);G.append_node_attr(g,ld);var bd=z("COLOR","u_color",1,1,1,!0);bd.min_filter=F.TF_LINEAR;bd.mag_filter=F.TF_LINEAR;G.append_edge_attr(g,$a,ld,bd);n.push(ld)}l=n;n=[]}var md=G.node_by_attr(g,l[0]);if(l[0].type==
L.MOTION_BLUR||l[0].type==L.RESOLVE)var td=!0;else td=!1,G.traverse_inputs(g,md,function(a,b,c){if(c.from==c.to)return td=!0});if(td){var nd=L.create_subs_postprocessing("NONE");G.append_node_attr(g,nd);G.append_edge_attr(g,l[0],nd,z("COLOR","u_color",1,1,1,!0));n.push(nd);l=n;n=[]}n.push(l[0]);vc&&(Ec?n.push(Ec):n.push(vc));Xb&&n.push(Xb);O=W.cubemap_tex_size;if(a.sky_params.render_sky){var Bd=a.sky_params,ud=a.world_light_set,Fb=ud.sky_texture_param,O=Fb?Fb.tex_size:O,xd=L.create_subs_sky(ud,r,
Bd,O);G.append_node_attr(g,xd);n.push(xd)}var Zb=L.create_subs_sink();G.append_node_attr(g,Zb);for(Za=0;Za<n.length;Za++){var jd=n[Za];switch(jd.type){case L.COLOR_PICKING:case L.COLOR_PICKING_XRAY:G.append_edge_attr(g,jd,Zb,z("COLOR","NONE",1,1,1,!1));G.append_edge_attr(g,jd,Zb,z("DEPTH","NONE",1,1,1,!1));break;case L.SKY:var yd=z("CUBEMAP","u_sky",O,1,1,!1);G.append_edge_attr(g,jd,Zb,yd);break;case L.ANCHOR_VISIBILITY:var zd=z("COLOR","NONE",1,1,1,!0);G.append_edge_attr(g,jd,Zb,zd);break;default:if(P){var cd=
e[0]._render,kd=z("COLOR","OFFSCREEN",1,1,1,!0);kd.texture=cd;G.append_edge_attr(g,n[Za],Zb,kd);for(Ka=1;Ka<e.length;Ka++){var Ad=e[Ka]._render,od=L.create_subs_postprocessing("NONE");G.append_node_attr(g,od);var Cd=z("COLOR","SCALE",1,1,1,!0);G.append_edge_attr(g,n[Za],od,Cd);var vd=Ad.source_size/cd.source_size,kd=z("COLOR","OFFSCREEN",1,vd,vd,!0);kd.texture=Ad;G.append_edge_attr(g,od,Zb,kd)}}else G.append_edge_attr(g,n[Za],Zb,z("SCREEN","NONE",1,1,1,!0))}}Qb&&!t(g,Qb).length&&(G.remove_node(g,
G.node_by_attr(g,Qb)),G.cleanup_loose_edges(g));u(g,La);h(g,La);if(Q.enabled){var wd=m(g);wd&&A(g,wd)}f(g);k(g);ya&&G.traverse(g,function(a,b){if(b.type==L.SHADOW_RECEIVE||b.type==L.MAIN_BLEND||b.type==L.MAIN_XRAY){for(var c=0,e=d(g,b),k=0,f=0;f<e.length;f++){var h=e[f];h.type==L.SHADOW_CAST&&(k++,b.p_light_matrix=b.p_light_matrix||[],b.p_light_matrix[0<h.shadow_lamp_index?h.shadow_lamp_index:c]=h.camera.proj_matrix,c++)}b.v_light_ts&&b.v_light_r||(T.mac_os_shadow_hack?b.v_light_tsr=new Float32Array(9*
k):(b.v_light_ts=new Float32Array(4*k),b.v_light_r=new Float32Array(4*k)))}});return g};a.multiply_size_mult_by_graph=v;a.set_texel_size=function(a,b,c){var d=a.texel_size_multiplier;a.texel_size[0]=b*a.texel_mask[0]*d;a.texel_size[1]=c*a.texel_mask[1]*d};a.set_texel_size_mult=function(a,b){a.texel_size_multiplier=b};a.create_performance_graph=function(){var a=G.create(),b=L.create_subs_perf(),c=x.create_camera(x.TYPE_NONE);c.width=512;c.height=512;b.camera=c;G.append_node_attr(a,b);b.slinks_internal.push(z("COLOR",
"u_color",512,1,1,!1));c=L.create_subs_sink();G.append_node_attr(a,c);G.append_edge_attr(a,b,c,z("COLOR","NONE",512,1,1,!1));f(a);k(a);return a};a.find_on_screen=function(a){var b=null;G.traverse(a,function(a,c){return c.camera&&null===c.camera.framebuffer?(b=c,!0):!1});return b};a.find_input=function(a,b,c){a=d(a,b);for(b=0;b<a.length;b++)if(a[b].type==c)return a[b];return null};a.get_inputs_by_type=function(a,b,c){a=d(a,b);b=[];for(var g=0;g<a.length;g++)a[g].type==c&&b.push(a[g]);return b};a.has_lower_subs=
D;a.has_upper_subs=K;a.get_inputs=d;a.get_outputs=t;a.find_subs=function(a,b){var c=null;G.traverse(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.debug_convert_to_dot=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=C(a);G.traverse(a,function(a,d){var g=b+="    ",e=L.subs_label(d);if(d.camera){for(var e=e+"\\n",k=0;k<c.length;k+=2){var f=d.camera.color_attachment;
c[k]==f&&(e=F.is_renderbuffer(f)?e+("CR"+c[k+1]+" "):e+("C"+c[k+1]+" "))}for(k=0;k<c.length;k+=2)f=d.camera.depth_attachment,c[k]==f&&(e=F.is_renderbuffer(f)?e+("DR"+c[k+1]):e+("D"+c[k+1]))}d.slinks_internal.length&&(e+="\\n-----\\n");for(k=0;k<d.slinks_internal.length;k++)e+=M(d.slinks_internal[k],a,null,c);k=d.type==L.SINK?"dotted":d.enqueue?"solid":"dashed";b=g+(String(a)+' [label="'+e+'" color="black" style="'+(k+",bold")+'"];\n')});G.traverse_edges(a,function(a,d,g){var e=b+="    ",k=M(g,a,d,
c);b=e+(String(a)+" -> "+String(d)+' [label="'+k+'" style="'+(g.active?"solid":"dotted")+'"];\n')});return b+="}"};a.create_rendering_queue=function(a){a=G.topsort_attr(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__subscene=function(a,r){function u(a,b){a.num_lights=b;a.light_directions=new Float32Array(3*b);a.light_positions=new Float32Array(4*b);a.light_color_intensities=new Float32Array(4*b)}function h(a){a={type:a,subtype:"",blend:!1,pack:!1,assign_texture:!1,need_fog_update:!1,debug_render_calls:0,debug_render_time:0,debug_render_time_queries:[],debug_view_mode:0,debug_colors_seed:0,debug_render_time_threshold:1,do_not_debug:!1,time:0,camera:null,cube_view_matrices:null,cube_cam_frustums:[],
draw_data:[],slinks_internal:[],textures_internal:[],wind:new Float32Array(3),grass_map_dim:new Float32Array(3),fog_color_density:new Float32Array(4),fog_params:new Float32Array(4),cube_fog:new Float32Array(16),sky_tex_default_value:0,environment_energy:0,num_lights:0,light_directions:null,light_positions:null,light_color_intensities:null,light_factors:null,horizon_color:new Float32Array(3),zenith_color:new Float32Array(3),sky_tex_fac:new Float32Array(4),sun_intensity:new Float32Array([0,0,0]),sun_direction:new Float32Array(3),
sun_quaternion:new Float32Array(4),sky_tex_color:new Float32Array(3),outline_factor:0,draw_outline_flag:0,is_for_outline:!1,outline_color:new Float32Array(3),water:!1,cam_water_depth:0,water_fog_color_density:null,water_waves_height:0,water_waves_length:0,water_level:0,water_params:null,caustics:!1,caust_scale:0,caust_speed:new Float32Array(2),caust_brightness:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,
scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,sky_color:new Float32Array(3),procedural_skydome:!1,ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,ssao_radius_increase:0,ssao_influence:0,ssao_dist_factor:0,ssao_samples:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,max_ray_length:0,radial_blur_step:0,steps_per_pass:0,csm_index:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,v_light_ts:null,
v_light_r:null,v_light_tsr:null,p_light_matrix:null,is_pp:!1,fxaa_quality:"",bloom_key:0,bloom_blur:0,bloom_edge_lum:0,blur_texel_size_mult:0,ext_texel_size_mult:0,mb_decay_threshold:0,mb_factor:0,motion_blur_exp:0,pp_effect:"",coc_type:"",jitter_projection_space:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,texel_size:new Float32Array(2),texel_mask:new Float32Array(2),distortion_params:new Float32Array(4),chromatic_aberration_coefs:new Float32Array(4),
enable_hmd_stereo:!1,shadow_lamp_index:0,need_draw_data_sort:!0,sky_invert:!1,sky_use_rgb_to_intensity:!1,sky_use_map_blend:!1,sky_use_map_horizon:!1,sky_use_map_zenith_up:!1,sky_use_map_zenith_down:!1,sky_blend_type:"",use_sky_blend:!1,use_sky_paper:!1,use_sky_real:!1,do_render:!0,enqueue:!0,clear_color:!0,clear_depth:!0,depth_test:!0,need_perm_uniforms_update:!0,texel_size_multiplier:1};a.texel_mask[0]=1;a.texel_mask[1]=1;a.distortion_params[2]=.5;a.distortion_params[3]=.5;return a}function b(a,
b){return a==b?0:a>b?1:-1}function f(a,c){return-b(a.alpha_clip,c.alpha_clip)||b(a.offset_z,c.offset_z)||b(a.shader.shader_id,c.shader.shader_id)}var l=r("__camera"),q=r("__config"),e=r("__util"),n=r("__boundings"),p=q.outlining;a.MAIN_OPAQUE=0;a.MAIN_BLEND=1;a.MAIN_XRAY=2;a.MAIN_PLANE_REFLECT=3;a.MAIN_CUBE_REFLECT=4;a.MAIN_PLANE_REFLECT_BLEND=5;a.MAIN_CUBE_REFLECT_BLEND=6;a.MAIN_GLOW=7;a.SHADOW_CAST=8;a.SHADOW_RECEIVE=9;a.GRASS_MAP=10;a.POSTPROCESSING=11;a.BLOOM_BLUR=12;a.GLOW_COMBINE=13;a.RESOLVE=
14;a.COLOR_PICKING=15;a.COLOR_PICKING_XRAY=16;a.DEBUG_VIEW=17;a.ANCHOR_VISIBILITY=18;a.DEPTH_PACK=19;a.SSAO=20;a.SSAO_BLUR=21;a.ANTIALIASING=22;a.SMAA_BLENDING_WEIGHT_CALCULATION=23;a.SMAA_EDGE_DETECTION=24;a.SMAA_RESOLVE=25;a.SMAA_NEIGHBORHOOD_BLENDING=26;a.COMPOSITING=27;a.MOTION_BLUR=28;a.COC=29;a.DOF=30;a.OUTLINE_MASK=31;a.OUTLINE=32;a.GOD_RAYS=33;a.GOD_RAYS_COMBINE=34;a.SKY=35;a.COPY=36;a.STEREO=37;a.LUMINANCE=38;a.AVERAGE_LUMINANCE=39;a.LUMINANCE_TRUNCED=40;a.BLOOM=41;a.VELOCITY=42;a.SINK=43;
a.PERFORMANCE=44;a.create_subs_shadow_cast=function(a,b,k,f){var n=h(8);n.csm_index=a;n.self_shadow_polygon_offset=k.self_shadow_polygon_offset;n.shadow_lamp_index=b;switch(k.lamp_types[b]){case "SPOT":case "POINT":n.camera=l.create_camera(l.TYPE_PERSP);a=e.rad_to_deg(k.spot_sizes[b]);l.set_frustum(n.camera,a,k.clip_start[b],k.clip_end[b]);break;default:n.camera=l.create_camera(l.TYPE_ORTHO_ASYMMETRIC)}u(n,f);return n};a.clone_subs=function(a){var b=a.camera;a.camera=null;var k=e.clone_object_r(a);
a.camera=b;k.camera=l.clone_camera(b,!0);return k};a.create_subs_grass_map=function(){var a=h(10);a.camera=l.create_camera(l.TYPE_ORTHO_ASPECT);return a};a.create_subs_postprocessing=function(a){var b=h(11);b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.is_pp=!0;b.camera=l.create_camera(l.TYPE_NONE);b.pp_effect=a;switch(a){case "NONE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "GRAYSCALE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "X_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_BLUR":b.texel_mask[0]=
0;b.texel_mask[1]=1;break;case "X_GLOW_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_GLOW_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_DOF_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "Y_DOF_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "X_ALPHA_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;b.texel_size_multiplier=3;break;case "Y_ALPHA_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;b.texel_size_multiplier=3;break;case "X_EXTEND":b.texel_mask[0]=1;b.texel_mask[1]=0;break;
case "Y_EXTEND":b.texel_mask[0]=0;b.texel_mask[1]=1;break;default:e.panic("Wrong postprocessing effect: "+a)}return b};a.create_subs_bloom_blur=function(a,b,k){a=h(12);a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=l.create_camera(l.TYPE_NONE);a.pp_effect=k;a.is_pp=!0;switch(k){case "X_BLUR":a.texel_mask[0]=1;a.texel_mask[1]=0;break;case "Y_BLUR":a.texel_mask[0]=0;a.texel_mask[1]=1;break;default:e.panic("Wrong postprocessing effect for bloom blur: "+k)}return a};a.create_subs_glow_combine=
function(a,b){var e=h(13);e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.small_glow_mask_coeff=b.glow_params.small_glow_mask_coeff;e.large_glow_mask_coeff=b.glow_params.large_glow_mask_coeff;e.small_glow_mask_width=b.glow_params.small_glow_mask_width;e.large_glow_mask_width=b.glow_params.large_glow_mask_width;e.camera=a;e.is_pp=!0;return e};a.create_subs_main=function(a,b,k,f,l,n,p,q,z){var y=h(a);0==a?(y.clear_color=!0,y.clear_depth=k,y.blend=!1):1==a?(y.clear_color=!1,y.clear_depth=!1,y.blend=
!0):2==a?(y.clear_color=!1,y.clear_depth=!0,y.blend=!0):3==a||4==a?(y.clear_color=!0,y.clear_depth=!0,y.blend=!1):5==a||6==a?(y.clear_color=!1,y.clear_depth=!1,y.blend=!0):7==a?(y.clear_color=!0,y.clear_depth=!1,y.blend=!0):e.panic("wrong main subscene type");y.blend&&q&&(y.self_shadow_normal_offset=q.self_shadow_normal_offset);y.camera=b;if(a=p.sky_texture_param)y.sky_tex_fac.set([a.blend_factor,a.horizon_factor,a.zenith_up_factor,a.zenith_down_factor]),y.sky_tex_color.set(a.color),y.sky_tex_default_value=
a.default_value;y.horizon_color.set(p.horizon_color);y.zenith_color.set(p.zenith_color);y.environment_energy=p.environment_energy;y.fog_color_density=n.fog_color_density;y.fog_params=n.fog_params;f&&(y.water_params=f,f.fog_color_density&&(y.water_fog_color_density=new Float32Array(f.fog_color_density)),y.water_waves_height=f.waves_height,y.water_waves_length=f.waves_length,y.water_level=f.water_level,f.caustics&&z&&(y.caustics=!0,y.caust_scale=f.caustic_scale,y.caust_brightness=f.caustic_brightness,
y.caust_speed.set(f.caustic_speed)));u(y,l);return y};a.create_subs_resolve=function(){var a=h(14);a.is_pp=!0;a.camera=l.create_camera(l.TYPE_NONE);return a};a.create_subs_color_picking=function(a,b,e){var f=h(15);b&&(f.type=16,f.clear_color=!1,f.clear_depth=!0);f.enqueue=!1;f.camera=a;u(f,e);return f};a.create_subs_debug_view=function(a){var b=h(17);b.do_render=!1;b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b};a.create_subs_anchor_visibility=function(a){var b=h(18);b.clear_color=!0;b.clear_depth=
!1;b.camera=a;return b};a.create_subs_shadow_receive=function(a,b,e){a=h(9);a.camera=b;u(a,e);return a};a.create_subs_depth_pack=function(a){var b=h(19);b.clear_color=!1;b.clear_depth=!1;b.camera=a;b.is_pp=!0;return b};a.create_subs_ssao=function(a,b,e){var f=h(20);f.clear_color=!1;f.clear_depth=!1;f.depth_test=!1;f.camera=a;f.fog_color_density=b.fog_color_density;f.water_fog_color_density=new Float32Array(b.fog_color_density);f.ssao_radius_increase=e.radius_increase;f.ssao_hemisphere=e.hemisphere;
f.ssao_influence=e.influence;f.ssao_dist_factor=e.dist_factor;f.ssao_samples=e.samples;f.is_pp=!0;return f};a.create_subs_ssao_blur=function(a,b){var e=h(21);e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=a;e.ssao_blur_depth=b.blur_depth;e.ssao_blur_discard_value=b.blur_discard_value;e.is_pp=!0;return e};a.create_subs_aa=function(a){var b=h(22);b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.texel_size_multiplier=1/a.resolution_factor;b.fxaa_quality=a.aa_quality;b.camera=l.create_camera(l.TYPE_NONE);
b.is_pp=!0;return b};a.create_subs_smaa=function(a,b){var e=h(a);e.clear_color=23==a||24==a?!0:!1;e.clear_depth=!1;e.depth_test=!1;e.texel_size_multiplier=1/b.resolution_factor;e.camera=l.create_camera(l.TYPE_NONE);23==a&&(e.jitter_subsample_ind=new Float32Array(4));e.is_pp=!0;return e};a.create_subs_compositing=function(a,b,e,f){var n=h(27);n.clear_color=!1;n.clear_depth=!1;n.depth_test=!1;n.camera=l.create_camera(l.TYPE_NONE);n.brightness=a;n.contrast=b;n.exposure=e;n.saturation=f;n.is_pp=!0;return n};
a.create_subs_motion_blur=function(a,b){var e=h(28);e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=l.create_camera(l.TYPE_NONE);e.assign_texture=!0;e.mb_decay_threshold=a;e.mb_factor=b;e.is_pp=!0;return e};a.create_subs_coc=function(a,b){var e=h(29);e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=a;e.texel_size_multiplier=e.camera.dof_power;e.coc_type=b;e.is_pp=!0;return e};a.create_subs_dof=function(a){var b=h(30);b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=
a;b.texel_size_multiplier=b.camera.dof_power;b.is_pp=!0;return b};a.create_subs_outline_mask=function(a,b){var e=h(31);e.depth_test=!1;e.camera=a;u(e,b);return e};a.create_subs_outline=function(a){var b=h(32);p.outlining_overview_mode?b.outline_color.set(p.outline_color):b.outline_color.set(a.outline_color);b.outline_factor=a.outline_factor;b.ext_texel_size_mult=5;b.blur_texel_size_mult=3;b.depth_test=!1;b.camera=l.create_camera(l.TYPE_NONE);b.is_pp=!0;return b};a.create_subs_god_rays=function(a,
b,e,f,l,n,p){var q=h(33);q.clear_color=!1;q.clear_depth=!1;q.depth_test=!1;q.horizon_color=new Float32Array([1,1,1]);q.zenith_color=new Float32Array([1,1,1]);q.environment_energy=1;q.pack=f;q.water=b;q.radial_blur_step=l;q.max_ray_length=e;q.steps_per_pass=p;q.camera=a;u(q,n);return q};a.create_subs_god_rays_comb=function(a,b){var e=h(34);e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=l.create_camera(l.TYPE_NONE);e.god_rays_intensity=a;u(e,b);e.is_pp=!0;return e};a.create_subs_sky=function(a,
b,k,f){var n=h(35);n.enqueue=!1;n.clear_color=!1;n.clear_depth=!1;n.depth_test=!1;var p=l.create_camera(l.TYPE_NONE);p.width=f;p.height=f;n.camera=p;n.cube_view_matrices=e.generate_cubemap_matrices();u(n,b);n.horizon_color=new Float32Array([1,1,1]);n.zenith_color=new Float32Array([1,1,1]);n.environment_energy=1;n.sky_color.set(k.sky_color);n.procedural_skydome=k.procedural_skydome;n.use_as_environment_lighting=k.use_as_environment_lighting;n.rayleigh_brightness=k.rayleigh_brightness;n.mie_brightness=
k.mie_brightness;n.spot_brightness=k.spot_brightness;n.scatter_strength=k.scatter_strength;n.rayleigh_strength=k.rayleigh_strength;n.mie_strength=k.mie_strength;n.rayleigh_collection_power=k.rayleigh_collection_power;n.mie_collection_power=k.mie_collection_power;n.mie_distribution=k.mie_distribution;n.procedural_skydome=k.procedural_skydome?!0:!1;if(a){n.horizon_color.set(a.horizon_color);n.zenith_color.set(a.zenith_color);n.environment_energy=a.environment_energy;if(b=a.sky_texture_param)n.sky_tex_fac.set([b.blend_factor,
b.horizon_factor,b.zenith_up_factor,b.zenith_down_factor]),n.sky_tex_color.set(b.color),n.sky_tex_default_value=b.default_value,n.sky_invert=b.invert,n.sky_use_rgb_to_intensity=b.use_rgb_to_intensity,n.sky_use_map_blend=b.use_map_blend,n.sky_use_map_horizon=b.use_map_horizon,n.sky_use_map_zenith_up=b.use_map_zenith_up,n.sky_use_map_zenith_down=b.use_map_zenith_down,n.sky_blend_type=b.blend_type;n.use_sky_blend=a.use_sky_blend;n.use_sky_paper=a.use_sky_paper;n.use_sky_real=a.use_sky_real}return n};
a.create_subs_copy=function(){var a=h(36);a.clear_color=!1;a.clear_depth=!1;a.camera=l.create_camera(l.TYPE_NONE);a.is_pp=!0;return a};a.create_subs_stereo=function(a){var b=h(37);b.clear_color=!1;b.clear_depth=!1;b.subtype=a?"HMD":"ANAGLYPH";b.camera=l.create_camera(l.TYPE_NONE);b.is_pp=!0;return b};a.create_subs_luminance=function(){var a=h(38);a.clear_color=!1;a.clear_depth=!1;a.camera=l.create_camera(l.TYPE_NONE);a.is_pp=!0;return a};a.create_subs_av_luminance=function(){var a=h(39);a.clear_color=
!1;a.clear_depth=!1;a.camera=l.create_camera(l.TYPE_NONE);a.is_pp=!0;return a};a.create_subs_luminance_trunced=function(a,b,e,f){var l=h(40);l.clear_color=!1;l.clear_depth=!1;l.bloom_key=a;l.bloom_edge_lum=b;l.camera=f;u(l,e);l.is_pp=!0;return l};a.create_subs_bloom_combine=function(a){var b=h(41);b.clear_color=!1;b.clear_depth=!1;b.camera=l.create_camera(l.TYPE_NONE);b.bloom_blur=a;b.is_pp=!0;return b};a.create_subs_veloctity=function(a){var b=h(42);b.clear_color=!1;b.clear_depth=!1;b.camera=a;b.is_pp=
!0;return b};a.create_subs_sink=function(){var a=h(43);a.enqueue=!1;return a};a.create_subs_perf=function(){var a=h(44);a.is_pp=!0;return a};a.subs_label=function(a){switch(a.type){case 0:return"MAIN OPAQUE";case 1:return"MAIN BLEND";case 2:return"MAIN XRAY";case 3:return"MAIN PLANE REFLECT";case 4:return"MAIN CUBE REFLECT";case 5:return"MAIN PLANE REFLECT BLEND";case 6:return"MAIN CUBE REFLECT BLEND";case 7:return"MAIN GLOW";case 8:return"SHADOW CAST";case 9:return"SHADOW RECEIVE";case 10:return"GRASS MAP";
case 11:return"POSTPROCESSING ("+a.pp_effect.replace(/_/g," ")+")";case 12:return"BLOOM BLUR";case 13:return"GLOW COMBINE";case 14:return"RESOLVE";case 15:return"COLOR PICKING";case 16:return"COLOR PICKING XRAY";case 17:return"DEBUG VIEW";case 18:return"ANCHOR VISIBILITY";case 19:return"DEPTH PACK";case 20:return"SSAO";case 21:return"SSAO BLUR";case 22:return"ANTIALIASING";case 23:return"SMAA BLENDING WEIGHT CALCULATION";case 24:return"SMAA EDGE DETECTION";case 25:return"SMAA RESOLVE";case 26:return"SMAA NEIGHBORHOOD BLENDING";
case 27:return"COMPOSITING";case 28:return"MOTION BLUR";case 29:return"COC";case 30:return"DOF";case 31:return"OUTLINE MASK";case 32:return"OUTLINE";case 33:return"GOD RAYS";case 34:return"GOD RAYS COMBINE";case 35:return"SKY";case 36:return"COPY";case 37:return"STEREO";case 38:return"LUMINANCE";case 39:return"AVERAGE LUMINANCE";case 40:return"LUMINANCE TRUNCED";case 41:return"BLOOM";case 42:return"VELOCITY";case 44:return"PERFORMANCE";case 43:return"SINK";default:return"UNKNOWN"}};a.append_draw_data=
function(a,b){var e=b.batch,f=e.shader;e.shader_updated=!1;for(var h=0;h<a.draw_data.length;h++){var l=a.draw_data[h].bundles,n=l.indexOf(b);-1!=n&&(l.splice(n,1),l.length||a.draw_data.splice(h,1))}h=a.blend?e.offset_z:0;a:{l=a.draw_data;for(n=0;n<l.length;n++){var p=l[n];if(p.shader==f&&h==p.offset_z){l=p;break a}}l=null}l?l.bundles.push(b):(a.draw_data.push({shader:f,bundles:[b],alpha_clip:e.alpha_clip,offset_z:h,do_render:!0}),a.need_draw_data_sort=!0)};a.init_bundle=function(a,b){var e={do_render:!0,
do_render_cube:[!0,!0,!0,!0,!0,!0],obj_render:b,batch:a,info_for_z_sort_updates:null};if(a.z_sort&&a.bufs_data.ibo_array){var f=a.bufs_data.ibo_array;e.info_for_z_sort_updates={median_cache:new Float32Array(f.length),median_world_cache:new Float32Array(f.length),dist_cache:new Float32Array(f.length/3),zsort_eye_last:new Float32Array(3),bb_min_side:n.calc_min_bb_side(a.bb_local)}}return e};a.sort_draw_data=function(a){a.draw_data.sort(f);a.need_draw_data_sort=!1}};b4w.module.__texcomp=function(a,r){function u(a,b,k,h){var q=new Int32Array(k,0,31),r,w,v,z,y,D;if(542327876!=q[0])return l.error("Invalid magic number in DDS header"),0;if(!q[20]&4)return l.error("Unsupported format, must contain a FourCC code"),0;r=q[21];switch(r){case e:w=8;v=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case n:w=16;v=b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case p:w=16;v=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return l.error("Unsupported FourCC code:",f(r)),null}D=
1;q[2]&131072&&!1!==h&&(D=Math.max(1,q[7]));z=q[4];y=q[3];q=q[1]+4;if(b)for(r=0;r<D;++r)h=Math.max(4,z)/4*Math.max(4,y)/4*w,b=new Uint8Array(k,q,h),a.compressedTexImage2D(a.TEXTURE_2D,r,v,z,y,0,b),q+=h,z=Math.max(.5*z,1),y=Math.max(.5*y,1);else if(r==e){Math.max(4,z);Math.max(4,y);k=b=new Uint16Array(k);w=q/2;v=z;var u=y,q=new Uint16Array(4);b=new Uint16Array(v*u);for(var d=0,t=0,C=t=d=r=0,M=0,x=0,g=0,H=v/4,u=u/4,G=0;G<u;G++)for(var ba=0;ba<H;ba++)r=w+4*(G*H+ba),q[0]=k[r],q[1]=k[r+1],d=q[0]&31,t=
q[0]&2016,C=q[0]&63488,M=q[1]&31,x=q[1]&2016,g=q[1]&63488,q[2]=5*d+3*M>>3|5*t+3*x>>3&2016|5*C+3*g>>3&63488,q[3]=5*M+3*d>>3|5*x+3*t>>3&2016|5*g+3*C>>3&63488,d=k[r+2],t=4*G*v+4*ba,b[t]=q[d&3],b[t+1]=q[d>>2&3],b[t+2]=q[d>>4&3],b[t+3]=q[d>>6&3],t+=v,b[t]=q[d>>8&3],b[t+1]=q[d>>10&3],b[t+2]=q[d>>12&3],b[t+3]=q[d>>14],d=k[r+3],t+=v,b[t]=q[d&3],b[t+1]=q[d>>2&3],b[t+2]=q[d>>4&3],b[t+3]=q[d>>6&3],t+=v,b[t]=q[d>>8&3],b[t+1]=q[d>>10&3],b[t+2]=q[d>>12&3],b[t+3]=q[d>>14];a.texImage2D(a.TEXTURE_2D,0,a.RGB,z,y,0,
a.RGB,a.UNSIGNED_SHORT_5_6_5,b);h&&a.generateMipmap(a.TEXTURE_2D)}else return l.error("No manual decoder for",f(r),"and no native support"),0;return D}function h(a,b,e,f,h,l){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="arraybuffer";n.onload=function(){if(200==n.status){a.bindTexture(a.TEXTURE_2D,f);var e=u(a,b,n.response,h);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<e?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&l(f)};n.send(null);
return f}function b(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var l=r("__print"),q=r("__util"),e=b("DXT1"),n=b("DXT3"),p=b("DXT5");a.upload_dds_levels=u;a.upload_pvr_levels=function(a,b,e){var f=new Uint32Array(e,0,13);if(55727696==f[0]){var h=f[7],l=f[6],n=f[11],p=52+f[12];switch(f[2]){case 0:var z=2,y=1;break;case 1:z=2;y=3;break;case 2:z=4;y=0;break;case 3:z=4;y=2;break;
default:q.panic("Unsupported PVR V3 format.")}}else if(559044176==f[11]){h=f[2];l=f[1];n=f[3];p=f[0];n++;var r=f[4]&255,f=0<f[10];25==r?(z=4,y=f?2:0):24==r?(z=2,y=f?3:1):q.panic("Unsupported PVR V2 format.")}else q.panic("Unsupported PVR version.");r=2==z?8:4;f=4;switch(y){case 0:var u=b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 1:u=b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 2:u=b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;case 3:u=b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=r*f*z/8;for(z=0;z<n;z++){var y=
Math.max(h>>z,1),d=Math.max(l>>z,1),t=y/r,C=d/f;2>t&&(t=2);2>C&&(C=2);t=t*C*b;C=new Uint8Array(e,p,t);a.compressedTexImage2D(a.TEXTURE_2D,z,u,y,d,0,C);p+=t}};a.get_width_height=function(a,b){switch(b){case "dds":var e=new Int32Array(a,0,31);return{width:e[4],height:e[3]};case "pvr":e=new Uint32Array(a,0,13);if(55727696==e[0])var f=e[7],e=e[6];else f=e[2],e=e[1];return{width:f,height:e}}};a.get_compress_ratio=function(a,b){var k=1;if("dds"==b){var h=new Int32Array(a,0,31),q=h[21];switch(q){case e:k=
6;break;case n:case p:k=4;break;default:l.error("Unsupported FourCC code:",f(q))}}else if("pvr"==b)if(h=new Uint32Array(a,0,13),55727696==h[0])switch(h[2]){case 0:k=12;break;case 1:k=16;break;case 2:k=6;break;case 3:k=8}else q=h[4]&255,h=0<h[10],25==q?k=h?8:6:24==q&&(k=h?16:12);return k};a.load_dds_texture=function(a,b,e,f){var l=a.createTexture();h(a,b,e,l,!0,f);return l}};b4w.module.__textures=function(a,r){function u(){return{name:"",type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,source_non_color:!1,allow_node_dds:!0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,is_movie:!1,vtex_data_id:-1,video_file:null,movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,need_resize:!1,scale_fac:1,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,
video_was_stopped:!1,use_auto_refresh:!1,use_cyclic:!1,use_nla:!1,repeat:!0,cleanup_gl_data_on_unload:!0}}function h(c,d,g,e){var k=c.type,f=new Uint8Array([204,204,204,255]),h=u();switch(k){case "DATA_TEX2D":case "IMAGE":var m=J.createTexture(),l=J.TEXTURE_2D;J.bindTexture(l,m);J.texImage2D(l,0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,f);c.image&&("Non-Color"==c.image.colorspace_settings_name&&(h.source_non_color=!0),"MOVIE"==c.image.source&&(h.is_movie=!0,h.frame_start=c.frame_start,h.frame_offset=c.frame_offset,
h.frame_duration=c.frame_duration,h.use_auto_refresh=c.use_auto_refresh,h.use_cyclic=c.use_cyclic,h.movie_length=c.movie_length,h.use_nla=c.b4w_nla_video,0!=h.frame_offset&&W.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.')));break;case "NONE":m=J.createTexture();l=J.TEXTURE_2D;J.bindTexture(l,m);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(g=Y.keysearch("name",c.b4w_source_id,g)))h.source_size=
c.b4w_source_size,g._render_to_textures=g._render_to_textures||[],g._render_to_textures.push(c),J.texImage2D(l,0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,f);else return null;break;case "ENVIRONMENT_MAP":m=J.createTexture();l=J.TEXTURE_CUBE_MAP;J.bindTexture(l,m);g="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)J.texImage2D(J["TEXTURE_CUBE_MAP_"+g[n]],0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,f);break;case "BLEND":return null;case "NODE_TEX":m=J.createTexture();
l=J.TEXTURE_2D;J.bindTexture(l,m);J.texImage2D(l,0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,f);break;default:return W.error('texture "'+c.name+'" has unsupported type "'+k+'"'),null}"NONE"==k&&(!c.b4w_enable_canvas_mipmapping||"CANVAS"!=c.b4w_source_type)||"DATA_TEX2D"==k||"IMAGE"==k&&"MOVIE"==c.image.source||"NODE_TEX"==k?J.texParameteri(l,J.TEXTURE_MIN_FILTER,J.LINEAR):J.texParameteri(l,J.TEXTURE_MIN_FILTER,na[da.texture_min_filter]);J.texParameteri(l,J.TEXTURE_MAG_FILTER,J.LINEAR);f=l;g=c.b4w_anisotropic_filtering;
"DEFAULT"===g&&(g=d);"OFF"!==g&&da.anisotropic_filtering&&(d=T.get_aniso())&&(g=parseFloat(g.split("x")[0]),J.texParameterf(f,d.TEXTURE_MAX_ANISOTROPY_EXT,g));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(h.repeat=!1,J.texParameteri(l,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(l,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE)):(J.texParameteri(l,J.TEXTURE_WRAP_S,J.REPEAT),J.texParameteri(l,J.TEXTURE_WRAP_T,J.REPEAT));h.type=a.TT_RGBA_INT;h.width=1;h.height=1;h.w_texture=m;h.w_target=l;"CANVAS"==c.b4w_source_type&&
"NONE"==k?(k=c.b4w_source_id,m=c.b4w_source_size,h.enable_canvas_mipmapping=c.b4w_enable_canvas_mipmapping,h.source_id=k,h.source="CANVAS",l=document.createElement("canvas"),l.width=m,l.height=m,h.canvas_context=l.getContext("2d"),e in va||(va[e]={}),va[e][k]=h,b(h)):"SCENE"==c.b4w_source_type&&"NONE"==k?(h.source_id=c.b4w_source_id,h.source="SCENE"):(h.source=k,J.generateMipmap(l),J.bindTexture(l,null));h.name=c.name;return c._render=h}function b(a){"CANVAS"!=a.source&&Y.panic("Wrong texture");var b=
a.w_target;J.bindTexture(b,a.w_texture);var c=m(a),d=A(a),g=E(a),e=a.canvas_context.canvas;J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!0);J.texImage2D(b,0,d,c,g,e);J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!1);a.enable_canvas_mipmapping&&J.generateMipmap(b);J.bindTexture(b,null);a.width=e.width;a.height=e.height}function f(a){var b=a.w_target;J.bindTexture(b,a.w_texture);J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!0);4!=a.video_file.length?a.need_resize?e(a,a.video_file,a.width*a.scale_fac,a.height*a.scale_fac,!1):J.texImage2D(b,
0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,a.video_file):J.texImage2D(b,0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,a.video_file);J.bindTexture(b,null)}function l(a){var b=a.w_target;J.bindTexture(b,a.w_texture);J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!0);a.need_resize?e(a,a.seq_video[a.seq_cur_frame],a.width*a.scale_fac,a.height*a.scale_fac,!1):J.texImage2D(b,0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,a.seq_video[a.seq_cur_frame]);J.bindTexture(b,null)}function q(){ra||(ra=document.createElement("canvas"));return ra}function e(a,
b,c,d,g){g||(p(J.TEXTURE_2D),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,b));J.bindTexture(J.TEXTURE_2D,null);Z.draw_resized_texture(a,c,d,R,S,"NONE")}function n(a,b,c,d,g){for(a=0;6>a;a++){var e=g[a],k=q();k.width=d;k.height=d;var f=k.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(f.translate(0,d),f.scale(1,-1)):(f.translate(d,0),f.scale(-1,1));f.drawImage(b,e[1]*c,e[2]*c,c,c,0,0,d,d);J.texImage2D(J["TEXTURE_CUBE_MAP_"+e[0]],0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,k)}}function p(a){R||
(R=J.createFramebuffer());J.bindTexture(a,null);S||(S=J.createTexture());J.bindTexture(a,S);J.texParameteri(a,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE);J.texParameteri(a,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE);J.texParameteri(a,J.TEXTURE_MAG_FILTER,J.LINEAR);J.texParameteri(a,J.TEXTURE_MIN_FILTER,J.LINEAR)}function B(a,b,d,g,f){var h=a.source,m=a.w_texture,l=a.w_target,t=1,x=1;J.bindTexture(l,m);if(4==b.length){var I=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==h)if(I)J.texImage2D(l,0,
J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(d){x=U.get_width_height(b,d);I=Y.check_npot(x.width)||Y.check_npot(x.height);if(x.width>fa.max_texture_size||x.height>fa.max_texture_size){W.error('Texture "'+g+'" has unsupported size: '+x.width+"x"+x.height+". Max available: "+fa.max_texture_size+"x"+fa.max_texture_size+".");return}t=x.width;x=x.height;if(I||"pvr"==d)a.need_resize=!0,p(l),t=k(t*a.scale_fac),x=k(x*a.scale_fac);"dds"==d?U.upload_dds_levels(J,T.get_s3tc(),b,!0):"pvr"==
d&&U.upload_pvr_levels(J,T.get_pvr(),b,!0);a.need_resize&&(e(a,null,t,x,!0),J.bindTexture(l,m),J.generateMipmap(l));a.width=t;a.height=x;a.compress_ratio=U.get_compress_ratio(b,d)}else{J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!0);a.is_movie?da.seq_video_fallback?(t=b[0].width,x=b[0].height):(t=b.videoWidth,x=b.videoHeight):(t=b.width,x=b.height);a.width=t;a.height=x;if(t>fa.max_texture_size||t>fa.max_texture_size)W.warn('Texture "'+g+'" has unsupported size: '+t+"x"+x+". Max available: "+fa.max_texture_size+
"x"+fa.max_texture_size+". Reduced image size will be used."),a.scale_fac=Math.min(fa.max_texture_size/t,fa.max_texture_size/x),a.need_resize=!0;a.is_movie&&(da.seq_video_fallback?(f in ua||(ua[f]={}),ua[f][a.name]=a,a.seq_video=b,a.seq_movie_length=b.length,a.fps=a.seq_fps*a.movie_length/b.length,b=b[0]):(f in ua||(ua[f]={}),ua[f][a.name]=a,a.video_file=b,a.video_file.loop=a.use_cyclic,a.fps=b.duration?a.movie_length/b.duration:ha.get_framerate(),Aa.disable_playback_rate_hack||(b.playbackRate=ha.get_framerate()/
a.fps,Aa.clamp_playback_rate_hack&&2<b.playbackRate&&(b.playbackRate=2)),c(a)));t=k(a.width*a.scale_fac);x=k(a.height*a.scale_fac);a.need_resize?(g=q(),d=g.getContext("2d"),g.width=t,g.height=x,d.drawImage(b,0,0,a.width,a.height,0,0,t,x),J.texImage2D(l,0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,g)):da.webgl2||!Y.check_npot(a.width)&&!Y.check_npot(a.height)?J.texImage2D(l,0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,b):(e(a,b,t,x,!1),a.need_resize=!0);m=a.w_texture;J.bindTexture(l,m);a.is_movie||J.generateMipmap(l);J.bindTexture(l,
null);a.width=t;a.height=x}else if("ENVIRONMENT_MAP"==h)if(t=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],I){for(g=0;6>g;g++)J.texImage2D(J["TEXTURE_CUBE_MAP_"+t[g][0]],0,J.RGBA,1,1,0,J.RGBA,J.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!1);if(b.width%3||b.height%2){W.error('Cubemap texture "'+g+'" has unsupported size: '+b.width+"x"+b.height+". The width must be multiple of three and the height - multiple of two.");
return}x=b.width/3;x>fa.max_cube_map_texture_size?(W.warn('Cubemap texture "'+g+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*fa.max_cube_map_texture_size+"x"+2*fa.max_cube_map_texture_size+". Reduced image size will be used."),g=k(fa.max_cube_map_texture_size/x*x),a.need_resize=!0):(g=k(x),!da.webgl2&&(3*g>fa.max_texture_size||2*g>fa.max_texture_size)&&(a.need_resize=!0));if(a.need_resize||da.resize_cubemap_canvas_hack)n(a,b,x,g,t);else{m=b;d=g;p(J.TEXTURE_2D);J.texImage2D(J.TEXTURE_2D,
0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,m);J.bindTexture(J.TEXTURE_2D,null);for(m=0;6>m;m++)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,J.RGBA,d,d,0,J.RGBA,J.UNSIGNED_BYTE,null);J.bindTexture(a.w_target,null);J.bindFramebuffer(J.FRAMEBUFFER,R);for(m=0;6>m;m++)Z.draw_resized_cubemap_texture(a,J.TEXTURE_CUBE_MAP_POSITIVE_X+m,d,x,S,m);J.bindFramebuffer(J.FRAMEBUFFER,null);J.bindTexture(a.w_target,a.w_texture);J.texParameteri(a.w_target,J.TEXTURE_MIN_FILTER,na[da.texture_min_filter]);J.texParameteri(a.w_target,
J.TEXTURE_MAG_FILTER,J.LINEAR)}Q.check_ff_cubemap_out_of_memory()&&(W.warn("Firefox detected, setting max cubemap size to 256, use canvas for resizing."),n(a,b,x,L.NVIDIA_OLD_GPU_CUBEMAP_MAX_SIZE,t));a.width=3*g;a.height=2*g;J.generateMipmap(l)}else if("DATA_TEX2D"==h||"NODE_TEX"==h)J.texImage2D(l,0,J.RGBA,b.width,b.height,0,J.RGBA,J.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height;J.bindTexture(l,null)}function c(a){a.video_file.oncanplay=function(){f(a)}}function k(a){return Y.check_npot(a)?
(a=Math.pow(2,parseInt(a).toString(2).length),Y.clamp(a,2,fa.max_texture_size)):a}function m(b){var c;switch(b.type){case a.TT_RGBA_INT:c=J.RGBA;break;case a.TT_RGB_INT:c=J.RGB;break;case a.TT_RGBA_FLOAT:c=J.RGBA;break;case a.TT_RGB_FLOAT:c=J.RGB;break;case a.TT_DEPTH:c=J.DEPTH_COMPONENT;break;default:Y.panic("Wrong texture type")}return c}function A(b){var c;switch(b.type){case a.TT_RGBA_INT:c=da.webgl2?J.RGBA8:J.RGBA;break;case a.TT_RGB_INT:c=da.webgl2?J.RGB8:J.RGB;break;case a.TT_RGBA_FLOAT:c=
da.webgl2?J.RGBA8:J.RGBA;break;case a.TT_RGB_FLOAT:c=da.webgl2?J.RGB8:J.RGB;break;case a.TT_DEPTH:c=da.webgl2?J.DEPTH_COMPONENT24:J.DEPTH_COMPONENT;break;default:Y.panic("Wrong texture type")}return c}function E(b){var c;switch(b.type){case a.TT_RGBA_INT:c=J.UNSIGNED_BYTE;break;case a.TT_RGB_INT:c=J.UNSIGNED_BYTE;break;case a.TT_RGBA_FLOAT:c=J.FLOAT;break;case a.TT_RGB_FLOAT:c=J.FLOAT;break;case a.TT_DEPTH:c=J.UNSIGNED_INT;break;default:Y.panic("Wrong texture type")}return c}function w(a){return a&&
a.name&&a.w_renderbuffer?!0:!1}function v(a,b){var c=null;switch(a){case "SSAO_TEXTURE":c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};h(c,null,b,0);c.image={filepath:null};break;case "NODE_TEX":c={name:"",type:"NODE_TEX",extension:"CLIP",b4w_anisotropic_filtering:"OFF"},h(c,null,b,0),c.image={filepath:null}}return c}function z(a,b){if(b in ua&&a in ua[b]){var c=ua[b][a];c.video_file?c.video_file.play():c.seq_video&&(c.seq_video_played=!0);return!0}return!1}
function y(a,b){if(b in ua&&a in ua[b]){var c=ua[b][a];c.video_file?c.video_file.pause():c.seq_video&&(c.seq_video_played=!1);return!0}return!1}function D(a,b){if(b in ua&&a in ua[b]){var c=ua[b][a];c.video_file?c.video_file.currentTime=c.frame_offset/c.fps:c.seq_video&&(c.seq_cur_frame=d(c,c.frame_offset),l(c));return!0}return!1}function K(a){return a.video_file?!a.video_file.paused:a.seq_video?a.seq_video_played:!1}function d(a,b){return Math.round(b*a.seq_movie_length/a.movie_length)}function t(a,
b){if(N.is_dynamic(a))return C(a,b);for(var c=a.meta_objects,d=0;d<c.length;d++){var g=C(c[d],b);if(g)return g}return null}function C(a,b){var c=a.scenes_data;if(c.length)for(var c=c[0].batches,d=0;d<c.length;d++){var g=c[d];if("MAIN"==g.type||"SKY"==g.type)for(var e=0;e<g.textures.length;e++)if(g.textures[e].name==b)return g.textures[e]}return null}function M(a,b,c){a=a.scenes_data;if(a.length){a=a[0].batches;for(var d=0;d<a.length;d++){var g=a[d];if("MAIN"==g.type)for(var e=0;e<g.textures.length;e++)g.textures[e].name==
b&&(g.textures[e]=c)}}}function x(a,b){var c=a.scenes_data;if(c.length)for(var c=c[0].batches,d=0;d<c.length;d++){var g=c[d];if("MAIN"==g.type)for(var e=0;e<g.textures.length;e++){var k=g.textures[e];-1==sa.indexOf(k.source)&&-1==b.indexOf(k.name)&&b.push(k.name)}}}function g(a,b,c){var d=a.elements;a=a.interpolation;for(var g=0;g<b;g++){var e=g/(b-1),k=H(d,e,!0),f=G(d,e,!0);if(k&&f)if("CONSTANT"==a)c.push.apply(c,k.color);else{var h=c,m=k,l=f;if(m==l)h.push.apply(h,m.color);else{var n=ca.linear_interpolation(l.color[0],
l.position,m.color[0],m.position,e);h.push(n);n=ca.linear_interpolation(l.color[1],l.position,m.color[1],m.position,e);h.push(n);n=ca.linear_interpolation(l.color[2],l.position,m.color[2],m.position,e);h.push(n);m=ca.linear_interpolation(l.color[3],l.position,m.color[3],m.position,e);h.push(m)}}f&&!k&&c.push.apply(c,f.color);k&&!f&&c.push.apply(c,k.color)}}function H(a,b,c){for(var d=null,g=0;g<a.length;g++){var e=c?b-a[g].position:b-a[g][1][0];0<=e&&(d?e<=(c?b-d.position:b-a[g][1][0])&&(d=a[g]):
d=a[g])}return d}function G(a,b,c){for(var d=null,g=0;g<a.length;g++){var e=c?a[g].position-b:a[g][1][0]-b;0<=e&&(d?e<=(c?d.position-b:d[1][0]-b)&&(d=a[g]):d=a[g])}return d}function ba(a,b){var c=a.texture,d=c._render,c=c.image;d&&b&&c&&B(d,b,c._is_compressed,c.filepath);return d}var L=r("__compat"),F=r("__config"),U=r("__texcomp"),Q=r("__debug"),T=r("__extensions"),W=r("__print"),ha=r("__time"),Y=r("__util"),Z=r("__renderer"),N=r("__obj_util"),ca=r("__curve"),I=r("__vec3"),ma=r("__scenes"),da=F.defaults,
fa=F.context_limits,Aa=F.sfx,ra=null,S=null,R=null;a.TF_NEAREST=0;a.TF_LINEAR=0;a.TF_NEAREST_MIPMAP_NEAREST=0;a.TF_LINEAR_MIPMAP_NEAREST=0;a.TF_NEAREST_MIPMAP_LINEAR=0;a.TF_LINEAR_MIPMAP_LINEAR=0;a.TT_RGBA_INT=10;a.TT_RGB_INT=20;a.TT_RGBA_FLOAT=30;a.TT_RGB_FLOAT=40;a.TT_DEPTH=50;a.TT_RB_RGBA=60;a.TT_RB_DEPTH=70;a.TT_RB_RGBA_MS=80;a.TT_RB_DEPTH_MS=90;a.CURVE_NODES_TEXT_SIZE=128;a.COLORRAMP_TEXT_SIZE=128;a.PART_COLORRAMP_TEXT_SIZE=128;var sa=["NONE","NODE_TEX","SSAO_TEXTURE"],va={},ua={},J=null,na;
a.setup_context=function(b){na=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.TF_NEAREST=b.NEAREST;a.TF_LINEAR=b.LINEAR;a.TF_NEAREST_MIPMAP_NEAREST=b.NEAREST_MIPMAP_NEAREST;a.TF_LINEAR_MIPMAP_NEAREST=b.LINEAR_MIPMAP_NEAREST;a.TF_NEAREST_MIPMAP_LINEAR=b.NEAREST_MIPMAP_LINEAR;a.TF_LINEAR_MIPMAP_LINEAR=b.LINEAR_MIPMAP_LINEAR;J=b};a.get_canvas_context=function(a,b){return b in va&&a in va[b]?va[b][a].canvas_context:null};a.update_canvas_context=function(a,
c){return c in va&&a in va[c]?(b(va[c][a]),!0):!1};a.create_texture=function(b,c,d){var g=u();g.name=b;g.type=c;g.source="NONE";c==a.TT_RB_RGBA||c==a.TT_RB_DEPTH||c==a.TT_RB_RGBA_MS||c==a.TT_RB_DEPTH_MS?g.w_renderbuffer=J.createRenderbuffer():(b=J.TEXTURE_2D,c=J.createTexture(),J.bindTexture(b,c),J.texParameteri(b,J.TEXTURE_MAG_FILTER,J.LINEAR),J.texParameteri(b,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(b,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(b,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),da.webgl2&&
d&&J.texParameterf(b,J.TEXTURE_COMPARE_MODE,J.COMPARE_REF_TO_TEXTURE),J.bindTexture(b,null),g.w_target=b,g.w_texture=c);return g};a.create_cubemap_texture=function(b,c){var d=J.createTexture(),g=J.TEXTURE_CUBE_MAP;J.bindTexture(g,d);J.texParameteri(g,J.TEXTURE_MAG_FILTER,J.LINEAR);J.texParameteri(g,J.TEXTURE_MIN_FILTER,J.LINEAR);J.texParameteri(g,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE);J.texParameteri(g,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE);for(var e="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
k=0;6>k;k++)J.texImage2D(J[e[k]],0,J.RGBA,c,c,0,J.RGBA,J.UNSIGNED_BYTE,null);J.bindTexture(g,null);g=u();g.name=b;g.type=a.TT_RGBA_INT;g.source="NONE";g.width=3*c;g.height=2*c;g.compress_ratio=1;g.w_texture=d;g.w_target=J.TEXTURE_CUBE_MAP;return g};a.set_filters=function(a,b,c){if(!w(a)){var d=a.w_target;J.bindTexture(d,a.w_texture);b&&J.texParameteri(d,J.TEXTURE_MIN_FILTER,b);c&&J.texParameteri(d,J.TEXTURE_MAG_FILTER,c);J.bindTexture(d,null)}};a.get_filters=function(b){if(w(b))return{min:a.TF_NEAREST,
mag:a.TF_NEAREST};var c=b.w_target;J.bindTexture(c,b.w_texture);b=J.getTexParameter(c,J.TEXTURE_MIN_FILTER);var d=J.getTexParameter(c,J.TEXTURE_MAG_FILTER);J.bindTexture(c,null);return{min:b,mag:d}};a.resize=function(b,c,d){c=Math.max(c,da.edge_min_tex_size_hack?2:1);d=Math.max(d,da.edge_min_tex_size_hack?2:1);if(b.width!=c||b.height!=d){switch(b.type){case a.TT_RB_RGBA:J.bindRenderbuffer(J.RENDERBUFFER,b.w_renderbuffer);J.renderbufferStorage(J.RENDERBUFFER,J.RGB565,c,d);J.bindRenderbuffer(J.RENDERBUFFER,
null);break;case a.TT_RB_DEPTH:J.bindRenderbuffer(J.RENDERBUFFER,b.w_renderbuffer);J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_COMPONENT16,c,d);J.bindRenderbuffer(J.RENDERBUFFER,null);break;case a.TT_RB_RGBA_MS:J.bindRenderbuffer(J.RENDERBUFFER,b.w_renderbuffer);J.renderbufferStorageMultisample(J.RENDERBUFFER,da.msaa_samples,J.RGBA8,c,d);J.bindRenderbuffer(J.RENDERBUFFER,null);break;case a.TT_RB_DEPTH_MS:J.bindRenderbuffer(J.RENDERBUFFER,b.w_renderbuffer);J.renderbufferStorageMultisample(J.RENDERBUFFER,
da.msaa_samples,J.DEPTH_COMPONENT24,c,d);J.bindRenderbuffer(J.RENDERBUFFER,null);break;default:var g=b.w_target;J.bindTexture(g,b.w_texture);var e=m(b),k=A(b),f=E(b);J.texImage2D(g,0,k,c,d,0,e,f,null);J.bindTexture(g,null)}c>fa.max_texture_size||d>fa.max_texture_size?Y.panic('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+fa.max_texture_size+"x"+fa.max_texture_size+"."):(b.width=c,b.height=d)}};a.create_texture_bpy=h;a.update_video_texture=f;a.update_seq_video_texture=
l;a.update_texture=B;a.calc_pot_size=k;a.delete_texture=function(a){J.deleteTexture(a)};a.is_texture=function(a){return a&&a.name&&(a.w_texture||a.w_renderbuffer)?!0:!1};a.is_renderbuffer=w;a.is_float=function(b){return b.type==a.TT_RGBA_FLOAT||b.type==a.TT_RGB_FLOAT?!0:!1};a.get_texture_texel_size=function(b){var c=0;switch(b.type){case a.TT_RGBA_INT:case a.TT_RGB_INT:c=4;break;case a.TT_RGBA_FLOAT:case a.TT_RGB_FLOAT:c=16;break;case a.TT_DEPTH:c=3;break;case a.TT_RB_RGBA:case a.TT_RB_DEPTH:c=2;
break;case a.TT_RB_RGBA_MS:c=4*da.msaa_samples;break;case a.TT_RB_DEPTH_MS:c=3*da.msaa_samples}return c};a.generate_texture=v;a.cleanup=function(){if(!da.seq_video_fallback)for(var a in ua)for(var b in ua[a])ua[a][b].video_file.pause(),ua[a][b].video_file.src="",ua[a][b].video_file.load();va={};ua={}};a.pause=function(){for(var a in ua)for(var b in ua[a]){var c=ua[a][b];K(c)&&(y(b,a),c.video_was_stopped=!0)}};a.reset=function(){for(var a in ua)for(var b in ua[a])D(b,a),ua[a][b].video_was_stopped=
!1};a.play=function(a){for(var b in ua)for(var c in ua[b]){var d=ua[b][c];if(!a||d.video_was_stopped)z(c,b),d.video_was_stopped=!1}};a.video_allow_nla=function(a,b){return b in ua&&a in ua[b]?ua[b][a].use_nla:!1};a.play_video=z;a.pause_video=y;a.reset_video=D;a.set_frame_video=function(a,b,c){return c in ua&&a in ua[c]?(a=ua[c][a],a.video_file?a.video_file.currentTime=b/a.fps:a.seq_video&&(a.seq_cur_frame=b,l(a)),!0):!1};a.video_is_played=K;a.video_update_is_available=function(a){return a.video_file||
a.seq_video?a.video_file?2<=a.video_file.readyState:!0:0};a.video_get_current_frame=function(a){return a.video_file||a.seq_video?a.video_file?Math.round(a.video_file.currentTime*a.fps):a.seq_cur_frame:0};a.video_get_start_frame=function(a){return a.video_file||a.seq_video?a.video_file?a.frame_offset:d(a,a.frame_offset):0};a.video_get_end_frame=function(a){if(!a.video_file&&!a.seq_video)return 0;var b=Math.min(a.frame_duration,a.movie_length-a.frame_offset);return a.video_file?a.frame_offset+b:d(a,
a.frame_offset+b)};a.seq_video_get_discrete_timemark=function(a,b){return Math.round(b*a.seq_fps*(ha.get_framerate()/a.fps))};a.video_get_duration=function(a){return Math.min(a.frame_duration,a.movie_length-a.frame_offset)};a.video_frame_to_seq_frame=d;a.get_canvas_context_by_object=function(a,b){var c=t(a,b);return c&&"CANVAS"==c.source?c.canvas_context:null};a.update_canvas_context_by_object=function(a,c){var d=t(a,c);return d&&"CANVAS"==d.source?(b(d),!0):!1};a.get_texture_names=function(a){var b=
[];if(N.is_dynamic(a))x(a,b);else{a=a.meta_objects;for(var c=0;c<a.length;c++)x(a[c],b)}return b};a.share_batch_canvas_textures=function(a){for(var c={},d=0;d<a.length;d++){for(var g=a[d].textures,e=[],k=0;k<g.length;k++){var f=g[k];if("CANVAS"==f.source)if(f.name in c)f=c[f.name];else{var h=g[k],f=u();f.name=h.name;f.source="CANVAS";f.width=h.width;f.height=h.height;f.enable_canvas_mipmapping=h.enable_canvas_mipmapping;f.type=h.type;h=document.createElement("canvas");h.width=f.width;h.height=f.height;
f.canvas_context=h.getContext("2d");f.w_target=J.TEXTURE_2D;f.w_texture=J.createTexture();J.bindTexture(J.TEXTURE_2D,f.w_texture);f.enable_canvas_mipmapping?J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,na[da.texture_min_filter]):J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR);J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR);J.bindTexture(J.TEXTURE_2D,null);h=f;h.canvas_context.drawImage(g[k].canvas_context.canvas,0,0);b(h);c[f.name]=f}e.push(f)}a[d].textures=e}};a.create_color_ramp_texture=
function(a,b){for(var c=[],d=0;d<a.length;d++)g(a[d].data.value.color_ramp,b,c);return new Uint8Array(c.map(function(a){return Y.clamp(255*a,0,255)}))};a.calc_color_ramp_data=g;a.create_vec_curve_texture=function(a,b){for(var c=new Float32Array(3),d=new Float32Array(3),g=[],e=0;e<a.length;e++){for(var k=a[e].data.value,f=[],h=k.curve_mapping.curves_data,m=k.curve_mapping.curve_extend,l=k.curve_mapping.curves_handle_types,k=0;k<h.length;k++){for(var n=m[k],t=h[k],p=[],q=l[k],x=0;x<t.length;x++)p.push([new Float32Array(3),
new Float32Array(t[x].concat(0)),new Float32Array(3)]);ca.calchandle_curvemap(p[0],null,p[1],q[0],q[0]);for(x=1;x<p.length-1;x++)ca.calchandle_curvemap(p[x],p[x-1],p[x+1],q[x],q[x]);ca.calchandle_curvemap(p[p.length-1],p[p.length-2],null,q[p.length-1],q[p.length-1]);if(2<p.length){if("AUTO"==q[0]){I.subtract(p[0][2],p[0][1],c);x=I.length(c);I.copy(p[1][0],d);d[0]<p[0][1][0]&&(d[0]=p[0][1][0]);I.subtract(d,p[0][1],d);var v=I.length(d);1E-8<v&&(I.scale(d,x/v,d),I.add(p[0][1],d,p[0][2]),I.subtract(p[0][1],
d,p[0][0]))}t=p.length-1;"AUTO"==q[0]&&(I.subtract(p[t][0],p[t][1],c),x=I.length(c),I.copy(p[t-1][2],d),d[0]>p[t][1][0]&&(d[0]=p[t][1][0]),I.subtract(d,p[t][1],d),v=I.length(d),1E-8<v&&(I.scale(d,x/v,d),I.add(p[t][1],d,p[t][0]),I.subtract(p[t][1],d,p[t][2])))}for(t=0;t<p.length-1;t++)ca.correct_bezpart(p[t][1],p[t][2],p[t+1][0],p[t+1][1]);t=[];3>=h.length?(x=Math.round(-b/2),q=Math.round(b/2)):(x=0,q=b);for(;x<q;x++){var v=x/(q-1),w=H(p,v,!1),P=G(p,v,!1);w&&P?t.push(ca.bezier(v,w[1],w[2],P[0],P[1],
.001)):P&&!w?"EXTRAPOLATED"==n?(v=P[1][0]==P[2][0]?P[1][1]:ca.linear(v,P[1],P[2]),t.push(v)):t.push(P[1][1]):w&&!P&&("EXTRAPOLATED"==n?(v=w[0][0]==w[1][0]?w[1][1]:ca.linear(v,w[0],w[1]),t.push(v)):t.push(w[1][1]))}f.push(t)}g.push(f)}c=[];for(x=0;x<g.length;x++)for(f=g[x],k=0;k<f[0].length;k++)3>=f.length?(d=Y.clamp(127.5*(f[0][k]+1),0,255),e=Y.clamp(127.5*(f[1][k]+1),0,255),h=Y.clamp(127.5*(f[2][k]+1),0,255),t=255):(d=Y.clamp(255*f[0][k],0,255),e=Y.clamp(255*f[1][k],0,255),h=Y.clamp(255*f[2][k],
0,255),t=Y.clamp(255*f[3][k],0,255)),c.push(d,e,h,t);return new Uint8Array(c)};a.change_image=function(a,b,c){var d=t(a,b);if(d){if("WORLD"!=a.type){var g;g=u();g.name=d.name;g.type=d.type;g.source=d.source;g.source_id=d.source_id;g.width=d.width;g.height=d.height;g.compress_ratio=d.compress_ratio;g.source_non_color=d.source_non_color;g.allow_node_dds=d.allow_node_dds;g.source_size=d.source_size;g.enable_canvas_mipmapping=d.enable_canvas_mipmapping;g.canvas_context=d.canvas_context;g.w_target=d.w_target;
g.w_texture=d.w_texture;g.w_renderbuffer=d.w_renderbuffer;g.is_movie=d.is_movie;g.vtex_data_id=d.vtex_data_id;g.video_file=d.video_file;g.movie_length=d.movie_length;g.fps=d.fps;g.frame_start=d.frame_start;g.frame_offset=d.frame_offset;g.frame_duration=d.frame_duration;g.need_resize=d.need_resize;g.scale_fac=d.scale_fac;g.seq_video=d.seq_video;g.seq_movie_length=d.seq_movie_length;g.seq_fps=d.seq_fps;g.seq_cur_frame=d.seq_cur_frame;g.seq_video_played=d.seq_video_played;g.seq_last_discrete_mark=d.seq_last_discrete_mark;
g.video_was_stopped=d.video_was_stopped;g.use_auto_refresh=d.use_auto_refresh;g.use_cyclic=d.use_cyclic;g.use_nla=d.use_nla;g.repeat=d.repeat;g.cleanup_gl_data_on_unload=d.cleanup_gl_data_on_unload;var e=g;J.bindTexture(d.w_target,d.w_texture);var k=J.getTexParameter(d.w_target,J.TEXTURE_MAG_FILTER),f=J.getTexParameter(d.w_target,J.TEXTURE_MIN_FILTER),h=J.getTexParameter(d.w_target,J.TEXTURE_WRAP_S),d=J.getTexParameter(d.w_target,J.TEXTURE_WRAP_T);e.w_texture=J.createTexture();J.bindTexture(e.w_target,
e.w_texture);J.texParameteri(e.w_target,J.TEXTURE_MAG_FILTER,k);J.texParameteri(e.w_target,J.TEXTURE_MIN_FILTER,f);J.texParameteri(e.w_target,J.TEXTURE_WRAP_S,h);J.texParameteri(e.w_target,J.TEXTURE_WRAP_T,d);J.bindTexture(e.w_target,null);d=g;if(N.is_dynamic(a))M(a,b,d);else for(a=a.meta_objects,e=0;e<a.length;e++)M(a[e],b,d);B(g,c,!1,c.src,0)}else B(d,c,!1,c.src,0),ma.update_sky_texture(a);return!0}return!1};a.get_batch_texture=ba;a.generate_batch_texure=function(a,b){var c={texture:v("NODE_TEX",
null)};return ba(c,{width:b,height:a.length/(4*b),data:a})};a.reset_mod=function(){J=null}};b4w.module.__assets=function(a,r){function u(){return A.is_built_in_data()?r(A.paths.built_in_data_module).data:null}function h(){var a={_source_url:null,_parse_response:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},
open:function(b,c,d){a._source_url=c;a.readyState=1},send:function(){a.status=404;a.readyState=4;var b=u();b&&a._source_url in b&&(a.status=200,b[a._source_url]&&(a.response=a._parse_response(b[a._source_url])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var c=0,d=0;d<b.length;d++){var k=b[d];20===k.state&&c++;if(c>=K.max_requests)break;if(10===k.state)switch(k.state=20,c++,k.type){case a.AT_ARRAYBUFFER:f(k,"arraybuffer");break;
case a.AT_JSON:f(k,"json");break;case a.AT_TEXT:f(k,"text");break;case a.AT_AUDIOBUFFER:l(k);break;case a.AT_IMAGE_ELEMENT:q(k);break;case a.AT_AUDIO_ELEMENT:e(k);break;case a.AT_VIDEO_ELEMENT:n(k);break;case a.AT_SEQ_VIDEO_ELEMENT:p(k);break;default:z.panic("Wrong asset type: "+k.type)}}}function f(b,c){var d=u(),e=d&&b.url in d?new h:new XMLHttpRequest,d=null;if("GET"==b.request)e.open("GET",b.url,!0);else if("POST"==b.request)switch(e.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:d="text/plain";
break;case a.APT_JSON:d="application/json"}if(b.overwrite_header)for(var k in b.overwrite_header)"Content-Type"==k?d=b.overwrite_header[k]:e.setRequestHeader(k,b.overwrite_header[k]);d&&e.setRequestHeader("Content-Type",d);"text"==c?(e.overrideMimeType("text/plain"),e.responseType="text"):"json"==c?(e.overrideMimeType("application/json"),e.responseType="text"):e.responseType=c;e.onreadystatechange=function(){if(40!=b.state&&4==e.readyState){if(200==e.status||0==e.status){var a=e.response;if(a){if("json"==
c&&"string"==typeof a)try{a=JSON.parse(a,b.json_reviver)}catch(d){w.error(d+" (parsing JSON "+b.url+")");b.asset_cb(null,b.id,b.type,b.url,b.param);return}b.asset_cb(a,b.id,b.type,b.url,b.param)}else w.error("empty responce when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param)}else w.error(e.status+" when trying to get "+b.url),b.asset_cb(null,b.id,b.type,b.url,b.param);b.state=30}};e.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);
e.send(b.post_data)}function l(a){"GET"!=a.request&&z.panic("Unsupported request type for audio buffer");var b=u(),c=b&&a.url in b?new h:new XMLHttpRequest;c.open("GET",a.url,!0);c.responseType="arraybuffer";c.onreadystatechange=function(){if(40!=a.state&&4==c.readyState)if(200==c.status||0==c.status){var b=c.response;b?v.decode_audio_data(b,function(b){a.asset_cb(b,a.id,a.type,a.url,a.param);a.state=30},function(){a.asset_cb(null,a.id,a.type,a.url,a.param);w.error("failed to decode "+a.url);a.state=
30}):(a.asset_cb(null,a.id,a.type,a.url,a.param),w.error("empty responce when trying to get "+a.url),a.state=30)}else a.asset_cb(null,a.id,a.type,a.url,a.param),w.error(c.status+" when trying to get "+a.url),a.state=30};c.send(a.post_data)}function q(a){"GET"!=a.request&&z.panic("Unsupported request type for image element");var b=document.createElement("img");D.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)};b.addEventListener("error",
function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),w.error("could not load image: "+a.url),a.state=30)},!1);var d=u();if(d&&a.url in d)if(d[a.url]){var e=c(a.url);b.src="data:"+e+";base64,"+d[a.url]}else E.is_ie11()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.url}function e(a){"GET"!=a.request&&z.panic("Unsupported request type for audio element");var b=document.createElement("audio");D.allow_cors&&
(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),w.error("could not load sound: "+a.url),a.state=30)},!1);b.addEventListener("stalled",function(){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url,a.param),w.error("could not load sound: "+a.url),a.state=30)},!1);var c=u();if(c&&a.url in c)if(c[a.url]){var d=k(a.url);
b.src="data:"+d+";base64,"+c[a.url];40!=a.state&&(a.asset_cb(b,a.id,a.type,a.url,a.param),a.state=30)}else E.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.url,D.is_mobile_device&&b.load();D.mobile_firefox_media_hack&&(b.autoplay=!0,b.pause());setTimeout(function(){b.some_prop_to_prevent_gc=1},5E3)}function n(a){function b(c){40!=a.state&&(a.asset_cb(null,a.id,a.type,a.url),w.error("could not load video: "+
a.url,a.param),a.state=30)}"GET"!=a.request&&z.panic("Unsupported request type for video element");var c=document.createElement("video");c.muted=!0;if(D.allow_cors||D.is_mobile_device)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.asset_cb(c,a.id,a.type,a.url,a.param),a.state=30)},!1);c.addEventListener("error",b,!1);var d=u();if(d&&a.url in d)if(d[a.url]){var e=m(a.url);c.src="data:"+e+";base64,"+d[a.url];40!=a.state&&c.addEventListener("loadeddata",
function(){a.asset_cb(c,a.id,a.type,a.url,a.param);a.state=30},!1)}else E.is_ie11()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.url,D.is_mobile_device&&c.load();D.mobile_firefox_media_hack&&(c.autoplay=!0,c.pause());setTimeout(function(){c.some_prop_to_prevent_gc=1},1E4)}function p(b){function c(a){b.asset_cb(a,b.id,b.type,b.url,b.param);b.state=30}"GET"!=b.request&&z.panic("Unsupported request type for seq video element");
var d=u(),e=d&&b.url in d?new h:new XMLHttpRequest;if(null==b.post_type&&null==b.post_data)e.open("GET",b.url,!0);else switch(e.open("POST",b.url,!0),b.post_type){case a.APT_TEXT:e.setRequestHeader("Content-type","text/plain");break;case a.APT_JSON:e.setRequestHeader("Content-type","application/json")}e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=b.state&&4==e.readyState)if(200==e.status||0==e.status){var a=e.response;a?B(a,c):(b.asset_cb(null,b.id,b.type,b.url,b.param),w.error("empty responce when trying to get "+
b.url),b.state=30)}else b.asset_cb(null,b.id,b.type,b.url,b.param),w.error(e.status+" when trying to get "+b.url),b.state=30};e.addEventListener("progress",function(a){a.lengthComputable&&b.progress_cb(a.loaded/a.total)},!1);e.send(b.post_data)}function B(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],k={images:[],blobs:[],fps:c[4]},f=20,h=0;h<e;h++){var m=c[f/4],l=d.subarray(f+4,f+4+m),l=new Blob([l],{type:"image/jpg"}),n=document.createElement("img");n.src=window.URL.createObjectURL(l);
k.images.push(n);k.blobs.push(l);f+=m+8-m%4}n.onload=function(){for(var a=0;a<k.images.length;a++)window.URL.revokeObjectURL(k.images[a].src);delete k.blobs;b(k)}}function c(a){var b="image";switch(z.get_file_extension(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function k(a){var b="audio";switch(z.get_file_extension(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}
function m(a){var b="video";switch(z.get_file_extension(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var A=r("__config"),E=r("__compat"),w=r("__print"),v=r("__sfx"),z=r("__util"),y=r("__version"),D=A.defaults,K=A.assets;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.AT_VIDEO_ELEMENT=70;a.AT_SEQ_VIDEO_ELEMENT=80;a.APT_JSON=a.AT_JSON;a.APT_TEXT=a.AT_TEXT;var d=[],t=0,C={};a.split_extension=
function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.get_text_sync=function(a){if(C[a])return C[a];var b=K.prevent_caching?a+y.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return C[a]=b;z.panic("Error XHR: responce is empty, GET "+a)}else z.panic("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<d.length;a++)d[a].state=
40;d=[];t=0;C={}};a.enqueue=function(a,c,g,e,k){for(var f=0;f<a.length;f++){var h=a[f],h={id:h.id,type:h.type,url:h.url,request:h.request?h.request:"GET",post_type:h.post_type?h.post_type:null,overwrite_header:h.overwrite_header?h.overwrite_header:null,post_data:h.post_data?h.post_data:null,param:h.param?h.param:null,state:10,asset_cb:c||function(){},pack_cb:g||function(){},progress_cb:e||function(){},json_reviver:k||null,pack_index:t};if(K.prevent_caching){var m=u();m&&h.url in m||(h.url+=y.timestamp())}d.push(h)}b(d);
t++};a.update=function(){b(d);for(var a=d,c=0,g=!0,e=0;e<a.length;e++){var k=a[e];k.pack_index===a[c].pack_index?30!==k.state&&(g=!1):(g&&(a[e-1].pack_cb(),g=e-c,a.splice(c,g),e-=g),c=e,g=30===a[e].state?!0:!1);e===a.length-1&&g&&(a[e].pack_cb(),a.splice(c))}};a.check_image_extension=function(a){return"png"==a||"jpg"==a||"jpeg"==a||"gif"==a||"bmp"==a||"dds"==a||"pvr"==a?!0:!1}};b4w.module.__loader=function(a,r){function u(b,c,e,d){var f=z,m=E.create(),l;for(l in c){var n=h(c[l]);(d&&n.is_resource||!b&&n.primary_only)&&k(n);E.append_node_attr(m,n)}for(l in c)for(n=c[l],n.name=l,b=0;b<n.inputs.length;b++)E.append_edge_attr(m,c[n.inputs[b]],n,null);c=h({name:"out",priority:a.FINISH_PRIORITY,cb_before:function(a,b,c,d,e,g){b.is_primary&&(f.start_secondary_threads=!0);A(b)||(b.status=2);b.loaded_cb(b.id,!0);e(b,c);w.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},relative_size:5});
if(e)e=E.get_sink_nodes(m);else{l=E.clone(m);do{e=E.get_sink_nodes(l);n=[];for(b=0;b<e.length;b++){d=e[b];var g=E.get_node_attr(l,d);g.background_loading&&n.push(d)}for(b=0;b<n.length;b++)E.remove_node(l,n[b]);n.length&&E.cleanup_loose_edges(l)}while(n.length)}E.append_node_attr(m,c);for(b=0;b<e.length;b++)d=e[b],g=E.get_node_attr(m,d),c.inputs.push(g.name),E.append_edge_attr(m,g,c,null);return m}function h(a){a.background_loading=a.background_loading||!1;a.priority||0===a.priority||(a.priority=a.SYNC_PRIORITY);
a.inputs=a.inputs||[];a.is_finished=a.is_finished||!1;a.skip=a.skip||!1;a.relative_size=a.relative_size||0;a.is_resource=a.is_resource||!1;a.primary_only=a.primary_only||!1;a.status=0;a.loop_index=0;a.load_rate=0;a.cb_param=a.cb_param||null;return a}function b(a,b,c){b.complete_load_cb(c,b);b.status=3;a.active_threads--;b.stageload_cb=null;b.complete_load_cb=null;b.stage_graph=null;b.stages_queue=null}function f(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var k=b[e];E.get_node_attr(a.stage_graph,k).is_finished&&
(E.traverse_outputs(a.stage_graph,k,function(d,e,g){var k=!0;E.traverse_inputs(a.stage_graph,d,function(a,b,c){if(!b.is_finished)return k=!1,1});k&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function l(a){var b=[],c=a.stages_queue,d=!1;do{var e=f(a,c);b.push.apply(b,c);0<e.length&&(d=!0);c=e}while(0<e.length);c=function(b,c){var d=E.get_node_attr(a.stage_graph,b),e=E.get_node_attr(a.stage_graph,c),k=e.priority-d.priority;0==k&&(k=
d.background_loading-e.background_loading);return k};d&&b.sort(c);a.stages_queue=b;return a.stages_queue.length}function q(a,b,c){if(b.skip)return b.is_finished=!0,n(a,b),!1;if(!b.cb_before&&!b.cb_loop&&!b.cb_after)return n(a,b),!1;if(0==b.status&&(b.status++,b.cb_before))return b.cb_before(c,a,b,b.cb_param,n,p),!0;if(1==b.status){if(b.cb_loop)return b.cb_loop(c,a,b,b.cb_param,n,p),!0;b.status++}return 2==b.status&&(b.status++,b.cb_after)?(b.cb_after(c,a,b,b.cb_param,n,p),!0):!1}function e(a){if(0==
a.stages_size_total)return 100;var b=0;E.traverse(a.stage_graph,function(c,d){a.do_not_load_resources&&d.is_resource||(b+=d.load_rate*d.relative_size)});return v.trunc(100*b/a.stages_size_total)}function n(a,b){b.is_finished=!0;b.status=3;B(a,b,1)}function p(a,b,c){1>c?B(a,b,c):b.status++}function B(a,b,c){var d=z;if(b.cb_before||b.cb_loop||b.cb_after)if(b.load_rate=c,b=e(a),a.curr_percents!=b||1==c)a.stageload_cb(b,performance.now()-a.time_load_start),a.curr_percents=b,d.make_idle_iteration=!0}function c(a,
b){var c=null;E.traverse(a.stage_graph,function(a,e){if(e.name==b)return c=e,1});return c}function k(a){a.skip=!0;a.load_rate=1}function m(){return 0==z.active_threads}function A(a){return a&&(3==a.status||4==a.status)}var E=r("__graph"),w=r("__print"),v=r("__util");a.SYNC_PRIORITY=0;a.ASYNC_PRIORITY=1;a.FINISH_PRIORITY=2;var z=null;a.get_scheduler=function(){return z};a.create_scheduler=function(){var a={threads:[],current_thread_index:0,active_threads:0,start_secondary_threads:!1,make_idle_iteration:!1};
return z=a};a.create_thread=function(a,b,c,d,e,k,f,h){var g=z,m=g.threads.length,l={id:m,is_primary:0==m,status:0,filepath:b,binary_name:"",loaded_cb:c||function(){},load_hidden:h||!1,wait_complete_loading:k,time_load_start:0,curr_percents:0,stages_size_total:0,reset_time_cycle:!1,stageload_cb:d||function(){},complete_load_cb:e||function(){},stage_graph:null,stages_queue:null,has_video_textures:!1,has_background_music:!1,init_wa_context:!1};a=u(l.is_primary,a,k,f);l.stage_graph=a;b=[];c=E.get_source_nodes(a);
for(d=0;d<c.length;d++)b.push(c[d]);l.stages_queue=b;E.traverse(a,function(a,b){if(b.cb_before||b.cb_loop||b.cb_after)l.do_not_load_resources&&b.is_resource||(l.stages_size_total+=b.relative_size)});g.threads.push(l);g.active_threads++;return l.id};a.update_scheduler=function(c){var e=z;if(e&&!m(e))if(e.make_idle_iteration)e.make_idle_iteration=!1;else{var k=performance.now();do{var d=e.threads[e.current_thread_index],f=c[d.id];if(!A(d))if(0==d.status&&(d.status=1,d.time_load_start=performance.now(),
d.stageload_cb(0,0)),l(d)){var h=d,n=h.stages_queue.length;do{var p=E.get_node_attr(h.stage_graph,h.stages_queue[0]),g=q(h,p,f);p.priority==a.ASYNC_PRIORITY&&(h.reset_time_cycle=!0);p=h.stages_queue.shift();h.stages_queue.push(p);n--}while(!g&&0!=n)}else b(e,d,f);e.start_secondary_threads&&(e.current_thread_index=(e.current_thread_index+1)%e.threads.length);if(d.reset_time_cycle){d.reset_time_cycle=!1;break}}while(16>performance.now()-k)}};a.abort_thread=function(a){var c=z;b(c,a,null);a.status=4;
a.is_primary&&(c.start_secondary_threads=!0);a.loaded_cb(a.id,!1)};a.stage_part_finish_cb=p;a.skip_stage_by_name=function(a,b){var e=c(a,b);null!==e&&k(e)};a.is_finished=m;a.thread_is_finished=A;a.is_primary_loaded=function(a){var b=z;if(!b)return!1;a|=0;return b.threads[a]&&(3==b.threads[a].status||2==b.threads[a].status)};a.graph_to_dot=function(a){w.error("Debug mode isn't enabled. Can not retrieve the graph.")};a.cleanup=function(){z=null}};b4w.module.__logic_nodes=function(a,r){function u(a,b){return{name:a.name,type:a.type,label:a.label,slot_idx_order:a.slot_idx_order,slot_idx_jump:a.slot_idx_jump,frame_start:a.frame_range[0],frame_end:a.frame_range[1],frame_start_mask:a.frame_range_mask?a.frame_range_mask[0]:!0,frame_end_mask:a.frame_range_mask?a.frame_range_mask[1]:!0,state:-1,sel_objs_len:-1,sel_obj_idx:-1,param_name:a.param_name,op:a.operation,mute:a.mute,dupli_name_list:a.object,obj:null,obj_state:null,camera_state:null,objects:{},
anim_name:a.anim_name,anim_slot:B.SLOT_0,parse_json_vars:a.parse_json_vars,parse_json_paths:a.parse_json_paths,objects_paths:a.objects_paths,nodes_paths:a.nodes_paths,floats:a.floats,bools:a.bools,vars:a.variables,strings:a.strings,materials_names:a.materials_names,shader_nd_type:a.shader_nd_type,common_usage_names:a.common_usage_names,encode_json_vars:a.encode_json_vars,encode_json_paths:a.encode_json_paths,thread:b,process_node:ha[a.type]?ha[a.type]:l,processed:!1,timer:0,sel_obj_idxs:null,links_dict:a.links,
links_idxs:[]}}function h(a,b,c){return a[0]?b[a[1]]:c[a[1]]}function b(a,b,c,d){a[0]?b[a[1]]=d:c[a[1]]=d}function f(a,b,c,d,e,g){switch(b.state){case 2:c.curr_node=a.slot_idx_order}}function l(a,b,c,d,e,g){switch(b.state){case 1:E.error("Unknown node type: "+a.type);break;case 2:c.curr_node=a.slot_idx_order}}function q(a){return A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.dupli_name_list||[],0)}function e(a,b){var c=a.b4w_logic_nodes,d=b.logic_threads;b.state=1;for(var e=0;e<c.length;e++){var g=
{nodes:[],thread_state:{scene:a,curr_node:0,in_progress:!1,thread_index:e,variables:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};d.push(g);for(var k=d[d.length-1],f=c[e],h=0;h<f.length;h++){var m=u(f[h],k);k.nodes.push(m)}for(f=0;f<k.nodes.length;f++)m=k.nodes[f],m.mute||m.process_node(m,b,g.thread_state,0,0)}var c=a.timeline_markers,l;for(l in c)b.sorted_markers_values.push(c[l]);b.sorted_markers_values.sort(function(a,b){return a-b});b.state=2;Y.push(b)}function n(a,b){switch(b){case 0:return Boolean(Number(a))?
Number(a):0;case 1:return String(a);default:return null}}function p(a){switch(typeof a){case "string":return n(a,1);case "number":return n(a,0);default:return n(a,1)}}var B=r("__animation"),c=r("__assets"),k=r("__camera"),m=r("__nla"),A=r("__objects"),E=r("__print"),w=r("__scenes"),v=r("__config"),z=r("__controls"),y=r("__batch"),D=r("__geometry"),K=r("__mat3"),d=r("__mat4"),t=r("__physics"),C=r("__quat"),M=r("__sfx"),x=r("__time"),g=r("__transform"),H=r("__tsr"),G=r("__util"),ba=r("__vec3"),L=new Float32Array(4);
new Float32Array(4);var F=new Float32Array(3),U=new Float32Array(3),Q=new Float32Array(2),T=new Float32Array(9),W=new Float32Array(16);a.NT_NUMBER=0;a.NT_STRING=1;a.NSO_JOIN=0;a.NSO_FIND=1;a.NSO_REPLACE=2;a.NSO_SPLIT=3;a.NSO_COMPARE=4;a.NC_GEQUAL=0;a.NC_LEQUAL=1;a.NC_GREATER=2;a.NC_LESS=3;a.NC_NOTEQUAL=4;a.NC_EQUAL=5;a.NST_WORLD=0;a.NST_PARENT=1;a.NST_LOCAL=2;a.NCMS_STATIC=0;a.NCMS_TARGET=1;a.NCMS_EYE=2;a.NCMS_HOVER=3;a.NCPT_OBJECT=0;a.NCPT_VARIABLE=1;var ha={ENTRYPOINT:function(a,b,c,d,e,g){switch(b.state){case 2:c.curr_node=
a.slot_idx_order}},HIDE:function(a,b,c,d,e,g){switch(b.state){case 1:a.obj=q(a);a.obj||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);break;case 2:w.change_visibility(a.obj,!0),c.curr_node=a.slot_idx_order}},SHOW:function(a,b,c,d,e,g){switch(b.state){case 1:a.obj=q(a);a.obj||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);break;case 2:w.change_visibility(a.obj,!1),c.curr_node=a.slot_idx_order}},PAGEPARAM:function(a,c,d,e,g,k){switch(c.state){case 2:e=
a.vars.vd;c=c.variables;g=d.variables;a:{k=a.param_name;var f=a.floats.ptp,h=a.bools.hsh,m=v.get("url_params");if(m&&k in m)k=Number(m[k]);else{if(h=h?location.hash:location.search)for(h=h.slice(1).split("&"),m=0;m<h.length;m++){var l=h[m].split("=");if(1<l.length&&l[0]==k){k=n(l[1],f);break a}}k=0}}b(e,c,g,k);d.curr_node=a.slot_idx_order}},SWITCH_SELECT:function(a,b,c,d,e,g){switch(b.state){case 1:a:{c=b.logic_threads[c.thread_index];d=A.get_selectable_objects();a.sel_obj_idxs=[];a.links_idxs=[];
for(var k in a.objects_paths){var f=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths[k],0);e=d.indexOf(f);if(-1==e){E.error("logic script error: non-selectable object:",a.objects_paths[k][a.objects_paths[k].length-1]);break a}a.sel_obj_idxs.push(e);a.links_idxs.push(a.links_dict[k])}a.state=-1;a.sel_objs_len=d.length;k=[];for(e=0;e<d.length;e++)k.push(z.create_selection_sensor(d[e],!1));d=ca();z.create_sensor_manifold(f,"LOGIC_NODES_SWITCH_SELECT_"+a.label,z.CT_SHOT,k,z.default_OR_logic_fun,
d,[a,b,c])}break;case 2:if(-1==a.state){b=b.logic_threads[c.thread_index].nodes;for(f=0;f<b.length;f++)k=b[f],"SWITCH_SELECT"==k.type&&(k.state=-1);a.state=-2}if(0==a.state||1==a.state)c.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order,a.state=-1}},SELECT:function(a,b,c,d,e,g){switch(b.state){case 1:c=b.logic_threads[c.thread_index];d=q(a);e=A.get_selectable_objects();g=e.indexOf(d);if(-1==g)E.error("logic script error: non-selectable object:",a.dupli_name_list[a.dupli_name_list.length-1]);else{a.state=
-1;a.sel_objs_len=e.length;a.sel_obj_idx=g;g=[];for(var k=0;k<e.length;k++)g.push(z.create_selection_sensor(e[k],!1));e=N();z.create_sensor_manifold(d,"LOGIC_NODES_SELECT_"+a.label,z.CT_SHOT,g,z.default_OR_logic_fun,e,[a,b,c])}break;case 2:if(0==a.state||1==a.state){c.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order;a.state=-1;break}a.bools.not_wait&&(c.curr_node=a.slot_idx_order)}},PLAY:function(a,b,c,d,e,g){switch(b.state){case 1:m.stop_nla();a.state=-1;a.bools.not_wait||(a.bools.not_wait=!1);
break;case 2:switch(a.state){case -1:if(m.is_play(b._nla))if(b.curr_thread==b.nla_thread&&c.in_progress)break;else if(e=b.nla_thread)for(e.thread_state.curr_node=e.nodes[e.thread_state.curr_node].slot_idx_order,e.nodes[e.thread_state.curr_node].state=-1,e=b.nla_thread.nodes,g=0;g<e.length;g++){var k=e[g];"PLAY"==k.type&&(k.state=-1)}c.in_progress=!a.bools.not_wait;b.nla_thread=b.curr_thread;a.state=0;a.frame_start_mask&&(m.set_range_start(a.frame_start),m.set_offset_from_range_start(d));if(a.frame_end_mask)m.set_range_end(a.frame_end);
else{d=m.get_frame(d);e=-1;for(var f in b.sorted_markers_values)if(d<b.sorted_markers_values[f]){e=f;break}0<=e?m.set_range_end(b.sorted_markers_values[e]):m.set_range_end(m.get_frame_end())}m.play_nla(null);a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1,c.in_progress=!1);break;case 0:m.is_play()||(c.curr_node=a.slot_idx_order,a.state=-1,c.in_progress=!1);break;case 1:c.curr_node=a.slot_idx_order;a.state=-1;b.nla_thread=null;c.in_progress=!1;break;default:G.panic("Unknown state of "+a.name),
a.state=-1}}},REDIRECT:function(a,b,c,d,e,g){switch(b.state){case 2:a=a.bools.url?n(h(a.vars.url,b.variables,c.variables),1):a.strings.url,window.location.href=a,b.state=3}},MATH:function(a,c,d,e,g,k){switch(c.state){case 2:e=-1==a.vars.v1[1]?a.floats.inp1:n(h(a.vars.v1,c.variables,d.variables),0);g=-1==a.vars.v2[1]?a.floats.inp2:n(h(a.vars.v2,c.variables,d.variables),0);k=0;switch(a.op){case "ADD":k=e+g;break;case "MUL":k=e*g;break;case "SUB":k=e-g;break;case "DIV":0==g&&G.panic("Division by zero in Logic script");
k=e/g;break;case "RAND":k=Math.random()*(g-e)+e}b(a.vars.vd,c.variables,d.variables,k);d.curr_node=a.slot_idx_order}},CONDJUMP:function(a,b,c,d,e,g){switch(b.state){case 2:e=a.bools.str?1:0;g=a.bools.str?a.strings:a.floats;d=-1==a.vars.v1[1]?g.inp1:n(h(a.vars.v1,b.variables,c.variables),e);b=-1==a.vars.v2[1]?g.inp2:n(h(a.vars.v2,b.variables,c.variables),e);e=!1;switch(a.common_usage_names.condition){case 5:d==b&&(e=!0);break;case 4:d!=b&&(e=!0);break;case 3:d<b&&(e=!0);break;case 2:d>b&&(e=!0);break;
case 1:d<=b&&(e=!0);break;case 0:d>=b&&(e=!0)}c.curr_node=e?a.slot_idx_jump:a.slot_idx_order}},REGSTORE:function(a,c,d,e,g,k){switch(c.state){case 2:b([a.bools.gl||a.vars.vd[0],a.vars.vd[1]],c.variables,d.variables,(1==a.common_usage_names.variable_type?a.strings:a.floats).inp1),d.curr_node=a.slot_idx_order}},PLAY_ANIM:function(a,b,c,d,e,g){switch(b.state){case 1:a.obj=a.bools.env?A.get_world_by_name(a.dupli_name_list[0],0):q(a);a.obj||(E.error("Logic script error: object not found. Node: ",a.name),
a.mute=!0);break;case 2:switch(0!=a.state||B.is_play(a.obj,a.anim_slot)||(a.state=1),a.state){case -1:for(var k in b.logic_threads)d=b.logic_threads[k].thread_state.curr_node,-1!=d&&(d=b.logic_threads[k].nodes[d],"PLAY_ANIM"==d.type&&d!=a&&0==d.state&&d.obj==a.obj&&(d.state=1));b=a.common_usage_names.param_anim_behavior;if(""==a.anim_name)B.apply_def(a.obj),B.set_behavior(a.obj,b,a.anim_slot);else{a:{k=a.obj;d=a.anim_name;for(g=e=0;8>g;g++){var f=k.anim_slots[g];if(f&&f.animation_name&&B.strip_baked_suffix(f.animation_name)==
B.strip_baked_suffix(d))if(0==e)e=1;else{k=!1;break a}}k=1==e?!0:!1}k||(a.anim_slot=B.slot_by_anim_type(a.obj,a.anim_name),B.apply(a.obj,null,a.anim_name,a.anim_slot),B.set_behavior(a.obj,b,a.anim_slot))}a.bools.not_wait||(c.in_progress=!0);B.play(a.obj,null,a.anim_slot);a.state=0;a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1);break;case 0:break;case 1:a.bools.not_wait||(c.in_progress=!1);c.curr_node=a.slot_idx_order;a.state=-1;break;default:G.panic("Unknown state of "+a.name),a.state=
-1}}},SELECT_PLAY:f,SEND_REQ:function(a,d,e,g,k,f){function m(a,c,g,k,f){a=JSON.stringify(a);b(f[0].vars.dst,d.variables,e.variables,a);f[0].state=1}switch(d.state){case 2:switch(a.state){case -1:a.state=0;g=a.bools.url?n(h(a.vars.url,d.variables,e.variables),1):a.strings.url;k={};a.bools.ct&&(k["Content-Type"]=a.strings.ct);"GET"==a.common_usage_names.request_type?c.enqueue([{id:g,type:c.AT_JSON,url:g,overwrite_header:k,param:[a,e.variables]}],m,null,null,null):"POST"==a.common_usage_names.request_type&&
(f=n(h(a.vars.dst1,d.variables,e.variables),1),c.enqueue([{id:g,type:c.AT_JSON,url:g,overwrite_header:k,request:"POST",post_type:c.AT_JSON,post_data:f,param:[a,e.variables]}],m,null,null,null));break;case 1:a.state=-1,e.curr_node=a.slot_idx_order}}},INHERIT_MAT:function(a,b,c,d,e,g){switch(b.state){case 1:for(b=0;2>b;b++)a.objects["id"+b]=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths["id"+b],0),a.objects["id"+b]||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=
!0);break;case 2:y.inherit_material(a.objects.id0,a.materials_names.id0,a.objects.id1,a.materials_names.id1),c.curr_node=a.slot_idx_order}},SET_SHADER_NODE_PARAM:function(a,b,c,d,e,g){switch(b.state){case 1:a.objects_paths.id0&&(a.objects.id0=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0),a.objects_paths.id0||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0),a.nodes_paths.id0.unshift(a.materials_names.id0));break;case 2:d=a.objects.id0;e=a.nodes_paths.id0;
g=e[0];var k=y.find_batch_material(d,g,"MAIN");c.curr_node=a.slot_idx_order;if(null===k){E.error('Material "'+g+'" was not found in the object "'+d.name+'".');break}if("ShaderNodeRGB"==a.shader_nd_type){var f=y.get_node_ind_by_name_list(k.node_rgb_inds,e);y.set_nodemat_rgb(d,g,f,a.bools.id0?n(h(a.vars.id0,b.variables,c.variables),0):a.floats.id0,a.bools.id1?n(h(a.vars.id1,b.variables,c.variables),0):a.floats.id1,a.bools.id2?n(h(a.vars.id2,b.variables,c.variables),0):a.floats.id2)}"ShaderNodeValue"==
a.shader_nd_type&&(f=y.get_node_ind_by_name_list(k.node_value_inds,e),y.set_nodemat_value(d,g,f,a.bools.id0?n(h(a.vars.id0,b.variables,c.variables),0):a.floats.id0))}},DELAY:function(a,b,c,d,e,g){switch(b.state){case 2:-1==a.state?(a.state=0,a.timer=0,c.in_progress=!0):0==a.state&&(a.timer+=e,(a.bools.dl?n(h(a.vars.dl,b.variables,c.variables),0):a.floats.dl)<a.timer&&(a.state=-1,c.curr_node=a.slot_idx_order,c.in_progress=!1))}},APPLY_SHAPE_KEY:function(a,b,c,d,e,g){switch(b.state){case 1:b=a.objects.id0=
A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);b||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);c=a.common_usage_names.sk;D.check_shape_keys(b)?D.has_shape_key(b,c)||(E.error("Wrong key name:",c),a.mute=!0):(E.error("No shape keys in object:",b.name),a.mute=!0);break;case 2:D.apply_shape_key(a.objects.id0,a.common_usage_names.sk,a.bools.skv?n(h(a.vars.skv,b.variables,c.variables),0):a.floats.skv),c.curr_node=a.slot_idx_order}},OUTLINE:function(a,b,
c,d,e,g){switch(b.state){case 1:d=a.objects.id0=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);d||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);d&&d.render&&d.render.outlining||(E.error("Can't evaluate 'Outline' logic node: wrong object"),a.mute=!0);break;case 2:d=a.objects.id0;switch(a.common_usage_names.outline_operation){case "PLAY":b=d.render.outline_anim_settings_default;A.apply_outline_anim(d,b.outline_duration,b.outline_period,b.outline_relapses);
break;case "STOP":A.clear_outline_anim(d);break;case "INTENSITY":d.render.outline_intensity=a.bools["in"]?n(h(a.vars["in"],b.variables,c.variables),0):a.floats["in"]}c.curr_node=a.slot_idx_order}},MOVE_CAMERA:function(a,b,c,e,f,m){function l(a,b,c,d){switch(k.get_move_style(a)){case k.MS_TARGET_CONTROLS:k.set_trans_pivot(a,b,c);break;case k.MS_EYE_CONTROLS:case k.MS_STATIC:g.set_tsr(a,d);break;case k.MS_HOVER_CONTROLS:ba.sub(c,b,F),ba.normalize(F,F),k.set_hover_pivot(a,c),c=b=0,U[0]=F[0],U[1]=0,U[2]=
F[2],b=ba.dot(U,F),c=Math.acos(b/(ba.length(U)*ba.length(F))),b=F[2]?Math.atan(F[0]/F[2]):0<F[0]?0:Math.PI,0<F[2]&&0<F[0]?Q[1]=-(Math.PI+Q[1]):0<F[2]&&0>F[0]?Q[1]=-(Math.PI+Q[1]):0>F[2]&&0>F[0]?(Q[0]+=Math.PI,b=-(Math.PI-b)):0>F[2]&&0<F[0]&&(Q[0]+=Math.PI,b-=Math.PI),k.rotate_hover_camera(a,b+Math.PI,-c,!0,!0)}g.update_transform(a);t.sync_transform(a)}function p(a,b,c,e){d.lookAt(b,c,G.AXIS_Z,W);d.invert(W,W);K.fromMat4(W,T);C.fromMat3(T,L);C.normalize(L,L);a=H.get_scale(a.render.world_tsr);H.set_sep(b,
a,L,e)}switch(b.state){case 1:c=null;c=a.objects.ca=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);c||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);a.objects.tr=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0);a.objects.tr||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);a.objects.ta=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id2,0);a.objects.ta||(E.error("Logic script error: object not found. Node: ",
a.name),a.mute=!0);a.state=-1;a.camera_state={trans_start:new Float32Array(3),trans_end:new Float32Array(3),interp_trans:new Float32Array(3),target_start:new Float32Array(3),target_end:new Float32Array(3),interp_target:new Float32Array(3),tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)};break;case 2:var q=a.objects.ca;e=H.get_trans_view(a.objects.tr.render.world_tsr);f=H.get_trans_view(a.objects.ta.render.world_tsr);switch(a.state){case -1:b=a.bools.dur?n(h(a.vars.dur,
b.variables,c.variables),0):a.floats.dur;if(0==b){p(q,e,f,a.camera_state.tsr_end);l(q,e,f,a.camera_state.tsr_end);c.curr_node=a.slot_idx_order;break}c=H.get_trans_view(q.render.world_tsr);ba.copy(c,a.camera_state.trans_start);var v=k.get_move_style(q);v==k.MS_HOVER_CONTROLS?ba.copy(q.render.hover_pivot,a.camera_state.target_start):v==k.MS_STATIC||v==k.MS_EYE_CONTROLS?(H.copy(q.render.world_tsr,a.camera_state.tsr_start),p(q,e,f,a.camera_state.tsr_end)):ba.copy(q.render.pivot,a.camera_state.target_start);
ba.copy(e,a.camera_state.trans_end);ba.copy(f,a.camera_state.target_end);a.state=0;var B=x.animate(0,1,1E3*b,function(b){w.check_active()&&(v==k.MS_STATIC||v==k.MS_EYE_CONTROLS?H.interpolate(a.camera_state.tsr_start,a.camera_state.tsr_end,G.smooth_step(b),a.camera_state.interp_tsr):(a.camera_state.interp_target=ba.lerp(a.camera_state.target_start,a.camera_state.target_end,G.smooth_step(b),a.camera_state.interp_target),a.camera_state.interp_trans=ba.lerp(a.camera_state.trans_start,a.camera_state.trans_end,
G.smooth_step(b),a.camera_state.interp_trans)),l(q,a.camera_state.interp_trans,a.camera_state.interp_target,a.camera_state.interp_tsr),1==b&&(a.state=1))});break;case 1:x.clear_animation(B),a.state=-1,c.curr_node=a.slot_idx_order}}},SET_CAMERA_MOVE_STYLE:function(a,b,c,d,e,f){switch(b.state){case 1:d=null;d=a.objects.ca=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);d||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);b=d.render;a.cam_state={target_cam_upside_down:b.target_cam_upside_down,
use_panning:b.use_panning,horizontal_limits:b.horizontal_limits,vertical_limits:b.vertical_limits,distance_limits:b.distance_limits,hover_horiz_trans_limits:b.hover_horiz_trans_limits,hover_vert_trans_limits:b.hover_vert_trans_limits,pivot_limits:b.pivot_limits,enable_hover_hor_rotation:b.enable_hover_hor_rotation};break;case 2:d=a.objects.ca;e=d.render;f=a.cam_state;k.wipe_move_style(d);switch(a.common_usage_names.camera_move_style){case 0:e.move_style=k.MS_STATIC;break;case 2:e.move_style=k.MS_EYE_CONTROLS;
var m=H.get_trans_view(e.world_tsr);k.setup_eye_model(d,m,null,f.horizontal_limits,f.vertical_limits);break;case 3:e.move_style=k.MS_HOVER_CONTROLS;var m=H.get_trans_view(e.world_tsr),l=F;a.bools.pvo?(l=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0),l=H.get_trans_view(l.render.world_tsr)):(l[0]=a.bools.pvx?n(h(a.vars.pvx,b.variables,c.variables),0):a.floats.pvx,l[1]=a.bools.pvy?n(h(a.vars.pvy,b.variables,c.variables),0):a.floats.pvy,l[2]=a.bools.pvz?n(h(a.vars.pvz,b.variables,
c.variables),0):a.floats.pvz);k.setup_hover_model(d,m,l,f.distance_limits,f.vertical_limits,f.hover_horiz_trans_limits,f.hover_vert_trans_limits,f.enable_hover_hor_rotation);break;case 1:e.move_style=k.MS_TARGET_CONTROLS,m=H.get_trans_view(e.world_tsr),l=F,a.bools.pvo?(l=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id1,0),l=H.get_trans_view(l.render.world_tsr)):(l[0]=a.bools.pvx?n(h(a.vars.pvx,b.variables,c.variables),0):a.floats.pvx,l[1]=a.bools.pvy?n(h(a.vars.pvy,b.variables,c.variables),
0):a.floats.pvy,l[2]=a.bools.pvz?n(h(a.vars.pvz,b.variables,c.variables),0):a.floats.pvz),k.setup_target_model(d,m,l,f.horizontal_limits,f.vertical_limits,f.dist_limits,f.pivot_limits,f.use_panning)}U[0]=a.bools.vtr?n(h(a.vars.vtr,b.variables,c.variables),0):a.floats.vtr;U[1]=a.bools.vro?n(h(a.vars.vro,b.variables,c.variables),0):a.floats.vro;U[2]=a.bools.vzo?n(h(a.vars.vzo,b.variables,c.variables),0):a.floats.vzo;U[0]=G.clamp(U[0],0,Infinity);U[1]=G.clamp(U[1],0,Infinity);U[2]=G.clamp(U[2],0,.99);
e.velocity_trans=U[0];e.velocity_rot=U[1];e.velocity_zoom=U[2];g.update_transform(d);t.sync_transform(d);k.init_ortho_props(d);c.curr_node=a.slot_idx_order}},MOVE_TO:function(a,b,c,d,e,k){function f(a,b){g.set_tsr(a,b);g.update_transform(a);t.sync_transform(a)}switch(b.state){case 1:a.objects.ob=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.objects.ob||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);a.objects.de=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,
a.objects_paths.id1,0);a.objects.de||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);a.state=-1;a.obj_state={dest_tsr_start:new Float32Array(8),dest_tsr_end:new Float32Array(8),interp_tsr_dest:new Float32Array(8)};break;case 2:var m=a.objects.ob;H.copy(a.objects.ob.render.world_tsr,a.obj_state.dest_tsr_start);H.copy(a.objects.de.render.world_tsr,a.obj_state.dest_tsr_end);switch(a.state){case -1:b=a.bools.dur?n(h(a.vars.dur,b.variables,c.variables),0):a.floats.dur;if(0==
b){f(m,a.obj_state.dest_tsr_end);c.curr_node=a.slot_idx_order;break}a.state=0;var l=x.animate(0,1,1E3*b,function(b){w.check_active()&&(a.obj_state.interp_dest=H.interpolate(a.obj_state.dest_tsr_start,a.obj_state.dest_tsr_end,G.smooth_step(b),a.obj_state.interp_tsr_dest),f(m,a.obj_state.interp_tsr_dest),1==b&&(a.state=1))});break;case 1:x.clear_animation(l),a.state=-1,c.curr_node=a.slot_idx_order}}},TRANSFORM_OBJECT:function(a,b,c,d,e,k){function f(a,b,c){0==c?g.set_tsr(a,b):g.set_tsr_rel(a,b);g.update_transform(a);
t.sync_transform(a)}switch(b.state){case 1:a.objects.ob=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.objects.ob||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);a.state=-1;a.obj_state={space:0,tsr_start:new Float32Array(8),tsr_end:new Float32Array(8),interp_tsr:new Float32Array(8)};break;case 2:var m=a.objects.ob;switch(a.state){case -1:U[0]=a.bools.trx?n(h(a.vars.trx,b.variables,c.variables),0):a.floats.trx;U[1]=a.bools["try"]?n(h(a.vars["try"],
b.variables,c.variables),0):a.floats["try"];U[2]=a.bools.trz?n(h(a.vars.trz,b.variables,c.variables),0):a.floats.trz;F[0]=a.bools.rox?n(h(a.vars.rox,b.variables,c.variables),0)*Math.PI/180:a.floats.rox;F[1]=a.bools.roy?n(h(a.vars.roy,b.variables,c.variables),0)*Math.PI/180:a.floats.roy;F[2]=a.bools.roz?n(h(a.vars.roz,b.variables,c.variables),0)*Math.PI/180:a.floats.roz;d=a.bools.sc?h(a.vars.sc,b.variables,c.variables):a.floats.sc;G.euler_to_quat(F,L);H.set_sep(U,d,L,a.obj_state.tsr_end);a.obj_state.space=
a.common_usage_names.space_type;switch(a.obj_state.space){case 0:g.get_tsr(m,a.obj_state.tsr_start);break;case 1:g.get_tsr_rel(m,a.obj_state.tsr_start);break;case 2:g.get_tsr_rel(m,a.obj_state.tsr_start),H.multiply(a.obj_state.tsr_start,a.obj_state.tsr_end,a.obj_state.tsr_end)}b=a.bools.dur?n(h(a.vars.dur,b.variables,c.variables),0):a.floats.dur;if(0==b){f(m,a.obj_state.tsr_end,a.obj_state.space);c.curr_node=a.slot_idx_order;break}a.state=0;var l=x.animate(0,1,1E3*b,function(b){w.check_active()&&
(H.interpolate(a.obj_state.tsr_start,a.obj_state.tsr_end,G.smooth_step(b),a.obj_state.interp_tsr),f(m,a.obj_state.interp_tsr,a.obj_state.space),1==b&&(a.state=1))});break;case 1:x.clear_animation(l),a.state=-1,c.curr_node=a.slot_idx_order}}},SPEAKER_PLAY:function(a,b,c,d,e,g){switch(b.state){case 1:a.obj=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.obj||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);void 0==a.bools.not_wait&&(a.bools.not_wait=!0);
break;case 2:switch(M.is_playing(a.obj)||0!=a.state||(a.state=1),a.state){case -1:for(var k in b.logic_threads)d=b.logic_threads[k].thread_state.curr_node,-1!=d&&(d=b.logic_threads[k].nodes[d],"SPEAKER_PLAY"==d.type&&d!=a&&0==d.state&&d.obj==a.obj&&(d.state=1));a.bools.not_wait||(c.in_progress=!0);M.play_def(a.obj);a.state=0;break;case 0:a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1);break;case 1:a.bools.not_wait||(c.in_progress=!1);c.curr_node=a.slot_idx_order;a.state=-1;break;default:G.panic("Unknown state of "+
a.name),a.state=-1}}},SPEAKER_STOP:function(a,b,c,d,e,g){switch(b.state){case 1:a.obj=A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);a.obj||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);break;case 2:M.stop(a.obj),c.curr_node=a.slot_idx_order}},STOP_ANIM:function(a,b,c,d,e,g){switch(b.state){case 1:a.obj=a.bools.env?A.get_world_by_name(a.dupli_name_list[0],0):q(a);a.obj||(E.error("Logic script error: object not found. Node: ",a.name),a.mute=!0);break;
case 2:B.stop(a.obj,B.SLOT_ALL),a.bools.rst&&B.set_first_frame(a.obj,B.SLOT_ALL),c.curr_node=a.slot_idx_order}},STOP_TIMELINE:function(a,b,c,d,e,g){switch(b.state){case 2:a.bools.rst&&m.set_offset_from_range_start(d),m.stop_nla(),c.curr_node=a.slot_idx_order}},CONSOLE_PRINT:function(a,b,c,d,e,g){switch(b.state){case 2:d={};for(var k in a.vars)d[a.vars[k][1]]=h(a.vars[k],b.variables,c.variables);E.log(a.common_usage_names.msg,JSON.stringify(d));c.curr_node=a.slot_idx_order}},STRING:function(a,c,d,
e,g,k){switch(c.state){case 2:e=a.bools.id0?n(h(a.vars.id0,c.variables,d.variables),1):a.strings.id0;g=a.bools.id1?n(h(a.vars.id1,c.variables,d.variables),1):a.strings.id1;k=0;switch(a.common_usage_names.string_operation){case 0:k=e+g;break;case 1:k=e.indexOf(g);break;case 2:k=a.bools.id2?n(h(a.vars.id2,c.variables,d.variables),1):a.strings.id2;k=e.replace(g,k);break;case 3:var f=a.vars;k=e.substring(0,e.indexOf(g));b(f.dst1,c.variables,d.variables,e.substring(e.indexOf(g)+1,e.length));""==h(f.dst,
c.variables,d.variables)&&(k=h(f.dst1,c.variables,d.variables),b(f.dst1,c.variables,d.variables,""));break;case 4:switch(a.common_usage_names.condition){case 5:k=e==g?1:0;break;case 4:k=e!=g?1:0;break;case 3:k=e<g?1:0;break;case 2:k=e>g?1:0;break;case 1:k=e<=g?1:0;break;case 0:k=e>=g?1:0}}b(a.vars.dst,c.variables,d.variables,k);d.curr_node=a.slot_idx_order}},GET_TIMELINE:function(a,c,d,e,g,k){switch(c.state){case 2:e=a.bools.nla?n(m.get_frame(e),0):n(x.get_frame(e),0),b(a.vars.vd,c.variables,d.variables,
e),d.curr_node=a.slot_idx_order}},JSON:function(a,c,d,e,g,k){function f(a,b,c,d){for(var e=0;e<b.length;e++){for(var g=b[e].split("."),k=a,h=c[e],m=0;m<g.length&&(k=k[g[m]],void 0!==k&&null!==k);m++);k=p(k);d[h]=k}}function m(a,b,c,d){d||(d={});for(var e=0;e<b.length;e++){var g=b[e].split("."),k=d,f=c[e];if(!(!f in a)){for(var h=0;h<g.length-1;h++)void 0===k[g[h]]&&(isNaN(g[h+1])?k[g[h]]={}:k[g[h]]=[]),k=k[g[h]];k[g[g.length-1]]=p(a[f])}}}switch(c.state){case 2:switch(a.common_usage_names.json_operation){case "PARSE":try{var l=
n(h(a.vars.jsn,c.variables,d.variables),1),t=JSON.parse(l);f(t,a.parse_json_paths,a.parse_json_vars,d.variables)}catch(q){E.error("logic script error: non valid JSON string")}break;case "ENCODE":e={},m(d.variables,a.encode_json_paths,a.encode_json_vars,e),e=n(JSON.stringify(e),1),b(a.vars.jsn,c.variables,d.variables,e)}d.curr_node=a.slot_idx_order}},JS_CALLBACK:function(a,c,d,e,g,k){switch(c.state){case 2:e=a.bools.cb?n(h(a.vars.cb,c.variables,d.variables),1):a.strings.cb;g=[];var f=0;k="id"+f;for(var m=
a.common_usage_names.js_cb_params;k in m;)k=0==m[k]?A.get_object(A.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths[k],0):h(a.vars[k],c.variables,d.variables),g.push(k),f++,k="id"+f;m=[];f=0;for(k="out"+f;k in a.vars;)k=h(a.vars[k],c.variables,d.variables),m.push(k),f++,k="out"+f;f=1;if(e in Z){if(f=!Z[e](g,m))for(e=0;e<m.length;e++)k="out"+e,k in a.vars&&b(a.vars[k],c.variables,d.variables,p(m[e]))}else E.error("logic script error: no custom callback with id "+e);f&&(d.curr_node=a.slot_idx_order)}},
EMPTY:f},Y=[],Z={};a.init_logic=function(a,b){var c={data_id:b,scene_name:a.name,state:0,nla_thread:null,scene:a,curr_thread:null,logic_threads:[],sorted_markers_values:[],variables:{}};a._logic=c;e(a,c)};a.update=function(a,b){var c=m.get_start_time();if(!(0>=c))for(var d=0;d<Y.length;d++)for(var e=d,g=a,k=b,f=c,h=Y[e],l=0;l<Y[e].logic_threads.length;l++){h.curr_thread=Y[e].logic_threads[l];var n=Y[e].logic_threads[l],p=h,t=g,q=k,v=f,x=n.nodes;if(x.length){for(var w=0;w<x.length;w++)x[w].processed=
!1;for(w=0;w<x.length;w++){if(0<=n.thread_state.curr_node)var A=x[n.thread_state.curr_node];else break;if(A.processed)break;if(A.mute)if("ENTRYPOINT"==A.type)break;else n.thread_state.curr_node=A.slot_idx_order,A.processed=!0;else A.process_node(A,p,n.thread_state,t,q,v),A.processed=!0}}}};a.append_custom_cb=function(a,b){Z[a]=b};a.remove_custom_cb=function(a){delete Z[a]};a.run_ep=function(a,b){for(var c=0;c<Y.length;c++)if(Y[c].scene_name==a){for(var c=Y[c],d=0;d<c.logic_threads.length;d++){var e=
c.logic_threads[d].nodes[0];if(e.name==b){e.bools.js&&(e.mute=!1);c.logic_threads[d].thread_state.curr_node=0;break}}break}};var N=function(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];for(var g=0;g<c.sel_objs_len;g++)if(z.get_sensor_value(a,b,g)&&g==c.sel_obj_idx){if(m.is_play(e._nla)&&e.nla_thread==c.thread)c.state=-1;else if(!d.thread_state.in_progress||c.bools.no_wait)c.state=1;return}c.state=0}},ca=function(){return function(a,b,c,d){c=d[0];var e=d[1];d=d[2];if(-2==c.state){for(var g=
0;g<c.sel_objs_len;g++)if(z.get_sensor_value(a,b,g))for(var k=0;k<c.sel_obj_idxs.length;k++)if(c.sel_obj_idxs[k]==g){e.nla_thread==c.thread?(m.is_play(e._nla)&&(c.state=-1),d.thread_state.in_progress||(c.state=1,c.slot_idx_jump=c.links_idxs[k])):(c.state=1,c.slot_idx_jump=c.links_idxs[k]);return}c.state=0}}};a.cleanup=function(){Y.length=0;Z={}}};b4w.module.__math=function(a,r){function u(a,b){for(var c=a[1],e=1,f=2;f<a.length;f++)4!=f&&8!=f&&Math.abs(a[f])>Math.abs(c)&&(c=a[f],e=f);for(var h=Math.floor(e/3),e=e%3,c=.5*Math.atan(2*c/(a[3*h+h]-a[3*e+e])),f=0;f<b.length;f++)b[f]=0==f||4==f||8==f?1:0;b[e+3*h]=-Math.sin(c);b[h+3*e]=Math.sin(c);b[h+3*h]=Math.cos(c);b[e+3*e]=Math.cos(c);return b}function h(a){return Math.sqrt(a[1]*a[1]+a[2]*a[2]+a[5]*a[5])}function b(a,b){for(var c=a.content[b];0<b;){var e=(b+1>>1)-1,f=a.content[e];if(a.score_function(c)<
a.score_function(f))a.content[e]=c,a.content[b]=f,b=e;else break}}function f(a,b){for(var c=a.content.length,e=a.content[b],f=a.score_function(e);;){var h=b+1<<1,l=h-1,n=null;if(l<c){var p=a.score_function(a.content[l]);p<f&&(n=l)}h<c&&a.score_function(a.content[h])<(null===n?f:p)&&(n=h);if(null!==n)a.content[b]=a.content[n],a.content[n]=e,b=n;else break}}var l=r("__mat3"),q=r("__vec3"),e=new Float32Array(3),n=new Float32Array(9),p=new Float32Array(9),B=new Float32Array(9),c=new Float32Array(9);a.get_pline_directional_vec=
function(a,b){b=b||new Float32Array(3);b[0]=a[3];b[1]=a[4];b[2]=a[5];return b};a.get_pline_initial_point=function(a,b){b=b||new Float32Array(3);return q.copy(a,b)};a.set_pline_initial_point=function(a,b){q.copy(b,a)};a.set_pline_directional_vec=function(a,b){q.normalize(b,e);a[3]=e[0];a[4]=e[1];a[5]=e[2]};a.calc_pline_point=function(a,b,c){c=c||new Float32Array(3);c[0]=a[0]+a[3]*b;c[1]=a[1]+a[4]*b;c[2]=a[2]+a[5]*b};a.calk_average_position=function(a,b){b[0]=0;b[1]=0;for(var c=b[2]=0;c<a.length;c+=
3)b[0]+=a[c],b[1]+=a[c+1],b[2]+=a[c+2];return q.scale(b,3/a.length,b)};a.calc_covariance_matrix=function(a,b,c){for(var e=0;e<c.length;e++)c[e]=0;for(e=0;e<a.length;e+=3){var f=a[e]-b[0],h=a[e+1]-b[1],l=a[e+2]-b[2];c[0]+=f*f;c[1]+=f*h;c[2]+=f*l;c[4]+=h*h;c[5]+=h*l;c[8]+=l*l}c[3]=c[1];c[6]=c[2];c[7]=c[5];for(e=0;e<c.length;e++)c[e]*=3/a.length;return c};a.find_eigenvectors=function(a,b,e){a=l.copy(a,n);if(h(a)<b)return l.identity(e);var f=u(a,p),q=l.transpose(f,B);l.multiply(a,q,c);l.multiply(f,c,
a);e=l.copy(f,e);for(var v=1;b<=h(a)&&100>v;)f=u(a,p),q=l.transpose(f,B),l.multiply(a,q,c),l.multiply(f,c,a),l.multiply(f,e,e),v++;return e};a.point_plane_dist=function(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]};a.binary_heap_new=function(a){return{content:[],score_function:a}};a.binary_heap_push=function(a,c){a.content.push(c);b(a,a.content.length-1)};a.binary_heap_pop=function(a){var b=a.content[0],c=a.content.pop();0<a.content.length&&(a.content[0]=c,f(a,0));return b};a.binary_heap_remove=
function(a,c){var e=a.content.indexOf(c),h=a.content.pop();e!==a.content.length-1&&(a.content[e]=h,a.score_function(h)<a.score_function(c)?b(e):f(e))};a.binary_heap_rescore_element=function(a,c){b(a,a.content.indexOf(c))}};b4w.module.__navmesh=function(a,r){function u(){var a,b,e,f,h=[],l={},n;n=arguments.length-1;e=arguments[0].length;for(a=b=0;a<=n;a++)f=arguments[a].length,f<e&&(b=a,e=f);for(a=0;a<=n;a++){f=a===b?0:a||b;e=arguments[f].length;for(var p=0;p<e;p++){var q=arguments[f][p];l[q]===a-1?a===n?(h.push(q),l[q]=0):l[q]=a:0===a&&(l[q]=0)}}return h}function h(a){a=a.polygons;for(var b=[],e=0,f=function(a){for(var b=a.neighbours,c=0;c<b.length;c++){var e=b[c];void 0==e.island&&(e.island=a.island,f(e))}},h=0;h<
a.length;h++){var l=a[h];void 0==l.island&&(l.island=e++,f(l));b[l.island]||(b[l.island]=[]);b[l.island].push(a[h])}return b}function b(a){for(var b={},e=a.vertices,f=0;f<e.length;f++)e[f][0]=parseFloat(e[f][0].toFixed(2)),e[f][1]=parseFloat(e[f][1].toFixed(2)),e[f][2]=parseFloat(e[f][2].toFixed(2));b.vertices=a.vertices;a=h(a);b.islands=[];e=function(a,b){for(var c=0;c<a.length;c++)if(b===a[c])return c};for(f=0;f<a.length;f++){for(var l=[],n=a[f],p=0;p<n.length;p++){for(var q=[],r=n[p],u=0;u<r.neighbours.length;u++)q.push(e(n,
r.neighbours[u]));for(var K=[],u=0;u<r.neighbours.length;u++)K.push(B(r,r.neighbours[u]));r.centroid[0]=parseFloat(r.centroid[0].toFixed(2));r.centroid[1]=parseFloat(r.centroid[1].toFixed(2));r.centroid[2]=parseFloat(r.centroid[2].toFixed(2));l.push({id:e(n,r),neighbours:q,vertex_ids:r.vertex_ids,centroid:r.centroid,portals:K,f:0,g:0,h:0,cost:1,visited:!1,closed:!1,parent:null})}b.islands.push(l)}return b}function f(a,b,e){function f(a,b){for(var c=[],d=0;d<b.neighbours.length;d++)c.push(a[b.neighbours[d]]);
return c}(function(a){for(var b=0;b<a.length;b++){var c=a[b];c.f=0;c.g=0;c.h=0;c.cost=1;c.visited=!1;c.closed=!1;c.parent=null}})(a);var h=n.binary_heap_new(function(a){return a.f});n.binary_heap_push(h,b);for(b=0;0<h.content.length;){var l=n.binary_heap_pop(h);if(l===e){a=l;for(e=[];a.parent;)e.push(a),a=a.parent;return e.reverse()}l.closed=!0;for(var v=f(a,l),B=0,r=v.length;B<r;B++){var u=v[B];if(!u.closed){var K=l.g+u.cost,d=u.visited;if(!d||K<u.g){u.visited=!0;u.parent=l;var t=u,C;(C=u.h)||(q.subtract(u.centroid,
e.centroid,p),C=q.dot(p,p));t.h=C;u.g=K;u.f=u.g+u.h;b++;d?n.binary_heap_rescore_element(h,u):n.binary_heap_push(h,u)}}}}return[]}function l(a){function b(a,c,d){return-((d[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(d[1]-a[1]))}function e(a,b){q.subtract(a,b,p);return 1E-5>q.dot(p,p)}var f=[],h,l,n,B=0,r=0,u=0;h=a[0].right;l=a[0].left;n=a[0].right;f.push(h);for(B=1;B<a.length;B++){var K=a[B].left,d=a[B].right;if(0>=b(h,n,d)){var t=e(h,n);if(t||0<b(h,l,d))n=d,u=B;else{f.push(l);h=l;B=r;n=l=h;u=r=B;continue}}0<=
b(h,l,K)&&((t=e(h,l))||0>b(h,n,K)?(l=K,r=B):(f.push(n),h=n,B=u,n=l=h,u=r=B))}0!==f.length&&e(f[f.length-1],a[a.length-1].left)||f.push(a[a.length-1].left);return f}var q=r("__vec3"),e=r("__geometry"),n=r("__math"),p=new Float32Array(3),B=function(a,b){function e(a){var b=a[0];a[0]=a[1];a[1]=a[2];a[2]=b}for(var f=a.vertex_ids,h=b.vertex_ids,l=[],n=0;n<f.length;n++)0<=h.indexOf(f[n])&&l.push(f[n]);if(2>l.length)return[];0<=l.indexOf(f[0])&&0<=l.indexOf(f[f.length-1])&&e(f);0<=l.indexOf(h[0])&&0<=l.indexOf(h[h.length-
1])&&e(h);l=[];for(n=0;n<f.length;n++)0<=h.indexOf(f[n])&&l.push(f[n]);return l};a.navmesh_build_from_bufs_data=function(a){var k=e.get_vbo_source_by_type(a.vbo_source_data,e.VBO_FLOAT),f=a.ibo_array;a=[];for(var h=0;h<f.length;h+=3)a.push({indices:new Uint32Array([f[h],f[h+1],f[h+2]]),centroid:new Float32Array(3)});f=[];for(h=0;h<k.length;h+=3){var l=new Float32Array(3);l[0]=k[h];l[1]=k[h+1];l[2]=k[h+2];f.push(l)}for(k=0;k<a.length;k++)h=a[k],q.add(f[h.indices[0]],f[h.indices[1]],p),q.add(p,f[h.indices[2]],
p),q.scale(p,1/3,h.centroid);var n={},k=[],h=[],v,B,r=Math.pow(10,4),D,l=0;for(D=f.length;l<D;l++)v=f[l],B=Math.round(v[0]*r)+"_"+Math.round(v[1]*r)+"_"+Math.round(v[2]*r),void 0===n[B]?(n[B]=l,k.push(v),h[l]=k.length-1):h[l]=h[n[B]];n=[];l=0;for(D=a.length;l<D;l++)for(v=a[l],v.indices[0]=h[v.indices[0]],v.indices[1]=h[v.indices[1]],v.indices[2]=h[v.indices[2]],v=[v.indices[0],v.indices[1],v.indices[2]],B=0;3>B;B++)if(v[B]==v[(B+1)%3]){n.push(l);break}for(l=n.length-1;0<=l;l--)a.splice(n[l],1);f.length=
0;for(l in k)f.push(k[l]);k=[];for(h=l=0;h<a.length;h++)D=a[h],k.push({id:l++,vertex_ids:D.indices,centroid:D.centroid,neighbours:[]});a={polygons:k,vertices:f};for(h=0;h<k.length;h++)for(f=k[h],l=a,f.neighbours=[],D=0,n=l.polygons.length;D<n;D++)f!==l.polygons[D]&&(q.subtract(f.centroid,l.polygons[D].centroid,p),1E4<q.dot(p,p)||2<=u(f.vertex_ids,l.polygons[D].vertex_ids).length&&f.neighbours.push(l.polygons[D]));return b(a)};a.navmesh_get_island=function(a,b,e){for(var f=null,h=Number.MAX_VALUE,
l=a.islands,n=0;n<l.length;n++)for(var B=0;B<l[n].length;B++){var r=l[n][B];q.subtract(r.centroid,b,p);r=e(b,r.centroid,r.vertex_ids,a.vertices,h);r<h&&(f=n,h=r)}return f};a.is_vector_in_poly=function(a,b,e){for(var f=[],h=0;h<b.length;h++)f.push(e[b[h]]);b=!1;e=-1;for(var h=f.length,l=h-1;++e<h;l=e)(f[e][1]<=a[1]&&a[1]<f[l][1]||f[l][1]<=a[1]&&a[1]<f[e][1])&&a[0]<(f[l][0]-f[e][0])*(a[1]-f[e][1])/(f[l][1]-f[e][1])+f[e][0]&&(b=!b);return b?!0:!1};a.navmesh_find_path=function(a,b,e,h,n,p,v,B){var r=
a.islands[h];h=a.vertices;var u=null,K=Number.MAX_VALUE;for(a=0;a<r.length;a++){var d=r[a],t=v(b,d.centroid,d.vertex_ids,h,K);t<K&&(u=d,K=t)}0<n&&K>n&&(u=null);if(!u)return null;v=null;K=Number.MAX_VALUE;for(a=0;a<r.length;a++)d=r[a],t=B(e,d.centroid,d.vertex_ids,h,K),t<K&&(v=d,K=t);0<n&&K>n&&(v=null);if(!v)return null;B=f(r,u,v);n=[];n.push(u);if(p)for(a=0;a<B.length;a++)e=new Float32Array(3),q.copy(B[a].centroid,e),n.push(e);else{p=[];p.push({left:b,right:b});for(a=0;a<B.length;a++)if(b=B[a],u=
B[a+1]){a:{for(v=0;v<b.neighbours.length;v++)if(b.neighbours[v]===u.id){b=b.portals[v];break a}b=void 0}p.push({left:h[b[0]],right:h[b[1]]})}p.push({left:e,right:e});h=l(p);for(a=0;a<h.length;a++)e=new Float32Array(3),q.copy(h[a],e),n.push(e)}return n}};b4w.module.__nla=function(a,r){function u(){return{type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,name_list:null,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1,action_frame_final:0}}function h(a,b,c){if(a.animation_data){var e=a.animation_data.nla_tracks;if(e)for(var f=0;f<e.length;f++)e[f].name_list=c,b.push(e[f])}a=a.nodes;for(f=0;f<a.length;f++)if(e=a[f],e.node_group){var g=e.node_group.node_tree;
if(g){var k=c.slice();k.push(e.name);h(g,b,k)}}}function b(a,b){var c=Math.round(a)-b.frame_start;b.use_cyclic&&(c%=b.frame_duration,0>c&&(c+=b.frame_duration));return b.frame_offset+c}function f(a,b){var c=(b-K)*z.get_framerate()+a.frame_offset;c>a.frame_start?(c-=a.frame_start,a.cyclic&&(c%=a.frame_end-a.frame_start+1),c+=a.frame_start):c=a.frame_start;return c}function l(a,b){a=y.clamp(a,b.frame_start,b.frame_end);var c=a==b.frame_end?b.action_frame_final:b.action_frame_start+(a-b.frame_start)/
b.scale%(b.action_frame_end-b.action_frame_start);b.use_reverse&&(c=b.action_frame_end-c+b.action_frame_start);return c}function q(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e],g=f.strips;if(g)for(var k=0;k<g.length;k++){var h=g[k],l=u();l.type=h.type;l.frame_start=h.frame_start;l.frame_end=h.frame_end;l.anim_slot=b;l.action_frame_start=h.action_frame_start;l.action_frame_end=h.action_frame_end;l.use_reverse=h.use_reverse;l.scale=h.scale;l.repeat=h.repeat;h.action&&(l.anim_name=h.action.name,l.anim_uuid=
h.action.uuid,l.name_list=f.name_list);c.push(l)}}return c}function e(a){return("SPEAKER"==a.type||"LAMP"==a.type)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function n(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],e=c.node_tree;if(c.use_nodes&&e&&p(e))return!0}return!1}function p(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;if(c&&c.length)return!0}for(var c=a.nodes,e=0;e<c.length;e++){var f=
c[e];f.node_group&&(f=f.node_group.node_tree)&&p(f,b)}return!1}function B(a,b){var c=E.get_active();if(c._nla){var e=f(c._nla,b);c._nla.frame_offset-=e-a;c._nla.force_update=!0}}var c=r("__animation");r("__config");var k=r("__objects"),m=r("__obj_util"),A=r("__print"),E=r("__scenes"),w=r("__sfx"),v=r("__textures"),z=r("__time"),y=r("__util"),D=[],K=-1;a.update_object=function(a,b){var f,k=null;for(f=b.scenes_data.length-1;0<=f;f--){var l=b.scenes_data[f];if(l.scene.b4w_use_nla&&(k=l,l.scene._is_main))break}if(f=
k){f.obj_has_nla_on_scene=!0;var g=0;if((k=a.animation_data)&&k.nla_tracks.length){var n=k.nla_tracks;if(m.is_armature(b)||m.is_camera(b)||m.is_mesh(b)||m.is_empty(b)||m.is_lamp(b)||m.is_speaker(b)||m.is_world(b))n=q(n,g),n.length&&(b.nla_events=b.nla_events.concat(n),g++)}e(a)&&(n=a.data.animation_data.nla_tracks,n=q(n,g),n.length&&(b.nla_events=b.nla_events.concat(n),g++));if(m.is_mesh(b))for(l=a.data.materials,k=0;k<l.length;k++){var p=l[k];if(p.use_nodes&&p.node_tree&&(n=[],h(p.node_tree,n,[p.name]),
n=q(n,g),n.length)){for(var p=g,v=n,B=c.get_all_actions(),w=[],r=0,z=0;z<v.length;z++){var A=v[z];""!=A.anim_uuid?A=y.keysearch("uuid",A.anim_uuid,B):(A=A.anim_name,A=y.keysearch("name",A,B)||y.keysearch("name",A+"_B4W_BAKED",B));if(A){var A=A.fcurves,E=[],D;for(D in A)E.push(D);w.push(E)}}for(z=0;z<w.length;z++){B=!1;for(A=0;A<z;A++)if(y.arrays_have_common(w[z],w[A])){v[z].anim_slot=v[A].anim_slot;B=!0;break}B||(v[z].anim_slot=g+r++)}g=p+r;b.nla_events=b.nla_events.concat(n)}}if(!m.is_world(b)){for(k=
0;k<a.particle_systems.length;k++)l=a.particle_systems[k],D=l.settings,"EMITTER"==D.type&&D.b4w_allow_nla&&(D=u(),D.type="CLIP",D.frame_start=f.scene.frame_start,D.frame_end=f.scene.frame_end+1,D.anim_name=l.name,D.anim_slot=g,D.action_frame_start=D.frame_start,D.action_frame_end=D.frame_end,b.nla_events.push(D),g++);f=g+1;for(k=0;k<b.vertex_anim.length;k++)l=b.vertex_anim[k],l.allow_nla&&(g=f,D=u(),D.type="CLIP",D.frame_start=l.frame_start,D.frame_end=l.frame_end,D.anim_name=l.name,D.anim_slot=g,
D.action_frame_start=D.frame_start,D.action_frame_end=D.frame_end,b.nla_events.push(D))}}};a.update_scene=function(a,b,c){a._nla||(a._nla={frame_start:a.frame_start,frame_end:a.frame_end,frame_offset:0,last_frame:-1,range_end:a.frame_end,range_start:a.frame_start,user_callback:null,cyclic:b,objects:[],textures:[],scene_name:a.name,is_stopped:!1,force_update:!1,rewinded_to_start:!0},D.push(a._nla));b=a._nla;for(var e=k.get_scene_objs_derived(a,"ALL",c),f=0;f<e.length;f++){var g=e[f];if(g.nla_events.length){for(var h=
0;h<g.scenes_data.length;h++){var l=g.scenes_data[h];l.scene==a&&l.obj_has_nla_on_scene&&b.objects.push(g)}for(var h=g.nla_events,l=b,m=g.name,n=0;n<h.length;n++){var p=h[n];l.frame_start>p.frame_end||l.frame_end<p.frame_start?(A.warn("NLA: Strip is out of scene range: "+(m+" ["+p.frame_start+":"+p.frame_end+"]")),h.splice(n,1),n--):p.anim_name||"CLIP"!=p.type||(A.warn('NLA: no action in strip for object "'+m+'".'),h.splice(n,1),n--)}g=g.nla_events;h=b;for(l=0;l<g.length;l++){for(var m=g[l],n=h.frame_start,
p=h.frame_end+1,q=0;q<g.length;q++){var v=g[q];m.anim_slot==v.anim_slot&&(v.frame_end<=m.frame_start&&(n=m.frame_start),v.frame_start>=m.frame_end&&(p=Math.min(p,v.frame_start)))}m.ext_frame_start=n;m.ext_frame_end=p;m.action_frame_final=0===m.repeat%1?m.action_frame_end:m.action_frame_start+m.repeat%1*(m.action_frame_end-m.action_frame_start)}}}a=a._render.video_textures;for(f=0;f<a.length;f++)e=a[f]._render,e.use_nla&&(e.video_file||e.seq_video)&&e.vtex_data_id==c&&(g=u(),g.type="VIDEO",e.use_cyclic?
(g.frame_start=0,g.frame_end=b.frame_end):(g.frame_start=y.clamp(e.frame_start,0,b.frame_end),g.frame_end=y.clamp(e.frame_start+e.frame_duration,0,b.frame_end)),g.anim_name=a[f].name,b.textures.push(e))};a.start=function(){K=0};a.get_start_time=function(){return K};a.get_frame_offset=function(a){return a._nla?a._nla.frame_offset:null};a.set_frame_offset=function(a,b){return a._nla?(a._nla.frame_offset=b,!0):!1};a.update=function(a,e){if(!(0>K)){0==K&&(K=a);for(var k=0;k<D.length;k++){var h=D[k];h.is_stopped&&
(h.frame_offset-=z.get_framerate()*e);var m=f(h,a);if((!h.is_stopped||h.force_update)&&m>=h.range_end)if(h.cyclic){var m=h,g=a;m.user_callback&&m.user_callback();B(m.range_start,g);m.rewinded_to_start=!0;m=f(m,g)}else{var g=h,n=m;g.is_stopped=!0;g.frame_offset-=n-g.range_end;g.user_callback&&g.user_callback()}if(!h.is_stopped||h.force_update){for(var g=h,n=m,p=0;p<g.objects.length;p++){for(var q=g.objects[p],r=q.nla_events,A=0;A<r.length;A++){var u=r[A];"SOUND"==u.type&&n<g.last_frame-1E-6&&(u.scheduled=
!1)}for(A=0;A<r.length;A++)switch(u=r[A],u.type){case "CLIP":if(u.ext_frame_start<=n&&n<u.ext_frame_end&&!u.scheduled){var E=q,T=u,W=T.name_list;""!=T.anim_uuid?c.apply_by_uuid(E,W,T.anim_uuid,T.anim_slot):c.apply(E,W,T.anim_name,T.anim_slot);c.set_behavior(E,c.AB_FINISH_STOP,T.anim_slot);W=l(T.frame_start,T);c.set_frame(E,W,T.anim_slot);for(E=0;E<r.length;E++)r[E]!=u&&r[E].anim_slot==u.anim_slot&&(r[E].scheduled=!1);u.scheduled=!0}u.scheduled&&(E=q,T=l(n,u),W=c.get_current_frame_float(E,u.anim_slot),
1E-6<Math.abs(T-W)&&c.set_frame(E,T,u.anim_slot));break;case "SOUND":(n<g.last_frame-1E-6||g.last_frame<u.frame_start)&&u.frame_start<=n&&n<u.frame_end&&!u.scheduled&&(E=q,W=u,T=(W.frame_start-n)/z.get_framerate(),W=(W.frame_end-W.frame_start)/z.get_framerate(),w.play(E,T,W),u.scheduled=!0),g.last_frame<u.frame_end&&u.frame_end<=n&&u.scheduled&&(u.scheduled=!1)}}g=a;n=h;p=m;for(q=0;q<n.textures.length;q++)if(r=n.textures[q],r.video_file||r.seq_video){A=v.video_get_current_frame(r);u=r;E=b(p,u);E=
y.clamp(E,u.frame_offset,u.frame_offset+v.video_get_duration(u)-1);u.seq_video&&(E=v.video_frame_to_seq_frame(u,E),E==u.seq_movie_length&&E--);u=E;E=v.video_get_start_frame(r);W=T=!1;if(n.force_update||n.rewinded_to_start)W=!0;if(!n.is_stopped){var ha;ha=r;var Y=b(p,ha);ha=ha.frame_offset<=Y&&Y<=ha.frame_offset+v.video_get_duration(ha);Y=v.video_is_played(r);r.use_cyclic&&u==E&&(W=!0);Y||A==u||(W=!0);ha&&!Y?v.play_video(r.name,r.vtex_data_id):ha&&Y?T=!0:!ha&&Y&&(r.video_file&&A<u?T=!0:v.pause_video(r.name,
r.vtex_data_id))}W?(v.set_frame_video(r.name,u,r.vtex_data_id),r.seq_video&&(r.seq_last_discrete_mark=v.seq_video_get_discrete_timemark(r,g))):T&&v.video_update_is_available(r)&&(r.video_file?v.update_video_texture(r):(A=v.seq_video_get_discrete_timemark(r,g),A!=r.seq_last_discrete_mark&&(r.seq_cur_frame=u,v.update_seq_video_texture(r)),r.seq_last_discrete_mark=A))}h.last_frame=m}h.force_update=!1;h.rewinded_to_start=!1}}};a.cleanup=function(){D.length=0;K=-1};a.bpy_obj_has_nla=function(a){var b=
a.animation_data;return b&&b.nla_tracks.length||e(a)||n(a)?!0:!1};a.set_frame=B;a.get_frame=function(a){var b=E.get_active();return b._nla?f(b._nla,a):-1};a.stop_nla=function(){var a=E.get_active();if(a._nla){a._nla.is_stopped=!0;for(var a=a._nla.textures,b=0;b<a.length;b++){var c=a[b];v.pause_video(c.name,c.vtex_data_id)}}};a.play_nla=function(a){var b=E.get_active();b._nla&&(b._nla.is_stopped=!1,b._nla.user_callback=a?a:null)};a.get_frame_start=function(){var a=E.get_active();return a._nla?a._nla.frame_start:
-1};a.get_frame_end=function(){var a=E.get_active();return a._nla?a._nla.frame_end:-1};a.is_play=function(){var a=E.get_active();return a._nla?!a._nla.is_stopped:!1};a.check_nla=function(){var a=E.get_active();return a._nla?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=E.get_active();return a._nla?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=E.get_active();if(c._nla)c._nla.range_start=a,c._nla.range_end=b;else return!1};a.set_range_end=function(a){var b=E.get_active();if(b._nla)b._nla.range_end=
a;else return!1};a.set_range_start=function(a){var b=E.get_active();if(b._nla)b._nla.range_start=a;else return!1};a.reset_range=function(){var a=E.get_active();if(a._nla)a=a._nla,a.range_start=a.frame_start,a.range_end=a.frame_end;else return!1};a.set_cyclic=function(a){var b=E.get_active();if(b._nla)b._nla.cyclic=a;else return!1};a.clear_callback=function(){var a=E.get_active();a._nla&&(a._nla.user_callback=null)};a.set_offset_from_range_start=function(a){var b=E.get_active()._nla;b&&(b.frame_offset=
-(a-K)*z.get_framerate()+b.range_start,b.force_update=!0)};a.get_frame_end=function(){var a=E.get_active()._nla;return a?a.frame_end:null}};b4w.module.__camera=function(a,r){function u(a,b,c,e,g){wa.set_translation(a,b);c&&z(a,b,c);d(a,e);t(a,g)}function h(a,b,c,e,f,k,h,l){var m=a.render;wa.set_translation(a,b);m.pivot.set(c);z(a,b,c);d(a,e);t(a,f);g(a,k);H(a,h);m.use_panning=l}function b(a,b,c,d,e,g,f,k){var h=a.render;wa.set_translation(a,b);h.hover_pivot.set(c);z(a,b,c);x(a,d);C(a,e);G(a,g);ba(a,f);h.enable_hover_hor_rotation=k}function f(a,b,c){var d=a.render,e=ga.get_trans_view(d.world_tsr),g=ga.get_quat_view(d.world_tsr),d=xa;d.set(X.AXIS_Z);
d[3]=0;a=k(a,ja)[1];g=X.quat_to_dir(g,X.AXIS_MZ,ya);va.set_pline_initial_point(la,e);va.set_pline_directional_vec(la,g);if(!X.line_plane_intersect(d,-b,la,c)||Math.abs(a)<Ga)J.warn("Active hover camera view vector and the supporting plane are parallel to each other. Hover pivot will be set based on the camera position."),c[0]=e[0],c[1]=0,c[2]=e[2];return c}function l(b){for(var c=b.render,d=0;d<b.scenes_data.length;d++){var e=b.scenes_data[d].cameras[0];if(e.type==a.TYPE_ORTHO)switch(c.move_style){case a.MS_TARGET_CONTROLS:var g=
ga.get_trans_view(c.world_tsr);c.init_dist=ea.dist(g,c.pivot);c.init_top=e.top;break;case a.MS_HOVER_CONTROLS:g=ga.get_trans_view(c.world_tsr),c.init_dist=ea.dist(g,c.hover_pivot),c.init_top=e.top}}}function q(a){a={type:a,name:"",size_mult:1,width:0,height:0,framebuffer:null,framebuffer_prev:null,color_attachment:null,depth_attachment:null,aspect:0,fov:0,near:0,far:0,left:0,right:0,top:0,bottom:0,hmd_fov:aa.create(),world_tsr:new Float32Array(9),view_matrix:new Float32Array(16),view_refl_matrix:new Float32Array(16),
proj_matrix:new Float32Array(16),view_proj_matrix:new Float32Array(16),view_proj_inv_matrix:new Float32Array(16),prev_view_proj_matrix:new Float32Array(16),sky_vp_inv_matrix:new Float32Array(16),view_tsr:ga.create_ext(),view_tsr_inv:ga.create_ext(),real_view_tsr:ga.create_ext(),real_view_tsr_inv:ga.create_ext(),shadow_cast_billboard_view_tsr:ga.create_ext(),dof_distance:0,dof_front_start:0,dof_front_end:0,dof_rear_start:0,dof_rear_end:0,dof_power:0,dof_bokeh_intensity:0,dof_object:null,dof_bokeh_:!1,
dof_foreground_blur:!1,dof_on:!1,lod_eye:new Float32Array(3),frustum_planes:n(),stereo_conv_dist:0,stereo_eye_dist:0,reflection_plane:null,csm_centers:null,csm_radii:null,csm_center_dists:new Float32Array(4),pcf_blur_radii:new Float32Array(4)};a.hmd_fov[0]=a.hmd_fov[2]=45;a.hmd_fov[1]=a.hmd_fov[3]=55;return a}function e(a,b){var c=q(a.type);c.name=a.name;c.size_mult=a.size_mult;c.width=a.width;c.height=a.height;b||(c.framebuffer=a.framebuffer,c.framebuffer_prev=a.framebuffer_prev,c.color_attachment=
a.color_attachment,c.depth_attachment=a.depth_attachment);c.aspect=a.aspect;c.fov=a.fov;c.near=a.near;c.far=a.far;c.left=a.left;c.right=a.right;c.top=a.top;c.bottom=a.bottom;aa.copy(a.hmd_fov,c.hmd_fov);ga.copy(a.world_tsr,c.world_tsr);sa.copy(a.view_matrix,c.view_matrix);sa.copy(a.proj_matrix,c.proj_matrix);sa.copy(a.view_proj_matrix,c.view_proj_matrix);sa.copy(a.view_proj_inv_matrix,c.view_proj_inv_matrix);sa.copy(a.prev_view_proj_matrix,c.prev_view_proj_matrix);sa.copy(a.sky_vp_inv_matrix,c.sky_vp_inv_matrix);
ga.copy(a.view_tsr,c.view_tsr);ga.copy(a.view_tsr_inv,c.view_tsr_inv);ga.copy(a.real_view_tsr,c.real_view_tsr);ga.copy(a.real_view_tsr_inv,c.real_view_tsr_inv);ga.copy(a.shadow_cast_billboard_view_tsr,c.shadow_cast_billboard_view_tsr);c.dof_distance=a.dof_distance;c.dof_front_start=a.dof_front_start;c.dof_front_end=a.dof_front_end;c.dof_rear_start=a.dof_rear_start;c.dof_rear_end=a.dof_rear_end;c.dof_power=a.dof_power;c.dof_bokeh_intensity=a.dof_bokeh_intensity;c.dof_object=a.dof_object;c.dof_bokeh_=
a.dof_bokeh_;c.dof_foreground_blur=a.dof_foreground_blur;c.dof_on=a.dof_on;ea.copy(a.lod_eye,c.lod_eye);var d=a.frustum_planes,e=c.frustum_planes;aa.copy(d.left,e.left);aa.copy(d.right,e.right);aa.copy(d.top,e.top);aa.copy(d.bottom,e.bottom);aa.copy(d.near,e.near);aa.copy(d.far,e.far);c.stereo_conv_dist=a.stereo_conv_dist;c.stereo_eye_dist=a.stereo_eye_dist;a.reflection_plane&&(c.reflection_plane=aa.clone(a.reflection_plane));if(a.csm_centers){d=a.csm_centers.length;c.csm_centers=Array(d);for(e=0;e<
d;e++)c.csm_centers[e]=ea.clone(a.csm_centers[e]);c.csm_radii=new Float32Array(a.csm_radii)}aa.copy(a.csm_center_dists,c.csm_center_dists);aa.copy(a.pcf_blur_radii,c.pcf_blur_radii);return c}function n(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,0,0,0])}}function p(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;
case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:X.panic("Unknown move style")}}function B(b){var c=q(b);if(b==a.TYPE_NONE)return c;switch(b){case a.TYPE_PERSP:A(c,40,.1,1E3);break;case a.TYPE_ORTHO:A(c,2.5,.1,1E3);break;case a.TYPE_PERSP_ASPECT:break;case a.TYPE_ORTHO_ASPECT:break;case a.TYPE_ORTHO_ASYMMETRIC:break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:X.panic("Stereo camera may only be created from perspective one");
break;default:X.panic("Unknown camera type")}return c}function c(b,c,d){b.type!=a.TYPE_STEREO_LEFT&&b.type!=a.TYPE_STEREO_RIGHT&&b.type!=a.TYPE_HMD_LEFT&&b.type!=a.TYPE_HMD_RIGHT&&X.panic("set_stereo_params(): wrong camera type");if(b.type==a.TYPE_STEREO_LEFT||b.type==a.TYPE_STEREO_RIGHT)b.stereo_conv_dist=c;b.stereo_eye_dist=d;Y(b,b.aspect);if(za.check_active()&&(c=za.get_active(),b=c._render.shadow_params))for(c=ua.get_scene_data(za.get_camera(c),c).cameras,d=0;d<c.length;d++)ma(c[d],b)}function k(a,
b){var c=ga.get_quat_view(a.render.world_tsr);return m(c,b)}function m(a,b){var c=X.quat_to_dir(a,X.AXIS_Z,ya),d=X.quat_to_dir(a,X.AXIS_MY,Ea),e=-Math.asin(c[2]/ea.length(c)),c=Math.abs(e)>Math.PI/4?ea.scale(d,-X.sign(e),Ca):ea.scale(c,-X.sign(d[2]),Ca),g=Math.atan(Math.abs(c[0]/c[1]));0<d[2]&&(e=X.sign(e)*Math.PI-e);d=g;0<c[1]&&(d=Math.PI-d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function A(b,c,d,e,g){switch(b.type){case a.TYPE_PERSP:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:b.fov=
c;b.aspect=1;break;case a.TYPE_ORTHO:b.top=c;b.aspect=1;break;case a.TYPE_PERSP_ASPECT:b.fov=c;b.aspect=g/c;break;case a.TYPE_ORTHO_ASPECT:b.top=c;b.aspect=g/c;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:break;default:J.error("set_frustum(): Unsupported camera type: "+b.type)}b.near=d;b.far=e}function E(b,c){var d=ga.get_trans(c.render.world_tsr,ya),e=ga.get_quat(c.render.world_tsr,ia),d=sa.fromRotationTranslation(e,d,Ha);sa.invert(d,b.view_matrix);if(za.check_active())var g=za.get_active(),
g=za.get_subs(g,V.STEREO);if(b.type==a.TYPE_STEREO_LEFT||g&&g.enable_hmd_stereo&&b.type==a.TYPE_HMD_LEFT)b.view_matrix[12]+=b.stereo_eye_dist/2;else if(b.type==a.TYPE_STEREO_RIGHT||g&&g.enable_hmd_stereo&&b.type==a.TYPE_HMD_RIGHT)b.view_matrix[12]-=b.stereo_eye_dist/2;if(b.reflection_plane){ga.from_mat4(b.view_matrix,b.real_view_tsr);ga.invert(b.real_view_tsr,b.real_view_tsr_inv);var g=b.reflection_plane[0],d=b.reflection_plane[1],e=b.reflection_plane[2],f=b.reflection_plane[3],k=b.view_refl_matrix;
k[0]=1-2*g*g;k[1]=-2*g*d;k[2]=-2*g*e;k[3]=0;k[4]=-2*g*d;k[5]=1-2*d*d;k[6]=-2*d*e;k[7]=0;k[8]=-2*g*e;k[9]=-2*d*e;k[10]=1-2*e*e;k[11]=0;k[12]=-2*g*f;k[13]=-2*d*f;k[14]=-2*e*f;k[15]=1;sa.multiply(b.view_matrix,b.view_refl_matrix,b.view_matrix);Y(b,b.aspect,!0);g=xa;d=Ha;sa.invert(b.view_matrix,d);sa.transpose(d,d);aa.transformMat4(b.reflection_plane,d,g);d=La;d[0]=(X.sign(g[0])+b.proj_matrix[8])/b.proj_matrix[0];d[1]=(X.sign(g[1])+b.proj_matrix[9])/b.proj_matrix[5];d[2]=-1;d[3]=(1+b.proj_matrix[10])/
b.proj_matrix[14];aa.scale(g,2/(g[0]*d[0]+g[1]*d[1]+g[2]*d[2]+g[3]*d[3]),g);b.proj_matrix[2]=g[0];b.proj_matrix[6]=g[1];b.proj_matrix[10]=g[2]+1;b.proj_matrix[14]=g[3]}ga.from_mat4(b.view_matrix,b.view_tsr);ga.invert(b.view_tsr,b.view_tsr_inv);N(b);Z(b);ga.copy(c.render.world_tsr,b.world_tsr)}function w(b,c,d,e){sa.lookAt(c,d,e,b.view_matrix);d=za.get_active();d=za.get_subs(d,V.STEREO);za.check_active()&&(d=za.get_active(),d=za.get_subs(d,V.STEREO));if(b.type==a.TYPE_STEREO_LEFT||d&&d.enable_hmd_stereo&&
b.type==a.TYPE_HMD_LEFT)b.view_matrix[12]+=b.stereo_eye_dist/2;else if(b.type==a.TYPE_STEREO_RIGHT||d&&d.enable_hmd_stereo&&b.type==a.TYPE_HMD_RIGHT)b.view_matrix[12]-=b.stereo_eye_dist/2;ga.from_mat4(b.view_matrix,b.view_tsr);N(b);Z(b);ga.set_trans(c,b.world_tsr)}function v(a,b,c){c=ea.subtract(c,b,ya);ea.length(c)&&(ea.normalize(c,c),c=X.rotation_to_stable(X.AXIS_MZ,c,ia),wa.set_rotation(a,c));wa.set_translation(a,b)}function z(a,b,c){var d=a.render,e=K(a);v(a,b,c);e?(b=ea.copy(d.vertical_axis,
ya),ea.negate(b,b),S.correct_up(a,b,!0)):S.correct_up(a,d.vertical_axis,!0)}function y(a,b){var c=a.render,d=b.cameras;d||X.panic("Wrong object");for(var e=b.shadow_cameras,g=0;g<e.length;g++){var f=e[g];ea.copy(ga.get_trans_view(c.world_tsr),f.lod_eye)}for(g=0;g<d.length;g++)if(f=d[g],E(f,a),X.extract_frustum_planes(f.view_proj_matrix,f.frustum_planes),f.dof_object&&f.dof_on){var e=ga.get_trans_view(c.world_tsr),k=wa.get_translation(f.dof_object,ya),e=ea.dist(e,k);f.dof_distance=e}}function D(b){var c=
b.render;c.move_style==a.MS_TARGET_CONTROLS&&(c.target_cam_upside_down=K(b))}function K(a){a=ga.get_quat_view(a.render.world_tsr);return 0>X.quat_to_dir(a,X.AXIS_Y,ya)[2]}function d(b,c){var d=b.render;if(c){d.horizontal_limits=d.horizontal_limits||{};d.horizontal_limits.left=c.left;d.horizontal_limits.right=c.right;d.horizontal_limits.left_local=c.left;d.horizontal_limits.right_local=c.right;d.horizontal_limits.camera_space=Boolean(c.camera_space);var e=b.render;!(d=e.horizontal_limits)||e.move_style!=
a.MS_EYE_CONTROLS&&e.move_style!=a.MS_TARGET_CONTROLS||(e=k(b,ja),d.camera_space?(d.left+=e[0],d.right+=e[0]):(d.left_local-=e[0],d.right_local-=e[0]),d.left=X.angle_wrap_0_2pi(d.left),d.right=X.angle_wrap_0_2pi(d.right),d.left_local=X.angle_wrap_0_2pi(d.left_local),d.right_local=X.angle_wrap_0_2pi(d.right_local))}else d.horizontal_limits=null}function t(a,b){var c=a.render;b?(c.vertical_limits=c.vertical_limits||{},c.vertical_limits.down=b.down,c.vertical_limits.up=b.up,c.vertical_limits.down_local=
b.down,c.vertical_limits.up_local=b.up,c.vertical_limits.camera_space=Boolean(b.camera_space),M(a)):c.vertical_limits=null}function C(a,b){var c=a.render;if(!b){var d=k(a,ja);b={down:d[1],up:d[1]}}c.vertical_limits=c.vertical_limits||{};c.vertical_limits.down=b.down;c.vertical_limits.up=b.up;M(a);c.distance_limits&&c.vertical_limits&&ha(a)}function M(b){var c=b.render,d=c.vertical_limits;if(d)switch(c.move_style){case a.MS_EYE_CONTROLS:case a.MS_TARGET_CONTROLS:b=k(b,ja);d.camera_space?(d.up+=b[1],
d.down+=b[1]):(d.up_local-=b[1],d.down_local-=b[1]);d.up=X.angle_wrap_periodic(d.up,-Math.PI,Math.PI);d.down=X.angle_wrap_periodic(d.down,-Math.PI,Math.PI);d.up_local=X.angle_wrap_periodic(d.up_local,-Math.PI,Math.PI);d.down_local=X.angle_wrap_periodic(d.down_local,-Math.PI,Math.PI);break;case a.MS_HOVER_CONTROLS:d.up=X.angle_wrap_periodic(d.up,-Math.PI,Math.PI),d.down=X.angle_wrap_periodic(d.down,-Math.PI,Math.PI),d.up=X.clamp(d.up,-Math.PI/2,0),d.down=X.clamp(d.down,-Math.PI/2,0)}}function x(a,
b){var c=a.render;if(!b){var d=wa.obj_point_distance(a,c.hover_pivot);b={min:d,max:d}}c.distance_limits=c.distance_limits||{};c.distance_limits.min=b.min;c.distance_limits.max=b.max;c.distance_limits&&c.vertical_limits&&ha(a)}function g(a,b){var c=a.render;b?(c.distance_limits=c.distance_limits||{},c.distance_limits.min=b.min,c.distance_limits.max=b.max):c.distance_limits=null}function H(a,b){var c=a.render;b?(c.pivot_limits=c.pivot_limits||{},c.pivot_limits.min_z=b.min_z,c.pivot_limits.max_z=b.max_z):
c.pivot_limits=null}function G(a,b){var c=a.render;b?(c.hover_horiz_trans_limits=c.hover_horiz_trans_limits||{},c.hover_horiz_trans_limits.min=b.min,c.hover_horiz_trans_limits.max=b.max):c.hover_horiz_trans_limits=null}function ba(a,b){var c=a.render;b?(c.hover_vert_trans_limits=c.hover_vert_trans_limits||{},c.hover_vert_trans_limits.min=b.min,c.hover_vert_trans_limits.max=b.max):c.hover_vert_trans_limits=null}function L(b){var c=b.render;if(ua.is_camera(b))for(var d=b.scenes_data,e=0;e<d.length;e++){var g=
d[e].cameras;if(g[0].type===a.TYPE_ORTHO){switch(c.move_style){case a.MS_TARGET_CONTROLS:var f=ga.get_trans_view(c.world_tsr),f=ea.dist(f,c.pivot),f=f/c.init_dist*c.init_top;break;case a.MS_HOVER_CONTROLS:f=ga.get_trans_view(c.world_tsr);f=ea.distance(f,c.hover_pivot);f=f/c.init_dist*c.init_top;break;default:f=g[0].top}for(var k=0;k<g.length;k++){var h=g[k];h.top=f;Y(h,h.aspect)}y(b,d[e])}}}function F(b){var c=b.render,d=c.move_style;if(d===a.MS_TARGET_CONTROLS||d===a.MS_EYE_CONTROLS){if(c.horizontal_limits){var e=
c.horizontal_limits.left,g=c.horizontal_limits.right,f=k(b,ja);(f=d==a.MS_TARGET_CONTROLS?X.calc_returning_angle(f[0],e,g):X.calc_returning_angle(f[0],g,e))&&(d==a.MS_TARGET_CONTROLS?Q(b,f,0):U(b,f,0))}c.vertical_limits&&(e=c.vertical_limits.down,g=c.vertical_limits.up,f=k(b,ja),(f=d==a.MS_TARGET_CONTROLS?X.calc_returning_angle(f[1],g,e):X.calc_returning_angle(f[1],e,g))&&(d==a.MS_TARGET_CONTROLS?Q(b,0,f):U(b,0,f)));if(d===a.MS_TARGET_CONTROLS&&c.distance_limits){var f=b.render,e=ga.get_trans_view(f.world_tsr),
g=ea.subtract(e,f.pivot,ya),h=ea.length(g);h>f.distance_limits.max?(ea.scale(g,f.distance_limits.max/h,g),ea.add(f.pivot,g,e)):h<f.distance_limits.min&&(h=ga.get_quat_view(f.world_tsr),h=X.quat_to_dir(h,X.AXIS_MZ,Ea),ea.scale(h,100*f.distance_limits.min,h),ea.add(g,h,g),ea.scale(g,-f.distance_limits.min/ea.length(g),g),ea.add(f.pivot,g,e))}}d===a.MS_TARGET_CONTROLS&&c.pivot_limits&&(c=b.render,f=c.pivot[2],e=X.clamp(c.pivot[2],c.pivot_limits.min_z,c.pivot_limits.max_z),e!=f&&(f=ea.set(0,0,e-f,ya),
ea.add(c.pivot,f,c.pivot),c=ga.get_trans_view(c.world_tsr),ea.add(c,f,c)));d===a.MS_HOVER_CONTROLS&&(d=b.render,d.hover_horiz_trans_limits&&(f=X.clamp(d.hover_pivot[0],d.hover_horiz_trans_limits.min,d.hover_horiz_trans_limits.max)-d.hover_pivot[0],d.hover_pivot[0]+=f,c=ga.get_trans_view(d.world_tsr),c[0]+=f),d.hover_vert_trans_limits&&(f=X.clamp(d.hover_pivot[1],d.hover_vert_trans_limits.min,d.hover_vert_trans_limits.max)-d.hover_pivot[1],d.hover_pivot[1]+=f,c=ga.get_trans_view(d.world_tsr),c[1]+=
f),d=b.render,c=k(b,ja)[1],(d=X.calc_returning_angle(c,d.vertical_limits.up,d.vertical_limits.down))&&T(b,0,d))}function U(a,b,c,d,e){var g=a.render,f=b,h=c;if(d||e)a=k(a,pa),d&&(f=b-a[0]),e&&(h=c-a[1]);if(f||h)b=na.identity(ia),f&&(f=na.setAxisAngle(g.vertical_axis,f,oa),na.multiply(b,f,b)),g=ga.get_quat_view(g.world_tsr),h&&(f=X.quat_to_dir(g,X.AXIS_X,ya),h=na.setAxisAngle(f,h,oa),na.normalize(h,h),na.multiply(b,h,b)),na.multiply(b,g,g)}function Q(a,b,c,d,e){var g=a.render,f=b,h=c;if(d||e){var l=
k(a,pa);d&&(f=b-l[0]);e&&(h=c-l[1])}W(a,a.render.pivot,f,h);a=k(a,pa);a=X.angle_wrap_periodic(a[1],-Math.PI,Math.PI);g.target_cam_upside_down=Math.abs(a)>Math.PI/2}function T(a,b,c,d,e){var g=a.render,f=b,h=c;if(d||e){var l=k(a,pa);d&&(f=b-l[0]);e&&(h=c-l[1])}g.enable_hover_hor_rotation||(f=0);W(a,g.hover_pivot,f,h);h&&ha(a)}function W(a,b,c,d){var e=a.render;if(c||d){var g=na.identity(ia);c&&(c=na.setAxisAngle(X.AXIS_Z,c,oa),na.multiply(g,c,g));I(a);a=ga.get_quat_view(e.world_tsr);d&&(c=X.quat_to_dir(a,
X.AXIS_X,ya),d=na.setAxisAngle(c,d,oa),na.normalize(d,d),na.multiply(g,d,g));e=ga.get_trans_view(e.world_tsr);X.rotate_point_pivot(e,b,g,e);na.multiply(g,a,a)}}function ha(a){var b=a.render,c=k(a,ja)[1],d=a.render;a=d.vertical_limits;d=d.distance_limits;a.down-a.up?(c=(a.down-c)/(a.down-a.up),c=Math.max(c,0)):c=0;c=c*(d.max-d.min)+d.min;a=ga.get_trans_view(b.world_tsr);d=ga.get_quat_view(b.world_tsr);d=X.quat_to_dir(d,X.AXIS_MZ,ya);ea.normalize(d,d);ea.scale(d,c,d);ea.subtract(b.hover_pivot,d,a)}
function Y(b,c,d){switch(b.type){case a.TYPE_PERSP:c||X.panic("No aspect ratio"),b.aspect=c;case a.TYPE_PERSP_ASPECT:sa.perspective(X.deg_to_rad(b.fov),b.aspect,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO:c||X.panic("No aspect ratio"),b.aspect=c;case a.TYPE_ORTHO_ASPECT:c=b.top*b.aspect;sa.ortho(-c,c,-b.top,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO_ASYMMETRIC:sa.ortho(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:c||
X.panic("No aspect ratio");b.aspect=c;var e=Math.tan(b.fov*Math.PI/360);c=b.near*e;var g=b.aspect*b.stereo_conv_dist*e;b.type==a.TYPE_STEREO_LEFT?(e=g-b.stereo_eye_dist/2,g+=b.stereo_eye_dist/2):(e=g+b.stereo_eye_dist/2,g-=b.stereo_eye_dist/2);e=-(b.near/b.stereo_conv_dist*e);g*=b.near/b.stereo_conv_dist;sa.frustum(e,g,-c,c,b.near,b.far,b.proj_matrix);b.left=e;b.right=g;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:if(za.check_active())if(e=za.get_active(),(e=za.get_subs(e,V.STEREO))&&e.enable_hmd_stereo){c=
Math.tan(X.deg_to_rad(b.hmd_fov[0]));var e=Math.tan(X.deg_to_rad(b.hmd_fov[1])),g=Math.tan(X.deg_to_rad(b.hmd_fov[2])),f=Math.tan(X.deg_to_rad(b.hmd_fov[3]));b.top=b.near*c;b.right=b.near*e;b.bottom=-b.near*g;b.left=-b.near*f;sa.frustum(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix)}else c||(c=b.aspect),sa.perspective(X.deg_to_rad(b.fov),c,b.near,b.far,b.proj_matrix);break;case a.TYPE_NONE:return;default:X.panic("Wrong camera type: "+b.type)}d||(N(b),Z(b))}function Z(a){sa.copy(a.view_matrix,
a.sky_vp_inv_matrix);a.sky_vp_inv_matrix[12]=0;a.sky_vp_inv_matrix[13]=0;a.sky_vp_inv_matrix[14]=0;a.sky_vp_inv_matrix[15]=1;sa.multiply(a.proj_matrix,a.sky_vp_inv_matrix,a.sky_vp_inv_matrix);sa.invert(a.sky_vp_inv_matrix,a.sky_vp_inv_matrix)}function N(a){sa.copy(a.view_matrix,a.view_proj_matrix);sa.multiply(a.proj_matrix,a.view_proj_matrix,a.view_proj_matrix);sa.invert(a.view_proj_matrix,a.view_proj_inv_matrix)}function ca(b,c,d,e,g){e||(e=new Float32Array(24));c||(c=b.near);d||(d=b.far);var f,
k,h,l,m,n,P,p;switch(b.type){case a.TYPE_NONE:X.panic("Extraction from NONE camera is not possible");break;case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:f=c*Math.tan(b.fov*Math.PI/360);l=-f;k=f*b.aspect;h=-k;m=d/c*f;p=-m;n=m*b.aspect;P=-n;break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:h=b.top*b.aspect;f=m=b.top;k=n=h;l=p=-b.top;h=P=-h;break;case a.TYPE_ORTHO_ASYMMETRIC:f=m=b.top;k=n=b.right;l=p=b.bottom;h=P=b.left;break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:m=c/b.near;f=c*Math.tan(b.fov*
Math.PI/360);l=-f;k=b.right*m;h=b.left*m;P=d/c;m=f*P;p=-m;n=k*P;P*=h;break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:m=c/b.near;f=b.top*m;l=b.bottom*m;k=b.right*m;h=b.left*m;P=d/c;m=f*P;p=l*P;n=k*P;P*=h;break;default:X.panic("Wrong camera type: "+b.type)}e[0]=h;e[1]=l;e[2]=-c;e[3]=k;e[4]=l;e[5]=-c;e[6]=k;e[7]=f;e[8]=-c;e[9]=h;e[10]=f;e[11]=-c;e[12]=P;e[13]=p;e[14]=-d;e[15]=P;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=p;e[23]=-d;g&&(c=Ha,sa.invert(b.view_matrix,c),X.positions_multiply_matrix(e,
c,e,0));return e}function I(b){return ua.is_camera(b)&&b.render&&b.render.move_style==a.MS_HOVER_CONTROLS}function ma(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.csm_centers){var d=b.csm_num;a.csm_centers=Array(d);for(var e=0;e<d;e++)a.csm_centers[e]=new Float32Array(3);a.csm_radii=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.near:da(b,a,d-1),g=da(b,a,d),e=ca(a,e,g,P),e=ra.get_frustum_mec(e);a.csm_centers[d].set(e.center);a.csm_radii[d]=e.radius;a.csm_center_dists[d]=ea.length(e.center);a.pcf_blur_radii[d]=
fa(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.pcf_blur_radii[0]=b.first_cascade_blur_radius}function da(a,b,c){var d=a.csm_num,e=X.clamp(a.csm_first_cascade_border,b.near,b.far);a=X.clamp(a.csm_last_cascade_border,b.near,b.far);c=fa(e,a,d,c);return X.clamp(c,b.near,b.far)}function fa(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}function Aa(a,b){b||(b=new Float32Array(3));var c=ga.get_trans_view(a.render.world_tsr);ea.copy(c,
b);return b}var ra=r("__boundings");r("__config");var S=r("__constraints"),R=r("__container"),sa=r("__mat4"),va=r("__math"),ua=r("__obj_util"),J=r("__print"),na=r("__quat"),za=r("__scenes"),V=r("__subscene"),wa=r("__transform"),ga=r("__tsr"),X=r("__util"),ea=r("__vec3"),aa=r("__vec4");a.TYPE_NONE=10;a.TYPE_PERSP=20;a.TYPE_ORTHO=30;a.TYPE_PERSP_ASPECT=40;a.TYPE_ORTHO_ASPECT=50;a.TYPE_ORTHO_ASYMMETRIC=60;a.TYPE_STEREO_LEFT=70;a.TYPE_STEREO_RIGHT=80;a.TYPE_HMD_LEFT=90;a.TYPE_HMD_RIGHT=100;a.MS_STATIC=
0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var Ga=X.deg_to_rad(.5),ja=new Float32Array(2),pa=new Float32Array(2),ya=new Float32Array(3),Ea=new Float32Array(3),Ca=new Float32Array(3),ia=new Float32Array(4),oa=new Float32Array(4),xa=new Float32Array(4),La=new Float32Array(4),Ha=new Float32Array(16),P=new Float32Array(24),la=new Float32Array(6);a.camera_object_to_camera=function(c,d){var g=d.render,k=c.data;switch(k.type){case "PERSP":var m=B(a.TYPE_PERSP);if(k.angle_y)var P=
X.rad_to_deg(k.angle_y);A(m,P,k.clip_start,k.clip_end);break;case "ORTHO":m=B(a.TYPE_ORTHO),A(m,k.ortho_scale/2,k.clip_start,k.clip_end)}m.name=d.name;P=d.scenes_data;P[0].cameras.push(m);for(var n=1;n<P.length;n++){var t=e(m,!1);P[n].cameras.push(t)}g.move_style=p(k.b4w_move_style);g.dof_distance=k.dof_distance;m=k.dof_object;g.dof_object=m?m._object:null;g.dof_front_start=k.b4w_dof_front_start;g.dof_front_end=k.b4w_dof_front_end;g.dof_rear_start=k.b4w_dof_rear_start;g.dof_rear_end=k.b4w_dof_rear_end;
g.dof_power=k.b4w_dof_power;g.dof_bokeh=k.b4w_dof_bokeh;g.dof_bokeh_intensity=k.b4w_dof_bokeh_intensity;g.dof_foreground_blur=k.b4w_dof_foreground_blur;g.velocity_trans=k.b4w_trans_velocity;g.velocity_rot=k.b4w_rot_velocity;g.velocity_zoom=k.b4w_zoom_velocity;m=d.render.move_style;P=c.data;n=null;m!=a.MS_TARGET_CONTROLS&&m!=a.MS_EYE_CONTROLS||!P.b4w_use_horizontal_clamping||(n={left:P.b4w_rotation_left_limit,right:P.b4w_rotation_right_limit,camera_space:"LOCAL"==P.b4w_horizontal_clamping_type},m==
a.MS_EYE_CONTROLS&&(n.left*=-1,n.right*=-1));m=n;P=d.render.move_style;n=c.data;t=null;P!=a.MS_TARGET_CONTROLS&&P!=a.MS_EYE_CONTROLS||!n.b4w_use_vertical_clamping?P==a.MS_HOVER_CONTROLS&&n.b4w_use_zooming&&(n.b4w_hover_angle_min<=n.b4w_hover_angle_max?(t={down:n.b4w_hover_angle_min,up:n.b4w_hover_angle_max},t.down*=-1,t.up*=-1):J.error("Wrong angle limits for the HOVER camera. Disabling angle limits.")):(t={down:n.b4w_rotation_down_limit,up:n.b4w_rotation_up_limit,camera_space:"LOCAL"==n.b4w_vertical_clamping_type},
P==a.MS_TARGET_CONTROLS&&(t.down*=-1,t.up*=-1));var P=t,n=d.render.move_style,t=c.data,q=null;n==a.MS_TARGET_CONTROLS&&t.b4w_use_target_distance_limits&&t.b4w_distance_min<=t.b4w_distance_max?q={min:t.b4w_distance_min,max:t.b4w_distance_max}:n===a.MS_HOVER_CONTROLS&&t.b4w_use_zooming&&(t.b4w_distance_min<=t.b4w_distance_max?q={min:t.b4w_distance_min,max:t.b4w_distance_max}:J.error("Wrong distance limits for the HOVER camera. Disabling distance limits."));n=q;t=c.data;q=null;d.render.move_style==a.MS_HOVER_CONTROLS&&
t.b4w_use_horizontal_clamping&&t.b4w_horizontal_translation_min<=t.b4w_horizontal_translation_max&&(q={min:t.b4w_horizontal_translation_min,max:t.b4w_horizontal_translation_max});var t=q,q=c.data,la=null;d.render.move_style==a.MS_HOVER_CONTROLS&&q.b4w_use_vertical_clamping&&q.b4w_vertical_translation_min<=q.b4w_vertical_translation_max&&(la={min:q.b4w_vertical_translation_min,max:q.b4w_vertical_translation_max});var q=la,la=c.data,v=null;d.render.move_style==a.MS_TARGET_CONTROLS&&la.b4w_use_pivot_limits&&
(v={min_z:la.b4w_pivot_z_min,max_z:la.b4w_pivot_z_max});la=v;switch(g.move_style){case a.MS_EYE_CONTROLS:g=ga.get_trans_view(d.render.world_tsr);u(d,g,null,m,P);break;case a.MS_TARGET_CONTROLS:g=ga.get_trans_view(d.render.world_tsr);h(d,g,k.b4w_target,m,P,n,la,k.b4w_use_panning);break;case a.MS_HOVER_CONTROLS:g=ga.get_trans_view(d.render.world_tsr),m=f(d,c.data.b4w_hover_zero_level,Ea),b(d,g,m,n,P,t,q,k.b4w_enable_hover_hor_rotation)}F(d);l(d)};a.setup_eye_model=u;a.setup_target_model=h;a.setup_hover_model=
b;a.init_ortho_props=l;a.clone_camera=e;a.create_frustum_planes=n;a.move_style_bpy_to_b4w=p;a.create_camera=B;a.check_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.color_attachment);case "DEPTH":return Boolean(a.depth_attachment);case "SCREEN":return!Boolean(a.color_attachment)&&!Boolean(a.depth_attachment);default:X.panic("Wrong attachment type: "+b)}};a.set_attachment=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.color_attachment=c;break;case "DEPTH":a.depth_attachment=
c;break;case "SCREEN":a.color_attachment=null;a.depth_attachment=null;break;default:X.panic("Wrong attachment type: "+b)}};a.get_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.color_attachment;case "DEPTH":return a.depth_attachment;case "SCREEN":return null;default:X.panic("Wrong attachment type: "+b)}};a.make_stereo=function(b,d){(b.type!=a.TYPE_PERSP||d!=a.TYPE_STEREO_LEFT&&d!=a.TYPE_STEREO_RIGHT&&d!=a.TYPE_HMD_LEFT&&d!=a.TYPE_HMD_RIGHT)&&X.panic("make_stereo(): wrong camera type");
b.type=d;c(b,6,.065)};a.set_stereo_params=c;a.get_camera_angles=k;a.get_camera_angles_from_quat=m;a.get_camera_angles_char=function(a,b){k(a,b);b[0]=X.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.set_frustum=A;a.set_frustum_asymmetric=function(b,c,d,e,g,f,k){switch(b.type){case a.TYPE_ORTHO_ASYMMETRIC:b.left=c;b.right=d;b.bottom=e;b.top=g;b.near=f;b.far=k;break;default:J.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.render.move_style};
a.set_view=E;a.set_view_eye_target_up=w;a.set_view_trans_quat=function(a,b,c){var d=ya;d[0]=0;d[1]=0;d[2]=-1;ea.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=Ea;e[0]=0;e[1]=1;e[2]=0;ea.transformQuat(e,c,e);w(a,b,d,e)};a.set_look_at=v;a.set_look_at_corrected=z;a.update_camera_transform=y;a.update_camera=function(b){var d=b.render;F(b);L(b);switch(d.move_style){case a.MS_TARGET_CONTROLS:var e=ga.get_trans_view(d.world_tsr),g=ga.get_quat_view(d.world_tsr);S.rotate_to(e,g,d.pivot);for(g=
0;g<b.scenes_data.length;g++)for(var f=b.scenes_data[g].cameras,k=0;k<f.length;k++){var h=f[k];h.type!=a.TYPE_STEREO_LEFT&&h.type!=a.TYPE_STEREO_RIGHT||c(h,ea.dist(e,d.pivot),h.stereo_eye_dist)}S.correct_up(b,d.vertical_axis);break;case a.MS_EYE_CONTROLS:b.constraint||S.correct_up(b,d.vertical_axis)}D(b)};a.update_camera_upside_down=D;a.set_horizontal_rot_limits=d;a.set_vertical_rot_limits=t;a.hover_set_vertical_limits=C;a.hover_set_distance_limits=x;a.set_distance_limits=g;a.set_pivot_limits=H;a.set_hor_trans_limits=
G;a.set_vert_trans_limits=ba;a.update_ortho_scale=L;a.rotate_eye_camera=U;a.rotate_target_camera=Q;a.rotate_hover_camera=T;a.is_float_aspect=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_ORTHO:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return!0;default:return!1}};a.get_angular_diameter=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return X.deg_to_rad(b.fov);default:return J.error("get_angular_diameter(): Unsupported camera type: "+
b.type),0}};a.set_projection=Y;a.set_color_pick_proj=function(b,c,d,e,g){var f=1/Math.max(g,e);switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:g/=2;e/=2;d=-(d-g)/g*Math.tan(X.deg_to_rad(b.fov)/2);c=(c-e)/e*Math.tan(X.deg_to_rad(b.fov)/2)*b.aspect;e=b.near*(d+f);g=b.near*(c+f);d=b.near*(d-f);c=b.near*(c-f);sa.frustum(c,g,d,e,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:b.right=b.top*b.aspect;d=-d/g;c/=e;e=b.top+(d+f)*(b.top+b.top);g=-b.right+(c+f)*(b.right+
b.right);d=b.top+(d-f)*(b.top+b.top);c=-b.right+(c-f)*(b.right+b.right);sa.ortho(c,g,d,e,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO_ASYMMETRIC:d=-d/g,c/=e,e=b.top+(d+f)*(b.top-b.bottom),g=b.left+(c+f)*(b.right-b.left),d=b.top+(d-f)*(b.top-b.bottom),c=b.left+(c-f)*(b.right-b.left),sa.ortho(c,g,d,e,b.near,b.far,b.proj_matrix)}sa.copy(b.view_matrix,b.view_proj_matrix);sa.multiply(b.proj_matrix,b.view_proj_matrix,b.view_proj_matrix);X.extract_frustum_planes(b.view_proj_matrix,b.frustum_planes)};
a.calc_sky_vp_inverse=Z;a.calc_view_proj_inverse=N;a.extract_frustum_corners=ca;a.assign_boundings=function(a){a=a.render;var b=ra.create_bb();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.bb_local=b;var c=ra.bs_from_values(1,X.f32([0,0,0]));a.bs_local=c;a.bcap_local=ra.bcap_from_values(1,b);a.bcyl_local=ra.bcyl_from_values(1,b);a.bcon_local=ra.bcon_from_values(1,b)};a.is_static_camera=function(b){return ua.is_camera(b)&&b.render&&b.render.move_style==a.MS_STATIC};a.is_target_camera=
function(b){return ua.is_camera(b)&&b.render&&b.render.move_style==a.MS_TARGET_CONTROLS};a.is_eye_camera=function(b){return ua.is_camera(b)&&b.render&&b.render.move_style==a.MS_EYE_CONTROLS};a.is_hover_camera=I;a.is_ortho_camera=function(b){return ua.is_camera(b)&&b.render&&b.scenes_data[0].cameras[0].type==a.TYPE_ORTHO};a.update_camera_shadows=ma;a.csm_far_plane=da;a.project_point=function(b,c,d){b=b.scenes_data[0].cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:var e=
xa;e.set(c);e[3]=1;aa.transformMat4(e,b.view_proj_matrix,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;R.viewport_to_canvas_coords(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return J.error("Non-compatible camera"),d}};a.get_first_cam=function(a){return a.scenes_data[0].cameras[0]};a.get_edge=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=Math.tan(X.deg_to_rad(b.fov)/
2);switch(c){case "LEFT":return-d*b.aspect;case "RIGHT":return d*b.aspect;case "TOP":return d;case "BOTTOM":return-d}break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:switch(c){case "LEFT":return-b.top*b.aspect;case "RIGHT":return b.top*b.aspect;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.TYPE_ORTHO_ASYMMETRIC:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;case a.TYPE_HMD_LEFT:case a.TYPE_HMD_RIGHT:switch(c){case "LEFT":return Math.tan(X.deg_to_rad(b.hmd_fov[3]));
case "RIGHT":return Math.tan(X.deg_to_rad(b.hmd_fov[1]));case "TOP":return Math.tan(X.deg_to_rad(b.hmd_fov[0]));case "BOTTOM":return Math.tan(X.deg_to_rad(b.hmd_fov[2]))}break;default:X.panic("Unknown camera type")}};a.is_ortho=function(b){switch(b.type){case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_ORTHO_ASYMMETRIC:return!0;default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=X.deg_to_rad(b.fov);
return c?d*b.aspect:d;default:return 0}};a.set_trans_pivot=function(a,b,c){a=a.render;ga.set_trans(b,a.world_tsr);ea.copy(c,a.pivot)};a.set_hover_pivot=function(a,b){var c=a.render,d=ea.subtract(b,c.hover_pivot,ya),e=ga.get_trans_view(c.world_tsr),d=ea.add(d,e,d);wa.set_translation(a,d);ea.copy(b,c.hover_pivot)};a.set_target_pivot=function(a,b){var c=a.render,d=ea.subtract(b,c.pivot,ya),e=ga.get_trans_view(c.world_tsr),d=ea.add(d,e,d);wa.set_translation(a,d);ea.copy(b,c.pivot)};a.get_eye=Aa;a.set_move_style=
function(c,d){c.render.move_style=d;c.render.horizontal_limits=null;c.render.vertical_limits=null;c.render.distance_limits=null;c.render.hover_horiz_trans_limits=null;c.render.hover_vert_trans_limits=null;l(c);switch(d){case a.MS_HOVER_CONTROLS:var e=ga.get_trans_view(c.render.world_tsr),g=f(c,0,Ea);b(c,e,g,null,null,null,null,c.render.enable_hover_hor_rotation);break;case a.MS_TARGET_CONTROLS:e=Aa(c,ya),g=ga.get_quat_view(c.render.world_tsr),g=X.quat_to_dir(g,X.AXIS_MZ,Ea),g=ea.scaleAndAdd(e,g,10,
g),ea.copy(g,c.render.pivot)}};a.wipe_move_style=function(a){a=a.render;a.move_style=0;ea.set(0,0,0,a.pivot);ea.set(0,0,0,a.hover_pivot);a.target_cam_upside_down=!1;a.use_panning=!1;a.horizontal_limits=null;a.vertical_limits=null;a.distance_limits=null;a.hover_horiz_trans_limits=null;a.hover_vert_trans_limits=null;a.pivot_limits=null;a.enable_hover_hor_rotation=!0};a.set_eye_distance=function(a,b){for(var d=0;d<a.length;d++){var e=a[d];70!=e.type&&80!=e.type&&90!=e.type&&100!=e.type||c(e,e.stereo_conv_dist,
b)}};a.set_hmd_fov=function(a,b,c){var d=za.get_active();a=ua.get_scene_data(a,d).cameras;for(d=0;d<a.length;d++){var e=a[d];if(90==e.type||100==e.type)90==e.type&&aa.copy(b,e.hmd_fov),100==e.type&&aa.copy(c,e.hmd_fov),e.reflection_plane||Y(e),N(e),Z(e)}}};b4w.module.__lights=function(a,r){function u(a){f.scale(a.color,a.energy,a.color_intensity)}r("__print");var h=r("__tsr"),b=r("__util"),f=r("__vec3"),l=new Float32Array(3);new Float32Array(3);a.lamp_to_light=function(a,e){var n=a.data,p={name:"",type:n.type,prev_direction:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),color_intensity:new Float32Array(3),default_energy:0,use_sphere:!1,spot_size:0,spot_blend:0,clip_start:.1,clip_end:30,generate_shadows:!1,need_sun_fog_update:!1,
dynamic_intensity:!1,use_diffuse:!0,use_specular:!0,energy:1,distance:25,falloff_type:"INVERSE_SQUARE"},p=e.light=p;p.name=e.name;p.use_diffuse=n.use_diffuse;p.use_specular=n.use_specular;var B=h.get_quat_view(e.render.world_tsr),B=b.quat_to_dir(B,b.AXIS_Z,l);f.normalize(B,B);p.direction.set(B);p.color[0]=n.color[0];p.color[1]=n.color[1];p.color[2]=n.color[2];p.energy=p.default_energy=n.energy;u(p);p.distance=n.distance;p.use_sphere=n.use_sphere;p.clip_start=n.clip_start;p.clip_end=n.clip_end;if("POINT"===
p.type||"SPOT"===p.type)p.distance=n.distance;"SPOT"===p.type?(p.spot_blend=n.spot_blend,p.spot_size=n.spot_size):"POINT"===p.type&&(p.spot_size=Math.PI/2);p.generate_shadows=n.b4w_generate_shadows;p.dynamic_intensity=n.b4w_dynamic_intensity};a.set_light_color=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];u(a)};a.set_light_spot_blend=function(a,b){a.spot_blend=b};a.set_light_distance=function(a,b){a.distance=b};a.set_light_spot_size=function(a,b){a.spot_size=b};a.set_light_energy=
function(a,b){a.energy=b;u(a)};a.update_light_transform=function(a){var e=a.light;if(e){a=h.get_quat_view(a.render.world_tsr);b.quat_to_dir(a,b.AXIS_Z,e.direction);f.normalize(e.direction,e.direction);if("SUN"==e.type){a=Math.acos(f.dot(e.prev_direction,b.VEC3_UNIT));var l=Math.acos(f.dot(e.direction,b.VEC3_UNIT));e.need_sun_fog_update=Math.floor(a/.025)!=Math.floor(l/.025)?!0:!1}f.copy(e.direction,e.prev_direction)}}};b4w.module.__scenes=function(a,r){function u(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c._render_to_textures||!c._render_to_textures.length)return c}return null}function h(){qb||Ja.panic("No active scene available");return qb}function b(a,b,c){if(!Da.depth_tex_available||!f(a,b,c))return null;c=a.b4w_shadow_settings;var d={};c.csm_resolution>$b.max_texture_size?(d.csm_resolution=$b.max_texture_size,Fa.error("Shadow map texture has unsupported size. Changed to "+$b.max_texture_size+".")):d.csm_resolution=
c.csm_resolution;Da.blur_samples=c.blur_samples;d.soft_shadows=c.soft_shadows;a=P.get_shadow_lamps(b,Da.ssao&&a.b4w_enable_ssao);d.self_shadow_polygon_offset=c.self_shadow_polygon_offset;d.self_shadow_normal_offset=c.self_shadow_normal_offset;d.enable_csm=c.b4w_enable_csm&&1==a.length;d.lamp_types=[];d.spot_sizes=[];d.clip_start=[];d.clip_end=[];for(b=0;b<a.length;b++)d.lamp_types.push(a[b].light.type),d.spot_sizes.push(a[b].light.spot_size),d.clip_start.push(a[b].light.clip_start),d.clip_end.push(a[b].light.clip_end),
"SPOT"!=d.lamp_types[b]&&"POINT"!=d.lamp_types[b]||!d.enable_csm||(Fa.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),d.enable_csm=!1);d.enable_csm?(d.csm_num=c.csm_num,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=c.fade_last_cascade,d.blend_between_cascades=c.blend_between_cascades):
(d.csm_num=1,d.csm_first_cascade_border=c.csm_first_cascade_border,d.first_cascade_blur_radius=c.first_cascade_blur_radius,d.csm_last_cascade_border=c.csm_last_cascade_border,d.last_cascade_blur_radius=c.last_cascade_blur_radius,d.fade_last_cascade=!1,d.blend_between_cascades=!1);return d}function f(a,b,c){if(0!=b.length&&Da.shadows)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=Da.ssao&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var g=
c[b];g.b4w_shadow_cast&&(d=!0);g.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function l(a){for(var b=0;b<a.length;b++)if("SUN"==a[b].light.type)return!0;return!1}function q(a){if(!Da.shore_smoothing)return!1;a=Aa(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function e(a){for(var b=0;b<a.length;b++)for(var c=a[b].particle_systems,d=0;d<c.length;d++)if(P.check_obj_soft_particles_accessibility(a[b],c[d].settings))return!0;return!1}
function n(a){for(var b=Aa(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var g={},f=0;f<a.length;f++)for(var k=a[f],h=k.data.materials,l=0;l<h.length;l++)h[l]==e&&(g.water_level=k.location[2]);g.fog_color_density=e.b4w_water_fog_color.slice(0);g.fog_color_density.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(g.dynamic=!0,g.waves_height=e.b4w_waves_height,g.waves_length=e.b4w_waves_length,g.dst_noise_scale0=e.b4w_water_dst_noise_scale0,g.dst_noise_scale1=e.b4w_water_dst_noise_scale1,
g.dst_noise_freq0=e.b4w_water_dst_noise_freq0,g.dst_noise_freq1=e.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,g.dir_freq=e.b4w_water_dir_freq,g.dir_noise_scale=e.b4w_water_dir_noise_scale,g.dir_noise_freq=e.b4w_water_dir_noise_freq,g.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,g.dst_min_fac=e.b4w_water_dst_min_fac,g.waves_hor_fac=e.b4w_water_waves_hor_fac):(g.dynamic=!1,g.waves_height=0,g.waves_length=0);g.caustics=e.b4w_water_enable_caust;g.caustic_scale=e.b4w_water_caust_scale;
g.caustic_brightness=e.b4w_water_caust_brightness;g.caustic_speed=new Float32Array([.3,.7]);g.shoremap_image=null;e=e.texture_slots;for(f=0;f<e.length;f++)k=e[f].texture,!0===k.b4w_shore_dist_map&&"FILE"==k.image.source&&(g.shoremap_image=k.image,g.shoremap_tex_size=k.image.size[0],g.max_shore_dist=k.b4w_max_shore_dist,k=k.b4w_shore_boundings,g.shoremap_center=[(k[0]+k[1])/2,(k[2]+k[3])/2],g.shoremap_size=[k[0]-k[1],k[2]-k[3]]);c.push(g)}}if(0<c.length){g=c[0];if(!g.dynamic)for(d=0;d<c.length;d++)c[d].dynamic&&
(g=c[d]);return g}return null}function p(a){var b={refractions:!1};a=Aa(a);for(var c=function(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&c(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(b.refractions=!0)}}},d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(b.refractions=!0);e.node_tree&&c(e.node_tree)}return b}function B(a,b,c){if(Da.reflections)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;a=[];for(var d=
0,e=!1,g=0;g<b.length;g++){var f=b[g];f.render.reflective&&"CUBE"==f.render.reflection_type&&d++;if(f.reflective_objs.length){for(var k=null,h=0;h<a.length;h++)if(a[h]==f){k=h;break}null==k&&a.push(f)}}for(g=0;g<c.length;g++){a:if(b=c[g],b.b4w_reflexible){b=b.data.materials;for(f=0;f<b.length;f++)if(k=b[f].game_settings.alpha_blend,"OPAQUE"!=k&&"CLIP"!=k){b=!0;break a}b=!1}else b=void 0;b&&(e=!0)}return{refl_plane_objs:a,num_cube_refl:d,cube_refl_subs:[],cube_refl_subs_blend:[],plane_refl_subs:[],
plane_refl_subs_blend:[],has_blend_reflexible:e}}function c(a,b){var c=a.b4w_sky_settings,d={};d.render_sky=c.render_sky||c.procedural_skydome;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.sky_color=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=
c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.reflexible=c.reflexible;d.reflexible_only=c.reflexible_only;!b&&c.procedural_skydome&&Fa.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function k(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.hemisphere=a.hemisphere;b.blur_depth=a.blur_depth;b.blur_discard_value=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;
b.samples=a.samples;return b}function m(a){if(!(Da.bloom&&a.b4w_enable_bloom&&a._render.sun_exist))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.edge_lum=a.edge_lum;b.key=a.key;return b}function A(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function E(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}
function w(a){var b={};a=a.b4w_god_rays_settings;b.intensity=a.intensity;b.max_ray_length=a.max_ray_length;b.steps_per_pass=a.steps_per_pass;return b}function v(a){var b={};b.outline_color=a.b4w_outline_color;b.outline_factor=a.b4w_outline_factor;return b}function z(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}
function y(a,b){var c=a.light_settings,d={};d.environment_energy=c.environment_energy;d.use_environment_light=c.use_environment_light;d.environment_color=c.environment_color;d.horizon_color=a.horizon_color.slice(0);d.zenith_color=a.zenith_color.slice(0);d.use_sky_paper=a.use_sky_paper;d.use_sky_blend=a.use_sky_blend;d.use_sky_real=a.use_sky_real;d.sky_texture_slot=null;d.sky_texture_param=null;d.environment_texture_slot=null;c=!0;if(d.use_environment_light&&"SKY_TEXTURE"==d.environment_color&&(!b.procedural_skydome||
!b.use_as_environment_lighting)){for(var e=null,g=0;g<a.texture_slots.length;g++)if(a.texture_slots[g].texture.b4w_use_as_environment_lighting&&!a.texture_slots[g].texture.b4w_use_as_skydome){e=a.texture_slots[g];break}e?d.environment_texture_slot=e:c=!1}for(g=0;g<a.texture_slots.length;g++)if(a.texture_slots[g].texture.b4w_use_as_skydome){c=!0;e=a.texture_slots[g];d.sky_texture_slot=e;g=Math.min($b.max_cube_map_texture_size,Ia.calc_pot_size(e.texture.image.size[0]/3));d.sky_texture_param={tex_size:g,
blend_factor:e.blend_factor,horizon_factor:e.horizon_factor,zenith_up_factor:e.zenith_up_factor,zenith_down_factor:e.zenith_down_factor,color:e.color,default_value:e.default_value,invert:e.invert,use_rgb_to_intensity:e.use_rgb_to_intensity,blend_type:e.blend_type,use_map_blend:e.use_map_blend,use_map_horizon:e.use_map_horizon,use_map_zenith_up:e.use_map_zenith_up,use_map_zenith_down:e.use_map_zenith_down};break}d.use_environment_light=d.use_environment_light?c:!1;return d}function D(a){var b=a.fog_settings,
c={};c.use_fog=b.use_fog;c.intensity=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.falloff=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);a=c.color;c.fog_color_density=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.fog_params=new Float32Array([c.intensity,c.depth,c.start,c.height]);return c}function K(a,b){if(!Da.dynamic_grass)return!1;switch(a.b4w_render_dynamic_grass){case "OFF":return!1;case "ON":return!0}for(var c=!1,d=!1,e=0;e<b.length;e++){for(var g=
b[e],f=g.data.materials,k=0;k<f.length;k++)f[k].b4w_terrain&&(c=!0);g=g.particle_systems;for(k=0;k<g.length;k++)f=g[k].settings,"HAIR"==f.type&&f.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function d(a,b){if(nb.outlining_overview_mode)return!0;if(Da.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.selectable)return!0;return!1}else return!1}function t(a,b){if(nb.outlining_overview_mode)return!0;
if(Da.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c]._object.render.outlining)return!0;return!1}else return!1}function C(a,b){if(Da.glow_materials)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++)if(La.check_material_glow_output(d[e]))return!0;return!1}else return!1}function M(a,b){if(Da.refractions)switch(a.b4w_render_refractions){case "OFF":return!1;
case "ON":return!0;case "AUTO":return b.refractions}else return!1}function x(a){for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var e=c[d],g=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function g(a,b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++){var d=b[c]._object;if(d.anchor&&d.anchor.detect_visibility)return!0}return!1}}function H(a,b,c){var d=
Ca.node_by_attr(a,b);Ca.traverse_inputs(a,d,function(a,b,d){if(d.active){switch(d.from){case "COLOR":case "CUBEMAP":var e=b.camera.color_attachment;break;case "DEPTH":e=b.camera.depth_attachment;break;case "SCREEN":e=null;break;case O.MAIN_CUBE_REFLECT:return;default:Ja.panic("Wrong slink")}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":case "u_cube_reflection":case "u_plane_reflection":break;default:e||Ja.panic("Connection of SCREEN is forbidden"),
e.w_renderbuffer&&Ja.panic("Batch texture can't use renderbuffer"),qa.check_uniform(c.shader,d.to)&&aa.append_texture(c,e,d.to)}}});for(a=0;a<b.slinks_internal.length;a++){var d=b.slinks_internal[a],e=b.textures_internal[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "RESOLVE":case "COPY":break;default:e.w_renderbuffer&&Ja.panic("Batch texture can't use renderbuffer"),qa.check_uniform(c.shader,d.to)&&aa.append_texture(c,e,d.to)}}}function G(a){if(a&&
a._render&&a._render.graph){var b=ka.find_subs(a._render.graph,O.SKY);b&&fa(a,b)}}function ba(a,b,c,d,e,g){for(var f=b.render,k=P.get_scene_data(b,e).batches,h=0;h<k.length;h++){var l=k[h];if(!(l.shadow_cast_only||l.reflexible_only||"MAIN"!=l.type&&"NODES_GLOW"!=l.type&&"PARTICLES"!=l.type&&"LINE"!=l.type)&&("OPAQUE"==l.subtype&&"OPAQUE"==d||"BLEND"==l.subtype&&"BLEND"==d||"XRAY"==l.subtype&&"XRAY"==d||"NODES_GLOW"==l.type&&"GLOW"==d)){if(!g&&(L(l,a,b,c,d,e),!aa.update_shader(l)))if("DEBUG"===Va.type())aa.apply_shader(l,
"error.glslv","error.glslf"),aa.update_shader(l);else continue;var m=O.init_bundle(l,f);O.append_draw_data(a,m);H(c,a,l);F(l)}}}function L(a,b,c,d,e,g){var f=c.render,k=g._render,h=P.get_scene_data(c,g),l="NO_SHADOWS";c=S(g,[O.SHADOW_CAST]);if(c.length&&a.shadow_receive){switch(e){case "OPAQUE":l="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":l="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":l="NO_SHADOWS";break;case "SHADOW":l="SHADOW_MASK_GENERATION";break;default:Ja.panic("Wrong subscene type")}for(var m=
0;m<c.length;m++)aa.assign_shadow_receive_dirs(a,g._render.shadow_params,c[m])}m="NO_SOFT_SHADOWS";if(k.shadow_params&&k.shadow_params.soft_shadows)switch(Da.blur_samples){case "16x":m="POISSON_X_16";break;case "8x":m="POISSON_X_8";break;case "4x":m="POISSON_X_4"}c=a.shaders_info;qa.set_directive(c,"SHADOW_USAGE",l);qa.set_directive(c,"POISSON_DISK_NUM",m);a.dynamic_grass&&(m=ka.find_subs(d,O.GRASS_MAP))&&U(a,m,f);if("SHADOW"!=a.type&&"COLOR_ID"!=e||a.has_nodes){e=b.num_lights;qa.set_directive(c,
"NUM_LIGHTS",e);qa.set_directive(c,"NUM_LFACTORS",0==e%2?e/2:Math.floor(e/2)+1);qa.set_directive(c,"REFLECTION_PASS","REFL_PASS_NONE");qa.set_directive(c,"SSAO_ONLY",0);qa.set_directive(c,"INVERT_FRONTFACING",0);if(e=k.water_params)qa.set_directive(c,"WATER_EFFECTS",1),qa.set_directive(c,"WAVES_HEIGHT",qa.glsl_value(e.waves_height)),qa.set_directive(c,"WAVES_LENGTH",qa.glsl_value(e.waves_length)),qa.set_directive(c,"WATER_LEVEL",qa.glsl_value(e.water_level));if(b.caustics&&f.caustics){qa.set_directive(c,
"CAUSTICS",1);if(f=k.shadow_params){f=f.lamp_types;for(m=l=0;m<f.length;m++)"SUN"==f[m]&&(l=m);qa.set_directive(c,"SUN_NUM",l)}qa.set_directive(c,"CAUST_SCALE",qa.glsl_value(b.caust_scale));qa.set_directive(c,"CAUST_SPEED",qa.glsl_value(b.caust_speed,2));qa.set_directive(c,"CAUST_BRIGHT",qa.glsl_value(b.caust_brightness))}b=h.cube_refl_subs;h=h.plane_refl_subs;if(-1!==a.texture_names.indexOf("u_mirrormap"))qa.set_directive(c,"REFLECTION_TYPE","REFL_MIRRORMAP");else if(a.reflective&&b)b=b.camera.color_attachment,
aa.append_texture(a,b,"u_cube_reflection"),qa.set_directive(c,"REFLECTION_TYPE","REFL_CUBE");else if(a.reflective&&h)for(m=0;m<h.length;m++)b=h[m].camera.color_attachment,aa.append_texture(a,b,"u_plane_reflection"),qa.set_directive(c,"REFLECTION_TYPE","REFL_PLANE");else qa.set_directive(c,"REFLECTION_TYPE","REFL_NONE");(h=ka.find_subs(d,O.SKY))?a.draw_proc_sky?(b=h.camera.color_attachment,aa.append_texture(a,b,"u_sky")):h.procedural_skydome&&(a.cube_fog=h.cube_fog,qa.set_directive(c,"PROCEDURAL_FOG",
1)):qa.set_directive(c,"PROCEDURAL_FOG",0);f=k.world_light_set;f.use_environment_light&&(qa.set_directive(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==f.environment_color?(b=null,f.environment_texture_slot?b=Ia.get_batch_texture(f.environment_texture_slot,!1):h&&(b=h.camera.color_attachment),qa.set_directive(c,"SKY_TEXTURE",1),aa.append_texture(a,b,"u_sky_texture")):"SKY_COLOR"==f.environment_color&&qa.set_directive(c,"SKY_COLOR",1));b=k.world_fog_set;b.use_fog&&(qa.set_directive(c,"USE_FOG",1),qa.set_directive(c,
"FOG_TYPE",b.falloff));a.refractive&&a.blend?(Da.depth_tex_available&&qa.set_directive(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type?(qa.set_directive(c,"REFRACTIVE",1),k.refractions?qa.set_directive(c,"USE_REFRACTION",1):qa.set_directive(c,"USE_REFRACTION",0)):k.refractions?qa.set_directive(c,"REFRACTIVE",1):qa.set_directive(c,"REFRACTIVE",0),(k.materials_params.refractions||k.refractions)&&qa.set_directive(c,"HAS_REFRACT_TEXTURE",1)):(qa.set_directive(c,"REFRACTIVE",
0),qa.set_directive(c,"USE_REFRACTION",0),qa.set_directive(c,"USE_REFRACTION_CORRECTION",0));a.water&&(Da.shore_smoothing&&a.water_shore_smoothing&&ka.find_subs(d,O.DEPTH_PACK)?qa.set_directive(c,"SHORE_SMOOTHING",1):qa.set_directive(c,"SHORE_SMOOTHING",0),a.water_dynamic&&e&&e.waves_height?qa.set_directive(c,"DYNAMIC",1):qa.set_directive(c,"DYNAMIC",0));"PARTICLES"==a.type&&(qa.set_directive(c,"SIZE_RAMP_LENGTH",a.particles_data.size_ramp_length),qa.set_directive(c,"COLOR_RAMP_LENGTH",a.particles_data.color_ramp_length));
if(!a.forked_batch)for(a=a.textures,d=0;d<a.length;d++)if(b=a[d],"SCENE"==b.source)for(k=0;k<Pa.length;k++)for(c=Pa[k],h=Pa[k]._render_to_textures,e=0;e<h.length;e++)h[e]._render==b&&Ca.append_edge_attr(Wb,c,g,null)}}function F(a){8<a.textures.length&&Fa.warn(a.type,"too many textures used - "+a.textures.length+' (max 8), materials "'+a.material_names.join(", ")+'"')}function U(a,b,c){a.grass_map_dim=b.grass_map_dim;var d=b.grass_map_dim[0],e=b.grass_map_dim[1],g=b.grass_map_dim[2];c=c.bb_local;c=
Math.max(c.max_x-c.min_x,c.max_y-c.min_y);g=0==g?c:Math.max(g,c);b.grass_map_dim[2]=g;b=b.camera;ja.set_frustum(b,g/2,-e,-d,g/2);ja.set_projection(b);d=a.grass_size||0;d=0==d?c:Math.max(d,c);a.grass_size=d}function Q(a,b,c,d,e,g){for(var f=b.render,k=P.get_scene_data(b,e).batches,h=0;h<k.length;h++){var l=k[h];if(("MAIN"==l.type||"PARTICLES"==l.type||"LINE"==l.type)&&"REFLECT"==l.subtype&&l.blend==d){if(a.type==O.MAIN_PLANE_REFLECT||a.type==O.MAIN_PLANE_REFLECT_BLEND){var m;a:{var n=e._render.reflection_params.plane_refl_subs;
for(m=0;m<n.length;m++)for(var p=0;p<n[m].length;p++)if(n[m][p]==a)break a;n=e._render.reflection_params.plane_refl_subs_blend;for(m=0;m<n.length;m++)for(p=0;p<n[m].length;p++)if(n[m][p]==a)break a;m=null}if(m==f.plane_reflection_id)continue}else if(m=ea(e,a),m==f.cube_reflection_id)continue;if(!g&&(L(l,a,b,c,"REFLECT",e),m=l.shaders_info,qa.set_directive(m,"WATER_EFFECTS",0),a.type==O.MAIN_PLANE_REFLECT||a.type==O.MAIN_PLANE_REFLECT_BLEND?qa.set_directive(m,"REFLECTION_PASS","REFL_PASS_PLANE"):qa.set_directive(m,
"REFLECTION_PASS","REFL_PASS_CUBE"),qa.set_directive(m,"TEXTURE_NORM",0),a.type==O.MAIN_PLANE_REFLECT&&qa.set_directive(m,"INVERT_FRONTFACING",1),!aa.update_shader(l)))if("DEBUG"===Va.type())aa.apply_shader(l,"error.glslv","error.glslf"),aa.update_shader(l);else continue;l=O.init_bundle(l,f);O.append_draw_data(a,l)}}}function T(a){da(a);var b=R(a,O.MAIN_OPAQUE),c=!0,d=a._render.shadow_params;Ca.traverse(a._render.graph,function(e,g){g.type===O.SHADOW_CAST&&(ha(g,a,b.camera,d,c),c=!1)})}function W(a){Ca.traverse(a._render.graph,
function(a,b){b.type===O.OUTLINE&&(b.draw_outline_flag=1)})}function ha(a,b,c,d,e){if(0!=a.draw_data.length){var g=a.camera,f=Sa.get_trans(c.world_tsr,gc);Sa.set_trans(f,g.world_tsr);Sa.copy(c.view_tsr,g.shadow_cast_billboard_view_tsr);if("SUN"===d.lamp_types[a.shadow_lamp_index]||"HEMI"===d.lamp_types[a.shadow_lamp_index]){f=Ec;Ga.zero_bounding_box(f);for(var k=0;k<a.draw_data.length;k++)for(var h=a.draw_data[k].bundles,l=0;l<h.length;l++){var m=h[l].obj_render;0==k&&0==l?Ga.copy_bb(m.bb_world,f):
Ga.expand_bounding_box(f,m.bb_world)}f=Ga.extract_bb_corners(f,Jc);Ja.positions_multiply_matrix(f,g.view_matrix,f);if(d.enable_csm){b=Ta.copy(c.csm_centers[a.csm_index],gc);d=xa.invert(c.view_matrix,uc);Ja.positions_multiply_matrix(b,d,b);Ja.positions_multiply_matrix(b,g.view_matrix,b);a=c.csm_radii[a.csm_index];if(e)for(Vc=0,bc=-Infinity,e=2;e<f.length;e+=3)Vc=Math.min(Vc,f[e]),bc=Math.max(bc,f[e]);e=Ec;e.max_x=b[0]+a;e.max_y=b[1]+a;e.max_z=bc;e.min_x=b[0]-a;e.min_y=b[1]-a;e.min_z=Vc}else{c=e=Ec;
d=vc;d.set(f);f=pd/9;k=xa.identity(uc);xa.rotate(k,f,Ja.AXIS_MZ,k);l=h=-1;for(m=0;10>m;m++){var n=Ga.bb_from_coords(d,qd),P=(n.max_x-n.min_x)*(n.max_y-n.min_y);if(-1==h||P<h)h=P,l=m,Ga.copy_bb(n,c);Ja.positions_multiply_matrix(d,k,d)}c=l*f;0<c&&(f=xa.identity(uc),xa.rotate(f,c,Ja.AXIS_MZ,f),xa.multiply(f,g.view_matrix,g.view_matrix),Sa.from_mat4(g.view_matrix,g.view_tsr));c=e.max_x-e.min_x;f=e.max_y-e.min_y;c&&f&&(d=Math.abs(c-f)/2,2<c/f?(e.max_y+=d,e.min_y-=d):2<f/c&&(e.max_x+=d,e.min_x-=d));e.max_x+=
.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005;Y(a,b._render.graph)}ja.set_frustum_asymmetric(g,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);ja.set_projection(g);Ja.extract_frustum_planes(g.view_proj_matrix,g.frustum_planes)}else"SPOT"!==d.lamp_types[a.shadow_lamp_index]&&"POINT"!==d.lamp_types[a.shadow_lamp_index]||ja.set_projection(g,g.aspect)}}function Y(a,b){for(var c=a.camera,d=ka.get_outputs(b,a),e=0;e<d.length;e++){var g=d[e];if(g.type==O.MAIN_OPAQUE||g.type==
O.SHADOW_RECEIVE||g.type==O.MAIN_BLEND||g.type==O.MAIN_XRAY)if(Da.mac_os_shadow_hack)g.v_light_tsr.set(c.view_tsr,9*a.shadow_lamp_index);else{var f=Sa.get_trans_view(c.view_tsr),k=Sa.get_scale(c.view_tsr),h=Sa.get_quat_view(c.view_tsr);eb.set(f[0],f[1],f[2],k,Ab);g.v_light_ts.set(Ab,4*a.shadow_lamp_index);g.v_light_r.set(h,4*a.shadow_lamp_index)}}}function Z(a,b,c,d,e){for(var g=b.render,f=P.get_scene_data(b,d).batches,k=0;k<f.length;k++){var h=f[k];if("COLOR_ID"==h.type&&(a.type==O.COLOR_PICKING&&
"COLOR_ID"==h.subtype||a.type==O.COLOR_PICKING_XRAY&&"COLOR_ID_XRAY"==h.subtype)){if(!e&&(L(h,a,b,c,"COLOR_ID",d),aa.set_batch_directive(h,"USE_OUTLINE",0),!aa.update_shader(h)))continue;h=O.init_bundle(h,g);O.append_draw_data(a,h)}}}function N(a,b,c,d,e){if(!d&&(e.dynamic_grass&&(d=ka.find_subs(c,O.GRASS_MAP))&&U(e,d,b),!aa.update_shader(e)))if("DEBUG"===Va.type())aa.apply_shader(e,"error.glslv","error.glslf"),aa.update_shader(e);else return;b=O.init_bundle(e,b);O.append_draw_data(a,b);H(c,a,e);
F(e)}function ca(a,b){I(a,b);for(var c=0;c<a.cons_descends.length;c++)a.cons_descends[c].parent==a&&ca(a.cons_descends[c],b)}function I(a,b){a.render.hide=b;if(P.is_lamp(a))for(var c=0;c<a.scenes_data.length;c++)for(var d=a.scenes_data[c],e=S(d.scene,db),g=0;g<e.length;g++){var f=e[g],k=a.render,h=a.light,l=d.light_index,m=h.use_diffuse&&!k.hide?1:0;f.light_positions[4*l+3]=m;m=h.use_specular&&!k.hide?1:0;f.light_color_intensities[4*l+3]=m;f.need_perm_uniforms_update=!0}}function ma(a,b){for(var c=
S(b,db),d=a.light,e=a.render,g=P.get_scene_data(a,b),f=Sa.get_trans_view(e.world_tsr),e=Sa.get_quat_view(e.world_tsr),k=0;k<c.length;k++){var h=c[k],l=h,m=a.render,n=a.light,p=g.light_index,t=Sa.get_trans_view(a.render.world_tsr),q=n.color_intensity;l.light_directions.set(n.direction,3*p);Ab[0]=t[0];Ab[1]=t[1];Ab[2]=t[2];Ab[3]=n.use_diffuse&&!m.hide?1:0;l.light_positions.set(Ab,4*p);Ab[0]=q[0];Ab[1]=q[1];Ab[2]=q[2];Ab[3]=n.use_specular&&!m.hide?1:0;l.light_color_intensities.set(Ab,4*p);l.need_perm_uniforms_update=
!0;switch(d.type){case "SUN":h.sun_quaternion.set(e);h.sun_intensity=d.color_intensity;h.type===O.SKY?(h.need_fog_update=d.need_sun_fog_update,Ta.copy(d.direction,h.sun_direction),fa(b,h)):Ta.copy(d.direction,h.sun_direction);break;case "HEMI":case "POINT":case "SPOT":break;default:Fa.error("Unknown light type: "+d.type+'".')}h=h.draw_data;for(l=0;l<h.length;l++)for(m=h[l].bundles,n=0;n<m.length;n++)p=m[n].batch,p.lamp_uuid_indexes&&aa.set_lamp_data(p,a)}c=R(b,O.MAIN_OPAQUE).camera;g=g.shadow_subscenes;
d=b._render.shadow_params;for(k=0;k<g.length;k++)h=g[k],ja.set_view_trans_quat(h.camera,f,e),ha(h,b,c,d,!0),Y(h,b._render.graph)}function da(a){var b=Ha.get_scene_objs(a,"LAMP",Ha.DATA_ID_ALL),b=P.get_shadow_lamps(b,Da.ssao&&a.b4w_enable_ssao);if(b.length)for(var c=0;c<b.length;c++)for(var d=b[c],e=d.render,g=Sa.get_trans(e.world_tsr,gc),e=Sa.get_quat(e.world_tsr,Qb),f=0;f<d.scenes_data.length;f++){var k=d.scenes_data[f],h=k.shadow_subscenes;if(k.scene==a)for(k=0;k<h.length;k++)ja.set_view_trans_quat(h[k].camera,
g,e)}}function fa(a,b){Ba.prerender_subs(b);Ka.draw(b);if(b.need_fog_update)for(var c=S(a,Qa),d=0;d<c.length;d++)for(var e=c[d].draw_data,g=0;g<e.length;g++)for(var f=e[g].bundles,k=0;k<f.length;k++){var h=f[k];h.do_render&&(h=h.batch,aa.check_batch_perm_uniform(h,"u_cube_fog")&&Ka.update_batch_permanent_uniform(h,"u_cube_fog"))}}function Aa(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].data,e=0;e<d.materials.length;e++){var g=d.materials[e];-1==b.indexOf(g)&&b.push(g)}return b}function ra(a,
b,c){for(var d=a._render,e=P.get_scene_data(a._camera,a).cameras,g=0;g<e.length;g++){var f=e[g];ja.set_projection(f,b/c);d.shadow_params&&ja.update_camera_shadows(f,d.shadow_params)}d.shadow_params&&(d.need_shadow_update=!0,R(a,O.SHADOW_RECEIVE).need_perm_uniforms_update=!0,R(a,O.MAIN_BLEND).need_perm_uniforms_update=!0);var k=d.graph;ka.traverse_slinks(k,function(d,e,g,f){if(d.update_dim){f=d.size_mult_x*b;var h=d.size_mult_y*c;if(e)for(e=0;e<g.slinks_internal.length;e++)g.slinks_internal[e]==d&&
Ia.resize(d.texture,f,h);else switch(Ia.is_texture(d.texture)&&Ia.resize(d.texture,f,h),d=g.camera,d.width=f,d.height=h,g.type){case O.DOF:sa(a,{dof_power:g.camera.dof_power});break;case O.GLOW_COMBINE:ua(a,{small_glow_mask_width:g.small_glow_mask_width,large_glow_mask_width:g.large_glow_mask_width});break;case O.BLOOM:va(a,{bloom_blur:g.bloom_blur});break;case O.OUTLINE:g=ka.find_input(k,g,O.POSTPROCESSING);d=ka.find_input(k,g,O.POSTPROCESSING);f=ka.find_input(k,d,O.POSTPROCESSING);h=ka.find_input(k,
f,O.POSTPROCESSING);ka.set_texel_size(g,1/b,1/c);ka.set_texel_size(d,1/b,1/c);ka.set_texel_size(f,1/b,1/c);ka.set_texel_size(h,1/b,1/c);break;default:ka.set_texel_size(g,1/b,1/c)}}})}function S(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];Ca.traverse(a._render.graph,function(a,b){b.type==e&&c.push(b)})}return c}function R(a,b){return ka.find_subs(a._render.graph,b)}function sa(a,b){var c=R(a,O.DOF);if(!c)return Fa.error("DOF is not enabled on the scene. Check camera settings"),0;var d=c.camera.dof_bokeh,
e=d?S(a,[O.COC]):[],g=a._render.graph;if("boolean"==typeof b.dof_on&&(c.camera.dof_on=b.dof_on,d))for(var f=0;f<e.length;f++)e[f].camera.dof_on=b.dof_on;if("number"==typeof b.dof_distance&&(c.camera.dof_distance=b.dof_distance,d))for(f=0;f<e.length;f++)e[f].camera.dof_distance=b.dof_distance;if("number"==typeof b.dof_front_start&&(c.camera.dof_front_start=b.dof_front_start,d))for(f=0;f<e.length;f++)e[f].camera.dof_front_start=b.dof_front_start;if("number"==typeof b.dof_front_end&&(c.camera.dof_front_end=
b.dof_front_end,d))for(f=0;f<e.length;f++)e[f].camera.dof_front_end=b.dof_front_end;if("number"==typeof b.dof_rear_start&&(c.camera.dof_rear_start=b.dof_rear_start,d))for(f=0;f<e.length;f++)e[f].camera.dof_rear_start=b.dof_rear_start;if("number"==typeof b.dof_rear_end&&(c.camera.dof_rear_end=b.dof_rear_end,d))for(f=0;f<e.length;f++)e[f].camera.dof_rear_end=b.dof_rear_end;"number"==typeof b.dof_bokeh_intensity&&(c.camera.dof_bokeh_intensity=b.dof_bokeh_intensity,d&&(e=ka.get_inputs_by_type(g,c,O.POSTPROCESSING),
e[0].camera.dof_bokeh_intensity=b.dof_bokeh_intensity,e[1].camera.dof_bokeh_intensity=b.dof_bokeh_intensity,e[0]=ka.find_input(g,e[0],O.POSTPROCESSING),e[0].camera.dof_bokeh_intensity=b.dof_bokeh_intensity));if("number"==typeof b.dof_power)if(d){d=b.dof_power;c.camera.dof_power=d;var d=d/2,f=c.camera.width,k=c.camera.height,h=[1/f,0],l=[1/f*.5,1/k*.866],m=[-1/f*.5,1/k*.866],e=ka.get_inputs_by_type(g,c,O.POSTPROCESSING);ka.set_texel_size_mult(e[0],d);ka.set_texel_size(e[0],m[0],m[1]);ka.set_texel_size_mult(e[1],
d);ka.set_texel_size(e[1],l[0],l[1]);e[0]=ka.find_input(g,e[0],O.POSTPROCESSING);ka.set_texel_size_mult(e[0],d);ka.set_texel_size(e[0],h[0],h[1]);c.camera.dof_foreground_blur&&(e[0]=ka.find_input(g,e[0],O.COC),e[0]=ka.find_input(g,e[0],O.POSTPROCESSING),ka.set_texel_size(e[0],1/f,1/k),e[0]=ka.find_input(g,e[0],O.POSTPROCESSING),ka.set_texel_size(e[0],1/f,1/k))}else c.camera.dof_power=b.dof_power,e=ka.find_input(g,c,O.POSTPROCESSING),g=ka.find_input(g,e,O.POSTPROCESSING),ka.set_texel_size_mult(e,c.camera.dof_power),
ka.set_texel_size(e,1/c.camera.width,1/c.camera.height),ka.set_texel_size_mult(g,c.camera.dof_power),ka.set_texel_size(g,1/c.camera.width,1/c.camera.height)}function va(a,b){var c=R(a,O.LUMINANCE_TRUNCED),d=R(a,O.BLOOM);if(!c||!d)return Fa.error("Bloom is not enabled on the scene"),0;"number"==typeof b.key&&(c.bloom_key=b.key,c.need_perm_uniforms_update=!0);"number"==typeof b.edge_lum&&(c.bloom_edge_lum=b.edge_lum,c.need_perm_uniforms_update=!0);if("number"==typeof b.blur){var e=a._render.graph,c=
ka.find_input(e,d,O.BLOOM_BLUR),e=ka.find_input(e,c,O.BLOOM_BLUR);d.bloom_blur=b.blur;ka.set_texel_size_mult(c,b.blur);ka.set_texel_size(c,1/d.camera.width,1/d.camera.height);ka.set_texel_size_mult(e,b.blur);ka.set_texel_size(e,1/d.camera.width,1/d.camera.height)}}function ua(a,b){var c=R(a,O.GLOW_COMBINE);if(!c)return Fa.error("Glow is not enabled on the scene"),null;for(var d=a._render.graph,e=ka.get_inputs(d,c),g=0;g<e.length;++g){var f=e[g];if(f.type==O.POSTPROCESSING&&"GLOW_MASK_LARGE"==f.subtype)var k=
f;if(f.type==O.POSTPROCESSING&&"GLOW_MASK_SMALL"==f.subtype)var h=f}e=ka.find_input(d,k,O.POSTPROCESSING);d=ka.find_input(d,h,O.POSTPROCESSING);"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ka.set_texel_size_mult(h,
b.small_glow_mask_width),ka.set_texel_size(h,1/c.camera.width,1/c.camera.height),h.need_perm_uniforms_update=!0,ka.set_texel_size_mult(d,b.small_glow_mask_width),ka.set_texel_size(d,1/c.camera.width,1/c.camera.height),d.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ka.set_texel_size_mult(k,b.large_glow_mask_width),ka.set_texel_size(k,1/c.camera.width,1/c.camera.height),k.need_perm_uniforms_update=!0,ka.set_texel_size_mult(e,
b.large_glow_mask_width),ka.set_texel_size(e,1/c.camera.width,1/c.camera.height),e.need_perm_uniforms_update=!0)}function J(a,b,c){var d=a._render,e=d.water_params;if(!e.dynamic)return e.water_level;var g=e.waves_height,f=e.waves_length,k=e.water_level,h=Ta.length(d.wind);a=R(a,O.MAIN_OPAQUE).time;h&&(a*=h);var l=Ic;l[0]=20/f*(b-.25*a);l[1]=20/f*(c-.25*a);h=Ja.cellular2x2(l);l[0]=17/f*(c+.1*a);l[1]=17/f*(b+.1*a);var l=Ja.cellular2x2(l),h=h+l-1,m=e.dst_noise_scale0,l=e.dst_noise_scale1,n=e.dst_noise_freq0,
P=e.dst_noise_freq1,p=Ic;p[0]=m*(b+n*a);p[1]=m*(c+n*a);m=Ja.snoise(p);p[0]=l*(c-P*a);p[1]=l*(b-P*a);l=Ja.snoise(p);l*=g*m;if(e.shoremap_image)if(P=(b-e.shoremap_center[0])/e.shoremap_size[0],p=(e.shoremap_center[1]+c)/e.shoremap_size[1],P+=.5,p+=.5,1<P||0>P||1<p||0>p)g=l;else{var d=Ja.get_array_smooth_value(d.shore_distances,e.shoremap_tex_size,P,p),p=e.dir_min_shore_fac,m=e.dir_freq,t=e.dir_noise_scale,q=e.dir_noise_freq,n=e.dir_min_noise_fac,P=e.dst_min_fac,e=f/e.max_shore_dist/Math.PI;c=[t/f*(b+
q*a),t/f*(c+q*a)];b=Math.sqrt(d);g=g*Math.max(d,p)*Math.sin(b/e+m*a)*Math.max(Ja.snoise(c),n);a=Math.max(b,P);g=g*(1-a)+l*a;h*=d}else g=l;return k+(g+.05*h)}function na(a,b,c){b.is_for_outline&&b.type==O.POSTPROCESSING&&c.do_render!=b.do_render&&(b.do_render=c.do_render);c.do_render||b.type!=O.OUTLINE||(b.draw_outline_flag=0)}function za(a,b,c,d){var e=Ca.get_node_attr(a,b);ja.set_attachment(e.camera,c,d);e.assign_texture=!0;Ca.traverse_outputs(a,b,function(b,e,g){g.active&&g.from==c&&ka.check_slink_tex_conn(g)&&
V(a,b,g.to,d)});Ca.traverse_inputs(a,b,function(b,e,g){g.active&&g.from==c&&g.from==g.to&&za(a,b,c,d)})}function V(a,b,c,d){a=Ca.get_node_attr(a,b).draw_data;for(b=0;b<a.length;b++)for(var e=a[b].bundles,g=0;g<e.length;g++)aa.replace_texture(e[g].batch,d,c)}function wa(a){var b=R(a,O.GRASS_MAP);if(b){var c=b.camera,d=a._camera.render;a=Sa.get_trans(d.world_tsr,gc);var e=Gb;e[0]=0;e[1]=0;e[2]=-b.grass_map_dim[2]/2;b=Sa.get_quat(d.world_tsr,Qb);Ta.transformQuat(e,b,e);e[0]+=a[0];e[1]+=a[1];e[2]=0;ta.identity(b);
ja.set_view_trans_quat(c,e,b)}}function ga(a,b){Ca.traverse(a,function(c,d){if(d.type==O.MOTION_BLUR){d.slinks_internal[0]&&d.textures_internal[0]||Ja.panic("Wrong MOTION_BLUR subscene");var e=d.slinks_internal[0],g=d.textures_internal[0];d.textures_internal[0]=d.camera.color_attachment;Ca.traverse_outputs(a,c,function(b,c,d){d.active&&V(a,b,d.to,g)});za(a,c,e.from,g);V(a,c,e.to,d.textures_internal[0]);d.motion_blur_exp=Math.exp(-b/d.mb_factor)}})}function X(a){return a._render.wind}function ea(a,
b){if(!a._render.reflection_params)return null;for(var c=a._render.reflection_params.cube_refl_subs,d=0;d<c.length;d++)if(c[d]==b)return d;c=a._render.reflection_params.cube_refl_subs_blend;for(d=0;d<c.length;d++)if(c[d]==b)return d;return null}var aa=r("__batch"),Ga=r("__boundings"),ja=r("__camera"),pa=r("__config"),ya=r("__container"),Ea=r("__debug"),Ca=r("__graph"),ia=r("__hud"),oa=r("__input"),xa=r("__mat4"),La=r("__nodemat"),Ha=r("__objects"),P=r("__obj_util"),la=r("__physics"),Ba=r("__prerender"),
Ma=r("__primitives"),Fa=r("__print"),ta=r("__quat"),Ka=r("__renderer"),ka=r("__scenegraph"),Za=r("__sfx"),qa=r("__shaders"),O=r("__subscene"),Ia=r("__textures"),Sa=r("__tsr"),Ja=r("__util"),Ta=r("__vec3"),eb=r("__vec4"),Va=r("__version"),Da=pa.defaults,$b=pa.context_limits,nb=pa.outlining,sb=pa.scenes,Lb=[O.GRASS_MAP,O.SHADOW_CAST,O.MAIN_OPAQUE,O.MAIN_BLEND,O.MAIN_XRAY,O.MAIN_GLOW,O.MAIN_PLANE_REFLECT,O.MAIN_CUBE_REFLECT,O.MAIN_PLANE_REFLECT_BLEND,O.MAIN_CUBE_REFLECT_BLEND,O.COLOR_PICKING,O.COLOR_PICKING_XRAY,
O.SHADOW_RECEIVE,O.OUTLINE_MASK,O.DEBUG_VIEW];a.OBJECT_SUBSCENE_TYPES=Lb;var db=[O.MAIN_OPAQUE,O.MAIN_BLEND,O.MAIN_XRAY,O.MAIN_GLOW,O.MAIN_PLANE_REFLECT,O.MAIN_CUBE_REFLECT,O.GOD_RAYS,O.GOD_RAYS_COMBINE,O.SKY,O.MAIN_PLANE_REFLECT_BLEND,O.MAIN_CUBE_REFLECT_BLEND,O.LUMINANCE_TRUNCED,O.SHADOW_RECEIVE,O.SHADOW_CAST,O.COLOR_PICKING,O.COLOR_PICKING_XRAY,O.OUTLINE_MASK],Qa=[O.MAIN_OPAQUE,O.SSAO,O.MAIN_BLEND,O.MAIN_XRAY,O.MAIN_GLOW,O.MAIN_PLANE_REFLECT,O.MAIN_CUBE_REFLECT,O.MAIN_PLANE_REFLECT_BLEND,O.MAIN_CUBE_REFLECT_BLEND],
Vb=[O.SHADOW_CAST,O.MAIN_OPAQUE,O.MAIN_BLEND,O.MAIN_XRAY,O.MAIN_GLOW,O.MAIN_PLANE_REFLECT,O.MAIN_CUBE_REFLECT,O.MAIN_PLANE_REFLECT_BLEND,O.MAIN_CUBE_REFLECT_BLEND,O.COLOR_PICKING,O.COLOR_PICKING_XRAY,O.SHADOW_RECEIVE,O.GOD_RAYS,O.OUTLINE_MASK,O.DEBUG_VIEW],ac=[O.MAIN_OPAQUE,O.MAIN_BLEND,O.MAIN_XRAY,O.MAIN_GLOW,O.MAIN_PLANE_REFLECT,O.MAIN_CUBE_REFLECT,O.MAIN_PLANE_REFLECT_BLEND,O.MAIN_CUBE_REFLECT_BLEND],Dc=null,qb=null,Pa=[],Wb=null,pd=Math.PI/2,Ic=new Float32Array(2),gc=new Float32Array(3),Gb=new Float32Array(3),
Qb=new Float32Array(4),Ab=new Float32Array(4),uc=new Float32Array(16),Jc=new Float32Array(24),vc=new Float32Array(24),Ec=Ga.create_bb(),qd=Ga.create_bb(),Vc=0,bc=-Infinity;a.create_scene_render=function(){return{}};a.set_active=function(a){qb=a;Za.set_active_scene(a)};a.prepare_rendering=function(a,b){var c=a._render,d=ka.create_rendering_queue(c.graph);if(a==b){ra(a,ya.get_viewport_width(),ya.get_viewport_height());for(var e=0;e<d.length;e++)a._render.queue.push(d[e])}else for(e=a._render_to_textures[0],
ra(a,e._render.source_size,e._render.source_size),e=0;e<d.length;e++)b._render.queue.push(d[e]);d=S(a,Vb);for(e=0;e<d.length;e++)d[e].wind.set(c.wind);for(e=0;e<c.queue.length;e++)c.queue[e].type==O.SHADOW_CAST&&Ka.draw(c.queue[e])};a.get_main=function(){Dc||(Dc=u(Pa));return Dc};a.find_main_scene=u;a.get_active=h;a.check_active=function(){return qb?!0:!1};a.get_camera=function(a){return a._camera};a.get_all_scenes=function(){return Pa};a.get_rendered_scenes=function(){if(1==Pa.length)return Pa;for(var a=
0;a<Pa.length;a++){var b=Pa[a]._render.graph;Ca.traverse(b,function(b,c){for(var d=c.draw_data,e=0;e<d.length;e++)for(var g=d[e].bundles,f=0;f<g.length;f++){for(var k=g[f],h=k.batch.textures,l=null,m=0;m<h.length;m++)if("SCENE"==h[m].source&&h[m].source_id==Pa[a].name&&c.type!=O.COPY){Fa.error('Texture-scene loop detected. A scene is rendered to texture "'+h[m].name+'" yet this texture belongs to the same scene.');Ca.node_by_attr(Wb,Pa[a]);l=k.batch;break}l&&(l.textures=[],l.texture_names=[],aa.update_batch_material_error(l,
null),aa.update_shader(l),O.append_draw_data(c,k))}})}for(var c=[],a=0;a<Pa.length;a++)if(b=Pa[a],!b._render_to_textures.length){b=Ca.node_by_attr(Wb,b);Ca.enforce_acyclic(Wb,b);b=Ca.subgraph_node_conn(Wb,b,Ca.BACKWARD_DIR);b=Ca.topsort(b);Ca.traverse(b,function(a,b){c.push(b)});break}return c};a.append_scene=function(a,f,h,la,ia){a._render_to_textures=a._render_to_textures||[];a._nla=null;var r=a._render,u=P.get_scene_data(a._camera,a),xa=a._camera.render;r.video_textures=[];var Ha=a.world;r.lamps_number=
h.length;r.sun_exist=l(h);r.sky_params=c(Ha,r.sun_exist);r.world_light_set=y(Ha,r.sky_params);r.world_fog_set=D(Ha);if(Ha=!a._render_to_textures.length)a:{if("HMD"==Da.stereo){if(u.cameras[0].type!=ja.TYPE_PERSP){Fa.warn("Head-mounted display stereo is disabled for the non-perspective camera");Da.stereo="NONE";Ha=!1;break a}if(!oa.can_use_device(oa.DEVICE_HMD)){Fa.warn("Head-mounted display stereo is disabled for the non-WebVR and non-mobile devices");Da.stereo="NONE";Ha=!1;break a}}Ha="HMD"==Da.stereo}r.hmd_stereo_use=
Ha;if(Ha=!a._render_to_textures.length)u.cameras[0].type!=ja.TYPE_PERSP&&"ANAGLYPH"==Da.stereo?(Fa.warn("Anaglyph stereo is disabled for the non-perspective camera"),Da.stereo="NONE",Ha=!1):Ha="ANAGLYPH"==Da.stereo;r.anaglyph_use=Ha;r.anchor_visibility=!r.hmd_stereo_use&&!r.anaglyph_use&&g(a,ia);r.reflection_params=B(a,f,la);r.bloom_params=m(a);r.mb_params=A(a);r.cc_params=E(a);r.god_rays_params=w(a);r.outline_params=v(a);r.glow_params=z(a);r.dof=Da.dof&&(0<xa.dof_distance||xa.dof_object);r.motion_blur=
Da.motion_blur&&a.b4w_enable_motion_blur;r.compositing=Da.compositing&&a.b4w_enable_color_correction;r.antialiasing=Da.antialiasing&&1==Da.msaa_samples&&"NONE"!=a.b4w_antialiasing_quality;r.ssao=Da.ssao&&a.b4w_enable_ssao;r.god_rays=Da.god_rays&&a.b4w_enable_god_rays&&r.sun_exist;r.depth_tex=Da.depth_tex_available;r.glow_over_blend=a.b4w_glow_settings.render_glow_over_blend;r.ssao_params=k(a);ia=p(la);r.materials_params=ia;r.refractions=M(a,ia);r.shadow_params=b(a,h,la);r.water_params=n(la);r.xray=
x(la);r.soft_particles=e(la);r.shore_smoothing=q(la);r.dynamic_grass=K(a,la);r.color_picking=!r.hmd_stereo_use&&!r.anaglyph_use&&d(a,la);r.outline=t(a,la);r.glow_materials=C(a,la);switch(a.b4w_reflection_quality){case "LOW":r.cubemap_refl_size=sb.cube_reflect_low;r.plane_refl_size=sb.plane_reflect_low;break;case "MEDIUM":r.cubemap_refl_size=sb.cube_reflect_medium;r.plane_refl_size=sb.plane_reflect_medium;break;case "HIGH":r.cubemap_refl_size=sb.cube_reflect_high;r.plane_refl_size=sb.plane_reflect_high;
break;default:r.cubemap_refl_size=sb.cube_reflect_low,r.plane_refl_size=sb.plane_reflect_low}if(ya.is_hidpi())Fa.log("%cENABLE HIDPI MODE","color: #00a"),r.aa_quality="AA_QUALITY_LOW",r.resolution_factor=1,Da.msaa_samples=1;else if(1<Da.msaa_samples)Fa.log("%cENABLE MSAA RENDERING: "+Da.msaa_samples+"x","color: #00a"),r.resolution_factor=1;else{r.aa_quality="AA_QUALITY_"+a.b4w_antialiasing_quality;switch(a.b4w_antialiasing_quality){case "LOW":r.antialiasing&&(r.resolution_factor=1);break;case "MEDIUM":Da.quality==
pa.P_LOW||Da.quality==pa.P_HIGH?r.resolution_factor=1:Da.quality==pa.P_ULTRA&&(r.resolution_factor=1.33);break;case "HIGH":Da.quality==pa.P_LOW?r.resolution_factor=1:Da.quality==pa.P_HIGH?r.resolution_factor=1.33:Da.quality==pa.P_ULTRA&&(r.resolution_factor=2);break;case "NONE":Da.quality==pa.P_LOW||Da.quality==pa.P_HIGH?r.resolution_factor=1:Da.quality==pa.P_ULTRA&&(r.resolution_factor=2)}Da.quality==pa.P_CUSTOM&&(r.resolution_factor=1)}h=a._render_to_textures.sort(function(a,b){return b._render.source_size-
a._render.source_size});r.graph=ka.create_rendering_graph(r,u,xa,h);r.queue=[];r.need_shadow_update=!1;r.need_grass_map_update=!1;r.need_outline=!1;r.wind=new Float32Array(3);Pa.push(a);Wb||(Wb=Ca.create());Ca.append_node_attr(Wb,a);for(r=0;r<f.length;r++)P.scene_data_set_active(f[r],!0,a);a=ya.get_container();ya.resize(a.clientWidth,a.clientHeight,!0)};a.append_scene_vtex=function(a,b,c){for(var d=0;d<b.length;d++)b[d]._render&&b[d]._render.is_movie&&(b[d]._render.vtex_data_id=c,a._render.video_textures.push(b[d]))};
a.get_graph=function(a){return a._render.graph};a.generate_auxiliary_batches=function(a,b){Ca.traverse(b,function(c,d){var e=null;switch(d.type){case O.POSTPROCESSING:e=aa.create_postprocessing_batch(d.pp_effect);break;case O.SSAO:e=aa.create_ssao_batch(d);break;case O.SSAO_BLUR:e=aa.create_ssao_blur_batch(d);break;case O.DEPTH_PACK:e=aa.create_depth_pack_batch();break;case O.GOD_RAYS:e=ka.find_input(b,d,O.RESOLVE)||ka.find_input(b,d,O.DEBUG_VIEW)||ka.find_input(b,d,O.MAIN_BLEND)||ka.find_input(b,
d,O.GOD_RAYS);e=aa.create_god_rays_batch(e.camera.color_attachment,d.pack,d.water,d.steps_per_pass);break;case O.GOD_RAYS_COMBINE:var e=ka.find_input(b,d,O.RESOLVE)||ka.find_input(b,d,O.DEBUG_VIEW)||ka.find_input(b,d,O.MAIN_BLEND),g=ka.find_input(b,d,O.GOD_RAYS),e=aa.create_god_rays_combine_batch(e.camera.color_attachment,g.camera.color_attachment);break;case O.MOTION_BLUR:e=aa.create_motion_blur_batch(d.mb_decay_threshold);break;case O.COC:e=aa.create_coc_batch(d.coc_type);break;case O.DOF:e=aa.create_dof_batch(d);
g=d.camera.dof_power;if(d.camera.dof_bokeh){var g=g/2,f=ka.get_inputs_by_type(b,d,O.POSTPROCESSING);ka.set_texel_size_mult(f[0],g);ka.set_texel_size_mult(f[1],g);f[0]=ka.find_input(b,f[0],O.POSTPROCESSING);ka.set_texel_size_mult(f[0],g)}else{var f=ka.find_input(b,d,O.POSTPROCESSING),k=ka.find_input(b,f,O.POSTPROCESSING);ka.set_texel_size_mult(f,g);ka.set_texel_size_mult(k,g)}break;case O.OUTLINE:var e=aa.create_outline_batch(),g=ka.find_input(b,d,O.POSTPROCESSING),f=ka.find_input(b,g,O.POSTPROCESSING),
k=ka.find_input(b,f,O.POSTPROCESSING),h=ka.find_input(b,k,O.POSTPROCESSING);ka.set_texel_size_mult(f,d.blur_texel_size_mult);ka.set_texel_size_mult(g,d.blur_texel_size_mult);ka.set_texel_size_mult(h,d.ext_texel_size_mult*d.outline_factor);ka.set_texel_size_mult(k,d.ext_texel_size_mult*d.outline_factor);break;case O.GLOW_COMBINE:e=aa.create_glow_combine_batch();break;case O.COMPOSITING:e=aa.create_compositing_batch();break;case O.ANTIALIASING:e=aa.create_antialiasing_batch(d);break;case O.SMAA_RESOLVE:case O.SMAA_EDGE_DETECTION:case O.SMAA_BLENDING_WEIGHT_CALCULATION:case O.SMAA_NEIGHBORHOOD_BLENDING:e=
aa.create_smaa_batch(d.type);break;case O.STEREO:e=aa.create_stereo_batch(d.subtype);break;case O.SKY:e=aa.create_cube_sky_batch(a,d,d.procedural_skydome);break;case O.LUMINANCE:e=aa.create_luminance_batch();break;case O.AVERAGE_LUMINANCE:e=aa.create_average_luminance_batch();break;case O.LUMINANCE_TRUNCED:e=aa.create_luminance_trunced_batch();break;case O.BLOOM_BLUR:e=aa.create_bloom_blur_batch();break;case O.BLOOM:e=ka.find_input(b,d,O.BLOOM_BLUR);g=ka.find_input(b,e,O.BLOOM_BLUR);ka.set_texel_size_mult(e,
d.bloom_blur);ka.set_texel_size_mult(g,d.bloom_blur);e=aa.create_bloom_combine_batch();break;case O.VELOCITY:e=aa.create_velocity_batch();break;case O.ANCHOR_VISIBILITY:e=aa.create_anchor_visibility_batch();break;case O.PERFORMANCE:e=aa.create_performance_batch()}e&&(g=O.init_bundle(e,P.create_render("NONE")),O.append_draw_data(d,g),H(b,d,e),F(e))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":case "LINE":case "WORLD":var d=a._render.graph,e=b.render;!ka.find_subs(d,O.SHADOW_CAST)&&
e.shadow_receive&&(e.shadow_receive=!1);e=S(a,Lb);c&&b.use_obj_physics&&la.append_object(b,a);for(var g=0;g<e.length;g++){var f=e[g],k=b,h=d,l=a,m=c;switch(f.type){case O.MAIN_OPAQUE:ba(f,k,h,"OPAQUE",l,m);break;case O.MAIN_BLEND:ba(f,k,h,"BLEND",l,m);break;case O.MAIN_XRAY:ba(f,k,h,"XRAY",l,m);break;case O.MAIN_GLOW:ba(f,k,h,"GLOW",l,m);break;case O.MAIN_PLANE_REFLECT:case O.MAIN_CUBE_REFLECT:Q(f,k,h,!1,l,m);break;case O.MAIN_PLANE_REFLECT_BLEND:case O.MAIN_CUBE_REFLECT_BLEND:Q(f,k,h,!0,l,m);break;
case O.SHADOW_RECEIVE:for(var n=P.get_scene_data(k,l).batches,p=0;p<n.length;p++){var t=n[p];if("SHADOW"==t.type&&"RECEIVE"==t.subtype&&t.shadow_receive){if(!m&&(L(t,f,k,h,"SHADOW",l),!aa.update_shader(t)))continue;var q=O.init_bundle(t,k.render);O.append_draw_data(f,q);H(h,f,t);F(t)}}break;case O.SHADOW_CAST:n=!1;p=k.render;k=P.get_scene_data(k,l).batches;t=ka.find_subs(h,O.GRASS_MAP);for(q=0;q<k.length;q++){var v=k[q];if("SHADOW"==v.type&&"CAST"==v.subtype){n=!0;if(!m){var r=f.num_lights;aa.set_batch_directive(v,
"NUM_LIGHTS",r);aa.set_batch_directive(v,"NUM_LFACTORS",0==r%2?r/2:Math.floor(r/2)+1);qa.set_directive(v.shaders_info,"SHADOW_USAGE","SHADOW_CASTING");v.dynamic_grass&&t&&U(v,t,p);aa.set_batch_directive(v,"SHADOW_TEX_RES",qa.glsl_value(l._render.shadow_params.csm_resolution));if(!aa.update_shader(v))continue}v=O.init_bundle(v,p);O.append_draw_data(f,v)}}n&&(k=l._render.shadow_params,m=ka.find_subs(h,O.MAIN_OPAQUE),ha(f,l,m.camera,k,!0));break;case O.COLOR_PICKING:Z(f,k,h,l,m);break;case O.COLOR_PICKING_XRAY:Z(f,
k,h,l,m);break;case O.OUTLINE_MASK:n=k.render;p=P.get_scene_data(k,l).batches;for(t=0;t<p.length;t++)if(q=p[t],"COLOR_ID"==q.type&&"OUTLINE"==q.subtype){if(!m&&(L(q,f,k,h,"COLOR_ID",l),aa.set_batch_directive(q,"USE_OUTLINE",1),!aa.update_shader(q)))continue;q=O.init_bundle(q,n);O.append_draw_data(f,q)}break;case O.GRASS_MAP:h=k.render;k=P.get_scene_data(k,l).batches;for(l=0;l<k.length;l++)if(n=k[l],"GRASS_MAP"==n.type){if(!m&&!aa.update_shader(n))if("DEBUG"===Va.type())aa.apply_shader(n,"error.glslv",
"error.glslf"),aa.update_shader(n);else continue;n=O.init_bundle(n,h);O.append_draw_data(f,n);n=f.camera;v=h.bb_world;p=f.grass_map_dim[0];t=f.grass_map_dim[1];q=f.grass_map_dim[2];0==p&&0==t?(p=v.min_z,t=v.max_z):(p=Math.min(p,v.min_z),t=Math.max(t,v.max_z));v=1E-4*(t-p);p-=v;t+=v;f.grass_map_dim[0]=p;f.grass_map_dim[1]=t;ja.set_frustum(n,q/2,-t,-p,q/2);ja.set_projection(n)}break;case O.DEBUG_VIEW:for(n=k.render,k=P.get_scene_data(k,l).batches,l=0;l<k.length;l++)p=k[l],"DEBUG_VIEW"==p.type&&N(f,
n,h,m,p)}}break;case "LAMP":ma(b,a),Ha.sort_lamps(a)}P.scene_data_set_active(b,!0,a)};a.update_world_texture=G;a.schedule_shadow_update=function(a){a._render.need_shadow_update=!0};a.update_shadow_billboard_view=function(a,b){Ca.traverse(b,function(b,c){if(c.type===O.SHADOW_CAST){var d=Sa.get_trans(a.world_tsr,gc);Sa.set_trans(d,c.camera.world_tsr);Sa.copy(a.view_tsr,c.camera.shadow_cast_billboard_view_tsr)}})};a.update_shadow_receive_subs=Y;a.get_csm_borders=function(a,b){for(var c=a._render.shadow_params,
d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=ja.csm_far_plane(c,b,e);return d};a.append_debug_view_batch=N;a.change_visibility_rec=ca;a.change_visibility=I;a.is_hidden=function(a){return a.render.hide};a.remove_object_bundles=function(a){for(var b=0;b<a.scenes_data.length;b++)for(var c=S(a.scenes_data[b].scene,Lb),b=0;b<c.length;b++)for(var d=c[b].draw_data,e=0;e<d.length;e++)for(var g=d[e].bundles,f=g.length-1;0<=f;f--){var k=g[f];k.obj_render==a.render&&(k.batch&&aa.clear_batch(k.batch),
g.splice(f,1))}};a.update_lamp_scene_color_intensity=function(a,b){for(var c=a.light,d=P.get_scene_data(a,b).light_index,e=S(b,db),g=0;g<e.length;g++){var f=e[g];f.light_color_intensities.set(c.color_intensity,4*d);f.need_perm_uniforms_update=!0}};a.update_lamp_scene=ma;a.update_sky_texture=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)G(a[b].scene)};a.cleanup=function(){for(var a=0;a<Pa.length;a++){var b=Pa[a];Ca.traverse(b._render.graph,function(a,b){if(b.type!=O.SINK){var c=b.camera;Ka.render_target_cleanup(c.framebuffer,
c.color_attachment,c.depth_attachment,c.width,c.height);for(var c=b.draw_data,d=0;d<c.length;d++)for(var e=c[d].bundles,g=0;g<e.length;g++){var f=e[g].batch;f&&aa.clear_batch(f)}}});b._render.graph=[];b._render.queue=[]}qb=Dc=null;Pa.length=0;Wb=null};a.make_frustum_shot=function(a,b,c){a=ja.extract_frustum_corners(a,a.near,a.far,null,!0);var d=Ma.generate_frustum(a);a=P.create_render("DYNAMIC");a.bb_world=a.bb_local=Ga.big_bounding_box();a.bs_world=a.bs_local=Ga.big_bounding_sphere();var e=a.bs_world.radius;
a.be_world=a.be_local=Ga.be_from_values([e,0,0],[0,e,0],[0,0,e],a.bs_world.center);c=aa.create_shadeless_batch(d,c,.5);c=O.init_bundle(c,a);O.append_draw_data(b,c)};a.get_scene_timeline=function(a){return[a.frame_start,a.frame_end]};a.setup_dim=function(a,b,c){ya.setup_viewport_dim(a,b,c);qb&&ra(qb,a,b)};a.setup_scene_dim=ra;a.subs_array=S;a.get_subs=R;a.get_environment_colors=function(a){a=R(a,O.MAIN_OPAQUE);var b=a.horizon_color,c=a.zenith_color,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];
e[1]=c[1];e[2]=c[2];return[a.environment_energy,d,e]};a.set_environment_colors=function(a,b,c,d){a=S(a,db);for(var e=0;e<a.length;e++){var g=a[e];g.horizon_color.set(c);g.zenith_color.set(d);g.environment_energy=b;g.need_perm_uniforms_update=!0}};a.get_sky_params=function(a){if(a=R(a,O.SKY)){var b={};b.color=Array(3);Ta.copy(a.sky_color,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=
a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=R(a,O.SKY);c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&
(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.sky_color.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),
"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.need_perm_uniforms_update=!0,c.need_fog_update=!0,fa(a,c))};a.get_fog_intensity=function(a){return S(a,Qa)[0].fog_params[0]};a.get_fog_depth=function(a){return S(a,
Qa)[0].fog_params[1]};a.get_fog_start=function(a){return S(a,Qa)[0].fog_params[2]};a.get_fog_height=function(a){return S(a,Qa)[0].fog_params[3]};a.set_fog_intensity=function(a,b){for(var c=S(a,Qa),d=0;d<c.length;d++){var e=c[d];e.fog_params[0]=b;e.need_perm_uniforms_update=!0}};a.set_fog_depth=function(a,b){for(var c=S(a,Qa),d=0;d<c.length;d++){var e=c[d];e.fog_params[1]=b;e.need_perm_uniforms_update=!0}};a.set_fog_start=function(a,b){for(var c=S(a,Qa),d=0;d<c.length;d++){var e=c[d];e.fog_params[2]=
b;e.need_perm_uniforms_update=!0}};a.set_fog_height=function(a,b){for(var c=S(a,Qa),d=0;d<c.length;d++){var e=c[d];e.fog_params[3]=b;e.need_perm_uniforms_update=!0}};a.get_fog_color_density=function(a,b){var c=b||[],d=S(a,Qa)[0].fog_color_density;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=S(a,Qa),d=0;d<c.length;d++){var e=c[d];e.fog_color_density.set(b);e.need_perm_uniforms_update=!0}};a.get_ssao_params=function(a){var b=R(a,O.SSAO);a=R(a,O.SSAO_BLUR);
if(!b)return null;var c=b.draw_data[0].bundles[0].batch,d={};d.ssao_quality=aa.get_batch_directive(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.blur_discard_value=a.ssao_blur_discard_value;d.radius_increase=b.ssao_radius_increase;d.influence=b.ssao_influence;d.dist_factor=b.ssao_dist_factor;d.ssao_only=b.ssao_only;d.ssao_white=aa.get_batch_directive(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=R(a,O.SSAO),d=R(a,O.SSAO_BLUR);if(!c)return Fa.error("SSAO is not enabled on the scene"),
0;var e=c.draw_data[0].bundles[0],g=e.batch;"string"==typeof b.ssao_quality&&(aa.set_batch_directive(g,"SSAO_QUALITY",b.ssao_quality),aa.update_shader(g),O.append_draw_data(c,e));"number"==typeof b.ssao_hemisphere&&(aa.set_batch_directive(g,"SSAO_HEMISPHERE",b.ssao_hemisphere),aa.update_shader(g),O.append_draw_data(c,e));"number"==typeof b.ssao_blur_depth&&(aa.set_batch_directive(g,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),aa.update_shader(g),O.append_draw_data(c,e));"number"==typeof b.ssao_white&&(aa.set_batch_directive(g,
"SSAO_WHITE",b.ssao_white),aa.update_shader(g),O.append_draw_data(c,e));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ssao_radius_increase&&(c.ssao_radius_increase=b.ssao_radius_increase);"number"==typeof b.ssao_influence&&(c.ssao_influence=b.ssao_influence);"number"==typeof b.ssao_dist_factor&&(c.ssao_dist_factor=b.ssao_dist_factor);if("number"==typeof b.ssao_only){c=R(a,O.MAIN_OPAQUE);c.ssao_only=b.ssao_only;for(var e=c.draw_data,
f=0;f<e.length;f++)for(var k=e[f].bundles,h=0;h<k.length;h++)g=k[h].batch,aa.set_batch_directive(g,"SSAO_ONLY",b.ssao_only),aa.update_shader(g),O.append_draw_data(c,k[h])}c.need_perm_uniforms_update=!0;d.need_perm_uniforms_update=!0};a.get_dof_params=function(a){a=R(a,O.DOF);if(!a)return null;var b={};b.dof_distance=a.camera.dof_distance;b.dof_front_start=a.camera.dof_front_start;b.dof_front_end=a.camera.dof_front_end;b.dof_rear_start=a.camera.dof_rear_start;b.dof_rear_end=a.camera.dof_rear_end;b.dof_power=
a.camera.dof_power;b.dof_bokeh=a.camera.dof_bokeh;b.dof_bokeh_intensity=a.camera.dof_bokeh_intensity;b.dof_object=a.camera.dof_object;return b};a.set_dof_params=sa;a.get_god_rays_params=function(a){var b=S(a,[O.GOD_RAYS]);a=R(a,O.GOD_RAYS_COMBINE);if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].max_ray_length;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=aa.get_batch_directive(b[0].draw_data[0].bundles[0].batch,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,
b){var c=S(a,[O.GOD_RAYS]),d=R(a,O.GOD_RAYS_COMBINE);if(!c||!d)return Fa.error("God Rays are not enabled on the scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,g=0;g<c.length;g++)c[g].max_ray_length=e,c[g].radial_blur_step=e/c[g].steps_per_pass/(g+1),c[g].need_perm_uniforms_update=!0;if("number"==typeof b.god_rays_steps)for(var f=qa.glsl_value(b.god_rays_steps,1),e=c[0].max_ray_length,
g=0;g<c.length;g++){c[g].steps_per_pass=f;c[g].radial_blur_step=e/f/(g+1);c[g].need_perm_uniforms_update=!0;var k=c[g].draw_data[0].bundles[0],h=k.batch;aa.set_batch_directive(h,"STEPS_PER_PASS",f);aa.update_shader(h);O.append_draw_data(c[g],k)}d.need_perm_uniforms_update=!0};a.get_bloom_params=function(a){var b=R(a,O.LUMINANCE_TRUNCED);a=R(a,O.BLOOM);if(!b||!a)return null;var c={};c.key=b.bloom_key;c.edge_lum=b.bloom_edge_lum;c.blur=a.bloom_blur;return c};a.set_bloom_params=va;a.get_glow_material_params=
function(a){a=R(a,O.GLOW_COMBINE);if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=ua;a.get_wind_params=function(a){var b=X(a);a=Ta.length(b);if(0==a)return null;var b=Ja.rad_to_deg(Math.atan2(b[0],-b[1])),c={};c.wind_dir=b;c.wind_strength=a;return c};a.schedule_grass_map_update=function(a){a._render.need_grass_map_update=
!0};a.get_water_surface_level=J;a.get_water_mat_params=function(a,b){var c=a._render.water_params,d=R(a,O.MAIN_OPAQUE);d&&c&&(b.waves_height=c.waves_height,b.waves_length=c.waves_length,d.water_fog_color_density&&(b.water_fog_density=d.water_fog_color_density[3],c=b.water_fog_color=[],c[0]=d.water_fog_color_density[0],c[1]=d.water_fog_color_density[1],c[2]=d.water_fog_color_density[2]))};a.set_water_params=function(a,b){var c=a._render.water_params;if(!c)return Fa.error("set_water_params() - no water parameters on the scene"),
null;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);
"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.dynamic=b.water_dynamic);for(var d=S(a,ac),e=0;e<d.length;e++){var g=d[e];"number"==typeof b.water_fog_density&&c.fog_color_density&&(g.water_fog_color_density[3]=b.water_fog_density);
"object"==typeof b.water_fog_color&&c.fog_color_density&&g.water_fog_color_density.set(b.water_fog_color);"number"==typeof b.waves_height&&(g.water_waves_height=b.waves_height);"number"==typeof b.waves_length&&(g.water_waves_length=b.waves_length);g.need_perm_uniforms_update=!0}};a.get_shore_dist=function(a,b,c){var d=a._render.water_params;if(!d.shoremap_image)return 100;var e=d.max_shore_dist;a=d.water_level;var g=(b[0]-d.shoremap_center[0])/d.shoremap_size[0],f=(d.shoremap_center[1]+b[1])/d.shoremap_size[1],
g=g+.5,f=f+.5;if(1<g||0>g||1<f||0>f)b=1;else return d=e*Ja.get_array_smooth_value(qb._render.shore_distances,d.shoremap_tex_size,g,f),b=(a-b[2])*c,b=Math.sqrt(d*d+b*b)};a.update=function(a,b){for(var c=h()._camera.render,d=0;d<Pa.length;d++){var e=Pa[d],g=e._render.graph,f=e._render;if(f.water_params)var k=Sa.get_trans_view(c.world_tsr),l=k[2]-J(e,k[0],k[1]);for(k=0;k<f.video_textures.length;k++){var m=f.video_textures[k]._render,n=m.video_file,P=m.seq_video;if(!(e.b4w_use_nla&&m.use_nla||!n&&!P)&&
Ia.video_is_played(m)){var p=Ia.video_get_current_frame(m),t=Ia.video_get_start_frame(m);n&&Da.is_mobile_device&&(t-=5);var q=Ia.video_get_end_frame(m);p>=q&&m.use_cyclic||p<t?(Ia.reset_video(m.name,m.vtex_data_id),P&&(m.seq_last_discrete_mark=Ia.seq_video_get_discrete_timemark(m,a))):p>=q&&!m.use_cyclic?Ia.pause_video(m.name,m.vtex_data_id):Ia.video_update_is_available(m)&&(n?Ia.update_video_texture(m):(n=Ia.seq_video_get_discrete_timemark(m,a),n!=m.seq_last_discrete_mark&&(Ia.update_seq_video_texture(m),
m.seq_cur_frame++),m.seq_last_discrete_mark=n))}}Ca.traverse(g,function(b,c){-1<Vb.indexOf(c.type)&&(c.time=a);f.water_params&&(c.cam_water_depth=l)})}for(d=0;d<Pa.length;d++)if(e=Pa[d],f=e._render,g=f.graph,c=f.queue,c.length)for(f.need_shadow_update&&(T(e),f.need_shadow_update=!1),f.need_grass_map_update&&(wa(e),f.need_grass_map_update=!1),f.need_outline&&(W(e),f.need_outline=!1),f.motion_blur&&ga(g,b),e=ka.find_subs(g,O.OUTLINE_MASK),k=0;k<c.length;k++)m=c[k],Ba.prerender_subs(m),e&&na(g,m,e),
Ka.draw(m);Da.show_hud_debug_info&&ia.show_debug_info(Pa,b)};a.request_outline=function(a){a._render.need_outline=!0};a.get_all_subscenes=function(a){var b=[];Ca.traverse(a._render.graph,function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=R(qb,O.MAIN_BLEND),b=qb;return a||b._render.water_params?a.cam_water_depth:null};a.update_scene_permanent_uniforms=function(a){Ca.traverse(a._render.graph,function(a,b){b.need_perm_uniforms_update=!0})};a.set_debug_view_mode=function(a,b){a.debug_view_mode=
b;a.do_render=b!=Ea.DV_NONE;a.blend=b==Ea.DV_TRANSPARENT_WIREFRAME;a.need_perm_uniforms_update=!0;for(var c=h(),d=0;d<ac.length;d++){var e=R(c,ac[d]);e&&(e.do_not_debug=b==Ea.DV_RENDER_TIME)}};a.set_debug_colors_seed=function(a,b){a.debug_colors_seed=b;a.need_perm_uniforms_update=!0};a.set_render_time_threshold=function(a,b){a.debug_render_time_threshold=b;a.need_perm_uniforms_update=!0};a.set_wireframe_edge_color=function(a,b){for(var c=a.draw_data,d=0;d<c.length;d++)for(var e=c[d].bundles,g=0;g<
e.length;g++){var f=e[g].batch;Ta.copy(b,f.wireframe_edge_color);f.need_perm_uniforms_update=!0}};a.update_force_scene=function(a,b){var c=b.field,d=a._render.wind;if(c&&"WIND"==c.type&&d){var e=Sa.get_quat_view(b.render.world_tsr);Ta.transformQuat(Ja.AXIS_Z,e,d);Ta.normalize(d,d);Ta.scale(d,c.strength,d);c=S(a,Vb);for(e=0;e<c.length;e++)c[e].wind.set(d);return!0}return!1};a.pick_color=function(a,b,c){var d=R(a,O.COLOR_PICKING);if(d){var e=ya.get_canvas();ja.set_color_pick_proj(d.camera,b,c,e.clientWidth,
e.clientHeight);Ba.prerender_subs(d,d.camera);d.do_render&&Ka.draw(d);if(a=R(a,O.COLOR_PICKING_XRAY))xa.copy(d.camera.proj_matrix,a.camera.proj_matrix),xa.copy(d.camera.view_proj_matrix,a.camera.view_proj_matrix),Ja.extract_frustum_planes(a.camera.view_proj_matrix,a.camera.frustum_planes),Ba.prerender_subs(a,a.camera),a.do_render&&Ka.draw(a);if(d.do_render||a&&a.do_render)return Ka.read_pixels(a?a.camera.framebuffer:d.camera.framebuffer,0,0)}else Fa.error("Object Selection is not available on the scene");
return null};a.set_outline_color=function(a){var b=h();if(b=R(b,O.OUTLINE))b.outline_color.set(a),b.need_perm_uniforms_update=!0};a.get_wind=X;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.update_cube_reflect_subs=function(a,b){var c=gc;Ta.negate(b,c);for(var d=0;6>d;d++){var e=a.cube_view_matrices[d],g=a.cube_cam_frustums[d],f=a.camera;xa.translate(Ja.INV_CUBE_VIEW_MATRS[d],c,e);xa.multiply(f.proj_matrix,
e,f.view_proj_matrix);Ja.extract_frustum_planes(f.view_proj_matrix,g)}};a.update_plane_reflect_subs=function(a,b,c){Ja.trans_quat_to_plane(b,c,Ja.AXIS_Z,a.camera.reflection_plane)};a.assign_scene_data_subs=function(a,b,c){var d=a._render.shadow_params,e=a._render.reflection_params;c=P.get_shadow_lamps(c,Da.ssao&&a.b4w_enable_ssao);if(e)for(var g=0;g<b.length;g++){var f=b[g],k=P.get_scene_data(f,a);if(-1!=f.render.plane_reflection_id){var h=e.plane_refl_subs,l=e.plane_refl_subs_blend,f=f.render.plane_reflection_id;
l.length?k.plane_refl_subs=l[f]:h.length&&(k.plane_refl_subs=h[f])}else-1!=f.render.cube_reflection_id&&(h=e.cube_refl_subs,l=e.cube_refl_subs_blend,f=f.render.cube_reflection_id,l.length?k.cube_refl_subs=l[f]:h.length&&(k.cube_refl_subs=h[f]))}for(g=0;g<c.length;g++)if(k=P.get_scene_data(c[g],a),d)for(b=S(a,[O.SHADOW_CAST]),e=0;e<b.length;e++)g==b[e].shadow_lamp_index&&k.shadow_subscenes.push(b[e])};a.marker_frame=function(a,b){return a.timeline_markers[b]};a.set_hmd_params=function(a){var b=h();
if(b=R(b,O.STEREO))a.distortion_coefs&&(b.distortion_params[0]=a.distortion_coefs[0],b.distortion_params[1]=a.distortion_coefs[1],b.need_perm_uniforms_update=!0),a.chromatic_aberration_coefs&&(b.chromatic_aberration_coefs[0]=a.chromatic_aberration_coefs[0],b.chromatic_aberration_coefs[1]=a.chromatic_aberration_coefs[1],b.chromatic_aberration_coefs[2]=a.chromatic_aberration_coefs[2],b.chromatic_aberration_coefs[3]=a.chromatic_aberration_coefs[3],b.need_perm_uniforms_update=!0),a.base_line_factor&&
(b.distortion_params[2]=a.base_line_factor,b.need_perm_uniforms_update=!0),a.inter_lens_factor&&(b.distortion_params[3]=a.inter_lens_factor,b.need_perm_uniforms_update=!0),a.enable_hmd_stereo&&(b.enable_hmd_stereo=a.enable_hmd_stereo,b.need_perm_uniforms_update=!0)};a.multiply_size_mult=function(b,c){for(var d=Pa,e=0;e<d.length;e++){var g=a.get_graph(d[e]);ka.multiply_size_mult_by_graph(g,b,c)}};a.update_all_mesh_shaders=function(a){for(var b=Ha.get_scene_objs(a,"LAMP",Ha.DATA_ID_ALL),c=S(a,Lb),d=
0;d<c.length;d++)for(var e=c[d],g=e.draw_data,f=0;f<g.length;f++)for(var k=g[f].bundles,h=0;h<k.length;h++){var l=k[h],m=l.batch;"MAIN"==m.type&&(aa.update_batch_lights(m,b,a),aa.update_shader(m),O.append_draw_data(e,l))}};a.recalculate_draw_data=function(a){for(var b=0;b<Pa.length;b++)Ca.traverse(Pa[b]._render.graph,function(b,c){for(var d=c.draw_data,e=0;e<d.length;e++)for(var g=d[e].bundles,f=0;f<g.length;f++){var k=g[f];k.batch==a&&O.append_draw_data(c,k)}})}};b4w.module.__physics=function(a,r){function u(a,b){for(var c=a.cons_descends,d=0;d<c.length;d++)c[d].physics_settings.use_collision_compound&&b.push(c[d]),u(c[d],b);return null}function h(a,b,c){for(var d=a._physics.bundles,e=0;e<d.length;e++)for(var g=d[e].physics,f=0;f<g.collision_tests.length;f++){var k=g.collision_tests[f];"ANY"!=k.collision_id&&c!=k.collision_id||y(k,a,b)}}function b(a,b,c){if(F.is_active(a))switch(b){case F.IN_LOADED:var e=f(a);e._physics.worker_loaded=!0;c=Date.now()-performance.now();
F.post_msg(a,F.OUT_INIT,c,da.max_fps,da.calc_fps?fa.fps_measurement_interval:0);break;case F.IN_LOG:Q.log_raw("URANIUM:",c.slice(1));break;case F.IN_ERROR:Q.error(c);break;case F.IN_FBMSG:L.fbmsg.apply(this,c.slice(1));break;case F.IN_TRANSFORM:var g=l(c.body_id);if(g){a=c.trans;e=c.quat;b=c.linvel;var k=c.angvel,g=g.physics;g.curr_time=c.time;Z.set_sep(a,1,e,g.curr_tsr);ca.copy(b,g.linvel);ca.copy(k,g.angvel)}break;case F.IN_PROP_OFFSET:(a=l(c.chassis_hull_body_id))&&Z.set_sep(c.trans,1,c.quat,a.vehicle.prop_offsets[c.prop_ind]);
break;case F.IN_FLOATER_BOB_TRANSFORM:if(e=l(c[1]))a=c[4],e=e.floater.bobs[c[2]],Y.set_translation(e,c[3]),Y.set_rotation(e,a),Y.update_transform(e);break;case F.IN_VEHICLE_SPEED:if(g=l(c[1]))g.vehicle.speed=c[2];break;case F.IN_COLLISION:e=f(a);q(e,c.body_id_a,c.body_id_b,c.result,null,null,0);break;case F.IN_COLLISION_POS_NORM:e=f(a);q(e,c.body_id_a,c.body_id_b,c.result,c.coll_point,c.coll_norm,c.coll_dist);break;case F.IN_COLLISION_IMPULSE:if(g=l(c[1]))a=g.physics,a.col_imp_test_cb&&a.col_imp_test_cb(c[2]);
break;case F.IN_RAY_HIT:case F.IN_RAY_HIT_POS_NORM:e=f(a);if(a=e._physics.ray_tests[c.id])if(e=l(c.body_id_hit),b==F.IN_RAY_HIT)b=a.callback,b(a.id,c.hit_fract,e,c.hit_time);else{b=c.hit_fract;var k=c.hit_time,g=c.hit_pos,h=a.callback;g?h(a.id,b,e,k,g,c.hit_norm):h(a.id,b,e,k)}break;case F.IN_REMOVE_RAY_TEST:d(id);break;case F.IN_PING:a=S.indexOf(a);e=(c[2]-c[1]).toFixed(3);b=(performance.now()-c[2]).toFixed(3);c=(performance.now()-c[1]).toFixed(3);console.log("Physics #"+a+" Ping: OUT "+e+" ms, IN "+
b+" ms, ALL "+c+" ms");break;case F.IN_FPS:ra=c[1];break;case F.IN_DEBUG_STATS:a=S.indexOf(a);console.log("Worker: #"+String(a));console.log(c[1]);break;default:Q.error("Wrong message: "+b)}}function f(a){for(var b=0;b<S.length;b++)if(S[b]==a)return R[b]}function l(a){return sa[a]||null}function q(a,b,c,d,g,f,k){a=a._physics.bundles;for(var h=0;h<a.length;h++)for(var m=a[h].physics,n=0;n<m.collision_tests.length;n++){for(var p=m.collision_tests[n],t=p.pairs,q=!1,v=0;v<t.length;v++){var r=t[v];if(r[0]===
b&&r[1]===c){p.pair_results[v]=d;q=!0;break}}q&&(t=e(p),g&&p.body_id_src!=b&&(q=g,v=f,r=k,q[0]+=v[0]*r,q[1]+=v[1]*r,q[2]+=v[2]*r,v[0]*=-1,v[1]*=-1,v[2]*=-1),q=t?p.body_id_src==b?l(c):l(b):null,p.callback(t,q,g,f,k))}}function e(a){a=a.pair_results;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function n(){J.body++;return J.body}function p(a){var b=ua.indexOf(a);return-1==b?(ua.push(a),ua.length-1):b}function B(a,b){return{body_id:a,type:b,mass:0,is_ghost:!1,simulated:!0,is_vehicle:!1,is_character:!1,
is_floater:!1,cons_id:null,collision_id:"",collision_id_num:0,collision_callbacks:{},collision_tests:[],col_imp_test_cb:null,curr_time:0,curr_tsr:new Float32Array([0,0,0,1,0,0,0,1]),linvel:new Float32Array(3),angvel:new Float32Array(3),cached_trans:new Float32Array(3),cached_quat:new Float32Array(4),navmesh:null}}function c(a,b){switch(a){case "BOX":var c=b.bb_local;break;case "CYLINDER":c=b.bcyl_local;break;case "CONE":c=b.bcon_local;break;case "SPHERE":c=b.bs_local;break;case "CAPSULE":c=b.bcap_local}return c}
function k(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.center&&(b.center=a.center);"number"===typeof a.radius&&(b.radius=a.radius);"number"===typeof a.height&&(b.height=a.height);return b}function m(a,b,c,d,e){var g=Z.get_trans_view(a.render.world_tsr),
f=Z.invert(b.render.world_tsr,V),k=new Float32Array(3);Z.transform_vec3(g,f,k);switch(b.vehicle.type){case 10:b=b.vehicle_settings;a=a.render.bb_local;F.post_msg(e,F.OUT_ADD_CAR_WHEEL,c,k,b.suspension_rest_length,b.roll_influence,(a.max_z-a.min_z)/2,d);break;case 20:F.post_msg(e,F.OUT_ADD_BOAT_BOB,c,k,a.synchronize_pos)}}function A(a){return a.physics&&a.physics.cons_id}function E(a,b,c,d,e,g,f,k,h,l){var m;J.constraint++;m=J.constraint.toString(16);var n=b.physics.body_id;e=e.physics.body_id;var p=
w(n);F.post_msg(p,F.OUT_APPEND_CONSTRAINT,m,a,k,n,c,d,e,g,f,h,l);b.physics.cons_id=m}function w(a){for(var b=0;b<R.length;b++)for(var c=R[b]._physics.bundles,d=0;d<c.length;d++)if(c[d].physics.body_id==a)return S[b];return null}function v(a){var b;if(b=(b=a.physics)?0===b.mass?!0:!0===b.is_ghost?!0:!1===b.simulated?!0:"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type?!0:!1:!1){b=Z.get_trans(a.render.world_tsr,na);var c=Z.get_quat(a.render.world_tsr,za);b=b[0]!=a.physics.cached_trans[0]||b[1]!=a.physics.cached_trans[1]||
b[2]!=a.physics.cached_trans[2]||c[0]!=a.physics.cached_quat[0]||c[1]!=a.physics.cached_quat[1]||c[2]!=a.physics.cached_quat[2]||c[3]!=a.physics.cached_quat[3]}if(b){b=a.physics;var d=a.render,c=F.get_msg_cache(F.OUT_SET_TRANSFORM);c.body_id=b.body_id;var e=Z.get_trans(d.world_tsr,c.trans),d=Z.get_quat(d.world_tsr,c.quat);ca.copy(e,b.cached_trans);T.copy(d,b.cached_quat);"DYNAMIC"==b.type&&T.identity(c.quat);b=w(b.body_id);F.post_msg(b,F.OUT_SET_TRANSFORM)}a=a.cons_descends;for(b=0;b<a.length;b++)v(a[b])}
function z(a,b,c,d,e){e=e||new Float32Array(3);a=Z.get_quat_view(a.render.world_tsr);e[0]=b;e[1]=c;e[2]=d;return ca.transformQuat(e,a,e)}function y(a,b,c){var d=a.pairs,e=a.pair_results,g=a.body_id_src,f=[],k=a.collision_id;f||N.panic("At least one destination required");for(var h=0;h<b._physics.bundles.length;h++){var l=b._physics.bundles[h];if("ANY"==k||l.physics.collision_id==k&&"NAVMESH"!=l.physics.type)l=l.physics.body_id,f&&-1==f.indexOf(l)&&f.push(l)}for(b=0;b<f.length;b++)k=f[b],g<k&&!D(d,
g,k)?(d.push([g,k]),e.push(!1)):g>k&&!D(d,k,g)&&(d.push([k,g]),e.push(!1));F.post_msg(c,F.OUT_ACTIVATE,g);F.post_msg(c,F.OUT_APPEND_COLLISION_TEST,d,a.calc_pos_norm)}function D(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function K(a){if(a.physics&&a.physics.col_imp_test_cb){a=a.physics;var b=w(a.body_id);F.post_msg(b,F.OUT_CLEAR_COLLISION_IMPULSE_TEST,a.body_id);a.col_imp_test_cb=null}}function d(a){var b=t(a),c=C(a),b=b._physics;b.ray_tests[a]&&(delete b.ray_tests[a],
b.ray_tests_arr.splice(b.ray_tests_arr.indexOf,1),F.post_msg(c,F.OUT_REMOVE_RAY_TEST,a))}function t(a){for(var b=0;b<R.length;b++){var c=R[b];if(c._physics.ray_tests[a])return c}return null}function C(a){for(var b=0;b<R.length;b++)if(R[b]._physics.ray_tests[a])return S[b];return null}function M(a,b,c){if(b.steering_wheel){a=a.physics.body_id;var d=b.engine_force*b.force_max,e=b.brake_force*b.brake_max,g=-b.steering*b.steering_max*2*Math.PI/b.steering_ratio;b.inverse_control&&(g*=-1);switch(b.type){case 10:F.post_msg(c,
F.OUT_UPDATE_CAR_CONTROLS,a,d,e,g);break;case 20:F.post_msg(c,F.OUT_UPDATE_BOAT_CONTROLS,a,d,e,g)}}}function x(a){return a.is_vehicle&&"CHASSIS"==a.vehicle_settings.part}function g(a){return a.is_vehicle&&"HULL"==a.vehicle_settings.part}function H(a){return"NAVMESH"==a.physics_settings.physics_type}function G(a){return a.is_floating&&"MAIN_BODY"==a.floating_settings.part}var ba=r("__config"),L=r("__debug"),F=r("__ipc"),U=r("__obj_util"),Q=r("__print"),T=r("__quat"),W=r("__scenes"),ha=r("__subscene"),
Y=r("__transform"),Z=r("__tsr"),N=r("__util"),ca=r("__vec3"),I=r("__version"),ma=r("__navmesh"),da=ba.physics,fa=ba.defaults,Aa=ba.assets,ra=0,S=[],R=[],sa={},va=[],ua=["ANY"],J={body:0,constraint:0,ray_test:0},na=new Float32Array(3);new Float32Array(4);var za=new Float32Array(4);new Float32Array(16);var V=Z.create(),wa=Z.create();a.init_scene_physics=function(a){a._physics={worker_loaded:!1,bundles:[],ray_tests:{},ray_tests_arr:[]};var c=da.uranium_path;Aa.prevent_caching&&(c+=I.timestamp());Q.log("%cLOAD PHYSICS",
"color: #0a0",da.use_workers?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+da.max_fps);Q.log("%cPHYSICS PATH","color: #0a0",c);var d=F.create_worker(c,!da.use_workers);F.attach_handler(d,b);S.push(d);R.push(a);da.ping&&setInterval(function(){F.post_msg(d,F.OUT_PING,performance.now())},1E3)};a.check_worker_loaded=function(a){return a._physics?a._physics.worker_loaded:!0};a.cleanup=function(){for(var a=0;a<S.length;a++)F.terminate(S[a]);S.length=0;R.length=0;sa={};va.length=0;ua.length=
0;for(var b in J)J[b]=0};a.append_object=function(a,b){a.render||N.panic("No object render: "+a.name);var d=a.physics_settings,e;a:{for(var f=0;f<R.length;f++)if(R[f]==b){e=S[f];break a}e=void 0}var l=[];d.use_collision_compound&&u(a,l);var t=b._physics.bundles;if(x(a)||g(a)||a.is_character||G(a)||a.use_obj_physics){var q=H(a);if(q){var v,r=a,ia=n(),w=B(ia,"NAVMESH"),z=U.get_scene_data(r,b).batches;w.navmesh=null;for(var C=0;C<z.length;C++){var y=z[C];if("PHYSICS"==y.type){w.navmesh=ma.navmesh_build_from_bufs_data(y.bufs_data);
break}}v=w}else{var P=a,la=e,Ba=P.render,J=P.physics_settings,D=J.physics_type,ta=n();if("CAMERA"==P.type)var W=J.use_collision_bounds?J.collision_bounds_type:"BOX",ka=c(W,Ba),I=Ba.friction,L=Ba.elasticity,I=.5,L=0;else if("EMPTY"==P.type)W="EMPTY",ka=null,L=I=0;else{var W=J.use_collision_bounds?J.collision_bounds_type:"BOX",ka=c(W,Ba),O=Z.get_scale(Ba.world_tsr);if(1!=O){var K=ka;switch(W){case "BOX":K.min_x*=O;K.max_x*=O;K.min_y*=O;K.max_y*=O;K.min_z*=O;K.max_z*=O;break;case "CYLINDER":case "CONE":case "CAPSULE":K.height*=
O;K.radius*=O;break;case "SPHERE":K.radius*=O}}I=Ba.friction;L=Ba.elasticity}var Y=Z.get_trans_view(Ba.world_tsr),ha=Z.get_quat_view(Ba.world_tsr),ua=J.use_ghost,ba=J.use_sleep,fa=J.mass,na=J.velocity_min,ca=J.velocity_max,ra=J.damping,Aa=J.rotation_damping,da=P.collision_id,db=p(da),Qa=J.collision_margin,Vb=J.collision_group,ac=J.collision_mask,Dc=Ba.bs_local.radius,qb=k(ka),Pa=P.correct_bounding_offset,Wb;var pd=W;if(l.length){var Ic=[],gc={};gc.quat=new Float32Array([0,0,0,1]);gc.trans=new Float32Array(3);
gc.worker_bounding=qb;gc.bounding_type=pd;Ic.push(gc);var Gb=Z.invert(Ba.world_tsr,V),Qb=za,Ab=Z.get_quat_view(Ba.world_tsr);T.invert(Ab,Qb);for(var uc=0;uc<l.length;uc++){var Jc={},vc=l[uc],Ec=vc.physics_settings.collision_bounds_type,qd=new Float32Array(4),Vc=new Float32Array(3),bc=Z.get_trans_view(vc.render.world_tsr),Ed=Z.get_quat_view(vc.render.world_tsr);Z.transform_vec3(bc,Gb,Vc);T.multiply(Qb,Ed,qd);Jc.trans=Vc;Jc.quat=qd;Jc.bounding_type=Ec;Jc.worker_bounding=k(c(Ec,vc.render));Ic.push(Jc)}Wb=
Ic}else Wb=[];F.post_msg(la,F.OUT_APPEND_BOUNDING_BODY,ta,Y,ha,D,ua,ba,fa,na,ca,ra,Aa,db,Qa,Vb,ac,W,qb,Dc,I,L,Wb,Pa);sa[ta]=P;va.push(P);var Wc=B(ta,"BOUNDING");Wc.type=D;Wc.mass=fa;Wc.is_ghost=ua;Wc.collision_id=da;Wc.collision_id_num=db;v=Wc}a.physics=v;var rd={batch:null,physics:v};q||(t.push(rd),h(b,e,v.collision_id))}else for(var Rc=U.get_scene_data(a,b).batches,Xc=0;Xc<Rc.length;Xc++){var hc=Rc[Xc],dd;if(!(dd="PHYSICS"!=hc.type))a:{for(var Sc=b._physics.bundles,sd=0;sd<Sc.length;sd++){var ic=
Sc[sd].batch;if(ic&&ic.id==hc.id){dd=!0;break a}}dd=!1}if(!dd)if(hc.submesh.base_length)if(hc.water&&b._render.water_params){var ob=hc,wc=b,Bb=e,ib=wc._render.water_params;F.post_msg(Bb,F.OUT_APPEND_WATER,ib.water_level);if(ob.water_dynamics){var ab={};ab.dst_noise_scale0=ob.dst_noise_scale0;ab.dst_noise_scale1=ob.dst_noise_scale1;ab.dst_noise_freq0=ob.dst_noise_freq0;ab.dst_noise_freq1=ob.dst_noise_freq1;ab.dir_min_shore_fac=ob.dir_min_shore_fac;ab.dir_freq=ob.dir_freq;ab.dir_noise_scale=ob.dir_noise_scale;
ab.dir_noise_freq=ob.dir_noise_freq;ab.dir_min_noise_fac=ob.dir_min_noise_fac;ab.dst_min_fac=ob.dst_min_fac;ab.waves_hor_fac=ob.waves_hor_fac;var cc=ib.waves_height,Wa=ib.waves_length;ib.shoremap_image?F.post_msg(Bb,F.OUT_ADD_WATER_WRAPPER,ab,ib.shoremap_size[0],ib.shoremap_size[1],ib.shoremap_center[0],ib.shoremap_center[1],ib.max_shore_dist,cc,Wa,ib.shoremap_tex_size,wc._render.shore_distances):F.post_msg(Bb,F.OUT_ADD_WATER_WRAPPER,ab,0,0,0,0,0,cc,Wa,0,null)}}else{if(hc.use_ghost){var Tc=a,jc=hc,
Mb=e,dc=n(),Rb=jc.submesh,Kc=Rb.va_frames[0].a_position,kc=Rb.indices||null,rb=jc.collision_id,xc=p(rb),xb=jc.collision_margin,Xb=jc.collision_group,lc=jc.collision_mask,Yc=Z.get_trans_view(Tc.render.world_tsr);F.post_msg(Mb,F.OUT_APPEND_GHOST_MESH_BODY,dc,Kc,kc,Yc,xc,xb,Xb,lc);var pb=B(dc,"STATIC_MESH");pb.is_ghost=!0;pb.collision_id=rb;pb.collision_id_num=xc;v=pb}else{var $a=a,bb=hc,Cb=e,Nb=n(),Sb=bb.submesh,ed=Sb.va_frames[0].a_position,mc=Sb.indices||null,Lc=Z.get_trans_view($a.render.world_tsr),
Hb=bb.friction,Mc=bb.elasticity,nc=bb.collision_id,oc=p(nc);F.post_msg(Cb,F.OUT_APPEND_STATIC_MESH_BODY,Nb,ed,mc,Lc,Hb,Mc,oc,bb.collision_margin,bb.collision_group,bb.collision_mask);var pc=B(Nb,"STATIC_MESH");pc.collision_id=nc;pc.collision_id_num=oc;v=pc}a.physics=v;rd={batch:hc,physics:v};t.push(rd);h(b,e,v.collision_id)}else Q.error("Object "+a.name+" has collision material with no assigned vertices")}if(x(a)||g(a)){var Ya=a,jb=e,Db=Ya.physics.body_id;x(Ya)?(Ya.vehicle.type=10,F.post_msg(jb,F.OUT_APPEND_CAR,
Db,Ya.vehicle.suspension_compression,Ya.vehicle.suspension_stiffness,Ya.vehicle.suspension_damping,Ya.vehicle.wheel_friction,Ya.vehicle.max_suspension_travel_cm)):g(Ya)&&(Ya.vehicle.type=20,F.post_msg(jb,F.OUT_APPEND_BOAT,Db,Ya.vehicle.floating_factor,Ya.vehicle.water_lin_damp,Ya.vehicle.water_rot_damp));if(Ya.vehicle.props){var kb=Ya.vehicle.props;switch(Ya.vehicle.type){case 10:m(kb[0],Ya,Db,!0,jb);m(kb[1],Ya,Db,!0,jb);m(kb[2],Ya,Db,!1,jb);m(kb[3],Ya,Db,!1,jb);break;case 20:for(var Tb=0;Tb<kb.length;Tb++)m(kb[Tb],
Ya,Db,!1,jb)}}M(a,a.vehicle,e)}else if(a.is_character){var Zc=e,ec=a.render,Ib=a.physics,mb=ec.bb_local.max_z-ec.bb_local.min_z,yc=Ib.body_id,Na=a.character_settings,tb=Na.walk_speed,Fc=Na.run_speed,Jb=Na.step_height,gb=Na.jump_strength,zc=Na.waterline,Oa=N.dir_ground_proj_angle(a);F.post_msg(Zc,F.OUT_APPEND_CHARACTER,yc,Oa,mb,tb,Fc,Jb,gb,zc);Ib.is_character=!0}else if(G(a)){var cb=a,ub=e,Ob=cb.physics.body_id;F.post_msg(ub,F.OUT_APPEND_FLOATER,Ob,cb.floater.floating_factor,cb.floater.water_lin_damp,
cb.floater.water_rot_damp);if(cb.floater.bobs)for(var Xa=cb.floater.bobs,Ra=0;Ra<Xa.length;Ra++){var qc=Xa[Ra],Eb=Z.get_trans_view(qc.render.world_tsr),Uc=Z.invert(cb.render.world_tsr,V),Ac=new Float32Array(3);Z.transform_vec3(Eb,Uc,Ac);F.post_msg(ub,F.OUT_ADD_FLOATER_BOB,Ob,Ac,qc.bob_synchronize_pos)}cb.physics.is_floater=!0}for(Xc=0;Xc<va.length;Xc++)if(a=va[Xc],a.physics){var fb=a;if(!A(fb))for(var Ub=0;Ub<fb.physics_constraints.length;Ub++){var vb=fb.physics_constraints[Ub],hb=vb.target,Nc=vb.pivot_type;
if(hb.physics){var Oc=new Float32Array([vb.pivot_x,vb.pivot_y,vb.pivot_z]),Bc,Gc=new Float32Array([vb.axis_x,vb.axis_y,vb.axis_z]);Bc=N.euler_to_quat(Gc,new Float32Array(4));var yb=Z.identity(V),yb=Z.set_trans(Oc,yb),yb=Z.set_quat(Bc,yb),Pc=Z.multiply(fb.render.world_tsr,yb,V),fc=Z.invert(hb.render.world_tsr,wa),rc=Z.multiply(fc,Pc,fc),wb=Z.get_trans_view(rc),Qc=Z.get_quat_view(rc),lb=vb,Ua={};Ua.use_limit_x=lb.use_limit_x;Ua.use_limit_y=lb.use_limit_y;Ua.use_limit_z=lb.use_limit_z;Ua.use_angular_limit_x=
lb.use_angular_limit_x;Ua.use_angular_limit_y=lb.use_angular_limit_y;Ua.use_angular_limit_z=lb.use_angular_limit_z;Ua.limit_max_x=lb.limit_max_x;Ua.limit_min_x=lb.limit_min_x;Ua.limit_max_y=lb.limit_max_y;Ua.limit_min_y=lb.limit_min_y;Ua.limit_max_z=lb.limit_max_z;Ua.limit_min_z=lb.limit_min_z;Ua.limit_angle_max_x=lb.limit_angle_max_x;Ua.limit_angle_min_x=lb.limit_angle_min_x;Ua.limit_angle_max_y=lb.limit_angle_max_y;Ua.limit_angle_min_y=lb.limit_angle_min_y;Ua.limit_angle_max_z=lb.limit_angle_max_z;
Ua.limit_angle_min_z=lb.limit_angle_min_z;E(Nc,fb,Oc,Bc,hb,wb,Qc,Ua,null,null)}}}};a.find_obj_by_body_id=l;a.update=function(a,b){for(var c=0;c<S.length;c++){var d=S[c],e=a,g=b;d&&F.is_fallback(d)&&F.post_msg(d,F.OUT_UPDATE_WORLD,e,g);for(g=0;g<va.length;g++){var f=va[g],k=f.physics;if(k.simulated&&k.curr_time){var h=F.is_fallback(d)?e-k.curr_time:performance.now()/1E3-k.curr_time,h=Math.min(h,10/da.max_fps),h=h-1/da.max_fps;fa.no_phy_interp_hack&&(h=0);var l=V;Z.integrate(k.curr_tsr,h,k.linvel,k.angvel,
V);Y.set_tsr(f,l);Y.update_transform(f);v(f);if(f.vehicle)for(var k=f,h=k.vehicle.props,l=k.render.world_tsr,m=V,n=0;n<h.length;n++){var p=h[n];Z.multiply(l,k.vehicle.prop_offsets[n],m);Y.set_tsr(p,m);Y.update_transform(p)}f.vehicle&&f.vehicle.steering_wheel&&(m=f,h=m.vehicle,k=h.steering_wheel)&&(n=m.vehicle.steering_wheel_axis,Z.multiply(m.render.world_tsr,m.vehicle.steering_wheel_tsr,k.render.world_tsr),l=na,Z.transform_dir_vec3(n,m.render.world_tsr,l),m=za,T.setAxisAngle(l,-h.steering*h.steering_max*
2*Math.PI,m),h=Z.get_quat_view(k.render.world_tsr),T.multiply(m,h,h),Y.update_transform(k));f.vehicle&&f.vehicle.speedometer&&(m=f,h=m.vehicle,k=h.speedometer)&&(n=m.vehicle.speedometer_axis,Z.multiply(m.render.world_tsr,m.vehicle.speedometer_tsr,k.render.world_tsr),l=na,Z.transform_dir_vec3(n,m.render.world_tsr,l),m=za,n=Math.abs(h.speed)*h.speed_ratio,n>h.max_speed_angle&&(n=h.max_speed_angle),T.setAxisAngle(l,-n,m),h=Z.get_quat_view(k.render.world_tsr),T.multiply(m,h,h),T.normalize(h,h),Y.update_transform(k));
f.vehicle&&f.vehicle.tachometer&&(l=f,k=l.vehicle,f=k.tachometer)&&(m=l.vehicle.tachometer_axis,Z.multiply(l.render.world_tsr,l.vehicle.tachometer_tsr,f.render.world_tsr),h=na,Z.transform_dir_vec3(m,l.render.world_tsr,h),l=za,T.setAxisAngle(h,-Math.abs(k.engine_force)*k.delta_tach_angle,l),k=Z.get_quat_view(f.render.world_tsr),T.multiply(l,k,k),T.normalize(k,k),Y.update_transform(f))}}F.post_msg_arr(d);d=R[c];(e=d._render.water_params)&&0<e.waves_height&&(d=W.get_subs(d,ha.MAIN_OPAQUE),e=ca.length(d.wind),
F.post_msg(S[c],F.OUT_SET_WATER_TIME,d.time*e))}};a.get_active_scene=function(){return R[0]};a.pause=function(){for(var a=0;a<S.length;a++)F.post_msg(S[a],F.OUT_PAUSE)};a.resume=function(){for(var a=0;a<S.length;a++)F.post_msg(S[a],F.OUT_RESUME)};a.enable_simulation=function(a){(a=a.physics)||N.panic("No object physics");if(!a.simulated){var b=a.body_id,c=w(b);a.simulated=!0;F.post_msg(c,F.OUT_ENABLE_SIMULATION,b)}};a.disable_simulation=function(a){(a=a.physics)||N.panic("No object physics");if(a.simulated){var b=
a.body_id,c=w(b);a.simulated=!1;F.post_msg(c,F.OUT_DISABLE_SIMULATION,b)}};a.scene_has_physics=function(a){return Boolean(a._physics)};a.obj_has_physics=function(a){return Boolean(a.physics)};a.has_dynamic_physics=function(a){return(a=a.physics)&&a.simulated&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.mass&&0==a.is_ghost?!0:!1};a.has_simulated_physics=function(a){return(a=a.physics)&&a.simulated?!0:!1};a.set_gravity=function(a,b){var c=a.physics.body_id,d=w(c);F.post_msg(d,F.OUT_SET_GRAVITY,c,
b)};a.has_constraint=A;a.apply_constraint=E;a.clear_constraint=function(a){a=a.physics;var b=a.cons_id,c=w(body_a);F.post_msg(c,F.OUT_REMOVE_CONSTRAINT,b);a.cons_id=null};a.pull_to_constraint_pivot=function(b,c,d,e,g,f){c=Z.set_sep(c,1,d,V);g=Z.set_sep(g,1,f,wa);Z.invert(c,c);Z.multiply(g,c,c);Y.get_tsr(e,g);Z.multiply(g,c,c);Y.set_tsr(b,c);Y.update_transform(b);e=Z.get_trans_view(b.render.world_tsr);g=Z.get_quat_view(b.render.world_tsr);a.set_transform(b,e,g)};a.set_transform=function(a,b,c){var d=
a.physics,e=F.get_msg_cache(F.OUT_SET_TRANSFORM),g=Z.get_trans(a.render.world_tsr,e.trans);a=Z.get_quat(a.render.world_tsr,e.quat);Z.set_sep(g,1,a,d.curr_tsr);e.body_id=d.body_id;ca.copy(b,e.trans);T.copy(c,e.quat);b=w(d.body_id);F.post_msg(b,F.OUT_SET_TRANSFORM)};a.sync_transform=v;a.apply_velocity=function(a,b,c,d){var e=na;z(a,b,c,d,e);a=a.physics.body_id;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var g=Math.abs(e[0]),f=Math.abs(e[1]),k=Math.abs(e[2]);e[0]=g?e[0]/g*Math.max(g,b):0;e[1]=f?e[1]/f*
Math.max(f,c):0;e[2]=k?e[2]/k*Math.max(k,d):0;b=w(a);F.post_msg(b,F.OUT_SET_LINEAR_VELOCITY,a,e[0],e[1],e[2])};a.apply_velocity_world=function(a,b,c,d){a=a.physics.body_id;var e=w(a);F.post_msg(e,F.OUT_SET_LINEAR_VELOCITY,a,b,c,d)};a.apply_force=function(a,b,c,d,e){var g=na;e?(g[0]=b,g[1]=c,g[2]=d):z(a,b,c,d,g);a=a.physics.body_id;b=w(a);F.post_msg(b,F.OUT_APPLY_CENTRAL_FORCE,a,g[0],g[1],g[2])};a.apply_torque=function(a,b,c,d){var e=na;z(a,b,c,d,e);a=a.physics.body_id;b=w(a);F.post_msg(b,F.OUT_APPLY_TORQUE,
a,e[0],e[1],e[2])};a.set_character_move_dir=function(a,b,c){a=a.physics.body_id;var d=w(a);F.post_msg(d,F.OUT_SET_CHARACTER_MOVE_DIR,a,b,c)};a.set_character_move_type=function(a,b){var c=a.physics.body_id,d=w(c);F.post_msg(d,F.OUT_SET_CHARACTER_MOVE_TYPE,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.physics.body_id,d=w(c);F.post_msg(d,F.OUT_SET_CHARACTER_WALK_VELOCITY,c,b)};a.set_character_run_velocity=function(a,b){var c=a.physics.body_id,d=w(c);F.post_msg(d,F.OUT_SET_CHARACTER_RUN_VELOCITY,
c,b)};a.set_character_fly_velocity=function(a,b){var c=a.physics.body_id,d=w(c);F.post_msg(d,F.OUT_SET_CHARACTER_FLY_VELOCITY,c,b)};a.character_jump=function(a){a=a.physics.body_id;var b=w(a);F.post_msg(b,F.OUT_CHARACTER_JUMP,a)};a.character_rotation_inc=function(a,b,c){a=a.physics.body_id;var d=w(a);F.post_msg(d,F.OUT_CHARACTER_ROTATION_INCREMENT,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.physics.body_id;var d=w(a);F.post_msg(d,F.OUT_SET_CHARACTER_ROTATION,a,b,c)};a.set_character_rotation_h=
function(a,b){var c=a.physics.body_id,d=w(c);F.post_msg(d,F.OUT_SET_CHARACTER_HOR_ROTATION,c,b)};a.set_character_rotation_v=function(a,b){var c=a.physics.body_id,d=w(c);F.post_msg(d,F.OUT_SET_CHARACTER_VERT_ROTATION,c,b)};a.append_collision_test=function(a,b,c,d){var e=a.physics;if(!e.navmesh){var g=e.body_id;b=b||"ANY";for(var k=0;k<e.collision_tests.length;k++)if(a=e.collision_tests[k],a.collision_id==b&&a.callback==c)return;a={body_id_src:g,calc_pos_norm:d||!1,collision_id:b,callback:c,pairs:[],
pair_results:[]};e.collision_tests.push(a);b=w(g);c=f(b);y(a,c,b)}};a.remove_collision_test=function(a,b,c){a=a.physics;for(var d=w(a.body_id),g=f(d),k=0;k<a.collision_tests.length;k++){var h=a.collision_tests[k];if(h.collision_id==b&&h.callback==c){if(e(h)){var l=ca.set(0,0,0,na);h.callback(!1,null,l,l,0)}a.collision_tests.splice(k,1);k--;for(var l=d,m=g._physics.bundles,h=h.pairs,n=0;n<m.length;n++)for(var p=m[n].physics,t=0;t<p.collision_tests.length;t++)for(var q=p.collision_tests[t],v=0;v<q.pairs.length;v++)for(var r=
q.pairs[v],P=0;P<h.length;P++){var la=h[P];r[0]==la[0]&&r[1]==la[1]&&(h.splice(P,1),P--)}h.length&&F.post_msg(l,F.OUT_REMOVE_COLLISION_TEST,h)}}};a.apply_collision_impulse_test=function(a,b){a.physics&&a.physics.col_imp_test_cb&&K(a);var c=a.physics,d=w(c.body_id);F.post_msg(d,F.OUT_APPLY_COLLISION_IMPULSE_TEST,c.body_id);c.col_imp_test_cb=b};a.clear_collision_impulse_test=K;a.append_ray_test=function(a,b,c,d,e,g,k,h,l){var m;J.ray_test++;m=J.ray_test;d=d||"ANY";a={id:m,body_id:a?a.physics.body_id:
0,from:new Float32Array(b),to:new Float32Array(c),collision_id:d,collision_id_num:p(d),autoremove:g,calc_all_hits:k,calc_pos_norm:h,ign_src_rot:l,callback:e};b=w(a.body_id)||S[0];c=f(b)._physics;m=a.id;c.ray_tests[m]=a;c.ray_tests_arr.push(a);F.post_msg(b,F.OUT_APPEND_RAY_TEST,a.id,a.body_id,a.from,a.to,a.collision_id_num,a.autoremove,a.calc_all_hits,a.calc_pos_norm,a.ign_src_rot);return m};a.remove_ray_test=d;a.change_ray_test_from_to=function(a,b,c){var d=t(a),e=C(a);(d=d._physics.ray_tests[a])&&
!d.autoremove&&(d.from.set(b),d.to.set(c),F.post_msg(e,F.OUT_CHANGE_RAY_TEST_FROM_TO,a,b,c))};a.is_ray_test=function(a){return t(a)._physics.ray_tests[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.vehicle;c.engine_force=b;var d=w(a.physics.body_id);M(a,c,d)};a.vehicle_steer=function(a,b){var c=a.vehicle;c.steering=b;var d=w(a.physics.body_id);M(a,c,d)};a.vehicle_brake=function(a,b){var c=a.vehicle;c.brake_force=b;var d=w(a.physics.body_id);M(a,c,d)};a.is_vehicle_chassis=x;a.is_vehicle_hull=g;
a.is_navigation_mesh=H;a.is_car_wheel=function(a){if(!a.is_vehicle)return!1;a=a.vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.is_boat_bob=function(a){return a.is_vehicle?"BOB"==a.vehicle_settings.part?!0:!1:!1};a.is_floater_bob=function(a){return a.is_floating?"BOB"==a.floating_settings.part?!0:!1:!1};a.is_vehicle_steering_wheel=function(a){return a.is_vehicle&&"STEERING_WHEEL"==a.vehicle_settings.part?!0:!1};a.is_vehicle_speedometer=
function(a){return a.is_vehicle&&"SPEEDOMETER"==a.vehicle_settings.part?!0:!1};a.is_vehicle_tachometer=function(a){return a.is_vehicle&&"TACHOMETER"==a.vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.vehicle.speed};a.wheel_index=function(a){switch(a){case "WHEEL_FRONT_RIGHT":return 0;case "WHEEL_FRONT_LEFT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.is_floater_main=G;a.get_fps=function(){return ra};
a.debug_workers=function(){for(var a=0;a<S.length;a++)F.post_msg(S[a],F.OUT_DEBUG)};a.remove_object=function(a){if("BOUNDING"==a.physics.type){var b=va.indexOf(a);-1==b&&Q.error("Object "+a.name+" doesn't have bounding physics");delete sa[c];va.splice(b,1)}for(var c=a.physics.body_id,b=w(c),d=f(b),g=c,k=d._physics.bundles,h=[],l=0;l<k.length;l++)for(var m=k[l].physics,n=0;n<m.collision_tests.length;n++)for(var p=m.collision_tests[n],t=0;t<p.pairs.length;t++){var q=p.pairs[t],v=p.pair_results[t];if(q[0]==
g||q[1]==g)p.pairs.splice(t,1),p.pair_results.splice(t,1),t--,v&&!e(p)&&(v=ca.set(0,0,0,na),p.callback(!1,null,v,v,0)),h.push(q)}h.length&&F.post_msg(b,F.OUT_REMOVE_COLLISION_TEST,h);a.physics&&a.physics.col_imp_test_cb&&K(a);a=d._physics.bundles;for(d=0;d<a.length;d++)a[d].physics.body_id==c&&(a.splice(d,1),d--);F.post_msg(b,F.OUT_REMOVE_BODY,c)}};b4w.module.__data=function(a,r){function u(a,b){Ja[b.id]=null;Ta[b.id]=null}function h(a,b,c,d){a instanceof ArrayBuffer&&(a=J.get_width_height(a,d));d=a.width;a=a.height;Ea.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(eb)&&c&&Ea.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,g){(d=b.filepath)||ta.panic("Nothing requested");R.enqueue([{id:d,type:R.AT_JSON,url:d}],function(d,g,f,k){if(d){Ea.log("%cLOAD METADATA","color: #616",
k);g=ta.str_to_version(d.b4w_format_version);switch(ta.version_cmp(g,qa.min_format_version)){case -1:g[0]<qa.min_format_version[0]?ta.panic("JSON version is too old relative to B4W engine: "+ta.version_to_str(g)+", required: "+ta.version_to_str(qa.min_format_version)+". Reexport scene with the latest B4W addon to fix it."):Ea.warn("JSON version is a bit old relative to B4W engine: "+ta.version_to_str(g)+", required: "+ta.version_to_str(qa.min_format_version)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");
break;case 1:g[0]>qa.min_format_version[0]?ta.panic("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):Ea.error("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}qa.loaded_data_version=g;for(var h in d)a[h]=d[h];b.is_primary&&(Va=xa.find_main_scene(a.scenes));(d=a.binaries[0].binfile)?b.binary_name=d:(wa.skip_stage_by_name(b,"load_binaries"),wa.skip_stage_by_name(b,
"prepare_bindata"));qa.is_mobile_device||wa.skip_stage_by_name(b,"mobile_media_start");qa.antialiasing&&qa.smaa||wa.skip_stage_by_name(b,"load_smaa_textures");if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)h=a.b4w_export_errors[d],(b.is_primary&&"PRIMARY"==h.type||"ALL"==h.type)&&Ea.export_error(h.text+" See more details in https://www.blend4web.com/doc/en/addon.html#non-critical-export-errors");if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)h=a.b4w_export_warnings[d],
(b.is_primary&&"PRIMARY"==h.type||"ALL"==h.type)&&Ea.export_warn(h.text+" See more details in https://www.blend4web.com/doc/en/addon.html#other-messages");e(b,c)}else wa.abort_thread(b)},null,function(a){g(b,c,a)})}function f(a,b,c,d,g,f){(d=da(b.filepath)+b.binary_name)||ta.panic("Binary data is missing");R.enqueue([{id:d,type:R.AT_ARRAYBUFFER,url:d}],function(d,f,k,h){d?(Ea.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,d=e(d),f=ta.str_to_version(a.b4w_format_version),d[0]!=f[0]&&ta.panic("BIN version does not match to JSON version: "+
ta.version_to_str(d)+", required: "+ta.version_to_str(qa.min_format_version)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=f[1]&&Ea.warn("BIN version does not match to JSON version: "+ +ta.version_to_str(d)+", required: "+ta.version_to_str(qa.min_format_version)+". Some compatibility issues can occur. Reexport scene to fix it."),g(b,c)):wa.abort_thread(b)},null,function(a){f(b,c,a)})}function l(a,b,c,d,e,g){Ha.check_shaders_loaded()&&e(b,c)}function q(a,b,c,d,g,f){d=a.bin_data;f=a.binaries[0];
var k=a.objects,h=a.meshes;a=a.actions;var l=ta.check_endians();e(d);for(var m=["indices"],P=["position","texcoord","texcoord2","shade_tangs"],p=["normal","tangent"],t=["group"],q=["color"],la=0;la<h.length;la++)for(var v=h[la].submeshes,r=0;r<v.length;r++){for(var B in v[r]){var x=v[r][B][1];if(-1!=m.indexOf(B)){var w=v[r][B][0]*ta.INT_SIZE+f["int"]+12,ia=v[r],z=B,A=d;if(l)var u=new Uint32Array(A,w,x);else for(var u=new Uint32Array(x),A=new DataView(A),C=0;C<x;C++)u[C]=A.getUint32(w+C*ta.INT_SIZE,
!0);ia[z]=u}else if(-1!=P.indexOf(B))w=v[r][B][0]*ta.FLOAT_SIZE+f["float"]+12,v[r][B]=n(d,w,x,l);else if(-1!=p.indexOf(B)){w=v[r][B][0]*ta.SHORT_SIZE+f["short"]+12;ia=v[r];z=B;A=d;u=new Float32Array(x);A=new DataView(A);for(C=0;C<x;C++)u[C]=A.getInt16(w+C*ta.SHORT_SIZE,!0)/32767;ia[z]=u}else if(-1!=t.indexOf(B)){w=v[r][B][0]*ta.SHORT_SIZE+f.ushort+12;ia=v[r];z=B;A=d;u=new Float32Array(x);A=new DataView(A);for(C=0;C<x;C++)u[C]=A.getUint16(w+C*ta.SHORT_SIZE,!0)/65535;ia[z]=u}else if(-1!=q.indexOf(B)){w=
v[r][B][0]*ta.BYTE_SIZE+f.uchar+12;ia=v[r];z=B;A=d;u=new Float32Array(x);A=new DataView(A);for(C=0;C<x;C++)u[C]=A.getUint8(w+C*ta.BYTE_SIZE,!0)/255;ia[z]=u}}x=v[r];if(h[la].b4w_shape_keys.length)for(w=x.base_length,ia=x.normal.length/w/3,z=x.normal.length/3*4,x.tbn_quat=ta.gen_tbn_quats(x.normal.subarray(0,3*w),x.tangent.subarray(0,4*w),new Float32Array(z)),z=1;z<ia;z++)for(A=z*w,u=0;u<w;u++){var y=x.normal.subarray(3*u,3*(u+1)),C=Ka.add(x.normal.subarray(3*(A+u),3*(A+u+1)),y,$b);if(x.tangent.length){var xa=
x.tangent.subarray(4*u,4*(u+1)),Ha=ka.add(x.tangent.subarray(4*(A+u),4*(A+u+1)),xa,nb),y=ta.get_tbn_quat(y,xa,sb),C=ta.get_tbn_quat(C,Ha,Lb);Ca.invert(y,sb);C=Ca.multiply(C,y,sb)}else C=Ca.rotationTo(y,C,sb);x.tbn_quat.set(C,4*(A+u))}else x.tbn_quat=ta.gen_tbn_quats(x.normal,x.tangent)}for(B=0;B<k.length;B++)for(h=k[B].particle_systems,m=0;m<h.length;m++)P=h[m],P.transforms=n(d,P.transforms[0]*ta.FLOAT_SIZE+f["float"]+12,P.transforms[1],l);for(k=0;k<a.length;k++){B=a[k];h=B.fcurves;m=B.frame_range;
p=m[0];t=m[1];q=S.get_approx_curve_length(p,t);m=null;0>q&&(q=0);var v=la=!1,H;for(H in h)la|=-1<H.indexOf("rotation_euler"),v|=-1<H.indexOf("rotation_quaternion");P=[];for(H in h)if(la&&v&&-1<H.indexOf("rotation_euler"))delete h[H];else{var r=h[H],Ba;for(Ba in r)x=r[Ba],w=n(d,f["float"]+x.bin_data_pos[0]*ta.FLOAT_SIZE+12,x.bin_data_pos[1],l),ia=new Float32Array(q),null===m&&(m=new Int8Array(q)),S.approximate_curve(x,w,ia,m,p,t),x._pierced_points=ia;-1<H.indexOf("rotation_euler")&&(S.fcurve_replace_euler_by_quat(h[H]),
P.push(H))}for(p=0;p<P.length;p++)t=P[p],q=t.replace("euler","quaternion"),h[q]=h[t],delete h[t];B._bflags=m}g(b,c)}function e(a){new Uint8Array(a,0,4);var b=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];return[b,a]}function n(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+e*ta.FLOAT_SIZE,!0)}return d}function p(a,b,c,d,e,g){var f=a.cameras,h=a.groups,l=a.materials,n=a.meshes,P=a.node_groups,p=a.objects,t=a.particles,
q=a.scenes,v=a.speakers,r=a.lamps,x=a.textures,w=a.worlds;P||(Ea.warn('"node_groups" datablock undefined. reexport main scene.'),P=a.node_groups=[]);for(var A="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),z={},u=0;u<A.length;u++)for(var C=a[A[u]],H=0;H<C.length;H++){var Ha=C[H];z[Ha.uuid]=Ha}for(var F=0;F<q.length;F++){for(var J=q[F],G=J.objects,E=0;E<G.length;E++)D(G,E,z);J.camera&&D(J,"camera",
z);J.world&&D(J,"world",z)}for(F=0;F<h.length;F++)for(var oa=h[F].objects,E=0;E<oa.length;E++)D(oa,E,z);for(F=0;F<p.length;F++){var W=p[F];W.dupli_group&&D(W,"dupli_group",z);W.parent&&D(W,"parent",z);W.dg_parent&&D(W,"dg_parent",z);if(W.animation_data){var Ma=W.animation_data;Ma.action&&D(Ma,"action",z);if(Ma.nla_tracks)for(E=0;E<Ma.nla_tracks.length;E++)for(var ka=Ma.nla_tracks[E],M=0;M<ka.strips.length;M++)ka.strips[M].action&&D(ka.strips[M],"action",z)}switch(W.type){case "MESH":W.data||ta.panic("mesh not found for object "+
W.name);D(W,"data",z);for(var U=!1,O=W.modifiers,E=0;E<O.length;E++){var Fa=O[E];"ARMATURE"==Fa.type?(U&&Ea.warn('Object "'+W.name+'" has more than one armature modifiers. Only the first one will be used.'),U=!0,D(Fa,"object",z)):"CURVE"==Fa.type&&D(Fa,"object",z)}var I=W.particle_systems;if(I)for(E=0;E<I.length;E++)D(I[E],"settings",z);break;case "ARMATURE":D(W,"data",z);for(var K=W.pose.bones,va=W.data.bones,E=0;E<K.length;E++){var Q=K[E];Q.bone=va[Q.bone];var pa=Q.constraints;if(pa)for(M=0;M<pa.length;M++){var T=
pa[M];T.target&&D(T,"target",z)}for(var Y=Q.parent_recursive,M=0;M<Y.length;M++)Y[M]=K[Y[M]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":D(W,"data",z)}if(pa=W.constraints)for(E=0;E<pa.length;E++)T=pa[E],T.target&&D(T,"target",z);var ha=W.lod_levels;if(ha)for(E=0;E<ha.length;E++){var N=ha[E];N.object&&D(N,"object",z)}}for(F=0;F<n.length;F++)for(var Ka=n[F].materials,E=0;E<Ka.length;E++)D(Ka,E,z);for(F=0;F<l.length;F++){for(var Z=l[F],ua=Z.texture_slots,E=0;E<ua.length;E++)D(ua[E],"texture",
z);var Za=Z.node_tree;Za&&y(Za,z)}for(F=0;F<P.length;F++)(Za=P[F].node_tree)&&y(Za,z);for(F=0;F<x.length;F++){var qa=x[F],Ca=qa.type;"IMAGE"!=Ca&&"ENVIRONMENT_MAP"!=Ca||D(qa,"image",z)}for(F=0;F<f.length;F++){var ba=f[F];ba.dof_object&&D(ba,"dof_object",z)}for(F=0;F<v.length;F++){var fa=v[F];fa.sound&&D(fa,"sound",z);if(fa.animation_data&&(Ma=fa.animation_data,Ma.action&&D(Ma,"action",z),Ma.nla_tracks))for(E=0;E<Ma.nla_tracks.length;E++)for(ka=Ma.nla_tracks[E],M=0;M<ka.strips.length;M++)ka.strips[M].action&&
D(ka.strips[M],"action",z)}for(F=0;F<t.length;F++){for(var na=t[F],ua=na.texture_slots,E=0;E<ua.length;E++)D(ua[E],"texture",z);na.dupli_group&&D(na,"dupli_group",z);na.dupli_object&&D(na,"dupli_object",z)}for(F=0;F<r.length;F++){var R=r[F];if(R.animation_data&&(Ma=R.animation_data,Ma.action&&D(Ma,"action",z),Ma.nla_tracks))for(E=0;E<Ma.nla_tracks.length;E++)for(ka=Ma.nla_tracks[E],M=0;M<ka.strips.length;M++)ka.strips[M].action&&D(ka.strips[M],"action",z)}for(F=0;F<w.length;F++){var Ja=w[F];if(ua=
Ja.texture_slots)for(E=0;E<ua.length;E++)D(ua[E],"texture",z);if(Ja.animation_data&&(Ma=Ja.animation_data,Ma.action&&D(Ma,"action",z),Ma.nla_tracks))for(E=0;E<Ma.nla_tracks.length;E++)for(ka=Ma.nla_tracks[E],M=0;M<ka.strips.length;M++)ka.strips[M].action&&D(ka.strips[M],"action",z)}ia.check_bpy_data(a);for(var Sa=a.textures,ca=b.is_primary?a.scenes[0].b4w_anisotropic_filtering:Va.b4w_anisotropic_filtering,X=0;X<Sa.length;X++)b.is_primary||"SCENE"!=Sa[X].b4w_source_type||(Sa[X].b4w_source_id=""),la.create_texture_bpy(Sa[X],
ca,a.scenes,b.id);for(var V={},ra=a.objects,$b=0;$b<ra.length;$b++){var ma=ra[$b];if("MESH"===ma.type&&!ma.particle_systems.length)for(var Aa=ma.data,da=Aa.name,sa=Aa.submeshes,za=Aa.materials,aa=0;aa<sa.length;aa++)0!==sa[aa].base_length||V[da]||(za[aa]&&Ea.warn('material "'+za[aa].name+'" is not assigned to any face (object "'+ma.name+'").'),V[da]=!0)}for(var ea=a.meshes,Da=0;Da<ea.length;Da++){var ga=ea[Da];ga.materials.length||ga.uv_textures.length&&Ea.warn('mesh "'+ga.name+'" has a UV map but has no exported material.')}var sb=
a.materials,wa=ia.create_material("DEFAULT");sb.push(wa);for(var eb=a.meshes,nb=ta.keysearch("name","DEFAULT",a.materials),db=0;db<eb.length;db++){var Lb=eb[db];0==Lb.materials.length&&Lb.materials.push(nb)}for(var Ga=a.actions,Qa=b.id,Pa=0;Pa<Ga.length;Pa++){var ac=Ga[Pa];ac._data_id=Qa;S.append_action(ac)}for(var qb=a.scenes,Vb=0;Vb<qb.length;Vb++){for(var Ac=qb[Vb],fb=[],Ub=[],vb=qb[Vb].objects,hb=0;hb<vb.length;hb++){var Nc=vb[hb];L(vb,Nc,null,fb,Ub);var Oc=Nc.dupli_group;if(Oc)for(var Bc=Oc.objects,
Gc=0;Gc<Bc.length;Gc++)L(Bc,Bc[Gc],Nc,fb,Ub)}for(hb=0;hb<Ub.length;hb++)for(var yb=Ub[hb],Pc=[Ac],fc=0;fc<Pc.length;fc++){for(var rc=Pc[fc].objects,wb=0;wb<rc.length;wb++){var Qc=rc[wb].dupli_group;if(Qc){var lb=Qc.objects,Ua=lb.indexOf(yb);-1<Ua&&lb.splice(Ua,1)}}var Ua=rc.indexOf(yb);-1<Ua&&rc.splice(Ua,1)}for(hb=0;hb<fb.length;hb++)ta.append_unique(fb[hb][0],fb[hb][1])}!b.is_primary&&1<a.scenes.length&&(a.scenes=[xa.find_main_scene(a.scenes)],Ea.warn("loading data contains multiple scenes.","Only the first one will be loaded."));
var Kb=b.is_primary?Va:xa.find_main_scene(a.scenes);Ba.set_framerate(Va.fps);if(1<a.scenes.length){var fd=a.scenes.indexOf(Va);a.scenes.splice(fd,1);a.scenes.unshift(Va)}for(var $c=0;$c<a.scenes.length;$c++){var Yb=a.scenes[$c];Yb._render=xa.create_scene_render();Yb._is_main=Yb==Kb;Yb._is_primary_thread=b.is_primary;Ia.enabled&&Yb.b4w_enable_physics&&(b.is_primary||!ya.scene_has_physics(Va)&&Yb==xa.find_main_scene(a))&&ya.init_scene_physics(Yb)}for(var sc=0;sc<a.scenes.length;sc++){for(var Hc=a.scenes[sc],
Cc=B(Hc,"ALL"),ad=0;ad<Cc.length;ad++){var zb=Cc[ad];ja.check_bpy_obj_scene_compatibility(zb,Hc,a)&&(zb._scenes||(zb._scenes=[]),zb._scenes.push(b.is_primary?Hc:Va))}for(var gd=Cc,Pb=0;Pb<gd.length;Pb++){var tc=gd[Pb];if(tc._scenes&&"WORLD"!=tc.type)for(var hd=tc.particle_systems,ld=0;ld<hd.length;ld++){var bd=hd[ld].settings;if("HAIR"==bd.type)if("OBJECT"==bd.render_type){var md=bd.dupli_object;md._scenes||(md._scenes=tc._scenes.slice())}else if("GROUP"==bd.render_type)for(var td=bd.dupli_group,
nd=0;nd<td.objects.length;nd++)md=td.objects[nd],md._scenes||(md._scenes=tc._scenes.slice())}}}for(var Bd=a.scenes,ud=[],Fb=0;Fb<Bd.length;Fb++)k(Bd[Fb].objects,0,b.is_primary,ud);Ta[b.id]=[];for(Fb=0;Fb<ud.length;Fb++)for(var xd=ud[Fb],Zb=0;Zb<xd.length;Zb++)for(var jd=xd[Zb],yd=0;yd<jd.length;yd++)Ta[b.id].push(jd[yd]);for(var zd=a.particles,Fb=0;Fb<zd.length;Fb++){var cd=zd[Fb].dupli_object;cd&&(cd._is_hair_dupli=!0,Ta[b.id].push(cd));var kd=zd[Fb].dupli_group;if(kd)for(var Ad=kd.objects,Zb=0;Zb<
Ad.length;Zb++)cd=Ad[Zb],cd._is_hair_dupli=!0,Ta[b.id].push(cd)}for(var od=Ta[b.id],Fb=od.length-1;0<=Fb;Fb--)od[Fb]._scenes||od.splice(Fb,1);for(var Cd=Ta[b.id],sc=0;sc<Cd.length;sc++)if(zb=Cd[sc],!b.is_primary&&zb.parent&&-1<Dc.indexOf(zb.parent.type)&&(zb.parent=""),"MESH"==zb.type){var vd=ia.apply_mesh_modifiers(zb);vd&&(a.meshes.push(vd),zb.data=vd)}for(var wd=0;wd<a.scenes.length;wd++){var Jd=a.scenes[wd],Fd=Jd.world;Fd._scenes||(Fd._scenes=[]);Fd._scenes.push(b.is_primary?Jd:Va)}for(var Gd=
0;Gd<a.scenes.length;Gd++){var Dd=a.scenes[Gd];if(Dd.b4w_use_logic_editor){var Kd=B(Dd,"ALL");ia.assign_logic_nodes_object_params(Kd,Dd.world,Dd)}}for(var Hd=0;Hd<a.scenes.length;Hd++){var Ld=a.scenes[Hd],Id=b.is_primary?Ld:Va;Boolean(m(b.id,Id,"SPEAKER").length)&&!Id._sfx&&La.attach_scene_sfx(Id)}e(b,c)}function B(a,b){b||(b="ALL");var d=[];-1==a.objects.indexOf(a.camera)&&a.objects.push(a.camera);c(a.objects,b,d);return d}function c(a,b,d){for(var e=0;e<a.length;e++){var g=a[e];"ALL"!=b&&b!=g.type||
d.push(g);(g=g.dupli_group)&&c(g.objects,b,d)}}function k(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],g=0;g<a.length;g++){var f=a[g],h=Aa(f);e[h]=e[h]||[];(c||-1==Dc.indexOf(f.type))&&-1==e[h].indexOf(f)&&e[h].push(f);(f=f.dupli_group)&&k(f.objects,b+1,c,d)}}function m(a,b,c){var d=[];a=Ta[a];for(var e=0;e<a.length;e++){var g=a[e];if(g.type==c||"ALL"==c)for(var f=0;f<g._scenes.length;f++)b==g._scenes[f]&&d.push(g)}return d}function A(a,b,c,d,e,g){g=Ta[b.id];var f=a.worlds;d=b.id;for(var k=0;k<g.length;k++){for(var h=
g[k],l=pa.create_object(h.name,h.type,h.origin_name),m=0;m<h._scenes.length;m++)pa.append_scene_data(l,h._scenes[m]);h._object=l;ja.update_object(h,l);l.render.data_id=d;l.is_hair_dupli=h._is_hair_dupli||!1}for(d=0;d<f.length;d++){k=f[d];h="%meta_world%"+k.name;h=pa.create_object(h,"WORLD",h);for(l=0;l<k._scenes.length;l++)pa.append_scene_data(h,k._scenes[l]);k._object=h;ja.update_world(k,h)}d=ja.get_all_objects(b.id);for(k=0;k<g.length;k++)h=g[k],l=h._object,X.update_object(h,l);for(k=0;k<f.length;k++)h=
f[k],X.update_object(h,h._object);if(b.is_primary)for(f=b.id,k=0;k<a.scenes.length;k++)for(var h=a.scenes[k],l=0,m=ja.get_scene_objs(h,"LAMP",f),n=0;n<m.length;n++)pa.get_scene_data(m[n],h).light_index=l++;for(k=0;k<g.length;k++)h=g[k],l=h._object,l.is_hair_dupli||(ja.update_object_relations(h,l),Ma.update_transform(l));for(a=0;a<g.length;a++)if(f=g[a],k=f._object,pa.is_mesh(k)&&(h=f.lod_levels.length))for(l=k,m=0;m<h;m++)if(n=f.lod_levels[m].object){n=n._object;n.render.lod_transition_ratio=k.render.lod_transition_ratio;
l.render.lod_dist_max=f.lod_levels[m].distance;n.render.lod_dist_min=f.lod_levels[m].distance;if(f.lod_levels[m+1])n.render.lod_dist_max=f.lod_levels[m+1].distance;else{n.render.last_lod=!0;n.render.lod_dist_max=pa.LOD_DIST_MAX_INFINITY;break}l.render.last_lod=!1;l=n}else{l.render.last_lod=!0;l.render.lod_dist_max=f.lod_levels[m].distance;break}for(g=0;g<d.length;g++)if(a=d[g],"MESH"==a.type&&(f=a.armobj)){var f=f.render,k=a.render.bone_skinning_info,h=[],P;for(P in k)l=k[P],h.push(4*l.deform_bone_index,
4*l.bone_index);f.mesh_to_arm_bone_maps.push(h);f.skinned_renders.push(a.render)}g=P=-1;a=S.get_max_bones();for(f=0;f<d.length;f++)k=d[f],h=k.render,pa.is_mesh(k)&&h.is_skinning&&(k=h.max_bones,k>P&&(P=k),a>=k&&k>g&&(g=k));for(f=0;f<d.length;f++)k=d[f],h=k.render,pa.is_mesh(k)&&h.is_skinning&&(h.frames_blending=!0,P<a?h.max_bones=P:h.max_bones<=a?h.max_bones=g:(Ea.warn('too many bones for "'+k.name+'" / '+h.max_bones+" bones (max "+a+" with blending, "+2*a+" without blending). Blending between frames will be disabled."),
h.max_bones=P,h.frames_blending=!1),h.frames_blending=h.frames_blending&&!Za.frames_blending_hack);for(P=0;P<d.length;P++)if(g=d[P],g.is_vehicle)if(a=g.vehicle_settings,"CHASSIS"==a.part){g.vehicle={};g.vehicle.force_max=a.force_max;g.vehicle.brake_max=a.brake_max;g.vehicle.suspension_compression=a.suspension_compression;g.vehicle.suspension_stiffness=a.suspension_stiffness;g.vehicle.suspension_damping=a.suspension_damping;g.vehicle.wheel_friction=a.wheel_friction;g.vehicle.roll_influence=a.roll_influence;
g.vehicle.max_suspension_travel_cm=a.max_suspension_travel_cm;g.vehicle.engine_force=0;g.vehicle.brake_force=1;g.vehicle.steering=0;g.vehicle.speed=0;g.vehicle.props=[];g.vehicle.prop_offsets=[];g.vehicle.steering_wheel=null;k=(f=pa.get_dg_parent(g))?pa.get_dg_objects(f,d):d;for(f=0;f<k.length;f++)h=k[f],h.is_vehicle&&(l=h.vehicle_settings,ya.is_car_wheel(h)&&a.name==l.name?(l=ya.wheel_index(h.vehicle_settings.part),g.vehicle.props[l]=h,g.vehicle.prop_offsets[l]=new Float32Array(8)):ya.is_vehicle_steering_wheel(h)&&
a.name==l.name?(g.vehicle.steering_wheel=h,g.vehicle.steering_max=l.steering_max,g.vehicle.steering_ratio=l.steering_ratio,g.vehicle.inverse_control=l.inverse_control,l=Fa.invert(g.render.world_tsr,Fa.create()),h=Fa.multiply(l,h.render.world_tsr,l),g.vehicle.steering_wheel_tsr=h,l=new Float32Array([1,0,0]),Fa.transform_dir_vec3(l,h,l),g.vehicle.steering_wheel_axis=l):ya.is_vehicle_speedometer(h)&&a.name==l.name?(g.vehicle.speedometer=h,g.vehicle.speed_ratio=l.speed_ratio,g.vehicle.max_speed_angle=
l.max_speed_angle,l=Fa.invert(g.render.world_tsr,Fa.create()),h=Fa.multiply(l,h.render.world_tsr,l),g.vehicle.speedometer_tsr=h,l=new Float32Array([1,0,0]),Fa.transform_dir_vec3(l,h,l),g.vehicle.speedometer_axis=l):ya.is_vehicle_tachometer(h)&&a.name==l.name&&(g.vehicle.tachometer=h,g.vehicle.delta_tach_angle=l.delta_tach_angle,l=Fa.invert(g.render.world_tsr,Fa.create()),h=Fa.multiply(l,h.render.world_tsr,l),g.vehicle.tachometer_tsr=h,l=new Float32Array([1,0,0]),Fa.transform_dir_vec3(l,h,l),g.vehicle.tachometer_axis=
l));4!=g.vehicle.props.length&&ta.panic("Not enough wheels for chassis "+g.name)}else if("HULL"==a.part)for(g.vehicle={},g.vehicle.props=[],g.vehicle.prop_offsets=[],g.vehicle.force_max=a.force_max,g.vehicle.brake_max=a.brake_max,g.vehicle.floating_factor=a.floating_factor,g.vehicle.water_lin_damp=a.water_lin_damp,g.vehicle.water_rot_damp=a.water_rot_damp,g.vehicle.engine_force=0,g.vehicle.brake_force=1,g.vehicle.steering=0,g.vehicle.speed=0,g.vehicle.steering_wheel=null,k=(f=pa.get_dg_parent(g))?
pa.get_dg_objects(f,d):d,f=0;f<k.length;f++)h=k[f],h.is_vehicle&&(l=h.vehicle_settings,ya.is_boat_bob(h)&&a.name==l.name?(g.vehicle.props.push(h),g.vehicle.prop_offsets.push(new Float32Array(8))):ya.is_vehicle_steering_wheel(h)&&a.name==l.name?(g.vehicle.steering_wheel=h,g.vehicle.steering_max=l.steering_max,g.vehicle.steering_ratio=l.steering_ratio,g.vehicle.inverse_control=l.inverse_control,l=Fa.invert(g.render.world_tsr,Fa.create()),h=Fa.multiply(l,h.render.world_tsr,l),g.vehicle.steering_wheel_tsr=
h,l=new Float32Array([1,0,0]),Fa.transform_dir_vec3(l,h,l),g.vehicle.steering_wheel_axis=l):ya.is_vehicle_speedometer(h)&&a.name==l.name?(g.vehicle.speedometer=h,g.vehicle.speed_ratio=l.speed_ratio,g.vehicle.max_speed_angle=l.max_speed_angle,l=Fa.invert(g.render.world_tsr,Fa.create()),h=Fa.multiply(l,h.render.world_tsr,l),g.vehicle.speedometer_tsr=h,l=new Float32Array([1,0,0]),Fa.transform_dir_vec3(l,h,l),g.vehicle.speedometer_axis=l):ya.is_vehicle_tachometer(h)&&a.name==l.name&&(g.vehicle.tachometer=
h,g.vehicle.delta_tach_angle=l.delta_tach_angle,l=Fa.invert(g.render.world_tsr,Fa.create()),h=Fa.multiply(l,h.render.world_tsr,l),g.vehicle.tachometer_tsr=h,l=new Float32Array([1,0,0]),Fa.transform_dir_vec3(l,h,l),g.vehicle.tachometer_axis=l));for(P=0;P<d.length;P++)if(g=d[P],g.is_floating&&(a=g.floating_settings,"MAIN_BODY"==a.part))for(g.floater={},g.floater.floating_factor=a.floating_factor,g.floater.water_lin_damp=a.water_lin_damp,g.floater.water_rot_damp=a.water_rot_damp,g.floater.bobs=[],f=
(f=pa.get_dg_parent(g))?pa.get_dg_objects(f,d):d,k=0;k<f.length;k++)h=f[k],h.is_floating&&(l=h.floating_settings,ya.is_floater_bob(h)&&a.name==l.name&&(g.floater.bobs.push(h),h.bob_synchronize_pos=h.floating_settings.synchronize_position));e(b,c)}function E(a,b,c,d,e,g){for(d=0;d<a.scenes.length;d++)g=a.scenes[d],g._camera=g.camera._object;for(d=0;d<a.scenes.length;d++){g=b.is_primary?a.scenes[d]:Va;var f=b.is_primary?ja.get_scene_objs(g,"LAMP",b.id):ja.get_scene_objs(g,"LAMP",0),k=ja.get_scene_objs(g,
"ALL",b.id),h=m(b.id,g,"MESH"),l=m(b.id,g,"EMPTY");m(b.id,g,"WORLD");b.is_primary&&xa.append_scene(g,k,f,h,l);for(var k=!1,n=0;n<l.length;n++)for(var P=l[n]._object,p=P.scenes_data,t=0;t<p.length;t++){var q=p[t].scene,la=xa.update_force_scene(q,P);g.name==q.name&&(k=k||la)}b.is_primary&&g._render.water_params&&!k&&Ea.warn('Scene "'+g.name+'" has water but has no wind.');l=[];xa.set_active(g);sa.generate_main_batches(g,h,f,l);n=m(b.id,g,"LINE");sa.generate_line_batches(g,n);P=xa.get_graph(g);if(b.is_primary){k=
g._render.sky_params;n=g.world;if(k.render_sky||k.procedural_skydome)p=n._object,sa.append_sky_batch_to_world(g,k,p),sa.create_forked_batches(p,P,g);xa.generate_auxiliary_batches(g,P);(k=g._render.world_light_set)&&k.use_environment_light&&sa.append_cube_sky_batch_to_world(g,n._object)}for(n=0;n<h.length;n++)sa.create_forked_batches(h[n]._object,P,g);for(n=0;n<l.length;n++)sa.create_forked_batches(l[n],P,g),ja.objects_storage_add(l[n]);k=ja.get_scene_objs(g,"ALL",b.id);xa.assign_scene_data_subs(g,
k,f);for(n=0;n<k.length;n++)P=k[n],P.render.use_shape_keys&&ja.update_boundings(P),pa.check_inv_zup_tsr_is_needed(P)&&(P.need_inv_zup_tsr=!0)}xa.append_scene_vtex(Va,a.textures,b.id);b.is_primary&&Va._render.video_textures.length&&(b.has_video_textures=!0);d=a.materials;if((O.dds_available||O.pvr_available)&&qa.use_compression)for(a=0;a<d.length;a++){h=d[a];n=h.texture_slots;for(g=0;g<n.length;g++)if(l=n[g],P=l.texture,"IMAGE"==P.type||"ENVIRONMENT_MAP"==P.type)f=P.image,f._is_compressed||(-1<f.filepath.indexOf(".dds")?
f._is_compressed=!0:(f._is_compressed=!P.b4w_disable_compression&&!l.use_map_normal&&"ENVIRONMENT_MAP"!=P.type&&!P.b4w_shore_dist_map&&"MOVIE"!=f.source,f._is_compressed?(f._comp_method=qa.compress_format,f.filepath="dds"==qa.compress_format?f.filepath+".dds":R.split_extension(f.filepath)[0]+".pvr"):f._comp_method=""));if(g=h.node_tree)for(h=g.nodes,g=0;g<h.length;g++)f=h[g],"TEXTURE"==f.type&&(n=f.texture)&&(f=n.image)&&!f._is_compressed&&(f._is_compressed=n._render.allow_node_dds&&!n.b4w_disable_compression&&
"MOVIE"!=f.source&&"ENVIRONMENT_MAP"!=n.type,f._is_compressed?(f._comp_method=qa.compress_format,f.filepath="dds"==qa.compress_format?f.filepath+".dds":R.split_extension(f.filepath)[0]+".pvr"):f._comp_method="")}else for(a=a.images,d=0;d<a.length;d++)g=a[d],f=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds")&&".dds"==qa.compress_format),g._is_compressed=f;e(b,c)}function w(a,b,c,d,e,g){d=a.groups;g=a.objects;for(var f={},k={},h={},l={},m=0;m<d.length;m++){var n=d[m];f[n.uuid]=n;h[n.uuid]=n}for(m=
0;m<g.length;m++)n=g[m],k[n.uuid]=n,l[n.uuid]=n;a=a.scenes;for(m=0;m<a.length;m++)v(a[m].objects,null,l,h,null);for(var P in h)P in f||d.push(h[P]);for(P in l)P in k||g.push(l[P]);e(b,c)}function v(a,b,c,d,e){for(var g=[],f=0;f<a.length;f++){var k=a[f],h=c[k.uuid];if(k=h.proxy){b&&-1==g.indexOf(k.uuid)&&g.push(k.uuid);for(var l=c[k.uuid],m=l.constraints,k=0;k<m.length;k++){var n=ta.clone_object_json(m[k]);n.name+="_CLONE";h.constraints.push(n)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||
(h.animation_data&&(l.animation_data=ta.clone_object_json(h.animation_data)),l.b4w_use_default_animation=h.b4w_use_default_animation,l.b4w_auto_skel_anim=h.b4w_auto_skel_anim,l.b4w_anim_behavior=h.b4w_anim_behavior,l.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<g.length;f++)h=ta.get_index_for_key_value(a,"uuid",g[f]),-1<h&&a.splice(h,1);g={};if(b)for(f=0;f<a.length;f++)k=a[f],h=c[k.uuid],m=ta.clone_object_json(h),l="origin_name"in h?h.origin_name:h.name,m.name=pa.gen_dupli_name(b.name,
l),m.origin_name=l,m.dg_parent={uuid:b.uuid},z(m),c[m.uuid]=m,g[k.uuid]=m.uuid,k.uuid=m.uuid,e&&e[h.uuid]&&(m.b4w_cluster_data=e[h.uuid]);for(f=0;f<a.length;f++)k=a[f],h=c[k.uuid],h.dupli_group&&(k=h.dupli_group,e=d[k.uuid],m=ta.clone_object_json(e),m.name=ta.unique_name(e.name+"_CLONE"),m.uuid=ga.hexdigest("Group"+m.name),d[m.uuid]=m,k.uuid=m.uuid,v(m.objects,h,c,d,h.b4w_cluster_data));if(b)for(f=0;f<a.length;f++){k=a[f];h=c[k.uuid];h.parent&&h.parent.uuid in g?h.parent.uuid=g[h.parent.uuid]:h.parent&&
(Ea.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);m=h.constraints;for(k=0;k<m.length;k++)b=m[k],b.target&&b.target.uuid in g&&(b.target.uuid=g[b.target.uuid]);if(b=h.pose)for(d=b.bones,k=0;k<d.length;k++)if(e=d[k].constraints)for(m=0;m<e.length;m++)b=e[m],b.target&&b.target.uuid in g&&(b.target.uuid=g[b.target.uuid]);b=h.modifiers;for(k=0;k<b.length;k++)d=b[k],d.object&&d.object.uuid in g&&(d.object.uuid=g[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(k=
0;k<h.length;k++)b=h[k],b.object&&b.object.uuid in g&&(b.object.uuid=g[b.object.uuid])}for(var P in g)Da[P]=g[P]}function z(a){a.uuid=ga.hexdigest("Object"+a.name)}function y(a,b){for(var c=a.nodes,e=0;e<c.length;e++){var g=c[e];"TEXTURE"==g.type&&g.texture&&D(g,"texture",b);"LAMP"==g.type&&g.lamp&&(g.lamp.uuid in Da&&(g.lamp.uuid=Da[g.lamp.uuid]),b[g.lamp.uuid]||(g.lamp=null));"GROUP"==g.type&&g.node_group&&D(g,"node_group",b)}g=a.links;for(e=0;e<g.length;e++){var f=g[e];K(f,"from_node",c);K(f,"to_node",
c);d(f,"from_socket",f.from_node.outputs);d(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&D(c,"action",b),c.nla_tracks)for(e=0;e<c.nla_tracks.length;e++)for(g=c.nla_tracks[e],f=0;f<g.strips.length;f++)g.strips[f].action&&D(g.strips[f],"action",b)}function D(a,b,c){(c=c[a[b].uuid])||Ea.error("Dangling link found:",b,a);a[b]=c}function K(a,b,c){c=ta.keysearch("name",a[b].name,c);a[b]=c}function d(a,b,c){c=ta.keysearch("identifier",a[b].identifier,c);a[b]=c}function t(a,b,c,d,e,
g){d=da(b.filepath);for(var f=a.images,k={},l=[],m=0;m<f.length;m++){var n=f[m],P=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var p=M(n,a.textures);if(!p.length)Ea.warn("image ",n.name," has no users.");else if(!p[0].b4w_shore_dist_map){p=ta.normpath_preserve_protocol(d+n.filepath);if("FILE"===n.source){var t=n._is_compressed?R.AT_ARRAYBUFFER:R.AT_IMAGE_ELEMENT,q=R.split_extension(p),v=q[1].toLowerCase();if(!R.check_image_extension(v)){Ea.error("image ",n.name," has unsupported format.");continue}O.min50_available&&
qa.use_min50&&("dds"==q[1]?(p=R.split_extension(q[0]),p=p[0]+".min50."+p[1]+".dds"):p=q[0]+".min50."+q[1])}else if("MOVIE"===n.source)if(qa.seq_video_fallback)q=R.split_extension(p),p=q[0]+".altconv.seq",t=R.AT_SEQ_VIDEO_ELEMENT;else{var q=R.split_extension(p),v=q[1].toLowerCase(),r=La.detect_video_container(v);if(""==r){Ea.error("failed to load video file (unsupported format)",p);continue}p=r!=v?q[0]+".altconv."+r:q[0]+"."+q[1];t=R.AT_VIDEO_ELEMENT}l.push({id:P,type:t,url:p});k[P]=n}}}if(l.length){var x=
0;R.enqueue(l,function(d,e,f,m){if(d){e=k[e];if(f==R.AT_VIDEO_ELEMENT||f==R.AT_SEQ_VIDEO_ELEMENT){if(f==R.AT_VIDEO_ELEMENT)var n=d.videoWidth,P=d.videoHeight;else n=d.images[0].width,P=d.images[0].height;Ea.log("%cLOAD VIDEO "+n+"x"+P,"color: #"+(2048<n||2048<P?"a00":1024<n||1024<P?"aa0":"0a0"),m);-1==m.indexOf(eb)&&Ea.warn("video",m,"is not from app root.")}else h(d,m,!0,e._comp_method);m=M(e,a.textures);for(n=0;n<m.length;n++){var P=m[n],p=P.image.filepath;if(f==R.AT_SEQ_VIDEO_ELEMENT)P._render.seq_fps=
d.fps,la.update_texture(P._render,d.images,"",p,b.id);else if(la.update_texture(P._render,d,e._comp_method,p,b.id),"ENVIRONMENT_MAP"==P._render.source)for(P=0;P<a.scenes.length;P++)xa.update_world_texture(a.scenes[P])}}d=++x/l.length;g(b,c,d)},function(){Ea.log("%cLOADED ALL IMAGES","color: #0a0");e(b,c)})}else e(b,c)}function C(a,b,c,d,e,g){a=xa.get_rendered_scenes();for(d=0;d<a.length;d++)if(g=a[d],g.b4w_use_nla){var f=g.b4w_nla_cyclic;g.b4w_use_logic_editor&&(f=!1);X.update_scene(g,f,b.id)}e(b,
c)}function M(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function x(a,b,c,d,e,f){a=da(b.filepath);var k=[],h={};d=ja.get_all_objects(b.id);for(var l=0;l<d.length;l++){var m=d[l];if(g(m)){var n=m.sfx.uuid;"BACKGROUND_MUSIC"==La.get_spk_behavior(m)?(n=ta.gen_uuid(),b.has_background_music=!0):"NONE"!=La.get_spk_behavior(m)&&qa.init_wa_context_hack&&(b.init_wa_context=!0);if(!(n in h)){h[n]=[];var P=ta.normpath_preserve_protocol(a+m.sfx.filepath);switch(La.source_type(m)){case La.AST_ARRAY_BUFFER:var p=
R.AT_AUDIOBUFFER;break;case La.AST_HTML_ELEMENT:p=R.AT_AUDIO_ELEMENT}var t=R.split_extension(P),q=t[1].toLowerCase(),la=La.detect_audio_container(q);""!=la?(P=la!=q?t[0]+".altconv."+la:t[0]+"."+t[1],k.push({id:n,type:p,url:P})):Ea.error("failed to load audio file (unsupported format)",P)}h[n].push(m)}}if(k.length){var v=0;R.enqueue(k,function(a,d,e,g){if(a)for(Ea.log("%cLOAD SOUND","color: #0aa",g),-1==g.indexOf(eb)&&Ea.warn("sound",g,"is not from app root."),d=h[d],e=0;e<d.length;e++)La.update_spkobj(d[e],
a);a=++v/k.length;f(b,c,a)},function(){Ea.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)})}else e(b,c)}function g(a){return pa.is_speaker(a)&&La.source_type(a)!=La.AST_NONE}function H(a,b,c){a=ja.get_scene_objs(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];pa.is_speaker(d)&&(La.is_autoplay(d)||c)&&La.play_def(d)}}function G(a,b){for(var c=a._render.video_textures,d=0;d<c.length;d++){var e=c[d]._render;a.b4w_use_nla&&c[d].b4w_nla_video||!c[d].use_auto_refresh||b!=e.vtex_data_id||(la.reset_video(e.name,
b),la.play_video(e.name,b))}}function ba(a,b,c,d,e,g){X.start();Ea.log("%cSTART NLA","color: #0a0");e(b,c)}function L(a,b,c,d,e){if(b.lod_levels&&b.lod_levels.length)for(var g=b.lod_levels.length,f=0;f<g;f++){var k=b.lod_levels[f],h=k.object;if(h){var l=ta.clone_object_nr(h);l.name=b.name+"_LOD_"+String(f+1);l.b4w_cluster_data=b.b4w_cluster_data;z(l);l.lod_levels=[];c&&(l.dg_parent=c);d.push([a,l]);e.push(h);k.object=l}}}function F(a,b,c,d,e,g){d=!0;for(g=0;g<a.scenes.length;g++)if(!ya.check_worker_loaded(a.scenes[g])){d=
!1;break}d&&(e(b,c),Ea.log("%cPHYSICS READY","color: #0a0"))}function U(a,b,c,d,e,g){for(d=0;d<a.scenes.length;d++){g=a.scenes[d];if(b.is_primary)var f=ya.scene_has_physics(g);else f=ya.scene_has_physics(Va)||ya.scene_has_physics(g),g=Va;if(Ia.enabled&&f)for(f=0;f<qb.length;f++)for(var k=ja.get_scene_objs(g,qb[f],b.id),h=0;h<k.length;h++){var l=k[h];l.render.data_id==b.id&&(ya.append_object(l,g),b.load_hidden&&ya.obj_has_physics(l)&&ya.disable_simulation(l))}}e(b,c)}function Q(a,b,c,d,e,g){var f=
{};d=[];var k=a.scenes;for(g=0;g<a.scenes.length;g++){var l=k[g];if(l._render.water_params&&(l=l._render.water_params.shoremap_image)&&"FILE"===l.source){var m=l.uuid,n=da(b.filepath),n=ta.normpath_preserve_protocol(n+l.filepath);d.push({id:m,type:l._is_compressed?R.AT_ARRAYBUFFER:R.AT_IMAGE_ELEMENT,url:n});f[m]=l}}d.length?R.enqueue(d,function(c,d,e,g){if(c){h(c,g,!0);d=f[d];g=M(d,a.textures);for(e=0;e<g.length;e++){var l=g[e],m=l.image.filepath,n="";d._is_compressed&&(n=-1!=m.indexOf(".dds")?"dds":
"pvr");la.update_texture(l._render,c,n,m,b.id)}for(e=0;e<k.length;e++)if(g=k[e],g._render.water_params&&(l=g._render.water_params.shoremap_image,l===d)){var m=c,n=d,P=document.createElement("canvas"),l=n.size[0],n=n.size[1];P.width=l;P.height=n;P=P.getContext("2d");P.drawImage(m,0,0);m=P.getImageData(0,0,l,n).data;P=new Float32Array(4);P[0]=1/16581375;P[1]=1/65025;P[2]=1/255;P[3]=1;for(var l=l*n,n=new Float32Array(l),p=0;p<l;p++)n[p]=P[1]*m[4*p+2]+P[2]*m[4*p+3];g._render.shore_distances=n}}else for(d=
f[d],e=0;e<k.length;e++)g=k[e],l=g._render.water_params.shoremap_image,l===d&&(g._render.water_params.shoremap_image=null,Ea.warn("image",l.filepath," was not found. Disabling water shore effects."))},function(){e(b,c)}):e(b,c)}function T(a,b,c,d,e,g){d=a.scenes[0];a=[];var f=[P.SMAA_EDGE_DETECTION,P.SMAA_BLENDING_WEIGHT_CALCULATION,P.SMAA_NEIGHBORHOOD_BLENDING,P.SMAA_RESOLVE];for(g=0;g<f.length;g++){var k=xa.get_subs(d,f[g]);k&&a.push(k)}if(a.length){d=[];da(b.filepath);g=R.AT_IMAGE_ELEMENT;d.push({id:"SEARCH_TEXTURE",
type:g,filepath:va.paths.smaa_search_texture_path});d.push({id:"AREA_TEXTURE",type:g,url:va.paths.smaa_area_texture_path});for(g=0;g<a.length;g++)if(f=a[g],f.type==P.SMAA_BLENDING_WEIGHT_CALCULATION){a=f.slinks_internal;for(g=0;g<a.length;g++)if(f=a[g],"u_search_tex"==f.to)var l=f.texture;else if("u_area_tex"==f.to)var m=f.texture;break}d.length?R.enqueue(d,function(a,c,d,e){a&&(h(a,e,!1),c="SEARCH_TEXTURE"==c?l:m,c.source="IMAGE",c.auxilary_texture=!0,d=-1!=e.indexOf(".dds")?1:0,la.update_texture(c,
a,d,e,b.id),la.set_filters(c,la.TF_LINEAR,la.TF_LINEAR))},function(){e(b,c)}):e(b,c)}else e(b,c)}function W(a,b,c,d,e,g){for(c=0;c<a.scenes.length;c++){e=a.scenes[c];b.is_primary||(e=Va);var f=ja.get_scene_objs(e,"LAMP",b.id);for(g=0;g<f.length;g++){var k=f[g];k.render.data_id==b.id&&d.added_objects.push({scene:e,obj:k})}f=ja.get_scene_objs(e,"ALL",b.id);for(g=0;g<f.length;g++)k=f[g],"LAMP"!=k.type&&k.render.data_id==b.id&&(b.load_hidden&&pa.is_mesh(k)&&xa.change_visibility(k,!0),d.added_objects.push({scene:e,
obj:k}))}}function ha(a,b,c,d,e,g){var f=d.added_objects;e=d.obj_counter;if(f.length){a=f[e].obj;var k=f[e].scene;e=pa.get_scene_data(a,k);xa.append_object(k,a,!1);!a.anchor||k._render.hmd_stereo_use||k._render.anaglyph_use||ra.append(a);d=++d.obj_counter/f.length;f=e.cube_refl_subs;if(-1!=a.render.cube_reflection_id&&f){var h=Ka.copy(a.render.bs_world.center,$b);xa.update_cube_reflect_subs(f,h)}f=a.reflective_objs;if(f.length&&k._render.reflection_params)for(k=Fa.get_trans_view(a.render.world_tsr),
a=Fa.get_quat_view(a.render.world_tsr),e=e.plane_refl_subs,h=0;h<e.length;h++)xa.update_plane_reflect_subs(e[h],k,a),pa.update_refl_objects(f,e[h].camera.reflection_plane)}else d=1;g(b,c,d)}function Y(a,b,c,d,e,g){if(b.is_primary){d=xa.get_main();xa.update_world_texture(d);g=xa.get_rendered_scenes();for(a=0;a<g.length;a++){var f=g[a];xa.update_world_texture(f);xa.prepare_rendering(f,d)}xa.set_active(d)}else xa.update_scene_permanent_uniforms(Va);d=ja.get_all_objects(b.id);ja.update_objects_dynamics(d);
for(g=0;g<d.length;g++)for(f=d[g],a=0;a<f.scenes_data.length;a++)for(var k=f.scenes_data[a].batches,h=0;h<k.length;h++)null==k[h].shader&&k.splice(h--,1);e(b,c)}function Z(a,b,c,d,e,g){if(b.is_primary)for(a=xa.get_rendered_scenes(),d=0;d<a.length;d++)g=a[d],g.b4w_use_logic_editor&&ea.init_logic(g,b.id);e(b,c)}function N(a,b,c,d,e,g){if(b.is_primary)for(d=0;d<a.scenes.length;d++)G(a.scenes[d],b.id),H(a.scenes[d],b.id,!1);else G(Va,b.id),H(Va,b.id,!1);e(b,c)}function ca(a,b,c,d,e,g){for(d=0;d<a.scenes.length;d++)a.scenes[d].camera=
null;qa.media_auto_activation&&(b.has_video_textures||b.has_background_music||b.init_wa_context)?db||I(a,e,b,c):e(b,c)}function I(a,b,c,d){var e=Pa.parentElement;Vb=e.style.zIndex;e.style.zIndex="999";db=document.createElement("div");db.style.position="relative";db.style.height="88px";db.style.width="88px";var g=Math.round(Pa.offsetHeight/2-44),f=Math.round(Pa.offsetWidth/2-44);db.style.top=g.toString()+"px";db.style.left=f.toString()+"px";db.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
db.style.backgroundSize="88px";Qa=document.createElement("div");Qa.style.position="relative";Qa.style.height=Pa.offsetHeight.toString()+"px";Qa.style.width=Pa.offsetWidth.toString()+"px";Qa.style.background="rgba(0, 0, 0, 0.5)";Qa.style.zIndex="999";e.appendChild(Qa);Qa.appendChild(db);db.addEventListener("click",function(){c.has_video_textures&&(la.play(),la.pause(),la.reset());if(c.has_background_music){if(c.is_primary)for(var e=0;e<a.scenes.length;e++)H(a.scenes[e],c.id,!0);else H(Va,c.id,!0);
La.pause()}c.init_wa_context&&La.play_empty_sound();ma();b(c,d)},!1)}function ma(){if(db){var a=Pa.parentElement;a.style.zIndex=Vb;Qa.removeChild(db);a.removeChild(Qa);db=Qa=null;Vb=0}}function da(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function fa(a){S.is_animated(a)&&S.remove(a);aa.remove_obj_from_cache(a);ja.clear_outline_anim(a);ua.check_sensor_manifold(a)&&ua.remove_sensor_manifold(a);ya.obj_has_physics(a)&&ya.remove_object(a);xa.remove_object_bundles(a);pa.is_speaker(a)&&
La.speaker_remove(a);ra.is_anchor(a)&&ra.remove(a)}function Aa(a){var b=S.get_bpy_armobj(a);a=b&&b.parent==a?null:a.parent||b;return a?1+Aa(a):0}var ra=r("__anchors"),S=r("__animation"),R=r("__assets"),sa=r("__batch"),va=r("__config"),ua=r("__controls"),J=r("__texcomp"),na=r("__debug"),za=r("__extensions"),V=r("__input"),wa=r("__loader"),ga=r("__md5"),X=r("__nla"),ea=r("__logic_nodes"),aa=r("__particles"),Ga=r("__nodemat"),ja=r("__objects"),pa=r("__obj_util"),ya=r("__physics"),Ea=r("__print"),Ca=
r("__quat"),ia=r("__reformer"),oa=r("__renderer"),xa=r("__scenes"),La=r("__sfx"),Ha=r("__shaders"),P=r("__subscene"),la=r("__textures"),Ba=r("__time"),Ma=r("__transform"),Fa=r("__tsr"),ta=r("__util"),Ka=r("__vec3"),ka=r("__vec4"),Za=va.animation,qa=va.defaults,O=va.assets,Ia=va.physics,Sa=va.sfx,Ja=null,Ta=null,eb="",Va=null,Da={},$b=new Float32Array(3),nb=new Float32Array(4),sb=new Float32Array(4),Lb=new Float32Array(4),db=null,Qa=null,Vb=0,ac=!1,Dc=["LAMP","CAMERA"],qb=["MESH","CAMERA","EMPTY"],
Pa=null;a.is_primary_loaded=function(a){return wa.is_primary_loaded(a)};a.update=function(){wa.update_scheduler(Ja)};a.setup_canvas=function(a){Pa=a};a.update_media_controls=function(a,b){if(db){Qa.style.height=b.toString()+"px";Qa.style.width=a.toString()+"px";var c=Math.round(b/2-44),d=Math.round(a/2-44);db.style.top=c.toString()+"px";db.style.left=d.toString()+"px"}};a.load=function(a,c,d,e,g){var k={load_main:{priority:wa.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,
primary_only:!1,cb_before:b},duplicate_objects:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:w},load_binaries:{priority:wa.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:f},wait_for_shaders:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:50,primary_only:!0,cb_loop:l},prepare_bindata:{priority:wa.SYNC_PRIORITY,
background_loading:!1,inputs:["duplicate_objects","load_binaries"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:q},prepare_bpy_data:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","prepare_bindata"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:p},process_objects:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["prepare_bpy_data"],is_resource:!1,relative_size:150,primary_only:!1,cb_before:A},process_scenes:{priority:wa.SYNC_PRIORITY,
background_loading:!1,inputs:["process_objects","wait_for_shaders"],is_resource:!1,relative_size:300,primary_only:!1,cb_before:E},load_smaa_textures:{priority:wa.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:T},load_shoremap:{priority:wa.ASYNC_PRIORITY,background_loading:!1,inputs:["process_scenes"],is_resource:!1,relative_size:30,primary_only:!0,cb_before:Q},load_textures:{priority:wa.ASYNC_PRIORITY,background_loading:!0,
inputs:["process_scenes"],is_resource:!0,relative_size:500,primary_only:!1,cb_before:t},update_scenes_nla:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["process_scenes","load_textures"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:C},wait_physics_workers:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["load_shoremap"],is_resource:!1,relative_size:20,primary_only:!1,cb_loop:F},add_physics_objects:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["wait_physics_workers"],
is_resource:!1,relative_size:50,primary_only:!1,cb_before:U},add_objects:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["add_physics_objects"],is_resource:!1,relative_size:600,primary_only:!1,cb_before:W,cb_loop:ha,cb_after:Y,cb_param:{added_objects:[],obj_counter:0}},init_logic_nodes:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["update_scenes_nla","add_objects"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:Z},load_speakers:{priority:wa.ASYNC_PRIORITY,background_loading:!0,
inputs:["add_objects"],is_resource:!0,relative_size:100,primary_only:!1,cb_before:x},mobile_media_start:{priority:wa.SYNC_PRIORITY,background_loading:!1,inputs:["load_textures","update_scenes_nla","load_speakers","init_logic_nodes"],is_resource:!0,relative_size:5,primary_only:!1,cb_before:ca,cb_loop:ca},synchronize_media:{priority:wa.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!0,relative_size:50,primary_only:!1,cb_before:N},start_nla:{priority:wa.SYNC_PRIORITY,background_loading:!0,
inputs:["mobile_media_start"],is_resource:!1,relative_size:5,primary_only:!0,cb_before:ba}},h=wa.get_scheduler();h||(h=wa.create_scheduler(),Ja={},Ta={},Da={});Ja[h.threads.length]={};return wa.create_thread(k,a,c,d,u,e||Sa.audio_loading_hack,qa.do_not_load_resources,g)};a.unload=function(a){var b=wa.get_scheduler();if(!b||!b.threads.length||a&&!wa.thread_is_finished(b.threads[a]))Ea.error("Unable to unload data!");else{if(0==a)Ea.log("%cUNLOAD ALL","color: #00a"),ra.cleanup(),S.cleanup(),La.cleanup(),
X.cleanup(),sa.cleanup(),xa.cleanup(),wa.cleanup(),ua.cleanup(),ya.cleanup(),ja.cleanup(),ta.cleanup(),oa.cleanup(),Ga.cleanup(),Ha.cleanup(),za.cleanup(),R.cleanup(),la.cleanup(),ea.cleanup(),aa.cleanup(),V.cleanup(),na.cleanup(),Ta=null,Da={},Ja=Va=null,ac=!1;else{Ea.log("%cUNLOAD DATA "+a,"color: #00a");S.remove_actions(a);for(var b=ja.get_all_objects(ja.DATA_ID_ALL),c=0;c<b.length;c++){var d=b[c];pa.get_object_data_id(d)!=a&&ja.obj_switch_cleanup_flags(d,!1,!1,!1,!1)}b=ja.get_all_objects(a);for(c=
b.length-1;0<=c;c--)d=b[c],fa(d),ja.remove_object(d);b=ja.get_all_objects(ja.DATA_ID_ALL);for(c=0;c<b.length;c++)ja.obj_switch_cleanup_flags(b[c],!0,!0,!0,!0)}ma()}};a.prepare_object_unloading=fa;a.set_debug_resources_root=function(a){eb=a};a.activate_media=function(){ac||qa.media_auto_activation||(la.play(),la.pause(),la.reset(),H(Va,ja.DATA_ID_ALL,!0),La.pause(),qa.init_wa_context_hack&&La.play_empty_sound(),ac=!0)};a.reset=function(){Pa=null}};b4w.module.__batch=function(a,r){function u(a){a={type:a,subtype:"",id:0,render_id:0,cluster_id:-1,odd_id_prop:"",debug_id_color:-1,debug_main_batch_id:-1,debug_main_batch_render_time:0,debug_render_time:0,debug_render_time_queries:[],textures:[],texture_names:[],material_names:[],common_attributes:[],uv_maps_usage:null,vertex_colors_usage:{},shader:null,shaders_info:{vert:null,frag:null,directives:[],node_elements:[],status:na.VALID,frag_uniform_count:0,vert_uniform_count:0,attribute_count:0,texture_count:0},
ngraph_proxy_id:"",attribute_setters:[],bufs_data:null,vaos:X.create_non_smi_array(),use_shape_keys:!1,debug_sphere:!1,debug_sphere_dynamic:!1,num_vertices:0,num_triangles:0,jitter_amp:0,jitter_freq:0,grass_scale_threshold:0,grass_size:0,grass_map_dim:new Float32Array(3),cube_fog:new Float32Array(16),alpha_clip:!1,blend:!1,depth_mask:!1,xray:!1,use_backface_culling:!1,use_shadeless:!1,dynamic_geometry:!1,shadow_cast:!1,shadow_cast_only:!1,shadow_receive:!1,reflexible:!1,reflexible_only:!1,reflective:!1,
dynamic_grass:!1,draw_proc_sky:!1,draw_mode:ga.DM_DEFAULT,z_sort:!1,forked_batch:!1,halo:!1,halo_size:0,halo_hardness:0,halo_stars_blend:0,halo_stars_height:0,halo_rings_color:new Float32Array(3),halo_lines_color:new Float32Array(3),halo_particles:!1,ambient:0,emit:0,diffuse_intensity:1,reflect_factor:0,specular_color_factor:0,specular_alpha:1,parallax_scale:0,diffuse_color_factor:0,alpha_factor:1,normal_factor:0,mirror_factor:0,offset_z:0,refr_bump:0,diffuse_params:Array(2),specular_params:new Float32Array(3),
texture_scale:new Float32Array(3),specular_color:new Float32Array(3),diffuse_color:new Float32Array(4),fresnel_params:new Float32Array(4),lamp_uuid_indexes:null,lamp_light_positions:null,lamp_light_directions:null,lamp_light_color_intensities:null,has_nodes:!1,wireframe_edge_color:ea.create(),water:!1,water_dynamic:!1,water_shore_smoothing:!1,water_generated_mesh:!1,water_num_cascads:0,water_subdivs:0,water_detailed_dist:0,water_norm_uv_velocity:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,
foam_uv_freq:new Float32Array(2),foam_mag:new Float32Array(2),foam_scale:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),normalmap_scales:null,refractive:!1,particles_data:null,line_width:0,anchor_positions:null,part_use_tangent:!1,part_node_data:null,node_values:[],node_value_inds:[],node_rgbs:[],node_rgb_inds:[],bb_local:null,bb_world:null,bs_local:null,bs_world:null,be_world:null,be_local:null,use_be:!1,cleanup_gl_data_on_unload:!0,shader_updated:!1,
inst_array_state:0,navmesh:null};a.diffuse_color[3]=1;a.depth_mask=!0;a.line_width=1;return a}function h(a){var b=u(a.type);b.subtype=a.subtype;b.id=a.id;b.render_id=a.render_id;b.cluster_id=a.cluster_id;b.odd_id_prop=a.odd_id_prop;b.debug_id_color=a.debug_id_color;b.debug_main_batch_id=a.debug_main_batch_id;b.debug_main_batch_render_time=a.debug_main_batch_render_time;b.debug_render_time=a.debug_render_time;b.debug_render_time_queries=[];b.textures=a.textures.slice();b.texture_names=a.texture_names.slice();
b.material_names=a.material_names.slice();b.common_attributes=a.common_attributes.slice();b.uv_maps_usage=X.clone_object_r(a.uv_maps_usage);b.vertex_colors_usage=X.clone_object_r(a.vertex_colors_usage);b.shader=a.shader;b.shaders_info=X.clone_object_r(a.shaders_info);b.ngraph_proxy_id=a.ngraph_proxy_id;b.attribute_setters=ua.clone_attribute_setters(a.attribute_setters);b.bufs_data=a.bufs_data;b.use_shape_keys=a.use_shape_keys;b.debug_sphere=a.debug_sphere;b.debug_sphere_dynamic=a.debug_sphere_dynamic;
b.num_vertices=a.num_vertices;b.num_triangles=a.num_triangles;b.jitter_amp=a.jitter_amp;b.jitter_freq=a.jitter_freq;b.grass_scale_threshold=a.grass_scale_threshold;b.grass_size=a.grass_size;b.grass_map_dim=a.grass_map_dim;b.cube_fog=a.cube_fog;b.alpha_clip=a.alpha_clip;b.blend=a.blend;b.depth_mask=a.depth_mask;b.xray=a.xray;b.use_backface_culling=a.use_backface_culling;b.use_shadeless=a.use_shadeless;b.dynamic_geometry=a.dynamic_geometry;b.shadow_cast=a.shadow_cast;b.shadow_cast_only=a.shadow_cast_only;
b.shadow_receive=a.shadow_receive;b.reflexible=a.reflexible;b.reflexible_only=a.reflexible_only;b.reflective=a.reflective;b.dynamic_grass=a.dynamic_grass;b.draw_proc_sky=a.draw_proc_sky;b.draw_mode=a.draw_mode;b.z_sort=a.z_sort;b.forked_batch=a.forked_batch;b.halo=a.halo;b.halo_size=a.halo_size;b.halo_hardness=a.halo_hardness;b.halo_stars_blend=a.halo_stars_blend;b.halo_stars_height=a.halo_stars_height;ea.copy(a.halo_rings_color,b.halo_rings_color);ea.copy(a.halo_lines_color,b.halo_lines_color);b.halo_particles=
a.halo_particles;b.ambient=a.ambient;b.emit=a.emit;b.diffuse_intensity=a.diffuse_intensity;b.reflect_factor=a.reflect_factor;b.specular_color_factor=a.specular_color_factor;b.specular_alpha=a.specular_alpha;b.parallax_scale=a.parallax_scale;b.diffuse_color_factor=a.diffuse_color_factor;b.alpha_factor=a.alpha_factor;b.normal_factor=a.normal_factor;b.mirror_factor=a.mirror_factor;b.offset_z=a.offset_z;b.refr_bump=a.refr_bump;b.diffuse_params=a.diffuse_params.slice();ea.copy(a.specular_params,b.specular_params);
ea.copy(a.texture_scale,b.texture_scale);ea.copy(a.specular_color,b.specular_color);aa.copy(a.diffuse_color,b.diffuse_color);aa.copy(a.fresnel_params,b.fresnel_params);b.lamp_uuid_indexes=X.clone_object_r(a.lamp_uuid_indexes);a.lamp_light_positions&&(b.lamp_light_positions=new Float32Array(a.lamp_light_positions),b.lamp_light_directions=new Float32Array(a.lamp_light_directions),b.lamp_light_color_intensities=new Float32Array(a.lamp_light_color_intensities));b.has_nodes=a.has_nodes;ea.copy(a.wireframe_edge_color,
b.wireframe_edge_color);b.water=a.water;b.water_dynamic=a.water_dynamic;b.water_shore_smoothing=a.water_shore_smoothing;b.water_generated_mesh=a.water_generated_mesh;b.water_num_cascads=a.water_num_cascads;b.water_subdivs=a.water_subdivs;b.water_detailed_dist=a.water_detailed_dist;b.water_norm_uv_velocity=a.water_norm_uv_velocity;b.shallow_water_col_fac=a.shallow_water_col_fac;b.shore_water_col_fac=a.shore_water_col_fac;b.foam_factor=a.foam_factor;b.foam_uv_freq.set(a.foam_uv_freq);b.foam_mag.set(a.foam_mag);
b.foam_scale.set(a.foam_scale);ea.copy(a.shallow_water_col,b.shallow_water_col);ea.copy(a.shore_water_col,b.shore_water_col);b.normalmap_scales=X.clone_object_r(a.normalmap_scales);b.refractive=a.refractive;b.particles_data=X.clone_object_r(a.particles_data);b.line_width=a.line_width;a.anchor_positions&&(b.anchor_positions=new Float32Array(a.anchor_positions));b.part_use_tangent=a.part_use_tangent;b.part_node_data=X.clone_object_r(a.part_node_data);b.node_values=X.clone_object_r(a.node_values);b.node_value_inds=
X.clone_object_r(a.node_value_inds);b.node_rgbs=X.clone_object_r(a.node_rgbs);b.node_rgb_inds=X.clone_object_r(a.node_rgb_inds);b.bb_local=N.clone_bb(a.bb_local);b.bb_world=N.clone_bb(a.bb_world);b.be_local=N.clone_be(a.be_local);b.be_world=N.clone_be(a.be_world);b.bs_local=N.clone_bs(a.bs_local);b.bs_world=N.clone_bs(a.bs_world);b.use_be=a.use_be;b.cleanup_gl_data_on_unload=a.cleanup_gl_data_on_unload;b.shader_updated=a.shader_updated;return b}function b(a){switch(a.type){case "MAIN":case "PARTICLES":case "LINE":a.subtype=
a.blend?a.xray?"XRAY":"BLEND":"OPAQUE";break;case "SHADOW":a.subtype=a.shadow_cast_only?"CAST":"RECEIVE";break;case "COLOR_ID":a.subtype=a.xray?"COLOR_ID_XRAY":"COLOR_ID"}}function f(a,b){for(var c=[],d=0;d<a.length;d++){var g=a[d],f=g._object.render,k=N.create_bb();N.copy_bb(f.bb_original,k);var h=g.data.b4w_boundings,l=h.bc_rad,m=h.bs_rad,n=h.bs_cen,p=h.be_ax,t=h.caxis_x,v=h.caxis_y,r=h.caxis_z,h=h.be_cen;f.billboard&&(t=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),v=Math.max(Math.abs(k.max_y),
Math.abs(k.min_y)),r=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),r=Math.sqrt(t*t+v*v+r*r),t=Math.sqrt(t*t+v*v),k.max_x=k.max_y=k.max_z=r,k.min_x=k.min_y=k.min_z=-r,l=t,m=r,n[0]=n[1]=n[2]=0,t=[r,0,0],v=[0,r,0],r=[0,0,r],p[0]=p[1]=p[2]=1,h[0]=h[1]=h[2]=0);N.bounding_box_transform(k,f.world_tsr,f.bb_world);e(f,l,l,k);n=N.bs_from_values(m,X.f32(n));N.bounding_sphere_transform(n,f.world_tsr,f.bs_world);h=N.be_from_values(t,v,r,h);ea.scale(h.axis_x,p[0],h.axis_x);ea.scale(h.axis_y,p[1],h.axis_y);ea.scale(h.axis_z,
p[2],h.axis_z);N.bounding_ellipsoid_transform(h,f.world_tsr,f.be_world);f.bb_local=k;f.bs_local=n;f.be_local=h;c.push.apply(c,q(g,f,b))}return c}function l(a,b){for(var c=[],d=[],e={},g=0;g<a.length;g++){var f=a[g],k=f._object.render,h=N.create_bb();N.copy_bb(k.bb_original,h);var l=N.bounding_box_transform(h,k.world_tsr),m=f.data.b4w_boundings,n=N.bs_from_values(m.bs_rad,X.f32(m.bs_cen)),p=N.bounding_sphere_transform(n,k.world_tsr),v=m.be_ax,v=N.be_from_values([v[0],0,0],[0,v[1],0],[0,0,v[2]],m.be_cen),
r=N.bounding_ellipsoid_transform(v,k.world_tsr),x=m.rbb,m=N.rot_bb_from_values(x.rbb_c,m.caxis_x,m.caxis_y,m.caxis_z,x.rbb_s),x=N.bounding_rot_box_transform(m,k.world_tsr);k.bb_local=h;k.bb_world=l;k.bs_local=n;k.bs_world=p;k.be_local=v;k.be_world=r;k.bbr_local=m;k.bbr_world=x;h={};h.shadow_cast=k.shadow_cast;h.shadow_cast_only=k.shadow_cast_only;h.shadow_receive=k.shadow_receive;h.selectable=k.selectable;h.origin_selectable=k.origin_selectable;h.outlining=k.outlining;h.origin_outlining=k.origin_outlining;
h.outline_anim_settings_default=k.outline_anim_settings_default;h.reflexible=k.reflexible;h.reflexible_only=k.reflexible_only;h.reflective=k.reflective;h.cube_reflection_id=k.cube_reflection_id;h.plane_reflection_id=k.plane_reflection_id;h.reflection_type=k.reflection_type;h.caustics=k.caustics;h.wind_bending=k.wind_bending;h.main_bend_col=k.main_bend_col;h.detail_bend_col=k.detail_bend_col;h.billboard=k.billboard;h.billboard_type=k.billboard_type;h.billboard_spherical=k.billboard_spherical;h.dynamic_grass=
k.dynamic_grass;h.do_not_cull=k.do_not_cull;h.disable_fogging=k.disable_fogging;h.dynamic_geometry=k.dynamic_geometry;h.cluster_id=f.b4w_cluster_data.cluster_id;h.lod_dist_max=k.lod_dist_max;h.lod_dist_min=k.lod_dist_min;h.lod_transition_ratio=k.lod_transition_ratio;h.do_not_render=k.do_not_render;k=JSON.stringify(h);e[k]=e[k]||[];e[k].push(f)}for(var B in e){h=JSON.parse(B);delete h.cluster_id;var f=e[B],k=ra.create_render("STATIC"),w;for(w in h)k[w]=h[w];k.data_id=a[0]._object.render.data_id;k.wind_bending_amp=
0;k.wind_bending_freq=0;k.detail_bending_freq=0;k.detail_bending_amp=0;k.branch_bending_amp=0;k.hide=!1;for(g=0;g<f.length;g++)h=f[g]._object,0==g?(N.copy_bb(h.render.bb_world,k.bb_world),N.copy_bs(h.render.bs_world,k.bs_world)):(N.expand_bounding_box(k.bb_world,h.render.bb_world),N.expand_bounding_sphere(k.bs_world,h.render.bs_world));k.be_world=N.create_be();k.be_local=N.create_be();N.copy_bb(k.bb_world,k.bb_local);N.copy_bs(k.bs_world,k.bs_local);d.push({render:k,bpy_objects:f})}for(e=0;e<d.length;e++)for(g=
d[e].render,B=d[e].bpy_objects,w=0;w<B.length;w++){f=B[w];k=f._object.render;h=q(f,g,b);l=wa.create();k.billboard&&!k.billboard_pres_glob_orientation?(n=wa.get_trans_view(k.world_tsr),wa.set_trans(n,l)):wa.copy(k.world_tsr,l);n={};if(g.wind_bending||g.billboard)n.au_center_pos=[l[0],l[1],l[2]];g.wind_bending&&(n.au_wind_bending_amp=[k.wind_bending_amp],n.au_wind_bending_freq=[f.b4w_wind_bending_freq],n.au_detail_bending_amp=[f.b4w_detail_bending_amp],n.au_detail_bending_freq=[f.b4w_detail_bending_freq],
n.au_branch_bending_amp=[f.b4w_branch_bending_amp]);for(p=0;p<h.length;p++)m=h[p].render,v=h[p].submesh,r=h[p].batch,m.is_hair_particles?v.instanced_array_data||(m.billboard?ga.submesh_apply_particle_transform(v,l):ga.submesh_apply_transform(v,l)):("COLOR_ID"==r.type&&(h[p].render=k,r.odd_id_prop=f.uuid,t(r,k),m=F(k),L(r,m)),v=ga.submesh_apply_transform(v,l),ga.submesh_apply_params(v,n));c.push.apply(c,h)}return c}function q(a,b,c){var d=[],e=n(c,b,!b.do_not_render,!1),f=F(b),k=a.data,h=k.materials,
l=Array(h.length),m=Array(h.length),q=[],v=J.find_subs(c,za.MAIN_OPAQUE),r=!1;v&&(r=v.light_positions.length?!0:!1);for(var B=0;B<e.length;B++)for(var w=e[B],ia=0;ia<h.length;ia++){var z=h[ia];if(!ga.has_empty_submesh(k,ia))if("PHYSICS"==w&&a.b4w_collision&&"NAVMESH"==a.game.physics_type)q.push(ga.extract_submesh(k,ia,[],b.bone_skinning_info,{},null));else if(!z.b4w_lens_flares||r){var A=u(w);"MAIN"==w?l[ia]=A:"DEBUG_VIEW"==w&&(m[ia]=A);A.cluster_id=a.b4w_cluster_data.cluster_id;if(ba(A,z)){"SHADOW"==
w&&l[ia]&&(A.use_shadeless=l[ia].use_shadeless);A.draw_mode=b.use_shape_keys||b.dynamic_geometry?ga.DM_DYNAMIC_TRIANGLES:ga.DM_DEFAULT;t(A,b);for(var C=A,y=a.particle_systems,H=0;H<y.length;H++){var E=y[H].settings.b4w_vcol_from_name,xa=y[H].settings.b4w_vcol_to_name;""!==E&&""!==xa&&(C.vertex_colors_usage[E]={generate_buffer:!1,src:[{name:E,mask:7}]})}"DYNAMIC"==b.type&&(A.odd_id_prop=a.uuid);L(A,f);var Ha=ga.extract_submesh(k,ia,A.common_attributes,b.bone_skinning_info,A.vertex_colors_usage,A.uv_maps_usage);
!z.use_tangent_shading||"a_shade_tangs"in Ha.va_frames[0]||(g(A,"CALC_TBN",1),x(A,"a_tbn_quat"));z.b4w_lens_flares&&(Ha=S.prepare_lens_flares(Ha));d.push({batch:A,submesh:Ha,mat_names:[z.name],render:b,rel_bpy_objects:[a]})}}}if(q.length){A=u("PHYSICS");A.subtype="NAVMESH";A.odd_id_prop=a.uuid;L(A,f);for(var Ha=ga.submesh_list_join(q),D=[],B=0;B<h.length;B++)D.push(h[B].name);d.push({batch:A,submesh:Ha,mat_names:D,render:b,rel_bpy_objects:[a]})}for(B=0;B<m.length;B++)m[B]&&(m[B].debug_main_batch_id=
l[B].id,L(m[B],m[B].render_id));var oa=a.particle_systems;if(0<oa.length&&d.length){for(var W=!1,M=!1,B=0;B<oa.length;B++){var U=oa[B],K=U.settings;K.use_render_emitter&&(W=!0);"HAIR"!=K.type||"OBJECT"!=K.render_type&&"GROUP"!=K.render_type&&U.transforms.length||(M=!0);if(W&&M)break}var La=d[0].batch.vertex_colors_usage;if(M)if(1<h.length){for(var Q,pa={},T=0;T<oa.length;T++){var Y=oa[T].settings;if("HAIR"==Y.type&&("OBJECT"==Y.render_type||"GROUP"==Y.render_type)){var ha=Y.b4w_vcol_from_name,Ea=
Y.b4w_vcol_to_name;""!==ha&&""!==Ea&&(pa[ha]=X.clone_object_r(La[ha]))}}"a_bending_col_main"in La&&(pa.a_bending_col_main=X.clone_object_r(La.a_bending_col_main));"a_bending_col_detail"in La&&(pa.a_bending_col_detail=X.clone_object_r(La.a_bending_col_detail));Q=ga.extract_submesh_all_mats(k,[],pa)}else Q=d[0].submesh;else Q=null;for(var N=Q,ya=a._object,Z=[],ua=a.particle_systems,Ca=a.data,fa=0;fa<ua.length;fa++){var R=ua[fa],ca=R.settings;if(ca.count)if("EMITTER"==ca.type){if("DYNAMIC"==b.type){var V=
u("PARTICLES");V.bs_local=b.bs_local;V.bb_local=b.bb_local;V.be_local=b.be_local;V.bs_world=b.bs_world;V.bb_world=b.bb_world;V.be_world=b.be_world;var ma,Aa=Ca.materials,da=R.settings.material-1;da>=Aa.length&&(I.warn('Wrong material used for rendering particle system "'+R.name+'"'),da=0);ma=Aa[da];"HALO"===R.settings.render_type&&"HALO"===ma.type&&(V.halo_particles=!0);p(V,ma);var sa=V,aa=a,ja=R.settings;switch(ja.b4w_billboard_align){case "VIEW":g(sa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;
case "XY":g(sa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":g(sa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":g(sa,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:X.panic("Wrong billboard align value")}g(sa,"BILLBOARD",0);var ic=ja.b4w_enable_soft_particles&&ra.check_obj_soft_particles_accessibility(aa,ja);g(sa,"SOFT_PARTICLES",0<ja.b4w_particles_softness&&ic&&Ga.depth_tex_available?1:0);g(sa,"SOFT_STRENGTH",na.glsl_value(ja.b4w_particles_softness));na.set_directive(sa.shaders_info,
"WORLD_SPACE","WORLD"==ja.b4w_coordinate_system?1:0);V.dynamic_geometry=!0;V.odd_id_prop=ya.name+"_"+ca.uuid;L(V,f);S.init_particles_data(V,R,ma);var ob=S.generate_emitter_particles_submesh(V,Ca,R,ya.render);S.update_particles_submesh(ob,V,ca.count,ma);S.update_particles_objs_cache(ya);t(V,ya.render);Z.push({batch:V,submesh:ob,mat_names:[ma.name],render:b,rel_bpy_objects:[a]})}}else if("HAIR"==ca.type){var wc=X.init_rand_r_seed(R.seed);ca.b4w_dynamic_grass&&(b.do_not_cull=!0);var Bb=va.check_particles_bin_format(Ga.loaded_data_version)&&
!ca.b4w_initial_rand_rotation&&!ca.b4w_hair_billboard,ib=4;Bb&&(ib=8);if(R.transforms.length)var ab=R.transforms;else for(var cc=ga.geometry_random_points(N,ca.count,!1,wc),ab=new Float32Array(cc.length*ib),Wa=0;Wa<cc.length;Wa++){var Tc=.75+.5*X.rand_r(wc);ab[Wa*ib]=cc[Wa][0];ab[Wa*ib+1]=cc[Wa][1];ab[Wa*ib+2]=cc[Wa][2];ab[Wa*ib+3]=Tc;Bb&&(ab[Wa*ib+4]=1,ab[Wa*ib+5]=0,ab[Wa*ib+6]=0,ab[Wa*ib+7]=0)}var jc=J.find_subs(c,za.GRASS_MAP)?!0:!1;if("OBJECT"==ca.render_type){var Mb=[n(c,ca.dupli_object._object.render,
!b.do_not_render,!0)],dc=G(a,b,La,N,[ca.dupli_object],Mb,[ab],ca,R,jc,wc,!1);Z.push.apply(Z,dc)}else if("GROUP"==ca.render_type){for(var Rb=ca.dupli_group.objects,Mb=[],Wa=0;Wa<Rb.length;Wa++){var Kc=n(c,Rb[Wa]._object.render,!b.do_not_render,!0);Mb.push(Kc)}for(var kc=!1,rb=[],Wa=0;Wa<Rb.length;Wa++)rb.push(Rb[Wa]._object);if(ca.use_whole_group){for(var xc,xb=ab,Xb=rb,lc=Bb,Yc=ib,pb={},$a=new Float32Array([0,0,0,1]),bb=0;bb<xb.length;bb+=Yc)for(var Cb=0;Cb<Xb.length;Cb++){var Nb=ea.create(),Sb=wa.get_scale(Xb[Cb].render.world_tsr),
ed=wa.get_trans_view(Xb[Cb].render.world_tsr);ea.scale(ed,Sb,Nb);var mc=ea.clone([xb[bb],xb[bb+1],xb[bb+2]]);pb[Cb]||(pb[Cb]=new Float32Array(xb.length));lc&&(pb[Cb][bb+4]=$a[0]=xb[bb+4],pb[Cb][bb+5]=$a[1]=xb[bb+5],pb[Cb][bb+6]=$a[2]=xb[bb+6],pb[Cb][bb+7]=$a[3]=xb[bb+7],X.quat_bpy_b4w($a,$a),X.transformQuatFast(Nb,$a,Nb));ea.add(mc,Nb,mc);pb[Cb][bb]=mc[0];pb[Cb][bb+1]=mc[1];pb[Cb][bb+2]=mc[2];pb[Cb][bb+3]=xb[bb+3]}xc=pb;kc=!0}else{var Lc;if(ca.use_group_count){for(var Hb=ab,Mc=rb,nc=ca.dupli_weights,
oc=wc,pc=Bb,Ya=ib,jb={},Db=[],kb=0;kb<Mc.length;kb++)for(var Tb=Mc[kb],Zc=Tb.origin_name||Tb.name,ec=0;ec<nc.length;ec++){var Ib=nc[ec];Zc==Ib.name&&Db.push(Ib)}nc.length!=Db.length&&I.error("dupli weights match failed");for(kb=0;kb<Hb.length;kb+=Ya){for(var mb,yc=Db,Na=[0],tb=0;tb<yc.length;tb++)Na[tb+1]=Na[tb]+yc[tb].count;for(var Fc=Na[Na.length-1]*X.rand_r(oc),Jb=0,tb=0;tb<Na.length;tb++)if(Fc>=Na[tb]&&Fc<Na[tb+1]){Jb=tb;break}mb=Jb;jb[mb]=jb[mb]||[];jb[mb].push(Hb[kb],Hb[kb+1],Hb[kb+2],Hb[kb+
3]);pc&&jb[mb].push(Hb[kb+4],Hb[kb+5],Hb[kb+6],Hb[kb+7])}for(mb in jb)jb[mb]=new Float32Array(jb[mb]);Lc=jb}else{for(var gb=ab,zc=wc,Oa=Bb,cb=ib,ub=rb.length,Ob={},Xa=0;Xa<gb.length;Xa+=cb){var Ra=Math.floor(ub*X.rand_r(zc));Ob[Ra]=Ob[Ra]||[];Ob[Ra].push(gb[Xa],gb[Xa+1],gb[Xa+2],gb[Xa+3]);Oa&&Ob[Ra].push(gb[Xa+4],gb[Xa+5],gb[Xa+6],gb[Xa+7])}for(Ra in Ob)Ob[Ra]=new Float32Array(Ob[Ra]);Lc=Ob}xc=Lc}dc=G(a,b,La,N,Rb,Mb,xc,ca,R,jc,wc,kc);Z.push.apply(Z,dc)}"INSTANCE"==ca.b4w_wind_bend_inheritance&&ya.render.wind_bending&&
I.warn('Emitter object "'+ya.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else X.panic("Unknown particle settings type")}W?d.push.apply(d,Z):d=Z}return d}function e(a,b,c,d){a.bcyl_local=N.bcyl_from_values(b,d);a.bcap_local=N.bcap_from_values(c,d);a.bcon_local=N.bcon_from_values(b,d)}function n(a,b,c,d){var e=[];d||(b.selectable&&J.find_subs(a,za.COLOR_PICKING)||b.outlining&&J.find_subs(a,
za.OUTLINE_MASK))&&e.push("COLOR_ID");c&&(e.push("MAIN"),e.push("NODES_GLOW"),J.find_subs(a,za.DEBUG_VIEW)&&e.push("DEBUG_VIEW"),J.find_subs(a,za.SHADOW_RECEIVE)&&e.push("SHADOW"),J.find_subs(a,za.GRASS_MAP)&&e.push("GRASS_MAP"));e.push("PHYSICS");if(b.shadow_cast_only||b.reflexible_only)for(a=null,b.shadow_cast_only&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","DEBUG_VIEW"]),b.reflexible_only&&(b=["COLOR_ID","PHYSICS","SHADOW","DEBUG_VIEW"],a=null!==a?X.array_intersect(a,b):b),b=a,a=0;a<b.length;a++)c=
e.indexOf(b[a]),-1!==c&&e.splice(c,1);return e}function p(a,b,e){var f;switch(a.type){case "MAIN":if(b.b4w_do_not_render)f=!1;else{if(b.use_nodes&&"HALO"!=b.type)v(a,b,"MAIN");else{k(a,b);f=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.offset_z=b.offset_z;a.texture_scale.set([1,1,1]);var h=b.texture_slots;aa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);if(b.b4w_lens_flares){Q(a,"lens_flares.glslv","lens_flares.glslf");
x(a,"a_position");x(a,"a_texcoord");var l=e?[1,1,1,0]:null,l=V.get_batch_texture(h[0],l);T(a,l)}else{Q(a,"main.glslv","main_stack.glslf");b.use_shadeless||(f=Aa.create_lighting_graph(b.uuid,b.name,{use_shadeless:b.use_shadeless,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader,use_tangent_shading:b.use_tangent_shading}),a.shaders_info.node_elements=Aa.compose_node_elements(f));var n=m("use_map_color_diffuse",!0,h),p=m("use_map_color_spec",!0,h),t=m("use_map_normal",!0,h),q=m("use_map_mirror",
!0,h),r=m("use_stencil",!0,h);f=n[0];p=p[0];t=t[0];q=q[0];n=n[1];h=r[0]&&m("use_rgb_to_intensity",!0,h)[0];if(f){switch(f.blend_type){case "MIX":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}l="IMAGE"==f.texture._render.source&&e?[a.diffuse_color[0],a.diffuse_color[1],a.diffuse_color[2],1]:"ENVIRONMENT_MAP"==f.texture._render.source&&e?[.8,.8,.8,1]:null;l=V.get_batch_texture(f,l);T(a,l,"u_colormap0");a.diffuse_color_factor=
f.diffuse_color_factor;a.alpha_factor=f.use_map_alpha?f.alpha_factor:0;a.texture_scale.set(f.scale)}r=f&&f==p;p&&(r||(l=e?[.5,.5,.5,1]:null,l=V.get_batch_texture(p,l),T(a,l,"u_specmap0")),a.specular_color_factor=p.specular_color_factor);if(t&&(x(a,"a_tbn_quat"),a.part_use_tangent=!0,l=e?[.5,.5,1,1]:null,l=V.get_batch_texture(t,l),T(a,l,"u_normalmap0"),a.normal_factor=t.normal_factor,l=t.texture,l.b4w_use_map_parallax&&Ga.parallax)){var ia=na.glsl_value(l.b4w_parallax_steps),z=na.glsl_value(l.b4w_parallax_lod_dist);
g(a,"PARALLAX",1);g(a,"PARALLAX_STEPS",ia);g(a,"PARALLAX_LOD_DIST",z);a.parallax_scale=l.b4w_parallax_scale}q&&(l=e?[0,0,.5,1]:null,l=V.get_batch_texture(q,l),T(a,l,"u_mirrormap"),a.mirror_factor=q.mirror_factor);if(q=f&&n&&h?1:0)l=e?[.8,.8,.8,1]:null,l=V.get_batch_texture(n,l),T(a,l,"u_colormap1"),l=e?[.5,.5,.5,1]:null,l=V.get_batch_texture(h,l),T(a,l,"u_stencil0");(e=f||p||t)&&a.texture_scale.set(e.scale);g(a,"TEXTURE_SPEC",void 0==p?0:1);g(a,"ALPHA_AS_SPEC",r?1:0);g(a,"TEXTURE_STENCIL_ALPHA_MASK",
q);x(a,"a_position");x(a,"a_tbn_quat");(f||p||t)&&x(a,"a_texcoord");if(b.b4w_water){a.water=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.blend?(I.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),a.water_shore_smoothing=!1):a.water_shore_smoothing="REFLECT"!=a.subtype?b.b4w_water_shore_smoothing:!1;Q(a,"water.glslv","water.glslf");e=Aa.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader,
use_tangent_shading:b.use_tangent_shading});a.shaders_info.node_elements=Aa.compose_node_elements(e);x(a,"a_position");Ga.water_wireframe_debug?(x(a,"a_polyindex"),a.depth_mask=!0,ea.set(0,0,0,a.wireframe_edge_color),ma.get_standard_derivatives()?g(a,"DEBUG_WIREFRAME",1):g(a,"DEBUG_WIREFRAME",2)):g(a,"DEBUG_WIREFRAME",0);q=b.texture_slots;e=m("use_map_normal",!0,q);r=m("use_map_mirror",!0,q)[0];e.length&&(l=V.get_batch_texture(e[0]),T(a,l,"u_normalmap0"),a.water_norm_uv_velocity=b.b4w_water_norm_uv_velocity);
g(a,"NUM_NORMALMAPS",e.length);a.normalmap_scales=Array(e.length);for(l=0;l<e.length;l++)a.normalmap_scales[l]=new Float32Array(2),a.normalmap_scales[l].set([e[l].scale[0],e[l].scale[1]]);r&&(l=V.get_batch_texture(r),T(a,l,"u_mirrormap"),a.mirror_factor=r.mirror_factor);r=null;if(Ga.foam)for(l=0;l<q.length;l++){var u=q[l];if(!0===u.texture.b4w_water_foam){r=u;break}}r&&(g(a,"FOAM",1),l=V.get_batch_texture(r),T(a,l,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.foam_uv_freq.set(r.texture.b4w_foam_uv_freq),
a.foam_mag.set(r.texture.b4w_foam_uv_magnitude),a.foam_scale[0]=r.scale[0],a.foam_scale[1]=r.scale[1]);for(l=0;l<q.length;l++)if(u=q[l],!0===u.texture.b4w_shore_dist_map){var C=u;break}C&&Ga.allow_vertex_textures&&(C=V.get_batch_texture(C),T(a,C,"u_shore_dist_map"),g(a,"SHORE_PARAMS",1),C=u.texture.b4w_shore_boundings,g(a,"MAX_SHORE_DIST",na.glsl_value(u.texture.b4w_max_shore_dist)),g(a,"SHORE_MAP_SIZE_X",na.glsl_value(C[0]-C[1])),g(a,"SHORE_MAP_SIZE_Y",na.glsl_value(C[2]-C[3])),g(a,"SHORE_MAP_CENTER_X",
na.glsl_value((C[0]+C[1])/2)),g(a,"SHORE_MAP_CENTER_Y",na.glsl_value((C[2]+C[3])/2)));if(b.b4w_generated_mesh)g(a,"GENERATED_MESH",1),a.water_generated_mesh=!0,a.water_num_cascads=b.b4w_water_num_cascads,a.water_subdivs=b.b4w_water_subdivs,a.water_detailed_dist=b.b4w_water_detailed_dist;else{x(a,"a_tbn_quat");if(r||e.length)x(a,"a_texcoord"),a.part_use_tangent=!0;g(a,"GENERATED_MESH",0)}if(b.b4w_water_dynamic){u=na.glsl_value(b.b4w_water_dst_noise_scale0);C=na.glsl_value(b.b4w_water_dst_noise_scale1);
e=na.glsl_value(b.b4w_water_dst_noise_freq0);var q=na.glsl_value(b.b4w_water_dst_noise_freq1),r=na.glsl_value(b.b4w_water_dir_min_shore_fac),l=na.glsl_value(b.b4w_water_dir_freq),ia=na.glsl_value(b.b4w_water_dir_noise_scale),z=na.glsl_value(b.b4w_water_dir_noise_freq),y=na.glsl_value(b.b4w_water_dir_min_noise_fac),F=na.glsl_value(b.b4w_water_dst_min_fac),H=na.glsl_value(b.b4w_water_waves_hor_fac);g(a,"DST_NOISE_SCALE_0",u);g(a,"DST_NOISE_SCALE_1",C);g(a,"DST_NOISE_FREQ_0",e);g(a,"DST_NOISE_FREQ_1",
q);g(a,"DIR_MIN_SHR_FAC",r);g(a,"DIR_FREQ",l);g(a,"DIR_NOISE_SCALE",ia);g(a,"DIR_NOISE_FREQ",z);g(a,"DIR_MIN_NOISE_FAC",y);g(a,"DST_MIN_FAC",F);g(a,"WAVES_HOR_FAC",H)}E(a,b);w(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;g(a,"ABSORB",na.glsl_value(b.b4w_water_absorb_factor));g(a,"SSS_STRENGTH",na.glsl_value(b.b4w_water_sss_strength));g(a,"SSS_WIDTH",
na.glsl_value(b.b4w_water_sss_width))}"HALO"===b.type&&(Q(a,"halo.glslv","halo.glslf"),B(a,b),a.common_attributes=["a_position"]);b.use_tangent_shading&&(g(a,"USE_TBN_SHADING",1),x(a,"a_shade_tangs"));g(a,"TEXCOORD",0);g(a,"NORMAL_TEXCOORD",0);f&&c(a,f,"TEXTURE_COLOR0_CO");n&&c(a,n,"TEXTURE_COLOR1_CO");h&&c(a,h,"TEXTURE_STENCIL_ALPHA_MASK_CO");p&&c(a,p,"TEXTURE_SPEC_CO");t&&c(a,t,"TEXTURE_NORM_CO");g(a,"SHADELESS",b.use_shadeless?1:0);a.use_shadeless=b.use_shadeless}f=b.game_settings.alpha_blend;
g(a,"ALPHA","OPAQUE"===f?0:1);g(a,"ALPHA_CLIP","CLIP"===f?1:0);g(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(g(a,"VERTEX_COLOR",1),x(a,"a_color")):g(a,"VERTEX_COLOR",0);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;E(a,b);w(a,b);b.b4w_wettable?g(a,"WETTABLE",1):g(a,"WETTABLE",0);A(a,b);b.b4w_refractive&&!a.blend?(I.warn('Material "'+b.name+'" is not blend. Disabling refractions.'),
a.refractive=!1):a.refractive=b.b4w_refractive;a.refr_bump=b.b4w_refr_bump}f=!0}break;case "NODES_GLOW":f=v(a,b,"GLOW");break;case "SHADOW":if(b.b4w_lens_flares||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)f=!1;else if(k(a,b),a.blend)f=!1;else{f=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==f?v(a,b,"SHADOW"):Q(a,"shadow.glslv","shadow.glslf");aa.set(0,0,0,b.alpha,a.diffuse_color);x(a,"a_position");x(a,"a_tbn_quat");g(a,"ALPHA","OPAQUE"===f?0:1);a.texture_scale.set([1,1,1]);if((b=m("use_map_color_diffuse",
!0,b.texture_slots)[0])&&"CLIP"===f){switch(b.blend_type){case "MIX":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.texture_scale.set(b.scale);g(a,"TEXTURE_COLOR",1);x(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source||"CANVAS"==b.texture._render.source)f=V.get_batch_texture(b),T(a,f,"u_colormap0");"NONE"==b.texture._render.source&&(f=V.get_batch_texture(b),T(a,f,"u_colormap0"))}else g(a,
"TEXTURE_COLOR",0);f=!0}break;case "PHYSICS":b.b4w_collision?(a.use_ghost=b.b4w_use_ghost,a.collision_id=b.b4w_collision_id,a.collision_margin=b.b4w_collision_margin,a.collision_group=b.b4w_collision_group,a.collision_mask=b.b4w_collision_mask,a.friction=b.physics.friction,a.elasticity=b.physics.elasticity,f=!0):b.b4w_water?(a.water=!0,a.water_dynamics=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,
a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,f=!0):f=!1;break;case "COLOR_ID":if(b.b4w_lens_flares||"HALO"===b.type)f=!1;else{k(a,b);a.z_sort=!1;a.depth_mask=!0;a.blend=!1;f=b.game_settings.alpha_blend;
a.xray=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;b.use_nodes&&"CLIP"==f?v(a,b,"COLOR_ID"):Q(a,"color_id.glslv","color_id.glslf");aa.set(0,0,0,b.alpha,a.diffuse_color);x(a,"a_position");g(a,"ALPHA","OPAQUE"===f?0:1);a.texture_scale.set([1,1,1]);b=m("use_map_color_diffuse",!0,b.texture_slots)[0];f="CLIP"===f?1:0;g(a,"ALPHA_CLIP",f);if(b&&f){switch(b.blend_type){case "MIX":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.texture_scale.set(b.scale);
g(a,"TEXTURE_COLOR",1);x(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)f=V.get_batch_texture(b),T(a,f,"u_colormap0");"NONE"==b.texture._render.source&&(f=V.get_batch_texture(b),T(a,f,"u_colormap0"))}else g(a,"TEXTURE_COLOR",0);f=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?f=!1:(k(a,b),a.blend=!1,a.z_sort=!1,a.depth_mask=!0,Q(a,"grass_map.glslv","grass_map.glslf"),x(a,"a_position"),f=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:
null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.vertex_colors_usage.a_grass_size={generate_buffer:!0,src:[]},f?(a.vertex_colors_usage.a_grass_size.src.push({name:f,mask:4}),g(a,"DYNAMIC_GRASS_SIZE",1)):g(a,"DYNAMIC_GRASS_SIZE",0),a.vertex_colors_usage.a_grass_color={generate_buffer:!0,src:[]},b?(a.vertex_colors_usage.a_grass_color.src.push({name:b,mask:7}),g(a,"DYNAMIC_GRASS_COLOR",1)):g(a,"DYNAMIC_GRASS_COLOR",0),f=!0);break;case "DEBUG_VIEW":f=d(a,b);break;case "PARTICLES":a:if(b.b4w_do_not_render)f=
!1;else{f=b.texture_slots;if(a.halo_particles)Q(a,"particle_system.glslv","particle_system_stack.glslf"),g(a,"HALO_PARTICLES",1),B(a,b);else{p={use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader,use_tangent_shading:b.use_tangent_shading};if(b.use_nodes){Q(a,"particle_system.glslv","particle_system.glslf");v(a,b,"PARTICLES");f=!0;break a}else Q(a,"particle_system.glslv","particle_system_stack.glslf"),p=Aa.create_lighting_graph(b.uuid,b.name,p),a.shaders_info.node_elements=
Aa.compose_node_elements(p);if(f=m("use_map_color_diffuse",!0,f)[0]){g(a,"TEXTURE_COLOR",1);switch(f.blend_type){case "MIX":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":g(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.diffuse_color_factor=f.diffuse_color_factor;a.alpha_factor=f.use_map_alpha?f.alpha_factor:0;f=V.get_batch_texture(f);T(a,f)}}aa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.ambient=b.ambient;a.diffuse_intensity=
b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;x(a,"a_position");x(a,"a_tbn_quat");f=b.game_settings.alpha_blend;g(a,"ALPHA","OPAQUE"===f?0:1);g(a,"ALPHA_CLIP","CLIP"===f?1:0);g(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);E(a,b);w(a,b);k(a,b);f=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.offset_z=b.offset_z;f=!0}break;default:X.panic("Wrong batch type: "+a.type)}return f}function B(a,b){var c=b.halo;
g(a,"NUM_RINGS",c.ring_count);g(a,"NUM_LINES",c.line_count);g(a,"NUM_STARS",c.star_tip_count);g(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0);a.halo_size=c.size;a.halo_hardness=c.hardness/20;a.halo_rings_color.set(c.b4w_halo_rings_color);a.halo_lines_color.set(c.b4w_halo_lines_color);a.halo_stars_blend=1/b.b4w_halo_stars_blend_height;a.halo_stars_height=b.b4w_halo_stars_min_height;a.halo=!0}function c(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":g(a,c,"TEXTURE_COORDS_UV_ORCO");g(a,"TEXCOORD",1);
break;case "NORMAL":g(a,c,"TEXTURE_COORDS_NORMAL");g(a,"NORMAL_TEXCOORD",1);break;default:g(a,c,"TEXTURE_COORDS_NONE")}}function k(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.blend=!0;a.z_sort=!0;a.depth_mask=!0;a.alpha_clip=!1;break;case "ALPHA":a.blend=!0;a.z_sort=!1;a.depth_mask=!0;a.alpha_clip=!1;break;case "CLIP":a.blend=!1;a.z_sort=!1;a.depth_mask=!0;a.alpha_clip=!0;break;case "ADD":a.blend=!0;a.z_sort=!1;a.depth_mask=!1;a.alpha_clip=!1;break;case "OPAQUE":a.blend=
!1;a.z_sort=!1;a.depth_mask=!0;a.alpha_clip=!1;break;default:X.panic("Unknown alpha blend mode: "+d)}a.use_backface_culling=c.use_backface_culling}function m(a,b,c){for(var d=[],e=c.length,g=0;g<e;g++){var f=c[g];f[a]==b&&f.texture&&f.texture._render&&d.push(f)}return d}function A(a,b){var c=b.raytrace_transparency;a.fresnel_params[0]=c.fresnel;a.fresnel_params[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.fresnel_params[2]=c.fresnel;a.fresnel_params[3]=1-c.fresnel_factor/
5}function E(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:I.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.specular_params[0]=b.specular_intensity;a.specular_params[1]=c;a.specular_params[2]=d}function w(a,b){switch(b.diffuse_shader){case "LAMBERT":a.diffuse_params[0]=
0;a.diffuse_params[1]=0;break;case "OREN_NAYAR":a.diffuse_params[0]=b.roughness;a.diffuse_params[1]=0;break;case "FRESNEL":a.diffuse_params[0]=b.diffuse_fresnel;a.diffuse_params[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.diffuse_params[0]=b.darkness;a.diffuse_params[1]=0;break;case "TOON":a.diffuse_params[0]=b.diffuse_toon_size;a.diffuse_params[1]=b.diffuse_toon_smooth;break;default:I.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.diffuse_params[0]=0,
a.diffuse_params[1]=0}}function v(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":Q(a,"main.glslv","main.glslf");d=!1;break;case "GLOW":Q(a,"main.glslv","main.glslf");d=!0;break;case "SHADOW":Q(a,"shadow.glslv","shadow.glslf");d=!1;break;case "COLOR_ID":Q(a,"color_id.glslv","color_id.glslf"),d=!1}var e=b.node_tree;c=Aa.compose_ngraph_proxy(e,b.uuid,!1,b.name,c);if(!c.graph)return I.error('Failed to create node graph for material "'+b.name+'", disable nodes'),K(a,b),
!0;a.ngraph_proxy_id=c.id;a.has_nodes=!0;g(a,"NODES",1);g(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);x(a,"a_position");b.use_orco_tex_coord&&x(a,"a_orco_tex_coord");k(a,b);a.offset_z=b.offset_z;var f=b.game_settings.alpha_blend;d?(g(a,"ALPHA",1),g(a,"ALPHA_CLIP",0)):(g(a,"ALPHA","OPAQUE"===f?0:1),g(a,"ALPHA_CLIP","CLIP"===f?1:0));a.xray=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.emit=b.emit;a.ambient=b.ambient;A(a,b);b.b4w_wettable?g(a,"WETTABLE",1):g(a,"WETTABLE",0);var h=null,
l=!1;da.traverse(c.graph,function(c,d){switch(d.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var e=d.data.name,f=d.data.value;a.uv_maps_usage||(a.uv_maps_usage={});a.uv_maps_usage[f]=e;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":e=d.data.name;a.vertex_colors_usage[e]={generate_buffer:!0,src:[{name:d.data.value}]};f=0;if("GEOMETRY_VC"==d.type)f=7;else for(var k=0;k<d.outputs.length;k++){var m="RGB".indexOf(d.outputs[k].identifier);
-1<m&&(f|=1<<2-m)}a.vertex_colors_usage[e].src[0].mask=f;break;case "TEX_COORD_NO":case "GEOMETRY_NO":x(a,"a_tbn_quat");break;case "MATERIAL_BEGIN":d.data.value.use_tangent_shading&&(g(a,"USE_TBN_SHADING",1),"PARTICLES"!=a.type?x(a,"a_shade_tangs"):a.part_use_tangent=!0);x(a,"a_tbn_quat");l=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":e=d.data.name;f=d.data.value;if(!f._render){I.warn('Wrong texture "'+d.data.value.name+'" in material "'+b.name+'".');K(a,b);break}!1!==f._render.allow_node_dds&&
(f._render.allow_node_dds="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);T(a,f._render,e);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":g(a,"CALC_TBN_SPACE",1);x(a,"a_tbn_quat");a.part_use_tangent=!0;e=d.data.name;f=d.data.value;f._render.allow_node_dds=!1;T(a,f._render,e);break;case "NORMAL_MAP":x(a,"a_tbn_quat");switch(Number(d.dirs[0][1])){case Aa.NM_TANGENT:g(a,"CALC_TBN_SPACE",1);a.part_use_tangent=!0;break;case Aa.NM_OBJECT:case Aa.NM_BLENDER_OBJECT:g(a,"USE_MODEL_MATRIX",1)}break;case "LAMP":d.data&&
(a.lamp_uuid_indexes=d.data);break;case "B4W_REFRACTION":a.blend?a.refractive=!0:(a.refractive=!1,I.warn('Material "'+b.name+'" is not blend. Disabling refractions.'));break;case "VALTORGB":case "CURVE_VEC":case "CURVE_RGB":h||(h=d.data.texture);break;case "PARTICLE_INFO":"PARTICLES"==a.type&&d.data&&(a.part_node_data=d.data);break;case "VECT_TRANSFORM":switch(Number(d.dirs[1][1])){case Aa.VT_WORLD_TO_OBJECT:g(a,"USE_MODEL_MATRIX_INVERSE",1);break;case Aa.VT_WORLD_TO_CAMERA:g(a,"USE_VIEW_MATRIX",
1);break;case Aa.VT_OBJECT_TO_WORLD:g(a,"USE_MODEL_MATRIX",1);break;case Aa.VT_OBJECT_TO_CAMERA:g(a,"USE_MODEL_MATRIX",1);g(a,"USE_VIEW_MATRIX",1);break;case Aa.VT_CAMERA_TO_WORLD:g(a,"USE_VIEW_MATRIX_INVERSE",1);break;case Aa.VT_CAMERA_TO_OBJECT:g(a,"USE_MODEL_MATRIX_INVERSE",1),g(a,"USE_VIEW_MATRIX_INVERSE",1)}break;case "B4W_VECTOR_VIEW":g(a,"USE_VIEW_MATRIX",1);break;case "B4W_REFLECT":g(a,"USE_VIEW_MATRIX_INVERSE",1)}});h&&T(a,h,"u_nodes_texture");l||(a.use_shadeless=!0);d=a.shaders_info.node_elements=
Aa.compose_node_elements(c.graph);z(e,a,b.name);e=a.node_value_inds;c=a.node_rgb_inds;for(f=0;f<d.length;f++){var m=d[f];switch(m.id){case "VALUE":var n=m.param_values[0];if(n)for(var p=0;p<e.length;p+=2)if(e[p]==n){m.dirs.push(["VALUE_IND",e[p+1]]);break}break;case "RGB":if(n=m.param_values[0])for(p=0;p<c.length;p+=2)if(c[p]==n){m.dirs.push(["RGB_IND",c[p+1]]);break}}}g(a,"NUM_VALUES",a.node_values.length);g(a,"NUM_RGBS",a.node_rgbs.length);return!0}function z(a,b,c){c=[];var d=[],e=[],g=[];y(a,
"",c,d,e,g);b.node_values=c;b.node_value_inds=d;b.node_rgbs=e;b.node_rgb_inds=g}function y(a,b,c,d,e,g){for(var f=0;f<a.nodes.length;f++){var k=a.nodes[f];if("VALUE"==k.type){var h=D(b,k.name);c.push(k.outputs[0].default_value);d.push(h,d.length/2)}else"RGB"==k.type?(h=D(b,k.name),k=k.outputs[0].default_value.slice(0,3),e.push(k[0],k[1],k[2]),g.push(h,g.length/2)):"GROUP"==k.type&&(h=k.node_group.node_tree,k=D(b,k.name),y(h,k,c,d,e,g))}}function D(a,b){var c;return c=(a?a+"%join%":"")+b}function K(a,
b){switch(a.type){case "SHADOW":Q(a,"shadow.glslv","shadow.glslf");break;case "COLOR_ID":Q(a,"color_id.glslv","color_id.glslf");break;default:Q(a,"main.glslv","main_stack.glslf")}g(a,"SHADELESS",1);x(a,"a_position");x(a,"a_tbn_quat");aa.set(1,0,1,1,a.diffuse_color);if(b){var c=b.game_settings.alpha_blend;g(a,"ALPHA","OPAQUE"===c?0:1);g(a,"ALPHA_CLIP","CLIP"===c?1:0);g(a,"VERTEX_COLOR",0);a.offset_z=b.offset_z;k(a,b)}return!0}function d(a,b){if(b&&(b.b4w_lens_flares||b.b4w_do_not_render))return!1;
Q(a,"debug_view.glslv","debug_view.glslf");x(a,"a_position");x(a,"a_tbn_quat");x(a,"a_polyindex");a.depth_mask=!0;ea.set(0,0,0,a.wireframe_edge_color);return!0}function t(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.is_hair_particles?g(a,"AU_QUALIFIER","GLSL_IN"):g(a,"AU_QUALIFIER","uniform"),g(a,"STATIC_BATCH",0)):(g(a,"AU_QUALIFIER","GLSL_IN"),g(a,"STATIC_BATCH",1));"DEBUG_VIEW"==a.type&&(ma.get_standard_derivatives()?g(a,"WIREFRAME_QUALITY",1):g(a,"WIREFRAME_QUALITY",0),a.debug_sphere?(g(a,
"DEBUG_SPHERE",1),a.debug_sphere_dynamic?g(a,"DEBUG_SPHERE_DYNAMIC",1):g(a,"DEBUG_SPHERE_DYNAMIC",0)):g(a,"DEBUG_SPHERE",0),g(a,"ALPHA",1));b.use_shape_keys&&(a.use_shape_keys=b.use_shape_keys);b.wind_bending?(""!==b.main_bend_col?(a.vertex_colors_usage.a_bending_col_main={generate_buffer:!0,src:[{name:b.main_bend_col,mask:4}]},x(a,"a_bending_col_main"),""!==b.detail_bend_col.leaves_stiffness&&""!==b.detail_bend_col.leaves_phase&&""!==b.detail_bend_col.overall_stiffness?(a.vertex_colors_usage.a_bending_col_detail=
{generate_buffer:!0,src:[{name:b.detail_bend_col.leaves_stiffness,mask:4},{name:b.detail_bend_col.leaves_phase,mask:2},{name:b.detail_bend_col.overall_stiffness,mask:1}]},x(a,"a_bending_col_detail"),x(a,"a_tbn_quat"),g(a,"DETAIL_BEND",1)):g(a,"DETAIL_BEND",0),g(a,"MAIN_BEND_COL",1)):g(a,"MAIN_BEND_COL",0),g(a,"WIND_BEND",1)):g(a,"WIND_BEND",0);b.bend_center_only?g(a,"BEND_CENTER_ONLY",1):g(a,"BEND_CENTER_ONLY",0);g(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.billboard_pres_glob_orientation|0);b.billboard?
g(a,"BILLBOARD",1):g(a,"BILLBOARD",0);b.billboard&&b.is_hair_particles?g(a,"HAIR_BILLBOARD",1):g(a,"HAIR_BILLBOARD",0);b.billboard_spherical?g(a,"BILLBOARD_SPHERICAL",1):g(a,"BILLBOARD_SPHERICAL",0);switch(b.billboard_type){case "RANDOM":g(a,"BILLBOARD_RANDOM",1);g(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":g(a,"BILLBOARD_RANDOM",0);g(a,"BILLBOARD_JITTERED",1);break;default:g(a,"BILLBOARD_RANDOM",0),g(a,"BILLBOARD_JITTERED",0)}b.dynamic_grass&&Ga.allow_vertex_textures?g(a,"DYNAMIC_GRASS",1):
g(a,"DYNAMIC_GRASS",0);a.dynamic_grass=b.dynamic_grass;"PARTICLES"!=a.type&&(a.dynamic_geometry=b.dynamic_geometry);a.shadow_cast=b.shadow_cast;a.shadow_cast_only=b.shadow_cast_only;a.shadow_receive=b.shadow_receive&&!a.use_shadeless&&!(a.blend&&Ga.disable_blend_shadows_hack);a.reflexible=b.reflexible;a.reflexible_only=b.reflexible_only;a.reflective=b.reflective;b.is_skinning?(x(a,"a_influence"),g(a,"SKINNED",1),Ga.skinning_hack?(g(a,"DISABLE_TANGENT_SKINNING",1),g(a,"FRAMES_BLENDING",0)):(g(a,"DISABLE_TANGENT_SKINNING",
0),b.frames_blending?g(a,"FRAMES_BLENDING",1):g(a,"FRAMES_BLENDING",0)),g(a,"MAX_BONES",b.max_bones)):(g(a,"SKINNED",0),g(a,"FRAMES_BLENDING",0),g(a,"DISABLE_TANGENT_SKINNING",0));b.vertex_anim?(g(a,"VERTEX_ANIM",1),Ga.vert_anim_mix_normals_hack?g(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):g(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):g(a,"VERTEX_ANIM",0);b.is_skinning&&b.vertex_anim&&X.panic("Skinning and vertex animation are mutually exlusive");b.disable_fogging?g(a,"DISABLE_FOG",1):g(a,
"DISABLE_FOG",0)}}function C(a,b,c){if(b.length){for(var d=ra.get_shadow_lamps(b,Ga.ssao&&c.b4w_enable_ssao),e=a.shaders_info,g=a.lamp_uuid_indexes,f=0,k=0;k<a.shaders_info.node_elements.length;k++){var h=a.shaders_info.node_elements[k];if("LIGHTING_LAMP"==h.id){var l=b[f++%b.length],m=l.light;"AREA"==m.type&&(l=b[f++%b.length],m=l.light);var n=ra.get_scene_data(l,c);if("SPOT"==m.type||"POINT"==m.type)var p=Math.cos(m.spot_size/2);if("SPOT"==m.type)var t=m.spot_blend*(1-p);n=n.light_index;l=d.indexOf(l);
h.dirs=[["LAMP_TYPE",m.type],["LAMP_IND",n],["LAMP_SPOT_SIZE",na.glsl_value(p||.01)],["LAMP_SPOT_BLEND",na.glsl_value(t||.01)],["LAMP_LIGHT_DIST",na.glsl_value(m.distance)],["LAMP_USE_SPHERE",m.use_sphere?1:0],["LAMP_SHADOW_MAP_IND",l]]}else if("LAMP"==h.id&&g)for(var n=h.dirs[0][1],q=0;q<b.length;q++)if(l=b[q],g[l.uuid]==n){m=l.light;if("SPOT"==m.type||"POINT"==m.type)p=Math.cos(m.spot_size/2);"SPOT"==m.type&&(t=m.spot_blend*(1-p));h.dirs.push(["LAMP_TYPE",m.type],["LAMP_SPOT_SIZE",na.glsl_value(p||
.01)],["LAMP_SPOT_BLEND",na.glsl_value(t||.01)],["LAMP_LIGHT_DIST",na.glsl_value(m.distance)],["LAMP_USE_SPHERE",m.use_sphere?1:0])}}if(g){c=0;for(var v in g)c++;a.lamp_light_positions=new Float32Array(3*c);a.lamp_light_directions=new Float32Array(3*c);a.lamp_light_color_intensities=new Float32Array(3*c);na.set_directive(e,"NUM_LAMP_LIGHTS",c);for(k=0;k<b.length;k++)M(a,b[k])}}}function M(a,b){if(b.uuid in a.lamp_uuid_indexes){var c=a.lamp_uuid_indexes[b.uuid],d=wa.get_trans_view(b.render.world_tsr);
a.lamp_light_positions.set(d,3*c);a.lamp_light_directions.set(b.light.direction,3*c);a.lamp_light_color_intensities.set(b.light.color_intensity,3*c)}}function x(a,b){var c=a.common_attributes;-1==c.indexOf(b)&&c.push(b)}function g(a,b,c){na.set_directive(a.shaders_info,b,c)}function H(a,b){if("PHYSICS"==a.type)"NAVMESH"==a.subtype?a.bufs_data=ga.submesh_to_bufs_data(b,ga.DM_DEFAULT,[],a):(0<b.shape_keys.length&&ga.submesh_init_shape_keys(b,b.va_frames[0]),a.submesh=b);else{var c=a.draw_mode;a.halo&&
"PARTICLES"!=a.type&&(b=ga.extract_halo_submesh(b));a.water_generated_mesh&&(b=R.generate_cascaded_grid(a.water_num_cascads,a.water_subdivs,a.water_detailed_dist));c=ga.submesh_to_bufs_data(b,c,a.vertex_colors_usage,a);a.bufs_data=c;a.dynamic_geometry||a.z_sort||a.use_shape_keys||(c.ibo_array=null,c.vbo_source_data.length=0);c=b.va_frames.length;a.num_vertices=b.base_length*c;var d;a:switch(a.draw_mode){case ga.DM_DEFAULT:case ga.DM_TRIANGLES:case ga.DM_DYNAMIC_TRIANGLES:d=!0;break a;default:d=!1}d?
ga.is_indexed(b)?a.num_triangles=b.indices.length/3*c:a.num_triangles=b.base_length/3*c:a.num_triangles=0}}function G(a,b,c,d,e,f,k,h,l,m,n,p){var q=a._object,v=[],r=h.b4w_dynamic_grass;if(!m&&r)return v;for(var B="INSTANCE"==h.b4w_wind_bend_inheritance,x="INSTANCE"==h.b4w_shadow_inheritance,w="INSTANCE"==h.b4w_reflection_inheritance,ia=[],z=[],A=0;A<e.length;A++){var C=e[A]._object.render,y=ra.clone_render(b);y.billboard=h.b4w_hair_billboard;y.billboard_type=h.b4w_hair_billboard_type;y.billboard_spherical=
"SPHERICAL"==h.b4w_hair_billboard_geometry;y.dynamic_grass=r;y.is_hair_particles=!0;B?(y.wind_bending=C.wind_bending,y.wind_bending_angle=C.wind_bending_angle,y.wind_bending_freq=C.wind_bending_freq,y.detail_bending_freq=C.detail_bending_freq,y.main_bend_col=C.main_bend_col,y.detail_bending_amp=C.detail_bending_amp,y.branch_bending_amp=C.branch_bending_amp,y.wind_bending_amp=C.wind_bending_amp,y.detail_bend_col=C.detail_bend_col,y.bend_center_only=!1):(y.wind_bending=q.render.wind_bending,y.wind_bending_angle=
q.render.wind_bending_angle,y.wind_bending_freq=q.render.wind_bending_freq,y.detail_bending_freq=q.render.detail_bending_freq,y.main_bend_col=q.render.main_bend_col,y.detail_bending_amp=q.render.detail_bending_amp,y.branch_bending_amp=q.render.branch_bending_amp,y.wind_bending_amp=q.render.wind_bending_amp,y.detail_bend_col=q.render.detail_bend_col,y.bend_center_only=!0);x?(y.shadow_cast=C.shadow_cast,y.shadow_cast_only=C.shadow_cast_only,y.shadow_receive=C.shadow_receive):(y.shadow_cast=q.render.shadow_cast,
y.shadow_cast_only=q.render.shadow_cast_only,y.shadow_receive=q.render.shadow_receive);w?(y.reflexible=C.reflexible,y.reflexible_only=C.reflexible_only,y.reflective=C.reflective,y.cube_reflection_id=C.cube_reflection_id,y.plane_reflection_id=C.plane_reflection_id,y.reflection_type=C.reflection_type):(y.reflexible=q.render.reflexible,y.reflexible_only=q.render.reflexible_only,y.reflective=q.render.reflective,y.cube_reflection_id=q.render.cube_reflection_id,y.plane_reflection_id=q.render.plane_reflection_id,
y.reflection_type=q.render.reflection_type);ia.push(y);var H=k[A];H||(H=new Float32Array);p&&X.init_rand_r_seed(l.seed,n);var Ha=new Float32Array(3),E=new Float32Array([0,0,0,1]),xa=[],J=va.check_particles_bin_format(Ga.loaded_data_version)&&!h.b4w_initial_rand_rotation&&!h.b4w_hair_billboard,G=4;J&&(G=8);for(var D=0;D<H.length;D+=G){Ha[0]=H[D];Ha[1]=H[D+1];Ha[2]=H[D+2];var oa=H[D+3]*wa.get_scale(C.world_tsr);if(h.b4w_initial_rand_rotation){switch(h.b4w_rotation_type){case "XYZ":var W=new Float32Array([X.rand_r(n),
X.rand_r(n),X.rand_r(n)]);ea.normalize(W,W);break;case "Z":W=new Float32Array([0,0,1]);break;default:X.panic("Unsupported random rotation type: "+h.b4w_rotation_type)}sa.setAxisAngle(W,h.b4w_rand_rotation_strength*(2*Math.PI*X.rand_r(n)-Math.PI),E)}else if(J&&(E.set(H.subarray(D+4,D+8)),X.quat_bpy_b4w(E,E),!h.use_whole_group))if(h.use_rotation_dupli){var M=wa.get_quat_view(C.world_tsr);sa.multiply(E,M,E)}else sa.multiply(E,pa,E);var U=wa.set_sep(Ha,oa,E,wa.create());xa.push(U)}z.push(xa)}for(var K=
{},La=0,A=0;A<e.length;A++)for(var Q=e[A].data.materials,D=0;D<Q.length;D++)Q[D].name in K?K[Q[D].name]++:(K[Q[D].name]=1,La++);for(var La=La?La:1,T={},A=0;A<e.length;A++){var Y=e[A],ha=f[A],y=ia[A],Ea={};y.wind_bending&&(Ea.au_wind_bending_amp=[y.wind_bending_amp],Ea.au_wind_bending_freq=[y.wind_bending_freq],Ea.au_detail_bending_freq=[y.detail_bending_freq],Ea.au_detail_bending_amp=[y.detail_bending_amp],Ea.au_branch_bending_amp=[y.branch_bending_amp],y.wind_bending_amp=0,y.wind_bending_freq=0,
y.detail_bending_freq=0,y.detail_bending_amp=0,y.branch_bending_amp=0);var N=F(y),xa=z[A];if(xa.length){for(var ya=Y.data,Q=ya.materials,Z=Array(Q.length),ua=Array(Q.length),D=0;D<Q.length;D++)if(!ga.has_empty_submesh(ya,D))for(var Ca=0;Ca<ha.length;Ca++){var S=ha[Ca],fa=u(S),na=Q[D];"MAIN"==S?Z[D]=fa:"DEBUG_VIEW"==S&&(ua[D]=fa);fa.cluster_id=a.b4w_cluster_data.cluster_id;if(ba(fa,na)){"SHADOW"==S&&Z[D]&&(fa.use_shadeless=Z[D].use_shadeless);fa.draw_mode=ga.DM_DEFAULT;t(fa,y);fa.odd_id_prop=h.uuid;
"JITTERED"==h.b4w_hair_billboard_type&&(fa.jitter_amp=h.b4w_hair_billboard_jitter_amp,fa.jitter_freq=h.b4w_hair_billboard_jitter_freq);r&&(fa.grass_scale_threshold=h.b4w_dynamic_grass_scale_threshold);B||(delete fa.vertex_colors_usage.a_bending_col_main,delete fa.vertex_colors_usage.a_bending_col_detail);L(fa,N);var R=ga.extract_submesh(ya,D,fa.common_attributes,b.bone_skinning_info,fa.vertex_colors_usage,fa.uv_maps_usage),ca=q.render.world_tsr,V=!0;if(1<K[na.name]){var ma=0,Aa;for(Aa in R.va_frames)ma++;
V=R.indices.length*xa.length*ma*K[na.name]>2E5*La}var da=Ga.allow_instanced_arrays_ext&&V&&"PHYSICS"!=fa.type;if(da){fa.inst_array_state=h.use_whole_group?2:1;var aa=X.clone_object_r(R);ga.calc_unit_boundings(R,aa,xa);aa.instanced_array_data={tsr_array:xa,stat_part_em_tsr:ca,static_hair:"STATIC"==b.type,submesh_params:Ea,part_inh_attrs:{},dyn_grass:r};if(y.wind_bending&&y.bend_center_only){var za=ea.fromValues(0,0,0);wa.transform_vec3(za,q.render.world_tsr,za);for(var ja=[],cc=0;cc<xa.length;cc++)ja.push(za[0],
za[1],za[2]);aa.instanced_array_data.part_inh_attrs.a_emitter_center={num_comp:3,data:ja}}ga.calc_unit_boundings(R,R,xa);"STATIC"==b.type&&ga.bounding_data_apply_transform(aa.submesh_bd,ca)}else{var Wa=aa=ga.make_clone_submesh(R,Ea,xa),Tc=xa;Wa.va_common.au_center_pos=new Float32Array(3*Wa.base_length);for(var jc=Tc.length,Mb=Wa.base_length/jc,dc=0;dc<jc;dc++)for(var Rb=Tc[dc],Kc=3*Mb*dc,kc=0;kc<Mb;kc++)Wa.va_common.au_center_pos[Kc+3*kc]=Rb[0],Wa.va_common.au_center_pos[Kc+3*kc+1]=Rb[1],Wa.va_common.au_center_pos[Kc+
3*kc+2]=Rb[2];aa=Wa;if(y.wind_bending&&y.bend_center_only){var rb=aa,xc=q.render.world_tsr;rb.va_common.a_emitter_center=new Float32Array(3*rb.base_length);var xb=ea.fromValues(0,0,0);wa.transform_vec3(xb,xc,xb);for(var Xb=0;Xb<rb.base_length;Xb++)rb.va_common.a_emitter_center[3*Xb]=xb[0],rb.va_common.a_emitter_center[3*Xb+1]=xb[1],rb.va_common.a_emitter_center[3*Xb+2]=xb[2];aa=rb}}var lc=h.b4w_vcol_from_name,Yc=h.b4w_vcol_to_name,pb=fa,$a=c,bb=!B,Cb=ya,Nb=[];if(""!==lc&&""!==Yc){var Sb,ed=Yc,mc=
pb.vertex_colors_usage,Lc=[],Hb=void 0;for(Hb in mc)for(var Mc=mc[Hb].src,nc=0,oc=0;oc<Mc.length;oc++){var pc=Mc[oc].mask;ed==Mc[oc].name&&Lc.push(Hb,pc,nc);nc+=X.rgb_mask_get_channels_count(pc)}Sb=Lc;if(0<Sb.length)for(var Ya=0;Ya<Sb.length;Ya+=3)Nb.push({emitter_attr:lc,emitter_mask:7,particle_attr:Sb[Ya],particle_mask:Sb[Ya+1],dst_channel_offset:Sb[Ya+2]});else ga.has_attr(pb.common_attributes,"a_color")&&Yc==Cb.active_vcol_name&&Nb.push({emitter_attr:lc,emitter_mask:7,particle_attr:"a_color",
particle_mask:7,dst_channel_offset:0})}bb&&("a_bending_col_main"in $a&&Nb.push({emitter_attr:"a_bending_col_main",emitter_mask:4,particle_attr:"a_bending_col_main",particle_mask:4,dst_channel_offset:0}),"a_bending_col_detail"in $a&&Nb.push({emitter_attr:"a_bending_col_detail",emitter_mask:7,particle_attr:"a_bending_col_detail",particle_mask:7,dst_channel_offset:0}));for(var jb=aa,Db=xa,kb=d,Tb=Nb,Zc=fa.vertex_colors_usage,ec=da,Ib=!1,mb=0;mb<Tb.length;mb++){var yc=Tb[mb].emitter_attr,Na=kb.va_common[yc];
if(Na&&0<Na.length){Ib=!0;break}}if(ec)var tb=jb.instanced_array_data.part_inh_attrs;if(Ib){var Fc,Jb=q.render.bb_local,gb=kb.va_frames[0].a_position,zc=Db,Oa=T,cb=new Float32Array(3),ub=new Float32Array(3),Ob=new Uint32Array(zc.length);if(!("verts_indices"in Oa)){Oa.cell_size=new Float32Array(3);Oa.base_point=new Float32Array(3);Oa.verts_indices=new Uint32Array(gb.length/3);Oa.octs_indices=new Uint32Array(gb.length/3);Oa.cell_size[0]=(Jb.max_x-Jb.min_x)/20;Oa.cell_size[1]=(Jb.max_y-Jb.min_y)/20;
Oa.cell_size[2]=(Jb.max_z-Jb.min_z)/20;Oa.base_point[0]=Jb.min_x;Oa.base_point[1]=Jb.min_y;Oa.base_point[2]=Jb.min_z;for(var Xa=0;Xa<gb.length/3;Xa++){var Ra=gb[3*Xa+1],qc=gb[3*Xa+2],Eb=X.trunc((gb[3*Xa]-Oa.base_point[0])/Oa.cell_size[0]),Uc=X.trunc((Ra-Oa.base_point[1])/Oa.cell_size[1]),Ac=X.trunc((qc-Oa.base_point[2])/Oa.cell_size[2]),Eb=X.clamp(Eb,0,19),Uc=X.clamp(Uc,0,19),Ac=X.clamp(Ac,0,19);Oa.verts_indices[Xa]=Xa;Oa.octs_indices[Xa]=Ac*Math.pow(20,2)+20*Uc+Eb}ga.sort_two_arrays(Oa.octs_indices,
Oa.verts_indices,ga.SORT_NUMERIC,!0);Oa.verts_offsets=new Uint32Array(Math.pow(20,3));for(Xa=0;Xa<Oa.octs_indices.length;Xa++)Oa.verts_offsets[Oa.octs_indices[Xa]]++;delete Oa.octs_indices;for(Xa=1;Xa<Oa.verts_offsets.length;Xa++)Oa.verts_offsets[Xa]+=Oa.verts_offsets[Xa-1]}for(var fb=0;fb<zc.length;fb++){cb[0]=zc[fb][0];cb[1]=zc[fb][1];cb[2]=zc[fb][2];for(var Ub=1E10,vb=-1,hb=X.trunc((cb[0]-Oa.base_point[0])/Oa.cell_size[0]),Nc=X.trunc((cb[1]-Oa.base_point[1])/Oa.cell_size[1]),Oc=X.trunc((cb[2]-
Oa.base_point[2])/Oa.cell_size[2]),hb=X.clamp(hb,0,19),Nc=X.clamp(Nc,0,19),Oc=X.clamp(Oc,0,19),Bc=Oc*Math.pow(20,2)+20*Nc+hb,Gc=Oa.verts_offsets[Bc],yb=0==Bc?0:Oa.verts_offsets[Bc-1];yb<Gc;yb++){var Pc=Oa.verts_indices[yb];ub[0]=gb[3*Pc];ub[1]=gb[3*Pc+1];ub[2]=gb[3*Pc+2];ea.sub(ub,cb,ub);var fc=ea.sqrLen(ub);fc<=Ub&&(Ub=fc,vb=Pc)}if(-1==vb)for(yb=0;yb<gb.length/3;yb++)ub[0]=gb[3*yb],ub[1]=gb[3*yb+1],ub[2]=gb[3*yb+2],ea.sub(ub,cb,ub),fc=ea.sqrLen(ub),fc<=Ub&&(Ub=fc,vb=yb);Ob[fb]=vb}Fc=Ob;for(var rc=
jb.base_length/Db.length,mb=0;mb<Tb.length;mb++){var wb=Tb[mb].particle_attr,Qc=Tb[mb].particle_mask,yc=Tb[mb].emitter_attr,lb=Tb[mb].emitter_mask,Na=kb.va_common[yc];switch(wb){case "a_bending_col_main":var Ua=1;break;case "a_bending_col_detail":Ua=3;break;case "a_color":Ua=3;break;default:for(var Kb=Ua=0;Kb<Zc[wb].src.length;Kb++)Ua+=X.rgb_mask_get_channels_count(Zc[wb].src[Kb].mask)}if(Na&&0<Na.length){var fd=X.rgb_mask_get_channels_count(lb),$c=X.rgb_mask_get_channels_count(Qc),Yb=lb&Qc,sc=X.rgb_mask_get_channels_presence(Yb);
Yb!=Qc&&I.error("Wrong color extraction from "+yc+" to "+wb+".");if(ec)for(tb[wb]={num_comp:Ua,data:[]},Kb=0;Kb<Db.length;Kb++)for(Hc=Fc[Kb],Cc=Hc*fd,Pb=0;Pb<sc.length;Pb++)sc[Pb]&&(tc=X.rgb_mask_get_channel_presence_index(lb,Pb),tb[wb].data.push(Na[Cc+tc]));else{if("a_bending_col_main"==wb||"a_bending_col_detail"==wb)jb.va_common[wb]=new Float32Array(jb.base_length*$c);for(Kb=0;Kb<Db.length;Kb++){var Hc=Fc[Kb],Cc=Hc*fd,ad=Kb*rc*Ua;if(-1!=Hc)for(var zb=0;zb<rc;zb++)for(var gd=zb*Ua,Pb=0;Pb<sc.length;Pb++)if(sc[Pb]){var tc=
X.rgb_mask_get_channel_presence_index(lb,Pb),hd=Tb[mb].dst_channel_offset+X.rgb_mask_get_channel_presence_index(Qc,Pb);jb.va_common[wb][ad+gd+hd]=Na[Cc+tc]}}}}else jb.va_common[wb]=new Float32Array(0)}}aa=jb;g(fa,"USE_INSTANCED_PARTCLS",aa.instanced_array_data?1:0);v.push({batch:fa,submesh:aa,mat_names:[na.name],render:y,rel_bpy_objects:[a]})}}for(D=0;D<ua.length;D++)ua[D]&&(ua[D].debug_main_batch_id=Z[D].id,L(ua[D],ua[D].render_id))}}return v}function ba(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=Aa.check_material_glow_output(b));
return c=c&&p(a,b)}function L(a,b){var c=null,d=null,e=a.bb_local,g=a.be_local,f=a.bb_world,k=a.be_world,h=a.vaos;a.bb_local=null;a.be_local=null;a.bb_world=null;a.be_world=null;a.vaos=null;for(var l=0;l<a.textures.length;l++){var m=a.textures[l].canvas_context;m&&(c||(c={}),c[l]=m,a.textures[l].canvas_context=null);if(m=a.textures[l].video_file)d||(d={}),d[l]=m,a.textures[l].video_file=null}a.id=0;a.render_id=b;a.id=X.calc_variable_id(a,b);a.bb_local=e;a.be_local=g;a.bb_world=f;a.be_world=k;a.vaos=
h;if(c)for(var n in c)a.textures[n].canvas_context=c[n];if(d)for(n in d)a.textures[n].video_file=d[n]}function F(a){var b=a.bone_pointers;a.bone_pointers=null;var c=X.calc_variable_id(a,0);a.bone_pointers=b;return c}function U(a,b,c,d){var e=u("DEBUG_VIEW");Q(e,"debug_view.glslv","debug_view.glslf");e.debug_sphere=!0;e.depth_mask=!0;e.odd_id_prop=b;e.debug_sphere_dynamic=c;t(e,a);a=F(a);L(e,a);if(d.use_be){c?(b=d.be_local,wa.set_trans(d.be_local.center,oa)):(b=d.be_world,wa.set_trans(b.center,oa));
var g=ea.create();c=R.generate_uv_sphere(16,8,1,g,!1,!1);a=ea.fromValues(ea.length(b.axis_x),ea.length(b.axis_y),ea.length(b.axis_z));ga.scale_submesh_xyz(c,a,g);var g=ea.normalize(b.axis_x,ya),f=ea.normalize(b.axis_y,Ea);b=ea.normalize(b.axis_z,Ca);!a[0]&&a[1]&&a[2]?ea.cross(f,b,g):!a[1]&&a[0]&&a[2]?ea.cross(b,g,f):!a[2]&&a[0]&&a[1]&&ea.cross(g,f,b);a=X.ellipsoid_axes_to_mat3(g,f,b,xa);fa.invert(a,a);a=sa.fromMat3(a,ia);wa.set_quat(a,oa);wa.set_scale(1,oa);ga.submesh_apply_transform(c,oa)}else c?
(a=d.bs_local,c=R.generate_uv_sphere(16,8,a.radius,a.center,!1,!1)):(a=d.bs_world,c=R.generate_uv_sphere(16,8,a.radius,ea.create(),!1,!1),wa.identity(oa),wa.set_trans(a.center,oa),ga.submesh_apply_transform(c,oa));e.bb_local=N.clone_bb(d.bb_local);e.be_local=N.clone_be(d.be_local);e.bs_local=N.clone_bs(d.bs_local);e.bb_world=N.clone_bb(d.bb_world);e.be_world=N.clone_be(d.be_world);e.bs_world=N.clone_bs(d.bs_world);ga.submesh_drop_indices(c,1,!0);c.va_common.a_polyindex=ga.extract_polyindices(c);H(e,
c);return e}function Q(a,b,c){a.shaders_info.vert=b;a.shaders_info.frag=c;na.set_default_directives(a.shaders_info)}function T(a,b,c){1==a.textures.length&&0==a.texture_names.length&&a.texture_names.push("default0");c=c||"default"+String(a.textures.length);-1==a.texture_names.indexOf(c)&&(a.textures.push(b),a.texture_names.push(c));a.shader&&ua.assign_texture_uniforms(a)}function W(a){a.shaders_info||X.panic("No shaders info for batch "+a.name);var b=a.shader?a.shader.shader_id:null;a.shader=na.get_compiled_shader(a.shaders_info);
var c=a.shaders_info;if(c.status===na.VALID){var d=a.shader.attributes,e=a.bufs_data.pointers,g;for(g in d)e[g]||X.panic('missing data for "'+g+'" attribute')}c.status&na.INVALID_TEX_IMAGE_UNITS&&I.error("Texture limit exceeded for shader - "+c.frag+', materials: "'+a.material_names.join(", ")+'". Maximum texture count: '+ja.max_texture_image_units+", actual texture count: "+c.texture_count);c.status&na.INVALID_F_UNIFORM_VECTORS&&I.error("Fragment uniform limit exceeded for shader - "+c.frag+', materials: "'+
a.material_names.join(", ")+'". Maximum fragment uniform count: '+ja.max_fragment_uniform_vectors+", actual fragment uniform count: "+c.frag_uniform_count);c.status&na.INVALID_V_UNIFORM_VECTORS&&I.error("Vertex uniform limit exceeded for shader - "+c.vert+', materials: "'+a.material_names.join(", ")+'". Maximum vertex uniform count: '+ja.max_vertex_uniform_vectors+", actual vertex uniform count: "+c.vert_uniform_count);c.status&na.INVALID_VERTEX_ATTRIBS&&I.error("Vertex attribute limit exceeded for shader - "+
c.vert+', materials: "'+a.material_names.join(", ")+'". Maximum attribute count: '+ja.max_vertex_attribs+", actual attribute count: "+c.attribute_count);c.status&na.INVALID_VARYING_VECTORS&&("MAIN"!=a.type||a.has_nodes||I.error("Varying limit exceeded for shader - "+a.shaders_info.frag+', materials: "'+a.material_names.join(", ")+'"'),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type)&&(e=d=0,a.uv_maps_usage&&(d=X.get_dict_length(a.uv_maps_usage)),a.vertex_colors_usage&&(e=X.get_dict_length(a.vertex_colors_usage)),
I.error("Varying limit exceeded for node shader - "+a.shaders_info.frag+", uv: "+d+", vc: "+e+', materials: "'+a.material_names.join(", ")+'"'));c.status&na.COMPILATION_ERROR&&I.error("Shader compilation/linking error: "+c.vert+", "+c.frag+', materials: "'+a.material_names.join(", ")+'"');return a.shaders_info.status===na.VALID?(ua.assign_uniform_setters(a.shader),ua.assign_attribute_setters(a),ua.assign_texture_uniforms(a),a.shader.shader_id!=b&&(a.shader_updated=!0),!0):!1}function ha(a,b,c){a=
a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function Y(a,b,c){a=a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function Z(a,b){a.diffuse_color.set(b.diffuse_color);a.diffuse_intensity=b.diffuse_intensity;a.specular_color.set(b.specular_color);a.specular_color_factor=b.specular_color_factor;a.specular_params.set(b.specular_params);
a.emit=b.emit;a.ambient=b.ambient;a.diffuse_color_factor=b.diffuse_color_factor;a.alpha_factor=b.alpha_factor;a.reflect_factor=b.reflect_factor;a.fresnel_params.set(b.fresnel_params);a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.water_norm_uv_velocity=b.water_norm_uv_velocity}var N=r("__boundings"),ca=r("__config"),
I=r("__print"),ma=r("__extensions"),da=r("__graph"),fa=r("__mat3"),Aa=r("__nodemat"),ra=r("__obj_util"),S=r("__particles"),R=r("__primitives"),sa=r("__quat"),va=r("__reformer"),ua=r("__renderer"),J=r("__scenegraph"),na=r("__shaders"),za=r("__subscene"),V=r("__textures"),wa=r("__tsr"),ga=r("__geometry"),X=r("__util"),ea=r("__vec3"),aa=r("__vec4"),Ga=ca.defaults,ja=ca.context_limits,pa=new Float32Array([0,0,-Math.sqrt(.5),Math.sqrt(.5)]),ya=new Float32Array(3),Ea=new Float32Array(3),Ca=new Float32Array(3),
ia=new Float32Array(4),oa=wa.create(),xa=fa.create();a.BATCH_INHERITED_TEXTURES=La;var La="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" "),Ha={};a.batch_get_debug_storage=function(a){return Ha[a]||null};a.batch_set_debug_storage=function(a,b){Ha[a]=b};a.generate_main_batches=function(a,c,d,e){for(var g=[],k=[],h=0;h<c.length;h++){var m=c[h],n=m._object;n.is_hair_dupli||(ra.is_dynamic(n)?g.push(m):k.push(m))}var p=[];p.push.apply(p,f(g,a._render.graph));p.push.apply(p,
l(k,a._render.graph));for(var g=[],k=[],t={},h=0;h<p.length;h++){var m=p[h].batch,n=p[h].render,q=null;if(m.id in t){var v=t[m.id],r=k[v].batch,B=k[v].render,x=null,w=null,ia=m.bb_local,z=m.be_local,A=m.bs_local,y=m.bb_world,u=m.be_world,F=m.bs_world;m.bb_local=null;m.be_local=null;m.bs_local=null;m.bb_world=null;m.be_world=null;m.bs_world=null;var E=r.bb_local,xa=r.be_local,Ha=r.bs_local,J=r.be_world,G=r.bb_world,D=r.bs_world;r.bb_local=null;r.be_local=null;r.bs_local=null;r.bb_world=null;r.be_world=
null;r.bs_world=null;for(var oa=0;oa<m.textures.length;oa++){var W=m.textures[oa].canvas_context;W&&(x||(x={}),x[oa]=W,m.textures[oa].canvas_context=null);if(W=m.textures[oa].video_file)w||(w={}),w[oa]=W,m.textures[oa].video_file=null}X.strict_objs_is_equal(m,r,!0)&&X.strict_objs_is_equal(n,B,!0)&&1!=m.inst_array_state&&(q=k[v]);m.bb_local=ia;m.be_local=z;m.bs_local=A;m.bb_world=y;m.be_world=u;m.bs_world=F;r.bb_local=E;r.be_local=xa;r.bs_local=Ha;r.bb_world=G;r.be_world=J;r.bs_world=D;if(x)for(oa in x)m.textures[oa].canvas_context=
x[oa];if(w)for(oa in w)m.textures[oa].video_file=w[oa];if(!q){do m.id++;while(t[m.id])}}q||(q={batch:m,render:p[h].render,rel_bpy_objects:[],submeshes:[],submeshes_world_tsr:[],mat_names:[]},t[m.id]=k.length,k.push(q));q.rel_bpy_objects.push.apply(q.rel_bpy_objects,p[h].rel_bpy_objects);p[h].submesh&&p[h].submesh.base_length&&(q.submeshes.push(p[h].submesh),q.submeshes_world_tsr.push(p[h].rel_bpy_objects[0]._object.render.world_tsr));if(q.mat_names.length)for(oa=0;oa<p[h].mat_names.length;oa++)m=
p[h].mat_names[oa],-1==q.mat_names.indexOf(m)&&q.mat_names.push(m);else q.mat_names=p[h].mat_names;ga.sort_two_arrays(q.mat_names,q.submeshes,ga.SORT_STRING,!1)}for(h=0;h<k.length;h++){t=k[h].submeshes;p=k[h].submeshes_world_tsr;m=k[h].batch;n=k[h].render;if(0==t.length)oa=ga.init_submesh(X.unique_name("%empty"));else if(1==t.length)oa=t[0];else{q=[];for(oa=0;oa<t.length;oa++)ga.is_long_submesh(t[oa])||q.push(oa);if(q.length<t.length)for(oa=0;oa<q.length;oa++)ga.submesh_drop_indices(t[q[oa]]);oa=
ga.submesh_list_join(t)}"PARTICLES"!=m.type&&(t=oa.submesh_bd,m.bb_local=N.clone_bb(t.bb_local),m.be_local=N.clone_be(t.be_local),m.bs_local=n.bs_local.radius<t.bs_local.radius?"STATIC"==n.type?N.clone_bs(n.bs_world):N.clone_bs(n.bs_local):N.clone_bs(t.bs_local),"STATIC"==n.type?(m.be_world=m.be_local,m.bb_world=m.bb_local,m.bs_world=m.bs_local):(n=p[0],m.be_world=N.bounding_ellipsoid_transform(m.be_local,n),m.bs_world=N.bounding_sphere_transform(m.bs_local,n),m.bb_world=N.bounding_box_transform(m.bb_local,
n)),m.use_be=N.is_be_optimized(m.be_local,m.bs_local));g.push({batch:m,render:k[h].render,submesh:oa,mat_names:k[h].mat_names,rel_bpy_objects:k[h].rel_bpy_objects})}for(k=0;k<g.length;k++)if(h=g[k].batch,h.material_names=g[k].mat_names,H(h,g[k].submesh),C(h,d,a),"STATIC"==g[k].render.type&&"COLOR_ID"!=h.type){m=X.unique_name("%meta%"+h.type+"%"+h.material_names.join("%")+"%");oa=ra.create_object(m,"MESH");oa.render=ra.clone_render(g[k].render);ra.append_scene_data(oa,a);ra.append_batch(oa,a,h);e.push(oa);
p=[];for(n=0;n<g[k].rel_bpy_objects.length;n++)m=g[k].rel_bpy_objects[n],m=m._object,N.extract_rot_bb_corners(m.render.bbr_world,p),"MAIN"==h.type&&m.meta_objects.push(oa);oa.render.be_world=N.create_be_by_bb(X.f32(p),!0);oa.render.be_local=N.calc_be_local_by_tsr(oa.render.be_world,oa.render.world_tsr);oa.render.bs_local=N.create_bs_by_be(oa.render.be_local);oa.render.bs_world=N.create_bs_by_be(oa.render.be_world);oa.render.use_be=N.is_be_optimized(oa.render.be_local,oa.render.bs_local)}else for(oa=
[],n=0;n<g[k].rel_bpy_objects.length;n++)m=g[k].rel_bpy_objects[n],m=m._object,-1==oa.indexOf(m.name)&&(ra.append_batch(m,a,h),oa.push(m.name),m.render.use_be=N.is_be_optimized(m.render.be_local,m.render.bs_local));if(Ga.debug_view){for(k=0;k<g.length;k++)if(d=g[k].render,"DYNAMIC"==d.type&&(m=g[k].rel_bpy_objects[0]._object,h=g[k].batch,"MAIN"==h.type)){n=ra.get_scene_data(m,a);oa=n.batches;p=!1;for(n=0;n<oa.length;n++)oa[n].debug_sphere&&(p=!0);p||(d=U(d,m.name,!0,h),ra.append_batch(m,a,d))}for(k=
0;k<e.length;k++)m=e[k],d=m.render,n=ra.get_scene_data(m,a),h=n.batches[0],"MAIN"==h.type&&(d=U(d,m.name,!1,h),ra.append_batch(m,a,d));for(k=0;k<g.length;k++)h=g[k].batch,"DEBUG_VIEW"==h.type&&(h.debug_id_color=k)}for(k=0;k<c.length;k++)for(n=ra.get_scene_data(c[k]._object,a),oa=n.batches,n=0;n<oa.length;n++)b(oa[n]);for(k=0;k<e.length;k++)for(n=ra.get_scene_data(e[k],a),oa=n.batches,n=0;n<oa.length;n++)b(oa[n])};a.append_sky_batch_to_world=function(a,c,e){var f=a._render.world_light_set,k=u("MAIN");
Q(k,"sky.glslv","sky.glslf");if(c.procedural_skydome)g(k,"PROCEDURAL_SKYDOME",1),k.draw_proc_sky=!0;else{var l=f.sky_texture_param,m=J.find_subs(a._render.graph,za.SKY).camera.color_attachment;T(k,m,"u_sky");l&&(g(k,"WO_SKYTEX",1),l.invert&&g(k,"MTEX_NEGATIVE",1),l.use_rgb_to_intensity&&g(k,"MTEX_RGBTOINT",1),g(k,"BLENDTYPE",l.blend_type),l.use_map_blend&&g(k,"WOMAP_BLEND",1),l.use_map_horizon&&g(k,"WOMAP_HORIZ",1),l.use_map_zenith_up&&g(k,"WOMAP_ZENUP",1),l.use_map_zenith_down&&g(k,"WOMAP_ZENDOWN",
1));f.use_sky_blend&&g(k,"WO_SKYBLEND",1);f.use_sky_paper&&g(k,"WO_SKYPAPER",1);f.use_sky_real&&g(k,"WO_SKYREAL",1)}c.reflexible&&(k.reflexible=!0,c.reflexible_only&&(k.reflexible_only=!0));k.offset_z=99999;x(k,"a_position");c=R.generate_fullscreen_quad();H(k,c);b(k);f=ra.get_scene_data(e,a);e.render.do_not_cull=!0;k.be_local=N.create_be();k.be_world=N.create_be();k.bb_local=N.create_bb();k.bb_world=N.create_bb();k.bs_local=N.create_bs();k.bs_world=N.create_bs();e=F(e.render);L(k,e);f.batches.push(k);
J.find_subs(a._render.graph,za.DEBUG_VIEW)&&(a=h(k),a.type="DEBUG_VIEW",a.subtype="",d(a),g(a,"DEBUG_VIEW_SPECIAL_SKYDOME",1),c.va_common.a_polyindex=ga.extract_polyindices(c),H(a,c),a.debug_main_batch_id=k.id,L(a,e),f.batches.push(a))};a.create_forked_batches=function(a,b,c){c=ra.get_scene_data(a,c).batches;var d=[];J.find_subs(b,za.SHADOW_CAST);var e=J.find_subs(b,za.MAIN_PLANE_REFLECT),g=J.find_subs(b,za.MAIN_CUBE_REFLECT),f=J.find_subs(b,za.OUTLINE_MASK);b=J.find_subs(b,za.COLOR_PICKING);for(var k=
0;k<c.length;k++){var l=c[k],m=null;"SHADOW"==l.type&&"RECEIVE"==l.subtype&&l.shadow_cast&&(m=h(l),m.subtype="CAST");"MAIN"!=l.type&&"PARTICLES"!=l.type||!e&&!g||!l.reflexible||(m=h(l),m.subtype="REFLECT",m.refractive=!1,m.z_sort&&(m.z_sort=!1,m.depth_mask=!1),m.particles_data=l.particles_data);"COLOR_ID"==l.type&&f&&a.render.outlining&&(b&&a.render.selectable?(m=h(l),m.subtype="OUTLINE"):l.subtype="OUTLINE");m&&(m.forked_batch=!0,L(m,a.render.id),d.push(m))}c.push.apply(c,d)};a.set_local_cylinder_capsule=
e;a.wb_angle_to_amp=function(a,b,c){b?b=c*(b.max_z-b.min_z):(b=1,X.panic("No bounding box for mesh"));if(0==b)return 0;a=b*Math.tan(X.deg_to_rad(a));return.5*(Math.sqrt(2*Math.sqrt(4*a+1)+2)/2-1)/b};a.bb_bpy_to_b4w=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.append_texture_to_batch=function(a,b,c,d){b=V.generate_batch_texure(b,d);T(a,b,c)};a.update_batch_material_error=K;a.update_batch_lights=C;a.set_lamp_data=M;a.assign_shadow_receive_dirs=
function(a,b,c){g(a,"CSM_SECTION1",0);g(a,"CSM_SECTION2",0);g(a,"CSM_SECTION3",0);g(a,"NUM_CAST_LAMPS",0);if(b){g(a,"NUM_CAST_LAMPS",b.lamp_types.length);Ga.mac_os_shadow_hack&&g(a,"MAC_OS_SHADOW_HACK",1);for(c=1;c<b.csm_num;c++)g(a,"CSM_SECTION"+String(c),1);g(a,"SHADOW_TEX_RES",na.glsl_value(b.csm_resolution));g(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);g(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else g(a,"SHADOW_TEX_RES",0),g(a,"CSM_FADE_LAST_CASCADE",0),g(a,"CSM_BLEND_BETWEEN_CASCADES",
0)};a.set_batch_directive=g;a.get_batch_directive=function(a,b){return na.get_directive(a.shaders_info,b)};a.update_batch_geometry=H;a.update_batch_id=L;a.calculate_render_id=F;a.apply_shader=Q;a.append_texture=T;a.replace_texture=function(a,b,c){c=a.texture_names.indexOf(c);-1<c&&(a.textures[c]=b)};a.create_shadeless_batch=function(a,b,c){var d=u("MAIN");1>c&&(d.blend=!0);aa.set(b[0],b[1],b[2],c,d.diffuse_color);d.draw_mode=ga.DM_TRIANGLES;H(d,a);Q(d,"main.glslv","main_stack.glslf");g(d,"SHADELESS",
1);W(d);return d};a.update_shader=W;a.generate_line_batches=function(a,c){for(var d=0;d<c.length;d++){var e=c[d]._object,g=u("LINE");Q(g,"line.glslv","line.glslf");g.blend=!0;var f=R.generate_line();H(g,f);b(g);g.bb_local=N.create_bb();g.bb_world=N.create_bb();g.be_local=N.create_be();g.be_world=N.create_be();g.bs_world=N.create_bs();g.bs_local=N.create_bs();ra.append_scene_data(e,a);ra.get_scene_data(e,a).batches.push(g);W(g)}};a.check_batch_perm_uniform=function(a,b){return a.shader.permanent_uniform_setters.length?
a.shader.permanent_uniform_setters_table[b]?!0:!1:!1};a.create_depth_pack_batch=function(a){a=u("DEPTH_PACK");a.use_backface_culling=!0;a.depth_mask=!1;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");W(a);return a};a.create_postprocessing_batch=function(a){var b=u("POSTPROCESSING");Q(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":g(b,"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":g(b,
"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":case "Y_BLUR":g(b,"POST_EFFECT","POST_EFFECT_BLUR");break;case "X_GLOW_BLUR":case "Y_GLOW_BLUR":g(b,"POST_EFFECT","POST_EFFECT_GLOW_BLUR");break;case "X_DOF_BLUR":case "Y_DOF_BLUR":g(b,"POST_EFFECT","POST_EFFECT_DOF_BLUR");break;case "X_ALPHA_BLUR":case "Y_ALPHA_BLUR":g(b,"POST_EFFECT","POST_EFFECT_ALPHA_BLUR");break;case "X_EXTEND":case "Y_EXTEND":g(b,"POST_EFFECT","POST_EFFECT_EXTEND");break;case "FLIP_CUBEMAP_COORDS":g(b,"POST_EFFECT",
"FLIP_CUBEMAP_COORDS");break;default:X.panic("Wrong postprocessing effect: "+a)}b.use_backface_culling=!0;b.depth_mask=!1;a=R.generate_fullscreen_tri();H(b,a);W(b);return b};a.create_ssao_batch=function(a){var b=u("SSAO");b.depth_mask=!1;b.use_backface_culling=!0;var c=R.generate_fullscreen_tri();H(b,c);Q(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");g(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ssao_samples);g(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:V.generate_texture("SSAO_TEXTURE",
a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=V.get_batch_texture(a,c);T(b,a,"u_ssao_special_tex");W(b);return b};a.create_ssao_blur_batch=function(a){var b=u("SSAO_BLUR");b.depth_mask=!1;b.use_backface_culling=!0;var c=R.generate_fullscreen_tri();H(b,c);Q(b,"postprocessing/postprocessing.glslv",
"postprocessing/ssao_blur.glslf");g(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);W(b);return b};a.create_coc_batch=function(a){var b=u("COC");b.depth_mask=!1;b.use_backface_culling=!0;var c=R.generate_fullscreen_tri();H(b,c);Q(b,"postprocessing/postprocessing.glslv","postprocessing/coc.glslf");g(b,"DEPTH_RGBA",1);switch(a){case "COC_ALL":g(b,"COC_TYPE","COC_ALL");break;case "COC_FOREGROUND":g(b,"COC_TYPE","COC_FOREGROUND");break;case "COC_COMBINE":g(b,"COC_TYPE","COC_COMBINE")}W(b);return b};a.create_dof_batch=
function(a){var b=u("DOF");b.depth_mask=!1;b.use_backface_culling=!0;var c=R.generate_fullscreen_tri();H(b,c);Q(b,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");a.camera.dof_bokeh?g(b,"DOF_TYPE","DOF_BOKEH"):(g(b,"DOF_TYPE","DOF_SIMPLE"),g(b,"DEPTH_RGBA",1));W(b);return b};a.create_outline_batch=function(){var a=u("OUTLINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");
W(a);return a};a.create_glow_combine_batch=function(){var a=u("GLOW_COMBINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");W(a);return a};a.create_god_rays_batch=function(a,b,c,d){a=u("GOD_RAYS");a.depth_mask=!1;a.use_backface_culling=!0;var e=R.generate_billboard();H(a,e);Q(a,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");g(a,"DEPTH_RGBA",b?1:0);g(a,"WATER_EFFECTS",c?1:0);
g(a,"STEPS_PER_PASS",na.glsl_value(d,1));W(a);return a};a.create_god_rays_combine_batch=function(a,b){var c=u("GOD_RAYS_COM");c.depth_mask=!1;c.use_backface_culling=!0;var d=R.generate_fullscreen_tri();H(c,d);Q(c,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");g(c,"SAFARI_CANVAS_ALPHA_HACK",Ga.safari_canvas_alpha_hack?1:0);W(c);return c};a.create_cube_sky_batch=function(a,b,c){var d=u("SKY");d.depth_mask=!1;d.use_backface_culling=!0;var e=R.generate_cube();H(d,e);c?
(Q(d,"skybox.glslv","proc_skybox.glslf"),g(d,"WATER_EFFECTS",1)):(Q(d,"skybox.glslv","tex_skybox.glslf"),a&&(a=a._render.world_light_set,a.sky_texture_slot&&(c=V.get_batch_texture(a.sky_texture_slot,null),T(d,c,c.name)),a.sky_texture_param&&g(d,"WO_SKYTEX",1)),b.sky_invert&&g(d,"MTEX_NEGATIVE",1),b.sky_use_rgb_to_intensity&&g(d,"MTEX_RGBTOINT",1),g(d,"BLENDTYPE",b.sky_blend_type),b.sky_use_map_blend&&g(d,"WOMAP_BLEND",1),b.sky_use_map_horizon&&g(d,"WOMAP_HORIZ",1),b.sky_use_map_zenith_up&&g(d,"WOMAP_ZENUP",
1),b.sky_use_map_zenith_down&&g(d,"WOMAP_ZENDOWN",1),b.use_sky_blend&&g(d,"WO_SKYBLEND",1),b.use_sky_paper&&g(d,"WO_SKYPAPER",1),b.use_sky_real&&g(d,"WO_SKYREAL",1));d.be_local=N.create_be();d.be_world=N.create_be();d.bb_local=N.create_bb();d.bb_world=N.create_bb();d.bs_local=N.create_bs();d.bs_world=N.create_bs();W(d);return d};a.append_cube_sky_batch_to_world=function(a,b){var c=J.find_subs(a._render.graph,za.SKY);c&&(c=c.draw_data[0].bundles[0].batch,ra.get_scene_data(b,a).batches.push(c))};a.create_antialiasing_batch=
function(a){var b=u("ANTIALIASING");b.depth_mask=!1;b.use_backface_culling=!0;var c=R.generate_fullscreen_tri();H(b,c);Q(b,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");Ga.quality_aa_method?(g(b,"AA_METHOD","AA_METHOD_FXAA_QUALITY"),g(b,"AA_QUALITY",a.fxaa_quality)):g(b,"AA_METHOD","AA_METHOD_FXAA_LIGHT");W(b);return b};a.create_smaa_batch=function(a){var b=u("SMAA"),c=R.generate_fullscreen_tri();H(b,c);Q(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");g(b,
"AA_METHOD","AA_METHOD_SMAA_HIGH");g(b,"SMAA_PASS",a);g(b,"SMAA_PREDICATION",0);g(b,"SMAA_REPROJECTION",0);W(b);b.depth_mask=!1;b.use_backface_culling=!0;return b};a.create_compositing_batch=function(){var a=u("COMPOSITING");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");W(a);return a};a.create_motion_blur_batch=function(a){a=u("MOTION_BLUR");a.use_backface_culling=!0;a.depth_mask=!1;
var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");W(a);return a};a.create_stereo_batch=function(a){var b=u("STEREO");b.use_backface_culling=!0;b.depth_mask=!1;var c=R.generate_fullscreen_tri();H(b,c);Q(b,"postprocessing/postprocessing.glslv","postprocessing/stereo.glslf");g(b,"ANAGLYPH","ANAGLYPH"===a?1:0);W(b);return b};a.create_luminance_batch=function(){var a=u("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();
H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");W(a);return a};a.create_average_luminance_batch=function(){var a=u("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");W(a);return a};a.create_luminance_trunced_batch=function(){var a=u("LUMINANCE_X_BLUR");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/luminance_trunced.glslv",
"postprocessing/luminance_trunced.glslf");W(a);return a};a.create_bloom_blur_batch=function(){var a=u("POSTPROCESSING");a.use_backface_culling=!0;a.depth_mask=!1;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");W(a);return a};a.create_bloom_combine_batch=function(){var a=u("BLOOM");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");
W(a);return a};a.create_velocity_batch=function(){var a=u("VELOCITY");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");W(a);return a};a.create_anchor_visibility_batch=function(){var a=u("ANCHOR_VISIBILITY");a.depth_mask=!0;a.use_backface_culling=!0;a.draw_mode=ga.DM_POINTS;Q(a,"anchors.glslv","anchors.glslf");var b=R.generate_index(1);H(a,b);g(a,"ANCHOR_NUM",1);W(a);a.anchor_positions=new Float32Array(3);
return a};a.create_performance_batch=function(){var a=u("PERFORMANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=R.generate_fullscreen_tri();H(a,b);Q(a,"postprocessing/postprocessing.glslv","postprocessing/performance.glslf");W(a);return a};a.update_anchor_visibility_batch=function(a,b){var c=b.length/3;if(c!=a.anchor_positions.length/3){var d=R.generate_index(c);H(a,d);g(a,"ANCHOR_NUM",c);W(a)}a.anchor_positions=b};a.get_first_batch=function(a){if(!a.scenes_data.length)return null;a=a.scenes_data[0];
return a.batches.length?a.batches[0]:null};a.find_batch_material=ha;a.find_batch_material_forked=Y;a.set_material_props=Z;a.check_batch_type=function(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.clear_batch=function(a){for(var b=a.textures,c=0;c<b.length;c++){var d=b[c];d.cleanup_gl_data_on_unload&&V.delete_texture(d.w_texture)}a.bufs_data.cleanup_gl_data_on_unload&&ga.cleanup_bufs_data(a.bufs_data);a.cleanup_gl_data_on_unload&&a.vaos.length&&ua.cleanup_vao(a);
a.shader.cleanup_gl_data_on_unload&&na.cleanup_shader(a.shader);a.ngraph_proxy_id&&(b=Aa.get_ngraph_proxy_cached(a.ngraph_proxy_id))&&b.cleanup_on_unload&&Aa.cleanup_ngraph_proxy(a.ngraph_proxy_id)};a.inherit_material=function(a,b,c,d){for(var e=["MAIN","SHADOW","COLOR_ID"],g=!1,f=0;f<e.length;f++){var k=e[f],h=ha(a,b,k),l=ha(c,d,k);if(h&&l){var g=!0,m=Y(c,d,k);"MAIN"==k&&(Z(l,h),m&&Z(m,h));for(k=0;k<l.texture_names.length;k++){var n=l.texture_names[k];if(-1!==La.indexOf(n)){var p=h.texture_names.indexOf(n);
-1!==p&&(l.textures[k]=h.textures[p],m&&(n=m.texture_names.indexOf(n),-1!==n&&(m.textures[n]=h.textures[p])))}}}}g||I.error("Wrong objects for inheriting material!")};a.set_nodemat_value=function(a,b,c,d){for(var e=0;e<a.scenes_data.length;e++)for(var g=a.scenes_data[e].batches,f=0;f<g.length;f++){var k=g[f];-1!=k.material_names.indexOf(b)&&k.node_values&&(k.node_values[c]=d)}};a.set_nodemat_rgb=function(a,b,c,d,e,g){for(var f=0;f<a.scenes_data.length;f++)for(var k=a.scenes_data[f].batches,h=0;h<
k.length;h++){var l=k[h];-1!=l.material_names.indexOf(b)&&l.node_rgbs&&(l.node_rgbs[3*c]=d,l.node_rgbs[3*c+1]=e,l.node_rgbs[3*c+2]=g)}};a.get_nodemat_value=function(a,b){return a.node_values[b]};a.get_nodemat_rgb=function(a,b,c){c[0]=a.node_rgbs[3*b];c[1]=a.node_rgbs[3*b+1];c[2]=a.node_rgbs[3*b+2];return c};a.get_node_ind_by_name_list=function(a,b){var c;c=b[1];for(var d=2;d<b.length;d++)c+="%join%"+b[d];for(d=0;d<a.length;d+=2)if(a[d]==c)return a[d+1];return null};a.cleanup=function(){Ha={}}};b4w.module.__nodemat=function(a,r){function u(a,b,d,g,f){var p=Ga.get_active(),p=l(b,f,p.uuid);if(p in Ca)return Ca[p];var v={graph:null,id:p,cleanup_on_unload:!0};d||(oa={},xa=0);if("SHADOW"!=f&&"COLOR_ID"!=f){b=V.create();for(var r=a.nodes,w=0;w<r.length;w++)if(null==H(b,r[w],0,g,f))return Ca[p]=null,v;if(d&&-1==x(a,b,"GROUP_OUTPUT","group"))return v;w=Aa(b);r=d?a.links:a.links.slice();if(!ra(b,r,w))return v;if(d)return v.graph=b,v;for(w=0;w<r.length;w++){d=r[w];for(var ia=k(d.from_node,b),z=k(d.to_node,
b),A=0;A<ia.length;A++)for(var C=0;C<z.length;C++){var y=ia[A],F=z[C],G=V.get_node_attr(b,y),D=V.get_node_attr(b,F);if(!da(b,y,F,G,D,d))return Ca[p]=null,v}}c(b);a="GLOW"==f?x(a,b,"B4W_GLOW_OUTPUT","material",!0):x(a,b,"OUTPUT","material",!1,!0);-1==a&&(b=e(),a=0);m(b);a=V.subgraph_node_conn(b,a,V.BACKWARD_DIR);h(a,g,f);n(a);E(a);t(a);B(a,g,f);J(a)}else g=u(a,b,d,g,"MAIN"),g=V.clone(g.graph,function(a){var b=ja.clone_object_nr(a);b.inputs=ja.clone_object_r(a.inputs);b.outputs=ja.clone_object_r(a.outputs);
return b}),a=x(a,g,"OUTPUT","material",!1,!0),q(g,a),a=V.subgraph_node_conn(g,a,V.BACKWARD_DIR),n(a);v.graph=a;return Ca[p]=v}function h(a,c,d){var e=[];V.traverse(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||e.push({node_id:a,node:b})});for(d=0;d<e.length;++d){var g=e[d].node_id,f=e[d].node,k=V.gen_node_id(a);V.append_node(a,k,f.data.material_begin);var h=V.gen_node_id(a);V.append_node(a,h,f.data.material_end);V.append_edge(a,k,h,[4,2]);for(var l={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",
6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},m=V.in_edge_count(a,g),n=[],p=[],t=[],q={},v=0;v<m;v++){var r=V.get_in_edge(a,g,v);r in q||(q[r]=0);var B=V.get_edge_attr(a,r,g,q[r]++);n.push([r,g,B]);var x=l[B[1]];if(x)switch(x[0]){case "MATERIAL_END":p.push([r,h,[B[0],x[1]]]);break;case "LIGHTING_APPLY":t.push([r,[B[0],x[1]]])}else p.push([r,k,B])}b(a,f.data.value,k,h,t,c);for(v=0;v<n.length;v++)V.remove_edge_by_attr(a,n[v][0],n[v][1],n[v][2]);for(v=0;v<p.length;v++)V.append_edge(a,
p[v][0],p[v][1],p[v][2]);f=V.out_edge_count(a,g);k=[];l=[];m={};for(v=0;v<f;v++)n=V.get_out_edge(a,g,v),n in m||(m[n]=0),B=V.get_edge_attr(a,g,n,m[n]++),k.push([g,n,B]),l.push([h,n,B]);for(v=0;v<k.length;v++)V.remove_edge_by_attr(a,k[v][0],k[v][1],k[v][2]);for(v=0;v<l.length;v++)V.append_edge(a,l[v][0],l[v][1],l[v][2]);V.remove_node(a,g)}}function b(a,b,c,d,e,g){var k={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},h=H(a,k,0,g,null),l=h;f(a,c,h,"E");f(a,c,h,"A");f(a,c,h,"D");h=Ga.get_active();h=
X.get_scene_objs(h,"LAMP",X.DATA_ID_ALL);if(!b.use_shadeless)for(var m,n,p,t=0;t<h.length;t++){p=h[t].light;k={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};m=H(a,k,0,g,null);k={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};n=H(a,k,0,g,null);f(a,l,n,"color");f(a,l,n,"specular");f(a,m,n,"ldir");f(a,c,n,"normal");f(a,c,n,"D");f(a,c,n,"S");f(a,m,n,"lcolorint");f(a,c,m,"shadow_factor");l="SPECULAR_"+b.specular_shader;k={name:l,type:l,use_tangent_shading:b.use_tangent_shading};l=H(a,k,0,g,null);f(a,m,l,"ldir");
f(a,m,l,"lfac");f(a,c,l,"normal");f(a,l,n,"sfactor");f(a,m,l,"norm_fac");f(a,c,l,"sp_params");l="HEMI"==p.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.diffuse_shader;k={name:l,type:l,use_tangent_shading:b.use_tangent_shading};p=H(a,k,0,g,null);f(a,m,p,"ldir");f(a,m,p,"lfac");f(a,c,p,"normal");f(a,m,p,"norm_fac");f(a,p,n,"lfactor");"DIFFUSE_LAMBERT"!=l&&f(a,c,p,"dif_params");for(m=0;m<e.length;m++)V.append_edge(a,e[m][0],n,e[m][1]);l=n}f(a,l,d,"color");f(a,l,d,"specular")}function f(a,b,c,d){for(var e=V.get_node_attr(a,
b),g=V.get_node_attr(a,c),f,k=0;k<g.inputs.length;k++)if(d==g.inputs[k].identifier){f=k;break}for(var h,k=0;k<e.outputs.length;k++)if(d==e.outputs[k].identifier){h=k;break}void 0!=f&&void 0!=h&&V.append_edge(a,b,c,[h,f])}function l(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "SHADOW":return a+c+"00";default:return a+c+"10"}}function q(a,b){V.traverse_edges(a,function(c,d,e){var g=V.get_node_attr(a,d);d==b&&"Color"==g.inputs[e[1]].identifier&&V.remove_edge_by_attr(a,c,d,e)})}
function e(){var a=V.create(),b={data:null,dirs:[],params:[],inputs:[{default_value:new Float32Array([0,0,0]),identifier:"Color",is_linked:!1,name:"Color"},{default_value:1,identifier:"Alpha",is_linked:!1,name:"Alpha"}],outputs:[],type:"OUTPUT",vparams:[]};V.append_node(a,0,b);return a}function n(a){V.traverse(a,function(b,c){for(var d=c.inputs,e=c.outputs,g=0;g<d.length;g++)p(a,d[g],b,g,1);for(g=0;g<e.length;g++)p(a,e[g],b,g,0)})}function p(a,b,c,d,e){if(b.is_linked){var g=!0;V.traverse_edges(a,
function(a,b,f){if(!e&&a==c&&f[0]==d||e&&b==c&&f[1]==d)g=!1});g&&(b.is_linked=!1)}}function B(a,b,c){var d=[];V.traverse_edges(a,function(e,f,k){var h=V.get_node_attr(a,e),l=V.get_node_attr(a,f),h=ja.is_vector(h.outputs[k[0]].default_value),l=ja.is_vector(l.inputs[k[1]].default_value);if(h!=l){var m,n={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},p={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};h&&!l?m=g("vector_to_scalar","B4W_VECTOSCAL",[n],[p]):!h&&l&&(m=
g("scalar_to_vector","B4W_SCALTOVEC",[p],[n]));H(a,m,0,b,c);d.push([e,f,a.nodes[a.nodes.length-2],k])}});for(var e=0;e<d.length;++e)V.remove_edge_by_attr(a,d[e][0],d[e][1],d[e][3]),V.append_edge(a,d[e][0],d[e][2],[d[e][3][0],0]),V.append_edge(a,d[e][2],d[e][1],[0,d[e][3][1]])}function c(a){var b=[];V.traverse(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":V.traverse_edges(a,function(e,g,f){var k=V.get_node_attr(a,g);e==c&&"MATERIAL_EXT"==k.type&&"Translucency"==d.outputs[f[0]].name&&b.push(e,
g,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)V.append_edge(a,b[c],b[c+1],b[c+2])}function k(a,b){var c=[];V.traverse(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;ja.panic("Node not found")}function m(a){var b=[];V.traverse(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var g=A(a,d,1);if(-1!=g){var f=V.get_in_edge(a,g,0);V.remove_edge(a,g,d,-1);-1!=f&&V.remove_edge(a,f,g,
-1);d=V.get_node_attr(a,g);e.data=d.data;e.params[0]=d.params[0];V.remove_node(a,g)}e.inputs.splice(1,1)}else if("REROUTE"==e.type){for(var g=V.get_in_edge(a,d,0),k=V.out_edge_count(a,d),f=[],h=[],l=[],m=0;m<k;m++){for(var n=V.get_out_edge(a,d,m),p=h.indexOf(n),t=e.outputs,q=0;q<t.length;q++)t[q].default_value=e.inputs[0].default_value;-1!=p?l[p]+=1:(h.push(n),l.push(1),f.push(d,n))}if(-1!=g)for(e=V.get_edge_attr(a,g,d,0)[0],m=0;m<h.length;m++)for(q=0;q<l[m];q++)k=V.get_edge_attr(a,d,h[m],q)[1],V.append_edge(a,
g,h[m],[e,k]);for(m=0;m<f.length;m+=2)V.remove_edge(a,f[m],f[m+1],-1)}}}function A(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d+1]==b&&a[d+2][1]==c)return a[d];return-1}function E(a){v(a);D(a);w(a)}function w(a,b){var c=[],e="",f="",k={};V.traverse(a,function(a,b){if("GEOMETRY_UV"==b.type||"UVMAP"==b.type||"TEX_COORD_UV"==b.type){c.push(a,b);var d=b.data.value;e?e==d||f||(f=d,k[f]=0):(e=d,k[e]=0);k[d]++}});for(var h in k)if(2>k[h]){for(var l=0;l<c.length;l+=2)c[l+1].data.value==h&&c.splice(l,
2);delete k[h];e==h&&(e=f,f="");f==h&&(f="")}if(!(3>c.length)){var l={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},m={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,name:"UV_cycles"};h=g("merged_uv","UV_MERGED",[],[l,m]);h.uv_layer=e;H(a,h,0,"",b);var n=a.nodes[a.nodes.length-2];h=a.nodes[a.nodes.length-1];if(f){m=g("merged_uv","UV_MERGED",[],[l,m]);m.uv_layer=f;H(a,m,0,"",b);var p=a.nodes[a.nodes.length-2],m=a.nodes[a.nodes.length-1]}else m=null;for(var t=-1,
q=null,l=0;l<c.length;l+=2){var v=c[l],r=c[l+1];d(r,c[1])?(t=n,q=h):m&&(t=p,q=m);for(var B=[],x=V.out_edge_count(a,v),w={},ia=0;ia<x;ia++){var z=V.get_out_edge(a,v,ia);z in w||(w[z]=0);var A=V.get_edge_attr(a,v,z,w[z]++);B.push(v,z,A);A=A.splice(0,A.length);switch(r.type){case "GEOMETRY_UV":A[0]=0;q.outputs[0].is_linked=!0;break;case "UVMAP":case "TEX_COORD_UV":A[0]=1,q.outputs[1].is_linked=!0}V.append_edge(a,t,z,A)}for(var ia=0;ia<B.length;ia+=3)V.remove_edge(a,B[ia],B[ia+1],0);V.remove_node(a,v)}}}
function v(a){var b=[];V.traverse(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],g=b[d+1],f=!0,k=0;k<c.length;k++){var h=c[k];if(K(g,h.attr)){f=[];k=V.out_edge_count(a,e);for(n=0;n<k;n++){var l=V.get_out_edge(a,e,n),m=V.get_edge_attr(a,e,l,0);f.push(e,l,m);V.append_edge(a,h.id,l,m)}for(var n=0;n<f.length;n+=
3)V.remove_edge(a,f[n],f[n+1],0);V.remove_node(a,e);f=!1;break}}f&&(h={id:e,attr:g},c.push(h))}}function z(a){for(var b={},c=0;c<a.nodes.length;c+=2){var d=a.nodes[c];b[d]={ascs_ids:{},is_completed:!1}}for(c=0;c<a.edges.length;c+=3)b[a.edges[c+1]].ascs_ids[a.edges[c]]=!0;for(d in b)y(d,b);for(d in b)b[d]=Object.keys(b[d].ascs_ids).map(function(a){return parseInt(a)});return b}function y(a,b){var c=b[a];if(!c.is_completed){var d=ja.clone_object_r(c),e;for(e in c.ascs_ids){y(e,b);var c=b[e],g;for(g in c.ascs_ids)d.ascs_ids[g]=
!0}d.is_completed=!0;b[a]=d}}function D(a){var b=[];V.traverse(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=z(a),d=[],e=0;e<b.length;e+=2){for(var g=b[e],f=b[e+1],k=!0,h=0;h<d.length;h++){var l=d[h];if(!(3<=l.merged_nodes.length||!K(f,l.attr)||-1<c[g].indexOf(l.id)||-1<c[l.id].indexOf(g))){for(var m=!1,n=0;n<l.merged_nodes.length;n++){var p=l.merged_nodes[n].id;if(-1<c[g].indexOf(p)||-1<c[p].indexOf(g)){m=!0;break}}if(!m){for(var h=[],p=V.in_edge_count(a,
g),t={},n=0;n<p;n++)m=V.get_in_edge(a,g,n),m in t||(t[m]=0),k=V.get_edge_attr(a,m,g,t[m]++),h.push(m,g,k);for(var p=[],t=V.out_edge_count(a,g),q={},n=0;n<t;n++)m=V.get_out_edge(a,g,n),m in q||(q[m]=0),k=V.get_edge_attr(a,g,m,q[m]++),p.push(g,m,k);k=h.concat(p);for(n=0;n<k.length;n+=3)V.remove_edge(a,k[n],k[n+1],0);V.remove_node(a,g);n={id:g,attr:f,edges_in:h,edges_out:p};l.merged_nodes.push(n);k=!1;break}}}k&&(l={id:g,attr:f,merged_nodes:[]},d.push(l))}for(e=0;e<d.length;e++){l=d[e];c=l.merged_nodes.length;
for(h=0;h<c;h++){f=l.merged_nodes[h];n=f.attr;g=f.edges_in;f=f.edges_out;l.attr.inputs[h+1].is_linked=n.inputs[0].is_linked;l.attr.inputs[h+1].default_value=n.inputs[0].default_value;l.attr.outputs[2*(h+1)].is_linked=n.outputs[0].is_linked;l.attr.outputs[2*(h+1)].default_value=n.outputs[0].default_value;l.attr.outputs[2*(h+1)+1].is_linked=n.outputs[1].is_linked;l.attr.outputs[2*(h+1)+1].default_value=n.outputs[1].default_value;for(n=0;n<g.length;n+=3)m=g[n],k=g[n+2],k[1]+=h+1,V.append_edge(a,m,l.id,
k);for(n=0;n<f.length;n+=3)m=f[n+1],k=f[n+2],k[0]+=2*(h+1),V.append_edge(a,l.id,m,k);l.attr.dirs.push(["USE_uv"+(h+2),1])}V.remove_node(a,l.id);V.append_node(a,l.id,l.attr)}}}function K(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value.uuid==b.data.value.uuid;default:return!1}}
function d(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function t(a){var b=[],c=[];V.traverse(a,function(a,d){"GEOMETRY_VC"==d.type&&b.push(a,d);"GEOMETRY_VW"==d.type&&c.push(a,d)});C(a,b);M(a,c)}function C(a,b){for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],g=!1,f=[],k=[],h=[[],[],[]],l=V.out_edge_count(a,d),m=0;m<l;m++){var n=V.get_out_edge(a,d,m);if("SEPRGB"!=V.get_node_attr(a,n).type){g=!1;break}f.push(d,
n);for(var p={},t=V.out_edge_count(a,n),g=0;g<t;g++){var q=V.get_out_edge(a,n,g);q in p||(p[q]=0);var v=V.get_edge_attr(a,n,q,p[q]++);f.push(n,q);h[v[0]].push(d,q,v)}k.push(n);g=!0}if(g){for(m=d=l=0;m<h.length;m++)h[m].length&&(l++,d|=1<<2-m);if(l){e.type+=l;e.outputs=[];for(m=0;m<h.length;m++)if(h[m].length)for(e.outputs.push({default_value:0,identifier:"RGB"[m],is_linked:!0,name:"RGB"[m]}),g=0;g<h[m].length;g+=3)h[m][g+2][0]=ja.rgb_mask_get_channel_presence_index(d,m);for(m=0;m<f.length;m+=2)V.remove_edge(a,
f[m],f[m+1],0);for(m=0;m<k.length;m++)V.remove_node(a,k[m]);for(m=0;m<h.length;m++)for(g=0;g<h[m].length;g+=3)V.append_edge(a,h[m][g],h[m][g+1],h[m][g+2])}}}}function M(a,b){for(var c=0;c<b.length;c+=2){for(var d=b[c],e=!0,g=[],f=V.out_edge_count(a,d),k=0;k<f;k++){var h=V.get_out_edge(a,d,k);if("B4W_REFLECT"==V.get_node_attr(a,h).type){var l=V.get_edge_attr(a,d,h,0),m=V.get_edge_attr(a,d,h,1);l&&1==l[1]||m&&1==m[1]?e=!1:g.push(d,h)}else e=!1}for(k=0;k<g.length;k+=2)f=a,l=g[k],h=g[k+1],m=V.get_node_attr(f,
h),m.type+="_WORLD",V.remove_edge(f,l,h,0),m.inputs.splice(0,1),l=V.get_in_edge(f,h,0),l!=V.NULL_NODE&&(V.get_edge_attr(f,l,h,0)[1]=0);e&&V.remove_node(a,d)}}function x(a,b,c,d,e,g){a=a.nodes;for(var f=null,h=0;h<a.length;h++){var l=a[h];e?"GROUP"==l.type&&l.node_tree_name==c&&(f=l):l.type==c&&(f=l)}return f?k(f,b)[0]:(g||ea.error('No "'+c+'" node in node '+d),-1)}function g(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function H(a,b,c,d,e){var g=b.name,f=b.type,k=[],h=[],l=[],m=[],n=null,p=
[];switch(f){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":h=
ca(b);l=I(b);ea.warn(f+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":h=ca(b);l=I(b);break;case "UVMAP":var t=b.uv_layer;t||(f="EMPTY_UV");if("EMPTY_UV"!=f){var n=F("param_"+f+"_a"),q=F("param_"+f+"_v");k.push(ma(n));k.push(ma(q));m.push(ma(q));n={name:n,value:t}}l=I(b);break;case "UV_MERGED":n=F("param_UV_MERGED_a");q=F("param_UV_MERGED_v");k.push(ma(n));k.push(ma(q));l.push(Y(b,"UV_geom"));l.push(Y(b,"UV_cycles"));m.push(ma(q));n={name:n,value:b.uv_layer};
break;case "CAMERA":h=[];l=I(b);break;case "COMBRGB":case "COMBHSV":h=ca(b);l=I(b);break;case "CURVE_RGB":case "CURVE_VEC":"CURVE_RGB"==f?(na(b,0,0,1)&&p.push(["READ_R",1]),na(b,1,0,1)&&p.push(["READ_G",1]),na(b,2,0,1)&&p.push(["READ_B",1]),na(b,3,0,1)&&p.push(["READ_A",1])):(na(b,0,-1,1)&&p.push(["READ_R",1]),na(b,1,-1,1)&&p.push(["READ_G",1]),na(b,2,-1,1)&&p.push(["READ_B",1]));h=ca(b);l=I(b);n={value:b};break;case "PARTICLE_INFO":h=ca(b);l=I(b);for(q=0;q<b.outputs.length;q++){var v=b.outputs[q],
r=v.identifier,B=ma("v_param_PART_INFO_"+r.replace(" ",""));if(v.is_linked)switch(r){case "Size":p.push(["PART_INFO_SIZE",aa.glsl_value(1)]);break;case "Age":p.push(["PART_INFO_AGE",aa.glsl_value(1)]);break;case "Lifetime":p.push(["PART_INFO_LT",aa.glsl_value(1)]);break;case "Location":p.push(["PART_INFO_LOC",aa.glsl_value(1)]);break;case "Index":n=t=ma("a_param_PART_INFO_"+v.identifier.replace(" ",""));p.push(["PART_INFO_IND",aa.glsl_value(1)]);break;case "Velocity":p.push(["PART_INFO_VEL",aa.glsl_value(1)]);
break;case "Angular Velocity":p.push(["PART_INFO_A_VEL",aa.glsl_value(1)])}"Age"!=r&&"Lifetime"!=r&&"Size"!=r&&(k.push(B),m.push(B))}t&&k.push(t);break;case "GEOMETRY":if(!U(b))return!0;f=Q(b,c);if(!f)return ea.error("Geometry output is not supported"),null;switch(f){case "GEOMETRY_UV":(t=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(n=F("param_GEOMETRY_UV_a"),q=F("param_GEOMETRY_UV_v"),k.push(ma(n)),k.push(ma(q)),m.push(ma(q)),n={name:n,value:t});l.push(Y(b,"UV"));break;case "GEOMETRY_VC":(t=b.color_layer)||
(f="EMPTY_VC");"EMPTY_VC"!=f&&(n=F("param_GEOMETRY_VC_a"),q=F("param_GEOMETRY_VC_v"),k.push(ma(n)),k.push(ma(q)),m.push(ma(q)),n={name:n,value:t});l.push(Y(b,"Vertex Color"));break;case "GEOMETRY_NO":l.push(Y(b,"Normal"));break;case "GEOMETRY_FB":l.push(Y(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(Y(b,"View"));break;case "GEOMETRY_GL":l.push(Y(b,"Global"));break;case "GEOMETRY_LO":l.push(Y(b,"Local"));break;case "GEOMETRY_OR":t=F("param_GEOMETRY_OR_v"),k.push(ma(t)),l.push(Y(b,"Orco")),m.push(ma(t))}break;
case "TEX_COORD":if(!U(b))return!0;f=T(b,c);if(!f)return ea.error("Texture coordinate output is not supported"),null;switch(f){case "TEX_COORD_UV":(t=b.uv_layer)||(f="EMPTY_UV");"EMPTY_UV"!=f&&(n=F("param_TEX_COORD_UV_a"),q=F("param_TEX_COORD_UV_v"),k.push(ma(n)),k.push(ma(q)),m.push(ma(q)),n={name:n,value:b.uv_layer});l.push(Y(b,"UV"));break;case "TEX_COORD_NO":l.push(Y(b,"Normal"));break;case "TEX_COORD_GE":t=F("param_TEX_COORD_GE_v");k.push(ma(t));l.push(Y(b,"Generated"));m.push(ma(t));break;case "TEX_COORD_OB":l.push(Y(b,
"Object"));ea.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":l.push(Y(b,"Camera"));break;case "TEX_COORD_WI":l.push(Y(b,"Window"));ea.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":l.push(Y(b,"Reflection")),ea.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;case "GROUP":t=b.node_tree_name;switch(t){case "B4W_LINEAR_TO_SRGB":if(!G(b,[1],[1])){n=
ba(b,d,e);break}f="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!G(b,[1],[1])){n=ba(b,d,e);break}f="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!G(b,[1],[1])){n=ba(b,d,e);break}f="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!G(b,[1,1],[1])){n=ba(b,d,e);break}f="B4W_REFLECT";break;case "B4W_REFRACTION":if(!G(b,[1,0],[1])){n=ba(b,d,e);break}f="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!G(b,[1,1,0,0,0],[1])){n=ba(b,d,e);break}f="B4W_PARALLAX";q=F("temp_texture");
m.push(ma(q));break;case "B4W_CLAMP":if(!G(b,[1],[1])){n=ba(b,d,e);break}f="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!G(b,[0,0,0,0,0],[0])){n=ba(b,d,e);break}f="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!G(b,[],[0])){n=ba(b,d,e);break}f="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!G(b,[0,0,0],[0])){n=ba(b,d,e);break}f="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":f="B4W_GLOW_OUTPUT";break;default:n=ba(b,d,e)}h=ca(b);l=I(b);"B4W_TRANSLUCENCY"==t&&(t=N("TranslucencyParams","TranslucencyParams",[0,
0,0,0]),t.is_linked=l[0].is_linked,l.push(t));break;case "LAMP":n=b.lamp;if(!n)return ea.error("There is no lamp in node: "+b.name),null;l.push(Y(b,"Color"));l.push(Y(b,"Light Vector"));l.push(Y(b,"Distance"));l.push(Y(b,"Visibility Factor"));n.uuid in oa?p.push(["LAMP_INDEX",String(oa[n.uuid])]):(oa[n.uuid]=xa,p.push(["LAMP_INDEX",String(xa++)]));n=oa;break;case "LIGHTING_AMBIENT":h=[N("E","E",[0,0,0],!0),N("A","A",[0,0,0],!0),N("D","D",[0,0,0],!0)];l=[N("color","color",[0,0,0],!0),N("specular",
"specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":l=[N("E","E",[0,0,0],!0),N("A","A",[0,0,0],!0),N("D","D",[0,0,0],!0),N("S","S",[0,0,0],!0),N("normal","normal",[0,0,0],!0),N("dif_params","dif_params",[0,0],!0),N("sp_params","sp_params",[0,0],!0),N("shadow_factor","shadow_factor",0,!0),N("translucency_color","translucency_color",0,!0),N("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":h=[N("color","color",[0,0,0],!0),N("specular","specular",[0,0,0],!0)];break;
case "LIGHTING_LAMP":h=[N("shadow_factor","shadow_factor",0,!0)];l=[N("ldir","ldir",[0,0,0],!0),N("lfac","lfac",[0,0],!0),N("lcolorint","lcolorint",[0,0,0],!0),N("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":h=[N("ldir","ldir",[0,0,0],!0),N("lfac","lfac",[0,0],!0),N("normal","normal",[0,0,0],!0),N("norm_fac","norm_fac",0,!0)];l=[N("lfactor","lfactor",0,!0)];p.push(["MAT_USE_TBN_SHADING",b.use_tangent_shading|0]);break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":h=
[N("ldir","ldir",[0,0,0],!0),N("lfac","lfac",[0,0],!0),N("normal","normal",[0,0,0],!0),N("norm_fac","norm_fac",0,!0),N("dif_params","dif_params",[0,0],!0)];l=[N("lfactor","lfactor",0,!0)];p.push(["MAT_USE_TBN_SHADING",b.use_tangent_shading|0]);break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":case "SPECULAR_COOKTORR":h=[N("ldir","ldir",[0,0,0],!0),N("lfac","lfac",[0,0],!0),N("normal","normal",[0,0,0],!0),N("norm_fac","norm_fac",0,!0),N("sp_params","sp_params",[0,0],!0)];l=[N("sfactor","sfactor",0,
!0)];p.push(["MAT_USE_TBN_SHADING",b.use_tangent_shading|0]);break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":h=[N("ldir","ldir",[0,0,0],!0),N("lfac","lfac",[0,0],!0),N("normal","normal",[0,0,0],!0),N("norm_fac","norm_fac",0,!0),N("sp_params","sp_params",[0,0],!0)];l=[N("sfactor","sfactor",0,!0)];p.push(["MAT_USE_TBN_SHADING",b.use_tangent_shading|0]);break;case "LIGHTING_APPLY":h=[N("color","color",[0,0,0,0],!0),N("specular","specular",[0,0,0],!0),N("lfactor","lfactor",0,!0),N("sfactor","sfactor",
0,!0),N("ldir","ldir",[0,0,0],!0),N("normal","normal",[0,0,0],!0),N("translucency_params","translucency_params",[0,0,0,0],!0),N("D","D",[0,0,0],!0),N("S","S",[0,0,0],!0),N("lcolorint","lcolorint",[0,0,0],!0),N("translucency_color","translucency_color",0,!0)];l=[N("color","color",[0,0,0,0],!0),N("specular","specular",[0,0,0],!0)];break;case "NORMAL":h=ca(b);l=I(b);t=Y(b,"Normal");m.push(ma(F("param_NORMAL_Normal"),t.default_value,3));break;case "MAPPING":t=b.vector_type;f="MAPPING";h.push(ha(b,"Vector"));
l.push(Y(b,"Vector"));var q=ja.f32(b.rotation),v=ja.f32(b.scale),r=ja.f32(b.translation),B=wa.create(),x=ja.euler_to_rotation_matrix(q);"TEXTURE"==t&&(v[0]=v[0]||1,v[1]=v[1]||1,v[2]=v[2]||1);var w=new Float32Array([v[0],0,0,0,v[1],0,0,0,v[2]]);wa.multiply(x,w,B);B=ja.mat3_to_mat4(B,ga.create());switch(t){case "POINT":B[12]=r[0];B[13]=r[1];B[14]=r[2];break;case "TEXTURE":B[12]=r[0];B[13]=r[1];B[14]=r[2];B=ga.invert(B,B);break;case "NORMAL":ga.invert(B,B),ga.transpose(B,B)}switch(t){case "NORMAL":p.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":p.push(["MAPPING_TRS_MATRIX_DEF",1]);p.push(["MAPPING_TRS_MATRIX",aa.glsl_value(B,16)]);break;case "POINT":0!==pa.length(q)?(p.push(["MAPPING_TRS_MATRIX_DEF",1]),p.push(["MAPPING_TRS_MATRIX",aa.glsl_value(B,16)])):(0!==pa.length(v)&&(p.push(["MAPPING_SCALE_DEF",1]),p.push(["MAPPING_SCALE",aa.glsl_value(v,3)])),0!==pa.length(r)&&(p.push(["MAPPING_TRANS_DEF",1]),p.push(["MAPPING_TRANS",aa.glsl_value(r,3)])));break;case "VECTOR":0!==pa.length(q)?(p.push(["MAPPING_TRS_MATRIX_DEF",1]),
p.push(["MAPPING_TRS_MATRIX",aa.glsl_value(B,16)])):0!==pa.length(v)&&(p.push(["MAPPING_SCALE_DEF",1]),p.push(["MAPPING_SCALE",aa.glsl_value(v,3)]))}b.use_min&&(p.push(["MAPPING_MIN_CLIP_DEF",1]),p.push(["MAPPING_MIN_CLIP",aa.glsl_value(b.min,3)]));b.use_max&&(p.push(["MAPPING_MAX_CLIP_DEF",1]),p.push(["MAPPING_MAX_CLIP",aa.glsl_value(b.max,3)]));break;case "MATERIAL":case "MATERIAL_EXT":n=[];t=[];q=[];v=[N("E","E",[0,0,0],!0),N("A","A",[0,0,0],!0),N("D","D",[0,0,0],!0),N("S","S",[0,0,0],!0),N("normal",
"normal",[0,0,0],!0),N("dif_params","dif_params",[0,0],!0),N("sp_params","sp_params",[0,0],!0),N("shadow_factor","shadow_factor",0,!0)];r=[N("color","color",[0,0,0],!0),N("specular","specular",[0,0,0],!0),N("normal","normal",[0,0,0],!0)];B=[Y(b,"Color"),Y(b,"Alpha"),Y(b,"Normal")];x=[];w=ha(b,"Color");w.default_value.splice(3);q.push(w);h.push(w);w=ha(b,"Spec");w.default_value.splice(3);q.push(w);h.push(w);(w=ha(b,"DiffuseIntensity"))||(w=ha(b,"Refl"));w.default_value=b.diffuse_intensity;q.push(w);
h.push(w);var ia=ha(b,"Normal");ia.default_value.splice(3);q.push(ia);h.push(ia);"MATERIAL_EXT"==f?((w=ha(b,"Emit"))||(w=N("Emit","Emit",0)),q.push(w),h.push(w),(w=ha(b,"Translucency"))?(w.default_value=0,w.name="Translucency",w.identifier="Translucency"):w=N("Translucency","Translucency",0),h.push(w),(w=ha(b,"Translucency"))?(w.default_value=[0,0,0,0],w.name="TranslucencyParams",w.identifier="TranslucencyParams"):w=N("TranslucencyParams","TranslucencyParams",[0,0,0,0]),h.push(w),l=ha(b,"Reflectivity"),
w=ha(b,"Ray Mirror"),l?(w=l,l="Reflectivity"):w?l="Ray Mirror":(w=l,l="Reflectivity"),w||(w=N(l,l,0)),h.push(w),r.push(w),(w=ha(b,"SpecTra"))||(w=N("SpecTra","SpecTra",0)),h.push(w),r.push(w),(w=ha(b,"Alpha"))||(w=N("Alpha","Alpha",b.alpha)),h.push(w),r.push(w),B.push(Y(b,"Diffuse")),B.push(Y(b,"Spec")),n.push(["MATERIAL_EXT",1]),t.push(["MATERIAL_EXT",1])):(q.push(N("emit_intensity","emit_intensity",0)),r.push(N("reflect_factor","reflect_factor",0)),r.push(N("specular_alpha","specular_alpha",0)),
r.push(N("alpha_in","alpha_in",0)),B.push(N("diffuse_out","diffuse_out",0)),B.push(N("spec_out","spec_out",0)),n.push(["MATERIAL_EXT",0]),t.push(["MATERIAL_EXT",0]));x.push(ma(F("param_MATERIAL_alpha"),b.alpha));x.push(ma(F("param_MATERIAL_spec_alpha"),b.specular_alpha));l=B;n.push(["USE_MATERIAL_NORMAL",ia.is_linked|0]);b.use_diffuse&&(n.push(["USE_MATERIAL_DIFFUSE",1]),t.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&t.push(["USE_MATERIAL_SPECULAR",1]);var w=[],z=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":ia=
b.specular_hardness;break;case "WARDISO":ia=b.specular_slope;break;case "TOON":ia=b.specular_toon_size;z=b.specular_toon_smooth;break;case "BLINN":ia=b.specular_ior;z=b.specular_hardness;break;default:ea.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),ia=b.specular_hardness}var A,C;switch(b.diffuse_shader){case "LAMBERT":C=A=0;break;case "OREN_NAYAR":A=b.roughness;C=0;break;case "FRESNEL":A=b.diffuse_fresnel;C=b.diffuse_fresnel_factor;break;case "MINNAERT":A=
b.darkness;C=0;break;case "TOON":A=b.diffuse_toon_size;C=b.diffuse_toon_smooth;break;default:ea.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),C=A=0}w.push(ma(F("param_MATERIAL_diffuse"),[A,C],2));w.push(ma(F("param_MATERIAL_spec"),[b.specular_intensity,ia,z],3));n.push(["SHADELESS_MAT",b.use_shadeless?1:0]);ia={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,use_shadeless:b.use_shadeless,use_tangent_shading:b.use_tangent_shading}};
n={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,use_shadeless:b.use_shadeless,use_tangent_shading:b.use_tangent_shading},material_begin:{name:"material_begin",type:"MATERIAL_BEGIN",inputs:q,outputs:v,params:w,data:ia,dirs:n,vparams:[]},material_end:{name:"material_end",type:"MATERIAL_END",inputs:r,outputs:B,params:x,data:ia,dirs:t,vparams:[]}};break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f=
"MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";
break;case "GREATER_THAN":f="MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return ea.error("Unsupported MATH operation: "+b.operation),null}p.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);h=ca(b);l=I(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f=
"MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";
break;default:return ea.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}p.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);h=ca(b);l=I(b);break;case "OUTPUT":h=ca(b);l=[];break;case "RGB":t=b.name;t={name:"-1",value:t};m.push(t);l.push(Y(b,"Color"));break;case "SEPRGB":case "SEPHSV":h=ca(b);l=I(b);break;case "TEXTURE":f=W(b);if("TEXTURE_EMPTY"==f)l.push(Y(b,"Color")),l.push(Y(b,"Normal")),l.push(Y(b,"Value"));else if("TEXTURE_ENVIRONMENT"==f)h.push(ha(b,"Vector")),l.push(Y(b,"Color")),
l.push(Y(b,"Value"));else{if("TEXTURE_NORMAL"==f&&"ENVIRONMENT_MAP"==b.texture.type)return ea.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),null;"TEXTURE_COLOR"==f&&(n=!1,(t=b.texture.image)&&"Non-Color"==t.colorspace_settings_name&&(n=!0),p.push(["NON_COLOR",Number(n)]));for(n=0;4>n;++n)n?(w=N("Vector"+n,"Vector"+n,[0,0,0]),"TEXTURE_COLOR"==f&&(q=N("Color"+n,"Color"+n,[0,0,0]),v=N("Value"+n,"Value"+n,0)),"TEXTURE_NORMAL"==f&&(q=N("Normal"+n,"Normal"+n,[0,0,0]),v=N("Value"+n,"Value"+
n,0))):(w=ha(b,"Vector"),"TEXTURE_COLOR"==f&&(q=Y(b,"Color"),v=Y(b,"Value")),"TEXTURE_NORMAL"==f&&(q=Y(b,"Normal"),v=Y(b,"Value"))),h.push(w),l.push(q),l.push(v)}q=F("param_TEXTURE_texture");m.push(ma(q));n={name:q,value:b.texture};break;case "VALTORGB":h=ca(b);l=I(b);n={value:b};t=b.color_ramp.interpolation;"CONSTANT"!=t&&"LINEAR"!=t&&ea.warn("Color Ramp node is not fully supported.");break;case "VALUE":f="VALUE";t=b.name;t={name:"-1",value:t};m.push(t);l.push(Y(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":f=
"VECT_MATH_ADD";break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return ea.error("Unsupported VECT_MATH operation: "+b.operation),null}h=ca(b);l=I(b);break;case "VECT_TRANSFORM":switch(b.vector_type){case "POINT":p.push(["VECTOR_TYPE",aa.glsl_value(0)]);break;case "VECTOR":p.push(["VECTOR_TYPE",
aa.glsl_value(1)]);break;case "NORMAL":p.push(["VECTOR_TYPE",aa.glsl_value(2)]);break;default:return ea.error("Unsupported VECT_TRANSFORM vector_type: "+b.vector_type),null}h=b.convert_from;l=b.convert_to;t=0;if("WORLD"==h)if("WORLD"==l)t=0;else if("OBJECT"==l)t=1;else if("CAMERA"==l)t=2;else return ea.error("Unsupported VECT_TRANSFORM convert_to: "+b.convert_to),null;else if("OBJECT"==h)if("WORLD"==l)t=3;else if("OBJECT"==l)t=4;else if("CAMERA"==l)t=5;else return ea.error("Unsupported VECT_TRANSFORM convert_to: "+
b.convert_to),null;else if("CAMERA"==h)if("WORLD"==l)t=6;else if("OBJECT"==l)t=7;else if("CAMERA"==l)t=8;else return ea.error("Unsupported VECT_TRANSFORM convert_to: "+b.convert_to),null;else return ea.error("Unsupported VECT_TRANSFORM convert_from: "+b.convert_from),null;p.push(["CONVERT_TYPE",aa.glsl_value(t)]);h=ca(b);l=I(b);break;case "NORMAL_MAP":t=0;switch(b.space){case "TANGENT":t=0;break;case "OBJECT":t=1;break;case "WORLD":t=2;break;case "BLENDER_OBJECT":t=3;break;case "BLENDER_WORLD":t=
4;break;default:return ea.error("Unsupported NORMAL_MAP space: "+b.space),null}p.push(["SPACE",aa.glsl_value(t)]);h.push(ha(b,"Strength"));h.push(ha(b,"Color"));l.push(Y(b,"Normal"));break;default:h=ca(b),l=I(b)}f={name:g,type:f,vparams:k,inputs:h,outputs:l,params:m,data:n,dirs:p};g=V.gen_node_id(a);V.append_node(a,V.gen_node_id(a),f);if(f="GEOMETRY"==b.type||"TEX_COORD"==b.type)a:{f=b.outputs;for(m=k=0;m<f.length;m++)if(f[m].is_linked&&k++>c){f=!0;break a}f=!1}return f&&null==H(a,b,++c,d,e)?null:
g}function G(a,b,c){for(var d=a.inputs,e=a.outputs,g=a.node_tree_name,f=0;f<b.length;f++){var k=d[f],h=b[f];if(!k||k.default_value instanceof Array!=h)return ea.warn('Wrong inputs for custom node group "'+a.name+'" of type: "',g,'".Processing as general node group.'),!1}for(f=0;f<c.length;f++)if(b=e[f],d=c[f],!b||b.default_value instanceof Array!=d)return ea.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',g,'".Processing as general node group.'),!1;return!0}function ba(a,b,c){var d=
a.node_group.node_tree,e={},f;for(f in d)if("links"==f||"nodes"==f){e[f]=[];for(var k=0;k<d[f].length;k++){e[f][k]={};for(var h in d[f][k])if("links"==f){e[f][k][h]={};for(var l in d[f][k][h])e[f][k][h][l]=L(d[f][k][h][l])}else e[f][k][h]=L(d[f][k][h])}}else e[f]=L(d[f]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)f=g("Group input","GROUP_INPUT",[],a.inputs),k=g("Group output","GROUP_OUTPUT",a.outputs,[]),h=null,h="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d&&(La.quality==za.P_LOW||
La.force_low_quality_nodes)?{from_node:f,from_socket:f.outputs[1],to_node:k,to_socket:k.inputs[0]}:{from_node:f,from_socket:f.outputs[0],to_node:k,to_socket:k.inputs[0]},e.nodes=[f,k],e.links=[h];d=a.name;f=e.nodes;k=e.links;for(h=0;h<f.length;h++)f[h].name=fa(f[h].type,d,f[h].name);for(h=0;h<k.length;h++)k[h].from_node.name=fa(k[h].from_node.type,d,k[h].from_node.name),k[h].to_node.name=fa(k[h].to_node.type,d,k[h].to_node.name);return{node_group_graph:u(e,a.node_group.uuid,!0,b,c).graph,node_group_links:e.links}}
function L(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?ja.clone_object_nr(a):a}function F(a){Ea[a]||(Ea[a]=0);var b=a+"_"+Ea[a],b=b.replace(/ /g,"_").replace(/\//g,"_");Ea[a]++;return b}function U(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function Q(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";
case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}function T(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";
case "Window":return"TEX_COORD_WI";default:return null}}}function W(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,g=0;g<b.length;g++){var f=b[g];if(f.is_linked)switch(f.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:ja.panic("Unknown texture output")}}if(c)return d&&ea.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";
if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function ha(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return Z(e)}return null}function Y(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return Z(e)}return null}function Z(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=ja.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,is_linked:d,default_value:a}}function N(a,b,c,d){return{name:a,identifier:b,
is_linked:d||!1,default_value:c}}function ca(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=Z(a.inputs[c]);d.default_value.length&&d.default_value.splice(3);b.push(d)}return b}function I(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=Z(a.outputs[c]);b.push(d)}return b}function ma(a,b,c){b=null===b||void 0===b?null:aa.glsl_value(b,c);return{name:a,value:b}}function da(a,b,c,d,e,g){var f=[],k=g.from_socket.identifier;g=g.to_socket.identifier;var h=d.outputs;for(d=0;d<h.length;d++)if(h[d].identifier==
k){f.push(d);break}e=e.inputs;for(d=0;d<e.length;d++)if(e[d].identifier==g){f.push(d);break}2==f.length&&V.append_edge(a,b,c,f);return!0}function fa(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function Aa(a){var b=[];V.traverse(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function ra(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.node_group_graph,g=c[d].data.node_group_links;if(!e)return!1;V.traverse(e,function(b,c){V.append_node(a,V.gen_node_id(a),
c)});for(e=0;e<g.length;e++)b.push(g[e]);ua(c[d],b,a)}return!0}function S(a,b,c,d,e,g){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||g.push(c)}}function R(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var g=c[e],f=null,k=0;k<b.length;k++)if(g.from_socket.identifier==b[k].to_socket.identifier){f=b[k];break}f?(g.from_node=f.from_node,g.from_socket=f.from_socket):d.push(g)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),
1);return d}function sa(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function va(a,b,c,d){for(var e=0;e<d.length;e++){for(var g=d[e],f,h=0;h<c.inputs.length;h++)if(g.from_socket.identifier==c.inputs[h].identifier){f=c.inputs[h].default_value;break}for(var h=g,l=b,m=f,n=k(h.to_node,l),p=0;p<n.length;p++)for(var t=V.get_node_attr(l,n[p]),q=0;q<t.inputs.length;q++){var v=t.inputs[q];if(v.identifier==h.to_socket.identifier){t=v.default_value instanceof
Object?0:1;if((m instanceof Object?0:1)==t)v.default_value=m;else switch(t){case 0:v=v.default_value;v[0]=v[1]=v[2]=m;break;case 1:v.default_value=(m[0]+m[1]+m[2])/3}break}}g=a.indexOf(g);-1!=g&&a.splice(g,1)}}function ua(a,b,c){for(var d=a.name,e=[],g=[],f=[],k=[],h=0;h<b.length;h++){var l=b[h];S(l.from_node,d,l,e,f,k);S(l.to_node,d,l,g,f,k)}g=R(b,g,f);e=R(b,k,e);sa(b,g);va(b,c,a,g);if(e.length){var m;V.traverse(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});va(b,c,m,e)}}
function J(a){var b=[],c=[];V.traverse(a,function(a,d){switch(d.type){case "VALTORGB":b.push(d);break;case "CURVE_VEC":case "CURVE_RGB":c.push(d)}});var d=0,e=a=null,g=b.length+c.length;if(b.length){a=ya.create_color_ramp_texture(b,ya.COLORRAMP_TEXT_SIZE);for(var f=0;f<b.length;f++)b[f].dirs.push(["NODE_TEX_ROW",aa.glsl_value((d+.5)/g)]),d++}if(c.length)for(e=ya.create_vec_curve_texture(c,ya.CURVE_NODES_TEXT_SIZE),f=0;f<c.length;f++)c[f].dirs.push(["NODE_TEX_ROW",aa.glsl_value((d+.5)/g)]),d++;f=null;
a&&e?(f=new Uint8Array(a.length+e.length),f.set(a),f.set(e,a.length)):f=a?a:e;a=f?ya.generate_batch_texure(f,ya.CURVE_NODES_TEXT_SIZE):null;for(f=0;f<b.length;f++)b[f].data.texture=a;for(f=0;f<c.length;f++)c[f].data.texture=a}function na(a,b,c,d){a=a.curve_mapping.curves_data[b];return 2==a.length&&a[0][0]<c+.01&&a[0][1]<c+.01&&a[1][0]>d-.01&&a[1][1]>d-.01?!1:!0}var za=r("__config");r("__debug");var V=r("__graph"),wa=r("__mat3"),ga=r("__mat4"),X=r("__objects"),ea=r("__print"),aa=r("__shaders"),Ga=
r("__scenes"),ja=r("__util"),pa=r("__vec3"),ya=r("__textures"),Ea={},Ca={},ia={},oa={},xa=0;new Float32Array(4);var La=za.defaults;a.VT_WORLD_TO_WORLD=0;a.VT_WORLD_TO_OBJECT=1;a.VT_WORLD_TO_CAMERA=2;a.VT_OBJECT_TO_WORLD=3;a.VT_OBJECT_TO_OBJECT=4;a.VT_OBJECT_TO_CAMERA=5;a.VT_CAMERA_TO_WORLD=6;a.VT_CAMERA_TO_OBJECT=7;a.VT_CAMERA_TO_CAMERA=8;a.NM_TANGENT=0;a.NM_OBJECT=1;a.NM_WORLD=2;a.NM_BLENDER_OBJECT=3;a.NM_BLENDER_WORLD=4;a.get_ngraph_proxy_cached=function(a){return Ca[a]};a.cleanup_ngraph_proxy=
function(a){delete Ca[a]};a.compose_ngraph_proxy=u;a.create_lighting_graph=function(a,c,d){var e=Ga.get_active();a=l(a,"MAIN",e.uuid);if(a in ia)return ia[a];var e=V.create(),g={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},f=H(e,g,0,c,null),g={name:"LIGHTING_END",type:"LIGHTING_END"},g=H(e,g,0,c,null);b(e,d,f,g,[[f,[8,10]],[f,[9,6]]],c);n(e);return ia[a]=e};a.compose_node_elements=function(a){var b=[],c={};Ea={};var d=V.topsort(a);V.traverse(d,function(a,d){var e;e=[];for(var g=[],f=[],k=[],h=[],
l=[],m=0;m<d.inputs.length;m++){var n=d.inputs[m];if(n.is_linked)e.push(null),g.push(null);else{e.push(F("in_"+d.type+"_"+n.identifier.replace(/\./g,"")));var p=aa.glsl_value(n.default_value,0);La.shader_constants_hack&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier||0<=d.type.indexOf("LIGHTING_APPLY")||
0<=d.type.indexOf("MATERIAL_END")||0<=d.type.indexOf("MATERIAL_BEGIN"))&&(n=p,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1_0_0$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1_1_0$3"),p=n=n.replace(/\s+/g,""));g.push(p)}}for(m=0;m<d.outputs.length;m++)n=d.outputs[m],n.is_linked?f.push(null):f.push(F("out_"+d.type+"_"+n.identifier.replace(/\./g,"")));for(m=0;m<d.params.length;m++)n=d.params[m],k.push(n.name),h.push(n.value);for(m=0;m<d.vparams.length;m++)l.push(d.vparams[m].name);
e={id:d.type,inputs:e,input_values:g,outputs:f,params:k,param_values:h,vparams:l,dirs:JSON.parse(JSON.stringify(d.dirs))};b.push(e);c[a]=e});V.traverse_edges(d,function(a,b,e){var g=V.get_node_attr(d,a);V.get_node_attr(d,b);var f=g.outputs[e[0]];a=c[a].outputs;b=c[b].inputs;g=a[e[0]]||F("out_"+g.type+"_"+f.identifier.replace(/\./g,""));a[e[0]]=g;b[e[1]]=g});return b};a.check_material_glow_output=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==
c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in Ca)delete Ca[a];for(a in ia)delete ia[a];for(var b in oa)delete oa[b];xa=0}};b4w.module.__animation=function(a,r){function u(a,b){var c=a.anim_slots[b];c&&c.finish_callback&&c.exec_finish_callback&&(c.exec_finish_callback=!1,c.finish_callback(a,b))}function h(a,b,c){c=a.anim_slots[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.current_frame_float=d;c.animation_name=b.name;for(e=d=0;e<a.vertex_anim.length;e++){var g=a.vertex_anim[e];if(g==b)break;else d+=g.frame_end-g.frame_start+1}c.va_frame_offset=d}function b(a,b,c){b.type=50;b.animation_name=
c.name;b.start=c.frame_start;b.length=c.frame_end-b.start;c.cyclic||(b.length+=c.lifetime_frames)}function f(a){return a.replace(/_B4W_BAKED$/,"")}function l(a,b){return{name_list:a,action:b}}function q(a,b,c){if(a.animation_data){var d=a.animation_data.action;d&&60==d._render.type&&b.push(l(c,d))}a=a.nodes;for(d=0;d<a.length;d++){var e=a[d];if(e.node_group){var g=e.node_group.node_tree;if(g){var f=c.slice();f.push(e.name);q(g,b,f)}}}}function e(a){return Z.is_mesh(a)&&a.render.vertex_anim?!0:!1}
function n(a,b,c){var d=a.anim_slots;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.current_frame_float=b,B(a,0,c,!0))}else if(e=d[c])e.current_frame_float=b,B(a,0,c,!0)}function p(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function B(a,b,c,d){z(a,b,c,d);u(a,c);a.render.anim_mixing&&(K(a,b),D(a,b))}function c(a,b,c,e){var g=c.frame_range;if(g[0]>g[1])return I.warn('Incompatible action "'+c.name+'" has been applied to object "'+a.name+'"'),!1;var f=c._render,h=a.anim_slots[e];
h.animation_name=c.name;h.action_frame_range=g;h.action_step=f.pierce_step;h.action_bflags=f.bflags;h.channels_mask.set(f.channels_mask);h.start=g[0];h.length=g[1]-g[0];h.current_frame_float=g[0];switch(f.type){case 10:if(Z.is_armature(a)){h.type=10;var l=k(a,b,c);if(!l){for(var l=a.render.bone_pointers,g=[],n=[],p=c._render.num_pierced,q=0;q<p;q++){for(var v in l){var r=l[v],B=r.tsr_basis,x=c._render.bones[v];x?sa.copy(x.subarray(8*q,8*q+8),B):sa.identity(B);r.tsr_channel_cache_valid=!1}r=d(l);g.push(r.trans);
n.push(r.quats)}l={trans:g,quats:n};m(a,b,c,l)}h.trans=l.trans;h.quats=l.quats;b=l;h=a.render;l=h.skinned_renders;g=a.anim_slots[e];v=g.skinning_data;a:{n=h.skinning_data_cache;for(p=0;p<n.length;p+=2)if(c==n[p]){n=n[p+1];break a}n=null}if(n)g.skinning_data=n;else{for(g=0;g<l.length;g++){n=l[g].bone_skinning_info;p=[];q=[];r=b.trans;B=b.quats;for(x=0;x<r.length;x++){var z=t(r[x],B[x],n);p.push(z.trans);q.push(z.quats)}v.push({trans:p,quats:q})}h.skinning_data_cache.push(c,v)}h.anim_mixing&&(c=h.two_last_skeletal_slots,
e>c[1]?(b=c[1],c[1]=e,c[0]=b):e>c[0]&&e<c[1]&&(c[0]=e),A(a))}break;case 40:Z.is_speaker(a)&&(h.volume=f.params.volume||null,h.pitch=f.params.pitch||null,h.type=40);break;case 70:Z.is_lamp(a)&&(h.color=f.params.color||null,h.energy=f.params.energy||null,h.type=70);break;case 60:if("MESH"==a.type){h.type=60;v=k(a,b,c);if(!v){v=[];g=[];n=[];p=[];q=[];r=c._render;B=b?b[0]:null;for(l in r.params){x=b;z=l.match(/"(.*?)"/)[1];if(x&&1<x.length){for(var C=x[1],y=2;y<x.length;y++)C=C+"%join%"+x[y];C+="%join%"+
z}else C=z;x=C;for(z=0;z<a.scenes_data.length;z++)for(C=a.scenes_data[z].batches,y=0;y<C.length;y++){var u=C[y];if(!B||-1!=u.material_names.indexOf(B)){var F=u.node_rgb_inds,H=w(l,x,r,g,v,u.node_value_inds),F=w(l,x,r,p,n,F);(H||F)&&q.push(u)}}}v={val_inds:v,values:g,rgb_inds:n,rgbs:p,node_batches:q};m(a,b,c,v)}h.node_value_inds=v.val_inds;h.nodemat_values=v.values;h.node_rgb_inds=v.rgb_inds;h.nodemat_rgbs=v.rgbs;h.node_batches=v.node_batches}break;case 20:if(l=f.params.tsr){h.type=20;v=k(a,b,c);if(!v){v=
c._render.num_pierced;g=[];n=[];for(p=0;p<v;p++)g.push(l.subarray(8*p,8*p+4)),n.push(l.subarray(8*p+4,8*p+8));v={trans:g,quats:n};m(a,b,c,v)}h.trans=v.trans;h.quats=v.quats;N.obj_has_particles(a)&&N.update_start_pos(a,h.trans[0],h.quats[0])}else return I.warn('Incompatible action "'+c.name+'" has been applied to object "'+a.name+'"'),!1;break;case 80:Z.is_world(a)&&(h.energy=f.params["light_settings.environment_energy"]||null,h.horizon_color=f.params.horizon_color||null,h.zenith_color=f.params.zenith_color||
null,h.fog_intensity=f.params["mist_settings.intensity"]||null,h.fog_depth=f.params["mist_settings.depth"]||null,h.fog_start=f.params["mist_settings.start"]||null,h.fog_height=f.params["mist_settings.height"]||null,h.fog_color=f.params.b4w_fog_color||null,h.type=80)}Z.is_armature(a)&&10!=f.type&&E(a,e);return!0}function k(a,b,c){a=a.action_anim_cache;b=b?b.join("%join%"):null;for(var d=0;d<a.length;d+=3)if(c==a[d]&&b==a[d+1])return a[d+2];return null}function m(a,b,c,d){a=a.action_anim_cache;b=b?
b.join("%join%"):null;a.push(c,b,d)}function A(a){var b=a.render.two_last_skeletal_slots;if(-1!=b[0]&&-1!=b[1]){var c=a.anim_slots;a=c[b[1]].current_frame_float;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.current_frame_float;d=Math.floor(a);b.current_frame_float=d+e}}function E(a,b){var c=a.render.two_last_skeletal_slots,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.anim_slots;0<=d;d--){var g=e[d];if(g&&10==g.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function w(a,b,c,d,e,g){if(!g)return!1;for(var f=
!1,k=0;k<g.length;k+=2)b==g[k]&&(e.push(g[k+1]),d.push(new Float32Array(c.params[a])),f=!0);return f}function v(a){a=a._render;for(var b in a.params)if(-1!=b.indexOf("nodes"))return!0;return!1}function z(a,b,c,d){if((c=a.anim_slots[c])&&null!=c.type&&(c.play||d)){var e=a.render,g=c.current_frame_float,f=c.start,k=c.length,g=g+c.speed*b*S.get_framerate(),h=c.type,l=c.speed;if(0<=l&&g>=f+k||0>l&&g<f)switch(d||(c.exec_finish_callback=!0),c.behavior){case 10:g=0<=l?(g-f)%k+f:f+k-1E-6;break;case 20:g=
0<=l?f:f+k-1E-6;c.play=!1;break;case 30:g=0<=l?f+k-1E-6:f,c.play=!1}c.current_frame_float=g;switch(h){case 10:if(!e.anim_mixing){d=y(c);b=d[0];var m=d[1];d=d[2];e.quats_before=c.quats[b];e.quats_after=c.quats[m];e.trans_before=c.trans[b];e.trans_after=c.trans[m];e.frame_factor=d;d=e.skinned_renders;c=c.skinning_data;for(var n=0;n<d.length;n++){var p=d[n],t=c[n];p.quats_before=t.quats[b];p.quats_after=t.quats[m];p.trans_before=t.trans[b];p.trans_after=t.trans[m];p.frame_factor=e.frame_factor}R.update_transform(a)}break;
case 20:d=y(c);var e=V,m=d[0],n=d[1],p=d[2],t=c.trans,q=t[m][1],g=t[m][2],f=t[n][1],k=t[n][2];e[0]=(1-p)*t[m][0]+p*t[n][0];e[1]=(1-p)*q+p*f;e[2]=(1-p)*g+p*k;m=ga;g=d[0];n=d[1];p=d[2];t=c.quats;q=X;q[0]=t[g][0];q[1]=t[g][1];q[2]=t[g][2];q[3]=t[g][3];g=ea;g[0]=t[n][0];g[1]=t[n][1];g[2]=t[n][2];g[3]=t[n][3];ma.slerp(q,g,p,m);n=d[2];p=c.trans;d=(1-n)*p[d[0]][3]+n*p[d[1]][3];a.parent&&a.pinverse_tsr&&(n=aa,sa.set_sep(e,d,m,n),sa.multiply(a.pinverse_tsr,n,n),sa.get_trans(n,e),sa.get_quat(n,m),d=sa.get_scale(n));
c.trans_smooth_period&&(n=wa,R.get_translation(a,n),va.smooth_v(e,n,b,c.trans_smooth_period,e));c.quat_smooth_period&&(n=X,R.get_rotation(a,n),va.smooth_q(m,n,b,c.quat_smooth_period,m));g=c.channels_mask;g[0]&&R.set_translation_rel(a,e);g[1]&&R.set_rotation_rel(a,m);g[2]&&R.set_scale_rel(a,d);R.update_transform(a);ca.sync_transform(a);break;case 30:d=c.current_frame_float-c.start;0>d&&(d=0);d>=c.length&&(d=c.length);a=Math.floor(d);b=a+1;d-=a;10!=c.behavior&&b==c.length&&(b=--a,d=1);c=c.va_frame_offset;
za[0]=a+c;za[1]=b+c;za[2]=d;d=za;e.va_frame=d[0];e.va_frame_factor=d[2];break;case 40:d=y(c);b=d[0];e=d[1];d=d[2];c.volume&&Aa.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&Aa.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:b=10==c.behavior?(g-f)/S.get_framerate():g/S.get_framerate();N.set_time(a,c.animation_name,b);break;case 60:d=y(c);b=d[0];e=d[1];d=d[2];t=c.nodemat_values;q=c.node_value_inds;a=c.nodemat_rgbs;m=c.node_rgb_inds;n=c.node_batches;for(c=0;c<q.length;c++)for(g=t[c],
p=q[c],f=(1-d)*g[b]+d*g[e],g=0;g<n.length;g++)n[g].node_values[p]=f;for(c=0;c<m.length;c++)for(q=a[c],p=m[c],t=q.subarray(3*b,3*b+3),q=q.subarray(3*e,3*e+3),t=ua.lerp(t,q,d,V),g=0;g<n.length;g++)n[g].node_rgbs[3*p]=t[0],n[g].node_rgbs[3*p+1]=t[1],n[g].node_rgbs[3*p+2]=t[2];break;case 70:d=y(c);b=d[0];e=d[1];d=d[2];g=c.channels_mask;(k=c.energy)&&g[0]&&Y.set_light_energy(a.light,(1-d)*k[b]+d*k[e]);(c=c.color)&&g[1]&&(V[0]=(1-d)*c[3*b]+d*c[3*e],V[1]=(1-d)*c[3*b+1]+d*c[3*e+1],V[2]=(1-d)*c[3*b+2]+d*c[3*
e+2],Y.set_light_color(a.light,V));f=a.scenes_data;for(c=0;c<f.length;c++)fa.update_lamp_scene_color_intensity(a,f[c].scene);break;case 80:d=y(c);b=d[0];e=d[1];d=d[2];g=c.channels_mask;f=a.scenes_data;l=fa.get_subs(f[0].scene,ra.MAIN_OPAQUE);k=c.energy;k=g[0]?(1-d)*k[b]+d*k[e]:l.energy;h=c.horizon_color;g[1]?(V[0]=(1-d)*h[3*b]+d*h[3*e],V[1]=(1-d)*h[3*b+1]+d*h[3*e+1],V[2]=(1-d)*h[3*b+2]+d*h[3*e+2],h=V):h=l.horizon_color;var v=c.zenith_color;g[2]?(wa[0]=(1-d)*v[3*b]+d*v[3*e],wa[1]=(1-d)*v[3*b+1]+d*
v[3*e+1],wa[2]=(1-d)*v[3*b+2]+d*v[3*e+2],l=wa):l=l.zenith_color;v=c.fog_intensity;g[3]&&(m=(1-d)*v[b]+d*v[e]);v=c.fog_depth;g[4]&&(n=(1-d)*v[b]+d*v[e]);v=c.fog_start;g[5]&&(p=(1-d)*v[b]+d*v[e]);v=c.fog_height;g[6]&&(t=(1-d)*v[b]+d*v[e]);c=c.fog_color;g[7]&&(ga[0]=(1-d)*c[3*b]+d*c[3*e],ga[1]=(1-d)*c[3*b+1]+d*c[3*e+1],ga[2]=(1-d)*c[3*b+2]+d*c[3*e+2],q=ga);for(c=0;c<f.length;c++)b=a.scenes_data[c].scene,(g[0]||g[1]||g[2])&&fa.set_environment_colors(b,k,h,l),g[3]&&fa.set_fog_intensity(b,m),g[4]&&fa.set_fog_depth(b,
n),g[5]&&fa.set_fog_start(b,p),g[6]&&fa.set_fog_height(b,t),g[7]&&fa.set_fog_color_density(b,q);break;default:va.panic("Unknown animation type:"+h)}}}function y(a){var b=a.action_frame_range[0],c=a.action_frame_range[1]-b,b=a.current_frame_float-b;0>b&&(b=0);b>=c&&(b=c);b/=a.action_step;c=Math.floor(b);a=a.action_bflags[c]?b-c:0;b=Math.ceil(c+a);za[0]=c;za[1]=b;za[2]=a;return za}function D(a,b){var c=a.render,d=c.anim_mix_factor,e=c.two_last_skeletal_slots,g=e[0],e=e[1];if(-1!=e){if(-1!=g){var f=
a.anim_slots[g];if(f.play||0==b){var k=y(f),h=k[0],l=k[1];c.frame_factor=k[2];var k=f.quats[h],m=f.quats[l],h=f.trans[h],l=f.trans[l]}else d=1}else d=1;e=a.anim_slots[e];if(e.play||0==b){var g=y(e),n=g[0],p=g[1];c.frame_factor=g[2]}else if(-1!=g&&f.play)d=0;else return;g=e.quats[n];f=e.quats[p];n=e.trans[n];p=e.trans[p];if(1==d)c.quats_before.set(g),c.quats_after.set(f),c.trans_before.set(n),c.trans_after.set(p);else if(0==d)c.quats_before.set(k),c.quats_after.set(m),c.trans_before.set(h),c.trans_after.set(l);
else{for(e=0;e<k.length;e+=4){for(var t=ga,q=X,v=0;4>v;v++)t[v]=k[e+v],q[v]=g[e+v];ma.slerp(t,q,d,t);for(v=0;4>v;v++)c.quats_before[e+v]=t[v];for(v=0;4>v;v++)t[v]=m[e+v],q[v]=f[e+v];ma.slerp(t,q,d,t);for(v=0;4>v;v++)c.quats_after[e+v]=t[v]}va.blend_arrays(h,n,d,c.trans_before);va.blend_arrays(l,p,d,c.trans_after)}R.update_transform(a);W.update_skinned_renders(a)}}function K(a,b){var c=a.render,d=c.anim_mix_factor,e=c.anim_mix_factor_change_speed;if(0!=e){var d=c.anim_destination_mix_factor-d,g=e*
b;va.sign(d)==va.sign(e)&&Math.abs(g)<Math.abs(d)?c.anim_mix_factor+=g:(c.anim_mix_factor=c.anim_destination_mix_factor,c.anim_mix_factor_change_speed=0)}}function d(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),g;for(g in a){var f=a[g],k=d,h=e,l=f.chain,m=l[l.length-1],n=m.tsr_channel_cache;m.tsr_channel_cache_valid||sa.identity(n);for(m=l.length-1;0<=m;m--){var p=l[m],t=p.tsr_channel_cache;if(p.tsr_channel_cache_valid)n=t;else{var q=p.tsr_local_rest,v=p.tsr_basis;sa.invert(q,aa);
sa.multiply(v,aa,aa);sa.multiply(q,aa,aa);sa.multiply(n,aa,t);n=t;p.tsr_channel_cache_valid=!0}}l=p.tsr_channel_cache;k[0]=l[0];k[1]=l[1];k[2]=l[2];k[3]=l[3];h[0]=l[4];h[1]=l[5];h[2]=l[6];h[3]=l[7];ma.normalize(h,h);f=f.bone_index;for(k=0;4>k;k++)h=4*f+k,b[h]=d[k],c[h]=e[k]}return{trans:b,quats:c}}function t(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);for(var g in c)for(var f=c[g],k=f.bone_index,f=f.deform_bone_index,h=0;4>h;h++){var l=4*f+h,m=4*k+h;d[l]=a[m];e[l]=b[m]}d=new Float32Array(d);
e=new Float32Array(e);return{trans:d,quats:e}}function C(a){var b=a._render;if(b.bones)b.type=10;else if(b.params)if("volume"in b.params||"pitch"in b.params)b.type=40;else if(v(a))b.type=60;else{var c;a:{if(a._render.params){c=a.fcurves;for(var d in c)if("color"==d&&!c[d][3]){c=!0;break a}if("energy"==d){c=!0;break a}}c=!1}if(c)b.type=70;else if(c=a._render.params,"light_settings.environment_energy"in c||"horizon_color"in c||"zenith_color"in c||"mist_settings.intensity"in c||"mist_settings.depth"in
c||"mist_settings.start"in c||"mist_settings.height"in c||"b4w_fog_color"in c)b.type=80;else{var e;a:{if(a._render.params)for(e in a=a.fcurves,a)if("location"==e||"rotation_quaternion"==e||"scale"==e){e=!0;break a}e=!1}b.type=e?20:0}}else b.type=0}function v(a){if(a=a._render.params)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function M(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function x(a,b){b[0]=b[1]=0;for(var c in a)"energy"==
c?b[0]=1:"color"==c&&(b[1]=1)}function g(a,b){b[0]=b[1]=b[2]=0;b[3]=b[4]=b[5]=0;b[6]=b[7]=0;for(var c in a)"light_settings.environment_energy"==c?b[0]=1:"horizon_color"==c?b[1]=1:"zenith_color"==c?b[2]=1:"mist_settings.intensity"==c?b[3]=1:"mist_settings.depth"==c?b[4]=1:"mist_settings.start"==c?b[5]=1:"mist_settings.height"==c?b[6]=1:"b4w_fog_color"==c&&(b[7]=1)}function H(a,b,c,d,e,g,f){var k=a+(b-a)/2,h=G(k,d,e,g,f)-c;return.02>Math.abs(h)?k:0<h?H(a,k,c,d,e,g,f):H(k,b,c,d,e,g,f)}function G(a,b,
c,d,e){var g=1-a;return b*g*g*g+3*c*g*g*a+3*d*g*a*a+e*a*a*a}function ba(a,b){var c={type:null,animation_name:null,action_frame_range:null,action_step:0,action_bflags:null,channels_mask:new Int8Array(8),quats:null,trans:null,skinning_data:[],play:!1,behavior:20,current_frame_float:0,start:0,length:0,trans_smooth_period:0,quat_smooth_period:0,exec_finish_callback:!1,va_frame_offset:null,speed:1,volume:null,pitch:null,color:null,energy:null,zenith_color:null,horizon_color:null,fog_intensity:null,fog_depth:null,
fog_start:null,fog_height:null,fog_color:null,nodemat_values:[],node_value_inds:[],nodemat_rgbs:[],node_rgb_inds:[],node_batches:null};if(!a.anim_slots.length)for(var d=0;8>d;d++)a.anim_slots.push(null);a.anim_slots[b]=c;-1==Ga.indexOf(a)&&Ga.push(a)}function L(a,b){R.update_transform(a);ca.sync_transform(a);B(a,0,b,!0)}function F(a,d,e,g){g=g||0;if(Z.is_mesh(a)){var f=U(a,e);if(f)return ba(a,g),h(a,f,g),L(a,g),!0;if((f=Q(a,e))&&"EMITTER"==f.p_type){ba(a,g);d=f.name;e=g;for(var f=a.scenes_data,k=
0;k<f.length;k++)for(var l=f[k].batches,m=0;m<l.length;m++){var n=l[m].particles_data;n&&n.name==d&&b(l[m],a.anim_slots[e],n)}L(a,g);return!0}}if(f=va.keysearch("name",e,ja)||va.keysearch("name",e+"_B4W_BAKED",ja)){ba(a,g);if(c(a,d,f,g))return L(a,g),!0;a.anim_slots[g]=null}I.error('Unsupported object: "'+a.name+'" or animation name: "'+e+'"');return!1}function U(a,b){for(var c=0;c<a.vertex_anim.length;c++){var d=a.vertex_anim[c];if(d.name===b)return d}return null}function Q(a,b){for(var c=a.scenes_data,
d=0;d<c.length;d++)for(var e=c[d].batches,g=0;g<e.length;g++){var f=e[g].particles_data;if(f&&f.name===b)return f}return null}function T(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}var W=r("__armature"),ha=r("__config"),Y=r("__lights"),Z=r("__obj_util"),N=r("__particles"),ca=r("__physics"),I=r("__print"),ma=r("__quat"),da=r("__reformer"),fa=r("__scenes"),Aa=r("__sfx"),ra=r("__subscene"),S=r("__time"),R=r("__transform"),sa=r("__tsr"),va=
r("__util"),ua=r("__vec3"),J=ha.animation,na=ha.context_limits;a.LAST_FRAME_EPSILON=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.OBJ_ANIM_TYPE_LIGHT=70;a.OBJ_ANIM_TYPE_ENVIRONMENT=80;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var za=Array(3),
V=new Float32Array(3),wa=new Float32Array(3),ga=new Float32Array(4),X=new Float32Array(4),ea=new Float32Array(4),aa=sa.create();new Float32Array(16);var Ga=[],ja=[];a.get_max_bones=function(){return va.trunc((na.max_vertex_uniform_vectors-50)/4)};a.frame_to_sec=function(a){return a/S.get_framerate()};a.update=function(a){for(var b=0;b<Ga.length;b++){for(var c=Ga[b],d=0;8>d;d++)z(c,a,d);c.render.anim_mixing&&(K(c,a),D(c,a))}for(b=0;b<Ga.length;b++)for(c=Ga[b],d=0;8>d&&c.anim_slots.length;d++)u(c,d)};
a.get_all_actions=function(){return ja};a.get_anim_names=function(a){var b=[];if(e(a))for(var c=0;c<a.vertex_anim.length;c++)b.push(a.vertex_anim[c].name);for(var d=[],c=0;c<ja.length;c++){var g=ja[c],k=g._render;20==k.type?d.push(g):60==g._render.type&&"MESH"==a.type?d.push(g):10==k.type&&"ARMATURE"==a.type?d.push(g):40==k.type&&"SPEAKER"==a.type?d.push(g):80==k.type&&"WORLD"==a.type&&d.push(g)}for(c=0;c<d.length;c++)b.push(f(d[c].name));if(N.obj_has_particles(a)&&N.obj_has_anim_particles(a))for(a=
a.scenes_data,c=0;c<a.length;c++)for(d=a[c].batches,g=0;g<d.length;g++)(k=d[g].particles_data)&&b.push(k.name);return b};a.strip_baked_suffix=f;a.get_anim_type=function(a,b){var c=a.anim_slots[b];return c?c.type:0};a.apply_def=function(a){for(var d=0,g=a.scenes_data,f=0;f<g.length;f++)for(var k=g[f].batches,l=0;l<k.length;l++){var m=k[l].particles_data;m&&"EMITTER"==m.p_type&&!k[l].forked_batch&&(ba(a,d),b(k[l],a.anim_slots[d],m),L(a,d),a.anim_slots[d].behavior=m.cyclic?10:a.anim_behavior_def,d++)}g=
a.def_action_slots.slice();for(f=0;f<g.length;f++)l=g[f],k=l.name_list,l=l.action,ba(a,d),c(a,k,l,d)?(L(a,d),a.anim_slots[d].behavior=a.anim_behavior_def,d++):a.anim_slots[d]=null;e(a)&&(ba(a,d),h(a,a.vertex_anim[0],d),L(a,d),a.anim_slots[d].behavior=a.anim_behavior_def)};a.anim_behavior_bpy_b4w=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:va.panic("Wrong animation behavior")}};a.get_bpy_material_actions=function(a){var b=[];a=a.data.materials;
for(var c=0;c<a.length;c++){var d=a[c],e=d.node_tree;e&&q(e,b,[d.name])}return b};a.init_action_slot=l;a.play=function(a,b,c){p(a.anim_slots,c,function(a){a.play=!0;a.finish_callback=b?b:null;a.exec_finish_callback=!1});a.render.anim_mixing&&A(a)};a.stop=function(a,b){p(a.anim_slots,b,function(a){a.play=!1;a.finish_callback=null;a.exec_finish_callback=!1})};a.is_play=function(a,b){var c=a.anim_slots;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;return!1};a.set_frame=
n;a.set_first_frame=function(a,b){b=b||0;p(a.anim_slots,b,function(c){n(a,c.start,b)})};a.get_current_frame_float=function(a,b){var c=a.anim_slots[b];return c&&c.current_frame_float?c.current_frame_float:0};a.is_cyclic=function(a,b){var c=a.anim_slots[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){p(a.anim_slots,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.anim_slots[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){p(a.anim_slots,d,function(a){a.trans_smooth_period=
b||0;a.quat_smooth_period=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.anim_slots[c]=null;else a.anim_slots[b]=null;a.render.anim_mixing&&E(a,b)};a.update_object_animation=B;a.obj_is_animatable=function(a){if("ARMATURE"==a.type||a.armobj||"WORLD"==a.type)return!0;for(var b=0;b<a.def_action_slots.length;b++){var c=a.def_action_slots[b].action._render.type;if(20==c||10==c||40==c&&"SPEAKER"==a.type||70==c&&"LAMP"==a.type||60==c&&"MESH"==a.type)return!0}return N.obj_has_particles(a)&&
N.obj_has_anim_particles(a)||"MESH"==a.type&&a.vertex_anim.length?!0:!1};a.bpy_obj_is_animatable=function(a,b){if("ARMATURE"==b.type||T(a)||"WORLD"==b.type)return!0;for(var c=0;c<b.def_action_slots.length;c++){var d=b.def_action_slots[c].action._render.type;if(20==d||10==d||40==d&&"SPEAKER"==b.type||60==d&&"MESH"==b.type)return!0}return N.bpy_obj_has_particles(a)&&N.bpy_obj_has_anim_particles(a)||"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.anim_slots.length)};
a.calc_pose_data=d;a.extract_skinned_pose_data=t;a.append_action=function(a){var b=new RegExp(/pose.bones\[\".+\"\]/g),c=sa.create(),d=function(a,d,e,g,f){if(-1<e.search(b)){a=d;e=e.split('"')[1];var k=c}else 8==f?(e="tsr",k=c):k=1<f?new Float32Array(f):0;if(!a[e]){f=a;d=e;if("object"==typeof k&&k.length)for(var h=k.length,l=new Float32Array(g*h),m=0;m<g;m++)for(var n=0;n<h;n++)l[m*h+n]=k[n];else if("number"==typeof k)for(l=new Float32Array(g),m=0;m<g;m++)l[m]=k;else va.panic("Wrong storage default value");
f[d]=l}return a[e]},e=function(a,b){if(-1<a.indexOf("location"))var c=0,d=b;else-1<a.indexOf("rotation_quaternion")?(c=4,d=0==b?3:b-1):-1<a.indexOf("scale")?(c=3,d=0):(c=0,d=b);return c+d},f=function(a,b){for(var c=0;c<b;c++){var d=a.subarray(8*c+4,8*c+8);ma.normalize(d,d)}},k=a._render={type:0,num_pierced:0,pierce_step:0,params:null,bones:null,bflags:null,channels_mask:new Int8Array(8)};k.pierce_step=1/J.frame_steps;var h=a.fcurves,l={},m={},n=0,p;for(p in h){var t=h[p],q;for(q in t){var v=t[q],
r=v._pierced_points;da.check_anim_fcurve_completeness(v,a);v=v.num_channels;n||(n=r.length);for(var v=d(l,m,p,n,v),B=v.length/n,w=e(p,q|0),z=0;z<n;z++)v[z*B+w]=r[z]}}if(va.get_dict_length(l)){for(var A in l)"tsr"==A&&f(l[A],n);k.params=l}if(va.get_dict_length(m)){for(var y in m)f(m[y],n);k.bones=m}k.num_pierced=n;k.bflags=a._bflags;"tsr"in l&&M(h,k.channels_mask);("color"in l||"energy"in l)&&x(h,k.channels_mask);("light_settings.environment_energy"in l||"horizon_color"in l||"zenith_color"in l||"mist_settings.intensity"in
l||"mist_settings.depth"in l||"mist_settings.start"in l||"mist_settings.height"in l||"b4w_fog_color"in l)&&g(h,k.channels_mask);C(a);ja.push(a)};a.get_approx_curve_length=function(a,b){return(b-a)*J.frame_steps+1};a.approximate_curve=function(a,b,c,d,e,g){var f=new Float32Array(2),k=new Float32Array(2),h=new Float32Array(2),l=new Float32Array(2),m=b[1],n=b[2],p=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var t=0,q=0,v=null;e<=g;e++)if(e<m)for(var r=0;r<J.frame_steps;r++)c[t++]=n;else if(e>
p)for(r=0;r<J.frame_steps;r++)c[t++]=a;else{var B=b[q],x=3;0===B&&(x+=2);0===v&&(x+=2);var w=2===B?0:1;if(b[q+1]==b[q+x+1])v=B,q+=x;else{r=0;e==b[q+1]&&(w&&(d[t]=1),c[t]=b[q+2],t++,r++);if(e==p)for(;r<J.frame_steps;r++)c[t++]=a;else for(f[0]=b[q+1],f[1]=b[q+2],0!==B?(k[0]=0,k[1]=0):0===v?(k[0]=b[q+5],k[1]=b[q+6]):(k[0]=b[q+3],k[1]=b[q+4]),0!==B?(h[0]=0,h[1]=0):(h[0]=b[q+x+3],h[1]=b[q+x+4]),l[0]=b[q+x+1],l[1]=b[q+x+2];r<J.frame_steps;r++){var z=e+r/J.frame_steps;switch(B){case 0:var A=f,C=k,y=h,u=
l,F=[],E=[],D=void 0,W=void 0,M=void 0,D=void 0;F[0]=A[0]-C[0];F[1]=A[1]-C[1];E[0]=u[0]-y[0];E[1]=u[1]-y[1];M=u[0]-A[0];D=Math.abs(F[0]);W=Math.abs(E[0]);0!=D+W&&D+W>M&&(D=M/(D+W),C[0]=A[0]-D*F[0],C[1]=A[1]-D*F[1],y[0]=u[0]-D*E[0],y[1]=u[1]-D*E[1]);w&&(d[t]=1);A=t;C=f;y=k;u=h;F=l;z=H(0,1,z,C[0],y[0],u[0],F[0]);z=G(z,C[1],y[1],u[1],F[1]);c[A]=z;t++;break;case 1:w&&(d[t]=1);A=f[0];C=f[1];y=(l[1]-C)/(l[0]-A);c[t]=y*z+(C-y*A);t++;break;case 2:w&&(d[t]=1);c[t]=b[q+2];t++;break;default:va.panic("Unknown keyframe interpolation mode: "+
B)}}e+1==b[q+x+1]&&(v=B,q+=x)}}};a.apply=F;a.apply_by_uuid=function(a,b,d,e){e=e||0;var g=va.keysearch("uuid",d,ja);if(g){ba(a,e);if(c(a,b,g,e))return L(a,e),!0;a.anim_slots[e]=null}I.error('Unsupported object: "'+a.name+'" or animation uuid: "'+d+'"');return!1};a.validate_action_by_name=function(a,b){var c=va.keysearch("name",b,ja)||va.keysearch("name",b+"_B4W_BAKED",ja);if(c){if(0==c._render.type)return!1}else if(!(Q(a,b)||Z.is_mesh(a)&&U(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,
b){for(var c=a.anim_slots,d=0;d<c.length;d++){var e=c[d];if(e&&f(e.animation_name)==f(b))return d}return-1};a.get_anim_by_slot_num=function(a,b){var c=a.anim_slots[b];return c&&c.animation_name?f(c.animation_name):null};a.remove=function(a){a.anim_slots.length=0;a=Ga.indexOf(a);-1!=a&&Ga.splice(a,1)};a.remove_actions=function(a){for(var b=ja.length-1;0<=b;b--)ja[b]._data_id==a&&ja.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.anim_slots.length)return F(a,b,0)?0:-1;for(var c=0;c<a.anim_slots.length;c++)if(!a.anim_slots[c])return F(a,
b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.render.anim_mix_factor_change_speed=(b-a.render.anim_mix_factor)/c;a.render.anim_destination_mix_factor=b};a.set_speed=function(a,b,c){p(a.anim_slots,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.anim_slots[b].speed};a.get_anim_start_frame=function(a,b){return a.anim_slots[b].start};a.get_anim_length=function(a,b){return a.anim_slots[b].length};a.cleanup=function(){Ga.length=0;ja.length=0};a.fcurve_replace_euler_by_quat=function(a){var b=
(a[0]||a[1]||a[2])._pierced_points.length,c=ga,d=V,e=Boolean(a[0]);e||(a[0]={_pierced_points:new Float32Array(b),num_channels:8});var g=Boolean(a[1]);g||(a[1]={_pierced_points:new Float32Array(b),num_channels:8});var f=Boolean(a[2]);f||(a[2]={_pierced_points:new Float32Array(b),num_channels:8});a[3]={_pierced_points:new Float32Array(b),num_channels:8};for(var k=0;k<b;k++)d[0]=e?a[0]._pierced_points[k]:0,d[1]=g?a[1]._pierced_points[k]:0,d[2]=f?a[2]._pierced_points[k]:0,va.euler_to_quat(d,c),a[0]._pierced_points[k]=
c[3],a[1]._pierced_points[k]=c[0],a[2]._pierced_points[k]=c[1],a[3]._pierced_points[k]=c[2]};a.get_bpy_armobj=T;a.slot_by_anim_type=function(a,b){for(var c=7,d=0,e=0;e<ja.length;e++){var g=ja[e];if(g.name==b){d=g._render.type;break}}0==d&&(U(a,b)?d=30:(e=Q(a,name))&&"EMITTER"==e.p_type&&(d=50));for(e=0;8>e;e++)if(g=a.anim_slots[e]){if(g.type==d)return e}else e<c&&(c=e);return c}};b4w.module.__time=function(a,r){function u(){return-1!==h.animation.framerate?h.animation.framerate:p}var h=r("__config");r("__print");var b=0,f=0,l=[],q=0,e=0,n=[],p=-1;a.set_timeline=function(a){b=a;f=performance.now();for(a=0;a<l.length;a++){var c=l[a];b>c.expire_time&&(l.splice(a,1),a--,c.callback())}for(a=0;a<n.length;a++){var c=n[a],e=1-(c.expire_time-b)/c.duration,e=Math.min(e,1);c.callback(c.from+e*(c.to-c.from));1==e&&(n.splice(a,1),a--)}};a.get_timeline=function(){return b};a.set_timeout=
function(a,c){var e;q++;e=q;var h={id:e,callback:a,expire_time:b+(performance.now()-f+c)/1E3};l.push(h);return e};a.clear_timeout=function(a){for(var b=0;b<l.length;b++)if(l[b].id==a){l.splice(b,1);break}};a.clear_animation=function(a){for(var b=n.length;b--;)if(n[b].id==a){n.splice(b,1);break}};a.animate=function(a,c,f,h){f/=1E3;var l;e++;l=e;n.push({id:l,callback:h,from:a,to:c,expire_time:b+f,duration:f});h(a);return l};a.reset=function(a){f=b=0;l.length=0;e=q=n.length=0};a.get_framerate=u;a.set_framerate=
function(a){p=a};a.get_frame=function(a){return a*u()}};b4w.module.__transform=function(a,r){function u(a,b){if(c.has_child_of(a)){var d=c.get_child_of_offset(a);v.set_trans(b,d)}else v.set_trans(b,a.render.world_tsr)}function h(a,b){var d=a.render;if(c.has_child_of(a)){v.set_quat(b,d.world_tsr);var e=c.get_child_of_parent_tsr(a),e=v.invert(e,t),f=c.get_child_of_offset(a);v.multiply(e,d.world_tsr,f)}else v.set_quat(b,d.world_tsr)}function b(a,b){if(c.has_child_of(a)){var d=c.get_child_of_offset(a);v.set_quat(b,d)}else v.set_quat(b,a.render.world_tsr)}
function f(a,b){v.get_quat(a.render.world_tsr,b);return b}function l(a,b){if(c.has_child_of(a)){var d=c.get_child_of_offset(a);v.get_quat(d,b)}else v.get_quat(a.render.world_tsr,b);return b}function q(a,b){if(c.has_child_of(a)){var d=c.get_child_of_offset(a);v.copy(b,d)}else v.copy(b,a.render.world_tsr)}function e(a,b){if(c.has_child_of(a)){var d=c.get_child_of_offset(a);v.copy(d,b)}else v.copy(a.render.world_tsr,b);return b}function n(a){var b=a.render,e=a.scenes_data,f=a.type;"CAMERA"==f&&B.update_camera_upside_down(a);
c.update_constraint(a,M);"CAMERA"==f&&B.update_camera(a);var h=v.get_trans(b.world_tsr,D),l=v.get_quat(b.world_tsr,d);p.bounding_box_transform(b.bb_local,b.world_tsr,b.bb_world);p.bounding_sphere_transform(b.bs_local,b.world_tsr,b.bs_world);if(b.use_batches_boundings)for(var q=0;q<e.length;q++)for(var r=e[q].batches,C=0;C<r.length;C++){var y=r[C];p.bounding_box_transform(y.bb_local,b.world_tsr,y.bb_world);p.bounding_sphere_transform(y.bs_local,b.world_tsr,y.bs_world);y.use_be&&p.bounding_ellipsoid_transform(y.be_local,
b.world_tsr,y.be_world)}else b.use_be&&p.bounding_ellipsoid_transform(b.be_local,b.world_tsr,b.be_world);switch(f){case "MESH":a.need_inv_zup_tsr&&v.invert(a.render.world_tsr,a.render.world_tsr_inv);if(r=a.armobj)v.invert(r.render.world_tsr,t),v.multiply(t,b.world_tsr,t),v.get_transcale(t,b.arm_rel_trans),v.get_quat(t,b.arm_rel_quat);b.force_zsort=!0;break;case "CAMERA":for(q=0;q<e.length;q++)B.update_camera_transform(a,e[q]);break;case "SPEAKER":w.speaker_update_transform(a,M,x);break;case "LAMP":k.update_light_transform(a)}for(q=
0;q<e.length;q++)if(C=e[q],C.is_active){r=C.scene;y=r._render;switch(f){case "MESH":b.shadow_cast&&E.schedule_shadow_update(r);y=C.cube_refl_subs;null!=b.cube_reflection_id&&y&&E.update_cube_reflect_subs(y,h);break;case "EMPTY":m.update_force(a);break;case "CAMERA":E.schedule_grass_map_update(r);if(y.shadow_params){y.shadow_params.enable_csm&&E.schedule_shadow_update(r);var u=A.get_scene_data(a,r).cameras[0];E.update_shadow_billboard_view(u,y.graph)}E.get_active()==r&&E.get_camera(r)==a&&w.listener_update_transform(r,
h,l,M,x);break;case "LAMP":E.update_lamp_scene(a,r)}y=C.plane_refl_subs;u=a.reflective_objs;if(u.length)for(C=0;C<y.length;C++){var K=y[C].camera;E.update_plane_reflect_subs(y[C],h,l);A.update_refl_objects(u,K.reflection_plane);B.set_view(K,E.get_camera(r));z.extract_frustum_planes(K.view_proj_matrix,K.frustum_planes)}}b=a.cons_descends;for(q=0;q<b.length;q++)n(b[q]);a=a.cons_armat_bone_descends;for(q=0;q<a.length;q++)b=a[q],r=b[0],c.update_bone_constraint(r,b[1])}var p=r("__boundings"),B=r("__camera"),
c=r("__constraints"),k=r("__lights"),m=r("__objects"),A=r("__obj_util"),E=r("__scenes"),w=r("__sfx"),v=r("__tsr"),z=r("__util"),y=r("__vec3"),D=new Float32Array(3),K=new Float32Array(3),d=new Float32Array(4);new Float32Array(9);var t=v.create(),C=v.create(),M=0,x=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){M=a;x++};a.set_translation=function(a,b){var d=a.render;if(c.has_child_of(a)){v.set_trans(b,d.world_tsr);var e=c.get_child_of_parent_tsr(a),e=v.invert(e,t),f=c.get_child_of_offset(a);
v.multiply(e,d.world_tsr,f)}else v.set_trans(b,d.world_tsr)};a.set_translation_rel=u;a.get_translation=function(a,b){v.get_trans(a.render.world_tsr,b);return b};a.get_translation_rel=function(a,b){if(c.has_child_of(a)){var d=c.get_child_of_offset(a);v.get_trans(d,b)}else v.get_trans(a.render.world_tsr,b);return b};a.set_rotation=h;a.set_rotation_rel=b;a.get_rotation=f;a.get_rotation_rel=l;a.set_rotation_euler=function(a,b){var c=z.euler_to_quat(b,d);h(a,c)};a.set_rotation_euler_rel=function(a,c){var e=
z.euler_to_quat(c,d);b(a,e)};a.get_rotation_euler=function(a,b){f(a,d);return b=z.quat_to_euler(euler,b)};a.get_rotation_euler_rel=function(a,b){l(a,d);return b=z.quat_to_euler(euler,b)};a.set_scale=function(a,b){var d=a.render;if(c.has_child_of(a)){var d=c.get_child_of_offset(a),e=v.get_scale(c.get_child_of_parent_tsr(a));v.set_scale(b/e,d)}else v.set_scale(b,d.world_tsr)};a.set_scale_rel=function(a,b){var d=a.render;c.has_child_of(a)?(d=c.get_child_of_offset(a),v.set_scale(b,d)):v.set_scale(b,d.world_tsr)};
a.get_scale=function(a){return v.get_scale(a.render.world_tsr)};a.get_scale_rel=function(a){return c.has_child_of(a)?(a=c.get_child_of_offset(a),v.get_scale(a)):v.get_scale(a.render.world_tsr)};a.set_tsr=function(a,b){v.copy(b,a.render.world_tsr);if(c.has_child_of(a)){var d=c.get_child_of_parent_tsr(a),d=v.invert(d,t),e=c.get_child_of_offset(a);v.multiply(d,a.render.world_tsr,e)}};a.set_tsr_rel=q;a.get_tsr=function(a,b){return v.copy(a.render.world_tsr,b)};a.get_tsr_rel=e;a.get_object_size=function(a){var b=
a.render;a=b.bb_original;var c=v.get_scale(b.world_tsr),b=c*(a.max_x-a.min_x),d=c*(a.max_y-a.min_y);a=c*(a.max_z-a.min_z);return.5*Math.sqrt(b*b+d*d+a*a)};a.get_object_center=function(a,b,c){b?(a=a.render,y.copy(a.bs_world.center,c)):(a=a.render,b=a.bb_original,c[0]=(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,v.transform_vec3(c,a.world_tsr,c));return c};a.move_local=function(a,b,c,d){var f=e(a,t),k=D;k[0]=b;k[1]=c;k[2]=d;v.transform_vec3(k,f,k);u(a,k)};a.rotate_local=function(a,
b){var c=e(a,t),d=v.set_quat(b,v.identity(C));v.multiply(c,d,d);q(a,d)};a.update_transform=n;a.distance=function(a,b){var c=v.get_trans(a.render.world_tsr,D),d=v.get_trans(b.render.world_tsr,K);return y.dist(c,d)};a.obj_point_distance=function(a,b){var c=v.get_trans(a.render.world_tsr,D);return y.dist(c,b)};a.get_object_bounding_box=function(a){return{max_x:a.render.bb_world.max_x,min_x:a.render.bb_world.min_x,max_y:a.render.bb_world.max_y,min_y:a.render.bb_world.min_y,max_z:a.render.bb_world.max_z,
min_z:a.render.bb_world.min_z}}};b4w.module.__tsr=function(a,r){function u(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a}function h(){var a=new Float32Array(9);a[3]=1;a[7]=1;return a}function b(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b}function f(a,b,c,e){e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=b;e[4]=c[0];e[5]=c[1];e[6]=c[2];e[7]=c[3];return e}function l(a,b){b[0]=a[4];b[1]=a[5];b[2]=a[6];b[3]=a[7];return b}function q(a,b,c){var e=b[0],f=b[1],k=b[2],d=b[3],h=b[4],l=b[5],m=b[6];
b=b[7];var n=a[0]*d,g=a[1]*d,p=a[2]*d;a=b*n+l*p-m*g;var d=b*g+m*n-h*p,q=b*p+h*g-l*n,n=-h*n-l*g-m*p;c[0]=a*b+n*-h+d*-m-q*-l;c[1]=d*b+n*-l+q*-h-a*-m;c[2]=q*b+n*-m+a*-l-d*-h;c[0]+=e;c[1]+=f;c[2]+=k;return c}var e=r("__mat4"),n=r("__quat"),p=r("__util"),B=r("__vec3"),c=Math.sin(-Math.PI/4),k=-c,m=new Float32Array(3),A=new Float32Array(4);new Float32Array(4);var E=new Float32Array(16);a.create=u;a.clone=function(a){var c=u();b(a,c);return c};a.from_values=function(a,b,c,e,f,k,d,h){var l=u();l[0]=a;l[1]=
b;l[2]=c;l[3]=e;l[4]=f;l[5]=k;l[6]=d;l[7]=h;return l};a.create_ext=h;a.clone_ext=function(a){var c=h();b(a,c);return c};a.from_values_ext=function(a,b,c,e,f,k,d,l){var m=h();m[0]=a;m[1]=b;m[2]=c;m[3]=e;m[4]=f;m[5]=k;m[6]=d;m[7]=l;return m};a.copy=b;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.set_sep=f;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.get_scale=function(a){return a[3]};a.get_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.get_quat_view=function(a){return a.subarray(4,8)};a.get_quat=l;a.invert=function(a,b){var c=1/a[3];if(!c)return null;var e=a[0],f=a[1],k=a[2];A[0]=a[4];A[1]=
a[5];A[2]=a[6];A[3]=a[7];n.invert(A,A);var d=A[0],h=A[1],l=A[2],m=A[3],e=e*c,f=f*c,p=k*c,k=m*e+h*p-l*f,g=m*f+l*e-d*p,q=m*p+d*f-h*e,e=-d*e-h*f-l*p;b[0]=-(k*m+e*-d+g*-l-q*-h);b[1]=-(g*m+e*-h+q*-d-k*-l);b[2]=-(q*m+e*-l+k*-h-g*-d);b[3]=c;b[4]=d;b[5]=h;b[6]=l;b[7]=m;return b};a.to_mat4=function(a,b){var c=a.subarray(0,3),f=a[3],k=a.subarray(4,8);e.fromRotationTranslation(k,c,b);for(c=0;12>c;c++)b[c]*=f;return b};a.from_mat4=function(a,b){var c=p.matrix_to_trans(a,m),e=p.matrix_to_scale(a),k=p.matrix_to_quat(a,
A);f(c,e,k,b);return b};a.multiply=function(a,b,c){q(b,a,c);c[3]=a[3]*b[3];var e=a[4],f=a[5],k=a[6];a=a[7];var d=b[4],h=b[5],l=b[6];b=b[7];c[4]=e*b+a*d+f*l-k*h;c[5]=f*b+a*h+k*d-e*l;c[6]=k*b+a*l+e*h-f*d;c[7]=a*b-e*d-f*h-k*l;return c};a.transform_mat4=function(a,b,c){var f=b.subarray(0,3),k=b[3];b=b.subarray(4,8);f=e.fromRotationTranslation(b,f,E);for(b=0;12>b;b++)f[b]*=k;e.multiply(f,a,c);return c};a.transform_vec3=q;a.transform_vec3_inv=function(a,b,c){var e=b[3],f=a[0]-b[0],k=a[1]-b[1],d=a[2]-b[2];
a=b[4];var h=b[5],l=b[6];b=b[7];var m=a*a+h*h+l*l+b*b,m=m?1/m:0;a=-a*m;h=-h*m;l=-l*m;b*=m;var m=b*f+h*d-l*k,n=b*k+l*f-a*d,g=b*d+a*k-h*f,f=-a*f-h*k-l*d;c[0]=m*b+f*-a+n*-l-g*-h;c[1]=n*b+f*-h+g*-a-m*-l;c[2]=g*b+f*-l+m*-h-n*-a;c[0]/=e;c[1]/=e;c[2]/=e;return c};a.transform_vectors=function(a,b,c,e){e||(e=0);var f=a.length,k=b[0],d=b[1],h=b[2],l=b[3],m=b[4],n=b[5],g=b[6];b=b[7];for(var p=0;p<f;p+=3){var q=a[p]*l,r=a[p+1]*l,B=a[p+2]*l,A=b*q+n*B-g*r,u=b*r+g*q-m*B,E=b*B+m*r-n*q,q=-m*q-n*r-g*B;c[e+p]=A*b+q*
-m+u*-g-E*-n;c[e+p+1]=u*b+q*-n+E*-m-A*-g;c[e+p+2]=E*b+q*-g+A*-n-u*-m;c[e+p]+=k;c[e+p+1]+=d;c[e+p+2]+=h}return c};a.transform_dir_vectors=function(a,b,c,e){e||(e=0);var f=a.length,k=b[3],d=b[4],h=b[5],l=b[6];b=b[7];for(var m=0;m<f;m+=3){var n=a[m]*k,g=a[m+1]*k,p=a[m+2]*k,q=b*n+h*p-l*g,r=b*g+l*n-d*p,B=b*p+d*g-h*n,n=-d*n-h*g-l*p;c[e+m]=q*b+n*-d+r*-l-B*-h;c[e+m+1]=r*b+n*-h+B*-d-q*-l;c[e+m+2]=B*b+n*-l+q*-h-r*-d}return c};a.transform_dir_vec3=function(a,b,c){var e=b[3],f=b[4],k=b[5],d=b[6];b=b[7];var h=
a[0]*e,l=a[1]*e,m=a[2]*e;a=b*h+k*m-d*l;var e=b*l+d*h-f*m,n=b*m+f*l-k*h,h=-f*h-k*l-d*m;c[0]=a*b+h*-f+e*-d-n*-k;c[1]=e*b+h*-k+n*-f-a*-d;c[2]=n*b+h*-d+a*-k-e*-f;return c};a.transform_tangents=function(a,b,c,e){e||(e=0);var f=a.length,k=b[3],d=b[4],h=b[5],l=b[6];b=b[7];for(var m=0;m<f;m+=4){var n=a[m]*k,g=a[m+1]*k,p=a[m+2]*k,q=b*n+h*p-l*g,r=b*g+l*n-d*p,B=b*p+d*g-h*n,n=-d*n-h*g-l*p;c[e+m]=q*b+n*-d+r*-l-B*-h;c[e+m+1]=r*b+n*-h+B*-d-q*-l;c[e+m+2]=B*b+n*-l+q*-h-r*-d;c[e+m+3]=a[m+3]}return c};a.transform_quat=
function(a,b,c){b=l(b,A);n.multiply(b,a,c);return c};a.transform_quats=function(a,b,c,e){e=e||0;b=l(b,A);p.quats_multiply_quat(a,b,c,e);return c};a.translate=function(a,b,c){var e=a[3],f=a[4],k=a[5],d=a[6],h=a[7],l=b[0]*e,m=b[1]*e,n=b[2]*e;b=h*l+k*n-d*m;var e=h*m+d*l-f*n,g=h*n+f*m-k*l,l=-f*l-k*m-d*n;c[0]=a[0]+b*h+l*-f+e*-d-g*-k;c[1]=a[1]+e*h+l*-k+g*-f-b*-d;c[2]=a[2]+g*h+l*-d+b*-k-e*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,e){var f=a.subarray(0,3),
k=b.subarray(0,3),d=e.subarray(0,3);B.lerp(f,k,c,d);f=a[3];e[3]=f+c*(b[3]-f);a=a.subarray(4,8);b=b.subarray(4,8);f=e.subarray(4,8);n.slerp(a,b,c,f);return e};a.extrapolate=function(a,b,c,e){var f=a.subarray(0,3),k=b.subarray(0,3),d=e.subarray(0,3);d[0]=k[0]*(c+1)-f[0]*c;d[1]=k[1]*(c+1)-f[1]*c;d[2]=k[2]*(c+1)-f[2]*c;e[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4,8);b=b.subarray(4,8);f=e.subarray(4,8);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;n.normalize(f,f);
return e};a.integrate=function(a,b,c,e,f){f[0]=a[0]+b*c[0];f[1]=a[1]+b*c[1];f[2]=a[2]+b*c[2];f[3]=a[3];c=e[0];var k=e[1];e=e[2];var d=a[4],h=a[5],l=a[6],m=a[7];f[4]=.5*(c*m+k*l-e*h);f[5]=.5*(k*m+e*d-c*l);f[6]=.5*(e*m+c*h-k*d);f[7]=.5*(-c*d-k*h-e*l);f[4]=a[4]+f[4]*b;f[5]=a[5]+f[5]*b;f[6]=a[6]+f[6]*b;f[7]=a[7]+f[7]*b;a=f[4];b=f[5];c=f[6];k=f[7];a=a*a+b*b+c*c+k*k;0<a&&(a=1/Math.sqrt(a),f[4]*=a,f[5]*=a,f[6]*=a,f[7]*=a)};a.to_zup_view=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];var e=a[4],f=
a[5],h=a[6],l=a[7];b[4]=e*k+l*c;b[5]=f*k+h*c;b[6]=h*k-f*c;b[7]=l*k-e*c};a.to_zup_model=function(a,b){b[0]=a[0];b[1]=-a[2];b[2]=a[1];b[3]=a[3];b[4]=a[4];b[5]=-a[6];b[6]=a[5];b[7]=a[7]}};b4w.module.__util=function(a,r){function u(a){return 0<a?1:0>a?-1:0}function h(a,b,c){var d=a[0],e=a[1];a=a[2];var g=Math.cos(d/2),f=Math.cos(e/2),k=Math.cos(a/2),h=Math.sin(d/2),e=Math.sin(e/2),l=Math.sin(a/2);if(-1<U.indexOf(b))var m=Math.cos((d+a)/2),n=Math.sin((d+a)/2),p=Math.cos((d-a)/2),q=Math.sin((d-a)/2),t=Math.cos((a-d)/2),r=Math.sin((a-d)/2);switch(b){case ea:c[0]=f*n;c[1]=e*p;c[2]=e*q;c[3]=f*m;break;case aa:c[0]=e*q;c[1]=f*n;c[2]=e*p;c[3]=f*m;break;case Ga:c[0]=e*p;c[1]=e*q;c[2]=f*n;c[3]=
f*m;break;case 3:c[0]=f*n;c[1]=e*r;c[2]=e*t;c[3]=f*m;break;case ja:c[0]=e*t;c[1]=f*n;c[2]=e*r;c[3]=f*m;break;case pa:c[0]=e*r;c[1]=e*t;c[2]=f*n;c[3]=f*m;break;case 6:c[0]=h*f*k+g*e*l;c[1]=g*e*k-h*f*l;c[2]=g*f*l+h*e*k;c[3]=g*f*k-h*e*l;break;case 7:c[0]=g*f*l+h*e*k;c[1]=h*f*k+g*e*l;c[2]=g*e*k-h*f*l;c[3]=g*f*k-h*e*l;break;case 8:c[0]=g*e*k-h*f*l;c[1]=g*f*l+h*e*k;c[2]=h*f*k+g*e*l;c[3]=g*f*k-h*e*l;break;case 9:c[0]=h*f*k-g*e*l;c[1]=g*f*l-h*e*k;c[2]=g*e*k+h*f*l;c[3]=g*f*k+h*e*l;break;case 10:c[0]=g*e*k+
h*f*l;c[1]=h*f*k-g*e*l;c[2]=g*f*l-h*e*k;c[3]=g*f*k+h*e*l;break;case 11:c[0]=g*f*l-h*e*k,c[1]=g*e*k+h*f*l,c[2]=h*f*k-g*e*l,c[3]=g*f*k+h*e*l}return c}function b(a,b,c){var d=a[0],e=a[1],g=a[2];a=a[3];switch(b){case ea:c[0]=Math.atan2(d*e+g*a,e*a-d*g);c[1]=Math.acos(1-2*(e*e+g*g));c[2]=Math.atan2(d*e-g*a,d*g+e*a);break;case aa:c[0]=Math.atan2(d*a+e*g,g*a-d*e);c[1]=Math.acos(1-2*(d*d+g*g));c[2]=Math.atan2(e*g-d*a,d*e+g*a);break;case Ga:c[0]=Math.atan2(d*g+e*a,d*a-e*g);c[1]=Math.acos(1-2*(d*d+e*e));c[2]=
Math.atan2(d*g-e*a,d*a+e*g);break;case 3:c[0]=Math.atan2(d*g-e*a,d*e+g*a);c[1]=Math.acos(1-2*(e*e+g*g));c[2]=Math.atan2(d*g+e*a,g*a-d*e);break;case ja:c[0]=Math.atan2(d*e-g*a,d*a+e*g);c[1]=Math.acos(1-2*(d*d+g*g));c[2]=Math.atan2(d*e+g*a,d*a-e*g);break;case pa:c[0]=Math.atan2(e*g-d*a,d*g+e*a);c[1]=Math.acos(1-2*(d*d+e*e));c[2]=Math.atan2(d*a+e*g,e*a-d*g);break;case 6:c[0]=Math.atan2(2*(d*a-e*g),1-2*(d*d+e*e));c[1]=Math.asin(2*(d*g+e*a));c[2]=Math.atan2(2*(g*a-d*e),1-2*(e*e+g*g));break;case 7:b=d*
e+g*a;.499999<b?(c[0]=0,c[1]=Math.PI/2,c[2]=2*Math.atan2(d,a)):-.499999>b?(c[0]=0,c[1]=-Math.PI/2,c[2]=-2*Math.atan2(d,a)):(c[0]=Math.atan2(2*(e*a-d*g),1-2*(e*e+g*g)),c[1]=Math.asin(2*(d*e+g*a)),c[2]=Math.atan2(2*(d*a-e*g),1-2*(d*d+g*g)));break;case 8:c[0]=Math.atan2(2*(g*a-d*e),1-2*(d*d+g*g));c[1]=Math.asin(2*(d*a+e*g));c[2]=Math.atan2(2*(e*a-d*g),1-2*(d*d+e*e));break;case 9:c[0]=Math.atan2(2*(d*a+e*g),1-2*(d*d+g*g));c[1]=Math.asin(2*(g*a-d*e));c[2]=Math.atan2(2*(d*g+e*a),1-2*(e*e+g*g));break;case 10:c[0]=
Math.atan2(2*(d*g+e*a),1-2*(d*d+e*e));c[1]=Math.asin(2*(d*a-e*g));c[2]=Math.atan2(2*(d*e+g*a),1-2*(d*d+g*g));break;case 11:b=e*a-d*g,.499999<b?(c[0]=0,c[1]=Math.PI/2,c[2]=-2*Math.atan2(g,a)):-.499999>b?(c[0]=0,c[1]=-Math.PI/2,c[2]=2*Math.atan2(g,a)):(c[0]=Math.atan2(2*(d*e+g*a),1-2*(e*e+g*g)),c[1]=Math.asin(2*(e*a-d*g)),c[2]=Math.atan2(2*(d*a+e*g),1-2*(d*d+e*e)))}return c}function f(a,b,c){var d=b.length,e=Q;e[0]=a[0];e[1]=a[1];e[2]=a[2];G.normalize(e,e);d?(a=ma,a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=
b[3],b=G.cross(a,e,ha),G.normalize(b,b),G.cross(e,b,a),d=da,d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=e[0],d[4]=e[1],d[5]=e[2],d[6]=b[0],d[7]=b[1],d[8]=b[2],H.fromMat3(d,c),c[3]=0<c[3]?c[3]+1E-6:c[3]-1E-6,(0<c[3]&&0>a[3]||0>c[3]&&0<a[3])&&H.scale(c,-1,c),H.normalize(c,c)):H.rotationTo(za,e,c);return c}function l(a,b){b||(b=new Float32Array(4));t.fromMat4(a,da);var c=da[0],d=da[3],e=da[6],g=da[1],f=da[4],k=da[7],h=da[2],l=da[5],m=da[8],c=Math.sqrt(c*c+d*d+e*e)||1,g=Math.sqrt(g*g+f*f+k*k)||1,h=Math.sqrt(h*
h+l*l+m*m)||1;da[0]/=c;da[3]/=c;da[6]/=c;da[1]/=g;da[4]/=g;da[7]/=g;da[2]/=h;da[5]/=h;da[8]/=h;H.fromMat3(da,b);H.normalize(b,b);return b}function q(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=Math.sqrt(b*b+c*c+d*d),g=1/g;a[0]=b*g;a[1]=c*g;a[2]=d*g;a[3]=e*g}function e(a,b){var c=b;switch(typeof a){case "object":if(a)switch(a.constructor){case Object:for(var d in a)c=e(a[d],c);break;case Float32Array:case Uint32Array:case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Float64Array:for(d=
0;d<a.length;d++)c=n(a[d],c);break;case Array:for(d=0;d<a.length;d++)c=e(a[d],c);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:c=n(0,c);break;default:w("Wrong object constructor")}else c=n(0,c);return c;case "number":return n(a,c);case "boolean":return n(a|0,c);case "string":return p(a,c);case "function":case "undefined":return n(0,c)}}function n(a,b){var c=b;S[0]=a;c=(c<<5)-c+R[0];c&=c;c=(c<<5)-c+R[1];return c&c}function p(a,
b){for(var c=b,d=0;d<a.length;d++)var e=a.charCodeAt(d),c=(c<<5)-c+e,c=c&c;return c}function B(a){return(34*a+1)*a%289}function c(a){return a-Math.floor(a)}function k(a){return m((34*a+5)*a)}function m(a){return a-289*Math.floor(a/289)}function A(a){return a-7*Math.floor(a/7)}function E(a,b,c){a<b&&(a=b);a>c&&(a=c);return a}function w(a){a&&x.error.apply(x,arguments);throw"engine panic:\nThe engine tried to perform an invalid operation and halted.\nPlease copy the console contents above and submit it to the Blend4Web forum at\nhttps://www.blend4web.com/en/forums/forum/17/";
}function v(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function z(a){return v(a,0,2*Math.PI)}function y(a,b){if(a&&b){var c=a instanceof Array;if(c!=b instanceof Array)return!1;var d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength;if(d!=(b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength))return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!D(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{switch(a.constructor){case WebGLUniformLocation:case WebGLProgram:case WebGLShader:case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:return a==
b}for(var e in a)if(!D(a[e],b[e]))return!1;for(e in b)if(!(e in a))return!1}return!0}return!(a||b)}function D(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return y(a,b);default:return!0}}function K(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?
c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function d(){var a=[{}];a.length=0;return a}var t=r("__mat3"),C=r("__mat4"),M=r("__math"),x=r("__print"),g=r("__tsr"),H=r("__quat"),G=r("__vec3"),ba=r("__vec4"),L=0,F={},U=[ea,aa,Ga,ja,pa],Q=new Float32Array(3),T=new Float32Array(3),W=new Float32Array(3),ha=new Float32Array(3),Y=new Float32Array(3),Z=new Float32Array(3),N=new Float32Array(3),ca=new Float32Array(3),I=new Float32Array(4),ma=new Float32Array(4),da=new Float32Array(9),
fa=new Float32Array(16),Aa=new Float32Array(16),ra=H.create(),S=new Float64Array(1),R=new Uint32Array(S.buffer),sa=new Float32Array([0,0,0]),va=new Float32Array([0,0,0,1]),ua=new Float32Array([0,0,0,1,0,0,0,1]),J=new Float32Array([1,1,1]),na=new Float32Array([1,0,0]),za=new Float32Array([0,1,0]),V=new Float32Array([0,0,1]),wa=new Float32Array([-1,0,0]),ga=new Float32Array([0,-1,0]),X=new Float32Array([0,0,-1]),ea=0,aa=1,Ga=2,ja=4,pa=5,ya=Math.floor(44488.07041494893),Ea=[new Float32Array([0,0,-1,
0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])];a.VEC3_IDENT=sa;a.QUAT4_IDENT=va;a.TSR8_IDENT=ua;a.VEC3_UNIT=J;a.AXIS_X=na;a.AXIS_Y=za;a.AXIS_Z=V;a.AXIS_MX=wa;a.AXIS_MY=ga;a.AXIS_MZ=X;a.XYX=ea;a.YZY=aa;a.ZXZ=Ga;a.XZX=3;a.YXY=ja;a.ZYZ=pa;a.XYZ=6;a.YZX=
7;a.ZXY=8;a.XZY=9;a.YXZ=10;a.ZYX=11;a.INV_CUBE_VIEW_MATRS=Ea;a.BYTE_SIZE=1;a.SHORT_SIZE=2;a.FLOAT_SIZE=4;a.INT_SIZE=4;a.isdef=function(a){return"undefined"!=typeof a};a.keyfind=function(a,b,c){for(var d=[],e=c.length,g=0;g<e;g++){var f=c[g];f[a]==b&&d.push(f)}return d};a.f32=function(a){return new Float32Array(a)};a.float32_concat=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.uint32_concat=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);
d.set(b,c);return d};a.check_endians=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.array_intersect=function(a,b){var c=[],d={},e=b.length,g,f;for(g=0;g<e;g++)d[b[g]]=!0;e=a.length;for(g=0;g<e;g++)f=a[g],f in d&&c.push(f);return c};a.sign=u;a.keycheck=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.key2search=function(a,
b,c,d,e){for(var g=0;g<e.length;g++){var f=e[g];if(f[a]==b&&f[c]==d)return f}return null};a.get_index_for_key_value=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.append_unique=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.check_uniqueness=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.trans_matrix=function(a,b,c,d){d||(d=new Float32Array(16));C.identity(d);d[12]=a;d[13]=b;d[14]=
c;return d};var Ca=1;a.rand=function(){Ca=(69069*Ca+5)%Math.pow(2,32);return Math.round(Ca/65536)%32768/32767};a.srand=function(a){Ca=a};a.rand_r=function(a){var b=a[0]%ya*48271-3399*Math.floor(a[0]/ya);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.init_rand_r_seed=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Q;c[0]=a[2];c[1]=a[1];c[2]=a[0];h(c,11,b);return b};a.ordered_angles_to_quat=h;a.quat_to_ordered_angles=b;a.euler_to_rotation_matrix=function(a){var b=
t.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),g=Math.sin(a[0]),f=Math.sin(a[1]);a=Math.sin(a[2]);var k=c*e,h=c*a,l=g*e,m=g*a;b[0]=d*e;b[1]=d*a;b[2]=-f;b[3]=f*l-h;b[4]=f*m+k;b[5]=d*g;b[6]=f*k+m;b[7]=f*h-l;b[8]=d*c;return b};a.quat_to_euler=function(a,c){var d=b(a,11,Q);c[0]=d[2];c[1]=d[1];c[2]=d[0];return c};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));G.transformQuat(b,a,c);return c};a.dir_to_quat=function(a,b,c){c||(c=new Float32Array(4));a=G.normalize(a,Q);var d=G.dot(b,
a);a=G.cross(b,a,W);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.trans_quat_to_plane=function(a,b,c,d){d||(d=new Float32Array(4));G.transformQuat(c,b,d);d[3]=-G.dot(a,d);return d};a.dir_ground_proj_angle=function(a){var b=g.get_quat_view(a.render.world_tsr),c=Q;switch(a.type){case "CAMERA":c[0]=0;c[1]=-1;c[2]=0;G.transformQuat(c,b,c);W[0]=0;W[1]=0;W[2]=-1;break;case "MESH":c[0]=0;c[1]=0;c[2]=1;G.transformQuat(c,b,c);W[0]=0;W[1]=
0;W[2]=1;break;case "EMPTY":c[0]=0,c[1]=1,c[2]=0,G.transformQuat(c,b,c),W[0]=0,W[1]=1,W[2]=0}c[1]=0;G.normalize(c,c);a=G.dot(c,W);c=0<-c[0]*W[2]?-1:1;return Math.acos(a)*c};a.blend_arrays=function(a,b,c,d){if(0==c)return a;d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.unique_id=function(){L++;return L.toString(10)};a.unique_name=function(a){F[a]||(F[a]=0);var b=a+F[a];F[a]++;return b};a.create_empty_va_frame=function(){return{a_position:new Float32Array(0),a_tbn_quat:new Float32Array(0)}};
a.gen_tbn_quats=function(a,b,c){b=b||d();var e=b.length,g=a.length/3;c=c||new Float32Array(4*g);for(var k=0;k<g;++k){var h=Q;h[0]=a[3*k];h[1]=a[3*k+1];h[2]=a[3*k+2];var l;e?(l=ma,l[0]=b[4*k],l[1]=b[4*k+1],l[2]=b[4*k+2],l[3]=b[4*k+3]):l=b;f(h,l,c.subarray(4*k,4*(k+1)))}return c};a.get_tbn_quat=f;a.clone_object_json=function(a){return JSON.parse(JSON.stringify(a))};a.clone_object_r=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:c=
new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.clone_object_r(b[d]);break;default:for(d in c=new c,b)c[d]=a.clone_object_r(b[d])}return c};a.clone_object_nr=function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof Object){var d=a[c].constructor;switch(d){case Int8Array:case Uint8Array:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=
a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=l;a.matrix_to_trans=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.matrix_to_scale=function(a){I[0]=.577350269189626;I[1]=.577350269189626;I[2]=.577350269189626;I[3]=0;ba.transformMat4(I,a,I);return ba.length(I)};a.extract_frustum_planes=function(a,b){var c=b.left,d=b.right,e=b.top,g=b.bottom,f=b.near,k=b.far;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-
a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];f[0]=a[3]+a[2];f[1]=a[7]+a[6];f[2]=a[11]+a[10];f[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];q(c);q(d);q(e);q(g);q(f);q(k);return b};a.sphere_is_out_of_frustum=function(a,b,c){return c<-M.point_plane_dist(a,b.near)||c<-M.point_plane_dist(a,b.left)||c<-M.point_plane_dist(a,b.right)||c<-M.point_plane_dist(a,b.top)||c<-M.point_plane_dist(a,
b.bottom)||c<-M.point_plane_dist(a,b.far)?!0:!1};a.ellipsoid_is_out_of_frustum=function(a,b,c,d,e){var g=G.dot(c,b.far),f=G.dot(d,b.far),k=G.dot(e,b.far),g=Math.sqrt(g*g+f*f+k*k);if(g<-M.point_plane_dist(a,b.near)||g<-M.point_plane_dist(a,b.far))return!0;g=G.dot(c,b.left);f=G.dot(d,b.left);k=G.dot(e,b.left);if(Math.sqrt(g*g+f*f+k*k)<-M.point_plane_dist(a,b.left))return!0;g=G.dot(c,b.right);f=G.dot(d,b.right);k=G.dot(e,b.right);if(Math.sqrt(g*g+f*f+k*k)<-M.point_plane_dist(a,b.right))return!0;g=G.dot(c,
b.top);f=G.dot(d,b.top);k=G.dot(e,b.top);if(Math.sqrt(g*g+f*f+k*k)<-M.point_plane_dist(a,b.top))return!0;g=G.dot(c,b.bottom);f=G.dot(d,b.bottom);k=G.dot(e,b.bottom);return Math.sqrt(g*g+f*f+k*k)<-M.point_plane_dist(a,b.bottom)?!0:!1};a.positions_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=3){var f=a[g],k=a[g+1],h=a[g+2];c[d+g]=b[0]*f+b[4]*k+b[8]*h+b[12];c[d+g+1]=b[1]*f+b[5]*k+b[9]*h+b[13];c[d+g+2]=b[2]*f+b[6]*k+b[10]*h+b[14]}return c};a.vectors_multiply_matrix=function(a,
b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=3){var f=a[g],k=a[g+1],h=a[g+2];c[d+g]=b[0]*f+b[4]*k+b[8]*h;c[d+g+1]=b[1]*f+b[5]*k+b[9]*h;c[d+g+2]=b[2]*f+b[6]*k+b[10]*h}return c};a.quats_multiply_quat=function(a,b,c,d){d=d||0;for(var e=a.length,g=0;g<e;g+=4){ra[0]=a[g];ra[1]=a[g+1];ra[2]=a[g+2];ra[3]=a[g+3];var f=0<ra[3];H.multiply(b,ra,ra);(f&&0>ra[3]||!f&&0<ra[3])&&ba.scale(ra,-1,ra);c[d+g]=ra[0];c[d+g+1]=ra[1];c[d+g+2]=ra[2];c[d+g+3]=ra[3]}return c};a.vecdir_multiply_matrix=function(a,b,c){c||(c=
new Float32Array(3));I[0]=a[0];I[1]=a[1];I[2]=a[2];I[3]=0;ba.transformMat4(I,b,I);c[0]=I[0];c[1]=I[1];c[2]=I[2]};a.flatten=function(a,b){var c=a.length;c||w("flatten(): Wrong or empty array");var d=a[0].length;d||w("flatten(): Wrong or empty subarray");b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var g=0;g<d;g++)b[e*d+g]=a[e][g];return b};a.vectorize=function(a,b){b||(b=[]);for(var c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.binary_search_max=function(b,
c,d,e){if(e<d)return d;var g=d+Math.floor((e-d)/2);return b[g]>c?a.binary_search_max(b,c,d,g-1):b[g]<c?a.binary_search_max(b,c,g+1,e):g};a.cmp_arr=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.cmp_arr_float=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.scale_mat4=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.transform_mat4=function(a,b,
c,d,e){e||(e=new Float32Array(16));b=C.fromRotationTranslation(c,d,fa);C.multiply(b,a,e);return e};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=C.fromRotationTranslation(c,d,fa);1!==b&&(d=C.identity(Aa),b=G.set(b,b,b,Q),C.scale(d,b,d),C.multiply(c,d,c));G.transformMat4(a,c,e);return e};a.transform_vec4=function(a,b,c,d,e){e||(e=new Float32Array(4));b=C.fromRotationTranslation(c,d,fa);ba.transformMat4(a,b,e);return e};a.inverse_transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));
b=C.fromRotationTranslation(c,d,fa);C.invert(b,b);G.transformMat4(a,b,e);return e};a.transcale_quat_to_matrix=function(a,b,c){c||(c=new Float32Array(16));C.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.matrix_to_transcale_quat=function(b,c,d){a.matrix_to_trans(b,c);c[3]=a.matrix_to_scale(b);l(b,d)};a.array_stringify=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.rotate_point_pivot=function(a,b,c,d){d||(d=new Float32Array(3));var e=
Q;G.subtract(b,a,e);G.transformQuat(e,c,e);G.subtract(b,e,d)};a.generate_cubemap_matrices=function(){var a=Q;a[0]=0;a[1]=0;a[2]=0;var b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),g=new Float32Array(16),f=new Float32Array(16);C.lookAt(a,[-1,0,0],[0,-1,0],b);C.scale(b,[-1,1,1],b);C.scale(b,[-1,1,-1],c);C.lookAt(a,[0,-1,0],[0,0,-1],d);C.scale(d,[1,1,-1],d);C.scale(d,[1,-1,-1],e);C.lookAt(a,[0,0,-1],[0,-1,0],g);C.scale(g,[-1,1,1],g);C.scale(g,[-1,1,-1],f);
return[b,c,d,e,g,f]};a.generate_inv_cubemap_matrices=function(){var a=Q;a[0]=0;a[1]=0;a[2]=0;var b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),g=new Float32Array(16),f=new Float32Array(16);C.lookAt(a,[1,0,0],[0,-1,0],b);C.scale(b,[-1,1,-1],c);C.lookAt(a,[0,1,0],[0,0,1],d);C.scale(d,[1,-1,-1],e);C.lookAt(a,[0,0,1],[0,-1,0],g);C.scale(g,[-1,1,-1],f);return[b,c,d,e,g,f]};a.calc_variable_id=function(a,b){return e(a,b)};a.hash_code=e;a.hash_code_string=p;a.mat3_to_mat4=
function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.deg_to_rad=function(a){return a*Math.PI/180};a.rad_to_deg=function(a){return 180*
a/Math.PI};a.snoise=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],d=Math.floor(a[0]+b),e=Math.floor(a[1]+b),g=.211324865405187*d+.211324865405187*e,b=a[0]-d+g;a=a[1]-e+g;var f=b>a?1:0,k=1-f,g=b+.211324865405187-f,h=a+.211324865405187-k,l=b+-.577350269189626,m=a+-.577350269189626,d=d%289,e=e%289,n=B(B(e)+d),k=B(B(e+k)+d+f),p=B(B(e+1)+d+1),d=Math.max(.5-(b*b+a*a),0),e=Math.max(.5-(g*g+h*h),0),f=Math.max(.5-(l*l+m*m),0),d=d*d*d*d,e=e*e*e*e,f=f*f*f*f,q=2*c(.024390243902439*n)-1,t=2*c(.024390243902439*
k)-1,r=2*c(.024390243902439*p)-1,n=Math.abs(q)-.5,k=Math.abs(t)-.5,p=Math.abs(r)-.5,q=q-Math.floor(q+.5),t=t-Math.floor(t+.5),r=r-Math.floor(r+.5);return 130*(d*(1.79284291400159-.85373472095314*(q*q+n*n))*(q*b+n*a)+e*(1.79284291400159-.85373472095314*(t*t+k*k))*(t*g+k*h)+f*(1.79284291400159-.85373472095314*(r*r+p*p))*(r*l+p*m))};a.cellular2x2=function(a){var b=1/7,d=b/2,e=m(Math.floor(a[0])),g=m(Math.floor(a[1])),f=c(a[0]);a=c(a[1]);var h=f-.5,l=f-1.5,f=a-.5;a-=1.5;var n=k(e),e=k(e+1),p=n,q=e,n=
k(n+g),e=k(e+g),p=k(p+g+1),q=k(q+g+1),t=A(n)*b+d,r=A(e)*b+d,B=A(p)*b+d,g=A(q)*b+d,n=A(Math.floor(n*b))*b+d,e=A(Math.floor(e*b))*b+d,p=A(Math.floor(p*b))*b+d,b=A(Math.floor(q*b))*b+d,d=h+.7*t,r=l+.7*r,h=h+.7*B,l=l+.7*g,g=f+.7*n,f=f+.7*e,n=a+.7*p;a+=.7*b;return Math.min(d*d+g*g,r*r+f*f,h*h+n*n,l*l+a*a)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=G.transformQuat(b,a,Q);b=c[0];var g=c[1];c=c[2];var f=da;f[0]=g*g+c*c;f[1]=-g*b;f[2]=-c*b;f[3]=-b*g;f[4]=b*b+c*c;f[5]=-c*g;f[6]=-b*c;f[7]=
-g*c;f[8]=b*b+g*g;G.transformMat3(a,f,a);G.normalize(a,a);H.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=I,d=ma,c=H.setAxisAngle([0,0,1],Math.PI,H.create()),d=H.setAxisAngle([1,0,0],Math.PI/2,H.create());H.multiply(c,d,c);H.multiply(a,c,b);return b};a.cleanup=function(){L=0;F={}};a.clamp=E;a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=
(1-c)*a[d]+c*b[d];return e};a.smooth_q=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);H.slerp(a,b,c,e);return e};a.is_arr_buf_view=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=t.fromQuat(a,da),d=Q;d[0]=c[6];d[1]=c[7];d[2]=c[8];d=G.cross(V,d,d);G.normalize(d,d);
var e=c[4];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);W[0]=c[0];W[1]=c[1];W[2]=c[2];G.normalize(W,W);c=ma;H.rotationTo(W,d,c);H.multiply(c,a,a)};a.get_array_smooth_value=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var g=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),f=b-1,k=a[e*b+c],h=a[e*b+Math.min(c+1,f)],l=a[Math.min(e+1,f)*b+c];a=a[Math.min(e+1,f)*b+Math.min(c+1,f)];return(k*(1-d)+h*d)*(1-g)+(l*(1-d)+a*d)*g};a.rgb_mask_get_channels_count=function(a){for(var b=0,c=0;3>c;c++)0<(a&
1<<c)&&b++;return b};a.rgb_mask_get_channels_presence=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.rgb_mask_get_channel_presence_index=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.gen_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.get_dict_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=
function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.horizontal_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=0;G.normalize(c,c)};a.transformQuatFast=function(a,b,c){var d=a[0],e=a[1];a=a[2];var g=b[0],f=b[1],k=b[2];b=b[3];var h=f*a-k*e,l=k*d-g*a,m=g*e-f*d,n=f*m-k*l,k=k*h-g*m,g=g*l-f*h;c[0]=d+2*h*b+2*n;c[1]=e+2*l*b+2*k;c[2]=a+2*m*b+2*g;return c};a.assert=function(a){a||w("Assertion failed")};a.panic=w;a.angle_wrap_periodic=
v;a.angle_wrap_0_2pi=z;a.get_file_extension=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.strict_objs_is_equal=function(a,b){for(var c in a){var d=!0,e=a[c],g=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==g;break;case "object":d=y(e,g)}if(!d)return!1}return!0};a.quat_bpy_b4w=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c;return b};a.gen_color_id=function(a){a+=1;132651<a&&x.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/
51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d){I.set(a);I[3]=b;a=ma;Q[0]=c[3];Q[1]=c[4];Q[2]=c[5];a.set(Q);a[3]=0;a=ba.dot(I,a);if(0==a)return null;b=ma;G.copy(c,Q);b.set(Q);b[3]=1;a=-ba.dot(I,b)/a;d[0]=c[0]+a*c[3];d[1]=c[1]+a*c[4];d[2]=c[2]+a*c[5];return d};a.get_plane_normal=function(a,b,c,d){var e=b[0]-a[0],g=c[0]-a[0],f=b[1]-a[1],k=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=f*a-b*k;d[1]=g*b-e*a;d[2]=e*k-f*g;return d};a.copy_array=function(a,b){for(var c=
0;c<a.length;c++)b[c]=a[c];return b};a.rotation_to_stable=function(a,b,c){var d=Q,e=G.dot(a,b);-.9999999>e?(G.cross(na,a,d),1E-6>G.length(d)&&G.cross(za,a,d),G.normalize(d,d),H.setAxisAngle(d,Math.PI,c)):(G.cross(a,b,d),c.set(d),c[3]=1+e,H.normalize(c,c));return c};a.calc_returning_angle=function(a,b,c){if(b==c)return c-a;a=z(a);b=z(b);c=z(c);b=2*Math.PI-b;c=z(c+b);a=z(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=E(a,b,c));return a*a*
(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.arrays_have_common=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.create_zero_array=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.version_cmp=function(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){var e=u((d>=a.length?0:a[d])-(d>=b.length?0:b[d]));if(e)return e}return 0};a.version_to_str=function(a){return a.join(".")};a.str_to_version=function(a){return a.split(".").map(function(a){return a|
0})};a.srgb_to_lin=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],2.2);return b};a.lin_to_srgb=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.normpath_preserve_protocol=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=K(b[1]),b.join("://")):K(a)};a.check_npot=function(a){return 0!=parseInt(a.toString(2).substr(1),2)};a.ellipsoid_axes_to_mat3=function(a,b,c,d){d[0]=a[0];d[1]=b[0];d[2]=c[0];d[3]=a[1];
d[4]=b[1];d[5]=c[1];d[6]=a[2];d[7]=b[2];d[8]=c[2];return d};a.create_non_smi_array=d;a.float_to_short=function(a){a=Math.round(32767.5*(a+1)-32768);return E(a?a:0,-32768,32767)};a.short_to_float=function(a){return E((a+32768)/32767.5-1,-1,1)};a.ufloat_to_ubyte=function(a){return E(Math.round(255*a),0,255)};a.ubyte_to_ufloat=function(a){return E(a/255,0,1)};a.dist_to_triange=function(a,b,c,d){var e=G.subtract(c,b,Q),g=G.subtract(d,c,T),f=G.subtract(b,d,W);b=G.subtract(a,b,ha);c=G.subtract(a,c,Y);a=
G.subtract(a,d,Z);d=G.cross(e,g,N);if(0<=G.dot(G.cross(d,e,ca),b)&&0<=G.dot(G.cross(d,g,ca),c)&&0<=G.dot(G.cross(d,f,ca),a))return f=G.length(d),g=G.dot(d,b),Math.abs(g/f);e=G.scale(e,E(G.dot(e,b)/G.length(e),0,1),ca);b=G.length(G.subtract(b,e,ca));g=G.scale(g,E(G.dot(g,c)/G.length(g),0,1),ca);g=G.length(G.subtract(c,g,ca));f=G.scale(f,E(G.dot(f,a)/G.length(f),0,1),ca);f=G.length(G.subtract(a,f,ca));return Math.min(Math.min(b,g),f)}};b4w.module.__sfx=function(a,r){function u(){var a=window.AudioContext||window.webkitAudioContext;if(a){try{var b=new a}catch(c){return z.error('Unable to initialize AudioContext: "'+c+'". The audio is disabled.'),null}if(b.createGain)return b;z.warn("deprecated WebAudio implementation");return null}z.warn("WebAudio is not supported");return null}function h(a,c,d){var g=a.sfx;if("NONE"!=g.behavior){var f=g.loop,k=g.pitch;if(g.src&&(f||0<=d)){g.base_seed=Math.floor(5E4*Math.random());var h=L.currentTime+
c,h=Math.max(0,h);g.start_time=h;g.state=20;var m=F._sfx;"POSITIONAL"==g.behavior&&"none"==m.distance_model&&(g.behavior="BACKGROUND_SOUND");b(a,F._sfx);if("POSITIONAL"==g.behavior||"BACKGROUND_SOUND"==g.behavior){c=L.createBufferSource();c.buffer=g.src;c.playbackRate.value=k;if(f){g.source_node&&g.source_node.disconnect();g.source_node2&&g.source_node2.disconnect();c.loop=!0;c.loopStart=g.loop_start;if(c.loopEnd=g.loop_end)d=L.createBufferSource(),d.buffer=g.src,d.playbackRate.value=k,g.source_node2=
d,d.connect(g.proc_chain_in);c.start(h);g.duration=0}else f=c.buffer?c.buffer.duration:0,d>f?(f=h+d+g.fade_out,c.loop=!0,c.start(h),c.stop(f),g.duration=d):(c.loop=!1,c.start(h),g.duration=f);c.connect(g.proc_chain_in);g.source_node=c;l(g);q(g);e(g)}else"BACKGROUND_MUSIC"==g.behavior&&(D.clear_timeout(g.bgm_start_timeout),D.clear_timeout(g.bgm_stop_timeout),d=function(){var b=a.sfx,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.source_node=b.source_node||L.createMediaElementSource(c),b.source_node.connect(b.proc_chain_in),
20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==c?d():g.bgm_start_timeout=D.set_timeout(d,1E3*c),f?g.duration=0:(d=w(a),g.duration=d));n(g,h)}}}function b(a,b){var c=a.sfx;if(!c.proc_chain_in){var e=K.get_trans_view(a.render.world_tsr),g=K.get_quat_view(a.render.world_tsr);if(M.mix_mode){var f=L.createBiquadFilter();f.type="peaking"}else f=null;var k=L.createGain();switch(c.behavior){case "POSITIONAL":var h=L.createPanner();"string"!=typeof h.panningModel?(h.panningModel=h.EQUALPOWER,
h.distanceModel=h.INVERSE_DISTANCE):(h.panningModel="equalpower",h.distanceModel=b.distance_model);h.setPosition(e[0],e[1],e[2]);t.copy(e,c.last_position);e=x;d.quat_to_dir(g,d.AXIS_MZ,e);h.setOrientation(e[0],e[1],e[2]);h.refDistance=c.dist_ref;h.maxDistance=c.dist_max;h.rolloffFactor=c.attenuation;h.coneInnerAngle=c.cone_angle_inner;h.coneOuterAngle=c.cone_angle_outer;h.coneOuterGain=c.cone_volume_outer;var l=L.createGain();l.gain.value=E(c);f?(h.connect(f),f.connect(l)):h.connect(l);l.connect(k);
c.proc_chain_in=h;if(c.volume_random){var m=L.createGain();k.connect(m);m.connect(b.proc_chain_in)}else m=null,k.connect(b.proc_chain_in);break;case "BACKGROUND_SOUND":h=null;l=L.createGain();l.gain.value=E(c);f?(c.proc_chain_in=f,f.connect(l)):c.proc_chain_in=l;l.connect(k);c.volume_random?(m=L.createGain(),k.connect(m),m.connect(b.proc_chain_in)):(m=null,k.connect(b.proc_chain_in));break;case "BACKGROUND_MUSIC":m=h=null,l=L.createGain(),l.gain.value=E(c),f?(c.proc_chain_in=f,f.connect(l)):c.proc_chain_in=
l,l.connect(k),k.connect(b.proc_chain_in)}c.panner_node=h;c.filter_node=f;c.gain_node=l;c.fade_gain_node=k;c.rand_gain_node=m}}function f(a){var b=a.sfx,c=b.duration,b=b.delay+b.delay_random*Math.random();h(a,b,c)}function l(a){var b=a.source_node2||a.source_node;d.isdef(b.onended)&&(b.onended=function(){a.state=50})}function q(a){a.volume_random&&a.rand_gain_node.gain.cancelScheduledValues(a.start_time);a.pitch_random&&(a.source_node.playbackRate.cancelScheduledValues(a.start_time),a.source_node2&&
a.source_node2.playbackRate.cancelScheduledValues(a.start_time));a.vp_rand_end_time=a.start_time}function e(a){if(a.volume_random||a.pitch_random){var b=a.rand_gain_node,c=a.source_node,e=c.buffer?c.buffer.duration:0;if(e){var g=a.start_time;Q[0]=a.base_seed;for(var f=0;5>f;){var k=a.pitch+a.pitch_random*d.rand_r(Q);if(g>=a.vp_rand_end_time){if(a.volume_random){var h=1-d.clamp(a.volume_random,0,1)*Math.random();b.gain.setValueAtTime(h,g)}a.pitch_random&&(c.playbackRate.setValueAtTime(k,g),a.source_node2&&
a.source_node2.playbackRate.setValueAtTime(k,g));f++}g+=e/k}a.vp_rand_end_time=g-.001}}}function n(a,b){if(a.fade_in||a.fade_out){var c=a.fade_gain_node;c.gain.cancelScheduledValues(b);a.fade_in?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.fade_in)):c.gain.setValueAtTime(1,b);a.fade_out&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.fade_out))}}function p(a){"SPEAKER"!=a.type&&d.panic("Wrong object type");var b=a.sfx;if(50==b.state)b.state=
30;else if(20==b.state||40==b.state){var c=b.fade_gain_node,e=L.currentTime;b.fade_out&&(c.gain.setValueAtTime(c.gain.value,e),c.gain.linearRampToValueAtTime(0,e+b.fade_out));"BACKGROUND_MUSIC"==b.behavior?b.src&&(D.clear_timeout(b.bgm_start_timeout),D.clear_timeout(b.bgm_stop_timeout),b.bgm_stop_timeout=D.set_timeout(function(){var b=a.sfx.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.fade_out)):(c=b.source_node,b.duration<c.buffer.duration?b.fade_out&&20==b.state?c.stop(e+b.fade_out):
20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.start_time=0,b.pause_time=0,b.buf_offset=0);b.state=30}}function B(a){a=a.sfx;if(20==a.state){var b=L.currentTime;a.pause_time=b;"BACKGROUND_MUSIC"==a.behavior?(b=a.src)&&b.pause():(a.buf_offset=b>a.start_time?c(a,b):0,a.source_node.onended=function(){},a.source_node.stop(0),a.source_node.disconnect(),q(a));a.state=40}}function c(a,b){Q[0]=a.base_seed;for(var c=a.source_node.buffer.duration,e=a.start_time,g;e<b;)g=a.pitch+a.pitch_random*d.rand_r(Q),
e+=c/g;return(c/g-(e-b))*g}function k(a){var b=a.sfx;if(40==b.state){var c=L.currentTime;b.start_time+=c-b.pause_time;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=a.sfx;var d=L.createBufferSource();d.loop=a.source_node.loop;d.loopStart=a.source_node.loopStart;d.loopEnd=a.source_node.loopEnd;d.buffer=a.source_node.buffer;d.playbackRate.value=a.source_node.playbackRate.value;d.connect(a.proc_chain_in);a.source_node=d;a.source_node2&&(d=L.createBufferSource(),d.loop=a.source_node2.loop,d.buffer=
a.source_node2.buffer,d.playbackRate.value=a.source_node2.playbackRate.value,d.connect(a.proc_chain_in),a.source_node2=d);b.vp_rand_end_time=c;c=b.source_node;l(b);c.start(b.start_time,b.buf_offset);e(b)}n(b,b.start_time);b.state=20}}function m(a,b,c){var e=1,e=b.doppler_factor;if(0<e){var g=b.speed_of_sound;if(0!=t.dot(a.velocity,a.velocity)||0!=t.dot(b.listener_velocity,b.listener_velocity)){var f=t.subtract(a.last_position,b.listener_last_eye,x),k=t.length(f);b=t.dot(f,b.listener_velocity)/k;f=
t.dot(f,a.velocity)/k;f=-f;k=g/e;b=Math.min(-b,k);f=Math.min(f,k);e=(g-e*b)/(g-e*f);isFinite(e)||(e=0);e=Math.min(e,16);e=Math.max(e,.125);e=d.smooth(e,a.last_doppler_shift,c,.3);a.source_node.playbackRate.value=e;a.last_doppler_shift=e}}}function A(a){a=a.sfx;return!a||20!=a.state&&40!=a.state&&30!=a.state&&50!=a.state?!1:!0}function E(a){return a.muted?0:a.volume}function w(a){a=a.sfx;return(a=a.src)?a.duration:0}var v=r("__config"),z=r("__print"),y=r("__quat"),D=r("__time"),K=r("__tsr"),d=r("__util"),
t=r("__vec3"),C=v.defaults,M=v.sfx,x=new Float32Array(3),g=new Float32Array(3);new Float32Array(3);var H=y.create(),G=[],ba=[],L=null,F=null,U=[],Q=[1],T=null;a.AST_NONE=10;a.AST_ARRAY_BUFFER=20;a.AST_HTML_ELEMENT=30;a.create_sfx=function(){return{uuid:-1,filepath:"",behavior:"NONE",muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,cone_angle_inner:360,cone_angle_outer:360,cone_volume_outer:1,autoplay:!1,cyclic:!1,loop:!1,loop_start:0,loop_end:0,delay:0,delay_random:0,volume_random:0,
pitch_random:0,fade_in:0,fade_out:0,start_time:0,pause_time:0,buf_offset:0,duration:0,vp_rand_end_time:0,base_seed:1,src:null,state:10,last_position:new Float32Array(3),velocity:new Float32Array(3),enable_doppler:!1,last_doppler_shift:1,bgm_start_timeout:-1,bgm_stop_timeout:-1,duck_time:0,proc_chain_in:null,source_node:null,source_node2:null,panner_node:null,filter_node:null,gain_node:null,fade_gain_node:null,rand_gain_node:null,update_counter:0}};a.init=function(){var a=document.createElement("audio"),
b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(G.push("ogg"),G.push("ogv"),G.push("oga")),""!=a.canPlayType("audio/mpeg")&&G.push("mp3"),""!=a.canPlayType("audio/mp4")&&(G.push("mp4"),G.push("m4v"),G.push("m4a")),""!=a.canPlayType("audio/webm")&&G.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&(ba.push("ogv"),ba.push("ogg"),ba.push("oga")),""!=b.canPlayType("video/mp4")&&(ba.push("m4v"),ba.push("mp4")),""!=b.canPlayType("video/webm")&&ba.push("webm"),
""!=b.canPlayType("video/mpeg")&&ba.push("mp3"))};a.attach_scene_sfx=function(a){M.webaudio&&!L&&(L=u())&&z.log("%cINIT WEBAUDIO: "+L.sampleRate+"Hz","color: #00a");if(L){var b={listener_last_eye:new Float32Array(3),listener_velocity:new Float32Array(3),update_counter:0},c=L.createGain(),e=L.createGain();b.gain_node=c;b.fade_gain_node=e;c.connect(e);e.connect(L.destination);if(a.b4w_enable_dynamic_compressor){var e=L.createDynamicsCompressor(),g=a.b4w_dynamic_compressor_settings;e.threshold.value=
g.threshold;e.knee.value=g.knee;e.ratio.value=g.ratio;e.attack.value=g.attack;e.release.value=g.release;e.connect(c);b.compressor_node=e;b.proc_chain_in=e}else b.compressor_node=null,b.proc_chain_in=c;switch(a.audio_distance_model){case "INVERSE":case "INVERSE_CLAMPED":b.distance_model="inverse";break;case "LINEAR":case "LINEAR_CLAMPED":b.distance_model="linear";break;case "EXPONENT":case "EXPONENT_CLAMPED":b.distance_model="exponential";break;case "NONE":b.distance_model="none";break;default:d.panic("Wrong audio distance model")}b.doppler_factor=
a.audio_doppler_factor;b.speed_of_sound=a.audio_doppler_speed;b.muted=!1;b.volume=a.audio_volume;c.gain.value=E(b);b.duck_time=0}else b=null;a._sfx=b};a.set_active_scene=function(a){F=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<G.indexOf(a)?a:-1<G.indexOf("m4a")?"m4a":-1<G.indexOf("oga")?"oga":""};a.detect_video_container=function(a){a||(a="webm");return-1<ba.indexOf(a)?a:-1<ba.indexOf("m4v")?"m4v":-1<ba.indexOf("webm")?"webm":""};a.update_object=function(a,b){var c=a.data,e=b.sfx;
e.uuid=a.data.sound.uuid;e.filepath=a.data.sound.filepath;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":e.behavior=L?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var g;L?(window.MediaElementAudioSourceNode?g=!0:(z.warn("MediaElementAudioSourceNode not found"),g=!1),g=g&&!C.chrome_html_bkg_music_hack?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):g="NONE";e.behavior=g;break;default:d.panic("Wrong speaker behavior")}c.sound||(e.behavior="NONE");e.enable_doppler=c.b4w_enable_doppler;
e.muted=c.muted;e.volume=c.volume;e.pitch=c.pitch;e.attenuation=c.attenuation;e.dist_ref=c.distance_reference;e.dist_max=c.distance_max||1E4;e.cone_angle_inner=c.cone_angle_inner;e.cone_angle_outer=c.cone_angle_outer;e.cone_volume_outer=c.cone_volume_outer;e.autoplay=c.b4w_auto_play;e.cyclic=c.b4w_cyclic_play;e.loop=c.b4w_loop;e.loop_start=c.b4w_loop_start;e.loop_end=c.b4w_loop_end;e.delay=c.b4w_delay;e.delay_random=c.b4w_delay_random;e.volume_random=c.b4w_volume_random;e.pitch_random=c.b4w_pitch_random;
e.fade_in=c.b4w_fade_in;e.fade_out=c.b4w_fade_out;U.push(b)};a.source_type=function(b){"SPEAKER"!=b.type&&d.panic("Wrong object type");switch(b.sfx.behavior){case "POSITIONAL":return a.AST_ARRAY_BUFFER;case "BACKGROUND_SOUND":return a.AST_ARRAY_BUFFER;case "BACKGROUND_MUSIC":return a.AST_HTML_ELEMENT;case "NONE":return a.AST_NONE;default:d.panic("Wrong speaker behavior")}};a.update_spkobj=function(a,b){var c=a.sfx;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=
b;break;case "NONE":break;default:d.panic("Wrong speaker behavior")}};a.play_empty_sound=function(){var a=L.createBufferSource();a.buffer=L.createBuffer(1,22050,22050);a.connect(L.destination);a.start(0)};a.decode_audio_data=function(a,b,c){L?L.decodeAudioData(a,b,c):c()};a.speaker_remove=function(a){p(a);a.sfx=null;U.splice(U.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<U.length;a++){var b=U[a].sfx;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():(b.source_node&&b.source_node.disconnect(),
b.source_node2&&b.source_node2.disconnect())}F&&F._sfx&&(a=F._sfx,a.listener_last_eye[0]=0,a.listener_last_eye[1]=0,a.listener_last_eye[2]=0,a.listener_velocity[0]=0,a.listener_velocity[1]=0,a.listener_velocity[2]=0);F=null;U.splice(0);T=null};a.update=function(a,b){if(L&&0!=U.length){for(var c=0;c<U.length;c++){var g=U[c],k=g.sfx,h=k.source_node,l=L.currentTime;!k.loop&&20==k.state&&k.duration&&k.start_time+k.duration<l&&("BACKGROUND_MUSIC"==k.behavior||h&&!d.isdef(h.onended))&&(k.state=50);k.cyclic&&
50==k.state&&f(g);20==k.state&&3>k.vp_rand_end_time-l&&e(k)}T&&T.speakers.length&&(-1==T.active||a>T.active_start_time+T.durations[T.active])&&(c=T,-1<c.active&&p(c.speakers[c.active]),-1==c.active&&c.random?g=Math.round(Math.random()*(c.speakers.length-1)):c.random?(g=1+Math.round(Math.random()*(c.speakers.length-2)),g=(c.active+g)%c.speakers.length):g=(c.active+1)%c.speakers.length,f(c.speakers[g]),c.active=g,c.active_start_time=a)}};a.play=h;a.play_def=f;a.stop=p;a.is_playing=function(a){return 20==
a.sfx.state};a.speaker_pause=B;a.speaker_resume=k;a.loop_stop=function(a,b,c){c=a.sfx;var d=c.source_node2;A(a)&&("POSITIONAL"==c.behavior||"BACKGROUND_SOUND"==c.behavior)&&d&&(a=L.currentTime+b,c.source_node.stop(a),d.start(a,c.loop_end))};a.playrate=function(a,b){var c=a.sfx;c.pitch=b;!A(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.source_node.playbackRate.value=b,c.source_node2&&(c.source_node2.playbackRate.value=b),q(c),e(c))};a.get_playrate=function(a){return a.sfx.pitch};
a.cyclic=function(a,b){a.sfx.cyclic=Boolean(b)};a.is_autoplay=function(a){return a.sfx.autoplay};a.is_cyclic=function(a){return a.sfx.cyclic};a.listener_update_transform=function(a,b,c,d,e){if(a=a._sfx){var f=x;f[0]=0;f[1]=0;f[2]=-1;t.transformQuat(f,c,f);g[0]=0;g[1]=1;g[2]=0;t.transformQuat(g,c,g);c=L.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(f[0],f[1],f[2],g[0],g[1],g[2]);if(d&&a.update_counter!=e){if(a.listener_stride)a.listener_stride=!1,t.copy(b,a.listener_last_eye);else for(c=
a.listener_velocity,c[0]=(b[0]-a.listener_last_eye[0])/d,c[1]=(b[1]-a.listener_last_eye[1])/d,c[2]=(b[2]-a.listener_last_eye[2])/d,t.copy(b,a.listener_last_eye),b=0;b<U.length;b++)c=U[b],f=c.sfx,A(c)&&"POSITIONAL"==f.behavior&&f.enable_doppler&&m(f,a,d);a.update_counter=e}else t.copy(b,a.listener_last_eye)}};a.listener_stride=function(){var a=F._sfx;a&&(a.listener_stride=!0)};a.speaker_update_transform=function(a,b,c){var e=a.sfx;if(A(a)&&"POSITIONAL"==e.behavior){var f=K.get_trans(a.render.world_tsr,
x);a=K.get_quat(a.render.world_tsr,H);var k=e.panner_node;k.setPosition(f[0],f[1],f[2]);d.quat_to_dir(a,d.AXIS_MZ,g);k.setOrientation(g[0],g[1],g[2]);e.enable_doppler&&(a=e.last_position,b&&e.update_counter!=c?(e.stride?(t.copy(f,a),e.stride=!1):(k=e.velocity,k[0]=(f[0]-a[0])/b,k[1]=(f[1]-a[1])/b,k[2]=(f[2]-a[2])/b,t.copy(f,a),m(e,F._sfx,b)),e.update_counter=c):t.copy(f,a))}};a.speaker_stride=function(a){var b=a.sfx;A(a)&&"POSITIONAL"==b.behavior&&b.enable_doppler&&(b.stride=!0)};a.get_spk_behavior=
function(a){return a.sfx.behavior};a.check_active_speakers=function(){for(var a=0;a<U.length;a++)if(A(U[a]))return!0;return!1};a.set_master_volume=function(a){var b=F._sfx;b&&(b.volume=a,L&&(b.gain_node.gain.value=E(b)))};a.get_master_volume=function(){var a=F._sfx;return a?a.volume:0};a.set_volume=function(a,b){var c=a.sfx;c.volume=b;A(a)&&(c.gain_node.gain.value=E(c))};a.get_volume=function(a){return a.sfx.volume};a.mute=function(a,b){a.sfx.muted=Boolean(b);A(a)&&(a.sfx.gain_node.gain.value=E(a.sfx))};
a.is_muted=function(a){return a.sfx.muted};a.mute_master=function(a){var b=F._sfx;b&&(b.muted=Boolean(a),L&&(b.gain_node.gain.value=E(b)))};a.is_master_muted=function(){var a=F._sfx;return a?a.muted:!1};a.get_speaker_objects=function(){return U};a.pause=function(){for(var a=0;a<U.length;a++)B(U[a])};a.resume=function(){for(var a=0;a<U.length;a++)k(U[a])};a.set_compressor_params=function(a,b){if(a._sfx&&a._sfx.compressor_node){var c=a._sfx.compressor_node;c.threshold.value=b.threshold;c.knee.value=
b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a._sfx||!a._sfx.compressor_node)return null;a=a._sfx.compressor_node;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(A(a)){a=a.sfx;var d=a.fade_gain_node,e=L.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.duck_time=c}};a.unduck=function(a){if(A(a)){a=
a.sfx;var b=a.fade_gain_node,c=L.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.duck_master=function(a,b){if(L){var c=F._sfx,d=c.fade_gain_node,e=L.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.duck_time=b}};a.unduck_master=function(){if(L){var a=F._sfx,b=a.fade_gain_node,c=L.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};
a.apply_playlist=function(a,b,c){T={active:-1,active_start_time:0,random:c,speakers:[],durations:[]};for(c=0;c<a.length;c++){var d=a[c],e=w(d);0==e?z.warn("Ignoring speaker with zero duration: "+d.name):(p(d),d.sfx.cyclic=!1,T.speakers.push(d),T.durations.push(e+b))}};a.get_duration=w;a.clear_playlist=function(){if(T)for(var a=T.speakers,b=0;b<a.length;b++)p(a[b]);T=null};a.get_positional_params=function(a){return(a=a.sfx)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:
null};a.set_positional_params=function(a,b){var c=a.sfx;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.panner_node;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.sfx;c&&c.filter_node&&(c.filter_node.frequency.value=b.freq,c.filter_node.Q.value=b.Q,c.filter_node.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.sfx)&&a.filter_node?{freq:a.filter_node.frequency.value,
Q:a.filter_node.Q.value,gain:a.filter_node.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.sfx;if(!a||!a.filter_node)return null;a.filter_node.getFrequencyResponse(b,c,d)};a.reset=function(){G.length=0;ba.length=0;L=null}};b4w.module.__input=function(a,r){function u(a){var b=L.detect_mobile();return(20!=a||navigator.getVRDevices||navigator.getVRDisplays||b)&&(10!=a||b&&window.DeviceOrientationEvent)?!0:!1}function h(a,b){if(!u(a))return null;var c={type:a,registered:!1,orientation_quat_cb_list:[],orientation_angles_cb_list:[],mouse_down_which_cb_list:[],mouse_location_cb_list:[],mouse_up_which_cb_list:[],mouse_wheel_cb_list:[],keyboard_down_cb_list:[],keyboard_down_mod_cb_list:[],keyboard_up_cb_list:[],touch_start_cb_list:[],
touch_move_cb_list:[],touch_end_cb_list:[],element:b,prevent_default:!0,registered_event_listeners:[],mouse_location:new Float32Array(2),mouse_which:0,distortion_coefs:new Float32Array(2),chromatic_aberration_coefs:new Float32Array(4),webvr_hmd_device:null,webvr_sensor_devices:null,webvr_display:null,orientation:T.create(),position:ha.create(),fov_left:new Float32Array(4),fov_right:new Float32Array(4),inter_lens_dist:0,base_line_dist:0,screen_to_lens_dist:0,width_dist:0,height_dist:0,bevel_size:0,
gamepad_btns:[],gamepad_axes:[0,0,0,0,0,0,0,0,0,0,0,0],gamepad_prev_axes:[0,0,0,0,0,0,0,0,0,0,0,0],gamepad_mapping:[]};c.fov_left[0]=c.fov_left[1]=c.fov_left[2]=c.fov_left[3]=45;c.fov_right[0]=c.fov_right[1]=c.fov_right[2]=c.fov_right[3]=45;30==a||40==a||50==a?(c.registered=Boolean(b),50==a?document.addEventListener("touchstart",function(){}):40==a&&(c.prevent_default=!1)):10==a?c.registered=!0:20!=a||navigator.getVRDisplays||(navigator.getVRDevices&&!Z.is_mobile_device?l(c,N.webvr):(f(c),c.registered=
!0));return c}function b(b,c){10==b||20==b?c=window:c||(c=40==b?document:F.get_container());for(var d=0;d<sa.length;d++)if(sa[d].type==b&&sa[d].element==c)return sa[d];d=h(b,c);60!=b&&70!=b&&80!=b&&90!=b||d.gamepad_mapping.push(a.GMPD_BUTTON_0,a.GMPD_BUTTON_1,a.GMPD_BUTTON_2,a.GMPD_BUTTON_3,a.GMPD_BUTTON_4,a.GMPD_BUTTON_5,a.GMPD_BUTTON_6,a.GMPD_BUTTON_7,a.GMPD_BUTTON_8,a.GMPD_BUTTON_9,a.GMPD_BUTTON_10,a.GMPD_BUTTON_11,a.GMPD_BUTTON_12,a.GMPD_BUTTON_13,a.GMPD_BUTTON_14,a.GMPD_BUTTON_15,a.GMPD_BUTTON_16,
a.GMPD_BUTTON_17,a.GMPD_BUTTON_18,a.GMPD_BUTTON_19,a.GMPD_BUTTON_20,a.GMPD_BUTTON_21,a.GMPD_BUTTON_22,a.GMPD_BUTTON_23,a.GMPD_BUTTON_24,a.GMPD_BUTTON_25,a.GMPD_AXIS_0,a.GMPD_AXIS_1,a.GMPD_AXIS_2,a.GMPD_AXIS_3,a.GMPD_AXIS_4,a.GMPD_AXIS_5,a.GMPD_AXIS_6,a.GMPD_AXIS_7,a.GMPD_AXIS_8,a.GMPD_AXIS_9,a.GMPD_AXIS_10,a.GMPD_AXIS_11);d&&sa.push(d);return d}function f(a){var b=N.nonwebvr;a.width_dist=b.width_dist;a.height_dist=b.height_dist;a.bevel_size=b.bevel_size;l(a,b);a.inter_lens_dist=b.inter_lens_dist;
a.base_line_dist=b.base_line_dist;a.screen_to_lens_dist=b.screen_to_lens_dist;e(a)}function l(a,b){a.distortion_coefs[0]=b.distortion_coefs[0];a.distortion_coefs[1]=b.distortion_coefs[1];a.chromatic_aberration_coefs[0]=b.chromatic_aberration_coefs[0];a.chromatic_aberration_coefs[1]=b.chromatic_aberration_coefs[1];a.chromatic_aberration_coefs[2]=b.chromatic_aberration_coefs[2];a.chromatic_aberration_coefs[3]=b.chromatic_aberration_coefs[3]}function q(a,b){var c=b*b;return b*(1+a[0]*c+a[1]*c*c)}function e(a){var b=
a.base_line_dist-a.bevel_size,c=a.height_dist-b,d=a.inter_lens_dist/2,e=(a.width_dist-a.inter_lens_dist)/2,g=a.distortion_coefs,b=q(g,b/a.screen_to_lens_dist),b=W.rad_to_deg(Math.atan(b)),c=q(g,c/a.screen_to_lens_dist),c=W.rad_to_deg(Math.atan(c)),d=q(g,d/a.screen_to_lens_dist),d=W.rad_to_deg(Math.atan(d)),e=q(g,e/a.screen_to_lens_dist),e=W.rad_to_deg(Math.atan(e));c&&(a.fov_left[0]=a.fov_right[0]=Math.min(c,60));d&&(a.fov_left[1]=a.fov_right[3]=Math.min(d,60));b&&(a.fov_left[2]=a.fov_right[2]=Math.min(b,
60));e&&(a.fov_left[3]=a.fov_right[1]=Math.min(e,60))}function n(a,b){var c=b.filter(function(a){return a instanceof HMDVRDevice}),d=null;c.length&&(d=c[0]);c=null;d&&(c=b.filter(function(a){return-1!==a.deviceName.toLowerCase().indexOf("oculus")&&a.hardwareUnitId==d.hardwareUnitId&&a instanceof PositionSensorVRDevice}));a.webvr_hmd_device=d;a.webvr_sensor_devices=c}function p(a,b,c){switch(a.type){case 20:var d=a.webvr_display||a.webvr_hmd_device;d?(b=d.getEyeParameters(b),b=b.fieldOfView||b.currentFieldOfView,
a=a.distortion_coefs,d=q(a,Math.tan(W.deg_to_rad(b.downDegrees))),W.rad_to_deg(Math.atan(d)),d=q(a,Math.tan(W.deg_to_rad(b.upDegrees))),W.rad_to_deg(Math.atan(d)),d=q(a,Math.tan(W.deg_to_rad(b.leftDegrees))),W.rad_to_deg(Math.atan(d)),a=q(a,Math.tan(W.deg_to_rad(b.rightDegrees))),W.rad_to_deg(Math.atan(a)),c[0]=b.upDegrees,c[1]=b.rightDegrees,c[2]=b.downDegrees,c[3]=b.leftDegrees):(b="left"==b?a.fov_left:a.fov_right,Y.copy(b,c));break;default:Q.error("fov is undefined for device: ",a.type)}return c}
function B(a,b){switch(b){case 0:return navigator.getVRDisplays?3:navigator.getVRDevices?Z.is_mobile_device?1:0:2;case 23:var c=a.webvr_display||a.webvr_hmd_device;if(c){var d=c.getEyeParameters("left"),c=c.getEyeParameters("right");return a.webvr_display?c.offset[0]-d.offset[0]:c.eyeTranslation.x-d.eyeTranslation.x}return a.inter_lens_dist}}function c(a,b){if(a.webvr_display){var c=a.webvr_display,d=c.capabilities,c=c.getPose();d.hasOrientation&&c.orientation&&(a.orientation[0]=c.orientation[0],
a.orientation[1]=c.orientation[1],a.orientation[2]=c.orientation[2],a.orientation[3]=c.orientation[3]);d.hasPosition&&c.position&&(a.position[0]=c.position[0],a.position[1]=-c.position[2],a.position[2]=c.position[1])}else 1<b-da&&(da=b,navigator.getVRDisplays?a.webvr_display||navigator.getVRDisplays().then(function(b){0<b.length&&(a.webvr_display=b[0],a.registered=!0)},function(b){Q.error_once("WebVR displays are not found.");a.registered=!1}):navigator.getVRDevices?a.webvr_hmd_device||fa||navigator.getVRDevices().then(function(b){n(a,
b);b.length&&(a.registered=!0);fa=!0},function(b){Q.error_once("WebVR devices are not found.");a.registered=!1;fa=!0}):Z.is_mobile_device||Q.error_once("HMD isn't supported."))}function k(a,b){if(a){for(var c=0;c<a.buttons.length;c++)b.gamepad_btns[c]=a.buttons[c].pressed;if(a.axes&&12>=a.axes.length)for(c=0;c<a.axes.length;c++)b.gamepad_axes[c]=a.axes[c]}}function m(a){for(var b=0;b<a.gamepad_btns;b++)a.gamepad_btns[b]=!1;for(b=0;b<a.gamepad_axes.length;b++)a.gamepad_prev_axes[b]=a.gamepad_axes[b],
a.gamepad_axes[b]=0}function A(a,b){var c=a.indexOf(b);0<=c&&(a[c]=null)}function E(a){return null===a}function w(a,b,c,e){switch(b){case 120:c&&A(a.orientation_quat_cb_list,c);if(e||a.orientation_angles_cb_list.every(E)&&a.orientation_quat_cb_list.every(E))a.orientation_quat_cb_list.length=0,a.orientation_angles_cb_list.length=0,b=a.registered_event_listeners.indexOf(131),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("deviceorientation",z,!1));break;case 130:c&&A(a.orientation_angles_cb_list,
c);if(e||a.orientation_angles_cb_list.every(E)&&a.orientation_quat_cb_list.every(E))a.orientation_quat_cb_list.length=0,a.orientation_angles_cb_list.length=0,b=a.registered_event_listeners.indexOf(131),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("deviceorientation",z,!1));break;case 40:c&&A(a.mouse_down_which_cb_list,c);if(e||a.mouse_down_which_cb_list.every(E))a.mouse_down_which_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,
1),a.element.removeEventListener("mousedown",K,!1));break;case 30:c&&A(a.mouse_location_cb_list,c);if(e||a.mouse_location_cb_list.every(E))a.mouse_location_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("mousemove",D,!1));break;case 50:c&&A(a.mouse_up_which_cb_list,c);if(e||a.mouse_up_which_cb_list.every(E)){a.mouse_up_which_cb_list.length=0;b=a.registered_event_listeners.indexOf(b);0<=b&&(a.registered_event_listeners.splice(b,
1),a.element.removeEventListener("mouseout",d,!1),a.element.removeEventListener("mouseup",t,!1));break}break;case 60:c&&A(a.mouse_wheel_cb_list,c);if(e||a.mouse_wheel_cb_list.every(E))a.mouse_wheel_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("wheel",C,!1));break;case 80:c&&A(a.keyboard_down_cb_list,c);if(e||a.keyboard_down_cb_list.every(E))a.keyboard_down_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),
0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("keydown",M,!1));break;case 70:c&&A(a.keyboard_up_cb_list,c);if(e||a.keyboard_up_cb_list.every(E))a.keyboard_up_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("keyup",x,!1));break;case 90:c&&A(a.touch_start_cb_list,c);if(e||a.touch_start_cb_list.every(E))a.touch_start_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&
(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("touchstart",g,!1));break;case 100:c&&A(a.touch_move_cb_list,c);if(e||a.touch_move_cb_list.every(E))a.touch_move_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,1),a.element.removeEventListener("touchmove",H,!1));break;case 110:if(c&&A(a.touch_end_cb_list,c),e||a.touch_end_cb_list.every(E))a.touch_end_cb_list.length=0,b=a.registered_event_listeners.indexOf(b),0<=b&&(a.registered_event_listeners.splice(b,
1),a.element.removeEventListener("touchend",G,!1))}}function v(a,b){W.ordered_angles_to_quat(a,W.ZXY,b);var c="orientation"in window?W.deg_to_rad(window.orientation):"orientation"in window.screen?W.deg_to_rad(window.screen.orientation.angle):0,c=T.setAxisAngle(W.AXIS_MZ,c,I);T.multiply(b,c,b);return b}function z(a){var c=ma;null===a.alpha||null===a.beta||null===a.gamma?c[0]=c[1]=c[2]=0:(c[0]=W.deg_to_rad(a.alpha),c[1]=W.deg_to_rad(a.beta),c[2]=W.deg_to_rad(a.gamma));a=b(10,a.currentTarget);for(var d=
0;d<a.orientation_angles_cb_list.length;d++){var e=a.orientation_angles_cb_list[d];e&&(ha.copy(c,ra),e(ra))}if(a.orientation_quat_cb_list.length)for(c=v(c,ca),d=0;d<a.orientation_quat_cb_list.length;d++)if(e=a.orientation_quat_cb_list[d])T.copy(c,S),e(S);for(d=0;d<a.orientation_quat_cb_list.length;d++)a.orientation_quat_cb_list[d]||a.orientation_quat_cb_list.splice(d,1);for(d=0;d<a.orientation_angles_cb_list.length;d++)a.orientation_angles_cb_list[d]||a.orientation_angles_cb_list.splice(d,1)}function y(a,
b){switch(a.type){case 30:a.mouse_location[0]=b.clientX,a.mouse_location[1]=b.clientY,a.mouse_which=b.which}}function D(a){if(!R||!(a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents||5==a.mozInputSource)){var c=b(30,a.currentTarget);y(c,a);for(var d=0;d<c.mouse_location_cb_list.length;d++){var e=c.mouse_location_cb_list[d];e&&(Aa[0]=a.clientX,Aa[1]=a.clientY,e(Aa))}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_location_cb_list.length;d++)c.mouse_location_cb_list[d]||c.mouse_location_cb_list.splice(d,
1)}}function K(a){if(!R||!(a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents||5==a.mozInputSource)){var c=b(30,a.currentTarget);y(c,a);for(var d=0;d<c.mouse_down_which_cb_list.length;d++){var e=c.mouse_down_which_cb_list[d];e&&e(a.which)}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_down_which_cb_list.length;d++)c.mouse_down_which_cb_list[d]||c.mouse_down_which_cb_list.splice(d,1)}}function d(a){F.is_child(a.relatedTarget)||t(a)}function t(a){if(!R||!(a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents||
5==a.mozInputSource)){var c=b(30,a.currentTarget);y(c,a);for(var d=0;d<c.mouse_up_which_cb_list.length;d++){var e=c.mouse_up_which_cb_list[d];e&&e(a.which)}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_up_which_cb_list.length;d++)c.mouse_up_which_cb_list[d]||c.mouse_up_which_cb_list.splice(d,1)}}function C(a){for(var c=b(30,a.currentTarget),d=0;d<c.mouse_wheel_cb_list.length;d++){var e=c.mouse_wheel_cb_list[d];e&&e(-a.deltaY)}c.prevent_default&&a.preventDefault();for(d=0;d<c.mouse_wheel_cb_list.length;d++)c.mouse_wheel_cb_list[d]||
c.mouse_wheel_cb_list.splice(d,1)}function M(a){for(var c=b(40,a.currentTarget),d=a.ctrlKey||a.altKey||a.metaKey?c.keyboard_down_mod_cb_list:c.keyboard_down_cb_list,e=0;e<d.length;e++){var g=d[e];g?g(a.keyCode):d.splice(e--,1)}c.prevent_default&&a.preventDefault()}function x(a){for(var c=b(40,a.currentTarget),d=0;d<c.keyboard_up_cb_list.length;d++){var e=c.keyboard_up_cb_list[d];e&&e(a.keyCode)}c.prevent_default&&a.preventDefault();for(d=0;d<c.keyboard_up_cb_list.length;d++)c.keyboard_up_cb_list[d]||
c.keyboard_up_cb_list.splice(d,1)}function g(a){for(var c=b(50,a.currentTarget),d=0;d<c.touch_start_cb_list.length;d++){var e=c.touch_start_cb_list[d];e&&e(a.targetTouches)}for(d=0;d<c.touch_start_cb_list.length;d++)c.touch_start_cb_list[d]||c.touch_start_cb_list.splice(d,1)}function H(a){for(var c=b(50,a.currentTarget),d=0;d<c.touch_move_cb_list.length;d++){var e=c.touch_move_cb_list[d];e&&e(a.targetTouches)}c.prevent_default&&a.preventDefault();for(d=0;d<c.touch_move_cb_list.length;d++)c.touch_move_cb_list[d]||
c.touch_move_cb_list.splice(d,1)}function G(a){for(var c=b(50,a.currentTarget),d=0;d<c.touch_end_cb_list.length;d++){var e=c.touch_end_cb_list[d];e&&e(a.targetTouches)}for(d=0;d<c.touch_end_cb_list.length;d++)c.touch_end_cb_list[d]||c.touch_end_cb_list.splice(d,1)}function ba(a){switch(a){case 0:a=60;break;case 1:a=70;break;case 2:a=80;break;case 3:a=90;break;default:a=60}return a}var L=r("__compat"),F=r("__container"),U=r("__config"),Q=r("__print"),T=r("__quat"),W=r("__util"),ha=r("__vec3"),Y=r("__vec4"),
Z=U.defaults,N=U.hmd_params;a.DEVICE_GYRO=10;a.DEVICE_HMD=20;a.DEVICE_MOUSE=30;a.DEVICE_KEYBOARD=40;a.DEVICE_TOUCH=50;a.DEVICE_GAMEPAD0=60;a.DEVICE_GAMEPAD1=70;a.DEVICE_GAMEPAD2=80;a.DEVICE_GAMEPAD3=90;a.HMD_WEBVR_DESKTOP=0;a.HMD_WEBVR_MOBILE=1;a.HMD_NON_WEBVR=2;a.HMD_WEBVR1=3;a.HMD_WEBVR_TYPE=0;a.HMD_ORIENTATION_QUAT=10;a.HMD_POSITION=20;a.HMD_FOV_LEFT=21;a.HMD_FOV_RIGHT=22;a.HMD_EYE_DISTANCE=23;a.HMD_DISTORTION=24;a.HMD_BASELINE_DIST=25;a.HMD_SCREEN_LENSE_DIST=26;a.HMD_SCREEN_WIDTH=27;a.HMD_SCREEN_HEIGHT=
28;a.HMD_BEVEL_SIZE=29;a.MOUSE_LOCATION=30;a.MOUSE_DOWN_WHICH=40;a.MOUSE_UP_WHICH=50;a.MOUSE_WHEEL=60;a.KEYBOARD_UP=70;a.KEYBOARD_DOWN=80;a.KEYBOARD_DOWN_MODIFIED=81;a.TOUCH_START=90;a.TOUCH_MOVE=100;a.TOUCH_END=110;a.GYRO_ORIENTATION_QUAT=120;a.GYRO_ORIENTATION_ANGLES=130;a.GMPD_BUTTON_0=0;a.GMPD_BUTTON_1=1;a.GMPD_BUTTON_2=2;a.GMPD_BUTTON_3=3;a.GMPD_BUTTON_4=4;a.GMPD_BUTTON_5=5;a.GMPD_BUTTON_6=6;a.GMPD_BUTTON_7=7;a.GMPD_BUTTON_8=8;a.GMPD_BUTTON_9=9;a.GMPD_BUTTON_10=10;a.GMPD_BUTTON_11=11;a.GMPD_BUTTON_12=
12;a.GMPD_BUTTON_13=13;a.GMPD_BUTTON_14=14;a.GMPD_BUTTON_15=15;a.GMPD_BUTTON_16=16;a.GMPD_BUTTON_17=17;a.GMPD_BUTTON_18=18;a.GMPD_BUTTON_19=19;a.GMPD_BUTTON_20=20;a.GMPD_BUTTON_21=21;a.GMPD_BUTTON_22=22;a.GMPD_BUTTON_23=23;a.GMPD_BUTTON_24=24;a.GMPD_BUTTON_25=25;a.GMPD_AXIS_0=26;a.GMPD_AXIS_1=27;a.GMPD_AXIS_2=28;a.GMPD_AXIS_3=29;a.GMPD_AXIS_4=30;a.GMPD_AXIS_5=31;a.GMPD_AXIS_6=32;a.GMPD_AXIS_7=33;a.GMPD_AXIS_8=34;a.GMPD_AXIS_9=35;a.GMPD_AXIS_10=36;a.GMPD_AXIS_11=37;var ca=T.create(),I=T.create(),ma=
ha.create(),da=-Infinity,fa=!1,Aa=new Float32Array(2);ha.create();var ra=ha.create(),S=T.create(),R="ontouchstart"in document.documentElement,sa=[];a.can_use_device=u;a.get_device_by_type_element=b;a.switch_prevent_default=function(a,b){a.prevent_default=b};a.reset_device=function(a){switch(a.type){case 20:if(a.registered)if(a.webvr_display)a.webvr_display.resetPose();else if(a.webvr_sensor_devices)for(var b=0;b<a.webvr_sensor_devices.length;b++)a.webvr_sensor_devices[b].resetSensor();break;default:Q.error("reset_device() is undefined for device: ",
a.type)}};a.get_vector_param=function(a,b,c){switch(b){case 10:a:switch(a.type){case 20:ha.copy(W.QUAT4_IDENT,c);if(a.webvr_display)c[0]=a.orientation[0],c[1]=a.orientation[1],c[2]=a.orientation[2],c[3]=a.orientation[3];else if(a.webvr_sensor_devices)for(b=0;b<a.webvr_sensor_devices.length;b++){var d=a.webvr_sensor_devices[b],d=d.getState&&d.getState()||d.getImmediateState&&d.getImmediateState();d.orientation&&(c[0]=d.orientation.x,c[1]=d.orientation.y,c[2]=d.orientation.z,c[3]=d.orientation.w)}T.normalize(c,
c);a=T.setAxisAngle(W.AXIS_X,Math.PI/2,I);T.multiply(a,c,c);break a;default:Q.error("orientation_quat is undefined for device: ",a.type)}return c;case 20:a:switch(a.type){case 20:ha.copy(W.VEC3_UNIT,c);if(a.webvr_display)c[0]=a.position[0],c[1]=a.position[1],c[2]=a.position[2];else if(a.webvr_sensor_devices)for(b=0;b<a.webvr_sensor_devices.length;b++)d=a.webvr_sensor_devices[b],d=d.getState&&d.getState()||d.getImmediateState&&d.getImmediateState(),d.position&&(c[0]=d.position.x,c[1]=-d.position.z,
c[2]=d.position.y);break a;default:Q.error("position is undefined for device: ",a.type)}return c;case 21:return p(a,"left",c);case 22:return p(a,"right",c);case 30:return c[0]=a.mouse_location[0],c[1]=a.mouse_location[1],c}};a.get_value_param=B;a.set_config=function(a,b,c){switch(a.type){case 20:if(3===B(a,0))break;switch(b){case 24:a.distortion_coefs[0]=c[0];a.distortion_coefs[1]=c[1];break;case 23:a.inter_lens_dist=c;e(a);break;case 25:a.base_line_dist=c;e(a);break;case 26:a.screen_to_lens_dist=
c;e(a);break;case 27:a.width_dist=c;e(a);break;case 28:a.height_dist=c;e(a);break;case 29:a.bevel_size=c,e(a)}break;case 60:case 70:case 80:case 90:a.gamepad_mapping[b]=c}};a.get_gamepad_btn_value=function(a,b){return b<a.gamepad_btns.length?a.gamepad_btns[a.gamepad_mapping[b]]:!1};a.get_gamepad_axis_value=function(a,b){return b-26<a.gamepad_axes.length?a.gamepad_axes[a.gamepad_mapping[b]-26]:0};a.update=function(a){for(var b=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?
navigator.webkitGetGamepads:[],d=0;d<sa.length;d++){var e=sa[d];switch(e.type){case 60:m(e);k(b[0],e);break;case 70:m(e);k(b[1],e);break;case 80:m(e);k(b[2],e);break;case 90:m(e);k(b[3],e);break;case 20:c(e,a)}}};a.attach_param_cb=function(a,b,c){switch(b){case 120:a.orientation_quat_cb_list.push(c);b=131;break;case 130:a.orientation_angles_cb_list.push(c);b=131;break;case 40:a.mouse_down_which_cb_list.push(c);break;case 30:a.mouse_location_cb_list.push(c);break;case 50:a.mouse_up_which_cb_list.push(c);
break;case 60:a.mouse_wheel_cb_list.push(c);break;case 80:a.keyboard_down_cb_list.push(c);break;case 81:a.keyboard_down_mod_cb_list.push(c);b=80;break;case 70:a.keyboard_up_cb_list.push(c);break;case 90:a.touch_start_cb_list.push(c);break;case 100:a.touch_move_cb_list.push(c);break;case 110:a.touch_end_cb_list.push(c)}if(-1==a.registered_event_listeners.indexOf(b)&&(a.registered_event_listeners.push(b),a.registered))switch(b){case 40:/iPad|iPhone|iPod/.test(navigator.platform)||a.element.addEventListener("mousedown",
K,!1);break;case 30:a.element.addEventListener("mousemove",D,!1);break;case 50:/iPad|iPhone|iPod/.test(navigator.platform)||(a.element!=window&&a.element.addEventListener("mouseout",t,!1),a.element.addEventListener("mouseup",t,!1));break;case 60:a.element.addEventListener("wheel",C,!1);break;case 80:a.element.addEventListener("keydown",M,!1);break;case 70:a.element.addEventListener("keyup",x,!1);break;case 90:a.element.addEventListener("touchstart",g,!1);break;case 100:a.element.addEventListener("touchmove",
H,!1);break;case 110:a.element.addEventListener("touchend",G,!1);break;case 131:a.element.addEventListener("deviceorientation",z,!1)}};a.detach_param_cb=function(a,b,c){w(a,b,c,!1,!1)};a.gyro_angles_to_quat=v;a.cleanup=function(){for(var a=0;a<sa.length;a++)for(var b=sa[a],c=0;c<b.registered_event_listeners.length;c++)w(b,b.registered_event_listeners[c],null,!0);sa.length=0};a.get_pressed_gmpd_btn=function(a){a=ba(a);a=b(a);for(var c=0;c<a.gamepad_btns.length;c++)if(a.gamepad_btns[c])return c;return-1};
a.get_moved_gmpd_axis=function(a){a=ba(a);a=b(a);for(var c=0;c<a.gamepad_axes.length;c++)if(a.gamepad_prev_axes[c]-a.gamepad_axes[c])return c+26;return-1};a.get_first_gmpd_id=function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=0;b<a.length;b++)if(a[b])return b;return 0};a.get_webvr_display=function(){var a=b(20);return a&&a.webvr_display}};b4w.module.__vec3=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array,h=Math.random;a.create=function(){var a=new u(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var f=new u(3);f[0]=a[0];f[1]=a[1];f[2]=a[2];return f};a.fromValues=function(a,f,h){var q=new u(3);q[0]=a;q[1]=f;q[2]=h;return q};a.copy=function(a,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];return f};a.set=function(a,f,h,q){q[0]=a;q[1]=f;q[2]=h;return q};a.add=function(a,f,h){h[0]=a[0]+f[0];h[1]=a[1]+f[1];h[2]=a[2]+f[2];
return h};a.subtract=function(a,f,h){h[0]=a[0]-f[0];h[1]=a[1]-f[1];h[2]=a[2]-f[2];return h};a.sub=a.subtract;a.multiply=function(a,f,h){h[0]=a[0]*f[0];h[1]=a[1]*f[1];h[2]=a[2]*f[2];return h};a.mul=a.multiply;a.divide=function(a,f,h){h[0]=a[0]/f[0];h[1]=a[1]/f[1];h[2]=a[2]/f[2];return h};a.div=a.divide;a.min=function(a,f,h){h[0]=Math.min(a[0],f[0]);h[1]=Math.min(a[1],f[1]);h[2]=Math.min(a[2],f[2]);return h};a.max=function(a,f,h){h[0]=Math.max(a[0],f[0]);h[1]=Math.max(a[1],f[1]);h[2]=Math.max(a[2],
f[2]);return h};a.scale=function(a,f,h){h[0]=a[0]*f;h[1]=a[1]*f;h[2]=a[2]*f;return h};a.scaleAndAdd=function(a,f,h,q){q[0]=a[0]+f[0]*h;q[1]=a[1]+f[1]*h;q[2]=a[2]+f[2]*h;return q};a.distance=function(a,f){var h=f[0]-a[0],q=f[1]-a[1],e=f[2]-a[2];return Math.sqrt(h*h+q*q+e*e)};a.dist=a.distance;a.squaredDistance=function(a,f){var h=f[0]-a[0],q=f[1]-a[1],e=f[2]-a[2];return h*h+q*q+e*e};a.sqrDist=a.squaredDistance;a.length=function(a){var f=a[0],h=a[1];a=a[2];return Math.sqrt(f*f+h*h+a*a)};a.len=a.length;
a.squaredLength=function(a){var f=a[0],h=a[1];a=a[2];return f*f+h*h+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,f){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];return f};a.inverse=function(a,f){f[0]=1/a[0];f[1]=1/a[1];f[2]=1/a[2];return f};a.normalize=function(a,f){var h=a[0],q=a[1],e=a[2],h=h*h+q*q+e*e;0<h&&(h=1/Math.sqrt(h),f[0]=a[0]*h,f[1]=a[1]*h,f[2]=a[2]*h);return f};a.dot=function(a,f){return a[0]*f[0]+a[1]*f[1]+a[2]*f[2]};a.cross=function(a,f,h){var q=a[0],e=a[1];a=a[2];var n=f[0],p=f[1];f=f[2];
h[0]=e*f-a*p;h[1]=a*n-q*f;h[2]=q*p-e*n;return h};a.lerp=function(a,f,h,q){var e=a[0],n=a[1];a=a[2];q[0]=e+h*(f[0]-e);q[1]=n+h*(f[1]-n);q[2]=a+h*(f[2]-a);return q};a.hermite=function(a,f,h,q,e,n){var p=e*e,r=p*(2*e-3)+1,c=p*(e-2)+e,k=p*(e-1);e=p*(3-2*e);n[0]=a[0]*r+f[0]*c+h[0]*k+q[0]*e;n[1]=a[1]*r+f[1]*c+h[1]*k+q[1]*e;n[2]=a[2]*r+f[2]*c+h[2]*k+q[2]*e;return n};a.bezier=function(a,f,h,q,e,n){var p=1-e,r=p*p,c=e*e,k=r*p,r=3*e*r,p=3*c*p;e*=c;n[0]=a[0]*k+f[0]*r+h[0]*p+q[0]*e;n[1]=a[1]*k+f[1]*r+h[1]*p+
q[1]*e;n[2]=a[2]*k+f[2]*r+h[2]*p+q[2]*e;return n};a.random=function(a,f){a=a||1;var l=2*h()*Math.PI,q=2*h()-1,e=Math.sqrt(1-q*q)*a;f[0]=Math.cos(l)*e;f[1]=Math.sin(l)*e;f[2]=q*a;return f};a.transformMat4=function(a,f,h){var q=a[0],e=a[1];a=a[2];var n=f[3]*q+f[7]*e+f[11]*a+f[15],n=n||1;h[0]=(f[0]*q+f[4]*e+f[8]*a+f[12])/n;h[1]=(f[1]*q+f[5]*e+f[9]*a+f[13])/n;h[2]=(f[2]*q+f[6]*e+f[10]*a+f[14])/n;return h};a.transformMat3=function(a,f,h){var q=a[0],e=a[1];a=a[2];h[0]=q*f[0]+e*f[3]+a*f[6];h[1]=q*f[1]+e*
f[4]+a*f[7];h[2]=q*f[2]+e*f[5]+a*f[8];return h};a.transformQuat=function(a,f,h){var q=a[0],e=a[1],n=a[2];a=f[0];var p=f[1],r=f[2];f=f[3];var c=f*q+p*n-r*e,k=f*e+r*q-a*n,m=f*n+a*e-p*q,q=-a*q-p*e-r*n;h[0]=c*f+q*-a+k*-r-m*-p;h[1]=k*f+q*-p+m*-a-c*-r;h[2]=m*f+q*-r+c*-p-k*-a;return h};a.rotateX=function(a,f,h,q){var e=[],n=[];e[0]=a[0]-f[0];e[1]=a[1]-f[1];e[2]=a[2]-f[2];n[0]=e[0];n[1]=e[1]*Math.cos(h)-e[2]*Math.sin(h);n[2]=e[1]*Math.sin(h)+e[2]*Math.cos(h);q[0]=n[0]+f[0];q[1]=n[1]+f[1];q[2]=n[2]+f[2];return q};
a.rotateY=function(a,f,h,q){var e=[],n=[];e[0]=a[0]-f[0];e[1]=a[1]-f[1];e[2]=a[2]-f[2];n[0]=e[2]*Math.sin(h)+e[0]*Math.cos(h);n[1]=e[1];n[2]=e[2]*Math.cos(h)-e[0]*Math.sin(h);q[0]=n[0]+f[0];q[1]=n[1]+f[1];q[2]=n[2]+f[2];return q};a.rotateZ=function(a,f,h,q){var e=[],n=[];e[0]=a[0]-f[0];e[1]=a[1]-f[1];e[2]=a[2]-f[2];n[0]=e[0]*Math.cos(h)-e[1]*Math.sin(h);n[1]=e[0]*Math.sin(h)+e[1]*Math.cos(h);n[2]=e[2];q[0]=n[0]+f[0];q[1]=n[1]+f[1];q[2]=n[2]+f[2];return q};a.forEach=function(){var b=a.create();return function(a,
h,q,e,n,p){h||(h=3);q||(q=0);for(e=e?Math.min(e*h+q,a.length):a.length;q<e;q+=h)b[0]=a[q],b[1]=a[q+1],b[2]=a[q+2],n(b,p,b),a[q]=b[0],a[q+1]=b[1],a[q+2]=b[2];return a}}();a.angle=function(b,f){var h=a.fromValues(b[0],b[1],b[2]),q=a.fromValues(f[0],f[1],f[2]);a.normalize(h,h);a.normalize(q,q);h=a.dot(h,q);return 1<h?0:Math.acos(h)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"}};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array,h=Math.random;a.create=function(){var a=new u(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var f=new u(4);f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f};a.fromValues=function(a,f,h,q){var e=new u(4);e[0]=a;e[1]=f;e[2]=h;e[3]=q;return e};a.copy=function(a,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f};a.set=function(a,f,h,q,e){e[0]=a;e[1]=f;e[2]=h;e[3]=q;return e};a.add=function(a,f,
h){h[0]=a[0]+f[0];h[1]=a[1]+f[1];h[2]=a[2]+f[2];h[3]=a[3]+f[3];return h};a.subtract=function(a,f,h){h[0]=a[0]-f[0];h[1]=a[1]-f[1];h[2]=a[2]-f[2];h[3]=a[3]-f[3];return h};a.sub=a.subtract;a.multiply=function(a,f,h){h[0]=a[0]*f[0];h[1]=a[1]*f[1];h[2]=a[2]*f[2];h[3]=a[3]*f[3];return h};a.mul=a.multiply;a.divide=function(a,f,h){h[0]=a[0]/f[0];h[1]=a[1]/f[1];h[2]=a[2]/f[2];h[3]=a[3]/f[3];return h};a.div=a.divide;a.min=function(a,f,h){h[0]=Math.min(a[0],f[0]);h[1]=Math.min(a[1],f[1]);h[2]=Math.min(a[2],
f[2]);h[3]=Math.min(a[3],f[3]);return h};a.max=function(a,f,h){h[0]=Math.max(a[0],f[0]);h[1]=Math.max(a[1],f[1]);h[2]=Math.max(a[2],f[2]);h[3]=Math.max(a[3],f[3]);return h};a.scale=function(a,f,h){h[0]=a[0]*f;h[1]=a[1]*f;h[2]=a[2]*f;h[3]=a[3]*f;return h};a.scaleAndAdd=function(a,f,h,q){q[0]=a[0]+f[0]*h;q[1]=a[1]+f[1]*h;q[2]=a[2]+f[2]*h;q[3]=a[3]+f[3]*h;return q};a.distance=function(a,f){var h=f[0]-a[0],q=f[1]-a[1],e=f[2]-a[2],n=f[3]-a[3];return Math.sqrt(h*h+q*q+e*e+n*n)};a.dist=a.distance;a.squaredDistance=
function(a,f){var h=f[0]-a[0],q=f[1]-a[1],e=f[2]-a[2],n=f[3]-a[3];return h*h+q*q+e*e+n*n};a.sqrDist=a.squaredDistance;a.length=function(a){var f=a[0],h=a[1],q=a[2];a=a[3];return Math.sqrt(f*f+h*h+q*q+a*a)};a.len=a.length;a.squaredLength=function(a){var f=a[0],h=a[1],q=a[2];a=a[3];return f*f+h*h+q*q+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,f){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];f[3]=-a[3];return f};a.inverse=function(a,f){f[0]=1/a[0];f[1]=1/a[1];f[2]=1/a[2];f[3]=1/a[3];return f};a.normalize=
function(a,f){var h=a[0],q=a[1],e=a[2],n=a[3],p=h*h+q*q+e*e+n*n;0<p&&(p=1/Math.sqrt(p),f[0]=h*p,f[1]=q*p,f[2]=e*p,f[3]=n*p);return f};a.dot=function(a,f){return a[0]*f[0]+a[1]*f[1]+a[2]*f[2]+a[3]*f[3]};a.lerp=function(a,f,h,q){var e=a[0],n=a[1],p=a[2];a=a[3];q[0]=e+h*(f[0]-e);q[1]=n+h*(f[1]-n);q[2]=p+h*(f[2]-p);q[3]=a+h*(f[3]-a);return q};a.random=function(b,f){b=b||1;f[0]=h();f[1]=h();f[2]=h();f[3]=h();a.normalize(f,f);a.scale(f,b,f);return f};a.transformMat4=function(a,f,h){var q=a[0],e=a[1],n=
a[2];a=a[3];h[0]=f[0]*q+f[4]*e+f[8]*n+f[12]*a;h[1]=f[1]*q+f[5]*e+f[9]*n+f[13]*a;h[2]=f[2]*q+f[6]*e+f[10]*n+f[14]*a;h[3]=f[3]*q+f[7]*e+f[11]*n+f[15]*a;return h};a.transformQuat=function(a,f,h){var q=a[0],e=a[1],n=a[2],p=f[0],r=f[1],c=f[2];f=f[3];var k=f*q+r*n-c*e,m=f*e+c*q-p*n,A=f*n+p*e-r*q,q=-p*q-r*e-c*n;h[0]=k*f+q*-p+m*-c-A*-r;h[1]=m*f+q*-r+A*-p-k*-c;h[2]=A*f+q*-c+k*-r-m*-p;h[3]=a[3];return h};a.forEach=function(){var b=a.create();return function(a,h,q,e,n,p){h||(h=4);q||(q=0);for(e=e?Math.min(e*
h+q,a.length):a.length;q<e;q+=h)b[0]=a[q],b[1]=a[q+1],b[2]=a[q+2],b[3]=a[q+3],n(b,p,b),a[q]=b[0],a[q+1]=b[1],a[q+2]=b[2],a[q+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,r){var u=r("__vec3"),h=r("__vec4"),b=r("__mat3"),f="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new f(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=u.create(),f=u.fromValues(1,0,0),e=u.fromValues(0,1,0);return function(h,p,r){var c=u.dot(h,p);if(-.9999999>c)return u.cross(f,h,b),1E-6>u.length(b)&&u.cross(e,h,b),u.normalize(b,b),a.setAxisAngle(b,Math.PI,r),r;if(.9999999<c)return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r;u.cross(h,
p,b);r[0]=b[0];r[1]=b[1];r[2]=b[2];r[3]=1+c;return a.normalize(r,r)}}();a.setAxes=function(){var f=b.create();return function(b,e,h,p){f[0]=e[0];f[3]=e[1];f[6]=e[2];f[1]=h[0];f[4]=h[1];f[7]=h[2];f[2]=-b[0];f[5]=-b[1];f[8]=-b[2];return a.normalize(a.fromMat3(f,p),p)}}();a.clone=h.clone;a.fromValues=h.fromValues;a.copy=h.copy;a.set=h.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,e){b*=.5;var f=Math.sin(b);e[0]=f*a[0];e[1]=f*a[1];e[2]=f*a[2];e[3]=Math.cos(b);
return e};a.add=h.add;a.multiply=function(a,b,e){var f=a[0],h=a[1],r=a[2];a=a[3];var c=b[0],k=b[1],m=b[2];b=b[3];e[0]=f*b+a*c+h*m-r*k;e[1]=h*b+a*k+r*c-f*m;e[2]=r*b+a*m+f*k-h*c;e[3]=a*b-f*c-h*k-r*m;return e};a.mul=a.multiply;a.scale=h.scale;a.rotateX=function(a,b,e){b*=.5;var f=a[0],h=a[1],r=a[2];a=a[3];var c=Math.sin(b);b=Math.cos(b);e[0]=f*b+a*c;e[1]=h*b+r*c;e[2]=r*b-h*c;e[3]=a*b-f*c;return e};a.rotateY=function(a,b,e){b*=.5;var f=a[0],h=a[1],r=a[2];a=a[3];var c=Math.sin(b);b=Math.cos(b);e[0]=f*
b-r*c;e[1]=h*b+a*c;e[2]=r*b+f*c;e[3]=a*b-h*c;return e};a.rotateZ=function(a,b,e){b*=.5;var f=a[0],h=a[1],r=a[2];a=a[3];var c=Math.sin(b);b=Math.cos(b);e[0]=f*b+h*c;e[1]=h*b-f*c;e[2]=r*b+a*c;e[3]=a*b-r*c;return e};a.calculateW=function(a,b){var e=a[0],f=a[1],h=a[2];b[0]=e;b[1]=f;b[2]=h;b[3]=Math.sqrt(Math.abs(1-e*e-f*f-h*h));return b};a.dot=h.dot;a.lerp=h.lerp;a.slerp=function(a,b,e,f){var h=a[0],r=a[1],c=a[2];a=a[3];var k=b[0],m=b[1],A=b[2];b=b[3];var u,w,v;w=h*k+r*m+c*A+a*b;0>w&&(w=-w,k=-k,m=-m,
A=-A,b=-b);1E-6<1-w?(u=Math.acos(w),v=Math.sin(u),w=Math.sin((1-e)*u)/v,e=Math.sin(e*u)/v):w=1-e;f[0]=w*h+e*k;f[1]=w*r+e*m;f[2]=w*c+e*A;f[3]=w*a+e*b;return f};a.sqlerp=function(){var b=a.create(),f=a.create();return function(e,h,p,r,c,k){a.slerp(e,r,c,b);a.slerp(h,p,c,f);a.slerp(b,f,2*c*(1-c),k);return k}}();a.invert=function(a,b){var e=a[0],f=a[1],h=a[2],r=a[3],c=e*e+f*f+h*h+r*r,c=c?1/c:0;b[0]=-e*c;b[1]=-f*c;b[2]=-h*c;b[3]=r*c;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];
b[3]=a[3];return b};a.length=h.length;a.len=a.length;a.squaredLength=h.squaredLength;a.sqrLen=a.squaredLength;a.normalize=h.normalize;a.fromMat3=function(a,b){var e=a[0]+a[4]+a[8];if(0<e)e=Math.sqrt(e+1),b[3]=.5*e,e=.5/e,b[0]=(a[5]-a[7])*e,b[1]=(a[6]-a[2])*e,b[2]=(a[1]-a[3])*e;else{var f=0;a[4]>a[0]&&(f=1);a[8]>a[3*f+f]&&(f=2);var h=(f+1)%3,r=(f+2)%3,e=Math.sqrt(a[3*f+f]-a[3*h+h]-a[3*r+r]+1);b[f]=.5*e;e=.5/e;b[3]=(a[3*h+r]-a[3*r+h])*e;b[h]=(a[3*h+f]+a[3*f+h])*e;b[r]=(a[3*r+f]+a[3*f+r])*e}return b};
a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new u(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new u(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var f=a[1],l=a[2],q=a[5];b[1]=a[3];b[2]=a[6];b[3]=f;b[5]=a[7];b[6]=l;b[7]=q}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var f=a[0],l=a[1],q=a[2],e=a[3],n=a[4],p=a[5],r=a[6],c=a[7],k=a[8],m=k*n-p*c,A=-k*e+p*
r,u=c*e-n*r,w=f*m+l*A+q*u;if(!w)return null;w=1/w;b[0]=m*w;b[1]=(-k*l+q*c)*w;b[2]=(p*l-q*n)*w;b[3]=A*w;b[4]=(k*f-q*r)*w;b[5]=(-p*f+q*e)*w;b[6]=u*w;b[7]=(-c*f+l*r)*w;b[8]=(n*f-l*e)*w;return b};a.adjoint=function(a,b){var f=a[0],l=a[1],q=a[2],e=a[3],n=a[4],p=a[5],r=a[6],c=a[7],k=a[8];b[0]=n*k-p*c;b[1]=q*c-l*k;b[2]=l*p-q*n;b[3]=p*r-e*k;b[4]=f*k-q*r;b[5]=q*e-f*p;b[6]=e*c-n*r;b[7]=l*r-f*c;b[8]=f*n-l*e;return b};a.determinant=function(a){var b=a[3],f=a[4],l=a[5],q=a[6],e=a[7],n=a[8];return a[0]*(n*f-l*
e)+a[1]*(-n*b+l*q)+a[2]*(e*b-f*q)};a.multiply=function(a,b,f){var l=a[0],q=a[1],e=a[2],n=a[3],p=a[4],r=a[5],c=a[6],k=a[7];a=a[8];var m=b[0],A=b[1],u=b[2],w=b[3],v=b[4],z=b[5],y=b[6],D=b[7];b=b[8];f[0]=m*l+A*n+u*c;f[1]=m*q+A*p+u*k;f[2]=m*e+A*r+u*a;f[3]=w*l+v*n+z*c;f[4]=w*q+v*p+z*k;f[5]=w*e+v*r+z*a;f[6]=y*l+D*n+b*c;f[7]=y*q+D*p+b*k;f[8]=y*e+D*r+b*a;return f};a.mul=a.multiply;a.translate=function(a,b,f){var l=a[0],q=a[1],e=a[2],n=a[3],p=a[4],r=a[5],c=a[6],k=a[7];a=a[8];var m=b[0];b=b[1];f[0]=l;f[1]=
q;f[2]=e;f[3]=n;f[4]=p;f[5]=r;f[6]=m*l+b*n+c;f[7]=m*q+b*p+k;f[8]=m*e+b*r+a;return f};a.rotate=function(a,b,f){var l=a[0],q=a[1],e=a[2],n=a[3],p=a[4],r=a[5],c=a[6],k=a[7];a=a[8];var m=Math.sin(b);b=Math.cos(b);f[0]=b*l+m*n;f[1]=b*q+m*p;f[2]=b*e+m*r;f[3]=b*n-m*l;f[4]=b*p-m*q;f[5]=b*r-m*e;f[6]=c;f[7]=k;f[8]=a;return f};a.scale=function(a,b,f){var l=b[0];b=b[1];f[0]=l*a[0];f[1]=l*a[1];f[2]=l*a[2];f[3]=b*a[3];f[4]=b*a[4];f[5]=b*a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];return f};a.fromTranslation=function(a,
b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.fromRotation=function(a,b){var f=Math.sin(a),l=Math.cos(a);b[0]=l;b[1]=f;b[2]=0;b[3]=-f;b[4]=l;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var f=a[0],l=a[1],q=a[2],e=a[3],n=f+
f,p=l+l,r=q+q,f=f*n,c=l*n,l=l*p,k=q*n,m=q*p,q=q*r,n=e*n,p=e*p,e=e*r;b[0]=1-l-q;b[3]=c-e;b[6]=k+p;b[1]=c+e;b[4]=1-f-q;b[7]=m-n;b[2]=k-p;b[5]=m+n;b[8]=1-f-l;return b};a.normalFromMat4=function(a,b){var f=a[0],l=a[1],q=a[2],e=a[3],n=a[4],p=a[5],r=a[6],c=a[7],k=a[8],m=a[9],A=a[10],u=a[11],w=a[12],v=a[13],z=a[14],y=a[15],D=f*p-l*n,K=f*r-q*n,d=f*c-e*n,t=l*r-q*p,C=l*c-e*p,M=q*c-e*r,x=k*v-m*w,g=k*z-A*w,k=k*y-u*w,H=m*z-A*v,m=m*y-u*v,A=A*y-u*z,u=D*A-K*m+d*H+t*k-C*g+M*x;if(!u)return null;u=1/u;b[0]=(p*A-r*m+
c*H)*u;b[1]=(r*k-n*A-c*g)*u;b[2]=(n*m-p*k+c*x)*u;b[3]=(q*m-l*A-e*H)*u;b[4]=(f*A-q*k+e*g)*u;b[5]=(l*k-f*m-e*x)*u;b[6]=(v*M-z*C+y*t)*u;b[7]=(z*d-w*M-y*K)*u;b[8]=(w*C-v*d+y*D)*u;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))}};
b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new u(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new u(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var f=a[1],l=a[2],q=a[3],e=a[6],n=a[7],p=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=f;b[6]=a[9];b[7]=a[13];b[8]=l;b[9]=e;b[11]=a[14];b[12]=q;b[13]=
n;b[14]=p}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var f=a[0],l=a[1],q=a[2],e=a[3],n=a[4],p=a[5],r=a[6],c=a[7],k=a[8],m=a[9],A=a[10],u=a[11],w=a[12],v=a[13],z=a[14],y=a[15],D=f*p-l*n,K=f*r-q*n,d=f*c-e*n,t=l*r-q*p,C=l*c-e*p,M=q*c-e*r,x=k*v-m*w,g=k*z-A*w,H=k*y-u*w,G=m*z-A*v,ba=m*y-u*v,L=A*y-u*z,F=D*L-K*ba+d*G+t*H-C*g+M*x;if(!F)return null;
F=1/F;b[0]=(p*L-r*ba+c*G)*F;b[1]=(q*ba-l*L-e*G)*F;b[2]=(v*M-z*C+y*t)*F;b[3]=(A*C-m*M-u*t)*F;b[4]=(r*H-n*L-c*g)*F;b[5]=(f*L-q*H+e*g)*F;b[6]=(z*d-w*M-y*K)*F;b[7]=(k*M-A*d+u*K)*F;b[8]=(n*ba-p*H+c*x)*F;b[9]=(l*H-f*ba-e*x)*F;b[10]=(w*C-v*d+y*D)*F;b[11]=(m*d-k*C-u*D)*F;b[12]=(p*g-n*G-r*x)*F;b[13]=(f*G-l*g+q*x)*F;b[14]=(v*K-w*t-z*D)*F;b[15]=(k*t-m*K+A*D)*F;return b};a.adjoint=function(a,b){var f=a[0],l=a[1],q=a[2],e=a[3],n=a[4],p=a[5],r=a[6],c=a[7],k=a[8],m=a[9],A=a[10],u=a[11],w=a[12],v=a[13],z=a[14],y=
a[15];b[0]=p*(A*y-u*z)-m*(r*y-c*z)+v*(r*u-c*A);b[1]=-(l*(A*y-u*z)-m*(q*y-e*z)+v*(q*u-e*A));b[2]=l*(r*y-c*z)-p*(q*y-e*z)+v*(q*c-e*r);b[3]=-(l*(r*u-c*A)-p*(q*u-e*A)+m*(q*c-e*r));b[4]=-(n*(A*y-u*z)-k*(r*y-c*z)+w*(r*u-c*A));b[5]=f*(A*y-u*z)-k*(q*y-e*z)+w*(q*u-e*A);b[6]=-(f*(r*y-c*z)-n*(q*y-e*z)+w*(q*c-e*r));b[7]=f*(r*u-c*A)-n*(q*u-e*A)+k*(q*c-e*r);b[8]=n*(m*y-u*v)-k*(p*y-c*v)+w*(p*u-c*m);b[9]=-(f*(m*y-u*v)-k*(l*y-e*v)+w*(l*u-e*m));b[10]=f*(p*y-c*v)-n*(l*y-e*v)+w*(l*c-e*p);b[11]=-(f*(p*u-c*m)-n*(l*u-e*
m)+k*(l*c-e*p));b[12]=-(n*(m*z-A*v)-k*(p*z-r*v)+w*(p*A-r*m));b[13]=f*(m*z-A*v)-k*(l*z-q*v)+w*(l*A-q*m);b[14]=-(f*(p*z-r*v)-n*(l*z-q*v)+w*(l*r-q*p));b[15]=f*(p*A-r*m)-n*(l*A-q*m)+k*(l*r-q*p);return b};a.determinant=function(a){var b=a[0],f=a[1],l=a[2],q=a[3],e=a[4],n=a[5],p=a[6],r=a[7],c=a[8],k=a[9],m=a[10],A=a[11],u=a[12],w=a[13],v=a[14];a=a[15];return(b*n-f*e)*(m*a-A*v)-(b*p-l*e)*(k*a-A*w)+(b*r-q*e)*(k*v-m*w)+(f*p-l*n)*(c*a-A*u)-(f*r-q*n)*(c*v-m*u)+(l*r-q*p)*(c*w-k*u)};a.multiply=function(a,b,f){var l=
a[0],q=a[1],e=a[2],n=a[3],p=a[4],r=a[5],c=a[6],k=a[7],m=a[8],A=a[9],u=a[10],w=a[11],v=a[12],z=a[13],y=a[14];a=a[15];var D=b[0],K=b[1],d=b[2],t=b[3];f[0]=D*l+K*p+d*m+t*v;f[1]=D*q+K*r+d*A+t*z;f[2]=D*e+K*c+d*u+t*y;f[3]=D*n+K*k+d*w+t*a;D=b[4];K=b[5];d=b[6];t=b[7];f[4]=D*l+K*p+d*m+t*v;f[5]=D*q+K*r+d*A+t*z;f[6]=D*e+K*c+d*u+t*y;f[7]=D*n+K*k+d*w+t*a;D=b[8];K=b[9];d=b[10];t=b[11];f[8]=D*l+K*p+d*m+t*v;f[9]=D*q+K*r+d*A+t*z;f[10]=D*e+K*c+d*u+t*y;f[11]=D*n+K*k+d*w+t*a;D=b[12];K=b[13];d=b[14];t=b[15];f[12]=D*l+
K*p+d*m+t*v;f[13]=D*q+K*r+d*A+t*z;f[14]=D*e+K*c+d*u+t*y;f[15]=D*n+K*k+d*w+t*a;return f};a.mul=a.multiply;a.translate=function(a,b,f){var l=b[0],q=b[1];b=b[2];var e,n,p,r,c,k,m,A,u,w,v,z;a===f?(f[12]=a[0]*l+a[4]*q+a[8]*b+a[12],f[13]=a[1]*l+a[5]*q+a[9]*b+a[13],f[14]=a[2]*l+a[6]*q+a[10]*b+a[14],f[15]=a[3]*l+a[7]*q+a[11]*b+a[15]):(e=a[0],n=a[1],p=a[2],r=a[3],c=a[4],k=a[5],m=a[6],A=a[7],u=a[8],w=a[9],v=a[10],z=a[11],f[0]=e,f[1]=n,f[2]=p,f[3]=r,f[4]=c,f[5]=k,f[6]=m,f[7]=A,f[8]=u,f[9]=w,f[10]=v,f[11]=z,
f[12]=e*l+c*q+u*b+a[12],f[13]=n*l+k*q+w*b+a[13],f[14]=p*l+m*q+v*b+a[14],f[15]=r*l+A*q+z*b+a[15]);return f};a.scale=function(a,b,f){var l=b[0],q=b[1];b=b[2];f[0]=a[0]*l;f[1]=a[1]*l;f[2]=a[2]*l;f[3]=a[3]*l;f[4]=a[4]*q;f[5]=a[5]*q;f[6]=a[6]*q;f[7]=a[7]*q;f[8]=a[8]*b;f[9]=a[9]*b;f[10]=a[10]*b;f[11]=a[11]*b;f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};a.rotate=function(a,b,f,l){var q=f[0],e=f[1];f=f[2];var n=Math.sqrt(q*q+e*e+f*f),p,r,c,k,m,A,u,w,v,z,y,D,K,d,t,C,M,x,g,H;if(1E-7>Math.abs(n))return null;
n=1/n;q*=n;e*=n;f*=n;p=Math.sin(b);r=Math.cos(b);c=1-r;b=a[0];n=a[1];k=a[2];m=a[3];A=a[4];u=a[5];w=a[6];v=a[7];z=a[8];y=a[9];D=a[10];K=a[11];d=q*q*c+r;t=e*q*c+f*p;C=f*q*c-e*p;M=q*e*c-f*p;x=e*e*c+r;g=f*e*c+q*p;H=q*f*c+e*p;q=e*f*c-q*p;e=f*f*c+r;l[0]=b*d+A*t+z*C;l[1]=n*d+u*t+y*C;l[2]=k*d+w*t+D*C;l[3]=m*d+v*t+K*C;l[4]=b*M+A*x+z*g;l[5]=n*M+u*x+y*g;l[6]=k*M+w*x+D*g;l[7]=m*M+v*x+K*g;l[8]=b*H+A*q+z*e;l[9]=n*H+u*q+y*e;l[10]=k*H+w*q+D*e;l[11]=m*H+v*q+K*e;a!==l&&(l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]);
return l};a.rotateX=function(a,b,f){var l=Math.sin(b);b=Math.cos(b);var q=a[4],e=a[5],n=a[6],p=a[7],r=a[8],c=a[9],k=a[10],m=a[11];a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[4]=q*b+r*l;f[5]=e*b+c*l;f[6]=n*b+k*l;f[7]=p*b+m*l;f[8]=r*b-q*l;f[9]=c*b-e*l;f[10]=k*b-n*l;f[11]=m*b-p*l;return f};a.rotateY=function(a,b,f){var l=Math.sin(b);b=Math.cos(b);var q=a[0],e=a[1],n=a[2],p=a[3],r=a[8],c=a[9],k=a[10],m=a[11];a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],
f[7]=a[7],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=q*b-r*l;f[1]=e*b-c*l;f[2]=n*b-k*l;f[3]=p*b-m*l;f[8]=q*l+r*b;f[9]=e*l+c*b;f[10]=n*l+k*b;f[11]=p*l+m*b;return f};a.rotateZ=function(a,b,f){var l=Math.sin(b);b=Math.cos(b);var q=a[0],e=a[1],n=a[2],p=a[3],r=a[4],c=a[5],k=a[6],m=a[7];a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=q*b+r*l;f[1]=e*b+c*l;f[2]=n*b+k*l;f[3]=p*b+m*l;f[4]=r*b-q*l;f[5]=c*b-e*l;f[6]=k*b-n*l;f[7]=m*b-p*l;return f};
a.fromTranslation=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotation=function(a,b,f){var l=b[0],q=b[1];b=b[2];var e=Math.sqrt(l*l+q*q+b*b),n;if(1E-7>Math.abs(e))return null;e=1/e;l*=e;q*=e;b*=e;e=Math.sin(a);a=Math.cos(a);
n=1-a;f[0]=l*l*n+a;f[1]=q*l*n+b*e;f[2]=b*l*n-q*e;f[3]=0;f[4]=l*q*n-b*e;f[5]=q*q*n+a;f[6]=b*q*n+l*e;f[7]=0;f[8]=l*b*n+q*e;f[9]=q*b*n-l*e;f[10]=b*b*n+a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};a.fromXRotation=function(a,b){var f=Math.sin(a),l=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=l;b[6]=f;b[7]=0;b[8]=0;b[9]=-f;b[10]=l;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromYRotation=function(a,b){var f=Math.sin(a),l=Math.cos(a);b[0]=l;b[1]=0;b[2]=-f;b[3]=0;b[4]=0;b[5]=1;b[6]=
0;b[7]=0;b[8]=f;b[9]=0;b[10]=l;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromZRotation=function(a,b){var f=Math.sin(a),l=Math.cos(a);b[0]=l;b[1]=f;b[2]=0;b[3]=0;b[4]=-f;b[5]=l;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,f){var l=a[0],q=a[1],e=a[2],n=a[3],p=l+l,r=q+q,c=e+e;a=l*p;var k=l*r,l=l*c,m=q*r,q=q*c,e=e*c,p=n*p,r=n*r,n=n*c;f[0]=1-(m+e);f[1]=k+n;f[2]=l-r;f[3]=0;f[4]=k-n;f[5]=1-(a+e);f[6]=q+p;f[7]=0;f[8]=
l+r;f[9]=q-p;f[10]=1-(a+m);f[11]=0;f[12]=b[0];f[13]=b[1];f[14]=b[2];f[15]=1;return f};a.fromRotationTranslationScale=function(a,b,f,l){var q=a[0],e=a[1],n=a[2],p=a[3],r=q+q,c=e+e,k=n+n;a=q*r;var m=q*c,q=q*k,A=e*c,e=e*k,n=n*k,r=p*r,c=p*c,p=p*k,k=f[0],u=f[1];f=f[2];l[0]=(1-(A+n))*k;l[1]=(m+p)*k;l[2]=(q-c)*k;l[3]=0;l[4]=(m-p)*u;l[5]=(1-(a+n))*u;l[6]=(e+r)*u;l[7]=0;l[8]=(q+c)*f;l[9]=(e-r)*f;l[10]=(1-(a+A))*f;l[11]=0;l[12]=b[0];l[13]=b[1];l[14]=b[2];l[15]=1;return l};a.fromRotationTranslationScaleOrigin=
function(a,b,f,l,q){var e=a[0],n=a[1],p=a[2],r=a[3],c=e+e,k=n+n,m=p+p;a=e*c;var u=e*k,e=e*m,E=n*k,n=n*m,p=p*m,c=r*c,k=r*k,r=r*m,m=f[0],w=f[1];f=f[2];var v=l[0],z=l[1];l=l[2];q[0]=(1-(E+p))*m;q[1]=(u+r)*m;q[2]=(e-k)*m;q[3]=0;q[4]=(u-r)*w;q[5]=(1-(a+p))*w;q[6]=(n+c)*w;q[7]=0;q[8]=(e+k)*f;q[9]=(n-c)*f;q[10]=(1-(a+E))*f;q[11]=0;q[12]=b[0]+v-(q[0]*v+q[4]*z+q[8]*l);q[13]=b[1]+z-(q[1]*v+q[5]*z+q[9]*l);q[14]=b[2]+l-(q[2]*v+q[6]*z+q[10]*l);q[15]=1;return q};a.fromQuat=function(a,b){var f=a[0],l=a[1],q=a[2],
e=a[3],n=f+f,p=l+l,r=q+q,f=f*n,c=l*n,l=l*p,k=q*n,m=q*p,q=q*r,n=e*n,p=e*p,e=e*r;b[0]=1-l-q;b[1]=c+e;b[2]=k-p;b[3]=0;b[4]=c-e;b[5]=1-f-q;b[6]=m+n;b[7]=0;b[8]=k+p;b[9]=m-n;b[10]=1-f-l;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,f,l,q,e,n){var p=1/(b-a),r=1/(l-f),c=1/(q-e);n[0]=2*q*p;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2*q*r;n[6]=0;n[7]=0;n[8]=(b+a)*p;n[9]=(l+f)*r;n[10]=(e+q)*c;n[11]=-1;n[12]=0;n[13]=0;n[14]=e*q*2*c;n[15]=0;return n};a.perspective=function(a,b,f,l,q){a=1/Math.tan(a/
2);var e=1/(f-l);q[0]=a/b;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=a;q[6]=0;q[7]=0;q[8]=0;q[9]=0;q[10]=(l+f)*e;q[11]=-1;q[12]=0;q[13]=0;q[14]=2*l*f*e;q[15]=0;return q};a.perspectiveFromFieldOfView=function(a,b,f,l){var q=Math.tan(a.upDegrees*Math.PI/180),e=Math.tan(a.downDegrees*Math.PI/180),n=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var p=2/(n+a),r=2/(q+e);l[0]=p;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=r;l[6]=0;l[7]=0;l[8]=-((n-a)*p*.5);l[9]=(q-e)*r*.5;l[10]=f/(b-f);l[11]=-1;l[12]=
0;l[13]=0;l[14]=f*b/(b-f);l[15]=0;return l};a.ortho=function(a,b,f,l,q,e,n){var p=1/(a-b),r=1/(f-l),c=1/(q-e);n[0]=-2*p;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=-2*r;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=2*c;n[11]=0;n[12]=(a+b)*p;n[13]=(l+f)*r;n[14]=(e+q)*c;n[15]=1;return n};a.lookAt=function(h,b,f,l){var q,e,n,p,r,c,k,m,u=h[0],E=h[1];h=h[2];n=f[0];p=f[1];e=f[2];k=b[0];f=b[1];q=b[2];if(1E-7>Math.abs(u-k)&&1E-7>Math.abs(E-f)&&1E-7>Math.abs(h-q))return a.identity(l);b=u-k;f=E-f;k=h-q;m=1/Math.sqrt(b*b+f*f+k*k);
b*=m;f*=m;k*=m;q=p*k-e*f;e=e*b-n*k;n=n*f-p*b;(m=Math.sqrt(q*q+e*e+n*n))?(m=1/m,q*=m,e*=m,n*=m):n=e=q=0;p=f*n-k*e;r=k*q-b*n;c=b*e-f*q;(m=Math.sqrt(p*p+r*r+c*c))?(m=1/m,p*=m,r*=m,c*=m):c=r=p=0;l[0]=q;l[1]=p;l[2]=b;l[3]=0;l[4]=e;l[5]=r;l[6]=f;l[7]=0;l[8]=n;l[9]=c;l[10]=k;l[11]=0;l[12]=-(q*u+e*E+n*h);l[13]=-(p*u+r*E+c*h);l[14]=-(b*u+f*E+k*h);l[15]=1;return l};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+
a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))}};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a,r){function u(a,n){var p=a[0],q=a[1],c=a[2],k=a[3],p=b(p,q,c,k,n[0],7,-680876936),k=b(k,p,q,c,n[1],12,-389564586),c=b(c,k,p,q,n[2],17,606105819),q=b(q,c,k,p,n[3],22,-1044525330),p=b(p,q,c,k,n[4],7,-176418897),k=b(k,p,q,c,n[5],12,1200080426),c=b(c,k,p,q,n[6],17,-1473231341),q=b(q,c,k,p,n[7],22,-45705983),p=b(p,q,c,k,n[8],7,1770035416),k=b(k,p,q,c,n[9],12,-1958414417),c=b(c,k,p,q,n[10],17,-42063),q=b(q,c,k,p,n[11],22,-1990404162),p=b(p,q,c,k,n[12],7,1804603682),k=b(k,p,q,
c,n[13],12,-40341101),c=b(c,k,p,q,n[14],17,-1502002290),q=b(q,c,k,p,n[15],22,1236535329),p=f(p,q,c,k,n[1],5,-165796510),k=f(k,p,q,c,n[6],9,-1069501632),c=f(c,k,p,q,n[11],14,643717713),q=f(q,c,k,p,n[0],20,-373897302),p=f(p,q,c,k,n[5],5,-701558691),k=f(k,p,q,c,n[10],9,38016083),c=f(c,k,p,q,n[15],14,-660478335),q=f(q,c,k,p,n[4],20,-405537848),p=f(p,q,c,k,n[9],5,568446438),k=f(k,p,q,c,n[14],9,-1019803690),c=f(c,k,p,q,n[3],14,-187363961),q=f(q,c,k,p,n[8],20,1163531501),p=f(p,q,c,k,n[13],5,-1444681467),
k=f(k,p,q,c,n[2],9,-51403784),c=f(c,k,p,q,n[7],14,1735328473),q=f(q,c,k,p,n[12],20,-1926607734),p=h(q^c^k,p,q,n[5],4,-378558),k=h(p^q^c,k,p,n[8],11,-2022574463),c=h(k^p^q,c,k,n[11],16,1839030562),q=h(c^k^p,q,c,n[14],23,-35309556),p=h(q^c^k,p,q,n[1],4,-1530992060),k=h(p^q^c,k,p,n[4],11,1272893353),c=h(k^p^q,c,k,n[7],16,-155497632),q=h(c^k^p,q,c,n[10],23,-1094730640),p=h(q^c^k,p,q,n[13],4,681279174),k=h(p^q^c,k,p,n[0],11,-358537222),c=h(k^p^q,c,k,n[3],16,-722521979),q=h(c^k^p,q,c,n[6],23,76029189),
p=h(q^c^k,p,q,n[9],4,-640364487),k=h(p^q^c,k,p,n[12],11,-421815835),c=h(k^p^q,c,k,n[15],16,530742520),q=h(c^k^p,q,c,n[2],23,-995338651),p=l(p,q,c,k,n[0],6,-198630844),k=l(k,p,q,c,n[7],10,1126891415),c=l(c,k,p,q,n[14],15,-1416354905),q=l(q,c,k,p,n[5],21,-57434055),p=l(p,q,c,k,n[12],6,1700485571),k=l(k,p,q,c,n[3],10,-1894986606),c=l(c,k,p,q,n[10],15,-1051523),q=l(q,c,k,p,n[1],21,-2054922799),p=l(p,q,c,k,n[8],6,1873313359),k=l(k,p,q,c,n[15],10,-30611744),c=l(c,k,p,q,n[6],15,-1560198380),q=l(q,c,k,p,
n[13],21,1309151649),p=l(p,q,c,k,n[4],6,-145523070),k=l(k,p,q,c,n[11],10,-1120210379),c=l(c,k,p,q,n[2],15,718787259),q=l(q,c,k,p,n[9],21,-343485551);a[0]=p+a[0]&4294967295;a[1]=q+a[1]&4294967295;a[2]=c+a[2]&4294967295;a[3]=k+a[3]&4294967295}function h(a,b,f,h,c,k){b=(b+a&4294967295)+(h+k&4294967295)&4294967295;return(b<<c|b>>>32-c)+f&4294967295}function b(a,b,f,l,c,k,m){return h(b&f|~b&l,a,b,c,k,m)}function f(a,b,f,l,c,k,m){return h(b&l|f&~l,a,b,c,k,m)}function l(a,b,f,l,c,k,m){return h(f^(b|~l),
a,b,c,k,m)}var q="0123456789abcdef".split("");a.hexdigest=function(a){var b=a,f=b.length;a=[1732584193,-271733879,-1732584194,271733878];var h;for(h=64;h<=b.length;h+=64){for(var c=b.substring(h-64,h),k=[],m=void 0,m=0;64>m;m+=4)k[m>>2]=c.charCodeAt(m)+(c.charCodeAt(m+1)<<8)+(c.charCodeAt(m+2)<<16)+(c.charCodeAt(m+3)<<24);u(a,k)}b=b.substring(h-64);c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;h<b.length;h++)c[h>>2]|=b.charCodeAt(h)<<(h%4<<3);c[h>>2]|=128<<(h%4<<3);if(55<h)for(u(a,c),h=0;16>h;h++)c[h]=
0;c[14]=8*f;u(a,c);for(b=0;b<a.length;b++){f=a;h=b;c=a[b];k="";for(m=0;4>m;m++)k+=q[c>>8*m+4&15]+q[c>>8*m&15];f[h]=k}return a.join("")}};b4w.module.shader_texts=function(a,r){a["anchors.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"ANCHOR_NUM",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_proj_matrix ; GLSL_IN float a_index ; void main ( ) { gl_Position = u_view_proj_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"USE_OUTLINE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_MATRIX",TOKENS:["0"]},{TYPE:"var",
NAME:"USE_VIEW_MATRIX_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_MATRIX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_MATRIX_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"NUM_LIGHTS",
TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec4 u_light_color_intensities [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye_frag",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW","USE_VIEW_MATRIX",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",
";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform sampler2D u_sampler ; uniform float u_alpha_factor ;".split(" ")}]}}]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_OUTLINE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_color_id",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_LAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM",
"NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec4 u_csm_center_dists ; uniform GLSL_SMPLR2D_SHDW u_shadow_map0 ; uniform GLSL_SMPLR2D_SHDW u_shadow_map1 ; uniform GLSL_SMPLR2D_SHDW u_shadow_map2 ; uniform GLSL_SMPLR2D_SHDW u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_OUTLINE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","float","u_outline_intensity",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec3 c ; GLSL_IN vec4 d ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","e",";"]}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","f",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec4 j ; GLSL_IN vec4 k ; GLSL_IN vec4 l ; GLSL_IN vec4 m ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","n",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","o",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 u = u_camera_eye_frag - c ; vec3 v = normalize ( u ) ; vec3 A ; vec3 B ; vec3 C ; vec4 D ; float E ; mat3 F = mat3 ( 0.0 ) ; mat3 G = mat3 ( 0.0 ) ; mat3 H = mat3 ( 0.0 ) ; mat3 I = mat3 ( 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["F","=","u_view_tsr_frag",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["G","=","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["H","=","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["I","=","u_model_tsr_inverse",";"]}]}}]},{TYPE:"txt",TOKENS:"J ( v , F , G , H , I , A , B , C , D , E ) ; float L = E ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float L = ( GLSL_TEXTURE ( u_sampler , n ) ) . a ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float M = u_alpha_factor * L ; M += ( 1.0 - step ( 0.0 , M ) ) ; L = mix ( M , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float L = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( L < 0.5 ) discard ; L = 1.0 ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_OUTLINE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]};a["color_id.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN",TOKENS:["0"]},{TYPE:"var",
NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_PRES_GLOB_ORIENTATION",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",
TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"SMAA_JITTER",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM_MIX_NORMALS_FACTOR",TOKENS:["u_va_frame_factor"]},{TYPE:"var",NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",
FILE:"to_world.glslv"},{TYPE:"include",FILE:"scale_texcoord.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD",
"DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",
";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_texture_scale",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"CALC_TBN",{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_quat",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_shade_tangs",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{TYPE:"txt",
TOKENS:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_quat_next",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT vec3 c ; GLSL_OUT vec4 d ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","f",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},
"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","i",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","n",
";"]}]}}]}]}}]},{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { mat3 N = u_view_tsr ; vec3 O = a_position ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_NORMAL_MAP","USE_NODE_GEOMETRY_NO","CAUSTICS",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:6},{TYPE:"logical_and_expr",PLACES:3},"USE_TBN_SHADING","CALC_TBN",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Q = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = P ( a_tbn_quat , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; vec3 S = sign ( a_tbn_quat [ 3 ] ) * cross ( Q , R ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = vec3 ( 0.0 ) ; vec3 S = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Q = vec3 ( 0.0 ) ; vec3 R = vec3 ( 0.0 ) ; vec3 S = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["mat3","T","=","u_model_tsr",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"vec3 V = normalize ( U ( u_model_tsr , Q ) ) ; vec3 W = cross ( vec3 ( 0.0 , 0.0 , 1.0 ) , V ) ; vec3 X = cross ( V , W ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","X","=","a_shade_tangs",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 X = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = mix ( O , a_position_next , u_va_frame_factor ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Y = P ( a_tbn_quat_next , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Q = mix ( Q , Y , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Z = P ( a_tbn_quat_next , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; vec3 _ = sign ( a_tbn_quat_next [ 3 ] ) * cross ( Y , Z ) ; R = mix ( R , Z , u_va_frame_factor ) ; S = mix ( S , _ , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ac ( O , R , S , Q ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD",
{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ad","=","au_center_pos",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ad = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 af = ae ( T , ad ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ah ( u_camera_eye , af , N , T ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ai ( u_camera_eye , af , N ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = aj ( u_wind , u_time , u_jitter_amp , u_jitter_freq , af , T ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"ak am = al ( O - ad , ad , vec3 ( 0.0 ) , X , vec3 ( 0.0 ) , vec3 ( 0.0 ) , T ) ; am . ad = af ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = al ( O , ad , vec3 ( 0.0 ) , X , vec3 ( 0.0 ) , vec3 ( 0.0 ) , T ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"an ( am . O , am . ad , Q , mat4 ( 0.0 ) ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ao = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ao = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"an ( am . O , am . ad , ao , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logic_negative_expr",
PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"n = ap ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"c = am . O ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"e = am . Q ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float aq = ( dot ( cross ( am . Q , am . R ) , am . S ) < 0.0 ) ? - 1.0 : 1.0 ; f = vec4 ( am . R , aq ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"o = am . as ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"d = vec4 ( ae ( N , am . O ) , 1.0 ) ; vec4 at = u_proj_matrix * d ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"at . xy += u_subpixel_jitter * at . w ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"float au = at . x ; float av = at . y ; float aw = at . w ; h . x = ( au + aw ) / 2.0 ; h . y = ( av + aw ) / 2.0 ; h . z = aw ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"i = - d . z / u_view_max_depth ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["J","(",")",";"]}]}}]},{TYPE:"txt",TOKENS:"gl_Position = u_proj_matrix * vec4 ( ae ( N , am . O ) , 1.0 ) ; }".split(" ")}]};
a["debug_view.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"DEBUG_SPHERE",TOKENS:["0"]},{TYPE:"var",NAME:"WIREFRAME_QUALITY",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_SPHERE_DYNAMIC",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"uniform int u_debug_view_mode ; uniform float u_cluster_id ; uniform float u_batch_debug_id_color ; uniform float u_batch_debug_main_render_time ; uniform float u_debug_colors_seed ; uniform float u_debug_render_time_threshold ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_IN vec3 ax ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; const float ay = 1.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE_DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const vec3 az = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const vec3 az = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const vec3 aA = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 aB = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 aC = vec3 ( 1.0 , 1.0 , 1.0 ) ; const vec3 aD = vec3 ( 0.0 , 133.0 / 255.0 , 66.0 / 255.0 ) ; const vec3 aE = vec3 ( 160.0 / 255.0 , 38.0 / 255.0 , 33.0 / 255.0 ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float aJ ( ) { float aF = 1.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIREFRAME_QUALITY",0,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 aG = sign ( ax - vec3 ( 0.02 * ay ) ) ; if ( aG . x < 0.0 || aG . y < 0.0 || aG . z < 0.0 ) aF = 0.0 ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["WIREFRAME_QUALITY",1,{TYPE:"equal_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"txt",TOKENS:"vec3 aH = fwidth ( ax ) ; vec3 aI = smoothstep ( vec3 ( 0.0 ) , aH * ay , ax ) ; aF = min ( min ( aI . x , aI . y ) , aI . z ) ; aF = clamp ( aF , 0.0 , 1.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["return","aF",";","}"]}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { vec3 aK = vec3 ( 0.0 ) ; float L = 0.0 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 aG = sign ( ax - vec3 ( 0.02 * ay ) ) ; if ( aG . x < 0.0 || aG . y < 0.0 || aG . z < 0.0 ) { aK = az ; L = 1.0 ; } else discard ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( u_debug_view_mode == DV_OPAQUE_WIREFRAME ) { float aF = aJ ( ) ; aK = vec3 ( mix ( u_wireframe_edge_color , aC , aF ) ) ; L = 1.0 ; } else if ( u_debug_view_mode == DV_TRANSPARENT_WIREFRAME ) { float aF = aJ ( ) ; aK = u_wireframe_edge_color ; L = mix ( 1.0 , 0.0 , aF ) ; } else if ( u_debug_view_mode == DV_FRONT_BACK_VIEW ) { float aF = aJ ( ) ; if ( gl_FrontFacing ) aK = mix ( u_wireframe_edge_color , aA , aF ) ; else aK = mix ( u_wireframe_edge_color , aB , aF ) ; L = 1.0 ; } else if ( u_debug_view_mode == DV_CLUSTERS_VIEW ) { float aL = u_cluster_id + u_debug_colors_seed + 2.0 ; aK = vec3 ( fract ( aL * 19.73 ) , fract ( aL * 6.34 ) , fract ( aL * 1.56 ) ) ; L = 1.0 ; } else if ( u_debug_view_mode == DV_BATCHES_VIEW ) { float aL = u_batch_debug_id_color + u_debug_colors_seed ; aK = vec3 ( fract ( aL * 19.73 ) , fract ( aL * 6.34 ) , fract ( aL * 1.56 ) ) ; L = 1.0 ; } else if ( u_debug_view_mode == DV_RENDER_TIME ) { float aM ; if ( u_debug_render_time_threshold > 0.0 ) aM = clamp ( u_batch_debug_main_render_time , 0.0 , u_debug_render_time_threshold ) / u_debug_render_time_threshold ; else aM = 1.0 ; float aN = clamp ( 2.0 * aM , 0.0 , 1.0 ) ; float aO = clamp ( 2.0 * aM - 1.0 , 0.0 , 1.0 ) ; float aP = aM ; aK = mix ( aD , aE , vec3 ( aN , aO , aP ) ) ; L = 1.0 ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["aQ","(","aK",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aR ( aK , L ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK , L ) ; }".split(" ")}]};a["debug_view.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"USE_INSTANCED_PARTCLS",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_VIEW_SPECIAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",
NAME:"DEBUG_SPHERE",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",
NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_PRES_GLOB_ORIENTATION",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_position ; GLSL_IN vec4 a_tbn_quat ; GLSL_IN float a_polyindex ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"GLSL_IN vec4 a_part_ts ; GLSL_IN vec4 a_part_r ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","ax",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"include",FILE:"dynamic_grass.glslv"}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { if ( a_polyindex == 0.0 ) ax = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) ax = vec3 ( 0.0 , 0.0 , 1.0 ) ; else ax = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_VIEW_SPECIAL_SKYDOME"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"gl_Position = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 T = mat3 ( a_part_ts [ 0 ] , a_part_ts [ 1 ] , a_part_ts [ 2 ] , a_part_ts [ 3 ] , a_part_r [ 0 ] , a_part_r [ 1 ] , a_part_r [ 2 ] , a_part_r [ 3 ] , 1.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH",
{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = aS ( u_model_tsr , T ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","T","=","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:"mat3 N = u_view_tsr ; vec3 O = a_position ; vec3 Q = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_SPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = al ( O , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , T ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = mix ( O , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = vec3 ( 0.0 ) ; vec3 S = vec3 ( 0.0 ) ; ac ( O , R , S , Q ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",
PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ad","=","au_center_pos",";"]}]}},{TYPE:"elif",EXPRESSION:["DYNAMIC_GRASS","USE_INSTANCED_PARTCLS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ad = a_part_ts . xyz ; O = ae ( T , O ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ad = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = aT ( O , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ad , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , N ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 af = ae ( T , ad ) ;".split(" ")},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2},"USE_INSTANCED_PARTCLS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ah ( u_camera_eye , af , N , T ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ai ( u_camera_eye , af , N ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 aU = af ; T = aj ( u_wind , u_time , u_jitter_amp , u_jitter_freq , aU , T ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"ak am = al ( O - ad , ad , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , T ) ; am . ad = af ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = al ( O , ad , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , T ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"an ( am . O , am . ad , Q , mat4 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:"gl_Position = u_proj_matrix * vec4 ( ae ( N , am . O ) , 1.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]};a["error.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 , 0.0 , 1.0 , 1.0 ) ; }".split(" ")}]};
a["error.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_position ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; void main ( ) { gl_Position = u_proj_matrix * aV ( u_view_tsr ) * vec4 ( a_position , 1.0 ) ; }".split(" ")}]};a["grass_map.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"DYNAMIC_GRASS_SIZE",TOKENS:["0"]},{TYPE:"var",
NAME:"DYNAMIC_GRASS_COLOR",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","aW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","aW",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","aW",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","aW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aW , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 , aW ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:["}"]}]};a["grass_map.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},
{TYPE:"var",NAME:"DYNAMIC_GRASS_SIZE",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_grass_size",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_grass_color",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","aW",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","aW",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","aW",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"void main ( ) { mat3 N = u_view_tsr ; mat3 T = u_model_tsr ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 af = ae ( T , vec3 ( 0.0 ) ) ; mat3 T = ai ( u_camera_eye , af , N ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = aj ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) , T ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"ak am = al ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , T ) ; am . ad = af ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = al ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , T ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec4 at = u_proj_matrix * vec4 ( ae ( N , am . O ) , 1.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_SIZE"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aW = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aW","=","a_grass_size",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aW","=","a_grass_color",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=",
"at",";","}"]}]};a["halo.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_sun_intensity",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS",
"WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","aX",";"]}]}}]},{TYPE:"txt",TOKENS:"GLSL_IN vec2 n ; GLSL_IN float aY ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ;".split(" ")},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"halo_color.glslf"},{TYPE:"txt",TOKENS:"void main ( ) { vec4 a_ = aZ ( ) ; vec3 aK = a_ . rgb ; float aG = a_ . a ; aQ ( aK ) ; aR ( aK , aG ) ; GLSL_OUT_FRAG_COLOR = vec4 ( aK , aG ) ; }".split(" ")}]};
a["halo.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform PRECISION float u_halo_size ; uniform vec3 u_camera_eye ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_position ; GLSL_IN vec2 a_halo_bb_vertex ; GLSL_IN float a_random_vals ; GLSL_OUT vec2 n ; GLSL_OUT float aY ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS",
"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","aX",";"]}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { mat3 N = u_view_tsr ; mat3 T = u_model_tsr ; vec3 O = ae ( T , a_position ) ; n = a_halo_bb_vertex * 2.0 - 1.0 ; aY = a_random_vals ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 bd = bc ( O , N ) ; mat3 be = N ; be [ 0 ] [ 0 ] = 0.0 ; be [ 0 ] [ 1 ] = 0.0 ; be [ 0 ] [ 2 ] = 0.0 ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 bd = bc ( O , N ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec2 bf = ( a_halo_bb_vertex * 2.0 - 1.0 ) * u_halo_size ; vec3 bh = vec3 ( bf [ 0 ] , 0.0 , bf [ 1 ] ) ; vec3 bi = ae ( bd , bh ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 at = u_proj_matrix * vec4 ( ae ( be , bi ) , 1.0 ) ; at . z = 0.99999 * at . w ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS",
"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aX = vec4 ( bi , 1.0 ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 at = u_proj_matrix * vec4 ( ae ( N , bi ) , 1.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","at",";","}"]}]};a["lens_flares.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",
FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_sampler ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 aK = GLSL_TEXTURE ( u_sampler , n ) ; aQ ( aK . rgb ) ; aR ( aK . rgb , aK . a ) ; GLSL_OUT_FRAG_COLOR = aK ; }".split(" ")}]};a["lens_flares.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"define",NAME:"LIGHT_INDEX",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},
{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; GLSL_IN float a_lf_dist ; GLSL_IN vec2 a_lf_bb_vertex ; GLSL_IN vec2 a_texcoord ; GLSL_OUT vec2 n ; void main ( ) { n = a_texcoord ; vec3 bj = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 at = u_proj_matrix * vec4 ( U ( u_view_tsr , bj ) , 0.0 ) ; at . x /= at . w ; at . y /= at . w ; at += 99999.0 * step ( at . z , 0.0 ) ; at += 100.0 * ( step ( 1.0 , abs ( at . x ) ) + step ( 1.0 , abs ( at . y ) ) ) ; at . x = a_lf_dist * at . x ; at . y = a_lf_dist * at . y ; float bk = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 bl = vec2 ( a_lf_bb_vertex . x / bk , a_lf_bb_vertex . y ) ; if ( a_lf_dist < 0.999 ) { const float bm = 1.9 ; bl *= ( 1.0 + bm * length ( at . xy ) ) ; } gl_Position = vec4 ( at . xy + bl , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["line.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"uniform vec4 u_diffuse_color ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec3 aK = u_diffuse_color . xyz ; float L = u_diffuse_color . a ; aQ ( aK ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"aR ( aK , L ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK , L ) ; }".split(" ")}]};a["line.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_position ; GLSL_IN vec3 a_direction ; uniform mat3 u_model_tsr ; uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_line_width ; void main ( ) { mat3 N = u_view_tsr ; mat3 T = u_model_tsr ; ak am = al ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , normalize ( a_direction ) , T ) ; vec4 bn = u_proj_matrix * vec4 ( ae ( N , am . O ) , 1.0 ) ; bn . xyz /= bn . w ; vec2 bo = ( u_proj_matrix * vec4 ( U ( N , am . Q ) , 0.0 ) ) . xy ; float bp = M_PI / 2.0 ; mat2 bq = mat2 ( cos ( bp ) , sin ( bp ) , - sin ( bp ) , cos ( bp ) ) ; bo = bq * normalize ( bo ) ; vec2 bs = ( u_line_width / u_height ) * vec2 ( u_proj_matrix [ 0 ] [ 0 ] / u_proj_matrix [ 1 ] [ 1 ] , 1.0 ) ; gl_Position = vec4 ( bn . xy + bo . xy * bs / 2.0 , bn . z , 1.0 ) ; gl_Position *= bn . w ; }".split(" ")}]};
a["main.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"NORMAL_TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_MATRIX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_MATRIX_INVERSE",TOKENS:["0"]},
{TYPE:"var",NAME:"USE_MODEL_MATRIX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_MATRIX_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"PARALLAX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",
NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"WETTABLE",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"SSAO_ONLY",
TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},
{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"caustics.glslf"}]}}]}]}}]},{TYPE:"txt",TOKENS:["uniform",
"float","u_time",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",
";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec4 u_light_color_intensities [ NUM_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"uniform vec4 u_sun_quaternion ; uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye_frag",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW","USE_VIEW_MATRIX",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",
{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",
EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shadow_mask",";"]}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec4 u_csm_center_dists ; uniform PRECISION GLSL_SMPLR2D_SHDW u_shadow_map0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform",
"PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform",
"PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION",
"sampler2D","u_scene_depth",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","float","u_mirror_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_LAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","c",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_TEX_COORD_NO",{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",
"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN",
"vec4","d",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","f",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","l",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","m",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["GLSL_IN","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","i",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"nodes.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"txt",
TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float bt = length ( d ) ;".split(" ")}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float bu = c . z - WATER_LEVEL ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 u = normalize ( u_camera_eye_frag - c ) ; vec3 A ; vec3 B ; vec3 C ; vec4 D ; float E ; mat3 F = mat3 ( 0.0 ) ; mat3 G = mat3 ( 0.0 ) ; mat3 H = mat3 ( 0.0 ) ; mat3 I = mat3 ( 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW","USE_VIEW_MATRIX",
{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["F","=","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["G","=","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["H","=","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["I","=","u_model_tsr_inverse",";"]}]}}]},{TYPE:"txt",TOKENS:"J ( u , F , G , H , I , A , B , C , D , E ) ; vec3 aK = A ; float L = E ; vec3 Q = C ; vec4 bv = D ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WETTABLE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aK = max ( aK - sqrt ( 0.01 * - min ( bu , 0.0 ) ) , 0.5 * aK ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bw ( aK , bu , u_time , bv , Q , u_sun_direction , u_sun_intensity , u_sun_quaternion , c , bt ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( L < 0.5 ) discard ; L = 1.0 ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bx ( aK , bt , u , bu ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bx ( aK , bt , u , 1.0 ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",
{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float by = GLSL_TEXTURE_PROJ ( u_shadow_mask , h ) . a ; aK = vec3 ( by ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"aK = max ( vec3 ( 0.0 ) , aK ) ; aQ ( aK ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aR ( aK , L ) ;".split(" ")}]}}]},{TYPE:"txt",
TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK , L ) ; }".split(" ")}]};a["main.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN",TOKENS:["0"]},{TYPE:"var",NAME:"USE_INSTANCED_PARTCLS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",
TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"PARALLAX",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"SMAA_JITTER",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_PRES_GLOB_ORIENTATION",TOKENS:["0"]},
{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",
NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"MAC_OS_SHADOW_HACK",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM_MIX_NORMALS_FACTOR",TOKENS:["u_va_frame_factor"]},{TYPE:"var",NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},
{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"scale_texcoord.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_TEX_COORD_NO","CALC_TBN","TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",
{TYPE:"non_equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:10}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_quat",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec4 a_part_ts ; GLSL_IN vec4 a_part_r ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_shade_tangs",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",
{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_quat_next",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN",
"vec3","a_color",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","c",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"USE_NODE_TEX_COORD_NO",{TYPE:"logical_or_expr",PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["NODES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"WATER_EFFECTS","CAUSTICS",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","d",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","f",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bz",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["GLSL_OUT","vec2","n",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bA",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",
PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["GLSL_OUT","vec4","m",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",
PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_view_refl_matrix",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"BILLBOARD","DYNAMIC_GRASS",{TYPE:"logical_or_expr",
PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_texture_scale",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_normal_offset",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2",
"NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{TYPE:"include",FILE:"dynamic_grass.glslv"},{TYPE:"include",FILE:"shadow.glslv"},{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS",
"REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","bB","=","u_view_refl_matrix",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat4 bB = mat4 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["mat3","N","=","u_view_tsr",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 T = mat3 ( a_part_ts [ 0 ] , a_part_ts [ 1 ] , a_part_ts [ 2 ] , a_part_ts [ 3 ] , a_part_r [ 0 ] , a_part_r [ 1 ] , a_part_r [ 2 ] , a_part_r [ 3 ] , 1.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = aS ( u_model_tsr , T ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","T","=","u_model_tsr",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["vec3","O","=","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_TBN_SHADING","CALC_TBN",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 bC = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE",
"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"NODES",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Q","=","bC",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Q = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE","NODES",{TYPE:"logic_negative_expr",
PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = P ( a_tbn_quat , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; vec3 S = sign ( a_tbn_quat [ 3 ] ) * cross ( Q , R ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 bD = ae ( T , O ) ; vec3 V = normalize ( U ( T , bC ) ) ; vec3 u = bD - u_camera_eye ; vec3 S = cross ( u , V ) ; vec3 R = cross ( V , S ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = vec3 ( 0.0 ) ; vec3 S = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"vec3 V = normalize ( U ( T , bC ) ) ; vec3 W = cross ( vec3 ( 0.0 , 0.0 , 1.0 ) , V ) ; vec3 X = cross ( V , W ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","X","=","a_shade_tangs",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 X = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = mix ( O , a_position_next , u_va_frame_factor ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_NORMAL_MAP","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 bE = P ( a_tbn_quat_next , vec3 ( 0.0 , 1.0 , 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},
"USE_NODE_MATERIAL_BEGIN","USE_NODE_NORMAL_MAP","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Q = mix ( Q , bE , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Z = P ( a_tbn_quat_next , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; vec3 _ = sign ( a_tbn_quat_next [ 3 ] ) * cross ( bE , Z ) ; R = mix ( R , Z , u_va_frame_factor ) ; S = mix ( S , _ , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ac ( O , R , S , Q ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ad","=","au_center_pos",";"]}]}},{TYPE:"elif",EXPRESSION:["DYNAMIC_GRASS","USE_INSTANCED_PARTCLS",
{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ad = a_part_ts . xyz ; O = ae ( T , O ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ad = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = aT ( O , R , X , S , Q , ad , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , N ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 af = ae ( T , ad ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = ( bB * vec4 ( O , 1.0 ) ) . xyz ; ad = ( bB * vec4 ( ad , 1.0 ) ) . xyz ; af = ( bB * vec4 ( af , 1.0 ) ) . xyz ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_PRES_GLOB_ORIENTATION",
"STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2},"USE_INSTANCED_PARTCLS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ah ( u_camera_eye , af , N , T ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ai ( u_camera_eye , af , N ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"vec3 aU = af ; T = aj ( u_wind , u_time , u_jitter_amp , u_jitter_freq , aU , T ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"ak am = al ( O - ad , ad , R , X , S , Q , T ) ; am . ad = af ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = al ( O , ad , R , X , S , Q , T ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float aq = ( dot ( cross ( am . Q , am . R ) , am . S ) < 0.0 ) ? - 1.0 : 1.0 ; f = vec4 ( am . R , aq ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"o = am . as ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"an ( am . O , am . ad , Q , bB ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"c = am . O ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"e = am . Q ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"bz = u_camera_eye - am . O ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"n = ap ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bA = am . aK ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["VERTEX_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["bA","=","a_color",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS",
"REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 bF = bB * vec4 ( am . O , 1.0 ) ; bF . xyz = ae ( N , bF . xyz ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 bF = vec4 ( ae ( N , am . O ) , 1.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO",
"TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"WATER_EFFECTS","CAUSTICS",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["d","=","bF",";"]}]}}]},{TYPE:"txt",TOKENS:"vec4 at = u_proj_matrix * bF ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"at . xy += u_subpixel_jitter * at . w ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"h = bG ( at ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",
{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bH ( am . O , am . Q ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"i = - bF . z / u_view_max_depth ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["J","(",")",";"]}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","at",";","}"]}]};a["main_stack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"TEXTURE_SPEC_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR0_CO",TOKENS:["TEXTURE_COORDS_NONE"]},
{TYPE:"var",NAME:"TEXTURE_COLOR1_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"PARALLAX",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_SPEC",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_AS_SPEC",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_STENCIL_ALPHA_MASK",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_STENCIL_ALPHA_MASK_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"NORMAL_TEXCOORD",TOKENS:["0"]},{TYPE:"var",
NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"DOUBLE_SIDED_LIGHTING",TOKENS:["0"]},{TYPE:"var",NAME:"SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"WETTABLE",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},
{TYPE:"var",NAME:"INVERT_FRONTFACING",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"PARALLAX_LOD_DIST",TOKENS:["5.0"]},{TYPE:"var",NAME:"PARALLAX_STEPS",TOKENS:["5.0"]},{TYPE:"var",
NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"var",NAME:"SSAO_ONLY",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",
FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"caustics.glslf"}]}}]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_time",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec4 u_light_color_intensities [ NUM_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_sun_quaternion ; uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")}]}}]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NONE",
{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_colormap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_SPEC","ALPHA_AS_SPEC",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_specmap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_STENCIL_ALPHA_MASK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",
{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shadow_mask",
";"]}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec4 u_csm_center_dists ; uniform PRECISION GLSL_SMPLR2D_SHDW u_shadow_map0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1",
"NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3",
"NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_reflect_factor",";"]}]}},
{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_normal_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_SPEC"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_specular_color_factor",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_parallax_scale",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_refr_bump",";"]}]}}]},{TYPE:"txt",TOKENS:"GLSL_IN vec3 c ; GLSL_IN vec3 e ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",
{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","d",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","f",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bz",";"]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","n",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bA",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE",
"SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["GLSL_IN","vec4","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","m",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["GLSL_IN","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","i",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"shadow.glslf"}]}}]},{TYPE:"include",FILE:"mirror.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"include",FILE:"refraction.glslf"}]}}]},{TYPE:"include",FILE:"environment.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"lighting_nodes.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2},"SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"CAUSTICS","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float bt = length ( d ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"float bu = c . z - WATER_LEVEL ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","bI","=","n",";"]}]}}]},{TYPE:"txt",TOKENS:"vec3 bJ = normalize ( e ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["INVERT_FRONTFACING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","!","gl_FrontFacing",")"]}]}},{TYPE:"else",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing",")"]}]}}]},{TYPE:"txt",TOKENS:"bJ = bJ ; else bJ = - bJ ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 S = cross ( bJ , f . xyz ) * f . w ; S = normalize ( S ) ; vec3 R = cross ( S , bJ ) * f . w ; mat3 bK = mat3 ( R , S , bJ ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD",
"REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","N","=","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 bL = normalize ( U ( N , e ) ) . st ; bL = bL * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",
PLACES:2},"PARALLAX",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( bt < PARALLAX_LOD_DIST ) { float bM = clamp ( 0.5 * ( PARALLAX_LOD_DIST - bt ) , 0.0 , 1.0 ) ; float bN = u_parallax_scale * bM ; vec3 bO = normalize ( bz * bK ) ; float bP = 1.0 / PARALLAX_STEPS ; vec2 bQ = bO . xy * bN / ( PARALLAX_STEPS * bO . z ) ; float bR = 1.0 ; float bS ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","bT","=","bL",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","bT","=","bI",";"]}]}}]},{TYPE:"txt",TOKENS:"bS = GLSL_TEXTURE ( u_normalmap0 , bT ) . a ; for ( float bU = 1.0 ; bU <= PARALLAX_STEPS ; bU ++ ) { if ( bS < bR ) { bR -= bP ; bT -= bQ ; bS = GLSL_TEXTURE ( u_normalmap0 , bT ) . a ; } } vec2 bV = bT + bQ ; float bW = GLSL_TEXTURE ( u_normalmap0 , bV ) . a - ( bR + bP ) ; float bX = bS - bR ; float bY = bX / ( bX - bW ) ; bT = bY * bV + ( 1.0 - bY ) * bT ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bI += bT - bL ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["bL","=","bT",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bL += bT - bI ;".split(" ")}]}}]},{TYPE:"txt",
TOKENS:["bI","=","bT",";"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","bZ",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bZ = GLSL_TEXTURE ( u_normalmap0 , bL ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"bZ = GLSL_TEXTURE ( u_normalmap0 , bI ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 b_ = bZ . rgb - 0.5 ; b_ = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , b_ , u_normal_factor ) ; vec3 Q = bK * b_ ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Q","=","bJ",";"]}]}}]},{TYPE:"txt",TOKENS:"Q = normalize ( Q ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bL = normalize ( U ( N , Q ) ) . st ; bL = bL * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"vec3 u = normalize ( bz ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ca = bA ; cb ( ca ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_COLOR","DYNAMIC_GRASS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 cc = vec4 ( ca , 1.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["vec4","cc","=","u_diffuse_color",";"]}]}}]},{TYPE:"txt",TOKENS:["float","cd","=","1.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 ce = GLSL_TEXTURE ( u_colormap0 , bL ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 ce = GLSL_TEXTURE ( u_colormap0 , bI ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cb ( ce . rgb ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_STENCIL_ALPHA_MASK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cf",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cf = GLSL_TEXTURE ( u_colormap1 , bL ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cf = GLSL_TEXTURE ( u_colormap1 , bI ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"cb ( cf . rgb ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 cg = GLSL_TEXTURE ( u_stencil0 , bL ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 cg = GLSL_TEXTURE ( u_stencil0 , bI ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"ce = mix ( ce , cf , cg . r ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cc . rgb = mix ( cc . rgb , ce . rgb , u_diffuse_color_factor ) ; float M = u_alpha_factor * ce . a ; M += ( 1.0 - step ( 0.0 , M ) ) ; cc . a = mix ( M , 1.0 , u_diffuse_color . a ) ; cd = ce . a ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",
{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cc . rgb *= mix ( vec3 ( 1.0 ) , ce . rgb , u_diffuse_color_factor ) ; cc . a = ce . a ; cd = ce . a ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 aK = cc . rgb ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ch = u_diffuse_intensity * cc . rgb ; vec3 cj = u_environment_energy * ci ( Q ) ; vec3 ck = u_ambient * cj ; vec4 bv = cl ( ch ) ; vec3 cm = u_emit * cc . rgb ; vec3 cn = u_specular_color ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_SPEC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_AS_SPEC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 co = vec3 ( cd ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["TEXTURE_SPEC_CO","TEXTURE_COORDS_NORMAL",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 co = GLSL_TEXTURE ( u_specmap0 , bL ) . rgb ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 co = GLSL_TEXTURE ( u_specmap0 , bI ) . rgb ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"cb ( co . rgb ) ; cn = mix ( cn , co , u_specular_color_factor ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float cp = u_specular_params [ 0 ] ; vec2 cq = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 cr = cp * cn ; vec3 aK ; vec3 cs ; ct ( cm , ck , ch , cr , c , Q , u , cq , u_diffuse_params , bv , 0.0 , vec4 ( 0.0 ) , aK , cs ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"cu ( aK , u , Q , u_reflect_factor , N ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cu ( aK , u , Q , u_reflect_factor , mat3 ( 0.0 ) ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cu ( aK , u , Q , u_mirror_factor , mat3 ( 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aK","+=","cs",";"]}]}}]},{TYPE:"txt",TOKENS:"float L = cc . a ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WETTABLE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aK = max ( aK - sqrt ( 0.01 * - min ( bu , 0.0 ) ) , 0.5 * aK ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CAUSTICS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bw ( aK , bu , u_time , bv , Q , u_sun_direction , u_sun_intensity , u_sun_quaternion , c , bt ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( L < 0.5 ) discard ; L = 1.0 ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float t = max ( max ( cs . r , cs . g ) , cs . b ) * u_specular_alpha ; L = cc . a * ( 1.0 - t ) + t ;".split(" ")}]}}]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 cv = - ( U ( N , Q ) ) . xy ; aK = mix ( cw ( h , cv * u_refr_bump ) , aK , L ) ; L = 1.0 ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bx ( aK , bt , u , bu ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bx ( aK , bt , u , 1.0 ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float by = GLSL_TEXTURE_PROJ ( u_shadow_mask , h ) . a ; aK = vec3 ( by ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["aQ","(","aK",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aR ( aK , L ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK , L ) ; }".split(" ")}]};a["particle_system.glslf"]=
{TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"NORMAL_TEXCOORD",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_MATRIX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_MATRIX_INVERSE",
TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_MATRIX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_MATRIX_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},{TYPE:"var",NAME:"SOFT_STRENGTH",TOKENS:["0.25"]},{TYPE:"var",NAME:"SOFT_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",
TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES",
"NODES",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec4 u_light_color_intensities [ NUM_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"uniform float u_emit ; uniform float u_ambient ; uniform float u_time ; uniform vec3 u_camera_eye_frag ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_LAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW","USE_VIEW_MATRIX",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3",
"u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_TBN_SHADING",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","f",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV",
"USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","n",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","c",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","d",";"]}]}}]},{TYPE:"txt",TOKENS:"GLSL_IN vec3 e ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"particles_nodes.glslf"},{TYPE:"txt",TOKENS:"void main ( ) { vec3 u = normalize ( u_camera_eye_frag - c ) ; vec3 A ; vec3 B ; vec3 C ; vec4 D ; float E ; mat3 F = mat3 ( 0.0 ) ; mat3 G = mat3 ( 0.0 ) ; mat3 H = mat3 ( 0.0 ) ; mat3 I = mat3 ( 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["F","=","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["G","=","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["H","=","u_model_tsr",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["I","=","u_model_tsr_inverse",";"]}]}}]},{TYPE:"txt",TOKENS:"J ( u , F , G , H , I , A , B , C , D , E ) ; vec3 aK = A ; float L = E ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( L < 0.5 ) discard ; L = 1.0 ;".split(" ")}]}}]}]}},{TYPE:"else",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bx ( aK , length ( d ) , u , 1.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float cx = - d . z / u_view_max_depth ; vec4 cy = GLSL_TEXTURE_PROJ ( u_scene_depth , h ) ; float cA = cz ( cy ) ; float cB = cA - cx ; float cC = u_view_max_depth / SOFT_STRENGTH * cB ; L = L * min ( cC , 1.0 ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["aQ","(","aK",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aR ( aK , L ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK , L ) ; }".split(" ")}]};a["particle_system.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"BILLBOARD_ALIGN",TOKENS:["BILLBOARD_ALIGN_VIEW"]},{TYPE:"var",
NAME:"TEXTURE_NORM_CO",TOKENS:["TEXTURE_COORDS_NONE"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"HALO_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"PARTICLES_SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SOFT_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"COLOR_RAMP_LENGTH",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",
TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"WORLD_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_COLOR_RAMP",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_position ; GLSL_IN vec4 a_tbn_quat ; GLSL_IN vec3 a_p_data ; GLSL_IN vec4 a_p_vels ; GLSL_IN vec2 a_p_bb_vertex ;".split(" ")},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","cD",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bA",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO","TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_TBN_SHADING",{TYPE:"logical_or_expr",
PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","f",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","n",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","c",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",
{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","bz",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","d",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","aY",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform float u_p_tilt ; uniform float u_p_tilt_rand ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","mat4","u_view_refl_matrix",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_p_size ; uniform vec3 u_camera_eye ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WORLD_SPACE",{TYPE:"logic_negative_expr",PLACES:1},"NODES","HALO_PARTICLES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_COLOR_RAMP"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color_ramp_tex",";"]}]}}]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"particles.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"particles_nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:"float cG ( vec2 cE , vec2 cF ) { return ( atan ( cF . y , cF . x ) - atan ( cE . y , cE . x ) ) ; } void main ( ) {".split(" ")},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat4","bB","=","u_view_refl_matrix",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat4 bB = mat4 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"mat3 N = u_view_tsr ; cH pp ; pp = cI ( ) ; float cJ ; mat3 bd = cK ( ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 cL = ( bB * vec4 ( pp . O , 1.0 ) ) . xyz ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 cL = pp . O ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 Q = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { cJ = pp . bp ; bd = bc ( cL , N ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { cJ = cG ( vec2 ( EPSILON , 1.0 ) , vec2 ( Q . x , - Q . y ) ) + pp . bp ; bd [ 0 ] = cL ; vec4 cN = cM ( RIGHT_VECTOR , - M_PI / 2.0 ) ; bd = cO ( cN , bd ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { cJ = pp . bp ; bd [ 0 ] = cL ; vec4 cP = cM ( UP_VECTOR , M_PI / 2.0 ) ; bd = cO ( cP , bd ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { cJ = pp . bp ; bd [ 0 ] = cL ; } vec3 bh = vec3 ( ( a_p_bb_vertex [ 0 ] * 2.0 - 1.0 ) * pp . cQ * u_p_size , 0.0 , ( a_p_bb_vertex [ 1 ] * 2.0 - 1.0 ) * pp . cQ * u_p_size ) ; float cR = a_p_data [ 2 ] ; float cS = u_p_tilt * u_p_tilt_rand * ( 2.0 * cR - 1.0 ) ; float cT = ( cS + u_p_tilt ) * M_PI ; vec4 cU = cM ( TOWARD_VECTOR , cT + cJ ) ; vec3 bi = ae ( bd , P ( cU , bh ) ) ; vec4 bF = vec4 ( ae ( N , bi ) , 1.0 ) ; vec4 at = u_proj_matrix * bF ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["aY","=","cR",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE","NODES",{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},"USE_TBN_SHADING",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"vec3 R = P ( a_tbn_quat , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; vec3 S = sign ( a_tbn_quat [ 3 ] ) * cross ( Q , R ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = vec3 ( 0.0 ) ; vec3 S = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"mat3 cV = cK ( ) ; cU = cM ( TOWARD_VECTOR , cJ ) ; cV = cO ( cU , cV ) ; ak am = al ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , R , vec3 ( 0.0 ) , S , vec3 ( 0.0 ) , aS ( bd , cV ) ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_NORM_CO",
"TEXTURE_COORDS_NONE",{TYPE:"non_equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_TBN_SHADING",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float aq = ( dot ( cross ( Q , am . R ) , am . S ) < 0.0 ) ? - 1.0 : 1.0 ; f = vec4 ( am . R , aq ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",
PLACES:3},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["e","=","Q",";"]}]}}]},{TYPE:"txt",TOKENS:"J ( pp . O , pp . cW , pp . cX , pp . cY , pp . cQ , a_p_bb_vertex , a_p_data [ 0 ] ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["n","=","a_p_bb_vertex",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"n = a_p_bb_vertex * 2.0 - 1.0 ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cD = pp . L ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"bA = pp . aK ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float au = at . x ; float av = at . y ; float aw = at . w ; h . x = ( au + aw ) / 2.0 ; h . y = ( av + aw ) / 2.0 ; h . z = aw ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES",
"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["d","=","bF",";"]}]}}]},{TYPE:"txt",TOKENS:"gl_Position = at ; c = bi ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bz = u_camera_eye - bi ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["}"]}]};a["particle_system_stack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA_CLIP",TOKENS:["0"]},
{TYPE:"var",NAME:"SOFT_STRENGTH",TOKENS:["0.25"]},{TYPE:"var",NAME:"SOFT_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"HALO_PARTICLES",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"PARTICLES_SHADELESS",
TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","NODES",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_sampler",";"]}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec4 u_light_color_intensities [ NUM_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_halo_size ; uniform vec3 u_halo_rings_color ; uniform float u_halo_hardness ; uniform vec3 u_halo_lines_color ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"uniform vec3 u_sun_intensity ; uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"uniform float u_p_alpha_start ; uniform float u_p_alpha_end ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR","HALO_PARTICLES","USE_NODE_TEX_COORD_UV","USE_NODE_UV_MERGED","USE_NODE_UVMAP","USE_NODE_GEOMETRY_UV","USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",
PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","n",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","c",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","cD",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bA",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","bz",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"NODES",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","d",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","aY",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","aX",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","o",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"lighting_nodes.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",
{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"environment.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"halo_color.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",
{TYPE:"logic_negative_expr",PLACES:1},"DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 u = normalize ( bz ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["HALO_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 a_ = aZ ( ) ; vec3 aK = a_ . rgb * bA ; float cZ = 0.9 * length ( n ) ; float c_ = smoothstep ( u_p_alpha_start , u_p_alpha_end , cZ ) ; float L = a_ . a * ( 1.0 - c_ ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","cc","=","u_diffuse_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 ce = GLSL_TEXTURE ( u_sampler , n ) ; cb ( ce . rgb ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cc . rgb = mix ( cc . rgb , ce . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cc . rgb *= mix ( vec3 ( 1.0 ) , ce . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"cc . a = ce . a ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"cc . rgb *= bA ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PARTICLES_SHADELESS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ch = u_diffuse_intensity * cc . rgb ; vec3 cm = u_emit * cc . rgb ; vec3 Q = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logic_negative_expr",PLACES:1},"SKY_COLOR",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 cj = u_environment_energy * ci ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 cj = u_environment_energy * ci ( Q ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 ck = u_ambient * cj ; float cp = u_specular_params [ 0 ] ; vec2 cq = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 cr = cp * u_specular_color ; vec3 aK ; vec3 cs ; ct ( cm , ck , ch , cr , c , Q , u , cq , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , aK , cs ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 aK = cc . rgb ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float L = cc . a * cD ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA_CLIP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( L < 0.5 ) discard ; L = 1.0 ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bx ( aK , length ( d ) , u , 1.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SOFT_PARTICLES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float cx = - d . z / u_view_max_depth ; vec4 cy = GLSL_TEXTURE_PROJ ( u_scene_depth , h ) ; float cA = cz ( cy ) ; float cB = cA - cx ; float cC = u_view_max_depth / SOFT_STRENGTH * cB ; L = L * min ( cC , 1.0 ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["aQ","(","aK",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA","ALPHA_CLIP",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aR ( aK , L ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK , L ) ; }".split(" ")}]};a["proc_skybox.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},
{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; GLSL_IN vec3 da ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; const float db = 0.99 ; const float dc = 1.8 ; const int dd = 8 ; float di ( vec3 O , vec3 bj ) { float a = dot ( bj , bj ) ; float b = 2.0 * dot ( bj , O ) ; float de = dot ( O , O ) - 1.0 ; float df = b * b - 4.0 * a * de ; float dg = sqrt ( df ) ; float q = ( - b - dg ) / 2.0 ; float dh = de / q ; return dh ; } float dk ( float L , float g ) { float a = 3.0 * ( 1.0 - g * g ) ; float b = 2.0 * ( 2.0 + g * g ) ; float de = 1.0 + L * L ; float dj = pow ( 1.0 + g * g - 2.0 * g * L , 1.5 ) ; dj = max ( dj , 0.00001 ) ; return ( a / b ) * ( de / dj ) ; } float dq ( vec3 O , vec3 bj , float dl ) { float dm = dot ( bj , - O ) ; if ( dm < 0.0 ) { return 1.0 ; } vec3 dn = O + dm * bj ; if ( length ( dn ) < dl ) { return 0.0 ; } else if ( length ( dn ) >= dl ) { vec3 cF = normalize ( dn ) * dl - O ; float dp = acos ( dot ( normalize ( cF ) , bj ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( dp * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 dr ( float aG , vec3 aK , float aF ) { return aK - aK * pow ( u_sky_color , vec3 ( aF / aG ) ) ; } void main ( ) { vec3 ds = normalize ( da ) ; vec3 dt = u_sun_direction ; float L = dot ( ds , dt ) ; float du = dk ( L , - 0.01 ) * u_rayleigh_brightness * dt . z ; float dv = dk ( L - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - dt . z ) ; float dw = smoothstep ( 0.0 , 100.0 , dk ( L , 0.9995 ) ) * u_spot_brightness ; vec3 dx = vec3 ( 0.0 , 0.0 , db ) ; float dy = di ( dx , ds ) ; float dz = dy / float ( dd ) ; float dA = dq ( dx , ds , db - 0.3 ) ; vec3 dB = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 dC = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int bU = 0 ; bU < dd ; bU ++ ) { float dD = dz * float ( bU ) ; vec3 O = dx + ds * dD ; float dE = dq ( O , dt , db - 0.2 ) ; float dF = di ( O , dt ) ; vec3 dG = dr ( dF , vec3 ( dc ) , u_scatter_strength ) * dE ; dB += dr ( sqrt ( dD ) , u_sky_color * dG , u_rayleigh_strength ) ; dC += dr ( dD , dG , u_mie_strength ) ; } dB = dB * dA * pow ( dy , u_rayleigh_collection_power ) / float ( dd ) ; dC = ( dC * dA * pow ( dy , u_mie_collection_power ) ) / float ( dd ) ; vec3 aK = vec3 ( dw * dC + dv * dC + du * dB ) ; aQ ( aK ) ; GLSL_OUT_FRAG_COLOR = vec4 ( aK , 1.0 ) ; }".split(" ")}]};
a["shadow.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"SHADELESS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_MATRIX_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_MATRIX_INVERSE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_VIEW_MATRIX",TOKENS:["0"]},{TYPE:"var",NAME:"USE_MODEL_MATRIX",
TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",
NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LAMP_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_BLEND_TYPE",TOKENS:["TEXTURE_BLEND_TYPE_MIX"]},{TYPE:"var",NAME:"NUM_VALUES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_RGBS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"include",
FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec4 u_light_color_intensities [ NUM_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye_frag",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW","USE_VIEW_MATRIX",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","mat3","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3",
"u_model_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE",
"REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_cube_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},
{TYPE:"txt",TOKENS:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_refl_plane",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["USE_NODE_LAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_VALUE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_RGB"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform sampler2D u_colormap0 ; uniform float u_alpha_factor ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["uniform","vec4","u_diffuse_color",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_pcf_blur_radii",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec4 u_csm_center_dists ; uniform PRECISION GLSL_SMPLR2D_SHDW u_shadow_map0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map2",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","GLSL_SMPLR2D_SHDW","u_shadow_map3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION",
"USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_CURVE_VEC","USE_NODE_CURVE_RGB","USE_NODE_VALTORGB",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_nodes_texture",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","c",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","f",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","n",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","d",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","l",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","m",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES",
"ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","i",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","o",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["SHADELESS",{TYPE:"logic_negative_expr",PLACES:1},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"shadow.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslf"}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 u = u_camera_eye_frag - c ; vec3 v = normalize ( u ) ; vec3 A ; vec3 B ; vec3 C ; vec4 D ; float E ; mat3 F = mat3 ( 0.0 ) ; mat3 G = mat3 ( 0.0 ) ; mat3 H = mat3 ( 0.0 ) ; mat3 I = mat3 ( 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_GEOMETRY_VW",
"USE_VIEW_MATRIX",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["F","=","u_view_tsr_frag",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_VIEW_MATRIX_INVERSE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["G","=","u_view_tsr_inverse",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["H","=","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_MODEL_MATRIX_INVERSE"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["I","=","u_model_tsr_inverse",";"]}]}}]},{TYPE:"txt",TOKENS:"J ( v , F , G , H , I , A , B , C , D , E ) ; float L = E ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float L = ( GLSL_TEXTURE ( u_colormap0 , n ) ) . a ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{TYPE:"equal_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float M = u_alpha_factor * L ; M += ( 1.0 - step ( 0.0 , M ) ) ; L = mix ( M , 1.0 , u_diffuse_color . a ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float L = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:"if ( L < 0.5 ) discard ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","NO_SHADOWS",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",
PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = dH ( d . z ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR . a *= clamp ( f . r , 0.999999999 , 1.0 ) ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:["}"]}]};a["shadow.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN",TOKENS:["0"]},
{TYPE:"var",NAME:"USE_INSTANCED_PARTCLS",TOKENS:["0"]},{TYPE:"var",NAME:"NODES",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"SMAA_JITTER",TOKENS:["0"]},{TYPE:"var",NAME:"MAC_OS_SHADOW_HACK",TOKENS:["0"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"AU_QUALIFIER",TOKENS:["GLSL_IN"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",
NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"HAIR_BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_TEX_RES",TOKENS:["2048.0"]},{TYPE:"var",NAME:"VERTEX_ANIM",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"TEXTURE_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"VERTEX_ANIM_MIX_NORMALS_FACTOR",TOKENS:["u_va_frame_factor"]},{TYPE:"var",
NAME:"MAX_BONES",TOKENS:["0"]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_PRES_GLOB_ORIENTATION",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",
FILE:"to_world.glslv"},{TYPE:"include",FILE:"scale_texcoord.glslv"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"CALC_TBN",{TYPE:"logical_or_expr",PLACES:8}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN",
"vec4","a_tbn_quat",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec4 a_part_ts ; GLSL_IN vec4 a_part_r ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_shade_tangs",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_influence",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN",
"float","a_bending_col_main",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_emitter_center",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position_next",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",
{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","a_tbn_quat_next",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","c",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["GLSL_OUT","vec4","f",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","n",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","d",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","j",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","k",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},
{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","l",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","m",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","i",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3",
"o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS","BILLBOARD",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_camera_eye",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_shadow_cast_billboard_view_tsr",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_va_frame_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logic_negative_expr",PLACES:1},"TEXTURE_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec3","u_texture_scale",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_normal_offset",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform mat3 u_v_light_tsr [ NUM_CAST_LAMPS ] ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_v_light_ts [ NUM_CAST_LAMPS ] ; uniform vec4 u_v_light_r [ NUM_CAST_LAMPS ] ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2","NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix2",
";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{TYPE:"include",FILE:"dynamic_grass.glslv"},{TYPE:"include",FILE:"shadow.glslv"},
{TYPE:"include",FILE:"skin.glslv"},{TYPE:"include",FILE:"wind_bending.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"nodes.glslv"}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { mat3 N = u_view_tsr ; vec3 O = a_position ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"USE_NODE_NORMAL_MAP","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:7}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 bC = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; vec3 Q = bC ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Q = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA","CALC_TBN_SPACE",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"vec3 R = P ( a_tbn_quat , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; vec3 S = sign ( a_tbn_quat [ 3 ] ) * cross ( Q , R ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = vec3 ( 0.0 ) ; vec3 S = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["VERTEX_ANIM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = mix ( O , a_position_next , u_va_frame_factor ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",
{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",{TYPE:"logical_or_expr",PLACES:5}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Y = P ( a_tbn_quat_next , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; Q = mix ( Q , Y , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"vec3 Z = P ( a_tbn_quat_next , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; vec3 _ = sign ( a_tbn_quat_next [ 3 ] ) * cross ( Y , Z ) ; R = mix ( R , Z , u_va_frame_factor ) ; S = mix ( S , _ , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ac ( O , R , S , Q ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_INSTANCED_PARTCLS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 T = mat3 ( a_part_ts [ 0 ] , a_part_ts [ 1 ] , a_part_ts [ 2 ] , a_part_ts [ 3 ] , a_part_r [ 0 ] , a_part_r [ 1 ] , a_part_r [ 2 ] , a_part_r [ 3 ] , 1.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = aS ( u_model_tsr , T ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","T","=","u_model_tsr",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",
{TYPE:"logical_or_expr",PLACES:3},"USE_INSTANCED_PARTCLS",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ad","=","au_center_pos",";"]}]}},{TYPE:"elif",EXPRESSION:["DYNAMIC_GRASS","USE_INSTANCED_PARTCLS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ad = a_part_ts . xyz ; O = ae ( T , O ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ad = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 V = normalize ( U ( T , bC ) ) ; vec3 W = cross ( vec3 ( 0.0 , 0.0 , 1.0 ) , V ) ; vec3 X = cross ( V , W ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","X","=","a_shade_tangs",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 X = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = aT ( O , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Q , ad , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , N ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 af = ae ( T , ad ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["HAIR_BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},"SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","dI","=","u_shadow_cast_billboard_view_tsr",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["mat3","dI","=","N",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",
PLACES:2},"USE_INSTANCED_PARTCLS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ah ( u_camera_eye , af , dI , T ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = ai ( u_camera_eye , af , dI ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND","BILLBOARD_JITTERED",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"T = aj ( u_wind , u_time , u_jitter_amp , u_jitter_freq , af , T ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"ak am = al ( O - ad , ad , vec3 ( 0.0 ) , X , vec3 ( 0.0 ) , Q , T ) ; am . ad = af ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ak am = al ( O , ad , vec3 ( 0.0 ) , X , vec3 ( 0.0 ) , Q , T ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3",
"ao","=","bC",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ao = vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"an ( am . O , am . ad , ao , mat4 ( 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"c = am . O ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","USE_NODE_NORMAL_MAP","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{TYPE:"logical_and_expr",PLACES:3},{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"e = am . Q ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float aq = ( dot ( cross ( am . Q , am . R ) , am . S ) < 0.0 ) ? - 1.0 : 1.0 ; f = vec4 ( am . R , aq ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"o = am . as ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:"vec4 bF = vec4 ( ae ( N , am . O ) , 1.0 ) ; vec4 at = u_proj_matrix * bF ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_JITTER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"at . xy += u_subpixel_jitter * at . w ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",
{TYPE:"equal_expr",PLACES:2},"USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"h = bG ( at ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"i = - bF . z / u_view_max_depth ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["J","(",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["TEXTURE_COLOR"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"n = ap ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bH ( am . O , am . Q ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"NODES","ALPHA",{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["d","=","bF",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_CASTING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 dJ = ( u_proj_matrix * vec4 ( N [ 0 ] , 1.0 ) ) . xy ; float dK = SHADOW_TEX_RES / 2.0 ; dJ = floor ( dJ * dK + 0.5 ) / dK - dJ ; at . xy += dJ ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","at",";","}"]}]};a["sky.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},
{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYREAL",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"var",NAME:"PROCEDURAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYPAPER",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},
{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"REFLECTION_PASS","REFL_PASS_NONE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_camera_eye_frag ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND",
"WO_SKYPAPER",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND","WO_SKYPAPER","WO_SKYTEX",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"sky_blending.glslf"}]}}]},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","da",";"]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","n",";"]}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec3 dL ; vec3 ds = normalize ( da ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND","WO_SKYPAPER",{TYPE:"logical_and_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","dM","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYREAL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dM = abs ( n . y ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dM = ( n . y + 1.0 ) * 0.5 ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 dN = u_horizon_color ; vec3 dO = u_zenith_color ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 dP = vec3 ( n , 0.0 ) ; vec4 dQ = GLSL_TEXTURE_CUBE ( u_sky , ds ) ; cb ( dQ . rgb ) ; dL = dR ( dN , dO , dQ , dM , dP ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dL = mix ( dN , dO , dM ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dL = GLSL_TEXTURE_CUBE ( u_sky , ds ) . rgb ; cb ( dL ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"REFLECTION_PASS","REFL_PASS_NONE",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float dS = WATER_LEVEL - u_camera_eye_frag . z ; vec3 dT = vec3 ( 0.0 ) ; vec3 dU = mix ( u_underwater_fog_color_density . rgb , dT , min ( - ds . z , 1.0 ) ) ; dU *= min ( 1.0 - min ( 0.03 * dS , 0.8 ) , 1.0 ) ; float aF = clamp ( sign ( 0.01 * dS - ds . z ) , 0.0 , 1.0 ) ; dL = mix ( dL , dU , aF ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"aQ ( dL ) ; GLSL_OUT_FRAG_COLOR = vec4 ( dL , 1.0 ) ; }".split(" ")}]};a["sky.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PROCEDURAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform mat4 u_sky_vp_inverse ; GLSL_IN vec3 a_position ; GLSL_OUT vec3 da ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",
{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","n",";"]}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { vec4 O = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 ds = u_sky_vp_inverse * O ; da = ds . xyz ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",
PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"n = a_position . xy ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","O",";","}"]}]};a["skybox.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PROCEDURAL_SKYDOME",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform mat4 u_cube_view_matrix ; GLSL_IN vec3 a_position ; GLSL_OUT vec3 da ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","n",";"]}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { vec4 O = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 ds = u_cube_view_matrix * O ; da = ds . xyz ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_SKYDOME",{TYPE:"logic_negative_expr",
PLACES:1},"WO_SKYTEX","WO_SKYBLEND",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"n = a_position . xy ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","O",";","}"]}]};a["tex_skybox.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"WO_SKYTEX",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYREAL",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYPAPER",TOKENS:["0"]},
{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; GLSL_IN vec3 da ; GLSL_IN vec2 n ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"sky_blending.glslf"}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { vec3 ds = normalize ( da ) ; vec3 dL ; float dM = 0.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYPAPER"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dL = GLSL_TEXTURE_CUBE ( u_sky_texture , ds ) . xyz ; cb ( dL ) ;".split(" ")}]}},{TYPE:"else",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dL = vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float L = acos ( ds . z ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYREAL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dM = abs ( L * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dM = 1.0 - L * INV_PI ;".split(" ")}]}}]}]}}]},
{TYPE:"txt",TOKENS:"vec3 dN = u_horizon_color ; vec3 dO = u_zenith_color ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYTEX"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 dQ = GLSL_TEXTURE_CUBE ( u_sky_texture , ds ) ; cb ( dQ . rgb ) ; vec3 dP = vec3 ( da . xy , 0.0 ) ; dL = dR ( dN , dO , dQ , dM , dP ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dL = mix ( dN , dO , dM ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["dL","=","dN",";"]}]}}]}]}}]}]}}]},{TYPE:"txt",TOKENS:"aQ ( dL ) ; GLSL_OUT_FRAG_COLOR = vec4 ( dL , 1.0 ) ; }".split(" ")}]};a["water.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"NORM_FOAM0",TOKENS:["0"]},{TYPE:"var",NAME:"NORM_FOAM1",TOKENS:["0"]},{TYPE:"var",NAME:"NORM_FOAM2",
TOKENS:["0"]},{TYPE:"var",NAME:"NORM_FOAM3",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_WIREFRAME",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_NORMALMAPS",TOKENS:["0"]},{TYPE:"var",NAME:"FOAM",TOKENS:["0"]},{TYPE:"var",NAME:"SHORE_PARAMS",TOKENS:["0"]},{TYPE:"var",NAME:"GENERATED_MESH",TOKENS:["0"]},{TYPE:"var",NAME:"ABSORB",TOKENS:["6.0"]},{TYPE:"var",NAME:"SSS_STRENGTH",TOKENS:["1.0"]},{TYPE:"var",NAME:"SSS_WIDTH",TOKENS:["0.45"]},{TYPE:"var",NAME:"ALPHA",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},
{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"WAVES_HEIGHT",TOKENS:["1.0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"var",NAME:"SHORE_SMOOTHING",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC",TOKENS:["0"]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",
TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"REFL_BUMP",TOKENS:["0.001"]},{TYPE:"define",NAME:"REFR_BUMP",TOKENS:["0.0005"]},{TYPE:"txt",TOKENS:["uniform","float","u_time",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_sky_texture",";"]}]}},{TYPE:"elif",EXPRESSION:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["uniform","float","u_environment_energy",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec4 u_light_color_intensities [ NUM_LIGHTS ] ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",
PLACES:1},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_cam_water_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_color_density",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_underwater_fog_color_density",
";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat4","u_cube_fog",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_refractmap",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_plane_reflection",";"]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","samplerCube","u_mirrormap",";"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_foam",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_normalmap1_scale",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_normalmap2_scale",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_mirror_factor",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:["uniform","float","u_reflect_factor",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_view_max_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_refr_bump",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const float ay = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"GLSL_IN vec3 bz ; GLSL_IN vec3 c ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","n",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec3 f ; GLSL_IN vec3 dV ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC","NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH","DYNAMIC",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","dW",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","dX",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",
PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","ax",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","o",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"include",FILE:"environment.glslf"},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"refraction.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"fog.glslf"}]}}]},{TYPE:"txt",TOKENS:"vec3 eh ( in vec2 dY , in vec3 Q , in vec3 u , in vec3 dZ , out float d_ ) { d_ = 0.0 ; vec3 ea = reflect ( - u , Q ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 eb = dY . xy + Q . xy * REFL_BUMP / i ; d_ = u_reflect_factor ; vec3 ec ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},"WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ec = u_underwater_fog_color_density . rgb ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ec = u_diffuse_color . rgb ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} else { ec = GLSL_TEXTURE ( u_plane_reflection , eb ) . rgb ; cb ( ec ) ; }".split(" ")}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"d_ = u_mirror_factor ; vec3 ec = dZ * GLSL_TEXTURE_CUBE ( u_mirrormap , ea ) . rgb ; cb ( ec ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"d_ = u_reflect_factor ; vec3 ec = dZ * vec3 ( 0.3 , 0.5 , 1.0 ) ; cb ( ec ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 ed = normalize ( ea + u ) ; float ee = 1.0 - dot ( u , ed ) ; float ef = u_fresnel_params [ 3 ] ; float eg = u_fresnel_params [ 2 ] ; float r = ef + ( 1.0 - ef ) * pow ( ee , eg ) ; d_ = min ( d_ * r , 1.0 ) ; return ec ; }".split(" ")},{TYPE:"include",FILE:"lighting_nodes.glslf"},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",
0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 bK = mat3 ( f , dV , e ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Q = normalize ( e ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","Q","=","UP_VECTOR",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC","FOAM",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float bu = c . z - WATER_LEVEL ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float bu = c . z ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 bI = vec2 ( dW . x , - dW . y ) + 0.5 ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 bI = vec2 ( c . x , - c . y ) + 0.5 ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec2","bI","=","n",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ei = vec3 ( 0.0 ) ; vec3 ej = GLSL_TEXTURE ( u_normalmap0 , bI * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; ei += ej ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ek = vec3 ( 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORM_FOAM0"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ek","+=","ej",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ej = GLSL_TEXTURE ( u_normalmap0 , bI * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; ei += ej ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORM_FOAM1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ek","+=","ej",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ej = GLSL_TEXTURE ( u_normalmap0 , bI * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; ei += ej ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORM_FOAM2"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ek","+=","ej",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ej = GLSL_TEXTURE ( u_normalmap0 , bI * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; ei += ej ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NORM_FOAM3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["ek","+=","ej",";"]}]}}]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 el = bK * ek ; if ( ! em ( el , vec3 ( 0.0 ) ) ) el = normalize ( el ) ; vec3 en = mix ( Q , el , 0.2 ) ; en = normalize ( en ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Q = mix ( Q , normalize ( bK * ei ) , 0.3 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Q = mix ( Q , normalize ( bK * ei ) , 0.5 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"Q = normalize ( Q ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 u = normalize ( bz ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},
"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 dY = h . xy / h . z ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 eo = dY + Q . xy * u_refr_bump / i ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float L = u_diffuse_color . a ; vec4 cy = GLSL_TEXTURE_PROJ ( u_scene_depth , h ) ; float cA = cz ( cy ) ; float cB = max ( cA - i , 0.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float eq = ep ( cA , eo , dY ) ; float er = max ( eq - i , 0.0 ) ; float es = u_view_max_depth / ABSORB * er ; float et = min ( L * es , 1.0 ) ; L = min ( 15.0 * L * u_view_max_depth * cB , 1.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float cC = u_view_max_depth / ABSORB * cB ; if ( u_cam_water_depth > 0.0 ) L = min ( L * cC , 1.0 ) ;".split(" ")}]}}]}]}},{TYPE:"else",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float L = u_diffuse_color . a ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","et","=","L",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( u_cam_water_depth < 0.0 ) et = 0.0 ; vec3 eu = GLSL_TEXTURE ( u_refractmap , eo ) . rgb ; cb ( eu ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float ev = pow ( min ( dX . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 cc = mix ( u_shallow_water_col , u_diffuse_color . rgb , ev ) ; ev = pow ( min ( dX . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; cc = mix ( u_shore_water_col , cc , ev ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 cc = u_diffuse_color . rgb ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float ew = max ( 1.0 - u_view_max_depth * cB , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float ew = 1.0 - L ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float ex = max ( bu / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"vec3 ey = normalize ( vec3 ( dX . rg , 0.0 ) ) ; vec3 ez = normalize ( mix ( UP_VECTOR , ey , 0.8 ) ) ; float eA = 1.25 * max ( dot ( en , ez ) - 0.2 , 0.0 ) ; eA += max ( dot ( en , - UP_VECTOR ) , 0.0 ) ; ew += eA * ( 1.0 - dX . b ) ; ex *= ( 1.0 - 0.95 * pow ( dX . b , 0.1 ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"ew += ex ; ew = min ( u_foam_factor * ew , 1.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec4 eB = GLSL_TEXTURE ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + bI * u_foam_scale ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"float cp = u_specular_params [ 0 ] ; vec2 cq = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 cr = cp * u_specular_color ; vec3 cj = u_environment_energy * ci ( Q ) ; vec3 ck = u_ambient * cj ; vec3 dZ = ck + u_sun_intensity ; float d_ ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ec = eh ( dY , Q , u , dZ , d_ ) ;".split(" ")}]}},{TYPE:"else",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ec = eh ( vec2 ( 0.0 ) , Q , u , dZ , d_ ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 ch = u_diffuse_intensity * cc ; vec3 aK ; vec3 cs ; ct ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ch , cr , c , Q , u , cq , u_diffuse_params , vec4 ( 1.0 ) , 0.0 , vec4 ( 0.0 ) , aK , cs ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float eC = max ( dot ( u_sun_direction , - e ) + SSS_WIDTH , 0.0 ) * max ( dot ( - u , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; eC = clamp ( SSS_STRENGTH * eC , 0.0 , 1.0 ) ; aK = mix ( aK , u_shallow_water_col , eC ) ; aK = mix ( aK , u_shore_water_col , eC ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aK = mix ( eu , aK , et ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"aK = mix ( aK , ec , d_ ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float eD = mix ( eB . g , eB . r , max ( 4.0 * ( ew - 0.75 ) , 0.0 ) ) ; eD = mix ( eB . b , eD , max ( 2.0 * ew - 1.0 , 0.0 ) ) ; eD = mix ( 0.0 , eD , ew ) ; aK = mix ( aK , dZ , eD ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["aK","+=","cs",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float eE = i * u_view_max_depth ; float eF = 1.0 ; if ( u_cam_water_depth > 1.0 ) eF = 2.0 ; bx ( aK , eE , u , eF ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["aQ","(","aK",")",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE",{TYPE:"logic_negative_expr",PLACES:1}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"L = max ( L , cs . r ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOAM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","+=","eD",";"]}]}}]}]}},{TYPE:"elif",EXPRESSION:["SHORE_SMOOTHING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["L","=","1.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aR ( aK , L ) ;".split(" ")}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"extension",TOKENS:["GL_OES_standard_derivatives",":","enable"]}]}}]},{TYPE:"txt",TOKENS:"vec3 aH = fwidth ( ax ) ; vec3 aI = smoothstep ( vec3 ( 0.0 ) , aH * ay , ax ) ; float eG = min ( min ( aI . x , aI . y ) , aI . z ) ; eG = clamp ( eG , 0.0 , 1.0 ) ; aK = mix ( u_wireframe_edge_color , aK , eG ) ; L = mix ( 1.0 , L , eG ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["DEBUG_WIREFRAME",2,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 aG = sign ( ax - vec3 ( 0.02 * ay ) ) ; float eG = 1.0 ; if ( aG . x < 0.0 || aG . y < 0.0 || aG . z < 0.0 ) eG = 0.0 ; aK = mix ( u_wireframe_edge_color , aK , eG ) ; L = mix ( 1.0 , L , eG ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK , L ) ; }".split(" ")}]};a["water.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",
NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"USE_TBN_SHADING",TOKENS:["0"]},{TYPE:"var",NAME:"DEBUG_WIREFRAME",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_NORMALMAPS",TOKENS:["0"]},{TYPE:"var",NAME:"FOAM",TOKENS:["0"]},{TYPE:"var",NAME:"SHORE_PARAMS",TOKENS:["0"]},{TYPE:"var",NAME:"MAX_SHORE_DIST",TOKENS:["100.0"]},{TYPE:"var",NAME:"SHORE_MAP_SIZE_X",TOKENS:["1.0"]},{TYPE:"var",NAME:"SHORE_MAP_SIZE_Y",TOKENS:["1.0"]},{TYPE:"var",NAME:"SHORE_MAP_CENTER_X",TOKENS:["0.0"]},{TYPE:"var",NAME:"SHORE_MAP_CENTER_Y",
TOKENS:["0.0"]},{TYPE:"var",NAME:"GENERATED_MESH",TOKENS:["0"]},{TYPE:"var",NAME:"DST_NOISE_SCALE_0",TOKENS:["0.05"]},{TYPE:"var",NAME:"DST_NOISE_SCALE_1",TOKENS:["0.03"]},{TYPE:"var",NAME:"DST_NOISE_FREQ_0",TOKENS:["1.3"]},{TYPE:"var",NAME:"DST_NOISE_FREQ_1",TOKENS:["1.0"]},{TYPE:"var",NAME:"DIR_MIN_SHR_FAC",TOKENS:["0.4"]},{TYPE:"var",NAME:"DIR_FREQ",TOKENS:["0.5"]},{TYPE:"var",NAME:"DIR_NOISE_SCALE",TOKENS:["0.05"]},{TYPE:"var",NAME:"DIR_NOISE_FREQ",TOKENS:["0.07"]},{TYPE:"var",NAME:"DIR_MIN_NOISE_FAC",
TOKENS:["0.5"]},{TYPE:"var",NAME:"DST_MIN_FAC",TOKENS:["0.2"]},{TYPE:"var",NAME:"WAVES_HOR_FAC",TOKENS:["5.0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WAVES_HEIGHT",TOKENS:["1.0"]},{TYPE:"var",NAME:"WAVES_LENGTH",TOKENS:["10.0"]},{TYPE:"var",NAME:"WATER_LEVEL",TOKENS:["0.0"]},{TYPE:"var",NAME:"SHORE_SMOOTHING",TOKENS:["0"]},{TYPE:"var",NAME:"DYNAMIC",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",
NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"include",FILE:"procedural.glslf"},{TYPE:"txt",TOKENS:["GLSL_IN","vec3","a_position",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"DYNAMIC",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN",
"vec4","a_tbn_quat",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1},"NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_texcoord",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","float","a_polyindex",";"]}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT vec3 bz ; GLSL_OUT vec3 c ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","n",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT vec3 f ; GLSL_OUT vec3 dV ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["DYNAMIC","NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","e",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2},"GENERATED_MESH","DYNAMIC",{TYPE:"logical_and_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","dW",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","dX",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","h",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",
PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","float","i",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","ax",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_TBN_SHADING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec3","o",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["STATIC_BATCH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"const mat3 u_model_tsr = mat3 ( 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","mat3","u_model_tsr",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform mat3 u_view_tsr ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 eN ( in vec2 eH ) { vec2 eI = 0.5 + vec2 ( ( eH . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , ( eH . y - SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 eJ = GLSL_TEXTURE ( u_shore_dist_map , eI ) ; const vec2 eK = vec2 ( 1.0 / 255.0 , 1.0 ) ; float eL = dot ( eJ . ba , eK ) ; vec2 eM = normalize ( eJ . rg * 2.0 - 1.0 ) ; return vec3 ( eM , eL ) ; }".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",
NAME:"SMALL_WAVES_FAC",TOKENS:["0.3"]},{TYPE:"txt",TOKENS:"void fb ( inout vec3 eH , in float eO , in vec3 eJ ) { float eQ = eP ( DST_NOISE_SCALE_0 * ( eH . xy + DST_NOISE_FREQ_0 * eO ) ) * eP ( DST_NOISE_SCALE_1 * ( eH . yx - DST_NOISE_FREQ_1 * eO ) ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float eR = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float eL = eJ . b ; float eS = sqrt ( eL ) ; float eT = max ( eL , DIR_MIN_SHR_FAC ) * sin ( eS / eR + DIR_FREQ * eO ) ; float eU = max ( eP ( DIR_NOISE_SCALE * ( eH . xy + DIR_NOISE_FREQ * eO ) ) , DIR_MIN_NOISE_FAC ) ; eT *= eU ; float eV = WAVES_HEIGHT * mix ( eT , eQ , max ( eS , DST_MIN_FAC ) ) ; vec2 eM = eJ . rg ; float eW = WAVES_HOR_FAC * eT * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - eL ) , 0.0 ) ; vec2 eX = eW * eM ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float eV = WAVES_HEIGHT * eQ ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 eY = 2.0 * ( eH . xy - 0.1 * eO ) ; vec2 eZ = 1.3 * ( eH . yx + 0.03 * eO ) ; float fa = e_ ( 0.5 * eY ) . x + e_ ( 0.5 * eZ ) . x - 1.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"eH . xy += eX ; fa *= eL ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"eV += SMALL_WAVES_FAC * fa ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"eH . z += eV ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEBUG_WIREFRAME"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( a_polyindex == 0.0 ) ax = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) ax = vec3 ( 0.0 , 0.0 , 1.0 ) ; else ax = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 O = a_position ; float fc = abs ( O . z ) ; vec2 fd = u_camera_eye . xy - mod ( u_camera_eye . xy , fc ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O . z = WATER_LEVEL ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O . z = 0.0 ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"O . xy += fd ; vec3 bD = O ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["n","=","a_texcoord",";"]}]}}]},{TYPE:"txt",TOKENS:"ak am = al ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_tsr ) ; vec3 bD = am . O ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dX = eN ( bD . xy ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float fe = length ( u_wind ) ; float ff = u_time ; ff *= fe ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float fg = fc ; vec3 fh = bD + vec3 ( fg , 0.0 , 0.0 ) ; vec3 fi = bD + vec3 ( 0.0 , fg , 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2},"FOAM",{TYPE:"logical_or_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["dW","=","bD",";"]}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 fh = bD + vec3 ( 0.05 , 0.0 , 0.0 ) ; vec3 fi = bD + vec3 ( 0.0 , 0.05 , 0.0 ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_PARAMS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 fj = eN ( fh . xy ) ; vec3 fk = eN ( fi . xy ) ; fb ( fh , ff , fj ) ; fb ( fi , ff , fk ) ; fb ( bD , ff , dX ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"fb ( fh , ff , vec3 ( 0.0 ) ) ; fb ( fi , ff , vec3 ( 0.0 ) ) ; fb ( bD , ff , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GENERATED_MESH","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( a_position . z < 0.0 ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bD . z = WATER_LEVEL - 1.0 ;".split(" ")}]}},{TYPE:"else",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"bD . z = - 1.0 ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"fh . z = bD . z ; fi . z = bD . z ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 fl = normalize ( fh - bD ) ; vec3 R = normalize ( fi - bD ) ; e = normalize ( cross ( fl , R ) ) ; float fm = dot ( e , UP_VECTOR ) ; float aF = clamp ( 0.8 - fm , 0.0 , 1.0 ) ; e = mix ( e , UP_VECTOR , aF ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_NORMALMAPS",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 R = P ( a_tbn_quat , vec3 ( 1.0 , 0.0 , 0.0 ) ) ; e = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"f = R ; dV = cross ( e , f ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"c = bD ; bz = u_camera_eye - bD ; vec4 bF = vec4 ( ae ( u_view_tsr , bD ) , 1.0 ) ; vec4 at = u_proj_matrix * bF ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float au = at . x ; float av = at . y ; float aw = at . w ; h . x = ( au + aw ) / 2.0 ; h . y = ( av + aw ) / 2.0 ; h . z = aw ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","DISABLE_FOG",{TYPE:"logic_negative_expr",
PLACES:1},{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"i = - bF . z / u_view_max_depth ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["gl_Position","=","at",";","}"]}]};a["postprocessing/antialiasing.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"AA_METHOD",TOKENS:["AA_METHOD_FXAA_LIGHT"]},{TYPE:"var",NAME:"AA_QUALITY",TOKENS:["AA_QUALITY_LOW"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",
FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_REDUCE_MIN",TOKENS:["(","1.0","/","128.0",")"]},{TYPE:"define",NAME:"FXAA_REDUCE_MUL",TOKENS:["(","1.0","/","8.0",")"]},{TYPE:"define",NAME:"FXAA_SPAN_MAX",TOKENS:["8.0"]},{TYPE:"txt",
TOKENS:"vec4 fo ( float x , float y ) { vec2 fn = n + vec2 ( x , y ) * u_texel_size ; return GLSL_TEXTURE ( u_color , fn ) ; } vec4 fH ( ) { vec4 fp = fo ( - 1.0 , - 1.0 ) ; vec4 fq = fo ( 1.0 , - 1.0 ) ; vec4 fr = fo ( - 1.0 , 1.0 ) ; vec4 fs = fo ( 1.0 , 1.0 ) ; vec4 ft = fo ( 0.0 , 0.0 ) ; float fv = fu ( ft ) ; float fw = fu ( fp ) ; float fx = fu ( fq ) ; float fy = fu ( fr ) ; float fz = fu ( fs ) ; float fA = min ( fv , min ( min ( fw , fx ) , min ( fy , fz ) ) ) ; float fB = max ( fv , max ( max ( fw , fx ) , max ( fy , fz ) ) ) ; vec2 bj ; bj . x = - ( ( fw + fx ) - ( fy + fz ) ) ; bj . y = ( ( fw + fy ) - ( fx + fz ) ) ; float fC = max ( ( fw + fx + fy + fz ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float fD = 1.0 / ( min ( abs ( bj . x ) , abs ( bj . y ) ) + fC ) ; bj = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , bj * fD ) ) * u_texel_size ; vec4 fE = 0.5 * ( GLSL_TEXTURE ( u_color , n + bj * ( 1.0 / 3.0 - 0.5 ) ) + GLSL_TEXTURE ( u_color , n + bj * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 fF = fE * 0.5 + 0.25 * ( GLSL_TEXTURE ( u_color , n + bj * - 0.5 ) + GLSL_TEXTURE ( u_color , n + bj * 0.5 ) ) ; float fG = fu ( fF ) ; if ( ( fG < fA ) || ( fG > fB ) ) return fE ; else return fF ; }".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GREEN_AS_LUMA",TOKENS:["1"]},{TYPE:"include",FILE:"fxaa.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_QUALITY","AA_QUALITY_HIGH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["39"]},{TYPE:"define",NAME:"FXAA_QUALITY_SUBPIX",TOKENS:["1.00"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD",
TOKENS:["0.063"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",TOKENS:["0.0312"]}]}},{TYPE:"elif",EXPRESSION:["AA_QUALITY","AA_QUALITY_MEDIUM",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["20"]},{TYPE:"define",NAME:"FXAA_QUALITY_SUBPIX",TOKENS:["0.65"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD",TOKENS:["0.166"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",TOKENS:["0.0625"]}]}},{TYPE:"elif",EXPRESSION:["AA_QUALITY",
"AA_QUALITY_LOW",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["12"]},{TYPE:"define",NAME:"FXAA_QUALITY_SUBPIX",TOKENS:["0.50"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD",TOKENS:["0.166"]},{TYPE:"define",NAME:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",TOKENS:["0.0833"]}]}}]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = fH ( ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 fI = u_texel_size ; GLSL_OUT_FRAG_COLOR = fJ ( n , u_color , fI , FXAA_QUALITY_SUBPIX , FXAA_QUALITY_EDGE_THRESHOLD , FXAA_QUALITY_EDGE_THRESHOLD_MIN ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]};a["postprocessing/bloom_blur.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},
{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec2 fb = vec2 ( 0.0 , 0.0 ) ; vec2 cB = u_texel_size ; vec4 fK = GLSL_TEXTURE ( u_color , n ) ; GLSL_OUT_FRAG_COLOR = fK * 0.0875447373698 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0858112354248 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0858112354248 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0808139781061 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0808139781061 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0731235112908 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0731235112908 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0635705267419 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0635705267419 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0530985673112 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0530985673112 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0426125984122 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0426125984122 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0328565115809 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0328565115809 ; fb += cB ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n + fb ) * 0.0243407024472 ; GLSL_OUT_FRAG_COLOR += GLSL_TEXTURE ( u_color , n - fb ) * 0.0243407024472 ; GLSL_OUT_FRAG_COLOR = max ( 0.7 * fK , GLSL_OUT_FRAG_COLOR ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 fL = GLSL_TEXTURE ( u_main , n ) ; vec4 fM = GLSL_TEXTURE ( u_bloom , n ) ; GLSL_OUT_FRAG_COLOR = fL + fM ; }".split(" ")}]};a["postprocessing/coc.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",
TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"COC_TYPE",TOKENS:["COC_ALL"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_color ; uniform sampler2D u_depth ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_COMBINE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_coc_fg",";"]}]}}]},{TYPE:"txt",TOKENS:"uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front_start ; uniform float u_dof_front_end ; uniform float u_dof_rear_start ; uniform float u_dof_rear_end ; uniform vec2 u_camera_range ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 aK = GLSL_TEXTURE ( u_color , n ) ; if ( u_dof_dist > 0.0 ) { float fO = fN ( u_depth , n , u_camera_range ) ; fO *= u_view_max_depth ; float fP = 0.0 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_COMBINE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 fQ = GLSL_TEXTURE ( u_coc_fg , n ) ; float fR = fQ . a ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"if ( fO < u_dof_dist ) fP = ( u_dof_dist - fO - u_dof_front_start ) / ( u_dof_front_end - u_dof_front_start ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_FOREGROUND",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"else fP = ( fO - u_dof_dist - u_dof_rear_start ) / ( u_dof_rear_end - u_dof_rear_start ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"fP = clamp ( fP , 0.0 , 1.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_COMBINE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"fP = max ( fP , fR ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COC_TYPE","COC_FOREGROUND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( fP ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( aK . xyz * fP , fP ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} else GLSL_OUT_FRAG_COLOR = vec4 ( aK . xyz , 0.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},
{TYPE:"txt",TOKENS:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 fS = GLSL_TEXTURE ( u_color , n ) ; vec3 aK = fS . rgb ; if ( u_brightness < 0.0 ) aK = aK * ( 1.0 + u_brightness ) ; else aK = aK + ( ( 1.0 - aK ) * u_brightness ) ; aK = ( aK - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * M_PI_4 ) ) + 0.5 ; aK *= u_exposure ; float dc = fu ( vec4 ( aK , 0.0 ) ) ; aK = mix ( vec3 ( dc ) , aK , u_saturation ) ; GLSL_OUT_FRAG_COLOR = vec4 ( aK , fS . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { GLSL_OUT_FRAG_COLOR = fT ( clamp ( fN ( u_depth , n , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};
a["postprocessing/dof.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"DOF_TYPE",TOKENS:["DOF_SIMPLE"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOF_TYPE","DOF_BOKEH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform highp sampler2D u_sharp ; uniform highp sampler2D u_blurred1 ; uniform highp sampler2D u_blurred2 ; uniform float u_dof_dist ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front_end ; uniform float u_dof_rear_end ; uniform vec2 u_camera_range ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 fU = GLSL_TEXTURE ( u_sharp , n ) ; if ( u_dof_dist > 0.0 ) {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOF_TYPE","DOF_BOKEH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float fP ; vec4 fV = GLSL_TEXTURE ( u_blurred1 , n ) ; vec4 fW = GLSL_TEXTURE ( u_blurred2 , n ) ; vec4 fX = min ( fV . rgba , fW . rgba ) ; fP = fX . a ; if ( fP > 0.0 ) { fX = vec4 ( fX . rgb / fP , fU . a ) ; GLSL_OUT_FRAG_COLOR = mix ( fU , fX , min ( fP * 5.0 , 1.0 ) ) ; } else GLSL_OUT_FRAG_COLOR = fU ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["DOF_TYPE",
"DOF_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float fO = fN ( u_depth , n , u_camera_range ) ; fO *= u_view_max_depth ; float fY ; if ( fO < u_dof_dist ) fY = ( u_dof_dist - fO ) / u_dof_front_end ; else fY = ( fO - u_dof_dist ) / u_dof_rear_end ; fY = clamp ( fY , 0.0 , 1.0 ) ; vec4 fZ = GLSL_TEXTURE ( u_blurred , n ) ; GLSL_OUT_FRAG_COLOR = mix ( fU , fZ , fY ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR",
"=","fU",";"]}]}}]},{TYPE:"txt",TOKENS:"} else GLSL_OUT_FRAG_COLOR = fU ; }".split(" ")}]};a["postprocessing/glow.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 f_ = GLSL_TEXTURE ( u_src_color , n ) ; vec4 gc = GLSL_TEXTURE ( u_glow_mask_small , n ) ; vec4 gd = GLSL_TEXTURE ( u_glow_mask_large , n ) ; GLSL_OUT_FRAG_COLOR = f_ ; if ( gd . a != 0.0 ) { float ge = u_glow_mask_large_coeff * gd . a ; ge = clamp ( ge , 0.0 , 1.0 ) ; GLSL_OUT_FRAG_COLOR . rgb = mix ( GLSL_OUT_FRAG_COLOR . rgb , gd . rgb / gd . a , ge ) ; GLSL_OUT_FRAG_COLOR . a = mix ( GLSL_OUT_FRAG_COLOR . a , 1.0 , ge ) ; } if ( gc . a != 0.0 ) { float gf = u_glow_mask_small_coeff * gc . a ; gf = clamp ( gf , 0.0 , 1.0 ) ; GLSL_OUT_FRAG_COLOR . rgb = mix ( GLSL_OUT_FRAG_COLOR . rgb , gc . rgb / gc . a , gf ) ; GLSL_OUT_FRAG_COLOR . a = mix ( GLSL_OUT_FRAG_COLOR . a , 1.0 , gf ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"DEPTH_RGBA",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"STEPS_PER_PASS",TOKENS:["10.0"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"include",FILE:"procedural.glslf"},
{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","vec2","u_camera_range",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN float gh ; GLSL_IN vec2 gi ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"GLSL_IN vec2 n ; GLSL_IN vec4 gj ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec2 cB = ( gj . xy - n ) ; float aG = length ( cB ) ; vec2 gk = u_radial_blur_step * cB / aG ; float gl = aG / u_radial_blur_step ; gk *= min ( gl , STEPS_PER_PASS ) / STEPS_PER_PASS ; gl = max ( gl , STEPS_PER_PASS ) ; vec2 gm = n ; float gn = 0.0 ; const int go = int ( STEPS_PER_PASS ) ; int gp = int ( gl + 0.5 ) ; for ( int bU = 0 ; bU < go ; bU += 1 ) { if ( bU <= gp ) {".split(" ")},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float fO = fN ( u_input , gm , u_camera_range ) ; gn += max ( ( 1.0 - pow ( aG , 0.3 ) ) * step ( 0.9 , fO ) , 0.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 gq = GLSL_TEXTURE ( u_input , gm ) ; gn += cz ( gq ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} gm += gk ; }".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 bI = n + gi ; float gs = e_ ( vec2 ( 2.5 * ( bI . x ) , 2.5 * ( bI . y ) + 1.0 * u_time ) ) . x + 0.75 * e_ ( vec2 ( 5.0 * ( bI . x ) - 0.66 * u_time , 5.0 * ( bI . y ) + 0.66 * u_time ) ) . x + 0.5 * eP ( vec2 ( 7.5 * ( bI . x ) + 0.33 * u_time , 7.5 * ( bI . y ) - 0.33 * u_time ) ) ; gs *= clamp ( 1.2 - sqrt ( 0.2 * aG ) , 0.0 , 1.0 ) * gh ; gn = max ( gs , gn ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = fT ( gn / STEPS_PER_PASS ) ; }".split(" ")}]};
a["postprocessing/god_rays.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"DEPTH_RGBA",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:"uniform mat4 u_view_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["GLSL_IN","vec2","a_bb_vertex",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA","WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT float gh ; GLSL_OUT vec2 gi ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"GLSL_OUT vec2 n ; GLSL_OUT vec4 gj ; void main ( ) { n = a_bb_vertex ; vec3 bj = normalize ( u_sun_direction ) ; gj = u_view_proj_matrix * vec4 ( bj , 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DEPTH_RGBA",
"WATER_EFFECTS",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( u_cam_water_depth < 0.0 ) { gh = 1.0 ; vec3 gt = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 gu = P ( u_camera_quat , gt ) ; gu = normalize ( gu ) ; float gv = dot ( gu , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float gw = atan ( gu . x , gu . z ) ; gi = vec2 ( - gw , acos ( gv ) ) ; } else { gh = 0.0 ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"gj . xy = 0.5 * ( gj . xy / gj . w + 1.0 ) ; gj += 99999.0 * step ( gj . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy - 1.0 , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"SAFARI_CANVAS_ALPHA_HACK",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 gx = GLSL_TEXTURE ( u_main , n ) ; vec3 gy = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; cb ( gx . rgb ) ; float gz = cz ( GLSL_TEXTURE ( u_god_rays , n ) ) ; vec3 gA = gx . rgb + u_god_rays_intensity * vec3 ( gz ) * gy ; aQ ( gA ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SAFARI_CANVAS_ALPHA_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( gA , max ( 0.01 , gx . a ) ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( gA , gx . a ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]};a["postprocessing/luminance.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",
FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform sampler2D u_input ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 fL = GLSL_TEXTURE ( u_input , n ) ; float gB = dot ( fL . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; GLSL_OUT_FRAG_COLOR = vec4 ( vec3 ( gB ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",
TOKENS:"uniform sampler2D u_input ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { float gB ; float gC = 0.0 ; float w = 0.025 ; float bS = 0.025 ; for ( int bU = 0 ; bU < 20 ; bU += 1 ) { bS = 0.025 ; for ( int gD = 0 ; gD < 20 ; gD += 1 ) { gB = max ( GLSL_TEXTURE ( u_input , vec2 ( w , bS ) ) . r , 0.01 ) ; gC += log ( gB ) ; bS += 0.05 ; } w += 0.05 ; } float gE = exp ( gC / 400.0 ) ; GLSL_OUT_FRAG_COLOR = vec4 ( vec3 ( gE ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_trunced.glslf"]=
{TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; GLSL_IN vec2 n ; GLSL_IN float gF ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { float gE = GLSL_TEXTURE ( u_average_lum , vec2 ( 0.5 ) ) . r ; float gG = GLSL_TEXTURE ( u_luminance , n ) . r ; vec4 aK = GLSL_TEXTURE ( u_main , n ) ; float gH = gG / gE ; float gI = u_bloom_edge_lum ; GLSL_OUT_FRAG_COLOR = aK * max ( gH - gI , 0.0 ) * gF ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; GLSL_IN vec2 a_position ; GLSL_OUT vec2 n ; GLSL_OUT float gF ; void gQ ( in vec4 gJ , in vec3 gK , out vec3 gL ) { float gM = gJ . w * gK . x + gJ . y * gK . z - gJ . z * gK . y ; float gN = gJ . w * gK . y + gJ . z * gK . x - gJ . x * gK . z ; float gO = gJ . w * gK . z + gJ . x * gK . y - gJ . y * gK . x ; float gP = - gJ . x * gK . x - gJ . y * gK . y - gJ . z * gK . z ; gL . x = gM * gJ . w - gP * gJ . x - gN * gJ . z + gO * gJ . y ; gL . y = gN * gJ . w - gP * gJ . y - gO * gJ . x + gM * gJ . z ; gL . z = gO * gJ . w - gP * gJ . z - gM * gJ . y + gN * gJ . x ; } void main ( ) { n = 2.0 * a_position ; vec3 gu ; gQ ( u_camera_quat , UP_VECTOR , gu ) ; gF = dot ( - gu , u_sun_direction ) * u_bloom_key ; gF *= max ( sign ( u_sun_direction . z ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; float gR = 0.0042 ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 gS = GLSL_TEXTURE ( u_mb_tex_curr , n ) ; vec4 gT = GLSL_TEXTURE ( u_mb_tex_accum , n ) ; if ( length ( gS - gT ) > u_motion_blur_decay_threshold ) { vec4 gU = ( 1.0 - u_motion_blur_exp ) * gS + u_motion_blur_exp * gT ; vec4 gV = gU - gT ; vec4 gW = gS - gT ; vec4 cB = min ( max ( abs ( gV ) , vec4 ( gR ) ) , abs ( gW ) ) * sign ( gV ) ; GLSL_OUT_FRAG_COLOR = gT + cB ; } else { GLSL_OUT_FRAG_COLOR = gS ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 gX = GLSL_TEXTURE ( u_outline_src , n ) ; GLSL_OUT_FRAG_COLOR = gX ; if ( u_draw_outline != 0.0 ) { vec4 gY = GLSL_TEXTURE ( u_outline_mask , n ) ; vec4 gZ = GLSL_TEXTURE ( u_outline_mask_blurred , n ) ; float g_ = gZ . a - gY . a ; if ( g_ != 0.0 ) { float ha = smoothstep ( 0.0 , 1.0 , gZ . a ) ; if ( gY . a == 0.0 ) { vec3 hb = u_outline_color ; aQ ( hb ) ; vec4 hc = vec4 ( clamp ( hb , 0.0 , 1.0 ) , 1.0 ) ; GLSL_OUT_FRAG_COLOR = mix ( gX , hc , ha ) ; } } } }".split(" ")}]};
a["postprocessing/performance.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform sampler2D u_color ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { vec4 aK = vec4 ( 0.0 ) ; for ( int bU = 0 ; bU < 10 ; bU ++ ) { vec2 hd = vec2 ( fract ( n * vec2 ( bU ) * vec2 ( 1.431 , 3.921 ) ) ) ; aK += 0.01 * GLSL_TEXTURE ( u_color , hd ) ; } GLSL_OUT_FRAG_COLOR = aK ; }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"POST_EFFECT",TOKENS:["POST_EFFECT_NONE"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"uniform vec2 u_texel_size ; uniform sampler2D u_color ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform int u_tex_number ; uniform vec2 u_delta ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POST_EFFECT","POST_EFFECT_DOF_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","float","u_dof_bokeh_intensity",";"]}]}}]},{TYPE:"txt",TOKENS:"GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POST_EFFECT","POST_EFFECT_NONE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_color , n ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 de = GLSL_TEXTURE ( u_color , n ) ; GLSL_OUT_FRAG_COLOR . rgb = vec3 ( ( de . r + de . g + de . b ) / 3.0 ) ; GLSL_OUT_FRAG_COLOR . a = 1.0 ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 fb = vec2 ( 0.0 , 0.0 ) ; vec2 cB = u_texel_size ; vec4 aK ; aK = GLSL_TEXTURE ( u_color , n ) ; GLSL_OUT_FRAG_COLOR = aK * 0.2270270270 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.1945945946 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.1945945946 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.1216216216 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.1216216216 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.0540540541 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.0540540541 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.0162162162 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * 0.0162162162 ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_GLOW_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 fb = vec2 ( 0.0 , 0.0 ) ; vec2 cB = u_texel_size ; vec4 aK ; aK = GLSL_TEXTURE ( u_color , n ) ; GLSL_OUT_FRAG_COLOR = aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.152507 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.141763 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.141763 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.113861 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.113861 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.079019 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.079019 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.047383 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.047383 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.024549 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.024549 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.01099 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.01099 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.00425 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.00425 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.00142 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; GLSL_OUT_FRAG_COLOR += aK * ( 1.0 - step ( 0.0 , - aK . a ) ) * 0.00142 ; GLSL_OUT_FRAG_COLOR = clamp ( GLSL_OUT_FRAG_COLOR , 0.0 , 1.0 ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_DOF_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 fb = vec2 ( 0.0 , 0.0 ) ; vec2 cB = u_texel_size ; vec4 aK ; vec4 he ; vec4 hf ; float fP ; float hg = u_dof_bokeh_intensity ; aK = GLSL_TEXTURE ( u_color , n ) ; he = aK ; hf = aK ; fP = aK . a ; cB = fP * cB ; for ( int bU = 0 ; bU < 12 ; bU += 2 ) { fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; he += aK ; hf = max ( hf , aK ) ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; he += aK ; hf = max ( hf , aK ) ; } he /= 13.0 ; GLSL_OUT_FRAG_COLOR = mix ( he , hf , hg ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_ALPHA_BLUR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 fb = vec2 ( 0.0 , 0.0 ) ; vec2 cB = u_texel_size ; vec4 aK ; vec4 he ; vec4 hf ; aK = GLSL_TEXTURE ( u_color , n ) ; hf = max ( hf , aK ) ; he = aK ; he . a = aK . a * 0.2270270270 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.1945945946 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.1945945946 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.1216216216 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.1216216216 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.0540540541 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.0540540541 ; fb += cB ; aK = GLSL_TEXTURE ( u_color , n + fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.0162162162 ; aK = GLSL_TEXTURE ( u_color , n - fb ) ; hf . a = max ( hf . a , aK . a ) ; he . a += aK . a * 0.0162162162 ; GLSL_OUT_FRAG_COLOR = mix ( he , hf , 0.5 ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POST_EFFECT","POST_EFFECT_EXTEND",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 cB = u_texel_size ; vec4 aK = GLSL_TEXTURE ( u_color , n ) ; GLSL_OUT_FRAG_COLOR = aK ; if ( aK . a == 0.0 ) { aK = GLSL_TEXTURE ( u_color , n + cB ) ; if ( aK . a > 0.0 ) GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 , 1.0 , 1.0 , aK . a ) ; else { aK = GLSL_TEXTURE ( u_color , n - cB ) ; if ( aK . a > 0.0 ) GLSL_OUT_FRAG_COLOR = vec4 ( 1.0 , 1.0 , 1.0 , aK . a ) ; } }".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POST_EFFECT","FLIP_CUBEMAP_COORDS",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float hh = u_delta [ 0 ] ; float hi = u_delta [ 1 ] ; float hj = 1.0 / 3.0 ; float hk = 0.5 ; vec2 hl = vec2 ( hj , hk ) ; if ( u_tex_number == 0 ) { vec2 bI = mat2 ( 0.0 , - 1.0 , 1.0 , 0.0 ) * n * hl + vec2 ( 2.0 * hj , hk ) ; bI [ 0 ] = max ( bI [ 0 ] , 2.0 * hj + hh ) ; bI [ 1 ] = max ( bI [ 1 ] , hi ) ; GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_color , vec2 ( bI [ 0 ] , hk - bI [ 1 ] ) ) ; } else if ( u_tex_number == 1 ) { vec2 bI = mat2 ( 0.0 , - 1.0 , 1.0 , 0.0 ) * n * hl + vec2 ( 0.0 , hk ) ; bI [ 0 ] = max ( bI [ 0 ] , hh ) ; bI [ 1 ] = min ( bI [ 1 ] , hk - hi ) ; GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_color , vec2 ( hj - bI [ 0 ] , bI [ 1 ] ) ) ; } else if ( u_tex_number == 2 ) { vec2 bI = n * hl + vec2 ( 2.0 * hj , hk ) ; bI [ 0 ] = max ( bI [ 0 ] , 2.0 * hj + hh ) ; bI [ 1 ] = min ( bI [ 1 ] , 1.0 - hi ) ; GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_color , vec2 ( bI [ 0 ] , 1.5 - bI [ 1 ] ) ) ; } else if ( u_tex_number == 3 ) { vec2 bI = n * hl + vec2 ( hj , 0.0 ) ; bI [ 0 ] = max ( bI [ 0 ] , hj + hh ) ; bI [ 0 ] = min ( bI [ 0 ] , 2.0 * hj - hh ) ; bI [ 1 ] = min ( bI [ 1 ] , hk - hi ) ; GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_color , vec2 ( 1.0 - bI [ 0 ] , bI [ 1 ] ) ) ; } else if ( u_tex_number == 4 ) { vec2 bI = n * hl + vec2 ( hj , hk ) ; bI [ 0 ] = max ( bI [ 0 ] , hj + hh ) ; bI [ 0 ] = min ( bI [ 0 ] , 2.0 * hj - hh ) ; bI [ 1 ] = min ( bI [ 1 ] , 1.0 - hi ) ; GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_color , vec2 ( bI [ 0 ] , 3.0 * hk - bI [ 1 ] ) ) ; } else { vec2 bI = n * hl + vec2 ( 0.0 , hk ) ; bI [ 0 ] = max ( bI [ 0 ] , hh ) ; bI [ 1 ] = min ( bI [ 1 ] , 1.0 - hi ) ; bI [ 1 ] = max ( bI [ 1 ] , hk + hi ) ; GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_color , vec2 ( hj - bI [ 0 ] , bI [ 1 ] ) ) ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["}"]}]};a["postprocessing/postprocessing.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"GLSL_IN vec2 a_position ; GLSL_OUT vec2 n ; void main ( ) { n = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"SMAA_PASS",TOKENS:["SMAA_RESOLVE"]},{TYPE:"var",
NAME:"SMAA_REPROJECTION",TOKENS:["0"]},{TYPE:"var",NAME:"SMAA_PREDICATION",TOKENS:["0"]},{TYPE:"var",NAME:"AA_METHOD",TOKENS:["AA_METHOD_SMAA_LOW"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_RESOLVE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_color_prev",
";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_blend",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2},"SMAA_PREDICATION",{TYPE:"logical_and_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"uniform vec2 u_texel_size ; GLSL_IN vec2 n ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS",
"SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec4","hm",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec4 hn ; GLSL_IN vec4 ho ; GLSL_IN vec4 hp ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec2","hq",";"]}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT","vec4",
"GLSL_OUT_FRAG_COLOR",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_LOW",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.15"]},{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["1"]},{TYPE:"define",NAME:"SMAA_DISABLE_CORNER_DETECTION",TOKENS:["1"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.1"]},
{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["1"]},{TYPE:"define",NAME:"SMAA_DISABLE_CORNER_DETECTION",TOKENS:["1"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_HIGH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.1"]},{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["0"]},{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",TOKENS:["8"]},{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING",TOKENS:["25"]}]}},{TYPE:"elif",
EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.05"]},{TYPE:"define",NAME:"SMAA_DISABLE_DIAG_DETECTION",TOKENS:["0"]},{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",TOKENS:["16"]},{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING",TOKENS:["25"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_THRESHOLD",TOKENS:["0.1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",
NAME:"SMAA_DEPTH_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_DEPTH_THRESHOLD",TOKENS:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS_DIAG",TOKENS:["8"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_CORNER_ROUNDING",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING",TOKENS:["25"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",TOKENS:["2.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_PREDICATION",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_PREDICATION_THRESHOLD",TOKENS:["0.01"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION_SCALE",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",
NAME:"SMAA_PREDICATION_SCALE",TOKENS:["2.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_PREDICATION_STRENGTH",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_PREDICATION_STRENGTH",TOKENS:["0.4"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_REPROJECTION",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_REPROJECTION",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_REPROJECTION_WEIGHT_SCALE",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_REPROJECTION_WEIGHT_SCALE",
TOKENS:["30.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_MAX_SEARCH_STEPS",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["16"]}]}}]},{TYPE:"define",NAME:"SMAA_AREATEX_MAX_DISTANCE",TOKENS:["16"]},{TYPE:"define",NAME:"SMAA_AREATEX_MAX_DISTANCE_DIAG",TOKENS:["20"]},{TYPE:"define",NAME:"SMAA_AREATEX_PIXEL_SIZE",TOKENS:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{TYPE:"define",NAME:"SMAA_AREATEX_SUBTEX_SIZE",TOKENS:["(","1.0","/","7.0",")"]},{TYPE:"define",
NAME:"SMAA_SEARCHTEX_SIZE",TOKENS:"vec2 ( 66.0 , 33.0 )".split(" ")},{TYPE:"define",NAME:"SMAA_SEARCHTEX_PACKED_SIZE",TOKENS:"vec2 ( 64.0 , 16.0 )".split(" ")},{TYPE:"define",NAME:"SMAA_CORNER_ROUNDING_NORM",TOKENS:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 hu ( vec2 bI , sampler2D hr ) { float p = GLSL_TEXTURE ( hr , bI ) . r ; float hs = GLSL_TEXTURE ( hr , hn . xy ) . r ; float ht = GLSL_TEXTURE ( hr , hn . zw ) . r ; return vec3 ( p , hs , ht ) ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 hy ( vec2 bI , sampler2D hv ) { vec3 hw = hu ( bI , hv ) ; vec2 cB = abs ( hw . xx - hw . yz ) ; vec2 hx = step ( SMAA_PREDICATION_THRESHOLD , cB ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * hx ) ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"void hC ( bvec2 hz , inout vec2 hA , vec2 hB ) { if ( hz . x ) hA . x = hB . x ; if ( hz . y ) hA . y = hB . y ; } void hC ( bvec4 hz , inout vec4 hA , vec4 hB ) { hC ( hz . xy , hA . xy , hB . xy ) ; hC ( hz . zw , hA . zw , hB . zw ) ; } vec2 hD ( vec2 x ) { return sign ( x ) * floor ( abs ( x ) + .5 ) ; } vec4 hD ( vec4 x ) { return sign ( x ) * floor ( abs ( x ) + .5 ) ; }".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 hQ ( vec2 bI , sampler2D hE".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PREDICATION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","sampler2D","hv"]}]}}]},{TYPE:"txt",TOKENS:[")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PREDICATION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 hF = hy ( bI , hv ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 hF = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 hG = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float hH = dot ( GLSL_TEXTURE ( hE , bI ) . rgb , hG ) ; float hI = dot ( GLSL_TEXTURE ( hE , hn . xy ) . rgb , hG ) ; float hJ = dot ( GLSL_TEXTURE ( hE , hn . zw ) . rgb , hG ) ; vec4 cB ; cB . xy = abs ( hH - vec2 ( hI , hJ ) ) ; vec2 hx = step ( hF , cB . xy ) ; if ( dot ( hx , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float hK = dot ( GLSL_TEXTURE ( hE , ho . xy ) . rgb , hG ) ; float hL = dot ( GLSL_TEXTURE ( hE , ho . zw ) . rgb , hG ) ; cB . zw = abs ( hH - vec2 ( hK , hL ) ) ; vec2 hM = max ( cB . xy , cB . zw ) ; float hN = dot ( GLSL_TEXTURE ( hE , hp . xy ) . rgb , hG ) ; float hO = dot ( GLSL_TEXTURE ( hE , hp . zw ) . rgb , hG ) ; cB . zw = abs ( vec2 ( hI , hJ ) - vec2 ( hN , hO ) ) ; hM = max ( hM . xy , cB . zw ) ; float hP = max ( hM . x , hM . y ) ; hx . xy *= step ( hP , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * cB . xy ) ; return hx ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_DIAG_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 hS ( vec2 hR ) { hR . r = hR . r * abs ( 5.0 * hR . r - 5.0 * 0.75 ) ; return hD ( hR ) ; } vec4 hS ( vec4 hR ) { hR . rb = hR . rb * abs ( 5.0 * hR . rb - 5.0 * 0.75 ) ; return hD ( hR ) ; } vec2 hU ( sampler2D hT , vec2 bI , vec2 bj , out vec2 hR ) { vec4 fn = vec4 ( bI , - 1.0 , 1.0 ) ; vec3 t = vec3 ( u_texel_size , 1.0 ) ; for ( int bU = 0 ; bU < SMAA_MAX_SEARCH_STEPS_DIAG ; bU ++ ) { if ( fn . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && fn . w > 0.9 ) { fn . xyz += t * vec3 ( bj , 1.0 ) ; hR = GLSL_TEXTURE ( hT , fn . xy , 0.0 ) . rg ; fn . w = dot ( hR , vec2 ( 0.5 , 0.5 ) ) ; } } return fn . zw ; } vec2 hV ( sampler2D hT , vec2 bI , vec2 bj , out vec2 hR ) { vec4 fn = vec4 ( bI , - 1.0 , 1.0 ) ; fn . x += 0.25 * u_texel_size . x ; vec3 t = vec3 ( u_texel_size , 1.0 ) ; for ( int bU = 0 ; bU < SMAA_MAX_SEARCH_STEPS_DIAG ; bU ++ ) { if ( fn . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && fn . w > 0.9 ) { fn . xyz = t * vec3 ( bj , 1.0 ) + fn . xyz ; hR = GLSL_TEXTURE ( hT , fn . xy , 0.0 ) . rg ; hR = hS ( hR ) ; fn . w = dot ( hR , vec2 ( 0.5 , 0.5 ) ) ; } } return fn . zw ; } vec2 hX ( sampler2D hW , vec2 aG , vec2 hR , float fb ) { vec2 bI = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * hR + aG ; bI = SMAA_AREATEX_PIXEL_SIZE * bI + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; bI . x += 0.5 ; bI . y += SMAA_AREATEX_SUBTEX_SIZE * fb ; return GLSL_TEXTURE ( hW , bI , 0.0 ) . rg ; } vec2 ib ( sampler2D hT , sampler2D hW , vec2 bI , vec2 hR , vec4 hY ) { vec2 hG = vec2 ( 0.0 , 0.0 ) ; vec4 dj ; vec2 hZ ; if ( hR . r > 0.0 ) { dj . xz = hU ( hT , bI , vec2 ( - 1.0 , 1.0 ) , hZ ) ; dj . x += float ( hZ . y > 0.9 ) ; } else dj . xz = vec2 ( 0.0 , 0.0 ) ; dj . yw = hU ( hT , bI , vec2 ( 1.0 , - 1.0 ) , hZ ) ; if ( dj . x + dj . y > 2.0 ) { vec4 h_ = vec4 ( - dj . x + 0.25 , dj . x , dj . y , - dj . y - 0.25 ) * u_texel_size . xyxy + bI . xyxy ; vec4 de ; de . xy = GLSL_TEXTURE ( hT , h_ . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; de . zw = GLSL_TEXTURE ( hT , h_ . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; de . yxwz = hS ( de . xyzw ) ; vec2 ia = vec2 ( 2.0 , 2.0 ) * de . xz + de . yw ; hC ( bvec2 ( step ( 0.9 , dj . zw ) ) , ia , vec2 ( 0.0 , 0.0 ) ) ; hG += hX ( hW , dj . xy , ia , hY . z ) ; } dj . xz = hV ( hT , bI , vec2 ( - 1 , - 1 ) , hZ ) ; if ( GLSL_TEXTURE ( hT , bI + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { dj . yw = hV ( hT , bI , vec2 ( 1 , 1 ) , hZ ) ; dj . y += float ( hZ . y > 0.9 ) ; } else dj . yw = vec2 ( 0.0 , 0.0 ) ; if ( dj . x + dj . y > 2.0 ) { vec4 h_ = vec4 ( - dj . x , - dj . x , dj . y , dj . y ) * u_texel_size . xyxy + bI . xyxy ; vec4 de ; de . x = GLSL_TEXTURE ( hT , h_ . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; de . y = GLSL_TEXTURE ( hT , h_ . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; de . zw = GLSL_TEXTURE ( hT , h_ . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 ia = vec2 ( 2.0 , 2.0 ) * de . xz + de . yw ; hC ( bvec2 ( step ( 0.9 , dj . zw ) ) , ia , vec2 ( 0 , 0 ) ) ; hG += hX ( hW , dj . xy , ia , hY . w ) . gr ; } return hG ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"float ie ( sampler2D ic , vec2 hR , float fb ) { vec2 hl = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 id = SMAA_SEARCHTEX_SIZE * vec2 ( fb , 1.0 ) ; hl += vec2 ( - 1.0 , 1.0 ) ; id += vec2 ( 0.5 , - 0.5 ) ; hl *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; id *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return GLSL_TEXTURE ( ic , hl * hR + id , 0.0 ) . r ; } float ig ( sampler2D hT , sampler2D ic , vec2 bI , float hZ ) { vec2 hR = vec2 ( 0.0 , 1.0 ) ; for ( int bU = 0 ; bU < SMAA_MAX_SEARCH_STEPS ; bU ++ ) { if ( bI . x > hZ && hR . g > 0.8281 && hR . r == 0.0 ) { hR = GLSL_TEXTURE ( hT , bI , 0.0 ) . rg ; bI = - vec2 ( 2.0 , 0.0 ) * u_texel_size + bI ; } } float fb = - ( 255.0 / 127.0 ) * ie ( ic , hR , 0.0 ) + 3.25 ; return u_texel_size . x * fb + bI . x ; } float ih ( sampler2D hT , sampler2D ic , vec2 bI , float hZ ) { vec2 hR = vec2 ( 0.0 , 1.0 ) ; for ( int bU = 0 ; bU < SMAA_MAX_SEARCH_STEPS ; bU ++ ) { if ( bI . x < hZ && hR . g > 0.8281 && hR . r == 0.0 ) { hR = GLSL_TEXTURE ( hT , bI , 0.0 ) . rg ; bI = vec2 ( 2.0 , 0.0 ) * u_texel_size + bI ; } } float fb = - ( 255.0 / 127.0 ) * ie ( ic , hR , 0.5 ) + 3.25 ; return - u_texel_size . x * fb + bI . x ; } float ii ( sampler2D hT , sampler2D ic , vec2 bI , float hZ ) { vec2 hR = vec2 ( 1.0 , 0.0 ) ; for ( int bU = 0 ; bU < SMAA_MAX_SEARCH_STEPS ; bU ++ ) { if ( bI . y > hZ && hR . r > 0.8281 && hR . g == 0.0 ) { hR = GLSL_TEXTURE ( hT , bI , 0.0 ) . rg ; bI = - vec2 ( 0.0 , 2.0 ) * u_texel_size + bI ; } } float fb = - ( 255.0 / 127.0 ) * ie ( ic , hR . gr , 0.0 ) + 3.25 ; return u_texel_size . y * fb + bI . y ; } float ij ( sampler2D hT , sampler2D ic , vec2 bI , float hZ ) { vec2 hR = vec2 ( 1.0 , 0.0 ) ; for ( int bU = 0 ; bU < SMAA_MAX_SEARCH_STEPS ; bU ++ ) { if ( bI . y < hZ && hR . r > 0.8281 && hR . g == 0.0 ) { hR = GLSL_TEXTURE ( hT , bI , 0.0 ) . rg ; bI = vec2 ( 0.0 , 2.0 ) * u_texel_size + bI ; } } float fb = - ( 255.0 / 127.0 ) * ie ( ic , hR . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * fb + bI . y ; } vec2 im ( sampler2D hW , vec2 aG , float ik , float il , float fb ) { vec2 bI = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * hD ( 4.0 * vec2 ( ik , il ) ) + aG ; bI = SMAA_AREATEX_PIXEL_SIZE * bI + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; bI . y = SMAA_AREATEX_SUBTEX_SIZE * fb + bI . y ; return GLSL_TEXTURE ( hW , bI , 0.0 ) . rg ; } void iq ( sampler2D hT , inout vec2 hG , vec4 bI , vec2 dj ) {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_CORNER_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 io = step ( dj . xy , dj . yx ) ; vec2 ip = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * io ; ip /= io . x + io . y ; vec2 aF = vec2 ( 1.0 , 1.0 ) ; aF . x -= ip . x * GLSL_TEXTURE ( hT , bI . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; aF . x -= ip . y * GLSL_TEXTURE ( hT , bI . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; aF . y -= ip . x * GLSL_TEXTURE ( hT , bI . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; aF . y -= ip . y * GLSL_TEXTURE ( hT , bI . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; hG *= clamp ( aF , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"} void ir ( sampler2D hT , inout vec2 hG , vec4 bI , vec2 dj ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_CORNER_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 io = step ( dj . xy , dj . yx ) ; vec2 ip = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * io ; ip /= io . x + io . y ; vec2 aF = vec2 ( 1.0 , 1.0 ) ; aF . x -= ip . x * GLSL_TEXTURE ( hT , bI . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; aF . x -= ip . y * GLSL_TEXTURE ( hT , bI . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; aF . y -= ip . x * GLSL_TEXTURE ( hT , bI . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; aF . y -= ip . y * GLSL_TEXTURE ( hT , bI . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; hG *= clamp ( aF , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 iu ( vec2 bI , vec2 is , sampler2D hT , sampler2D hW , sampler2D ic , vec4 hY ) { vec4 hG = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 hR = GLSL_TEXTURE ( hT , bI ) . rg ; if ( hR . g > 0.0 ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_DIAG_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"hG . rg = ib ( hT , hW , bI , hR , hY ) ; if ( hG . r == - hG . g ) {".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec2 dj ; vec3 h_ ; h_ . x = ig ( hT , ic , hn . xy , hp . x ) ; h_ . y = ho . y ; dj . x = h_ . x ; float ik = GLSL_TEXTURE ( hT , h_ . xy , 0.0 ) . r ; h_ . z = ih ( hT , ic , hn . zw , hp . y ) ; dj . y = h_ . z ; dj = abs ( hD ( dj / u_texel_size . xx - is . xx ) ) ; vec2 it = sqrt ( dj ) ; float il = GLSL_TEXTURE ( hT , h_ . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; hG . rg = im ( hW , it , ik , il , hY . y ) ; h_ . y = bI . y ; iq ( hT , hG . rg , h_ . xyzy , dj ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_DISABLE_DIAG_DETECTION",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"} else hR . r = 0.0 ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} if ( hR . r > 0.0 ) { vec2 dj ; vec3 h_ ; h_ . y = ii ( hT , ic , ho . xy , hp . z ) ; h_ . x = hn . x ; dj . x = h_ . y ; float ik = GLSL_TEXTURE ( hT , h_ . xy , 0.0 ) . g ; h_ . z = ij ( hT , ic , ho . zw , hp . w ) ; dj . y = h_ . z ; dj = abs ( hD ( dj / u_texel_size . yy - is . yy ) ) ; vec2 it = sqrt ( dj ) ; float il = GLSL_TEXTURE ( hT , h_ . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; hG . ba = im ( hW , it , ik , il , hY . x ) ; h_ . x = bI . x ; ir ( hT , hG . ba , h_ . xyxz , dj ) ; } return hG ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 iD ( vec2 bI , sampler2D hE , sampler2D iv".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","sampler2D","iw"]}]}}]},{TYPE:"txt",TOKENS:") { vec4 a ; a . x = GLSL_TEXTURE ( iv , hm . xy ) . a ; a . y = GLSL_TEXTURE ( iv , hm . zw ) . g ; a . wz = GLSL_TEXTURE ( iv , bI ) . xz ; if ( dot ( a , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 aK = GLSL_TEXTURE ( hE , bI , 0.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 ix = GLSL_TEXTURE ( iw , n ) ; vec2 cW = 2.0 * iy ( ix ) - 1.0 ; aK . a = sqrt ( 2.0 * length ( cW ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"return aK ; } else { bool bS = max ( a . x , a . z ) > max ( a . y , a . w ) ; vec4 iz = vec4 ( 0.0 , a . y , 0.0 , a . w ) ; vec2 iA = a . yw ; hC ( bvec4 ( bS , bS , bS , bS ) , iz , vec4 ( a . x , 0.0 , a . z , 0.0 ) ) ; hC ( bvec2 ( bS , bS ) , iA , a . xz ) ; iA /= dot ( iA , vec2 ( 1.0 , 1.0 ) ) ; vec4 iB = iz * vec4 ( u_texel_size , - u_texel_size ) + bI . xyxy ; vec4 aK = iA . x * GLSL_TEXTURE ( hE , iB . xy , 0.0 ) ; aK += iA . y * GLSL_TEXTURE ( hE , iB . zw , 0.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 ix = GLSL_TEXTURE ( iw , iB . xy ) ; vec2 iC = 2.0 * iy ( ix ) - 1.0 ; vec2 cW = iA . x * iC ; ix = GLSL_TEXTURE ( iw , iB . zw ) ; iC = 2.0 * iy ( ix ) - 1.0 ; cW += iA . y * iC ; aK . a = sqrt ( 2.0 * length ( cW ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["return","aK",";","}","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_RESOLVE",{TYPE:"equal_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 iI ( vec2 bI , sampler2D iE , sampler2D iF".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","sampler2D","iw"]}]}}]},{TYPE:"txt",TOKENS:[")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 ix = GLSL_TEXTURE ( iw , n ) ; vec2 cW ; cW = 2.0 * iy ( ix ) - 1.0 ; vec4 iG = GLSL_TEXTURE ( iE , bI ) ; vec4 iH = GLSL_TEXTURE ( iF , bI - cW ) ; float cB = abs ( iG . a * iG . a - iH . a * iH . a ) / 2.0 ; float bY = 0.5 * clamp ( 1.0 - sqrt ( cB ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 aK = mix ( iG , iH , bY ) ; aK . a = 1.0 ; return aK ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 iG = GLSL_TEXTURE ( iE , bI ) ; vec4 iH = GLSL_TEXTURE ( iF , bI ) ; return mix ( iG , iH , 0.5 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 aK = vec4 ( hQ ( n , u_color".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PREDICATION"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","u_predication_tex"]}]}}]},{TYPE:"txt",TOKENS:") , 0.0 , 0.0 ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 aK = iu ( n , hq , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"vec4 aK = iD ( n , u_color , u_blend".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[",","u_velocity_tex"]}]}}]},{TYPE:"txt",TOKENS:[")",";"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_RESOLVE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 aK = vec4 ( iI ( n , u_color , u_color_prev".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_REPROJECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:[",","u_velocity_tex"]}]}}]},{TYPE:"txt",TOKENS:[")",")",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 aK = GLSL_TEXTURE ( u_color , n ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["GLSL_OUT_FRAG_COLOR","=","aK",";","}"]}]};a["postprocessing/smaa.glslv"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"SMAA_PASS",TOKENS:["SMAA_RESOLVE"]},{TYPE:"var",NAME:"AA_METHOD",TOKENS:["AA_METHOD_SMAA_LOW"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",
TOKENS:"uniform vec2 u_texel_size ; GLSL_IN vec2 a_position ; GLSL_OUT vec2 n ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec4","hm",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT vec4 hn ; GLSL_OUT vec4 ho ; GLSL_OUT vec4 hp ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",
{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_OUT","vec2","hq",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_LOW",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["4"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["8"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD",
"AA_METHOD_SMAA_HIGH",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["16"]}]}},{TYPE:"elif",EXPRESSION:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["32"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SMAA_MAX_SEARCH_STEPS",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SMAA_MAX_SEARCH_STEPS",TOKENS:["16"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"void iJ ( vec2 bI ) { hn = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + bI . xyxy ; ho = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + bI . xyxy ; hp = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + bI . xyxy ; }".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"void iK ( vec2 bI , out vec2 is ) { is = bI / u_texel_size ; hn = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + bI . xyxy ; ho = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + bI . xyxy ; hp = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( hn . xz , ho . yw ) ; }".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"void iL ( vec2 bI ) { hm = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + bI . xyxy ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { n = 2.0 * a_position ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SMAA_PASS","SMAA_EDGE_DETECTION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["iJ","(","n",")",";"]}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"iK ( n , hq ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["iL","(","n",")",";"]}]}}]},{TYPE:"txt",TOKENS:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SSAO_WHITE",
TOKENS:["0"]},{TYPE:"var",NAME:"SSAO_QUALITY",TOKENS:["SSAO_QUALITY_8"]},{TYPE:"var",NAME:"SSAO_HEMISPHERE",TOKENS:["0"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"depth_fetch.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; float iM ( in vec2 fn ) { return fN ( u_depth , fn , u_camera_range ) ; } void main ( ) { vec3 fS = GLSL_TEXTURE ( u_color , n ) . rgb ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_WHITE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( fS , 1.0 ) ; return ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 iN = normalize ( 2.0 * GLSL_TEXTURE ( u_ssao_special_tex , n * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float fO = iM ( n ) ; float iO = fO * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_QUALITY","SSAO_QUALITY_8",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"const float iP = 8.0 ; const int iQ = 1 ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SSAO_QUALITY","SSAO_QUALITY_16",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const float iP = 16.0 ; const int iQ = 2 ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SSAO_QUALITY","SSAO_QUALITY_24",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const float iP = 24.0 ; const int iQ = 3 ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SSAO_QUALITY",
"SSAO_QUALITY_32",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const float iP = 32.0 ; const int iQ = 4 ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float iR = u_ssao_radius_increase * 0.001 ; const float iS = 1.0 + 2.4 / iP ; float iT = 0.0 ; for ( int bU = 0 ; bU < iQ ; bU ++ ) for ( int x = - 1 ; x <= 1 ; x += 2 ) for ( int y = - 1 ; y <= 1 ; y += 2 ) for ( int z = - 1 ; z <= 1 ; z += 2 ) { vec3 iU = reflect ( normalize ( vec3 ( x , y , z ) ) , iN ) * ( iR *= iS ) ; vec3 iV = vec3 ( n , iO ) ; iV += vec3 ( iU . xy , iU . z * iO * 2.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_HEMISPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"iV . z -= 1.4 * ( iV . z - iO ) * step ( iO , iV . z ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float iW = iM ( iV . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float iX = clamp ( ( iO - iW ) / iW , 0.0 , 1.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_HEMISPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"iT += mix ( 1.0 , iX , step ( iW , iV . z ) ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"iT += mix ( step ( iV . z , iW ) , 0.5 , iX ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} iT = iT / iP ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_HEMISPHERE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"iT = clamp ( iT * iT + 0.6 * iT , 0.0 , 1.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"iT = clamp ( iT * iT + iT , 0.0 , 1.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float iY = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * fO ) ; iT = mix ( 1.0 , iT , iY ) ; GLSL_OUT_FRAG_COLOR = vec4 ( fS , iT ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SSAO_BLUR_DEPTH",TOKENS:["0"]},{TYPE:"txt",TOKENS:["precision","PRECISION","sampler2D",";"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"depth_fetch.glslf"}]}}]},{TYPE:"txt",TOKENS:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float iM ( in vec2 fn ) { return fN ( u_depth , fn , u_camera_range ) ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"void main ( ) { float iZ = 0.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float i_ = iM ( n ) ; float bY = 0.0 ; float ja = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"vec2 jb = vec2 ( - 2.0 ) ; for ( int bU = 0 ; bU < 4 ; ++ bU ) { for ( int gD = 0 ; gD < 4 ; ++ gD ) { vec2 fb = ( jb + vec2 ( float ( bU ) , float ( gD ) ) ) * u_texel_size ; float jc = GLSL_TEXTURE ( u_ssao_mask , n + fb ) . a ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float jd = iM ( n + fb ) ; float je = 1.0 - clamp ( abs ( jd - i_ ) * ja , 0.0 , 1.0 ) ; iZ += jc * je ; bY += je ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["iZ","+=","jc",";"]}]}}]},{TYPE:"txt",TOKENS:["}","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SSAO_BLUR_DEPTH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( GLSL_TEXTURE ( u_ssao_mask , n ) . rgb , iZ / bY ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_OUT_FRAG_COLOR = vec4 ( GLSL_TEXTURE ( u_ssao_mask , n ) . rgb , iZ / 16.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]};
a["postprocessing/stereo.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"var",NAME:"ANAGLYPH",TOKENS:["0"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ANAGLYPH",{TYPE:"logic_negative_expr",PLACES:1}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"uniform int u_enable_hmd_stereo ; uniform vec4 u_distortion_params ; uniform vec4 u_chromatic_aberration_coefs ; void jo ( vec2 bI , vec2 ad , float cQ , sampler2D jf ) { vec2 jg = ( bI - ad ) * 2.0 ; jg /= cQ ; float jh = jg . x * jg . x + jg . y * jg . y ; vec2 ji = jg * ( 1.0 + u_distortion_params [ 0 ] * jh + u_distortion_params [ 1 ] * jh * jh ) ; vec2 jj = ji * 0.5 / ( 1.0 + u_distortion_params [ 0 ] + u_distortion_params [ 1 ] ) ; if ( length ( u_chromatic_aberration_coefs ) > 0.0 ) { vec2 jk = jj * ( 1.0 + u_chromatic_aberration_coefs [ 0 ] + jh * u_chromatic_aberration_coefs [ 1 ] ) + ad ; vec2 jl = jj + ad ; vec2 jm = jj * ( 1.0 + u_chromatic_aberration_coefs [ 2 ] + jh * u_chromatic_aberration_coefs [ 3 ] ) + ad ; if ( clamp ( jm , 0.0 , 1.0 ) != jm ) { GLSL_OUT_FRAG_COLOR = vec4 ( 0.0 ) ; } else { vec4 jn = GLSL_TEXTURE ( jf , jl ) ; GLSL_OUT_FRAG_COLOR [ 0 ] = GLSL_TEXTURE ( jf , jk ) . x ; GLSL_OUT_FRAG_COLOR [ 1 ] = jn . y ; GLSL_OUT_FRAG_COLOR [ 2 ] = GLSL_TEXTURE ( jf , jm ) . z ; GLSL_OUT_FRAG_COLOR [ 3 ] = jn . w ; } } else { jj = jj * cQ + ad ; if ( clamp ( jj , 0.0 , 1.0 ) != jj ) { GLSL_OUT_FRAG_COLOR = vec4 ( 0.0 ) ; } else { GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( jf , jj ) ; } } }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["void","main","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["ANAGLYPH"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 jp = GLSL_TEXTURE ( u_sampler_left , n ) ; vec4 jq = GLSL_TEXTURE ( u_sampler_right , n ) ; vec3 jr = vec3 ( jp [ 0 ] , jp [ 1 ] , jp [ 2 ] ) ; cb ( jr ) ; vec3 js = vec3 ( jq [ 0 ] , jq [ 1 ] , jq [ 2 ] ) ; cb ( js ) ; mat3 jt = mat3 ( 0.437 , - 0.062 , - 0.048 , 0.449 , - 0.062 , - 0.050 , 0.164 , - 0.024 , - 0.017 ) ; mat3 ju = mat3 ( - 0.011 , 0.377 , - 0.026 , - 0.032 , 0.761 , - 0.093 , - 0.007 , 0.009 , 1.234 ) ; vec3 aK = clamp ( jt * jr , 0.0 , 1.0 ) + clamp ( ju * js , 0.0 , 1.0 ) ; aQ ( aK ) ; GLSL_OUT_FRAG_COLOR = vec4 ( aK , jp [ 3 ] + jq [ 3 ] ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( u_enable_hmd_stereo != 0 ) { if ( n [ 0 ] < 0.5 ) { vec2 bI = vec2 ( 2.0 * n [ 0 ] , n [ 1 ] ) ; vec2 ad = vec2 ( 0.5 - ( u_distortion_params [ 3 ] - 0.5 ) / 2.0 , u_distortion_params [ 2 ] ) ; float cQ = 2.0 * u_distortion_params [ 3 ] ; jo ( bI , ad , cQ , u_sampler_left ) ; } else { vec2 bI = vec2 ( 2.0 * ( n [ 0 ] - 0.5 ) , n [ 1 ] ) ; vec2 ad = vec2 ( 0.5 + ( u_distortion_params [ 3 ] - 0.5 ) / 2.0 , u_distortion_params [ 2 ] ) ; float cQ = 2.0 * u_distortion_params [ 3 ] ; jo ( bI , ad , cQ , u_sampler_right ) ; } } else { GLSL_OUT_FRAG_COLOR = GLSL_TEXTURE ( u_sampler_left , n ) ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["}"]}]};a["postprocessing/velocity.glslf"]={TYPE:"grp",PARTS:[{TYPE:"version",TOKENS:["GLSL_VERSION"]},{TYPE:"include",FILE:"precision_statement.glslf"},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"pack.glslf"},{TYPE:"txt",TOKENS:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; GLSL_IN vec2 n ; GLSL_OUT vec4 GLSL_OUT_FRAG_COLOR ; void main ( ) { float fO = GLSL_TEXTURE ( u_depth , n ) . x ; vec4 jv = vec4 ( n * 2.0 - 1.0 , 2.0 * fO - 1.0 , 1.0 ) ; vec4 ch = u_view_proj_inverse * jv ; vec4 jw = ch / ch . w ; vec4 jx = u_view_proj_prev * jw ; jx /= jx . w ; vec2 cW = ( jv . xy - jx . xy ) / 4.0 + 0.5 ; cW = clamp ( cW , 0.0 , 1.0 ) ; GLSL_OUT_FRAG_COLOR = fT ( cW ) ; }".split(" ")}]};
a["include/blending.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"BLENDING_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"BLENDING_GLSLF",TOKENS:[""]},{TYPE:"txt",TOKENS:"vec3 jz ( vec3 rgb ) { vec4 jy = vec4 ( _0_0 , - _1_0 / 3.0 , 2.0 / 3.0 , - _1_0 ) ; vec4 p = mix ( vec4 ( rgb . bg , jy . wz ) , vec4 ( rgb . gb , jy . xy ) , step ( rgb . b , rgb . g ) ) ; vec4 q = mix ( vec4 ( p . xyw , rgb . r ) , vec4 ( rgb . r , p . yzx ) , step ( p . x , rgb . r ) ) ; float dj = q . x - min ( q . w , q . y ) ; float hR = 1.0e-10 ; return vec3 ( abs ( q . z + ( q . w - q . y ) / ( 6.0 * dj + hR ) ) , dj / ( q . x + hR ) , q . x ) ; } vec3 jB ( vec3 jA ) { vec4 jy = vec4 ( _1_0 , 2.0 / 3.0 , _1_0 / 3.0 , 3.0 ) ; vec3 p = abs ( fract ( vec3 ( jA . r , jA . r , jA . r ) + jy . xyz ) * 6.0 - jy . www ) ; return jA . b * mix ( jy . xxx , clamp ( p - jy . xxx , _0_0 , _1_0 ) , jA . g ) ; } vec3 jF ( vec3 jC , vec3 jD , float jE ) { return mix ( jC , jD , jE ) ; } vec3 jG ( vec3 jC , vec3 jD , float jE ) { return jE * jC + jD ; } vec3 jH ( vec3 jC , vec3 jD , float jE ) { return jD - jE * jC ; } vec3 jJ ( vec3 jC , vec3 jD , float jE ) { float jI = _1_0 - jE ; return ( vec3 ( jI ) + jE * jC ) * jD ; } vec3 jK ( vec3 jC , vec3 jD , float jE ) { vec3 jI = vec3 ( _1_0 - jE ) ; return vec3 ( _1_0 ) - ( jI + jE * ( vec3 ( _1_0 ) - jC ) ) * ( vec3 ( _1_0 ) - jD ) ; } vec3 jL ( vec3 jC , vec3 jD , float jE ) { vec3 jI = vec3 ( _1_0 - jE ) ; return mix ( jD * ( jI + 2.0 * jE * jC ) , vec3 ( _1_0 ) - ( jI + 2.0 * jE * ( vec3 ( _1_0 ) - jC ) ) * ( vec3 ( _1_0 ) - jD ) , step ( 0.5 , jD ) ) ; } vec3 jM ( vec3 jC , vec3 jD , float jE ) { return mix ( jD , abs ( jC - jD ) , jE ) ; } vec3 jN ( vec3 jC , vec3 jD , float jE ) { return mix ( jD , jD / ( jC + step ( jC , vec3 ( _0_0 ) ) ) , jE ) ; } vec3 jO ( vec3 jC , vec3 jD , float jE ) { return mix ( jD , min ( jC , jD ) , jE ) ; } vec3 jP ( vec3 jC , vec3 jD , float jE ) { return max ( jE * jC , jD ) ; } vec3 jT ( vec3 jC , vec3 jD , float jE ) { vec3 jQ = jz ( jD ) ; if ( jQ . y != _0_0 ) { vec3 jR = jz ( jC ) ; vec3 jS = jB ( vec3 ( jQ . x , jR . yz ) ) ; return mix ( jC , jS , jE ) ; } return jC ; } vec3 jU ( vec3 jC , vec3 jD , float jE ) { vec3 jQ = jz ( jC ) ; if ( jQ . y != _0_0 ) { vec3 jR = jz ( jD ) ; return jB ( vec3 ( jQ . x , mix ( jQ . y , jR . y , jE ) , jQ . z ) ) ; } return jC ; } vec3 jV ( vec3 jC , vec3 jD , float jE ) { vec3 jQ = jz ( jC ) ; vec3 jR = jz ( jD ) ; return jB ( vec3 ( jQ . xy , mix ( jQ . z , jR . z , jE ) ) ) ; } vec3 jW ( vec3 jC , vec3 jD , float jE ) { vec3 jQ = jz ( jD ) ; if ( jQ . y != _0_0 ) { vec3 jR = jz ( jC ) ; vec3 jS = jB ( vec3 ( jQ . xy , jR . z ) ) ; return mix ( jC , jS , jE ) ; } return jC ; } vec3 jY ( vec3 jC , vec3 jD , float jE ) { vec3 jX = vec3 ( _1_0 ) - ( vec3 ( _1_0 ) - jD ) * ( vec3 ( _1_0 ) - jC ) ; return mix ( jC , ( ( vec3 ( _1_0 ) - jC ) * jD * jC ) + jC * jX , jE ) ; } vec3 jZ ( vec3 jC , vec3 jD , float jE ) { return jC + jE * ( 2.0 * jD - _1_0 ) ; } float kc ( float j_ , float ka , float jE , float kb ) { float jI = _1_0 - kb ; return ( jI + jE * j_ ) * ka ; } float kd ( float j_ , float ka , float jE , float kb ) { float jI = _1_0 - kb ; return _1_0 - ( jI + jE * ( _1_0 - j_ ) ) * ( _1_0 - ka ) ; } float ke ( float j_ , float ka , float jE , float kb ) { float jI = _1_0 - kb ; return mix ( ka * ( jI + 2.0 * jE * j_ ) , _1_0 - ( jI + 2.0 * jE * ( _1_0 - j_ ) ) * ( _1_0 - ka ) , step ( 0.5 , ka ) ) ; }".split(" ")}]}}]}]};
a["include/caustics.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"CAUSTICS_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"CAUSTICS_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"SUN_NUM",TOKENS:["0"]},{TYPE:"var",NAME:"CAUST_SCALE",TOKENS:["0.25"]},{TYPE:"var",NAME:"CAUST_SPEED",TOKENS:["vec2","(","0.0",")"]},{TYPE:"var",NAME:"CAUST_BRIGHT",TOKENS:["0.5"]},{TYPE:"include",FILE:"procedural.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"CAUSTICS_VIEW_DISTANCE",TOKENS:["100.0"]},
{TYPE:"txt",TOKENS:"void bw ( inout vec3 aK , float kf , float eO , vec4 bv , vec3 Q , vec3 kg , vec3 kh , vec4 ki , vec3 bi , float bt ) { if ( bt > CAUSTICS_VIEW_DISTANCE ) return ; vec3 kj = bi + Q ; kj . xz = 10.0 * sin ( 0.1 * kj . xz ) ; vec3 kl = P ( kk ( ki ) , kj ) ; vec2 bI = kl . xz ; vec3 km = kg ; float kn = max ( dot ( Q , km ) , 0.0 ) ; float ko = 0.025 ; vec2 kp = CAUST_SPEED * eO ; bI . s += 0.25 * sin ( dot ( bi + eO , vec3 ( 1.0 ) ) ) ; bI . t += 0.35 * ( - sin ( dot ( bi - eO , vec3 ( - 0.7 ) ) ) ) ; bI . st += 0.15 * cos ( 4.0 * kf - kp . x ) + 1.5 * sin ( kf - 0.3 * kp . y ) ; float hl = CAUST_SCALE * ( 1.0 + max ( 0.1 * kf , 0.0 ) ) ; vec3 kr = kq ( ( bI / hl ) , ko ) ; kr *= CAUST_BRIGHT ; kr *= kr ; float ks = min ( 0.25 * kf , - kf ) + 1.0 ; ks = max ( ks , 0.0 ) ; float kt = bv [ SUN_NUM ] * kn ; float ku = max ( sign ( kf ) , 0.0 ) ; kt = kt + max ( 0.5 * sign ( - Q . y ) * ku , 0.0 ) ; kt = min ( kt , 1.0 ) ; aK += kh * kr * ks * kt ; }".split(" ")}]}}]}]};
a["include/color_util.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"COLOR_UTIL_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"COLOR_UTIL_GLSLF",TOKENS:[""]},{TYPE:"define",NAME:"PREMULTIPLY_ALPHA",TOKENS:["1"]},{TYPE:"var",NAME:"SRGB",TOKENS:["SRGB_NONE"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"void cb ( inout float aK ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"aK = pow ( aK , 2.2 ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SRGB","SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( aK <= 0.04045 ) aK = aK / 12.92 ; else aK = pow ( aK + 0.055 / 1.055 , 2.4 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} void aQ ( inout float aK ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aK = pow ( aK , 2.2 ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["SRGB","SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( aK <= 0.00031308 ) aK = aK * 12.92 ; else aK = 1.055 * pow ( aK , 1.0 / 2.4 ) - 0.055 ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} void cb ( inout vec3 aK ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aK = pow ( aK , vec3 ( 2.2 ) ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SRGB",
"SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"cb ( aK . r ) ; cb ( aK . g ) ; cb ( aK . b ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} void aQ ( inout vec3 aK ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SRGB","SRGB_SIMPLE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aK = pow ( aK , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["SRGB","SRGB_PROPER",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"aQ ( aK . r ) ; aQ ( aK . g ) ; aQ ( aK . b ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} void aR ( inout vec3 aK , in float L ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PREMULTIPLY_ALPHA"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aK = aK * L ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} float fu ( vec4 aK ) { vec3 kv = vec3 ( 0.299 , 0.587 , 0.114 ) ; float kw = dot ( aK . rgb , kv ) ; return kw ; }".split(" ")}]}}]}]};a["include/depth_fetch.glslf"]={TYPE:"grp",
PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"DEPTH_FETCH_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"DEPTH_FETCH_GLSLF",TOKENS:[""]},{TYPE:"txt",TOKENS:"float fN ( in sampler2D kx , in vec2 fn , in vec2 ky ) { float fO = GLSL_TEXTURE ( kx , fn ) . r ; float dn = ky . x ; float kz = ky . y ; float kA = 2.0 * dn / ( dn + kz - ( 2.0 * fO - 1.0 ) * ( kz - dn ) ) ; return kA ; }".split(" ")}]}}]}]};a["include/dynamic_grass.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"DYNAMIC_GRASS_GLSLV",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"DYNAMIC_GRASS_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"DYNAMIC_GRASS",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DYNAMIC_GRASS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"},{TYPE:"include",FILE:"to_world.glslv"},{TYPE:"txt",TOKENS:"vec2 kE ( vec3 O , float kB , vec2 kC ) { vec2 kD = vec2 ( ( O . x - kC . x ) / kB , ( O . y - kC . y ) / kB ) ; return fract ( kD ) ; } vec2 kF ( vec2 gm , float kB , vec2 kC ) { return vec2 ( gm . x * kB , gm . y * kB ) + kC ; } ak kG ( ) { return ak ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } ak aT ( vec3 O , vec3 R , vec3 kH , vec3 S , vec3 Q , vec3 ad , PRECISION sampler2D kI , sampler2D kJ , vec3 kK , float kL , vec3 kM , vec4 kN , mat3 N ) { vec3 kO = P ( kN , vec3 ( 0.0 , 0.0 , - 1.0 ) ) ; float kP = - kO . x ; float kQ = kO . y ; vec2 kC = vec2 ( kM . x - kL * ( 1.0 + kP ) / 2.0 , kM . y - kL * ( 1.0 - kQ ) / 2.0 ) ; vec2 kR = kE ( ad , kL , kC ) ; float kS = kL / 2.0 ; vec2 kT = abs ( kF ( kR - vec2 ( 0.5 ) , kL , vec2 ( 0.0 ) ) ) ; float kU = kS * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( kT ) > kU ) return kG ( ) ; float kV = kL / kK . z ; vec2 kW = ( kR - vec2 ( 0.5 ) ) * kV + vec2 ( 0.5 ) ; vec3 kX = kO * ( kL / kK . z - 1.0 ) / 2.0 ; kW . x += kX . x ; kW . y += kX . y ; vec4 kY = GLSL_TEXTURE ( kJ , kW ) ; float hl = kY . r ; if ( hl < u_scale_threshold ) return kG ( ) ; float kZ = kK . y - kK . x ; float bR = kK . y - GLSL_TEXTURE ( kI , kW ) . r * kZ ; vec2 k_ = O . xy - ad . xy ; ad . xy = kF ( kR , kL , kC ) ; ad . z = bR ; O . xy = ad . xy + k_ ; O . z *= hl ; O . z += bR ; vec3 aK = kY . gba ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O -= ad ; mat3 la = ai ( kM , ad , N ) ; ak am = al ( O , ad , R , kH , S , Q , la ) ; am . ad = ad ; am . aK = aK ; return lb ( am ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return lb ( ak ( O , ad , R , kH , S , Q , aK ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]}}]}]};a["include/environment.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",
NAME:"ENVIRONMENT_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"ENVIRONMENT_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"USE_ENVIRONMENT_LIGHT",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_COLOR",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_TEXTURE",TOKENS:["0"]},{TYPE:"txt",TOKENS:"vec3 ci ( vec3 Q ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_ENVIRONMENT_LIGHT"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_TEXTURE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return GLSL_TEXTURE_CUBE ( u_sky_texture , Q ) . rgb ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["SKY_COLOR"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float lc = 0.5 * Q . z + 0.5 ; return mix ( u_horizon_color , u_zenith_color , lc ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/fog.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FOG_GLSLF",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FOG_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"USE_FOG",TOKENS:["0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"FOG_TYPE",TOKENS:["QUADRATIC"]},{TYPE:"var",NAME:"PROCEDURAL_FOG",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"void lh ( inout vec3 aK , in float ld , in float bR , in vec4 le ) { float lf = clamp ( ( ld - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FOG_TYPE","QUADRATIC",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["lf","*=","lf",";"]}]}},{TYPE:"elif",EXPRESSION:["FOG_TYPE","LINEAR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[]}},{TYPE:"elif",EXPRESSION:["FOG_TYPE","INVERSE_QUADRATIC",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"lf = sqrt ( lf ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"if ( u_fog_params . w > 0.0 ) { if ( bR > u_fog_params . w ) lf = 0.0 ; else { float lg = ( u_fog_params . w - max ( bR , 0.0 ) ) / u_fog_params . w ; lf *= lg * lg ; } } le . a = 1.0 - ( 1.0 - lf ) * ( 1.0 - u_fog_params . x ) ; aK = mix ( aK , le . rgb , le . a ) ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 lm ( in mat4 li , in vec3 u ) { vec3 lj = mix ( li [ 0 ] . rgb , li [ 1 ] . rgb , max ( sign ( u . x ) , 0.0 ) ) ; vec3 lk = mix ( li [ 2 ] . rgb , li [ 3 ] . rgb , max ( sign ( u . z ) , 0.0 ) ) ; vec3 ll = vec3 ( li [ 0 ] . a , li [ 1 ] . a , li [ 2 ] . a ) ; vec3 aK = mix ( lj , lk , abs ( u . z ) ) ; aK = mix ( aK , ll , abs ( u . y ) ) ; cb ( aK ) ; return aK ; }".split(" ")}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"void lo ( inout float ln ) { ln -= 0.5 ; ln = 4.0 * ( ln * ln * ln ) + 0.5 ; } void lu ( inout vec3 aK , in float ld , in vec3 u , in float dS , in vec4 lp , in float eF ) { float lq = max ( u . z , 0.0 ) ; float lr = max ( ld - max ( dS / lq , 0.0 ) , 0.0 ) ; float ls = lp . w * lr ; vec3 dT = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 lt = lp . rgb ; ls = min ( ls , 1.0 ) ; lo ( ls ) ; ls *= clamp ( 2.0 - eF , 0.0 , 1.0 ) ; vec3 dU = mix ( lt , dT , min ( lq , 1.0 ) ) ; dS = clamp ( - dS * 0.03 , 0.0 , 0.8 ) ; dU *= 1.0 - dS ; aK = mix ( aK , dU , ls ) ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"void bx ( inout vec3 aK , float ld , vec3 u , float bu ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["PROCEDURAL_FOG"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 li = lm ( u_cube_fog , u ) ; vec4 dU = vec4 ( li , u_fog_color_density . a ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","dU","=","u_fog_color_density",";"]}]}}]},{TYPE:"txt",TOKENS:"lh ( aK , ld , c . z , dU ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"lu ( aK , ld , u , u_cam_water_depth , u_underwater_fog_color_density , bu ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/fxaa.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"FXAA_BLEND4WEB",TOKENS:["1"]},{TYPE:"var",NAME:"FXAA_QUALITY_P12",TOKENS:["0.0"]},
{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_PS3",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_PS3",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_360",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_360",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_360_OPT",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_360_OPT",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_PC",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_PC",TOKENS:["0"]}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_PC_CONSOLE",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_PC_CONSOLE",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GLSL_120",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GLSL_120",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GLSL_130",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GLSL_130",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_HLSL_3",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",
NAME:"FXAA_HLSL_3",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_HLSL_4",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_HLSL_4",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_HLSL_5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_HLSL_5",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GREEN_AS_LUMA",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GREEN_AS_LUMA",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_EARLY_EXIT",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_EARLY_EXIT",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_DISCARD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_DISCARD",TOKENS:["0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_FAST_PIXEL_OFFSET",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_EXT_gpu_shader4",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_NV_gpu_shader5",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_ARB_gpu_shader5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_FAST_PIXEL_OFFSET",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_FAST_PIXEL_OFFSET",TOKENS:["0"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GATHER4_ALPHA",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["FXAA_HLSL_5",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_ARB_gpu_shader5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifdef",NAME:"GL_NV_gpu_shader5",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["1"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_GATHER4_ALPHA",GROUP:{TYPE:"grp",
PARTS:[{TYPE:"define",NAME:"FXAA_GATHER4_ALPHA",TOKENS:["0"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[1],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[0],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",TOKENS:["4.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[0],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_SHARPNESS",TOKENS:["2.0"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[1],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",TOKENS:["0.125"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_CONSOLE_PS3_EDGE_THRESHOLD",TOKENS:["0.25"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"ifndef",
NAME:"FXAA_QUALITY_PRESET",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PRESET",TOKENS:["12"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",10,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["3"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["3.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",
11,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["4"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["3.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",12,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["5"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",13,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["6"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",14,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["7"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",15,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["8"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["12.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",
20,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["3"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",21,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["4"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",22,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",23,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["6"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",24,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["7"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["3.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",25,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["8"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",26,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["9"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",
27,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["10"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",
NAME:"FXAA_QUALITY_P7",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",28,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["11"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",
NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P10",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",29,{TYPE:"equal_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["12"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",
TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P10",TOKENS:["4.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P11",TOKENS:["8.0"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PRESET",39,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"FXAA_QUALITY_PS",TOKENS:["12"]},{TYPE:"define",NAME:"FXAA_QUALITY_P0",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P1",
TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P2",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P3",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P4",TOKENS:["1.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P5",TOKENS:["1.5"]},{TYPE:"define",NAME:"FXAA_QUALITY_P6",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P7",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P8",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P9",TOKENS:["2.0"]},{TYPE:"define",NAME:"FXAA_QUALITY_P10",TOKENS:["4.0"]},
{TYPE:"define",NAME:"FXAA_QUALITY_P11",TOKENS:["8.0"]}]}}]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"txt",TOKENS:"float lv ( float x ) { return clamp ( x , 0.0 , 1.0 ) ; }".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_BLEND4WEB",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 lw ( sampler2D t , vec2 p ) { return GLSL_TEXTURE ( t , p ) ; } vec4 ly ( sampler2D t , vec2 p , vec2 lx , vec2 r ) { return GLSL_TEXTURE ( t , p + ( lx * r ) ) ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"vec4 fJ ( vec2 eH , sampler2D hr , vec2 lz , float lA , float lB , float lC ) { vec2 lD ; lD . x = eH . x ; lD . y = eH . y ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_GATHER4_ALPHA",1,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 lE = lw ( hr , lD ) ; float fv = fu ( lE ) ; float lF = fu ( ly ( hr , lD , vec2 ( 0 , 1 ) , lz . xy ) ) ; float lG = fu ( ly ( hr , lD , vec2 ( 1 , 0 ) , lz . xy ) ) ; float lH = fu ( ly ( hr , lD , vec2 ( 0 , - 1 ) , lz . xy ) ) ; float lI = fu ( ly ( hr , lD , vec2 ( - 1 , 0 ) , lz . xy ) ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"float lJ = max ( lF , fv ) ; float lK = min ( lF , fv ) ; float lL = max ( lG , lJ ) ; float lM = min ( lG , lK ) ; float lN = max ( lH , lI ) ; float lO = min ( lH , lI ) ; float lP = max ( lN , lL ) ; float lQ = min ( lO , lM ) ; float lR = lP * lB ; float lS = lP - lQ ; float lT = max ( lC , lR ) ; bool lU = lS < lT ; if ( lU ) return lE ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_GATHER4_ALPHA",0,{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"float fw = fu ( ly ( hr , lD , vec2 ( - 1 , - 1 ) , lz . xy ) ) ; float fz = fu ( ly ( hr , lD , vec2 ( 1 , 1 ) , lz . xy ) ) ; float fx = fu ( ly ( hr , lD , vec2 ( 1 , - 1 ) , lz . xy ) ) ; float fy = fu ( ly ( hr , lD , vec2 ( - 1 , 1 ) , lz . xy ) ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[]}}]},{TYPE:"txt",TOKENS:"float lV = lH + lF ; float lW = lI + lG ; float lX = 1.0 / lS ; float lY = lV + lW ; float lZ = ( - 2.0 * fv ) + lV ; float l_ = ( - 2.0 * fv ) + lW ; float ma = fx + fz ; float mb = fw + fx ; float mc = ( - 2.0 * lG ) + ma ; float md = ( - 2.0 * lH ) + mb ; float me = fw + fy ; float mf = fy + fz ; float mg = ( abs ( lZ ) * 2.0 ) + abs ( mc ) ; float mh = ( abs ( l_ ) * 2.0 ) + abs ( md ) ; float mi = ( - 2.0 * lI ) + me ; float mj = ( - 2.0 * lF ) + mf ; float mk = abs ( mi ) + mg ; float ml = abs ( mj ) + mh ; float mm = me + ma ; float mn = lz . x ; bool mo = mk >= ml ; float mp = lY * 2.0 + mm ; if ( ! mo ) lH = lI ; if ( ! mo ) lF = lG ; if ( mo ) mn = lz . y ; float mq = ( mp * ( 1.0 / 12.0 ) ) - fv ; float mr = lH - fv ; float ms = lF - fv ; float mt = lH + fv ; float mu = lF + fv ; bool mv = abs ( mr ) >= abs ( ms ) ; float mw = max ( abs ( mr ) , abs ( ms ) ) ; if ( mv ) mn = - mn ; float mx = lv ( abs ( mq ) * lX ) ; vec2 my ; my . x = lD . x ; my . y = lD . y ; vec2 mz ; mz . x = ( ! mo ) ? 0.0 : lz . x ; mz . y = ( mo ) ? 0.0 : lz . y ; if ( ! mo ) my . x += mn * 0.5 ; if ( mo ) my . y += mn * 0.5 ; vec2 mA ; mA . x = my . x - mz . x * FXAA_QUALITY_P0 ; mA . y = my . y - mz . y * FXAA_QUALITY_P0 ; vec2 mB ; mB . x = my . x + mz . x * FXAA_QUALITY_P0 ; mB . y = my . y + mz . y * FXAA_QUALITY_P0 ; float mC = ( ( - 2.0 ) * mx ) + 3.0 ; float mD = fu ( lw ( hr , mA ) ) ; float mE = mx * mx ; float mF = fu ( lw ( hr , mB ) ) ; if ( ! mv ) mt = mu ; float mG = mw * 1.0 / 4.0 ; float mH = fv - mt * 0.5 ; float mI = mC * mE ; bool mJ = mH < 0.0 ; mD -= mt * 0.5 ; mF -= mt * 0.5 ; bool mK = abs ( mD ) >= mG ; bool mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P1 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P1 ; bool mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P1 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P1 ; if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P2 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P2 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P2 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P2 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P3 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P3 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P3 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P3 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",4,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P4 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P4 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P4 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P4 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",5,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P5 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P5 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P5 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P5 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",6,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P6 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P6 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P6 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P6 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",7,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P7 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P7 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P7 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P7 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",8,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P8 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P8 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P8 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P8 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",9,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P9 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P9 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P9 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P9 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",10,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P10 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P10 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P10 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P10 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",11,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P11 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P11 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P11 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P11 ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_QUALITY_PS",12,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( mM ) { if ( ! mK ) mD = fu ( lw ( hr , mA . xy ) ) ; if ( ! mL ) mF = fu ( lw ( hr , mB . xy ) ) ; if ( ! mK ) mD = mD - mt * 0.5 ; if ( ! mL ) mF = mF - mt * 0.5 ; mK = abs ( mD ) >= mG ; mL = abs ( mF ) >= mG ; if ( ! mK ) mA . x -= mz . x * FXAA_QUALITY_P12 ; if ( ! mK ) mA . y -= mz . y * FXAA_QUALITY_P12 ; mM = ( ! mK ) || ( ! mL ) ; if ( ! mL ) mB . x += mz . x * FXAA_QUALITY_P12 ; if ( ! mL ) mB . y += mz . y * FXAA_QUALITY_P12 ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:"} float mN = lD . x - mA . x ; float mO = mB . x - lD . x ; if ( ! mo ) mN = lD . y - mA . y ; if ( ! mo ) mO = mB . y - lD . y ; bool mP = ( mD < 0.0 ) != mJ ; float mQ = ( mO + mN ) ; bool mR = ( mF < 0.0 ) != mJ ; float mS = 1.0 / mQ ; bool mT = mN < mO ; float mU = min ( mN , mO ) ; bool mV = mT ? mP : mR ; float mW = mI * mI ; float mX = ( mU * ( - mS ) ) + 0.5 ; float mY = mW * lA ; float mZ = mV ? mX : 0.0 ; float m_ = max ( mZ , mY ) ; if ( ! mo ) lD . x += m_ * mn ; if ( mo ) lD . y += m_ * mn ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FXAA_DISCARD",1,{TYPE:"equal_expr",PLACES:2},"FXAA_BLEND4WEB",1,{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return lw ( hr , lD ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return vec4 ( lw ( hr , lD ) . xyz , fv ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/halo_color.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"HALO_COLOR_GLSLF",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"HALO_COLOR_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"NUM_RINGS",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LINES",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"SKY_STARS",TOKENS:["0"]},{TYPE:"var",NAME:"WAVES_HEIGHT",TOKENS:["1.0"]},{TYPE:"var",NAME:"WATER_EFFECTS",TOKENS:["0"]},{TYPE:"var",NAME:"DISABLE_FOG",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS","NUM_LINES",{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"const int na = NUM_RINGS ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const int na = NUM_LINES ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float nb ( float x ) { return x - floor ( x * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"void ni ( inout float nc , in float nd [ na ] , in float ne ) { for ( int a = 0 ; a < NUM_RINGS ; a ++ ) { float nf = 40.0 * nd [ a ] ; float ng = 300.0 * ( nb ( nf ) - 0.005 ) ; float nh = nf ; float lf = abs ( nh * ( u_halo_size * ng - ne ) ) ; nc += 1.0 - min ( lf , 1.0 ) ; } }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LINES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"void nn ( inout float nj , in float nd [ na ] , in float aG ) { for ( int a = 0 ; a < NUM_LINES ; a ++ ) { float nk = nd [ a ] ; float nl = nk ; float nm = 1000.0 * ( nb ( nk ) - 0.005 ) ; float lf = 20.0 * abs ( nl * n . x + nm * n . y ) ; nj += 1.0 - min ( lf , 1.0 ) ; } nj *= aG ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"void nr ( inout float aG , in vec2 bI ) { float no , bp ; bp = atan ( bI . y , bI . x ) ; bp *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float np = cos ( bp ) ; float nq = sin ( bp ) ; bp = ( np * bI . x + nq * bI . y ) * ( np * bI . y - nq * bI . x ) ; no = abs ( bp ) ; if ( no < 1.0 ) { no = ( 0.01 * u_halo_size ) / ( no ) ; aG *= sqrt ( min ( no , 1.0 ) ) ; } } vec4 aZ ( ) { float aG = ( n . x * n . x + n . y * n . y ) ; float ne = sqrt ( aG ) ; aG = max ( 1.0 - aG , 0.0 ) ; aG = pow ( aG , u_halo_hardness ) ; float L = u_diffuse_color . a ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS","NUM_LINES",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float nd [ na ] ; for ( int bU = 0 ; bU < na ; bU ++ ) { nd [ bU ] = fract ( aY / float ( bU + 1 ) ) - 1.0 ; }".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float nc = 0.0 ; ni ( nc , nd , ne ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LINES"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"float nj = 0.0 ; nn ( nj , nd , aG ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"nr ( aG , n ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"aG *= L ; vec3 aK = u_diffuse_color . rgb ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_RINGS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"nc *= aG ; aK += u_halo_rings_color * nc ; aG += nc ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_LINES"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"nj *= L ; aK += u_halo_lines_color * nj ; aG += nj ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKY_STARS"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"aG *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WATER_EFFECTS","DISABLE_FOG",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float ks = u_halo_stars_blend * ( aX . y - u_halo_stars_height ) ; aG *= clamp ( ks , 0.0 , 1.0 ) ; aG *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},
{TYPE:"txt",TOKENS:"vec4 ns = vec4 ( aK , aG ) ; return ns ; }".split(" ")}]}}]}]};a["include/lighting_nodes.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"LIGHTING_NODES_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"LIGHTING_NODES_GLSLF",TOKENS:[""]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"node",NAME:"LIGHTING_BEGIN",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"nF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"nH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nI",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"nJ",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"nK",QUALIFIER:["vec2"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"nL",QUALIFIER:["vec2"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"nM",QUALIFIER:["vec4"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"nN",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"nO",QUALIFIER:["vec4"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",
TOKENS:"nF = nt ; nG = nu ; nH = nv ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_nI"],STATEMENTS:[{TYPE:"txt",TOKENS:["nI","=","nw",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_nJ"],STATEMENTS:[{TYPE:"txt",TOKENS:["nJ","=","ny",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_nL"],STATEMENTS:[{TYPE:"txt",TOKENS:["nL","=","nz",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_nK"],STATEMENTS:[{TYPE:"txt",
TOKENS:["nK","=","nA",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_nM"],STATEMENTS:[{TYPE:"txt",TOKENS:["nM","=","nB",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_nN"],STATEMENTS:[{TYPE:"txt",TOKENS:["nN","=","nC",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_nO"],STATEMENTS:[{TYPE:"txt",TOKENS:["nO","=","nD",";"]}]}]}]},{TYPE:"node",NAME:"LIGHTING_AMBIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"nP",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"nQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"nR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nS",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"nS = vec4 ( nP + nR * nQ , _0_0 ) ; nT = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"LIGHTING_LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_IND",TOKENS:["0"]},
{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]},{TYPE:"node_var",NAME:"LAMP_SHADOW_MAP_IND",TOKENS:["-","1"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"nU",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nW",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"nX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"nW = vec2 ( u_light_positions [ LAMP_IND ] . w , u_light_color_intensities [ LAMP_IND ] . w ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","HEMI",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["nY","=","_0_5",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["nY","=","_0_0",";"]}]}]},{TYPE:"txt",TOKENS:"nX = u_light_color_intensities [ LAMP_IND ] . xyz ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_SHADOW_MAP_IND",1,{TYPE:"negative_expr",PLACES:1},{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"nX *= nU [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 nZ = u_light_positions [ LAMP_IND ] . xyz ; nV = nZ - nx ; float aG = length ( nV ) ; float n_ = LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + aG * aG ) ; nV = normalize ( nV ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oa = u_light_directions [ LAMP_IND ] ; float ob = dot ( nV , oa ) ; ob *= smoothstep ( _0_0 , _1_0 , ( ob - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; n_ *= ob ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],STATEMENTS:[{TYPE:"txt",TOKENS:"n_ *= max ( LAMP_LIGHT_DIST - aG , _0_0 ) / LAMP_LIGHT_DIST ;".split(" ")}]}]},{TYPE:"txt",
TOKENS:["nX","*=","n_",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"nV = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{TYPE:"node",NAME:"DIFFUSE_FRESNEL",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"od",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oe",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"of",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"og",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oc , o . xyz ) ; oe = cross ( oi , o . xyz ) ; oe = - normalize ( oe ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oh = _0_0 ; if ( od . r != _0_0 ) { float oj = ( _1_0 - of ) * dot ( oe , oc ) + of ; if ( og [ 0 ] == _0_0 ) { oh = _1_0 ; } else { float t = _1_0 + abs ( oj ) ; t = og [ 1 ] + ( _1_0 - og [ 1 ] ) * pow ( t , og [ 0 ] ) ; oh = clamp ( t , _0_0 , _1_0 ) ; } oh = max ( oh , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_LAMBERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"ok",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ol",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"om",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"on",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oo",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],
STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( ok , o . xyz ) ; om = cross ( oi , o . xyz ) ; om = - normalize ( om ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oo = _0_0 ; if ( ol . r != _0_0 ) { float oj = ( _1_0 - on ) * dot ( om , ok ) + on ; oo = max ( oj , _0_0 ) ; }".split(" ")}]},{TYPE:"node",NAME:"DIFFUSE_OREN_NAYAR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"op",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oq",QUALIFIER:["vec2"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"or",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"os",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ot",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ou",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( op , o . xyz ) ; or = cross ( oi , o . xyz ) ; or = - normalize ( or ) ;".split(" ")}]}]},{TYPE:"txt",
TOKENS:"ou = _0_0 ; if ( oq . r != _0_0 ) { float oj = ( _1_0 - os ) * dot ( or , op ) + os ; if ( ot [ 0 ] > _0_0 ) { float ov = max ( dot ( or , v ) , _0_0 ) ; float ow = ot [ 0 ] * ot [ 0 ] ; float ck = _1_0 - _0_5 * ( ow / ( ow + 0.33 ) ) ; vec3 ox = op - oj * or ; vec3 oy = v - ov * or ; if ( length ( ox ) == _0_0 || length ( oy ) == _0_0 || abs ( oj ) > _1_0 || abs ( ov ) > _1_0 ) ou = oj * ck ; else { float oz = acos ( oj ) ; float oA = acos ( ov ) ; vec3 oB = normalize ( ox ) ; vec3 oC = normalize ( oy ) ; float a , b ; a = max ( oz , oA ) ; b = min ( oz , oA ) ; b *= 0.95 ; float t = max ( dot ( oB , oC ) , _0_0 ) ; float oD = 0.45 * ( ow / ( ow + 0.09 ) ) ; ou = oj * ( ck + ( oD * t * sin ( a ) * tan ( b ) ) ) ; } } else ou = oj ; ou = max ( ou , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_MINNAERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oF",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oI",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oE , o . xyz ) ; oG = cross ( oi , o . xyz ) ; oG = - normalize ( oG ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oJ = _0_0 ; if ( oF . r != _0_0 ) { float oj = ( _1_0 - oH ) * dot ( oG , oE ) + oH ; float ov = max ( dot ( oG , v ) , _0_0 ) ; if ( oI [ 0 ] <= _1_0 ) oJ = oj * pow ( max ( ov * oj , 0.1 ) , oI [ 0 ] - _1_0 ) ; else oJ = oj * pow ( 1.0001 - ov , oI [ 0 ] - _1_0 ) ; oJ = max ( oJ , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oL",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oO",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oK , o . xyz ) ; oM = cross ( oi , o . xyz ) ; oM = - normalize ( oM ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oP = _0_0 ; if ( oL . r != _0_0 ) { float oj = ( _1_0 - oN ) * dot ( oM , oK ) + oN ; float oQ = acos ( oj ) ; if ( oQ < oO [ 0 ] ) oP = _1_0 ; else if ( oQ > ( oO [ 0 ] + oO [ 1 ] ) || oO [ 1 ] == _0_0 ) oP = _0_0 ; else oP = _1_0 - ( ( oQ - oO [ 0 ] ) / oO [ 1 ] ) ; oP = max ( oP , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"SPECULAR_PHONG",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oS",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oV",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oW",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"oW = _0_0 ; if ( oS . g != _0_0 ) { vec3 oX = normalize ( oR + v ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( oU == _0_0 ) { oW = dot ( o . xyz , oX ) ; oW = sqrt ( _1_0 - oW * oW ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"oW = ( _1_0 - oU ) * max ( dot ( oT , oX ) , _0_0 ) + oU ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oW = pow ( oW , oV [ 0 ] ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_COOKTORR",
NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oZ",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"o_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pa",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pb",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pc",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pc = _0_0 ; if ( oZ . g != _0_0 ) { vec3 oX = normalize ( oY + v ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( pa == _0_0 ) { pc = dot ( o . xyz , oX ) ; pc = sqrt ( _1_0 - pc * pc ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"pc = max ( dot ( o_ , oX ) , _0_0 ) ; pc = ( _1_0 - pa ) * pc + pa ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float ov = max ( dot ( o . xyz , v ) , _0_0 ) ; ov = sqrt ( _1_0 - ov * ov ) ;".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float ov = max ( dot ( o_ , v ) , _0_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"pc = pow ( pc , pb [ 0 ] ) ; pc = pc / ( 0.1 + ov ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_WARDISO",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pe",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"pg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ph",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pi",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pi = _0_0 ; if ( pe . g != _0_0 ) { vec3 oX = normalize ( pd + v ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = _0_0 ; float ov = _0_0 ; float pk = _0_0 ; if ( pg == _0_0 ) { pj = dot ( o . xyz , oX ) ; ov = dot ( o . xyz , v ) ; pk = dot ( o . xyz , pd ) ; pj = sqrt ( _1_0 - pj * pj ) ; ov = sqrt ( _1_0 - ov * ov ) ; pk = sqrt ( _1_0 - pk * pk ) ; }".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = max ( dot ( pf , oX ) , 0.01 ) ; float ov = max ( dot ( pf , v ) , 0.01 ) ; float pk = max ( dot ( pf , pd ) , 0.01 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"float bp = tan ( acos ( pj ) ) ; float L = max ( ph [ 0 ] , 0.01 ) ; pi = pk * ( _1_0 / ( 4.0 * M_PI * L * L ) ) * ( exp ( - ( bp * bp ) / ( L * L ) ) / ( sqrt ( ov * pk ) ) ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",
TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pm",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"po",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pr",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pu = _0_0 ; if ( pm . g != _0_0 ) { vec3 bS = normalize ( pl + v ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pv = dot ( bS , o . xyz ) ; float bp = pr [ 0 ] + pr [ 1 ] ; if ( po == _0_0 ) bp = acos ( sqrt ( _1_0 - pv * pv ) ) ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float bp = acos ( dot ( bS , pn ) ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"if ( bp < pr [ 0 ] ) pu = _1_0 ; else if ( bp >= pr [ 0 ] + pr [ 1 ] || pr [ 1 ] == _0_0 ) pu = _0_0 ; else pu = _1_0 - ( bp - pr [ 0 ] ) / pr [ 1 ] ; }".split(" ")}]},
{TYPE:"node",NAME:"SPECULAR_BLINN",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pw",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"px",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"py",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pA",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pB",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"pB = _0_0 ; if ( px . g != _0_0 ) { if ( pA [ 0 ] < 1.0 || pA [ 1 ] == _0_0 ) pB = _0_0 ; else { if ( pA [ 1 ] < 100.0 ) pA [ 1 ] = sqrt ( 1.0 / pA [ 1 ] ) ; else pA [ 1 ] = 10.0 / pA [ 1 ] ; vec3 oX = normalize ( v + pw ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = 0.0 ; if ( pz == _0_0 ) { float pC = dot ( o . xyz , oX ) ; pj = sqrt ( _1_0 - pC * pC ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",
TOKENS:"float pj = ( _1_0 - pz ) * max ( dot ( py , oX ) , _0_0 ) + pz ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"if ( pj < _0_0 ) pB = _0_0 ; else { float ov = max ( dot ( py , v ) , 0.01 ) ; float pk = dot ( py , pw ) ; if ( pk <= 0.01 ) pB = _0_0 ; else { float pD = max ( dot ( v , oX ) , 0.01 ) ; float a = _1_0 ; float b = ( 2.0 * pj * ov ) / pD ; float de = ( 2.0 * pj * pk ) / pD ; float g = min ( min ( a , b ) , de ) ; float p = sqrt ( pow ( pA [ 0 ] , 2.0 ) + pow ( pD , 2.0 ) - _1_0 ) ; float ln = pow ( p - pD , 2.0 ) / pow ( p + pD , 2.0 ) * ( _1_0 + pow ( pD * ( p + pD ) - _1_0 , 2.0 ) / pow ( pD * ( p - pD ) + _1_0 , 2.0 ) ) ; float oQ = acos ( pj ) ; pB = max ( ln * g * exp ( - pow ( oQ , 2.0 ) / ( 2.0 * pow ( pA [ 1 ] , 2.0 ) ) ) , _0_0 ) ; } } } }".split(" ")}]},
{TYPE:"node",NAME:"LIGHTING_APPLY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"pE",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pK",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"pL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pP",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pQ = pF + pN * pM * pH ; pP = pE + vec4 ( pN * pL * pG , pH ) ;".split(" ")}]},{TYPE:"node",NAME:"LIGHTING_END",NODE_VARS:[],
DECLARATIONS:[{TYPE:"node_in",NAME:"pR",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pS",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"A = pR . rgb ; nE = pS ;".split(" ")}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:"void ct ( vec3 nt , vec3 nu , vec3 nv , vec3 nw , vec3 nx , vec3 ny , vec3 v , vec2 nz , vec2 nA , vec4 nB , float nC , vec4 nD , out vec3 A , out vec3 nE ) {".split(" ")},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/math.glslv"]={TYPE:"grp",
PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"MATH_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"MATH_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"EPSILON",TOKENS:["0.000001"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"txt",TOKENS:"struct ak { vec3 O ; vec3 ad ; vec3 R ; vec3 as ; vec3 S ; vec3 Q ; vec3 aK ; } ; bool em ( vec3 a , vec3 b ) { return any ( lessThan ( abs ( a - b ) , vec3 ( EPSILON ) ) ) ; } vec3 P ( in vec4 q , in vec3 kj ) { return kj + 2.0 * cross ( q . xyz , cross ( q . xyz , kj ) + q . w * kj ) ; } vec4 kk ( in vec4 gJ ) { return vec4 ( - gJ . xyz , gJ . w ) ; } vec4 pT ( in vec4 a , in vec4 b ) { vec4 gL ; gL . x = a . x * b . w + a . w * b . x + a . y * b . z - a . z * b . y ; gL . y = a . y * b . w + a . w * b . y + a . z * b . x - a . x * b . z ; gL . z = a . z * b . w + a . w * b . z + a . x * b . y - a . y * b . x ; gL . w = a . w * b . w - a . x * b . x - a . y * b . y - a . z * b . z ; return gL ; } vec4 cM ( in vec3 pU , in float pV ) { vec4 gL ; pV = pV * 0.5 ; float s = sin ( pV ) ; gL . x = s * pU [ 0 ] ; gL . y = s * pU [ 1 ] ; gL . z = s * pU [ 2 ] ; gL . w = cos ( pV ) ; return gL ; } vec4 pY ( in vec3 bj , in vec3 pW ) { vec4 gL ; float dj = dot ( pW , bj ) ; vec3 pX = cross ( pW , bj ) ; gL . xyz = pX . xyz ; gL . w = 1.0 + dj ; return normalize ( gL ) ; } vec3 p_ ( vec4 pZ , vec4 gJ , vec3 gK ) { vec3 gL = gK * pZ . w ; gL = P ( gJ , gL ) ; gL += pZ . xyz ; return gL ; } vec3 ae ( mat3 qa , vec3 gK ) { vec3 gL = gK * qa [ 1 ] [ 0 ] ; vec4 gJ = vec4 ( qa [ 1 ] [ 1 ] , qa [ 1 ] [ 2 ] , qa [ 2 ] [ 0 ] , qa [ 2 ] [ 1 ] ) ; gL = P ( gJ , gL ) ; gL += qa [ 0 ] ; return gL ; } vec3 qb ( vec4 pZ , vec4 gJ , vec3 bj ) { vec3 gL = bj * pZ . w ; gL = P ( gJ , gL ) ; return gL ; } vec3 U ( mat3 qa , vec3 bj ) { vec3 gL = bj * qa [ 1 ] [ 0 ] ; vec4 gJ = vec4 ( qa [ 1 ] [ 1 ] , qa [ 1 ] [ 2 ] , qa [ 2 ] [ 0 ] , qa [ 2 ] [ 1 ] ) ; gL = P ( gJ , gL ) ; return gL ; } vec3 qc ( vec4 pZ , vec4 gJ , vec3 gK ) { vec3 gL = gK - pZ . xyz ; gL = P ( kk ( gJ ) , gL ) ; gL /= pZ . w ; return gL ; } vec3 qd ( vec4 pZ , vec4 gJ , vec3 bj ) { return P ( kk ( gJ ) , bj ) / pZ . w ; } mat4 qe ( ) { return mat4 ( _1_0 , _0_0 , _0_0 , _0_0 , _0_0 , _1_0 , _0_0 , _0_0 , _0_0 , _0_0 , _1_0 , _0_0 , _0_0 , _0_0 , _0_0 , _1_0 ) ; } mat4 qf ( float bp ) { return mat4 ( _1_0 , _0_0 , _0_0 , _0_0 , _0_0 , cos ( bp ) , sin ( bp ) , _0_0 , _0_0 , - sin ( bp ) , cos ( bp ) , _0_0 , _0_0 , _0_0 , _0_0 , _1_0 ) ; } mat4 qg ( float bp ) { return mat4 ( cos ( bp ) , _0_0 , - sin ( bp ) , _0_0 , _0_0 , _1_0 , _0_0 , _0_0 , sin ( bp ) , _0_0 , cos ( bp ) , _0_0 , _0_0 , _0_0 , _0_0 , _1_0 ) ; } mat4 qh ( float bp ) { return mat4 ( cos ( bp ) , sin ( bp ) , _0_0 , _0_0 , - sin ( bp ) , cos ( bp ) , _0_0 , _0_0 , _0_0 , _0_0 , _1_0 , _0_0 , _0_0 , _0_0 , _0_0 , _1_0 ) ; } ak lb ( in ak kj ) { return ak ( kj . O , kj . ad , normalize ( kj . R ) , normalize ( kj . as ) , normalize ( kj . S ) , normalize ( kj . Q ) , kj . aK ) ; }".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{TYPE:"logical_or_expr",PLACES:4}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 bG ( vec4 at ) { float au = at . x ; float av = at . y ; float aw = at . w ; vec3 qi ; qi . x = ( au + aw ) / 2.0 ; qi . y = ( av + aw ) / 2.0 ; qi . z = aw ; return qi ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"mat3 cK ( ) { return mat3 ( _0_0 , _0_0 , _0_0 , _1_0 , _0_0 , _0_0 , _0_0 , _1_0 , _0_0 ) ; } mat4 aV ( mat3 t ) { mat4 qj ; qj [ 0 ] [ 0 ] = ( _1_0 - ( t [ 1 ] [ 2 ] * ( t [ 1 ] [ 2 ] + t [ 1 ] [ 2 ] ) + t [ 2 ] [ 0 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) ) ) * t [ 1 ] [ 0 ] ; qj [ 0 ] [ 1 ] = ( t [ 1 ] [ 1 ] * ( t [ 1 ] [ 2 ] + t [ 1 ] [ 2 ] ) + t [ 2 ] [ 1 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) ) * t [ 1 ] [ 0 ] ; qj [ 0 ] [ 2 ] = ( t [ 1 ] [ 1 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) - t [ 2 ] [ 1 ] * ( t [ 1 ] [ 2 ] + t [ 1 ] [ 2 ] ) ) * t [ 1 ] [ 0 ] ; qj [ 0 ] [ 3 ] = _0_0 ; qj [ 1 ] [ 0 ] = ( t [ 1 ] [ 1 ] * ( t [ 1 ] [ 2 ] + t [ 1 ] [ 2 ] ) - t [ 2 ] [ 1 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) ) * t [ 1 ] [ 0 ] ; qj [ 1 ] [ 1 ] = ( _1_0 - ( t [ 1 ] [ 1 ] * ( t [ 1 ] [ 1 ] + t [ 1 ] [ 1 ] ) + t [ 2 ] [ 0 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) ) ) * t [ 1 ] [ 0 ] ; qj [ 1 ] [ 2 ] = ( t [ 1 ] [ 2 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) + t [ 2 ] [ 1 ] * ( t [ 1 ] [ 1 ] + t [ 1 ] [ 1 ] ) ) * t [ 1 ] [ 0 ] ; qj [ 1 ] [ 3 ] = _0_0 ; qj [ 2 ] [ 0 ] = ( t [ 1 ] [ 1 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) + t [ 2 ] [ 1 ] * ( t [ 1 ] [ 2 ] + t [ 1 ] [ 2 ] ) ) * t [ 1 ] [ 0 ] ; qj [ 2 ] [ 1 ] = ( t [ 1 ] [ 2 ] * ( t [ 2 ] [ 0 ] + t [ 2 ] [ 0 ] ) - t [ 2 ] [ 1 ] * ( t [ 1 ] [ 1 ] + t [ 1 ] [ 1 ] ) ) * t [ 1 ] [ 0 ] ; qj [ 2 ] [ 2 ] = ( _1_0 - ( t [ 1 ] [ 1 ] * ( t [ 1 ] [ 1 ] + t [ 1 ] [ 1 ] ) + t [ 1 ] [ 2 ] * ( t [ 1 ] [ 2 ] + t [ 1 ] [ 2 ] ) ) ) * t [ 1 ] [ 0 ] ; qj [ 2 ] [ 3 ] = _0_0 ; qj [ 3 ] [ 0 ] = t [ 0 ] [ 0 ] ; qj [ 3 ] [ 1 ] = t [ 0 ] [ 1 ] ; qj [ 3 ] [ 2 ] = t [ 0 ] [ 2 ] ; qj [ 3 ] [ 3 ] = 1.0 ; return qj ; } mat3 aS ( in mat3 qa , in mat3 qk ) { mat3 gL ; vec3 gK = qk [ 0 ] ; vec4 pZ = vec4 ( qa [ 0 ] , qa [ 1 ] [ 0 ] ) ; vec4 gJ = vec4 ( qa [ 1 ] [ 1 ] , qa [ 1 ] [ 2 ] , qa [ 2 ] [ 0 ] , qa [ 2 ] [ 1 ] ) ; gL [ 0 ] = p_ ( pZ , gJ , gK ) ; gL [ 1 ] [ 0 ] = qa [ 1 ] [ 0 ] * qk [ 1 ] [ 0 ] ; gL [ 1 ] [ 1 ] = qa [ 1 ] [ 1 ] * qk [ 2 ] [ 1 ] + qa [ 2 ] [ 1 ] * qk [ 1 ] [ 1 ] + qa [ 1 ] [ 2 ] * qk [ 2 ] [ 0 ] - qa [ 2 ] [ 0 ] * qk [ 1 ] [ 2 ] ; gL [ 1 ] [ 2 ] = qa [ 1 ] [ 2 ] * qk [ 2 ] [ 1 ] + qa [ 2 ] [ 1 ] * qk [ 1 ] [ 2 ] + qa [ 2 ] [ 0 ] * qk [ 1 ] [ 1 ] - qa [ 1 ] [ 1 ] * qk [ 2 ] [ 0 ] ; gL [ 2 ] [ 0 ] = qa [ 2 ] [ 0 ] * qk [ 2 ] [ 1 ] + qa [ 2 ] [ 1 ] * qk [ 2 ] [ 0 ] + qa [ 1 ] [ 1 ] * qk [ 1 ] [ 2 ] - qa [ 1 ] [ 2 ] * qk [ 1 ] [ 1 ] ; gL [ 2 ] [ 1 ] = qa [ 2 ] [ 1 ] * qk [ 2 ] [ 1 ] - qa [ 1 ] [ 1 ] * qk [ 1 ] [ 1 ] - qa [ 1 ] [ 2 ] * qk [ 1 ] [ 2 ] - qa [ 2 ] [ 0 ] * qk [ 2 ] [ 0 ] ; return gL ; } mat3 cO ( in vec4 gJ , in mat3 qa ) { mat3 gL ; gL [ 0 ] = qa [ 0 ] ; gL [ 1 ] [ 0 ] = qa [ 1 ] [ 0 ] ; gL [ 1 ] [ 1 ] = gJ [ 0 ] ; gL [ 1 ] [ 2 ] = gJ [ 1 ] ; gL [ 2 ] [ 0 ] = gJ [ 2 ] ; gL [ 2 ] [ 1 ] = gJ [ 3 ] ; return gL ; }".split(" ")}]}}]}]};
a["include/mirror.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"MIRROR_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"MIRROR_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2},"REFLECTION_TYPE",
"REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"REFL_BUMP",TOKENS:["0.1"]},{TYPE:"txt",TOKENS:"float ql ( in vec3 u , vec3 ea , float eg , float ef ) { vec3 ed = normalize ( ea + u ) ; float ee = 1.0 - dot ( u , ed ) ; float r = ef + ( 1.0 - ef ) * pow ( ee , eg ) ; return r ; } void cu ( inout vec3 qm , vec3 u , vec3 Q , float qn , mat3 N ) { vec3 ea = reflect ( - u , Q ) ; float eg = u_fresnel_params [ 2 ] ; float ef = u_fresnel_params [ 3 ] ; float r = 1.0 ; if ( eg != 0.0 ) r = ql ( u , ea , eg , ef ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_TYPE","REFL_CUBE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ec = GLSL_TEXTURE_CUBE ( u_cube_reflection , ea ) . xyz ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_NONE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 qo = u_refl_plane . xyz * dot ( Q , u_refl_plane . xyz ) ; vec3 qr = Q - qo ; vec2 qu = U ( N , qr ) . xy ; vec2 qv = h . xy / h . z ; qv += qu * REFL_BUMP ; vec3 ec = GLSL_TEXTURE ( u_plane_reflection , qv ) . rgb ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ec = vec3 ( 1.0 ) ; qn = 0.0 ;".split(" ")}]}}]}]}},{TYPE:"elif",EXPRESSION:["REFLECTION_TYPE","REFL_MIRRORMAP",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ec = GLSL_TEXTURE_CUBE ( u_mirrormap , ea ) . xyz ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"cb ( ec . rgb ) ; qm = mix ( qm , ec , qn * r ) ; }".split(" ")}]}}]}]}}]}]};a["include/nodes.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",
NAME:"NODES_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"NODES_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"DOUBLE_SIDED_LIGHTING",TOKENS:["0"]},{TYPE:"var",NAME:"INVERT_FRONTFACING",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION",TOKENS:["0"]},{TYPE:"var",NAME:"HAS_REFRACT_TEXTURE",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_TYPE",TOKENS:["REFL_NONE"]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"mirror.glslf"},{TYPE:"include",FILE:"shadow.glslf"},{TYPE:"include",FILE:"environment.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"refraction.glslf"}]}}]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["GLSL_IN","vec3","qw",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_B4W_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 qz ( in vec3 qx , in float qy ) { vec3 eu = vec3 ( _0_0 ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"eu = cw ( h , qx . xy * qy ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["HAS_REFRACT_TEXTURE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"eu = GLSL_TEXTURE ( u_refractmap , h . xy / h . z ) . rgb ; cb ( eu ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["return","eu",";","}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 jz ( vec3 rgb ) { vec4 jy = vec4 ( _0_0 , - _1_0 / 3.0 , 2.0 / 3.0 , - _1_0 ) ; vec4 p = mix ( vec4 ( rgb . bg , jy . wz ) , vec4 ( rgb . gb , jy . xy ) , step ( rgb . b , rgb . g ) ) ; vec4 q = mix ( vec4 ( p . xyw , rgb . r ) , vec4 ( rgb . r , p . yzx ) , step ( p . x , rgb . r ) ) ; float dj = q . x - min ( q . w , q . y ) ; float hR = 1.0e-10 ; return vec3 ( abs ( q . z + ( q . w - q . y ) / ( 6.0 * dj + hR ) ) , dj / ( q . x + hR ) , q . x ) ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 jB ( vec3 jA ) { vec4 jy = vec4 ( _1_0 , 2.0 / 3.0 , _1_0 / 3.0 , 3.0 ) ; vec3 p = abs ( fract ( vec3 ( jA . r , jA . r , jA . r ) + jy . xyz ) * 6.0 - jy . www ) ; return jA . b * mix ( jy . xxx , clamp ( p - jy . xxx , _0_0 , _1_0 ) , jA . g ) ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 qA ( vec2 gm ) { return vec3 ( gm * 2.0 - vec2 ( _1_0 , _1_0 ) , _0_0 ) ; }".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 qB ( vec3 gK ) { return vec2 ( gK . xy * _0_5 + vec2 ( _0_5 , _0_5 ) ) ; }".split(" ")}]}}]},
{TYPE:"node",NAME:"CAMERA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"qU",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"qV",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"qW",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_qU"],STATEMENTS:[{TYPE:"txt",TOKENS:"qU = normalize ( qR . xyz ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_qV"],STATEMENTS:[{TYPE:"txt",TOKENS:"qV = abs ( qR . z ) ;".split(" ")}]}]},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_qW"],STATEMENTS:[{TYPE:"txt",TOKENS:"qW = length ( qR . xyz ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"COMBRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"qX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"q_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"q_ = vec3 ( qX , qY , qZ ) ;".split(" ")}]},
{TYPE:"node",NAME:"COMBHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"re",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rf = jB ( vec3 ( rc , rd , re ) ) ;".split(" ")}]},{TYPE:"node",NAME:"EMPTY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rh",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"rh = vec3 ( - _1_0 , - _1_0 , _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"EMPTY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"ri",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ri = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qC",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rj = qA ( qC ) ;".split(" ")}]},
{TYPE:"node",NAME:"GEOMETRY_OR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rk = 2.0 * qw - vec3 ( _1_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qD",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rl = max ( vec3 ( _0_0 ) , qD ) ; cb ( rl ) ;".split(" ")}]},{TYPE:"node",
NAME:"GEOMETRY_VC1",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qE",QUALIFIER:["GLSL_IN","float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rm = max ( _0_0 , qE ) ; cb ( rm ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_VC2",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ro",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qF",QUALIFIER:["GLSL_IN",
"vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rn = max ( _0_0 , qF [ 0 ] ) ; ro = max ( _0_0 , qF [ 1 ] ) ; cb ( rn ) ; cb ( ro ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_VC3",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rs",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qG",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"rp = max ( _0_0 , qG [ 0 ] ) ; rq = max ( _0_0 , qG [ 1 ] ) ; rs = max ( _0_0 , qG [ 2 ] ) ; cb ( rp ) ; cb ( rq ) ; cb ( rs ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_NO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rt",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rt = qP . xyz ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_FB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"ru",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["INVERT_FRONTFACING"],STATEMENTS:[{TYPE:"txt",TOKENS:"ru = ( gl_FrontFacing ) ? _0_0 : _1_0 ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"ru = ( gl_FrontFacing ) ? _1_0 : _0_0 ;".split(" ")}]}]}]},{TYPE:"node",NAME:"GEOMETRY_VW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rv",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rv = - U ( F , v ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_LO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rw",
QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rw [ 0 ] = qR [ 0 ] ; rw [ 1 ] = qR [ 1 ] ; rw [ 2 ] = qR [ 2 ] ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_GL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rx",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rx = vec3 ( nx . r , nx . g , nx . b ) ;".split(" ")}]},{TYPE:"node",NAME:"NEW_GEOMETRY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"ry",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rz",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rF",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ry = vec3 ( _0_0 ) ; rz = vec3 ( _0_0 ) ; rA = vec3 ( _0_0 ) ; rB = vec3 ( _0_0 ) ; rC = vec3 ( _0_0 ) ; rD = vec3 ( _0_0 ) ; rE = _0_0 ; rF = _0_0 ;".split(" ")}]},
{TYPE:"node",NAME:"HUE_SAT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 jA = jz ( rK ) ; jA [ 0 ] += ( rG - _0_5 ) ; if ( jA [ 0 ] > _1_0 ) jA [ 0 ] -= _1_0 ; else if ( jA [ 0 ] < _0_0 ) jA [ 0 ] += _1_0 ; jA *= vec3 ( _1_0 , rH , rI ) ; jA = mix ( vec3 ( _1_0 ) , mix ( vec3 ( _0_0 ) , jA , step ( vec3 ( _0_0 ) , jA ) ) , step ( jA , vec3 ( _1_0 ) ) ) ; rL = mix ( rK , jB ( jA ) , rJ ) ;".split(" ")}]},
{TYPE:"node",NAME:"INVERT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rO = mix ( rN , vec3 ( _1_0 ) - rN , rM ) ;".split(" ")}]},{TYPE:"node",NAME:"LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_INDEX",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",
TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"rP",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"rQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rS",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_rP"],STATEMENTS:[{TYPE:"txt",TOKENS:"rP = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"vec3 rT = u_lamp_light_directions [ LAMP_INDEX ] ; vec3 rU = u_lamp_light_positions [ LAMP_INDEX ] ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"rQ = - c + rU ; rR = length ( rQ ) ; rQ = normalize ( rQ ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rS"],STATEMENTS:[{TYPE:"txt",TOKENS:"rS = LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + rR * rR ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"float ob = dot ( rQ , rT ) ; ob *= smoothstep ( _0_0 , _1_0 , ( ob - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; rS *= ob ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],
STATEMENTS:[{TYPE:"txt",TOKENS:"rS *= max ( LAMP_LIGHT_DIST - rR , _0_0 ) / LAMP_LIGHT_DIST ;".split(" ")}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rQ"],STATEMENTS:[{TYPE:"txt",TOKENS:["rQ","=","rT",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rR"],STATEMENTS:[{TYPE:"txt",TOKENS:"rR = length ( rU - c ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rS"],STATEMENTS:[{TYPE:"txt",
TOKENS:["rS","=","_1_0",";"]}]}]}]}]}]},{TYPE:"node",NAME:"NORMAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rW",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"rX",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"qH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rW"],STATEMENTS:[{TYPE:"txt",TOKENS:["rW","=","qH",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_rX"],STATEMENTS:[{TYPE:"txt",TOKENS:"rX = - dot ( rV , qH ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"B4W_VECTOR_VIEW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rZ = - U ( F , rY ) ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_ANISOTROPIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"r_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sa",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"se",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sf = r_ ; sa ; sb ; sc ; sd ; se ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_DIFFUSE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"sg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"si",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sj = sg ; sh ; si ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_GLASS",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sm",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"so",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"so = sk ; sl ; sm ; sn ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_GLOSSY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"su",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sw",
QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sw = sr ; su ; sv ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_HAIR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sB",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sB = sx ; sy ; sz ; sA ;".split(" ")}]},
{TYPE:"node",NAME:"BSDF_TRANSPARENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sD","=","sC",";"]}]},{TYPE:"node",NAME:"BSDF_TRANSLUCENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sG",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"sG = sE ; sF ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sL [ 0 ] = sL [ 1 ] = sL [ 2 ] = _0_0 ; sH ; sI ; sJ ; sK ;".split(" ")}]},
{TYPE:"node",NAME:"BSDF_TOON",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sQ = sM ; sN ; sO ; sP ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_VELVET",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"sR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sU",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sU = sR ; sS ; sT ;".split(" ")}]},{TYPE:"node",NAME:"SUBSURFACE_SCATTERING",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"sX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"s_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ta",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ta [ 0 ] = ta [ 1 ] = ta [ 2 ] = _0_0 ; sV ; sX ; sY ; sZ ; s_ ; sW ;".split(" ")}]},{TYPE:"node",NAME:"EMISSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tb",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"td",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"td = tb ; tc ;".split(" ")}]},{TYPE:"node",NAME:"AMBIENT_OCCLUSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"te",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tf [ 0 ] = tf [ 1 ] = tf [ 2 ] = _0_0 ; te ;".split(" ")}]},{TYPE:"node",NAME:"HOLDOUT",
NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tg",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tg [ 0 ] = tg [ 1 ] = tg [ 2 ] = _0_0 ;".split(" ")}]},{TYPE:"node",NAME:"VOLUME_ABSORPTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"th",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ti",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tj [ 0 ] = tj [ 1 ] = tj [ 2 ] = _0_0 ; th ; ti ;".split(" ")}]},
{TYPE:"node",NAME:"VOLUME_SCATTER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tn [ 0 ] = tn [ 1 ] = tn [ 2 ] = _0_0 ; tk ; tl ; tm ;".split(" ")}]},{TYPE:"node",NAME:"BUMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"to",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tw",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tw = tv ; to ; tr ; tu ;".split(" ")}]},{TYPE:"node",NAME:"NORMAL_MAP",NODE_VARS:[{TYPE:"node_var",NAME:"SPACE",TOKENS:["NM_TANGENT"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"tx",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"ty",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","tA","=","ny",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SPACE","NM_TANGENT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tz = 2.0 * ty . xyz - _1_0 ; tz = qQ * tz ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_OBJECT",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_OBJECT",{TYPE:"equal_expr",
PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tz = 2.0 * ty . xyz - _1_0 ; tz . yz *= - 1.0 ; tz = U ( H , tz ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_WORLD",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_WORLD",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tz = 2.0 * ty . xyz - _1_0 ; tz . yz *= - 1.0 ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"tz = normalize ( mix ( tA , tz , tx ) ) ;".split(" ")}]},
{TYPE:"node",NAME:"VECT_TRANSFORM",NODE_VARS:[{TYPE:"node_var",NAME:"CONVERT_TYPE",TOKENS:["VT_WORLD_TO_OBJECT"]},{TYPE:"node_var",NAME:"VECTOR_TYPE",TOKENS:["VT_VECTOR"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"tB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_WORLD",{TYPE:"equal_expr",PLACES:2},"CONVERT_TYPE","VT_OBJECT_TO_OBJECT",{TYPE:"equal_expr",PLACES:2},
"CONVERT_TYPE","VT_CAMERA_TO_CAMERA",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],STATEMENTS:[{TYPE:"txt",TOKENS:["tC","=","tB",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_POINT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( F , tB ) ;".split(" ")}]},{TYPE:"node_elif",
EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( I , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( H , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( H , tB ) ; tC = ae ( F , tC ) ;".split(" ")}]},{TYPE:"node_elif",
EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( G , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( G , tB ) ; tC = ae ( I , tC ) ;".split(" ")}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",
TOKENS:"tC = U ( F , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( I , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( H , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( H , tB ) ; tC = U ( F , tC ) ;".split(" ")}]},
{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( G , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( G , tB ) ; tC = U ( I , tC ) ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_NORMAL",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = normalize ( tC ) ;".split(" ")}]}]}]}]}]},
{TYPE:"node",NAME:"BLACKBODY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tE",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tE [ 0 ] = tE [ 1 ] = tE [ 2 ] = _0_0 ; tD ;".split(" ")}]},{TYPE:"node",NAME:"WAVELENGTH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tG",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tG [ 0 ] = tG [ 1 ] = tG [ 2 ] = _0_0 ; tF ;".split(" ")}]},
{TYPE:"node",NAME:"SEPXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tK",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tI = tH [ 0 ] ; tJ = tH [ 1 ] ; tK = tH [ 2 ] ;".split(" ")}]},{TYPE:"node",NAME:"COMBXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tL",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tO [ 0 ] = tL ; tO [ 1 ] = tM ; tO [ 2 ] = tN ;".split(" ")}]},{TYPE:"node",NAME:"BRIGHTCONTRAST",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tR",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tS",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float b = tQ - tR * _0_5 ; tS = max ( ( _1_0 + tR ) * tP + b , vec3 ( _0_0 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"LIGHT_FALLOFF",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tW",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tX",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tV = tW = tX = _0_0 ; tT ; tU ;".split(" ")}]},{TYPE:"node",NAME:"TEX_IMAGE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"t_",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tZ [ 0 ] = tZ [ 1 ] = tZ [ 2 ] = _0_0 ; t_ = _1_0 ; tY ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_ENVIRONMENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ua",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ub",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ub [ 0 ] = ub [ 1 ] = ub [ 2 ] = _0_0 ; ua ;".split(" ")}]},{TYPE:"node",NAME:"TEX_SKY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ud",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ud [ 0 ] = ud [ 1 ] = ud [ 2 ] = _0_0 ; uc ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_NOISE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ue",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ug",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ui",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uj",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ui [ 0 ] = ui [ 1 ] = ui [ 2 ] = _0_0 ; uj = _1_0 ; ue ; uf ; ug ; uh ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_WAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ul",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"um",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"un",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"up",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uq",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"up [ 0 ] = up [ 1 ] = up [ 2 ] = _0_0 ; uq = _1_0 ; uk ; ul ; um ; un ; uo ;".split(" ")}]},{TYPE:"node",NAME:"TEX_VORONOI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ur",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"us",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ut",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ut [ 0 ] = ut [ 1 ] = ut [ 2 ] = _0_0 ; uu = _1_0 ; ur ; us ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_MUSGRAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ux",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"uC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"uC [ 0 ] = uC [ 1 ] = uC [ 2 ] = _0_0 ; uD = _1_0 ; uv ; uw ; ux ; uy ; uz ; uA ; uB ;".split(" ")}]},{TYPE:"node",NAME:"TEX_GRADIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"uF [ 0 ] = uF [ 1 ] = uF [ 2 ] = _0_0 ; uG = _1_0 ; uE ;".split(" ")}]},{TYPE:"node",NAME:"TEX_MAGIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"uK [ 0 ] = uK [ 1 ] = uK [ 2 ] = _0_0 ; uL = _1_0 ; uH ; uI ; uJ ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_CHECKER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uR",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"uQ [ 0 ] = uQ [ 1 ] = uQ [ 2 ] = _0_0 ; uR = _1_0 ; uM ; uN ; uO ; uP ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_BRICK",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"uZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"u_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"va",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"va [ 0 ] = va [ 1 ] = va [ 2 ] = _0_0 ; vb = _1_0 ; uS ; uT ; uU ; uV ; uW ; uX ; uY ; uZ ; u_ ;".split(" ")}]},{TYPE:"node",NAME:"ADD_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"vd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ve",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ve = clamp ( vc + vd , vec3 ( _0_0 ) , vec3 ( _1_0 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"MIX_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vi",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( vf , _0_0 , _1_0 ) ; vi = vj * vg + ( _1_0 - vj ) * vh ;".split(" ")}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qI",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vk"],STATEMENTS:[{TYPE:"txt",TOKENS:"vk = qA ( qI ) ;".split(" ")}]}]},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vl"],STATEMENTS:[{TYPE:"txt",TOKENS:"vl = vec3 ( qI , _0_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qJ",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vm = vec3 ( qJ , _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_NO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vn",
QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vn","=","ny",";"]}]},{TYPE:"node",NAME:"TEX_COORD_GE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vo",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vo","=","qw",";"]}]},{TYPE:"node",NAME:"TEX_COORD_OB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vp",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vp [ 0 ] = vp [ 1 ] = vp [ 2 ] = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_CA",
NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vq [ 0 ] = qR [ 0 ] ; vq [ 1 ] = qR [ 1 ] ; vq [ 2 ] = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_WI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vr",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vr [ 0 ] = vr [ 1 ] = vr [ 2 ] = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_RE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vs",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vs [ 0 ] = vs [ 1 ] = vs [ 2 ] = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vt",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qK",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vt = vec3 ( qK , _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"PARTICLE_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"vv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vz",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vA",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vu = _0_0 ; vv = _0_0 ; vw = _0_0 ; vx = vec3 ( _0_0 ) ; vy = _0_0 ; vz = vx ; vA = vx ;".split(" ")}]},{TYPE:"node",
NAME:"HAIR_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vE",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vB = _0_0 ; vC = _0_0 ; vD = _0_0 ; vE = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"OBJECT_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vF",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vI",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vG = _0_0 ; vH = _0_0 ; vI = _0_0 ; vF = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"WIREFRAME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vK",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:["vK","=","vJ",";"]}]},{TYPE:"node",NAME:"TANGENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vL = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"LAYER_WEIGHT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vP",QUALIFIER:["float"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vO = vP = _0_0 ; vN ; vM ;".split(" ")}]},{TYPE:"node",NAME:"LIGHT_PATH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vV",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vZ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vQ = vR = vS = _0_0 ; vT = vU = vV = _0_0 ; vW = vW = vY = vZ = _0_0 ; vX = _0_0 ;".split(" ")}]},{TYPE:"node",NAME:"ATTRIBUTE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"v_",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"v_ = wa = vec3 ( _0_0 ) ; wb = _0_0 ;".split(" ")}]},{TYPE:"node",NAME:"SCRIPT",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[]},{TYPE:"node",NAME:"CURVE_VEC",NODE_VARS:[{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",
TOKENS:["0.0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"we",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["we","=","wd",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",TOKENS:"we . r = ( GLSL_TEXTURE ( u_nodes_texture , vec2 ( 0.5 * wd . r + 0.5 , NODE_TEX_ROW ) ) . r - 0.5 ) * 2.0 ;".split(" ")}]}]},{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:"we . g = ( GLSL_TEXTURE ( u_nodes_texture , vec2 ( 0.5 * wd . g + 0.5 , NODE_TEX_ROW ) ) . g - 0.5 ) * 2.0 ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],STATEMENTS:[{TYPE:"txt",TOKENS:"we . b = ( GLSL_TEXTURE ( u_nodes_texture , vec2 ( 0.5 * wd . b + 0.5 , NODE_TEX_ROW ) ) . b - 0.5 ) * 2.0 ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"we = mix ( wd , we , wc ) ;".split(" ")}]},{TYPE:"node",NAME:"CURVE_RGB",
NODE_VARS:[{TYPE:"node_var",NAME:"READ_A",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["0.0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wh",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_A"],
STATEMENTS:[{TYPE:"txt",TOKENS:"float r = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wg . r , NODE_TEX_ROW ) ) . a ; float g = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wg . g , NODE_TEX_ROW ) ) . a ; float b = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wg . b , NODE_TEX_ROW ) ) . a ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float r = wg . r ; float g = wg . g ; float b = wg . b ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wh . r = GLSL_TEXTURE ( u_nodes_texture , vec2 ( r , NODE_TEX_ROW ) ) . r ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"wh . r = r ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:"wh . g = GLSL_TEXTURE ( u_nodes_texture , vec2 ( g , NODE_TEX_ROW ) ) . g ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"wh . g = g ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],
STATEMENTS:[{TYPE:"txt",TOKENS:"wh . b = GLSL_TEXTURE ( u_nodes_texture , vec2 ( b , NODE_TEX_ROW ) ) . b ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"wh . b = b ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"wh = mix ( wg , wh , wf ) ;".split(" ")}]},{TYPE:"node",NAME:"VALTORGB",NODE_VARS:[{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["0.0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"wk",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec4 wl = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wi , NODE_TEX_ROW ) ) ; wj = wl . rgb ; wk = wl . a ;".split(" ")}]},{TYPE:"node",NAME:"MAPPING",NODE_VARS:[{TYPE:"node_var",NAME:"MAPPING_SCALE_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_SCALE",TOKENS:["vec3","(","1.0",")"]},{TYPE:"node_var",NAME:"MAPPING_TRANS_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRANS",TOKENS:["vec3","(","0.0",")"]},{TYPE:"node_var",
NAME:"MAPPING_TRS_MATRIX_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRS_MATRIX",TOKENS:["mat4","(","1.0",")"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP",TOKENS:["vec3","(","0.0",")"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP",TOKENS:["vec3","(","1.0",")"]},{TYPE:"node_var",NAME:"MAPPING_IS_NORMAL",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"wn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wn","=","wm",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_SCALE_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = wn * MAPPING_SCALE ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRANS_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = wn + MAPPING_TRANS ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRS_MATRIX_DEF"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wn = ( MAPPING_TRS_MATRIX * vec4 ( wn , _1_0 ) ) . xyz ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MIN_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = max ( wn , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MAX_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = min ( wn , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_IS_NORMAL"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wn = normalize ( wn ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_ADD",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wq",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wq = wo + wp ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wq = clamp ( wq , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ws",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wt",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wt = wr - ws ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wt = clamp ( wt , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wA",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wA = wu * wv ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wA = clamp ( wA , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wD = ( wC != _0_0 ) ? wB / wC : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],
STATEMENTS:[{TYPE:"txt",TOKENS:"wD = clamp ( wD , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_SINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wG = sin ( wE ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],
STATEMENTS:[{TYPE:"txt",TOKENS:"wG = clamp ( wG , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wF",";"]}]},{TYPE:"node",NAME:"MATH_COSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wJ = cos ( wH ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wJ = clamp ( wJ , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wI",";"]}]},{TYPE:"node",NAME:"MATH_TANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wM",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wM = tan ( wK ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wM = clamp ( wM , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wL",";"]}]},{TYPE:"node",NAME:"MATH_ARCSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"wP = ( wN <= _1_0 && wN >= - _1_0 ) ? asin ( wN ) : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wP = clamp ( wP , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wO",";"]}]},{TYPE:"node",NAME:"MATH_ARCCOSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wR",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"wS",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wS = ( wQ <= _1_0 && wQ >= - _1_0 ) ? acos ( wQ ) : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wS = clamp ( wS , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wR",";"]}]},{TYPE:"node",NAME:"MATH_ARCTANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wT",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wV",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wV = atan ( wT ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wV = clamp ( wV , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wU",";"]}]},{TYPE:"node",NAME:"MATH_POWER",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",
NAME:"wW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( wW < _0_0 && wX != floor ( wX ) ) wY = _0_0 ; else if ( wX == _0_0 ) wY = _1_0 ; else if ( wW < _0_0 ) wY = mix ( _1_0 , - _1_0 , sign ( mod ( - wX , 2.0 ) ) ) * pow ( - wW , wX ) ; else if ( wW == _0_0 ) wY = _0_0 ; else wY = pow ( wW , wX ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wY = clamp ( wY , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_LOGARITHM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"w_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xa",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xa = ( wZ > _0_0 && w_ > _0_0 ) ? log2 ( wZ ) / log2 ( w_ ) : _0_0 ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xa = clamp ( xa , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MINIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xd = min ( xb , xc ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xd = clamp ( xd , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MAXIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xe",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xg",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xg = max ( xe , xf ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xg = clamp ( xg , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_ROUND",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xj",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xj = floor ( xh + _0_5 ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xj = clamp ( xj , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["xi",";"]}]},{TYPE:"node",NAME:"MATH_LESS_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xm",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"xm = ( xk < xl ) ? _1_0 : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xm = clamp ( xm , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_GREATER_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xp",QUALIFIER:["float"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"xp = ( xn > xo ) ? _1_0 : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xp = clamp ( xp , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MODULO",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xs",QUALIFIER:["float"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xs = abs ( xr ) > 0.000001 ? mod ( xq , xr ) : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xs = clamp ( xs , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_ABSOLUTE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xu",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"xv",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xv = abs ( xt ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xv = clamp ( xv , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["xu",";"]}]},{TYPE:"node",NAME:"MIX_RGB_MIX",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"xB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xA , _0_0 , _1_0 ) ; xD = mix ( xB , xC , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xD = clamp ( xD , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_ADD",NODE_VARS:[{TYPE:"node_var",
NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xE , _0_0 , _1_0 ) ; xH = mix ( xF , xF + xG , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"xH = clamp ( xH , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xI , _0_0 , _1_0 ) ; xL = mix ( xJ , xJ * xK , vj ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xL = clamp ( xL , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xP",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xM , _0_0 , _1_0 ) ; xP = mix ( xN , xN - xO , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xP = clamp ( xP , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SCREEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xR",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xQ , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; xT = vec3 ( _1_0 ) - ( vec3 ( xU ) + vj * ( vec3 ( _1_0 ) - xS ) ) * ( vec3 ( _1_0 ) - xR ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xT = clamp ( xT , _0_0 , _1_0 ) ;".split(" ")}]}]}]},
{TYPE:"node",NAME:"MIX_RGB_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xY",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xV , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; xX += step ( xX , vec3 ( _0_0 ) ) ; xY = xU * xW + vj * xW / xX ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xY = clamp ( xY , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DIFFERENCE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"x_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ya",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yb",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xZ , _0_0 , _1_0 ) ; yb = mix ( x_ , abs ( x_ - ya ) , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yb = clamp ( yb , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DARKEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yd",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ye",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yc , _0_0 , _1_0 ) ; yf = min ( yd . rgb , ye . rgb * vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yf = clamp ( yf , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LIGHTEN",NODE_VARS:[{TYPE:"node_var",
NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yg , _0_0 , _1_0 ) ; yj = max ( yh . rgb , yi . rgb * vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"yj = clamp ( yj , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_OVERLAY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ym",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yk , _0_0 , _1_0 ) ; vec3 yo = vec3 ( _1_0 - vj ) ; yn = mix ( yl * ( yo + 2.0 * vj * ym ) , vec3 ( _1_0 ) - ( yo + 2.0 * vj * ( vec3 ( _1_0 ) - ym ) ) * ( vec3 ( _1_0 ) - yl ) , step ( _0_5 , yl ) ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yn = clamp ( yn , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DODGE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ys",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yp , _0_0 , _1_0 ) ; vec3 yt = vec3 ( _1_0 ) - vj * yr ; vec3 yu = clamp ( yq / yt , _0_0 , _1_0 ) ; ys = mix ( mix ( yu , vec3 ( _1_0 ) , step ( yt , vec3 ( _0_0 ) ) ) , yq , step ( yq , vec3 ( _0_0 ) ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"ys = clamp ( ys , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_BURN",NODE_VARS:[{TYPE:"node_var",
NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yv , _0_0 , _1_0 ) ; vec3 jI = vec3 ( _1_0 - vj ) ; vec3 yt = jI + vj * yB ; vec3 yu = clamp ( vec3 ( _1_0 ) - ( vec3 ( _1_0 ) - yA ) / yt , _0_0 , _1_0 ) ; yC = mix ( yu , vec3 ( _0_0 ) , step ( yt , vec3 ( _0_0 ) ) ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yC = clamp ( yC , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_HUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yG",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yD , _0_0 , _1_0 ) ; vec3 jA , yH , yt ; yG = yE ; yH = jz ( yF ) ; if ( yH . y != _0_0 ) { jA = jz ( yG ) ; jA . x = yH . x ; yt = jB ( jA ) ; yG = mix ( yG , yt , vj ) ; }".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yG = clamp ( yG , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SATURATION",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",
TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yI , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; yL = yJ ; vec3 jA , yH ; jA = jz ( yL ) ; if ( jA . y != _0_0 ) { yH = jz ( yK ) ; jA . y = xU * jA . y + vj * yH . y ; yL = jB ( jA ) ; }".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yL = clamp ( yL , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_VALUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yP",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yM , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; vec3 jA , yH ; jA = jz ( yN ) ; yH = jz ( yO ) ; jA . z = xU * jA . z + vj * yH . z ; yP = jB ( jA ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yP = clamp ( yP , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_COLOR",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",
NAME:"yQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yQ , _0_0 , _1_0 ) ; vec3 jA , yH , yt ; yT = yR ; yH = jz ( yS ) ; if ( yH . y != _0_0 ) { jA = jz ( yT ) ; jA . x = yH . x ; jA . y = yH . y ; yt = jB ( jA ) ; yT = mix ( yT , yt , vj ) ; }".split(" ")},{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yT = clamp ( yT , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SOFT_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yX",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yU , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; vec3 yY = yW + yV - yW * yV ; yX = yV * ( vec3 ( xU ) + vec3 ( vj ) * ( ( vec3 ( _1_0 ) - yV ) * yW + yY ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yX = clamp ( yX , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LINEAR_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",
NAME:"yZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"y_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"za",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zb",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yZ , _0_0 , _1_0 ) ; zb = y_ + vj * ( 2.0 * za - vec3 ( _1_0 ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"zb = clamp ( zb , _0_0 , _1_0 ) ;".split(" ")}]}]}]},
{TYPE:"node",NAME:"OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"A = zc ; E = zd ;".split(" ")}]},{TYPE:"node",NAME:"MATERIAL_BEGIN",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_NORMAL",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"SHADELESS_MAT",TOKENS:["0"]}],
DECLARATIONS:[{TYPE:"node_in",NAME:"ze",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zh",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"zi",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"zm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zo",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zp",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zq",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qL",QUALIFIER:["const","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qM",QUALIFIER:["const","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"zl = clamp ( ze , _0_0 , _1_0 ) ; zm = qM [ 0 ] * clamp ( zf , _0_0 , _1_0 ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_NORMAL"],STATEMENTS:[{TYPE:"txt",TOKENS:"zn = normalize ( zh ) ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["zn","=","ny",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SHADELESS_MAT",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"txt",TOKENS:"zj = zi * zl ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",
TOKENS:"zj = qS * zl ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:["zl","*=","zg",";"]}]}]},{TYPE:"txt",TOKENS:"zk = qT * u_environment_energy * ci ( zn ) ; zq = cl ( zl ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"zo = vec2 ( qL [ 0 ] , qL [ 1 ] ) ; zp = vec2 ( qM [ 1 ] , qM [ 2 ] ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["D",
"=","zq",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"zj = vec3 ( _0_0 ) ; zk = vec3 ( _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATERIAL_END",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_SPECULAR",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"zr",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zs",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zt",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zu",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"zv",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"zA",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zB",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zC",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zD",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zE",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zF",QUALIFIER:["vec3"],
IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"qN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qO",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zB"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:"zB = zr . rgb ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"zB = vec3 ( _0_0 ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{TYPE:"non_equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["REFLECTION_TYPE","REFL_PLANE",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"cu ( zB , v , zt , zu , F ) ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"cu ( zB , v , zt , zu , mat3 ( _0_0 ) ) ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],
STATEMENTS:[{TYPE:"txt",TOKENS:["zB","+=","zs",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zD"],STATEMENTS:[{TYPE:"txt",TOKENS:["zD","=","zt",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zE"],STATEMENTS:[{TYPE:"txt",TOKENS:"zE = zr . rgb ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zF"],STATEMENTS:[{TYPE:"txt",TOKENS:["zF",
"=","zs",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zC"],STATEMENTS:[{TYPE:"txt",TOKENS:"zC = clamp ( zA , _0_0 , _1_0 ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:"float t = max ( max ( zs . r , zs . g ) , zs . b ) * zv ; zC = clamp ( zA * ( _1_0 - t ) + t , _0_0 , _1_0 ) ;".split(" ")}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zC"],
STATEMENTS:[{TYPE:"txt",TOKENS:"zC = clamp ( qN , _0_0 , _1_0 ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:"float t = max ( max ( zs . r , zs . g ) , zs . b ) * qO ; zC = qN * ( _1_0 - t ) + t ;".split(" ")}]}]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["B","=","zs",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"B = vec3 ( _0_0 ) ;".split(" ")}]}]},
{TYPE:"txt",TOKENS:["C","=","zt",";"]}]},{TYPE:"node",NAME:"LIGHTING_AMBIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"nP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"nQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"nR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nS",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"nS = vec4 ( nP + nR * nQ , _0_0 ) ; nT = vec3 ( _0_0 ) ;".split(" ")}]},
{TYPE:"node",NAME:"LIGHTING_LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]},{TYPE:"node_var",NAME:"LAMP_SHADOW_MAP_IND",TOKENS:["-","1"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"nU",QUALIFIER:["vec4"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"nV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nW",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"nW = vec2 ( u_light_positions [ LAMP_IND ] . w , u_light_color_intensities [ LAMP_IND ] . w ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","HEMI",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",
TOKENS:["nY","=","_0_5",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["nY","=","_0_0",";"]}]}]},{TYPE:"txt",TOKENS:"nX = u_light_color_intensities [ LAMP_IND ] . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_SHADOW_MAP_IND",1,{TYPE:"negative_expr",PLACES:1},{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"nX *= nU [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",
PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 nZ = u_light_positions [ LAMP_IND ] . xyz ; nV = nZ - nx ; float aG = length ( nV ) ; nX *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + aG * aG ) ; nV = normalize ( nV ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oa = u_light_directions [ LAMP_IND ] ; float ob = dot ( nV , oa ) ; ob *= smoothstep ( _0_0 , _1_0 , ( ob - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nX *= ob ;".split(" ")}]}]},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],STATEMENTS:[{TYPE:"txt",TOKENS:"nX *= max ( LAMP_LIGHT_DIST - aG , _0_0 ) / LAMP_LIGHT_DIST ;".split(" ")}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"nV = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{TYPE:"node",NAME:"DIFFUSE_FRESNEL",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"od",QUALIFIER:["vec2"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oe",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"of",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"og",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","zG","=","oe",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oc , o . xyz ) ; zG = cross ( oi , o . xyz ) ; zG = - normalize ( zG ) ;".split(" ")}]}]},
{TYPE:"txt",TOKENS:"oh = _0_0 ; if ( od . r != _0_0 ) { float oj = ( _1_0 - of ) * dot ( zG , oc ) + of ; if ( og [ 0 ] == _0_0 ) { oh = _1_0 ; } else { float t = _1_0 + abs ( oj ) ; t = og [ 1 ] + ( _1_0 - og [ 1 ] ) * pow ( t , og [ 0 ] ) ; oh = clamp ( t , _0_0 , _1_0 ) ; } oh = max ( oh , _0_0 ) ; }".split(" ")}]},{TYPE:"node",NAME:"DIFFUSE_LAMBERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"ok",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"ol",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"om",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"on",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oo",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","zG","=","om",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( ok , o . xyz ) ; zG = cross ( oi , o . xyz ) ; zG = - normalize ( zG ) ;".split(" ")}]}]},
{TYPE:"txt",TOKENS:"oo = _0_0 ; if ( ol . r != _0_0 ) { float oj = ( _1_0 - on ) * dot ( zG , ok ) + on ; oo = max ( oj , _0_0 ) ; }".split(" ")}]},{TYPE:"node",NAME:"DIFFUSE_OREN_NAYAR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"op",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oq",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"or",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"os",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"ot",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ou",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","zG","=","or",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( op , o . xyz ) ; zG = cross ( oi , o . xyz ) ; zG = - normalize ( zG ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"ou = _0_0 ; if ( oq . r != _0_0 ) { float oj = ( _1_0 - os ) * dot ( zG , op ) + os ; if ( ot [ 0 ] > _0_0 ) { float ov = max ( dot ( zG , v ) , _0_0 ) ; float ow = ot [ 0 ] * ot [ 0 ] ; float ck = _1_0 - _0_5 * ( ow / ( ow + 0.33 ) ) ; vec3 ox = op - oj * zG ; vec3 oy = v - ov * zG ; if ( length ( ox ) == _0_0 || length ( oy ) == _0_0 || abs ( oj ) > _1_0 || abs ( ov ) > _1_0 ) ou = oj * ck ; else { float oz = acos ( oj ) ; float oA = acos ( ov ) ; vec3 oB = normalize ( ox ) ; vec3 oC = normalize ( oy ) ; float a , b ; a = max ( oz , oA ) ; b = min ( oz , oA ) ; b *= 0.95 ; float t = max ( dot ( oB , oC ) , _0_0 ) ; float oD = 0.45 * ( ow / ( ow + 0.09 ) ) ; ou = oj * ( ck + ( oD * t * sin ( a ) * tan ( b ) ) ) ; } } else ou = oj ; ou = max ( ou , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_MINNAERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oF",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oI",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:["vec3","zG","=","oG",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oE , o . xyz ) ; zG = cross ( oi , o . xyz ) ; zG = - normalize ( zG ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oJ = _0_0 ; if ( oF . r != _0_0 ) { float oj = ( _1_0 - oH ) * dot ( zG , oE ) + oH ; float ov = max ( dot ( zG , v ) , _0_0 ) ; if ( oI [ 0 ] <= _1_0 ) oJ = oj * pow ( max ( ov * oj , 0.1 ) , oI [ 0 ] - _1_0 ) ; else oJ = oj * pow ( 1.0001 - ov , oI [ 0 ] - _1_0 ) ; oJ = max ( oJ , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oL",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oO",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:["vec3","zG","=","oM",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oK , o . xyz ) ; zG = cross ( oi , o . xyz ) ; zG = - normalize ( zG ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oP = _0_0 ; if ( oL . r != _0_0 ) { float oj = ( _1_0 - oN ) * dot ( zG , oK ) + oN ; float oQ = acos ( oj ) ; if ( oQ < oO [ 0 ] ) oP = _1_0 ; else if ( oQ > ( oO [ 0 ] + oO [ 1 ] ) || oO [ 1 ] == _0_0 ) oP = _0_0 ; else oP = _1_0 - ( ( oQ - oO [ 0 ] ) / oO [ 1 ] ) ; oP = max ( oP , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"SPECULAR_PHONG",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oS",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oV",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oW",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"oW = _0_0 ; if ( oS . g == _1_0 ) { vec3 oX = normalize ( oR + v ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( oU == _0_0 ) { oW = dot ( o . xyz , oX ) ; oW = sqrt ( _1_0 - oW * oW ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"oW = ( _1_0 - oU ) * max ( dot ( oT , oX ) , _0_0 ) + oU ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oW = pow ( oW , oV [ 0 ] ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_COOKTORR",
NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oZ",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"o_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pa",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pb",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pc",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pc = _0_0 ; if ( oZ . g != _0_0 ) { vec3 oX = normalize ( oY + v ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( pa == _0_0 ) { pc = dot ( o . xyz , oX ) ; pc = sqrt ( _1_0 - pc * pc ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"pc = max ( dot ( o_ , oX ) , _0_0 ) ; pc = ( _1_0 - pa ) * pc + pa ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float ov = max ( dot ( o . xyz , v ) , _0_0 ) ; ov = sqrt ( _1_0 - ov * ov ) ;".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float ov = max ( dot ( o_ , v ) , _0_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"pc = pow ( pc , pb [ 0 ] ) ; pc = pc / ( 0.1 + ov ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_WARDISO",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pe",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"pg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ph",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pi",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pi = _0_0 ; if ( pe . g == _1_0 ) { vec3 oX = normalize ( pd + v ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = _0_0 ; float ov = _0_0 ; float pk = _0_0 ; if ( pg == _0_0 ) { pj = dot ( o . xyz , oX ) ; ov = dot ( o . xyz , v ) ; pk = dot ( o . xyz , pd ) ; pj = sqrt ( _1_0 - pj * pj ) ; ov = sqrt ( _1_0 - ov * ov ) ; pk = sqrt ( _1_0 - pk * pk ) ; }".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = max ( dot ( pf , oX ) , 0.01 ) ; float ov = max ( dot ( pf , v ) , 0.01 ) ; float pk = max ( dot ( pf , pd ) , 0.01 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"float bp = tan ( acos ( pj ) ) ; float L = max ( ph [ 0 ] , 0.01 ) ; pi = pk * ( _1_0 / ( 4.0 * M_PI * L * L ) ) * ( exp ( - ( bp * bp ) / ( L * L ) ) / ( sqrt ( ov * pk ) ) ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",
TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pm",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"po",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pr",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pu = _0_0 ; if ( pm . g == _1_0 ) { vec3 bS = normalize ( pl + v ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pv = dot ( bS , o . xyz ) ; float bp = pr [ 0 ] + pr [ 1 ] ; if ( po == _0_0 ) bp = acos ( sqrt ( _1_0 - pv * pv ) ) ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float bp = acos ( dot ( bS , pn ) ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"if ( bp < pr [ 0 ] ) pu = _1_0 ; else if ( bp >= pr [ 0 ] + pr [ 1 ] || pr [ 1 ] == _0_0 ) pu = _0_0 ; else pu = _1_0 - ( bp - pr [ 0 ] ) / pr [ 1 ] ; }".split(" ")}]},
{TYPE:"node",NAME:"SPECULAR_BLINN",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pw",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"px",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"py",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pA",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pB",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"pB = _0_0 ; if ( px . g == _1_0 ) { if ( pA [ 0 ] < 1.0 || pA [ 1 ] == _0_0 ) pB = _0_0 ; else { if ( pA [ 1 ] < 100.0 ) pA [ 1 ] = sqrt ( 1.0 / pA [ 1 ] ) ; else pA [ 1 ] = 10.0 / pA [ 1 ] ; vec3 oX = normalize ( v + pw ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = 0.0 ; if ( pz == _0_0 ) { float pC = dot ( o . xyz , oX ) ; pj = sqrt ( _1_0 - pC * pC ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",
TOKENS:"float pj = ( _1_0 - pz ) * max ( dot ( py , oX ) , _0_0 ) + pz ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"if ( pj < _0_0 ) pB = _0_0 ; else { float ov = max ( dot ( py , v ) , 0.01 ) ; float pk = dot ( py , pw ) ; if ( pk <= 0.01 ) pB = _0_0 ; else { float pD = max ( dot ( v , oX ) , 0.01 ) ; float a = _1_0 ; float b = ( 2.0 * pj * ov ) / pD ; float de = ( 2.0 * pj * pk ) / pD ; float g = min ( min ( a , b ) , de ) ; float p = sqrt ( pow ( pA [ 0 ] , 2.0 ) + pow ( pD , 2.0 ) - _1_0 ) ; float ln = pow ( p - pD , 2.0 ) / pow ( p + pD , 2.0 ) * ( _1_0 + pow ( pD * ( p + pD ) - _1_0 , 2.0 ) / pow ( pD * ( p - pD ) + _1_0 , 2.0 ) ) ; float oQ = acos ( pj ) ; pB = max ( ln * g * exp ( - pow ( oQ , 2.0 ) / ( 2.0 * pow ( pA [ 1 ] , 2.0 ) ) ) , _0_0 ) ; } } } }".split(" ")}]},
{TYPE:"node",NAME:"LIGHTING_APPLY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"pE",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pK",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"pL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pP",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NODE_B4W_TRANSLUCENCY"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( dot ( pI , pJ ) * dot ( v , pJ ) < _0_0 ) { float zH = pK . x ; float zI = pK . y ; float zJ = pK . z ; float zK = pK . w ; float zL = clamp ( abs ( dot ( pI , pJ ) ) , _0_0 , _1_0 ) ; float zM = clamp ( dot ( v , - pI ) , _0_0 , _1_0 ) ; float zN = pow ( zM , zI ) ; pP = pE + pO * vec4 ( pN * zL * pow ( pL , vec3 ( zH ) ) , _1_0 ) ; pP += zJ * mix ( vec4 ( pL , _1_0 ) , vec4 ( _1_0 ) , zK ) * pO * vec4 ( pN * zL * vec3 ( zN ) , _1_0 ) ; pQ = pF ; } else { pQ = pF + pN * pM * pH ; pP = pE + vec4 ( pN * pL * pG , pH ) ; }".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"pQ = pF + pN * pM * pH ; pP = pE + vec4 ( pN * pL * pG , pH ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"RGB",NODE_VARS:[{TYPE:"node_var",NAME:"RGB_IND",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"zO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"zO = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{TYPE:"node",NAME:"RGBTOBW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"zQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"zQ = dot ( zP , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"SEPRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zS",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zT",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zU",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zS"],
STATEMENTS:[{TYPE:"txt",TOKENS:"zS = zR . r ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zT"],STATEMENTS:[{TYPE:"txt",TOKENS:"zT = zR . g ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zU"],STATEMENTS:[{TYPE:"txt",TOKENS:"zU = zR . b ;".split(" ")}]}]}]},{TYPE:"node",NAME:"SEPHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zW",QUALIFIER:["float"],IS_OPTIONAL:!0},
{TYPE:"node_out",NAME:"zX",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zY",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 zZ = jz ( zV ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zW"],STATEMENTS:[{TYPE:"txt",TOKENS:"zW = zZ . r ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zX"],STATEMENTS:[{TYPE:"txt",TOKENS:"zX = zZ . g ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zY"],
STATEMENTS:[{TYPE:"txt",TOKENS:"zY = zZ . b ;".split(" ")}]}]}]},{TYPE:"node",NAME:"SQUEEZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"z_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Aa",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ab",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ac",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Ac = _1_0 / ( _1_0 + pow ( 2.71828183 , - ( z_ - Ab ) * Aa ) ) ;".split(" ")}]},{TYPE:"node",NAME:"GAMMA",
NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Ad",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ae",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Af",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Af = Ad ; if ( Af . x > _0_0 ) Af . x = pow ( Ad . x , Ae ) ; if ( Af . y > _0_0 ) Af . y = pow ( Ad . y , Ae ) ; if ( Af . z > _0_0 ) Af . z = pow ( Ad . z , Ae ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_SRGB_TO_LINEAR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"Ag",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ah",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Ah = max ( vec3 ( _0_0 ) , Ag ) ; Ah = pow ( Ah , vec3 ( 2.2 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_LINEAR_TO_SRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Ai",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Aj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Aj = max ( vec3 ( _0_0 ) , Ai ) ; Aj = pow ( Aj , vec3 ( _1_0 / 2.2 ) ) ;".split(" ")}]},
{TYPE:"node",NAME:"TEXTURE_EMPTY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ak",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Al",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Am",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ak"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ak [ 2 ] = Ak [ 1 ] = Ak [ 0 ] = _0_0 ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Al"],STATEMENTS:[{TYPE:"txt",
TOKENS:"Al [ 2 ] = Al [ 1 ] = Al [ 0 ] = _0_0 ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Am"],STATEMENTS:[{TYPE:"txt",TOKENS:["Am","=","_0_0",";"]}]}]}]},{TYPE:"node",NAME:"TEXTURE_ENVIRONMENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"An",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ao",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ap",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_ENVIRONMENT_var_texture",
QUALIFIER:["uniform","samplerCube"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 Aq = vec3 ( An . x , An . y , An . z ) ; vec4 wl = GLSL_TEXTURE_CUBE ( node_TEXTURE_ENVIRONMENT_var_texture , Aq ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ao"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ao = wl . xyz ; cb ( Ao ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ap"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ap = wl . w ;".split(" ")}]}]}]},{TYPE:"node",
NAME:"TEXTURE_COLOR",NODE_VARS:[{TYPE:"node_var",NAME:"NON_COLOR",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv4",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Ar",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"As",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"At",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Au",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Av",
QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Aw",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ax",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ay",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Az",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AA",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AB",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AC",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_COLOR_var_texture",
QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec4 wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( Ar ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Av"],STATEMENTS:[{TYPE:"txt",TOKENS:"Av = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["cb","(","Av",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_Aw"],STATEMENTS:[{TYPE:"txt",TOKENS:"Aw = wl . w ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( As ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ax"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ax = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",
TOKENS:["cb","(","Ax",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ay"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ay = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( At ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Az"],STATEMENTS:[{TYPE:"txt",TOKENS:"Az = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["cb","(","Az",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AA"],STATEMENTS:[{TYPE:"txt",TOKENS:"AA = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( Au ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AB"],
STATEMENTS:[{TYPE:"txt",TOKENS:"AB = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["cb","(","AB",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AC"],STATEMENTS:[{TYPE:"txt",TOKENS:"AC = wl . w ;".split(" ")}]}]}]}]}]},{TYPE:"node",NAME:"TEXTURE_NORMAL",NODE_VARS:[{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},
{TYPE:"node_var",NAME:"USE_uv4",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AD",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"AE",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"AF",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"AG",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AH",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AI",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AJ",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",
NAME:"AK",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AL",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AM",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AN",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AO",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_NORMAL_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec4 wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AD ) ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AH"],STATEMENTS:[{TYPE:"txt",TOKENS:"AH = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AI"],STATEMENTS:[{TYPE:"txt",TOKENS:"AI = wl . w ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AE ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_AJ"],STATEMENTS:[{TYPE:"txt",TOKENS:"AJ = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AK"],STATEMENTS:[{TYPE:"txt",TOKENS:"AK = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AF ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AL"],STATEMENTS:[{TYPE:"txt",
TOKENS:"AL = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AM"],STATEMENTS:[{TYPE:"txt",TOKENS:"AM = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AG ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AN"],STATEMENTS:[{TYPE:"txt",TOKENS:"AN = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AO"],STATEMENTS:[{TYPE:"txt",TOKENS:"AO = wl . w ;".split(" ")}]}]}]}]}]},{TYPE:"node",NAME:"VALUE",NODE_VARS:[{TYPE:"node_var",NAME:"VALUE_IND",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"AP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"AP = u_node_values [ VALUE_IND ] ;".split(" ")}]},{TYPE:"node",NAME:"VECT_MATH_ADD",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"AQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"AR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AT",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"AS = AQ + AR ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AT"],STATEMENTS:[{TYPE:"txt",TOKENS:"AT = ( abs ( AS [ 0 ] ) + abs ( AS [ 1 ] ) + abs ( AS [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_SUBTRACT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"AU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AX",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"AW = AU - AV ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AX"],STATEMENTS:[{TYPE:"txt",TOKENS:"AX = ( abs ( AW [ 0 ] ) + abs ( AW [ 1 ] ) + abs ( AW [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_AVERAGE",
NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"AY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"A_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ba",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"A_ = AY + AZ ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ba"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ba = length ( A_ ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_A_"],STATEMENTS:[{TYPE:"txt",TOKENS:"A_ = normalize ( A_ ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_DOT_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bb",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Be",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bd = vec3 ( _0_0 ) ;".split(" ")},{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Be"],STATEMENTS:[{TYPE:"txt",TOKENS:"Be = dot ( Bb , Bc ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_CROSS_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bi",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bh = cross ( Bf , Bg ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Bi"],STATEMENTS:[{TYPE:"txt",TOKENS:"Bi = length ( Bh ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_NORMALIZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bm",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bl = normalize ( Bj ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Bm"],STATEMENTS:[{TYPE:"txt",TOKENS:"Bm = length ( Bj ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["Bk",";"]}]},{TYPE:"node",NAME:"B4W_REFLECT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bp",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bp = reflect ( U ( G , Bn ) , Bo ) ;".split(" ")}]},{TYPE:"node",
NAME:"B4W_REFLECT_WORLD",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Br",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 Bs = - v . xyz ; Br = reflect ( Bs , Bq ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_PARALLAX",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bt",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bv",QUALIFIER:["const","float"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bw",QUALIFIER:["const","float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"node_B4W_PARALLAX_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float bt = length ( qR ) ; if ( bt < Bw ) { vec2 bI = qB ( Bt ) ; float bM = clamp ( _0_5 * ( Bw - bt ) , _0_0 , _1_0 ) ; float hl = Bu * bM ; vec3 bO = normalize ( v * qQ ) ; float bP = _1_0 / Bv ; vec2 bQ = bO . xy * hl / ( Bv * bO . z ) ; float bR = _1_0 ; float bS = GLSL_TEXTURE ( node_B4W_PARALLAX_var_texture , bI ) . a ; for ( float bU = 1.0 ; bU <= Bv ; bU ++ ) { if ( bS < bR ) { bR -= bP ; bI -= bQ ; bS = GLSL_TEXTURE ( node_B4W_PARALLAX_var_texture , bI ) . a ; } } vec2 bV = bI + bQ ; float bW = GLSL_TEXTURE ( node_B4W_PARALLAX_var_texture , bV ) . a - ( bR + bP ) ; float bX = bS - bR ; float bY = bX / ( bX - bW ) ; bI = bY * bV + ( _1_0 - bY ) * bI ; Bx = qA ( bI ) ; } else Bx = Bt ;".split(" ")}]},
{TYPE:"node",NAME:"B4W_CLAMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"By",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bz = clamp ( By , _0_0 , _1_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"BC = qz ( BA , BB ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_TRANSLUCENCY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BI",QUALIFIER:["float"],IS_OPTIONAL:!0},
{TYPE:"node_out",NAME:"BJ",QUALIFIER:["vec4"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_BI"],STATEMENTS:[{TYPE:"txt",TOKENS:["BI","=","BD",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_BJ"],STATEMENTS:[{TYPE:"txt",TOKENS:"BJ = vec4 ( BE , BF , BG , BH ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"B4W_TIME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"BK",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BK",
"=","u_time",";"]}]},{TYPE:"node",NAME:"B4W_SMOOTHSTEP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BO",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"BO = smoothstep ( BM , BN , BL ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_GLOW_OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BP",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"A = BP ; E = BQ ;".split(" ")}]},{TYPE:"node",NAME:"B4W_VECTOSCAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BS",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"BS = ( BR . r + BR . g + BR . b ) / 3.0 ;".split(" ")}]},{TYPE:"node",NAME:"B4W_SCALTOVEC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"BT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BU",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"BU [ 0 ] = BT ; BU [ 1 ] = BT ; BU [ 2 ] = BT ;".split(" ")}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:"void J ( in vec3 v , in mat3 F , in mat3 G , in mat3 H , in mat3 I , out vec3 A , out vec3 B , out vec3 C , out vec4 D , out float E ) { A = vec3 ( _0_0 ) ; B = vec3 ( _0_0 ) ; C = vec3 ( _0_0 ) ; D = vec4 ( _0_0 ) ; E = _0_0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO","USE_NODE_NORMAL_MAP",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Q = normalize ( e ) ; vec3 bJ = Q ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["INVERT_FRONTFACING"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["if","(","!","gl_FrontFacing",")"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing",")"]}]}}]},{TYPE:"txt",TOKENS:"bJ = bJ ; else bJ = - bJ ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ny","=","bJ",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ny","=","Q",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_NO"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","qP","=","bJ",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 S = cross ( bJ , f . xyz ) * f . w ; S = normalize ( S ) ; vec3 R = cross ( S , bJ ) * f . w ; mat3 qQ = mat3 ( R , S , bJ ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 nx = c ; vec4 qR = d ; float qS = u_emit ; float qT = u_ambient ;".split(" ")},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/nodes.glslv"]=
{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"NODES_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"NODES_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"PARTICLE_BATCH",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2},"PARTICLE_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"GLSL_IN vec3 a_orco_tex_coord ; GLSL_OUT vec3 qw ;".split(" ")}]}}]},
{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_TEX_COORD_UV_var_a_uv",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qJ",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qJ","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_UV_MERGED_var_a_uv",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qI",QUALIFIER:["GLSL_OUT",
"vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qI","=","node_UV_MERGED_var_a_uv",";"]}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_UVMAP_var_a_uv",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qK",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qK","=","node_UVMAP_var_a_uv",";"]}]},{TYPE:"node",NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_UV_var_a_uv",
QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qC",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["qC","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC_var_a_vertex_color",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"BV",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BV","=","node_GEOMETRY_VC_var_a_vertex_color",
";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC1",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC1_var_a_vertex_color",QUALIFIER:["GLSL_IN","float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"BW",QUALIFIER:["GLSL_OUT","float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BW","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC2",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC2_var_a_vertex_color",QUALIFIER:["GLSL_IN","vec2"],IS_OPTIONAL:!1},
{TYPE:"node_param",NAME:"BX",QUALIFIER:["GLSL_OUT","vec2"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BX","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC3",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_param",NAME:"node_GEOMETRY_VC3_var_a_vertex_color",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"BY",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BY","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{TYPE:"nodes_global"},
{TYPE:"txt",TOKENS:["void","J","(",")","{"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["qw","=","a_orco_tex_coord",";"]}]}}]},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/pack.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PACK_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PACK_GLSLF",TOKENS:[""]},{TYPE:"txt",TOKENS:"vec4 fT ( const in float hB ) { vec4 eK = vec4 ( _255_0 * _255_0 * _255_0 , _255_0 * _255_0 , _255_0 , _1_0 ) ; vec4 BZ = vec4 ( _0_0 , _1_0 / _255_0 , _1_0 / _255_0 , _1_0 / _255_0 ) ; vec4 iT = fract ( hB * eK ) ; iT -= iT . xxyz * BZ ; return iT ; } float cz ( const in vec4 B_ ) { float fO ; vec4 eK = vec4 ( _1_0 / ( _255_0 * _255_0 * _255_0 ) , _1_0 / ( _255_0 * _255_0 ) , _1_0 / _255_0 , _1_0 ) ; fO = dot ( B_ , eK ) ; return fO ; } vec4 fT ( const in vec2 gK ) { vec2 eK = vec2 ( _255_0 , _1_0 ) ; vec2 BZ = vec2 ( _0_0 , _1_0 / _255_0 ) ; vec4 iT = fract ( gK . xxyy * eK . xyxy ) ; iT -= iT . xxzz * BZ . xyxy ; if ( gK . r == _1_0 ) iT . rg = vec2 ( _0_0 , _1_0 ) ; if ( gK . g == _1_0 ) iT . ba = vec2 ( _0_0 , _1_0 ) ; return iT ; } vec2 iy ( const in vec4 Ca ) { vec2 gK ; vec2 eK = vec2 ( _1_0 / _255_0 , _1_0 ) ; gK . r = dot ( Ca . rg , eK ) ; gK . g = dot ( Ca . ba , eK ) ; return gK ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PARTICLES_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PARTICLES_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"EPSILON",TOKENS:["0.000001"]},{TYPE:"var",NAME:"COLOR_RAMP_LENGTH",TOKENS:["0"]},{TYPE:"var",NAME:"WORLD_SPACE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_COLOR_RAMP",TOKENS:["0"]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:"struct cH { float cQ ; vec3 O ; float L ; vec3 aK ; float bp ; vec3 cW ; vec3 cX ; float cY ; } ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"void Ce ( inout vec3 aK , float Cb , vec4 jt , vec4 ju ) { float Cc = ju . x - jt . x ; float Cd = ( Cb - jt . x ) / Cc ; aK = mix ( aK , ju . yzw , clamp ( Cd , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Ch ( float t , float Cf , vec4 Cg [ COLOR_RAMP_LENGTH ] ) { float Cb = t / Cf ; vec3 aK = Cg [ 0 ] . yzw ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ce ( aK , Cb , Cg [ 0 ] , Cg [ 1 ] ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ce ( aK , Cb , Cg [ 1 ] , Cg [ 2 ] ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"Ce ( aK , Cb , Cg [ 2 ] , Cg [ 3 ] ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["return","aK",";","}"]}]}}]},{TYPE:"txt",TOKENS:"float Cn ( float t , float Cf , float Ci , float Cj ) { float Ck = max ( 0.01 , min ( Cf , Ci ) ) ; float Cl = max ( 0.01 , min ( Cf , Cj ) ) ; float Cm = Cf - Cl ; float L = clamp ( t / Ck , 0.0 , 1.0 ) - step ( Cm , t ) * ( t - Cm ) / Cl ; return L ; } cH cI ( ) { cH sp ; float t ; float Cf = a_p_data [ 0 ] ; float Co = a_p_data [ 1 ] ; if ( u_p_cyclic == 1 ) { t = mod ( u_p_time , u_p_length ) - Co ; if ( t < 0.0 ) t += u_p_length ; } if ( u_p_cyclic != 1 ) { t = u_p_time - Co ; } if ( t < 0.0 || t >= Cf ) { sp . cQ = 0.0001 ; sp . O = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( t < 0.0 || t >= Cf ) ) { vec3 bC = P ( a_tbn_quat , vec3 ( 0.0 , 1.0 , 0.0 ) ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WORLD_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 eH = a_position ; vec3 zG = bC ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 eH = ae ( u_model_tsr , a_position ) ; vec3 zG = U ( u_model_tsr , bC ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 Cp = u_p_nfactor * zG ; Cp += a_p_vels . xyz ; Cp . z -= u_p_gravity * t / 2.0 ; float Cq = max ( u_p_mass , EPSILON ) ; Cp += ( u_p_wind_fac * u_wind / Cq ) * t / 2.0 ; sp . cY = t ; sp . cW = Cp ; sp . cX = bC * a_p_vels . w ; sp . O = eH + Cp * t ; sp . bp = a_p_vels . w * t ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_COLOR_RAMP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"sp . cQ = GLSL_TEXTURE ( u_color_ramp_tex , vec2 ( t / u_p_max_lifetime , 0.5 ) ) . g ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"sp . cQ = 1.0 ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["COLOR_RAMP_LENGTH",0,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"sp . aK = Ch ( t , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"sp . aK = vec3 ( 1.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"sp . L = Cn ( t , a_p_data [ 0 ] , u_p_fade_in , u_p_fade_out ) ; } return sp ; }".split(" ")}]}}]}]};a["include/particles_nodes.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PARTICLES_NODES_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PARTICLES_NODES_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"CAUSTICS",TOKENS:["0"]},{TYPE:"var",NAME:"DOUBLE_SIDED_LIGHTING",
TOKENS:["0"]},{TYPE:"var",NAME:"INVERT_FRONTFACING",TOKENS:["0"]},{TYPE:"var",NAME:"PARTICLE_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"NUM_LIGHTS",TOKENS:["0"]},{TYPE:"var",NAME:"CALC_TBN_SPACE",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_MATERIAL_BEGIN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"environment.glslf"}]}}]},{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"include",FILE:"math.glslv"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE",
"USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 jz ( vec3 rgb ) { vec4 jy = vec4 ( _0_0 , - _1_0 / 3.0 , 2.0 / 3.0 , - _1_0 ) ; vec4 p = mix ( vec4 ( rgb . bg , jy . wz ) , vec4 ( rgb . gb , jy . xy ) , step ( rgb . b , rgb . g ) ) ; vec4 q = mix ( vec4 ( p . xyw , rgb . r ) , vec4 ( rgb . r , p . yzx ) , step ( p . x , rgb . r ) ) ; float dj = q . x - min ( q . w , q . y ) ; float hR = 1.0e-10 ; return vec3 ( abs ( q . z + ( q . w - q . y ) / ( 6.0 * dj + hR ) ) , dj / ( q . x + hR ) , q . x ) ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 jB ( vec3 jA ) { vec4 jy = vec4 ( _1_0 , 2.0 / 3.0 , _1_0 / 3.0 , 3.0 ) ; vec3 p = abs ( fract ( vec3 ( jA . r , jA . r , jA . r ) + jy . xyz ) * 6.0 - jy . www ) ; return jA . b * mix ( jy . xxx , clamp ( p - jy . xxx , _0_0 , _1_0 ) , jA . g ) ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 qA ( vec2 gm ) { return vec3 ( gm * 2.0 - vec2 ( _1_0 , _1_0 ) , _0_0 ) ; }".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 qB ( vec3 gK ) { return vec2 ( gK . xy * _0_5 + vec2 ( _0_5 , _0_5 ) ) ; }".split(" ")}]}}]},
{TYPE:"node",NAME:"CAMERA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"qU",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"qV",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"qW",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_qU"],STATEMENTS:[{TYPE:"txt",TOKENS:"qU = normalize ( qR . xyz ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_qV"],STATEMENTS:[{TYPE:"txt",TOKENS:"qV = abs ( qR . z ) ;".split(" ")}]}]},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_qW"],STATEMENTS:[{TYPE:"txt",TOKENS:"qW = length ( qR . xyz ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"COMBRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"qX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"qZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"q_",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"q_ = vec3 ( qX , qY , qZ ) ;".split(" ")}]},
{TYPE:"node",NAME:"COMBHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rd",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"re",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rf = jB ( vec3 ( rc , rd , re ) ) ;".split(" ")}]},{TYPE:"node",NAME:"EMPTY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rh",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"rh = vec3 ( - _1_0 , - _1_0 , _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"EMPTY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"ri",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ri = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rj = qA ( n ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_OR",NODE_VARS:[],
DECLARATIONS:[{TYPE:"node_out",NAME:"rk",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rk = 2.0 * vec3 ( n , _0_0 ) - vec3 ( _1_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_VC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rl",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rl = vec3 ( _1_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_VC1",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rm",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:["rm","=","_1_0",";"]}]},{TYPE:"node",NAME:"GEOMETRY_VC2",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ro",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rn = _1_0 ; ro = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_VC3",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rs",
QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rp = _1_0 ; rq = _1_0 ; rs = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_NO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rt",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rt = qP . xyz ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_FB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"ru",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["INVERT_FRONTFACING"],
STATEMENTS:[{TYPE:"txt",TOKENS:"ru = ( gl_FrontFacing ) ? _0_0 : _1_0 ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"ru = ( gl_FrontFacing ) ? _1_0 : _0_0 ;".split(" ")}]}]}]},{TYPE:"node",NAME:"GEOMETRY_VW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rv",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rv = - U ( F , v ) ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_LO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rw",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"rw [ 0 ] = qR [ 0 ] ; rw [ 1 ] = qR [ 1 ] ; rw [ 2 ] = qR [ 2 ] ;".split(" ")}]},{TYPE:"node",NAME:"GEOMETRY_GL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"rx",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rx = vec3 ( nx . r , - nx . b , nx . g ) ;".split(" ")}]},{TYPE:"node",NAME:"NEW_GEOMETRY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"ry",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rz",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"rA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rD",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rF",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ry = vec3 ( _0_0 ) ; rz = vec3 ( _0_0 ) ; rA = vec3 ( _0_0 ) ; rB = vec3 ( _0_0 ) ; rC = vec3 ( _0_0 ) ; rD = vec3 ( _0_0 ) ; rE = _0_0 ; rF = _0_0 ;".split(" ")}]},
{TYPE:"node",NAME:"HUE_SAT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 jA = jz ( rK ) ; jA [ 0 ] += ( rG - _0_5 ) ; if ( jA [ 0 ] > _1_0 ) jA [ 0 ] -= _1_0 ; else if ( jA [ 0 ] < _0_0 ) jA [ 0 ] += _1_0 ; jA *= vec3 ( _1_0 , rH , rI ) ; jA = mix ( vec3 ( _1_0 ) , mix ( vec3 ( _0_0 ) , jA , step ( vec3 ( _0_0 ) , jA ) ) , step ( jA , vec3 ( _1_0 ) ) ) ; rL = mix ( rK , jB ( jA ) , rJ ) ;".split(" ")}]},
{TYPE:"node",NAME:"INVERT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"rN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rO = mix ( rN , vec3 ( _1_0 ) - rN , rM ) ;".split(" ")}]},{TYPE:"node",NAME:"LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_INDEX",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_USE_SPHERE",
TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"rP",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"rQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rS",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_rP"],STATEMENTS:[{TYPE:"txt",TOKENS:"rP = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"vec3 rT = u_lamp_light_directions [ LAMP_INDEX ] ; vec3 rU = u_lamp_light_positions [ LAMP_INDEX ] ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"rQ = - c + rU ; rR = length ( rQ ) ; rQ = normalize ( rQ ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rS"],STATEMENTS:[{TYPE:"txt",TOKENS:"rS = LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + rR * rR ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"float ob = dot ( rQ , rT ) ; ob *= smoothstep ( _0_0 , _1_0 , ( ob - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; rS *= ob ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_USE_SPHERE"],
STATEMENTS:[{TYPE:"txt",TOKENS:"rS *= max ( LAMP_LIGHT_DIST - rR , _0_0 ) / LAMP_LIGHT_DIST ;".split(" ")}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rQ"],STATEMENTS:[{TYPE:"txt",TOKENS:["rQ","=","rT",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rR"],STATEMENTS:[{TYPE:"txt",TOKENS:"rR = length ( rU - c ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rS"],STATEMENTS:[{TYPE:"txt",
TOKENS:["rS","=","_1_0",";"]}]}]}]}]}]},{TYPE:"node",NAME:"NORMAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rW",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"rX",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"qH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_rW"],STATEMENTS:[{TYPE:"txt",TOKENS:["rW","=","qH",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_rX"],STATEMENTS:[{TYPE:"txt",TOKENS:"rX = - dot ( rV , qH ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"B4W_VECTOR_VIEW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"rY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"rZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"rZ = - U ( F , rY ) ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_ANISOTROPIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"r_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sa",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"se",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sf = r_ ; sa ; sb ; sc ; sd ; se ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_DIFFUSE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"sg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"si",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sj = sg ; sh ; si ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_GLASS",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sm",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"so",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"so = sk ; sl ; sm ; sn ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_GLOSSY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"su",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sw",
QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sw = sr ; su ; sv ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_HAIR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sB",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sB = sx ; sy ; sz ; sA ;".split(" ")}]},
{TYPE:"node",NAME:"BSDF_TRANSPARENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["sD","=","sC",";"]}]},{TYPE:"node",NAME:"BSDF_TRANSLUCENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sG",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"sG = sE ; sF ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sL [ 0 ] = sL [ 1 ] = sL [ 2 ] = _0_0 ; sH ; sI ; sJ ; sK ;".split(" ")}]},
{TYPE:"node",NAME:"BSDF_TOON",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sQ = sM ; sN ; sO ; sP ;".split(" ")}]},{TYPE:"node",NAME:"BSDF_VELVET",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"sR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"sU",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"sU = sR ; sS ; sT ;".split(" ")}]},{TYPE:"node",NAME:"SUBSURFACE_SCATTERING",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"sV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"sX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"sZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"s_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ta",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ta [ 0 ] = ta [ 1 ] = ta [ 2 ] = _0_0 ; sV ; sX ; sY ; sZ ; s_ ; sW ;".split(" ")}]},{TYPE:"node",NAME:"EMISSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tb",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"td",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"td = tb ; tc ;".split(" ")}]},{TYPE:"node",NAME:"AMBIENT_OCCLUSION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"te",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tf [ 0 ] = tf [ 1 ] = tf [ 2 ] = _0_0 ; te ;".split(" ")}]},{TYPE:"node",NAME:"HOLDOUT",
NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"tg",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tg [ 0 ] = tg [ 1 ] = tg [ 2 ] = _0_0 ;".split(" ")}]},{TYPE:"node",NAME:"VOLUME_ABSORPTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"th",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ti",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tj [ 0 ] = tj [ 1 ] = tj [ 2 ] = _0_0 ; th ; ti ;".split(" ")}]},
{TYPE:"node",NAME:"VOLUME_SCATTER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tm",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tn [ 0 ] = tn [ 1 ] = tn [ 2 ] = _0_0 ; tk ; tl ; tm ;".split(" ")}]},{TYPE:"node",NAME:"BUMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"to",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tw",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tw = tv ; to ; tr ; tu ;".split(" ")}]},{TYPE:"node",NAME:"NORMAL_MAP",NODE_VARS:[{TYPE:"node_var",NAME:"SPACE",TOKENS:["NM_TANGENT"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"tx",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"ty",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vec3","tA","=","ny",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SPACE","NM_TANGENT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tz = qQ * ( ty . xyz - _0_5 ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_OBJECT",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_OBJECT",{TYPE:"equal_expr",PLACES:2},
{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tz = ty . xyz - _0_5 ; tz . yz *= - 1.0 ; tz = U ( H , tz ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["SPACE","NM_WORLD",{TYPE:"equal_expr",PLACES:2},"SPACE","NM_BLENDER_WORLD",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tz = ty . xyz - _0_5 ; tz . yz *= - 1.0 ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"tz = normalize ( mix ( tA , tz , tx ) ) ;".split(" ")}]},{TYPE:"node",NAME:"VECT_TRANSFORM",
NODE_VARS:[{TYPE:"node_var",NAME:"CONVERT_TYPE",TOKENS:["VT_WORLD_TO_OBJECT"]},{TYPE:"node_var",NAME:"VECTOR_TYPE",TOKENS:["VT_VECTOR"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"tB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_WORLD",{TYPE:"equal_expr",PLACES:2},"CONVERT_TYPE","VT_OBJECT_TO_OBJECT",{TYPE:"equal_expr",PLACES:2},"CONVERT_TYPE","VT_CAMERA_TO_CAMERA",
{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:3}],STATEMENTS:[{TYPE:"txt",TOKENS:["tC","=","tB",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_POINT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( F , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",
{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( I , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( H , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( H , tB ) ; tC = ae ( F , tC ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",
{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( G , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = ae ( G , tB ) ; tC = ae ( I , tC ) ;".split(" ")}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( F , tB ) ;".split(" ")}]},
{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_WORLD_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( I , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( H , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_OBJECT_TO_CAMERA",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( H , tB ) ; tC = U ( F , tC ) ;".split(" ")}]},
{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_WORLD",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( G , tB ) ;".split(" ")}]},{TYPE:"node_elif",EXPRESSION:["CONVERT_TYPE","VT_CAMERA_TO_OBJECT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = U ( G , tB ) ; tC = U ( I , tC ) ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["VECTOR_TYPE","VT_NORMAL",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"tC = normalize ( tC ) ;".split(" ")}]}]}]}]}]},
{TYPE:"node",NAME:"BLACKBODY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tE",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tE [ 0 ] = tE [ 1 ] = tE [ 2 ] = _0_0 ; tD ;".split(" ")}]},{TYPE:"node",NAME:"WAVELENGTH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tG",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tG [ 0 ] = tG [ 1 ] = tG [ 2 ] = _0_0 ; tF ;".split(" ")}]},
{TYPE:"node",NAME:"SEPXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tK",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tI = tH [ 0 ] ; tJ = tH [ 1 ] ; tK = tH [ 2 ] ;".split(" ")}]},{TYPE:"node",NAME:"COMBXYZ",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tL",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tO [ 0 ] = tL ; tO [ 1 ] = tM ; tO [ 2 ] = tN ;".split(" ")}]},{TYPE:"node",NAME:"BRIGHTCONTRAST",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tR",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tS",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float b = tQ - tR * _0_5 ; tS = max ( ( _1_0 + tR ) * tP + b , vec3 ( _0_0 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"LIGHT_FALLOFF",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"tU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tW",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tX",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tV = tW = tX = _0_0 ; tT ; tU ;".split(" ")}]},{TYPE:"node",NAME:"TEX_IMAGE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"tY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"tZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"t_",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"tZ [ 0 ] = tZ [ 1 ] = tZ [ 2 ] = _0_0 ; t_ = _1_0 ; tY ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_ENVIRONMENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ua",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ub",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ub [ 0 ] = ub [ 1 ] = ub [ 2 ] = _0_0 ; ua ;".split(" ")}]},{TYPE:"node",NAME:"TEX_SKY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ud",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ud [ 0 ] = ud [ 1 ] = ud [ 2 ] = _0_0 ; uc ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_NOISE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ue",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ug",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ui",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uj",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ui [ 0 ] = ui [ 1 ] = ui [ 2 ] = _0_0 ; uj = _1_0 ; ue ; uf ; ug ; uh ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_WAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ul",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"um",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"un",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"up",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uq",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"up [ 0 ] = up [ 1 ] = up [ 2 ] = _0_0 ; uq = _1_0 ; uk ; ul ; um ; un ; uo ;".split(" ")}]},{TYPE:"node",NAME:"TEX_VORONOI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"ur",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"us",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ut",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ut [ 0 ] = ut [ 1 ] = ut [ 2 ] = _0_0 ; uu = _1_0 ; ur ; us ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_MUSGRAVE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uv",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ux",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"uC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"uC [ 0 ] = uC [ 1 ] = uC [ 2 ] = _0_0 ; uD = _1_0 ; uv ; uw ; ux ; uy ; uz ; uA ; uB ;".split(" ")}]},{TYPE:"node",NAME:"TEX_GRADIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"uF [ 0 ] = uF [ 1 ] = uF [ 2 ] = _0_0 ; uG = _1_0 ; uE ;".split(" ")}]},{TYPE:"node",NAME:"TEX_MAGIC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uH",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uL",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"uK [ 0 ] = uK [ 1 ] = uK [ 2 ] = _0_0 ; uL = _1_0 ; uH ; uI ; uJ ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_CHECKER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uP",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"uR",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"uQ [ 0 ] = uQ [ 1 ] = uQ [ 2 ] = _0_0 ; uR = _1_0 ; uM ; uN ; uO ; uP ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_BRICK",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"uS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"uY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"uZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"u_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"va",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"va [ 0 ] = va [ 1 ] = va [ 2 ] = _0_0 ; vb = _1_0 ; uS ; uT ; uU ; uV ; uW ; uX ; uY ; uZ ; u_ ;".split(" ")}]},{TYPE:"node",NAME:"ADD_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"vd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ve",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"ve = clamp ( vc + vd , vec3 ( _0_0 ) , vec3 ( _1_0 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"MIX_SHADER",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vi",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( vf , _0_0 , _1_0 ) ; vi = vj * vg + ( _1_0 - vj ) * vh ;".split(" ")}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vl",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vk"],STATEMENTS:[{TYPE:"txt",TOKENS:"vk = qA ( n ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vl"],
STATEMENTS:[{TYPE:"txt",TOKENS:"vl = vec3 ( n , _0_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vm",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vm = vec3 ( n , _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_NO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["vn","=","ny",";"]}]},{TYPE:"node",NAME:"TEX_COORD_GE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",
NAME:"vo",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vo = vec3 ( n , _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_OB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vp",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vp [ 0 ] = vp [ 1 ] = vp [ 2 ] = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_CA",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vq",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vq [ 0 ] = qR [ 0 ] ; vq [ 1 ] = qR [ 1 ] ; vq [ 2 ] = _1_0 ;".split(" ")}]},
{TYPE:"node",NAME:"TEX_COORD_WI",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vr",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vr [ 0 ] = vr [ 1 ] = vr [ 2 ] = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"TEX_COORD_RE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vs",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vs [ 0 ] = vs [ 1 ] = vs [ 2 ] = _1_0 ;".split(" ")}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vt",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vt = vec3 ( n , _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"PARTICLE_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vw",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vy",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vz",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"Cr",QUALIFIER:["GLSL_IN","vec4"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Cs",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Ct",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Cu",QUALIFIER:["GLSL_IN","vec3"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PARTICLE_BATCH"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_vu"],STATEMENTS:[{TYPE:"txt",TOKENS:"vu = Cr [ 0 ] ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vv"],STATEMENTS:[{TYPE:"txt",TOKENS:"vv = Cr [ 1 ] ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vw"],STATEMENTS:[{TYPE:"txt",TOKENS:"vw = Cr [ 2 ] ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vx"],STATEMENTS:[{TYPE:"txt",TOKENS:["vx","=","Cs",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_vy"],STATEMENTS:[{TYPE:"txt",TOKENS:"vy = Cr [ 3 ] ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vz"],STATEMENTS:[{TYPE:"txt",TOKENS:["vz","=","Ct",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_vA"],STATEMENTS:[{TYPE:"txt",TOKENS:["vA","=","Cu",";"]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"vu = _0_0 ; vv = _0_0 ; vw = _0_0 ; vx = vec3 ( _0_0 ) ; vy = _0_0 ; vz = vx ; vA = vx ;".split(" ")}]}]}]},{TYPE:"node",
NAME:"HAIR_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vE",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vB = _0_0 ; vC = _0_0 ; vD = _0_0 ; vE = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"OBJECT_INFO",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vF",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vI",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vG = _0_0 ; vH = _0_0 ; vI = _0_0 ; vF = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"WIREFRAME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vJ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vK",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:["vK","=","vJ",";"]}]},{TYPE:"node",NAME:"TANGENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vL = vec3 ( _0_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"LAYER_WEIGHT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"vM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"vN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vP",QUALIFIER:["float"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vO = vP = _0_0 ; vN ; vM ;".split(" ")}]},{TYPE:"node",NAME:"LIGHT_PATH",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"vQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vR",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vS",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vT",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vV",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vY",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"vZ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vQ = vR = vS = _0_0 ; vT = vU = vV = _0_0 ; vW = vW = vY = vZ = _0_0 ; vX = _0_0 ;".split(" ")}]},{TYPE:"node",NAME:"ATTRIBUTE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"v_",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wa",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wb",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"v_ = wa = vec3 ( _0_0 ) ; wb = _0_0 ;".split(" ")}]},{TYPE:"node",NAME:"SCRIPT",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[]},{TYPE:"node",NAME:"CURVE_VEC",NODE_VARS:[{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",
TOKENS:["0.0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"we",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["we","=","wd",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",TOKENS:"we . r = ( GLSL_TEXTURE ( u_nodes_texture , vec2 ( 0.5 * wd . r + 0.5 , NODE_TEX_ROW ) ) . r - 0.5 ) * 2.0 ;".split(" ")}]}]},{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:"we . g = ( GLSL_TEXTURE ( u_nodes_texture , vec2 ( 0.5 * wd . g + 0.5 , NODE_TEX_ROW ) ) . g - 0.5 ) * 2.0 ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],STATEMENTS:[{TYPE:"txt",TOKENS:"we . b = ( GLSL_TEXTURE ( u_nodes_texture , vec2 ( 0.5 * wd . b + 0.5 , NODE_TEX_ROW ) ) . b - 0.5 ) * 2.0 ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"we = mix ( wd , we , wc ) ;".split(" ")}]},{TYPE:"node",NAME:"CURVE_RGB",
NODE_VARS:[{TYPE:"node_var",NAME:"READ_A",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_R",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_G",TOKENS:["0"]},{TYPE:"node_var",NAME:"READ_B",TOKENS:["0"]},{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["0.0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wh",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_A"],
STATEMENTS:[{TYPE:"txt",TOKENS:"float r = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wg . r , NODE_TEX_ROW ) ) . a ; float g = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wg . g , NODE_TEX_ROW ) ) . a ; float b = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wg . b , NODE_TEX_ROW ) ) . a ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float r = wg . r ; float g = wg . g ; float b = wg . b ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_R"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wh . r = GLSL_TEXTURE ( u_nodes_texture , vec2 ( r , NODE_TEX_ROW ) ) . r ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"wh . r = r ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_G"],STATEMENTS:[{TYPE:"txt",TOKENS:"wh . g = GLSL_TEXTURE ( u_nodes_texture , vec2 ( g , NODE_TEX_ROW ) ) . g ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"wh . g = g ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["READ_B"],
STATEMENTS:[{TYPE:"txt",TOKENS:"wh . b = GLSL_TEXTURE ( u_nodes_texture , vec2 ( b , NODE_TEX_ROW ) ) . b ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"wh . b = b ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"wh = mix ( wg , wh , wf ) ;".split(" ")}]},{TYPE:"node",NAME:"VALTORGB",NODE_VARS:[{TYPE:"node_var",NAME:"NODE_TEX_ROW",TOKENS:["0.0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"wk",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec4 wl = GLSL_TEXTURE ( u_nodes_texture , vec2 ( wi , NODE_TEX_ROW ) ) ; wj = wl . rgb ; wk = wl . a ;".split(" ")}]},{TYPE:"node",NAME:"MAPPING",NODE_VARS:[{TYPE:"node_var",NAME:"MAPPING_SCALE_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_SCALE",TOKENS:["vec3","(","1.0",")"]},{TYPE:"node_var",NAME:"MAPPING_TRANS_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRANS",TOKENS:["vec3","(","0.0",")"]},{TYPE:"node_var",
NAME:"MAPPING_TRS_MATRIX_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_TRS_MATRIX",TOKENS:["mat4","(","1.0",")"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MIN_CLIP",TOKENS:["vec3","(","0.0",")"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP_DEF",TOKENS:["0"]},{TYPE:"node_var",NAME:"MAPPING_MAX_CLIP",TOKENS:["vec3","(","1.0",")"]},{TYPE:"node_var",NAME:"MAPPING_IS_NORMAL",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"wn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["wn","=","wm",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_SCALE_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = wn * MAPPING_SCALE ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRANS_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = wn + MAPPING_TRANS ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_TRS_MATRIX_DEF"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wn = ( MAPPING_TRS_MATRIX * vec4 ( wn , _1_0 ) ) . xyz ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MIN_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = max ( wn , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_MAX_CLIP_DEF"],STATEMENTS:[{TYPE:"txt",TOKENS:"wn = min ( wn , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAPPING_IS_NORMAL"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wn = normalize ( wn ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_ADD",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wq",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wq = wo + wp ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wq = clamp ( wq , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ws",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wt",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wt = wr - ws ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wt = clamp ( wt , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wA",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wA = wu * wv ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"wA = clamp ( wA , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wC",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wD",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wD = ( wC != _0_0 ) ? wB / wC : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],
STATEMENTS:[{TYPE:"txt",TOKENS:"wD = clamp ( wD , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_SINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wG",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wG = sin ( wE ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],
STATEMENTS:[{TYPE:"txt",TOKENS:"wG = clamp ( wG , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wF",";"]}]},{TYPE:"node",NAME:"MATH_COSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wJ = cos ( wH ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wJ = clamp ( wJ , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wI",";"]}]},{TYPE:"node",NAME:"MATH_TANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wK",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wM",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wM = tan ( wK ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wM = clamp ( wM , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wL",";"]}]},{TYPE:"node",NAME:"MATH_ARCSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"wP = ( wN <= _1_0 && wN >= - _1_0 ) ? asin ( wN ) : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wP = clamp ( wP , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wO",";"]}]},{TYPE:"node",NAME:"MATH_ARCCOSINE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wR",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"wS",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wS = ( wQ <= _1_0 && wQ >= - _1_0 ) ? acos ( wQ ) : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wS = clamp ( wS , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wR",";"]}]},{TYPE:"node",NAME:"MATH_ARCTANGENT",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wT",QUALIFIER:["float"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wV",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"wV = atan ( wT ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wV = clamp ( wV , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["wU",";"]}]},{TYPE:"node",NAME:"MATH_POWER",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",
NAME:"wW",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"wX",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"wY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( wW < _0_0 && wX != floor ( wX ) ) wY = _0_0 ; else if ( wX == _0_0 ) wY = _1_0 ; else if ( wW < _0_0 ) wY = mix ( _1_0 , - _1_0 , sign ( mod ( - wX , 2.0 ) ) ) * pow ( - wW , wX ) ; else if ( wW == _0_0 ) wY = _0_0 ; else wY = pow ( wW , wX ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"wY = clamp ( wY , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_LOGARITHM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"wZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"w_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xa",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xa = ( wZ > _0_0 && w_ > _0_0 ) ? log2 ( wZ ) / log2 ( w_ ) : _0_0 ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xa = clamp ( xa , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MINIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xb",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xd = min ( xb , xc ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xd = clamp ( xd , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MAXIMUM",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xe",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xf",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xg",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xg = max ( xe , xf ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xg = clamp ( xg , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_ROUND",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xh",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xi",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xj",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xj = floor ( xh + _0_5 ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xj = clamp ( xj , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["xi",";"]}]},{TYPE:"node",NAME:"MATH_LESS_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xl",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xm",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"xm = ( xk < xl ) ? _1_0 : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xm = clamp ( xm , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_GREATER_THAN",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xn",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xo",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xp",QUALIFIER:["float"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"xp = ( xn > xo ) ? _1_0 : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xp = clamp ( xp , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_MODULO",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xq",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xr",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xs",QUALIFIER:["float"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xs = abs ( xr ) > 0.000001 ? mod ( xq , xr ) : _0_0 ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xs = clamp ( xs , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATH_ABSOLUTE",NODE_VARS:[{TYPE:"node_var",NAME:"MATH_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xt",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xu",QUALIFIER:["float"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"xv",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"xv = abs ( xt ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATH_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xv = clamp ( xv , _0_0 , _1_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["xu",";"]}]},{TYPE:"node",NAME:"MIX_RGB_MIX",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xA",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"xB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xC",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xD",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xA , _0_0 , _1_0 ) ; xD = mix ( xB , xC , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xD = clamp ( xD , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_ADD",NODE_VARS:[{TYPE:"node_var",
NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xH",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xE , _0_0 , _1_0 ) ; xH = mix ( xF , xF + xG , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"xH = clamp ( xH , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_MULTIPLY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xI , _0_0 , _1_0 ) ; xL = mix ( xJ , xJ * xK , vj ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xL = clamp ( xL , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SUBTRACT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xP",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xM , _0_0 , _1_0 ) ; xP = mix ( xN , xN - xO , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xP = clamp ( xP , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SCREEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xR",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xQ , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; xT = vec3 ( _1_0 ) - ( vec3 ( xU ) + vj * ( vec3 ( _1_0 ) - xS ) ) * ( vec3 ( _1_0 ) - xR ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xT = clamp ( xT , _0_0 , _1_0 ) ;".split(" ")}]}]}]},
{TYPE:"node",NAME:"MIX_RGB_DIVIDE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xV",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"xX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"xY",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xV , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; xX += step ( xX , vec3 ( _0_0 ) ) ; xY = xU * xW + vj * xW / xX ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"xY = clamp ( xY , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DIFFERENCE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"xZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"x_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ya",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yb",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( xZ , _0_0 , _1_0 ) ; yb = mix ( x_ , abs ( x_ - ya ) , vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yb = clamp ( yb , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DARKEN",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yc",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yd",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ye",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yf",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yc , _0_0 , _1_0 ) ; yf = min ( yd . rgb , ye . rgb * vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yf = clamp ( yf , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LIGHTEN",NODE_VARS:[{TYPE:"node_var",
NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yi",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yg , _0_0 , _1_0 ) ; yj = max ( yh . rgb , yi . rgb * vj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",
TOKENS:"yj = clamp ( yj , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_OVERLAY",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yk",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ym",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yn",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yk , _0_0 , _1_0 ) ; vec3 yo = vec3 ( _1_0 - vj ) ; yn = mix ( yl * ( yo + 2.0 * vj * ym ) , vec3 ( _1_0 ) - ( yo + 2.0 * vj * ( vec3 ( _1_0 ) - ym ) ) * ( vec3 ( _1_0 ) - yl ) , step ( _0_5 , yl ) ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yn = clamp ( yn , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_DODGE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yp",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yr",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ys",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yp , _0_0 , _1_0 ) ; vec3 yt = vec3 ( _1_0 ) - vj * yr ; vec3 yu = clamp ( yq / yt , _0_0 , _1_0 ) ; ys = mix ( mix ( yu , vec3 ( _1_0 ) , step ( yt , vec3 ( _0_0 ) ) ) , yq , step ( yq , vec3 ( _0_0 ) ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"ys = clamp ( ys , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_BURN",NODE_VARS:[{TYPE:"node_var",
NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yv",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yB",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yv , _0_0 , _1_0 ) ; vec3 jI = vec3 ( _1_0 - vj ) ; vec3 yt = jI + vj * yB ; vec3 yu = clamp ( vec3 ( _1_0 ) - ( vec3 ( _1_0 ) - yA ) / yt , _0_0 , _1_0 ) ; yC = mix ( yu , vec3 ( _0_0 ) , step ( yt , vec3 ( _0_0 ) ) ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yC = clamp ( yC , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_HUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yG",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yD , _0_0 , _1_0 ) ; vec3 jA , yH , yt ; yG = yE ; yH = jz ( yF ) ; if ( yH . y != _0_0 ) { jA = jz ( yG ) ; jA . x = yH . x ; yt = jB ( jA ) ; yG = mix ( yG , yt , vj ) ; }".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yG = clamp ( yG , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SATURATION",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",
TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yI",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yL",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yI , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; yL = yJ ; vec3 jA , yH ; jA = jz ( yL ) ; if ( jA . y != _0_0 ) { yH = jz ( yK ) ; jA . y = xU * jA . y + vj * yH . y ; yL = jB ( jA ) ; }".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yL = clamp ( yL , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_VALUE",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yO",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yP",QUALIFIER:["vec3"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yM , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; vec3 jA , yH ; jA = jz ( yN ) ; yH = jz ( yO ) ; jA . z = xU * jA . z + vj * yH . z ; yP = jB ( jA ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yP = clamp ( yP , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_COLOR",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",
NAME:"yQ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yS",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yQ , _0_0 , _1_0 ) ; vec3 jA , yH , yt ; yT = yR ; yH = jz ( yS ) ; if ( yH . y != _0_0 ) { jA = jz ( yT ) ; jA . x = yH . x ; jA . y = yH . y ; yt = jB ( jA ) ; yT = mix ( yT , yt , vj ) ; }".split(" ")},{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yT = clamp ( yT , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_SOFT_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"yU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"yW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"yX",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yU , _0_0 , _1_0 ) ; float xU = _1_0 - vj ; vec3 yY = yW + yV - yW * yV ; yX = yV * ( vec3 ( xU ) + vec3 ( vj ) * ( ( vec3 ( _1_0 ) - yV ) * yW + yY ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"yX = clamp ( yX , _0_0 , _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MIX_RGB_LINEAR_LIGHT",NODE_VARS:[{TYPE:"node_var",NAME:"MIX_RGB_USE_CLAMP",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",
NAME:"yZ",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"y_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"za",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zb",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float vj = clamp ( yZ , _0_0 , _1_0 ) ; zb = y_ + vj * ( 2.0 * za - vec3 ( _1_0 ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MIX_RGB_USE_CLAMP"],STATEMENTS:[{TYPE:"txt",TOKENS:"zb = clamp ( zb , _0_0 , _1_0 ) ;".split(" ")}]}]}]},
{TYPE:"node",NAME:"OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zd",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"A = zc ; E = zd ;".split(" ")}]},{TYPE:"node",NAME:"MATERIAL_BEGIN",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_NORMAL",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"SHADELESS_MAT",TOKENS:["0"]}],
DECLARATIONS:[{TYPE:"node_in",NAME:"ze",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zh",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"zi",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"zm",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zo",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zp",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zq",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qL",QUALIFIER:["const","vec2"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"qM",QUALIFIER:["const","vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"zl = clamp ( ze , _0_0 , _1_0 ) ; zm = qM [ 0 ] * clamp ( zf , _0_0 , _1_0 ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_NORMAL"],STATEMENTS:[{TYPE:"txt",TOKENS:"zn = normalize ( zh ) ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:["zn","=","ny",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["SHADELESS_MAT",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"txt",TOKENS:"zj = zi * zl ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",
TOKENS:"zj = qS * zl ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:["zl","*=","zg",";"]}]}]},{TYPE:"txt",TOKENS:"zk = qT * u_environment_energy * ci ( zn ) ; zq = vec4 ( 1.0 ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NUM_LIGHTS",0,{TYPE:"g_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"zo = vec2 ( qL [ 0 ] , qL [ 1 ] ) ; zp = vec2 ( qM [ 1 ] , qM [ 2 ] ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["D",
"=","zq",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"zj = vec3 ( _0_0 ) ; zk = vec3 ( _1_0 ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"MATERIAL_END",NODE_VARS:[{TYPE:"node_var",NAME:"MATERIAL_EXT",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_DIFFUSE",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_MATERIAL_SPECULAR",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"zr",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zs",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zt",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"zu",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"zv",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"zA",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zB",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zC",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zD",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zE",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zF",QUALIFIER:["vec3"],
IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"qN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"qO",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["zu",";"]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zB"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_DIFFUSE"],STATEMENTS:[{TYPE:"txt",TOKENS:"zB = zr . rgb ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"zB = vec3 ( _0_0 ) ;".split(" ")}]}]},{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["zB","+=","zs",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zD"],STATEMENTS:[{TYPE:"txt",TOKENS:["zD","=","zt",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MATERIAL_EXT"],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zE"],STATEMENTS:[{TYPE:"txt",TOKENS:"zE = zr . rgb ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zF"],
STATEMENTS:[{TYPE:"txt",TOKENS:["zF","=","zs",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zC"],STATEMENTS:[{TYPE:"txt",TOKENS:"zC = clamp ( zA , _0_0 , _1_0 ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:"float t = max ( max ( zs . r , zs . g ) , zs . b ) * zv ; zC = clamp ( zA * ( _1_0 - t ) + t , _0_0 , _1_0 ) ;".split(" ")}]}]}]}]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_zC"],STATEMENTS:[{TYPE:"txt",TOKENS:"zC = clamp ( qN , _0_0 , _1_0 ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:"float t = max ( max ( zs . r , zs . g ) , zs . b ) * qO ; zC = qN * ( _1_0 - t ) + t ;".split(" ")}]}]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_MATERIAL_SPECULAR"],STATEMENTS:[{TYPE:"txt",TOKENS:["B","=","zs",";"]}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"B = vec3 ( _0_0 ) ;".split(" ")}]}]},
{TYPE:"txt",TOKENS:["C","=","zt",";"]}]},{TYPE:"node",NAME:"LIGHTING_AMBIENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"nP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"nQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"nR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nS",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nT",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"nS = vec4 ( nP + nR * nQ , _0_0 ) ; nT = vec3 ( _0_0 ) ;".split(" ")}]},
{TYPE:"node",NAME:"LIGHTING_LAMP",NODE_VARS:[{TYPE:"node_var",NAME:"LAMP_TYPE",TOKENS:["HEMI"]},{TYPE:"node_var",NAME:"LAMP_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"LAMP_SPOT_SIZE",TOKENS:["0.8"]},{TYPE:"node_var",NAME:"LAMP_SPOT_BLEND",TOKENS:["0.03"]},{TYPE:"node_var",NAME:"LAMP_LIGHT_DIST",TOKENS:["30.0"]},{TYPE:"node_var",NAME:"LAMP_SHADOW_MAP_IND",TOKENS:["-","1"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"nU",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_out",NAME:"nW",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nX",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"nY",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"nW = vec2 ( u_light_positions [ LAMP_IND ] . w , u_light_color_intensities [ LAMP_IND ] . w ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","HEMI",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:["nY","=","_0_5",";"]}]},{TYPE:"node_else",
STATEMENTS:[{TYPE:"txt",TOKENS:["nY","=","_0_0",";"]}]}]},{TYPE:"txt",TOKENS:"nX = u_light_color_intensities [ LAMP_IND ] . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_SHADOW_MAP_IND",1,{TYPE:"negative_expr",PLACES:1},{TYPE:"non_equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"nX *= nU [ LAMP_SHADOW_MAP_IND ] ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2},"LAMP_TYPE","POINT",{TYPE:"equal_expr",
PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 nZ = u_light_positions [ LAMP_IND ] . xyz ; nV = nZ - nx ; float aG = length ( nV ) ; nX *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + aG * aG ) ; nV = normalize ( nV ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["LAMP_TYPE","SPOT",{TYPE:"equal_expr",PLACES:2}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oa = u_light_directions [ LAMP_IND ] ; float ob = dot ( nV , oa ) ; ob *= smoothstep ( _0_0 , _1_0 , ( ob - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; nX *= ob ;".split(" ")}]}]}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"nV = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]},{TYPE:"node",NAME:"DIFFUSE_FRESNEL",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"od",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oe",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"of",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"og",QUALIFIER:["vec2"],
IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oh",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oc , f . xyz ) ; oe = cross ( oi , f . xyz ) ; oe = - normalize ( oe ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oh = _0_0 ; if ( od . r != _0_0 ) { float oj = ( _1_0 - of ) * dot ( oe , oc ) + of ; if ( og [ 0 ] == _0_0 ) { oh = _1_0 ; } else { float t = _1_0 + abs ( oj ) ; t = og [ 1 ] + ( _1_0 - og [ 1 ] ) * pow ( t , og [ 0 ] ) ; oh = clamp ( t , _0_0 , _1_0 ) ; } oh = max ( oh , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_LAMBERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"ok",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ol",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"om",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"on",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oo",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],
STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( ok , f . xyz ) ; om = cross ( oi , f . xyz ) ; om = - normalize ( om ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oo = _0_0 ; if ( ol . r != _0_0 ) { float oj = ( _1_0 - on ) * dot ( om , ok ) + on ; oo = max ( oj , _0_0 ) ; }".split(" ")}]},{TYPE:"node",NAME:"DIFFUSE_OREN_NAYAR",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"op",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oq",QUALIFIER:["vec2"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"or",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"os",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ot",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"ou",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( op , f . xyz ) ; or = cross ( oi , f . xyz ) ; or = - normalize ( or ) ;".split(" ")}]}]},{TYPE:"txt",
TOKENS:"ou = _0_0 ; if ( oq . r != _0_0 ) { float oj = ( _1_0 - os ) * dot ( or , op ) + os ; if ( ot [ 0 ] > _0_0 ) { float ov = max ( dot ( or , v ) , _0_0 ) ; float ow = ot [ 0 ] * ot [ 0 ] ; float ck = _1_0 - _0_5 * ( ow / ( ow + 0.33 ) ) ; vec3 ox = op - oj * or ; vec3 oy = v - ov * or ; if ( length ( ox ) == _0_0 || length ( oy ) == _0_0 || abs ( oj ) > _1_0 || abs ( ov ) > _1_0 ) ou = oj * ck ; else { float oz = acos ( oj ) ; float oA = acos ( ov ) ; vec3 oB = normalize ( ox ) ; vec3 oC = normalize ( oy ) ; float a , b ; a = max ( oz , oA ) ; b = min ( oz , oA ) ; b *= 0.95 ; float t = max ( dot ( oB , oC ) , _0_0 ) ; float oD = 0.45 * ( ow / ( ow + 0.09 ) ) ; ou = oj * ( ck + ( oD * t * sin ( a ) * tan ( b ) ) ) ; } } else ou = oj ; ou = max ( ou , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_MINNAERT",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oE",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oF",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oG",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oI",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oJ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oE , f . xyz ) ; oG = cross ( oi , f . xyz ) ; oG = - normalize ( oG ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oJ = _0_0 ; if ( oF . r != _0_0 ) { float oj = ( _1_0 - oH ) * dot ( oG , oE ) + oH ; float ov = max ( dot ( oG , v ) , _0_0 ) ; if ( oI [ 0 ] <= _1_0 ) oJ = oj * pow ( max ( ov * oj , 0.1 ) , oI [ 0 ] - _1_0 ) ; else oJ = oj * pow ( 1.0001 - ov , oI [ 0 ] - _1_0 ) ; oJ = max ( oJ , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"DIFFUSE_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oK",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oL",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oO",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 oi = cross ( oK , f . xyz ) ; oM = cross ( oi , f . xyz ) ; oM = - normalize ( oM ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oP = _0_0 ; if ( oL . r != _0_0 ) { float oj = ( _1_0 - oN ) * dot ( oM , oK ) + oN ; float oQ = acos ( oj ) ; if ( oQ < oO [ 0 ] ) oP = _1_0 ; else if ( oQ > ( oO [ 0 ] + oO [ 1 ] ) || oO [ 1 ] == _0_0 ) oP = _0_0 ; else oP = _1_0 - ( ( oQ - oO [ 0 ] ) / oO [ 1 ] ) ; oP = max ( oP , _0_0 ) ; }".split(" ")}]},
{TYPE:"node",NAME:"SPECULAR_PHONG",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oS",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oT",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oU",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oV",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"oW",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"oW = _0_0 ; if ( oS . g == _1_0 ) { vec3 oX = normalize ( oR + v ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( oU == _0_0 ) { oW = dot ( f . xyz , oX ) ; oW = sqrt ( _1_0 - oW * oW ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"oW = ( _1_0 - oU ) * max ( dot ( oT , oX ) , _0_0 ) + oU ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"oW = pow ( oW , oV [ 0 ] ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_COOKTORR",
NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"oY",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"oZ",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"o_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pa",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pb",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pc",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pc = _0_0 ; if ( oZ . g != _0_0 ) { vec3 oX = normalize ( oY + v ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( pa == _0_0 ) { pc = dot ( o . xyz , oX ) ; pc = sqrt ( _1_0 - pc * pc ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"pc = max ( dot ( o_ , oX ) , _0_0 ) ; pc = ( _1_0 - pa ) * pc + pa ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float ov = max ( dot ( o . xyz , v ) , _0_0 ) ; ov = sqrt ( _1_0 - ov * ov ) ;".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float ov = max ( dot ( o_ , v ) , _0_0 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"pc = pow ( pc , pb [ 0 ] ) ; pc = pc / ( 0.1 + ov ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_WARDISO",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pe",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},
{TYPE:"node_in",NAME:"pg",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"ph",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pi",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pi = _0_0 ; if ( pe . g == _1_0 ) { vec3 oX = normalize ( pd + v ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = _0_0 ; float ov = _0_0 ; float pk = _0_0 ; if ( pg == _0_0 ) { pj = dot ( f . xyz , oX ) ; ov = dot ( f . xyz , v ) ; pk = dot ( f . xyz , pd ) ; pj = sqrt ( _1_0 - pj * pj ) ; ov = sqrt ( _1_0 - ov * ov ) ; pk = sqrt ( _1_0 - pk * pk ) ; }".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = max ( dot ( pf , oX ) , 0.01 ) ; float ov = max ( dot ( pf , v ) , 0.01 ) ; float pk = max ( dot ( pf , pd ) , 0.01 ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"float bp = tan ( acos ( pj ) ) ; float L = max ( ph [ 0 ] , 0.01 ) ; pi = pk * ( _1_0 / ( 4.0 * M_PI * L * L ) ) * ( exp ( - ( bp * bp ) / ( L * L ) ) / ( sqrt ( ov * pk ) ) ) ; }".split(" ")}]},{TYPE:"node",NAME:"SPECULAR_TOON",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",
TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pm",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"po",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pr",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pu",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"pu = _0_0 ; if ( pm . g == _1_0 ) { vec3 bS = normalize ( pl + v ) ;".split(" ")},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pv = dot ( bS , f . xyz ) ; float bp = pr [ 0 ] + pr [ 1 ] ; if ( po == _0_0 ) bp = acos ( sqrt ( _1_0 - pv * pv ) ) ;".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"float bp = acos ( dot ( bS , pn ) ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"if ( bp < pr [ 0 ] ) pu = _1_0 ; else if ( bp >= pr [ 0 ] + pr [ 1 ] || pr [ 1 ] == _0_0 ) pu = _0_0 ; else pu = _1_0 - ( bp - pr [ 0 ] ) / pr [ 1 ] ; }".split(" ")}]},
{TYPE:"node",NAME:"SPECULAR_BLINN",NODE_VARS:[{TYPE:"node_var",NAME:"MAT_USE_TBN_SHADING",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"pw",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"px",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"py",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pz",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pA",QUALIFIER:["vec2"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pB",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",
TOKENS:"pB = _0_0 ; if ( px . g == _1_0 ) { if ( pA [ 0 ] < 1.0 || pA [ 1 ] == _0_0 ) pB = _0_0 ; else { if ( pA [ 1 ] < 100.0 ) pA [ 1 ] = sqrt ( 1.0 / pA [ 1 ] ) ; else pA [ 1 ] = 10.0 / pA [ 1 ] ; vec3 oX = normalize ( v + pw ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["MAT_USE_TBN_SHADING"],STATEMENTS:[{TYPE:"txt",TOKENS:"float pj = 0.0 ; if ( pz == _0_0 ) { float pC = dot ( f . xyz , oX ) ; pj = sqrt ( _1_0 - pC * pC ) ; }".split(" ")}]},{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",
TOKENS:"float pj = ( _1_0 - pz ) * max ( dot ( py , oX ) , _0_0 ) + pz ;".split(" ")}]}]},{TYPE:"txt",TOKENS:"if ( pj < _0_0 ) pB = _0_0 ; else { float ov = max ( dot ( py , v ) , 0.01 ) ; float pk = dot ( py , pw ) ; if ( pk <= 0.01 ) pB = _0_0 ; else { float pD = max ( dot ( v , oX ) , 0.01 ) ; float a = _1_0 ; float b = ( 2.0 * pj * ov ) / pD ; float de = ( 2.0 * pj * pk ) / pD ; float g = min ( min ( a , b ) , de ) ; float p = sqrt ( pow ( pA [ 0 ] , 2.0 ) + pow ( pD , 2.0 ) - _1_0 ) ; float ln = pow ( p - pD , 2.0 ) / pow ( p + pD , 2.0 ) * ( _1_0 + pow ( pD * ( p + pD ) - _1_0 , 2.0 ) / pow ( pD * ( p - pD ) + _1_0 , 2.0 ) ) ; float oQ = acos ( pj ) ; pB = max ( ln * g * exp ( - pow ( oQ , 2.0 ) / ( 2.0 * pow ( pA [ 1 ] , 2.0 ) ) ) , _0_0 ) ; } } } }".split(" ")}]},
{TYPE:"node",NAME:"LIGHTING_APPLY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"pE",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pF",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pI",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pJ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pK",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"pL",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pM",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pN",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"pO",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pP",QUALIFIER:["vec4"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"pQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_NODE_B4W_TRANSLUCENCY"],STATEMENTS:[{TYPE:"txt",TOKENS:"if ( dot ( pI , pJ ) * dot ( v , pJ ) < _0_0 ) { float zH = pK . x ; float zI = pK . y ; float zJ = pK . z ; float zK = pK . w ; float zL = clamp ( abs ( dot ( pI , pJ ) ) , _0_0 , _1_0 ) ; float zM = clamp ( dot ( v , - pI ) , _0_0 , _1_0 ) ; float zN = pow ( zM , zI ) ; pP = pE + pO * vec4 ( pN * zL * pow ( pL , vec3 ( zH ) ) , _1_0 ) ; pP += zJ * mix ( vec4 ( pL , _1_0 ) , vec4 ( _1_0 ) , zK ) * pO * vec4 ( pN * zL * vec3 ( zN ) , _1_0 ) ; pQ = pF ; } else { pQ = pF + pN * pM * pH ; pP = pE + vec4 ( pN * pL * pG , pH ) ; }".split(" ")}]},
{TYPE:"node_else",STATEMENTS:[{TYPE:"txt",TOKENS:"pQ = pF + pN * pM * pH ; pP = pE + vec4 ( pN * pL * pG , pH ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"RGB",NODE_VARS:[{TYPE:"node_var",NAME:"RGB_IND",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_out",NAME:"zO",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"zO = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{TYPE:"node",NAME:"RGBTOBW",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zP",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",
NAME:"zQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"zQ = dot ( zP , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"SEPRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zS",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zT",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zU",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zS"],
STATEMENTS:[{TYPE:"txt",TOKENS:"zS = zR . r ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zT"],STATEMENTS:[{TYPE:"txt",TOKENS:"zT = zR . g ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zU"],STATEMENTS:[{TYPE:"txt",TOKENS:"zU = zR . b ;".split(" ")}]}]}]},{TYPE:"node",NAME:"SEPHSV",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"zV",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"zW",QUALIFIER:["float"],IS_OPTIONAL:!0},
{TYPE:"node_out",NAME:"zX",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"zY",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 zZ = jz ( zV ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zW"],STATEMENTS:[{TYPE:"txt",TOKENS:"zW = zZ . r ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zX"],STATEMENTS:[{TYPE:"txt",TOKENS:"zX = zZ . g ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_zY"],
STATEMENTS:[{TYPE:"txt",TOKENS:"zY = zZ . b ;".split(" ")}]}]}]},{TYPE:"node",NAME:"SQUEEZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"z_",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Aa",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ab",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ac",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Ac = _1_0 / ( _1_0 + pow ( 2.71828183 , - ( z_ - Ab ) * Aa ) ) ;".split(" ")}]},{TYPE:"node",NAME:"GAMMA",
NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Ad",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Ae",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Af",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Af = Ad ; if ( Af . x > _0_0 ) Af . x = pow ( Ad . x , Ae ) ; if ( Af . y > _0_0 ) Af . y = pow ( Ad . y , Ae ) ; if ( Af . z > _0_0 ) Af . z = pow ( Ad . z , Ae ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_SRGB_TO_LINEAR",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",
NAME:"Ag",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ah",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Ah = max ( vec3 ( _0_0 ) , Ag ) ; Ah = pow ( Ah , vec3 ( 2.2 ) ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_LINEAR_TO_SRGB",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Ai",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Aj",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Aj = max ( vec3 ( _0_0 ) , Ai ) ; Aj = pow ( Aj , vec3 ( _1_0 / 2.2 ) ) ;".split(" ")}]},
{TYPE:"node",NAME:"TEXTURE_EMPTY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"Ak",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Al",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Am",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ak"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ak [ 2 ] = Ak [ 1 ] = Ak [ 0 ] = _0_0 ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Al"],STATEMENTS:[{TYPE:"txt",
TOKENS:"Al [ 2 ] = Al [ 1 ] = Al [ 0 ] = _0_0 ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Am"],STATEMENTS:[{TYPE:"txt",TOKENS:["Am","=","_0_0",";"]}]}]}]},{TYPE:"node",NAME:"TEXTURE_ENVIRONMENT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"An",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ao",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ap",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_ENVIRONMENT_var_texture",
QUALIFIER:["uniform","samplerCube"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec4 wl = GLSL_TEXTURE_CUBE ( node_TEXTURE_ENVIRONMENT_var_texture , An ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ao"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ao = wl . xyz ; cb ( Ao ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ap"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ap = wl . w ;".split(" ")}]}]}]},{TYPE:"node",NAME:"TEXTURE_COLOR",NODE_VARS:[{TYPE:"node_var",
NAME:"NON_COLOR",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv4",TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"Ar",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"As",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"At",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"Au",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Av",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",
NAME:"Aw",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ax",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Ay",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"Az",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AA",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AB",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AC",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_COLOR_var_texture",QUALIFIER:["uniform","sampler2D"],
IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec4 wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( Ar ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Av"],STATEMENTS:[{TYPE:"txt",TOKENS:"Av = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["cb","(","Av",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Aw"],STATEMENTS:[{TYPE:"txt",
TOKENS:"Aw = wl . w ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( As ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ax"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ax = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["cb","(","Ax",")",";"]}]}]}]}]},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ay"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ay = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( At ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Az"],STATEMENTS:[{TYPE:"txt",TOKENS:"Az = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",
{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["cb","(","Az",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AA"],STATEMENTS:[{TYPE:"txt",TOKENS:"AA = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_COLOR_var_texture , qB ( Au ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AB"],STATEMENTS:[{TYPE:"txt",
TOKENS:"AB = wl . xyz ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["NON_COLOR",{TYPE:"logic_negative_expr",PLACES:1}],STATEMENTS:[{TYPE:"txt",TOKENS:["cb","(","AB",")",";"]}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AC"],STATEMENTS:[{TYPE:"txt",TOKENS:"AC = wl . w ;".split(" ")}]}]}]}]}]},{TYPE:"node",NAME:"TEXTURE_NORMAL",NODE_VARS:[{TYPE:"node_var",NAME:"USE_uv2",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv3",TOKENS:["0"]},{TYPE:"node_var",NAME:"USE_uv4",
TOKENS:["0"]}],DECLARATIONS:[{TYPE:"node_in",NAME:"AD",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"AE",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"AF",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_in",NAME:"AG",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AH",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AI",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AJ",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AK",QUALIFIER:["float"],
IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AL",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AM",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AN",QUALIFIER:["vec3"],IS_OPTIONAL:!0},{TYPE:"node_out",NAME:"AO",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_TEXTURE_NORMAL_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec4 wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AD ) ) ;".split(" ")},{TYPE:"node_cond",
PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AH"],STATEMENTS:[{TYPE:"txt",TOKENS:"AH = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AI"],STATEMENTS:[{TYPE:"txt",TOKENS:"AI = wl . w ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv2"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AE ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AJ"],
STATEMENTS:[{TYPE:"txt",TOKENS:"AJ = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AK"],STATEMENTS:[{TYPE:"txt",TOKENS:"AK = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv3"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AF ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AL"],STATEMENTS:[{TYPE:"txt",TOKENS:"AL = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},
{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AM"],STATEMENTS:[{TYPE:"txt",TOKENS:"AM = wl . w ;".split(" ")}]}]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_uv4"],STATEMENTS:[{TYPE:"txt",TOKENS:"wl = GLSL_TEXTURE ( node_TEXTURE_NORMAL_var_texture , qB ( AG ) ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AN"],STATEMENTS:[{TYPE:"txt",TOKENS:"AN = normalize ( qQ * ( wl . xyz - _0_5 ) ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_AO"],STATEMENTS:[{TYPE:"txt",TOKENS:"AO = wl . w ;".split(" ")}]}]}]}]}]},{TYPE:"node",NAME:"VALUE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"AP",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"AP = u_node_values [ VALUE_IND ] ;".split(" ")}]},{TYPE:"node",NAME:"VECT_MATH_ADD",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"AQ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AS",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AT",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"AS = AQ + AR ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AT"],STATEMENTS:[{TYPE:"txt",TOKENS:"AT = ( abs ( AS [ 0 ] ) + abs ( AS [ 1 ] ) + abs ( AS [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_SUBTRACT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"AU",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AV",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AW",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"AX",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"AW = AU - AV ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_AX"],STATEMENTS:[{TYPE:"txt",TOKENS:"AX = ( abs ( AW [ 0 ] ) + abs ( AW [ 1 ] ) + abs ( AW [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_AVERAGE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"AY",
QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"AZ",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"A_",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Ba",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"A_ = AY + AZ ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Ba"],STATEMENTS:[{TYPE:"txt",TOKENS:"Ba = length ( A_ ) ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_A_"],STATEMENTS:[{TYPE:"txt",
TOKENS:"A_ = normalize ( A_ ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_DOT_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bb",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bc",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bd",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Be",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bd = vec3 ( _0_0 ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_Be"],
STATEMENTS:[{TYPE:"txt",TOKENS:"Be = dot ( Bb , Bc ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_CROSS_PRODUCT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bf",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bg",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bh",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bi",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bh = cross ( Bf , Bg ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_Bi"],STATEMENTS:[{TYPE:"txt",TOKENS:"Bi = length ( Bh ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"VECT_MATH_NORMALIZE",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bj",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bk",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bl",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bm",QUALIFIER:["float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bl = normalize ( Bj ) ;".split(" ")},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["USE_OUT_Bm"],STATEMENTS:[{TYPE:"txt",TOKENS:"Bm = length ( Bj ) ;".split(" ")}]}]},{TYPE:"txt",TOKENS:["Bk",";"]}]},{TYPE:"node",NAME:"B4W_REFLECT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bn",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bo",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bp",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bp = reflect ( U ( G , Bn ) , Bo ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_REFLECT_WORLD",NODE_VARS:[],
DECLARATIONS:[{TYPE:"node_in",NAME:"Bq",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Br",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"vec3 Bs = - v . xyz ; Br = reflect ( Bs , Bq ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_PARALLAX",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"Bt",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bu",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"Bv",QUALIFIER:["const","float"],IS_OPTIONAL:!1},{TYPE:"node_in",
NAME:"Bw",QUALIFIER:["const","float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bx",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_param",NAME:"node_B4W_PARALLAX_var_texture",QUALIFIER:["uniform","sampler2D"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"float bt = length ( qR ) ; if ( bt < Bw ) { vec2 bI = qB ( Bt ) ; float bM = clamp ( _0_5 * ( Bw - bt ) , _0_0 , _1_0 ) ; float hl = Bu * bM ; vec3 bO = normalize ( v * qQ ) ; float bP = _1_0 / Bv ; vec2 bQ = bO . xy * hl / ( Bv * bO . z ) ; float bR = _1_0 ; float bS = GLSL_TEXTURE ( node_B4W_PARALLAX_var_texture , bI ) . a ; for ( float bU = 1.0 ; bU <= Bv ; bU ++ ) { if ( bS < bR ) { bR -= bP ; bI -= bQ ; bS = GLSL_TEXTURE ( node_B4W_PARALLAX_var_texture , bI ) . a ; } } vec2 bV = bI + bQ ; float bW = GLSL_TEXTURE ( node_B4W_PARALLAX_var_texture , bV ) . a - ( bR + bP ) ; float bX = bS - bR ; float bY = bX / ( bX - bW ) ; bI = bY * bV + ( _1_0 - bY ) * bI ; Bx = qA ( bI ) ; } else Bx = Bt ;".split(" ")}]},
{TYPE:"node",NAME:"B4W_CLAMP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"By",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"Bz",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"Bz = clamp ( By , _0_0 , _1_0 ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_REFRACTION",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BA",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BB",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BC",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],
STATEMENTS:[{TYPE:"txt",TOKENS:["BC","=","BA",";"]}]},{TYPE:"node",NAME:"B4W_TRANSLUCENCY",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BD",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BE",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BF",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BG",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BH",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BI",QUALIFIER:["float"],IS_OPTIONAL:!0},{TYPE:"node_out",
NAME:"BJ",QUALIFIER:["vec4"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_BI"],STATEMENTS:[{TYPE:"txt",TOKENS:["BI","=","BD",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["USE_OUT_BJ"],STATEMENTS:[{TYPE:"txt",TOKENS:"BJ = vec4 ( BE , BF , BG , BH ) ;".split(" ")}]}]}]},{TYPE:"node",NAME:"B4W_TIME",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_out",NAME:"BK",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:["BK","=","u_time",
";"]}]},{TYPE:"node",NAME:"B4W_SMOOTHSTEP",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BL",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BM",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BN",QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BO",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"BO = smoothstep ( BM , BN , BL ) ;".split(" ")}]},{TYPE:"node",NAME:"B4W_GLOW_OUTPUT",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BP",QUALIFIER:["vec3"],
IS_OPTIONAL:!1},{TYPE:"node_in",NAME:"BQ",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"A = BP ; E = BQ ;".split(" ")}]},{TYPE:"node",NAME:"B4W_VECTOSCAL",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BR",QUALIFIER:["vec3"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BS",QUALIFIER:["float"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"BS = ( BR . r + BR . g + BR . b ) / 3.0 ;".split(" ")}]},{TYPE:"node",NAME:"B4W_SCALTOVEC",NODE_VARS:[],DECLARATIONS:[{TYPE:"node_in",NAME:"BT",
QUALIFIER:["float"],IS_OPTIONAL:!1},{TYPE:"node_out",NAME:"BU",QUALIFIER:["vec3"],IS_OPTIONAL:!1}],STATEMENTS:[{TYPE:"txt",TOKENS:"BU [ 0 ] = BT ; BU [ 1 ] = BT ; BU [ 2 ] = BT ;".split(" ")}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:"void J ( in vec3 v , in mat3 F , in mat3 G , in mat3 H , in mat3 I , out vec3 A , out vec3 B , out vec3 C , out vec4 D , out float E ) { A = vec3 ( _0_0 ) ; B = vec3 ( _0_0 ) ; C = vec3 ( _0_0 ) ; D = vec4 ( _0_0 ) ; E = _0_0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO","USE_NODE_NORMAL_MAP",{TYPE:"logical_or_expr",PLACES:6}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Q = normalize ( e ) ; vec3 bJ = Q ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["INVERT_FRONTFACING"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:["if","(","!","gl_FrontFacing",")"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["if","(","gl_FrontFacing",")"]}]}}]},{TYPE:"txt",TOKENS:"bJ = bJ ; else bJ = - bJ ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DOUBLE_SIDED_LIGHTING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ny","=","bJ",";"]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","ny","=","Q",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_NO"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3","qP","=","bJ",";"]}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CALC_TBN_SPACE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 S = cross ( bJ , f . xyz ) * f . w ; S = normalize ( S ) ; vec3 R = cross ( S , bJ ) * f . w ; mat3 qQ = mat3 ( R , S , bJ ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 nx = c ; vec4 qR = d ; float qS = u_emit ; float qT = u_ambient ;".split(" ")},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/particles_nodes.glslv"]=
{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PARTICLES_NODES_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PARTICLES_NODES_GLSLV",TOKENS:[""]},{TYPE:"node",NAME:"TEX_COORD_UV",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["n","=","CA",";"]}]},{TYPE:"node",NAME:"UV_MERGED",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["n","=","CA",";"]}]},{TYPE:"node",NAME:"UVMAP",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["n","=","CA",";"]}]},{TYPE:"node",
NAME:"GEOMETRY_UV",NODE_VARS:[],DECLARATIONS:[],STATEMENTS:[{TYPE:"txt",TOKENS:["n","=","CA",";"]}]},{TYPE:"node",NAME:"PARTICLE_INFO",NODE_VARS:[{TYPE:"node_var",NAME:"PART_INFO_SIZE",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_AGE",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_LT",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_LOC",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_IND",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_VEL",TOKENS:["0"]},{TYPE:"node_var",NAME:"PART_INFO_A_VEL",TOKENS:["0"]}],
DECLARATIONS:[{TYPE:"node_param",NAME:"Cr",QUALIFIER:["GLSL_OUT","vec4"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Cs",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Ct",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"Cu",QUALIFIER:["GLSL_OUT","vec3"],IS_OPTIONAL:!0},{TYPE:"node_param",NAME:"node_PARTICLE_INFO_var_a_p_indices",QUALIFIER:["GLSL_IN","float"],IS_OPTIONAL:!0}],STATEMENTS:[{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_SIZE"],
STATEMENTS:[{TYPE:"txt",TOKENS:"Cr [ 3 ] = Cz ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_AGE"],STATEMENTS:[{TYPE:"txt",TOKENS:"Cr [ 1 ] = Cy ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_LT"],STATEMENTS:[{TYPE:"txt",TOKENS:"Cr [ 2 ] = CB ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_LOC"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cs","=","Cv",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",
EXPRESSION:["PART_INFO_IND"],STATEMENTS:[{TYPE:"txt",TOKENS:"Cr [ 0 ] = node_PARTICLE_INFO_var_a_p_indices ;".split(" ")}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_VEL"],STATEMENTS:[{TYPE:"txt",TOKENS:["Ct","=","Cw",";"]}]}]},{TYPE:"node_cond",PARTS:[{TYPE:"node_if",EXPRESSION:["PART_INFO_A_VEL"],STATEMENTS:[{TYPE:"txt",TOKENS:["Cu","=","Cx",";"]}]}]}]},{TYPE:"nodes_global"},{TYPE:"txt",TOKENS:"void J ( in vec3 Cv , in vec3 Cw , in vec3 Cx , in float Cy , in float Cz , in vec2 CA , in float CB ) {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["n","=","CA",";"]}]}}]},{TYPE:"nodes_main"},{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/precision_statement.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PRECISION_STATEMENT_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PRECISION_STATEMENT_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},
{TYPE:"txt",TOKENS:["precision","PRECISION","float",";"]}]}}]}]};a["include/procedural.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"PROCEDURAL_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"PROCEDURAL_GLSLF",TOKENS:[""]},{TYPE:"txt",TOKENS:"vec4 CC ( vec4 x ) { return x - floor ( x * ( _1_0 / 289.0 ) ) * 289.0 ; } vec3 CC ( vec3 x ) { return x - floor ( x * ( _1_0 / 289.0 ) ) * 289.0 ; } vec2 CC ( vec2 x ) { return x - floor ( x * ( _1_0 / 289.0 ) ) * 289.0 ; } vec4 CD ( vec4 x ) { return x - floor ( x * ( _1_0 / 7.0 ) ) * 7.0 ; } vec4 CE ( vec4 x ) { return CC ( ( 34.0 * x + 5.0 ) * x ) ; }".split(" ")},
{TYPE:"define",NAME:"K",TOKENS:["0.142857142857"]},{TYPE:"define",NAME:"K2",TOKENS:["0.0714285714285"]},{TYPE:"define",NAME:"JITTER",TOKENS:["0.7"]},{TYPE:"txt",TOKENS:"vec2 e_ ( vec2 CF ) { vec2 CG = CC ( floor ( CF ) ) ; vec2 CH = fract ( CF ) ; vec4 CI = CH . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 CJ = CH . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 p = CE ( CG . x + vec4 ( _0_0 , _1_0 , _0_0 , _1_0 ) ) ; p = CE ( p + CG . y + vec4 ( _0_0 , _0_0 , _1_0 , _1_0 ) ) ; vec4 CK = CD ( p ) * K + K2 ; vec4 CL = CD ( floor ( p * K ) ) * K + K2 ; vec4 CM = CI + JITTER * CK ; vec4 CN = CJ + JITTER * CL ; vec4 dj = CM * CM + CN * CN ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:[1],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dj . xy = min ( dj . xy , dj . zw ) ; dj . x = min ( dj . x , dj . y ) ; return dj . xx ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dj . xy = ( dj . x < dj . y ) ? dj . xy : dj . yx ; dj . xz = ( dj . x < dj . z ) ? dj . xz : dj . zx ; dj . xw = ( dj . x < dj . w ) ? dj . xw : dj . wx ; dj . y = min ( dj . y , dj . z ) ; dj . y = min ( dj . y , dj . w ) ; return sqrt ( dj . xy ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"} vec3 kq ( vec2 CF , float CO ) { vec2 CG = CC ( floor ( CF ) ) ; vec2 CH = fract ( CF ) ; vec4 CI = CH . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 CJ = CH . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 p = CE ( CG . x + vec4 ( _0_0 , _1_0 , _0_0 , _1_0 ) ) ; p = CE ( p + CG . y + vec4 ( _0_0 , _0_0 , _1_0 , _1_0 ) ) ; vec4 CK = CD ( p ) * K + K2 ; vec4 CL = CD ( floor ( p * K ) ) * K + K2 ; vec4 CM = CI + JITTER * CK ; vec4 CN = CJ + JITTER * CL ; vec4 CP = CM * CM + CN * CN ; CM += CO ; CN += CO ; vec4 CQ = CM * CM + CN * CN ; CM += CO ; CN += CO ; vec4 CR = CM * CM + CN * CN ; CP . xy = min ( CP . xy , CP . zw ) ; CP . x = min ( CP . x , CP . y ) ; CQ . xy = min ( CQ . xy , CQ . zw ) ; CQ . x = min ( CQ . x , CQ . y ) ; CR . xy = min ( CR . xy , CR . zw ) ; CR . x = min ( CR . x , CR . y ) ; return vec3 ( CP . x , CQ . x , CR . x ) ; } vec3 CS ( vec3 x ) { return CC ( ( ( x * 34.0 ) + _1_0 ) * x ) ; } float eP ( vec2 kj ) { const vec4 CT = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 bU = floor ( kj + dot ( kj , CT . yy ) ) ; vec2 CU = kj - bU + dot ( bU , CT . xx ) ; vec2 CV ; CV = ( CU . x > CU . y ) ? vec2 ( _1_0 , _0_0 ) : vec2 ( _0_0 , _1_0 ) ; vec4 CW = CU . xyxy + CT . xxzz ; CW . xy -= CV ; bU = CC ( bU ) ; vec3 p = CS ( CS ( bU . y + vec3 ( _0_0 , CV . y , _1_0 ) ) + bU . x + vec3 ( _0_0 , CV . x , _1_0 ) ) ; vec3 aq = max ( 0.5 - vec3 ( dot ( CU , CU ) , dot ( CW . xy , CW . xy ) , dot ( CW . zw , CW . zw ) ) , _0_0 ) ; aq = aq * aq ; aq = aq * aq ; vec3 x = 2.0 * fract ( p * CT . www ) - _1_0 ; vec3 bS = abs ( x ) - 0.5 ; vec3 CK = floor ( x + 0.5 ) ; vec3 CX = x - CK ; aq *= 1.79284291400159 - 0.85373472095314 * ( CX * CX + bS * bS ) ; vec3 g ; g . x = CX . x * CU . x + bS . x * CU . y ; g . yz = CX . yz * CW . xz + bS . yz * CW . yw ; return 130.0 * dot ( aq , g ) ; } vec2 C_ ( vec2 fn ) { float CP = dot ( fn , vec2 ( 12.9898 , 78.233 ) ) ; float CQ = dot ( fn , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float CY = fract ( sin ( CP ) * 43758.5453 ) * 2.0 - _1_0 ; float CZ = fract ( sin ( CQ ) * 43758.5453 ) * 2.0 - _1_0 ; return vec2 ( CY , CZ ) ; }".split(" ")}]}}]}]};
a["include/refraction.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"REFRACTION_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"REFRACTION_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"REFRACTIVE",TOKENS:["0"]},{TYPE:"var",NAME:"USE_REFRACTION_CORRECTION",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFRACTIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION_CORRECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"pack.glslf"}]}}]},
{TYPE:"include",FILE:"color_util.glslf"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION_CORRECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float ep ( in float cA , inout vec2 eo , in vec2 dY ) { vec4 Da = GLSL_TEXTURE ( u_scene_depth , eo ) ; float eq = cz ( Da ) ; if ( eq < i ) { eo = dY ; return cA ; } else { return eq ; } return cA ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 cw ( in vec3 qi , in vec2 Db ) { vec2 dY = qi . xy / qi . z ; vec2 eo = dY + Db ;".split(" ")},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["USE_REFRACTION_CORRECTION"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 cy = GLSL_TEXTURE_PROJ ( u_scene_depth , qi ) ; float cA = cz ( cy ) ; ep ( cA , eo , dY ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 eu = GLSL_TEXTURE ( u_refractmap , eo ) . rgb ; cb ( eu ) ; return eu ; }".split(" ")}]}}]}]}}]}]};a["include/scale_texcoord.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SCALE_TEXCOORD_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SCALE_TEXCOORD_GLSLV",
TOKENS:[""]},{TYPE:"txt",TOKENS:"vec2 ap ( vec2 bI , vec3 Dc ) { return ( bI + 0.5 ) * Dc . xy - 0.5 ; }".split(" ")}]}}]}]};a["include/shadow.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SHADOW_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SHADOW_GLSLF",TOKENS:[""]},{TYPE:"var",NAME:"PRECISION",TOKENS:["highp"]},{TYPE:"var",NAME:"SHADOW_TEX_RES",TOKENS:["2048.0"]},{TYPE:"var",NAME:"CSM_FADE_LAST_CASCADE",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_BLEND_BETWEEN_CASCADES",TOKENS:["0"]},
{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"var",NAME:"POISSON_DISK_NUM",TOKENS:["NO_SOFT_SHADOWS"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",
PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"procedural.glslf"}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"const float Dd = 0.1 ; const float De = 0.1 ; const float Df = - 0.01 ; const float Dg = 0.05 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["POISSON_DISK_NUM","POISSON_X_16",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 Dh = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 Di = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 Dj = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 Dk = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 Dl = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 Dm = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 Dn = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 Do = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POISSON_DISK_NUM","POISSON_X_8",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 Dh = vec2 ( - 0.37192261 , 0.47109537 ) ; vec2 Di = vec2 ( - 0.6807477 , 0.69048062 ) ; vec2 Dj = vec2 ( 0.11615683 , - 0.91318524 ) ; vec2 Dk = vec2 ( 0.93688596 , - 0.16948928 ) ; vec2 Dl = vec2 ( - 0.89699117 , 0.74092316 ) ; vec2 Dm = vec2 ( 0.38263656 , - 0.66119884 ) ; vec2 Dn = vec2 ( - 0.08193062 , - 0.21275223 ) ; vec2 Do = vec2 ( 0.05578877 , 0.84225623 ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["POISSON_DISK_NUM","POISSON_X_4",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 Dh = vec2 ( - 0.51808083 , 0.0 ) ; vec2 Di = vec2 ( 0.5741194 , 0.0 ) ; vec2 Dj = vec2 ( - 0.68048857 , 0.0 ) ; vec2 Dk = vec2 ( 0.82934988 , 0.0 ) ; vec2 Dl = vec2 ( 0.70009436 , 0.0 ) ; vec2 Dm = vec2 ( - 0.78790467 , 0.0 ) ; vec2 Dn = vec2 ( - 0.58619489 , 0.0 ) ; vec2 Do = vec2 ( 0.41902178 , 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"bool Dq ( vec2 h_ , float Dp ) { return all ( lessThanEqual ( h_ , vec2 ( 1.0 + Dp ) ) ) && all ( greaterThanEqual ( h_ , vec2 ( 0.0 - Dp ) ) ) ; } float Dx ( float Dr , float Ds , mat2 Dt , vec3 Du , float Dv , PRECISION GLSL_SMPLR2D_SHDW Dw ) {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 h_ , fb ; fb . x = Dr ; fb . y = Ds ; fb = Dt * fb ; h_ = Du . xy + fb * Dv / SHADOW_TEX_RES ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec2 h_ = Du . xy ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"if ( ! Dq ( h_ , Df ) ) return 1.0 ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["GLSL3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return GLSL_TEXTURE ( Dw , vec3 ( h_ , Du . z ) ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return step ( Du . z , GLSL_TEXTURE ( Dw , h_ ) . r ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} float DC ( vec3 Du , PRECISION GLSL_SMPLR2D_SHDW Dw , float Dv ) { float Dy = 0.0 ; Du . z = clamp ( Du . z , 0.0 , 1.0 ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float Dz = C_ ( Du . xy ) . x * M_PI ; float DA = cos ( Dz ) ; float DB = sin ( Dz ) ; mat2 Dt = mat2 ( DA , DB , - DB , DA ) ; for ( int bU = 0 ; bU < POISSON_DISK_NUM ; bU ++ ) { Dy += Dx ( Dh [ bU ] , Dl [ bU ] , Dt , Du , Dv , Dw ) ; Dy += Dx ( Di [ bU ] , Dm [ bU ] , Dt , Du , Dv , Dw ) ; Dy += Dx ( Dj [ bU ] , Dn [ bU ] , Dt , Du , Dv , Dw ) ; Dy += Dx ( Dk [ bU ] , Do [ bU ] , Dt , Du , Dv , Dw ) ; } return clamp ( Dy / ( float ( POISSON_DISK_NUM ) * 4.0 ) , 0.0 , 1.0 ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return Dx ( 0.0 , 0.0 , mat2 ( 0.0 ) , Du , Dv , Dw ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} float DL ( vec3 DD , PRECISION GLSL_SMPLR2D_SHDW DE , vec3 DF , PRECISION GLSL_SMPLR2D_SHDW DG , float DH , float DI , float aF ) { float DJ , DK ; DD . z = clamp ( DD . z , 0.0 , 1.0 ) ; DF . z = clamp ( DF . z , 0.0 , 1.0 ) ; DJ = 0.0 ; DK = 0.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",
PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float Dz = C_ ( DD . xy ) . x * M_PI ; float DA = cos ( Dz ) ; float DB = sin ( Dz ) ; mat2 Dt = mat2 ( DA , DB , - DB , DA ) ; for ( int bU = 0 ; bU < POISSON_DISK_NUM ; bU ++ ) { DJ += Dx ( Dh [ bU ] , Dl [ bU ] , Dt , DD , DH , DE ) ; DJ += Dx ( Di [ bU ] , Dm [ bU ] , Dt , DD , DH , DE ) ; DJ += Dx ( Dj [ bU ] , Dn [ bU ] , Dt , DD , DH , DE ) ; DJ += Dx ( Dk [ bU ] , Do [ bU ] , Dt , DD , DH , DE ) ; } for ( int bU = 0 ; bU < POISSON_DISK_NUM ; bU ++ ) { DK += Dx ( Dh [ bU ] , Dl [ bU ] , Dt , DF , DI , DG ) ; DK += Dx ( Di [ bU ] , Dm [ bU ] , Dt , DF , DI , DG ) ; DK += Dx ( Dj [ bU ] , Dn [ bU ] , Dt , DF , DI , DG ) ; DK += Dx ( Dk [ bU ] , Do [ bU ] , Dt , DF , DI , DG ) ; } DJ = mix ( DJ , DK , aF ) ; DJ /= ( float ( POISSON_DISK_NUM ) * 4.0 ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"DJ += Dx ( 0.0 , 0.0 , mat2 ( 0.0 ) , DD , DH , DE ) ; DK += Dx ( 0.0 , 0.0 , mat2 ( 0.0 ) , DF , DI , DG ) ; DJ = mix ( DJ , DK , aF ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"return clamp ( DJ , 0.0 , 1.0 ) ; } float DM ( vec2 h_ ) { float a = min ( h_ . x , h_ . y ) ; float b = min ( 1.0 - h_ . x , 1.0 - h_ . y ) ; return min ( a , b ) ; } float DP ( float DN , float DO ) { if ( DO >= 0.0 && DO <= De ) DN = ( DN - 1.0 ) / De * DO + 1.0 ; return DN ; } float DU ( vec3 DQ , vec3 DR , PRECISION GLSL_SMPLR2D_SHDW DE , PRECISION GLSL_SMPLR2D_SHDW DG , float DH , float DI , float DS , float fO ) { float DN ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_BLEND_BETWEEN_CASCADES"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float DO = DM ( DQ . xy ) ; if ( - fO > DS && DO >= 0.0 && DO <= Dd && Dq ( DR . xy , 0.0 ) ) { float DT = 1.0 - DO / Dd ; DN = DL ( DQ , DE , DR , DG , DH , DI , DT ) ; } else".split(" ")}]}}]},{TYPE:"txt",TOKENS:"DN = DC ( DQ , DE , DH ) ; return DN ; } float DW ( vec3 DV , PRECISION GLSL_SMPLR2D_SHDW Dw , float Dv , float DS , float fO ) { float DN = DC ( DV , Dw , Dv ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_FADE_LAST_CASCADE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( - fO > DS ) { float DO = DM ( DV . xy ) ; DN = DP ( DN , DO ) ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"return DN ; } vec4 dH ( float fO ) { float DN = 1.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["POISSON_DISK_NUM","NO_SOFT_SHADOWS",{TYPE:"non_equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec4","DX","=","u_pcf_blur_radii",";"]}]}},{TYPE:"else",
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 DX = vec4 ( 0.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec3 DD = j . xyz / j . w ; if ( j . w < 0.0 ) DD . z = 0.0 ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1","NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 DF = k . xyz / k . w ; if ( k . w < 0.0 ) DF . z = 0.0 ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2",
"NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 DY = l . xyz / l . w ; if ( l . w < 0.0 ) DY . z = 0.0 ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3","NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 DZ = m . xyz / m . w ; if ( m . w < 0.0 ) DZ . z = 0.0 ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( Dq ( DD . xy , 0.0 ) ) { DN = DU ( DD , DF , u_shadow_map0 , u_shadow_map1 , DX [ 0 ] , DX [ 1 ] , u_csm_center_dists [ 0 ] , fO ) ; }".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"if ( Dq ( DD . xy , Dg ) ) { DN = DW ( DD , u_shadow_map0 , DX [ 0 ] , u_csm_center_dists [ 0 ] , fO ) ; }".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"else { if ( Dq ( DF . xy , 0.0 ) ) {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"DN = DU ( DF , DY , u_shadow_map1 , u_shadow_map2 , DX [ 1 ] , DX [ 2 ] , u_csm_center_dists [ 1 ] , fO ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"DN = DW ( DF , u_shadow_map1 , DX [ 1 ] , u_csm_center_dists [ 1 ] , fO ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"else { if ( Dq ( DY . xy , 0.0 ) ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"DN = DU ( DY , DZ , u_shadow_map2 , u_shadow_map3 , DX [ 2 ] , DX [ 3 ] , u_csm_center_dists [ 2 ] , fO ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"DN = DW ( DY , u_shadow_map2 , DX [ 2 ] , u_csm_center_dists [ 2 ] , fO ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"else { if ( Dq ( DZ . xy , 0.0 ) ) DN = DW ( DZ , u_shadow_map3 , DX [ 3 ] , u_csm_center_dists [ 3 ] , fO ) ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float D_ = DC ( DF , u_shadow_map1 , DX [ 0 ] ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float",
"D_","=","0.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float Ea = DC ( DY , u_shadow_map2 , DX [ 0 ] ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Ea","=","0.0",";"]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float Eb = DC ( DZ , u_shadow_map3 , DX [ 0 ] ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","Eb","=","1.0",";"]}]}}]},{TYPE:"txt",TOKENS:"return vec4 ( DN , D_ , Ea , Eb ) ; }".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec4 cl ( inout vec3 ch ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 Dy = GLSL_TEXTURE ( u_shadow_mask , h . xy / h . z ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",
3,{TYPE:"l_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"ch *= Dy . a ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["return","Dy",";"]}]}},{TYPE:"elif",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 Dy = dH ( d . z ) ; return Dy ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return vec4 ( 1.0 ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:["}"]}]}}]}]};a["include/shadow.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SHADOW_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SHADOW_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"MAC_OS_SHADOW_HACK",TOKENS:["0"]},{TYPE:"var",NAME:"SHADOW_TEX_RES",TOKENS:["2048.0"]},{TYPE:"var",NAME:"SHADOW_USAGE",TOKENS:["NO_SHADOWS"]},{TYPE:"var",NAME:"NUM_CAST_LAMPS",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION1",TOKENS:["0"]},{TYPE:"var",NAME:"CSM_SECTION2",TOKENS:["0"]},
{TYPE:"var",NAME:"CSM_SECTION3",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{TYPE:"equal_expr",PLACES:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"},{TYPE:"txt",TOKENS:"vec4 Ef ( mat4 Ec , vec4 Ed , mat4 Ee ) { vec2 dJ = ( Ec * Ee [ 3 ] ) . xy ; float dK = SHADOW_TEX_RES / 2.0 ; dJ = floor ( dJ * dK + 0.5 ) / dK - dJ ; vec4 Du = Ec * Ed ; Du . xy += dJ ; Du . xyz = 0.5 * ( Du . xyz + Du . w ) ; return Du ; } void bH ( vec3 eH , vec3 Eg ) {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat4 Ee = aV ( u_v_light_tsr [ 0 ] ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat4 Ee = aV ( mat3 ( u_v_light_ts [ 0 ] , u_v_light_r [ 0 ] , 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"vec4 Eh = Ee * vec4 ( eH + u_normal_offset * Eg , 1.0 ) ; j = Ef ( u_p_light_matrix0 , Eh , Ee ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",
1,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ee = aV ( u_v_light_tsr [ 1 ] ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ee = aV ( mat3 ( u_v_light_ts [ 1 ] , u_v_light_r [ 1 ] , 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"Eh = Ee * vec4 ( eH + u_normal_offset * Eg , 1.0 ) ; k = Ef ( u_p_light_matrix1 , Eh , Ee ) ;".split(" ")}]}}]},{TYPE:"cond",
PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",2,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ee = aV ( u_v_light_tsr [ 2 ] ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ee = aV ( mat3 ( u_v_light_ts [ 2 ] , u_v_light_r [ 2 ] , 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"Eh = Ee * vec4 ( eH + u_normal_offset * Eg , 1.0 ) ; l = Ef ( u_p_light_matrix2 , Eh , Ee ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["NUM_CAST_LAMPS",3,{TYPE:"g_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAC_OS_SHADOW_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ee = aV ( u_v_light_tsr [ 3 ] ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"Ee = aV ( mat3 ( u_v_light_ts [ 3 ] , u_v_light_r [ 3 ] , 0.0 ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"Eh = Ee * vec4 ( eH + u_normal_offset * Eg , 1.0 ) ; m = Ef ( u_p_light_matrix3 , Eh , Ee ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION1"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"k = Ef ( u_p_light_matrix1 , Eh , Ee ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION2"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"l = Ef ( u_p_light_matrix2 , Eh , Ee ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CSM_SECTION3"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"m = Ef ( u_p_light_matrix3 , Eh , Ee ) ;".split(" ")}]}}]},{TYPE:"txt",
TOKENS:["}"]}]}}]}]}}]}]};a["include/skin.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"SKIN_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SKIN_GLSLV",TOKENS:[""]},{TYPE:"var",NAME:"DISABLE_TANGENT_SKINNING",TOKENS:["0"]},{TYPE:"var",NAME:"SKINNED",TOKENS:["0"]},{TYPE:"var",NAME:"FRAMES_BLENDING",TOKENS:["0"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKINNED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"include",FILE:"math.glslv"},{TYPE:"define",NAME:"SKIN_SLERP",TOKENS:["0"]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKIN_SLERP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 Ep ( in vec4 gJ , in vec4 Ei , in float Ej ) { float Ek = gJ [ 0 ] * Ei [ 0 ] + gJ [ 1 ] * Ei [ 1 ] + gJ [ 2 ] * Ei [ 2 ] + gJ [ 3 ] * Ei [ 3 ] ; if ( Ek < 0.0 ) { Ei *= - 1.0 ; Ek = - Ek ; } if ( abs ( Ek ) >= 1.0 ) return gJ ; float El = acos ( Ek ) ; float Em = sqrt ( 1.0 - Ek * Ek ) ; if ( abs ( Em ) < 0.001 ) return vec4 ( gJ * 0.5 + Ei * 0.5 ) ; float En = sin ( ( 1.0 - Ej ) * El ) / Em ; float Eo = sin ( Ej * El ) / Em ; return gJ * En + Ei * Eo ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ED ( in vec3 O , in vec4 Eq , in vec4 Er , in vec4 Es , in vec4 Et , in float Eu ) { vec3 Ev = p_ ( u_arm_rel_trans , u_arm_rel_quat , O ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKIN_SLERP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 gJ = Ep ( Eq , Er , Eu ) ; vec4 Ew = mix ( Es , Et , Eu ) ; vec3 Ex = P ( gJ , Ev ) ; vec3 Ey = Ex * Ew . w + Ew . xyz ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Ez = P ( Eq , Ev ) ; vec3 EA = P ( Er , Ev ) ; vec3 EB = Ez * Es . w + Es . xyz ; vec3 EC = EA * Et . w + Et . xyz ; vec3 Ey = mix ( EB , EC , Eu ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"return qc ( u_arm_rel_trans , u_arm_rel_quat , Ey ) ; } vec3 EJ ( in vec3 EE , in vec4 Eq , in vec4 Er , in float Eu ) { vec3 EF = qb ( u_arm_rel_trans , u_arm_rel_quat , EE ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["SKIN_SLERP"],GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"vec4 gJ = Ep ( Eq , Er , Eu ) ; vec3 EG = P ( gJ , EF ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 EH = P ( Eq , EF ) ; vec3 EI = P ( Er , EF ) ; vec3 EG = mix ( EH , EI , Eu ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"return qd ( u_arm_rel_trans , u_arm_rel_quat , EG ) ; }".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 ED ( in vec3 O , in vec4 Eq , in vec4 Es ) { vec3 Ev = p_ ( u_arm_rel_trans , u_arm_rel_quat , O ) ; vec3 Ex = P ( Eq , Ev ) ; vec3 Ey = Ex * Es . w + Es . xyz ; return qc ( u_arm_rel_trans , u_arm_rel_quat , Ey ) ; } vec3 EJ ( in vec3 EE , in vec4 Eq ) { vec3 EF = qb ( u_arm_rel_trans , u_arm_rel_quat , EE ) ; vec3 EG = P ( Eq , EF ) ; return qd ( u_arm_rel_trans , u_arm_rel_quat , EG ) ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"void ac ( inout vec3 O , inout vec3 R , inout vec3 S , inout vec3 Q ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","EK","=","u_frame_factor",";"]}]}}]},{TYPE:"txt",TOKENS:"if ( a_influence . y > 0.0 ) { vec3 iV = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 EL = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 EM = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 EN = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 EO = a_influence ; for ( int bU = 0 ; bU < 4 ; bU ++ ) { int EP = int ( EO [ bU ] ) ; float EQ = fract ( EO [ bU ] ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EL += EQ * EJ ( R , u_quatsb [ EP ] , u_quatsa [ EP ] , EK ) ; EM += EQ * EJ ( S , u_quatsb [ EP ] , u_quatsa [ EP ] , EK ) ; EN += EQ * EJ ( Q , u_quatsb [ EP ] , u_quatsa [ EP ] , EK ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"iV += EQ * ED ( O , u_quatsb [ EP ] , u_transb [ EP ] ) ; EN += EQ * EJ ( Q , u_quatsb [ EP ] ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["DISABLE_TANGENT_SKINNING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EL += EQ * EJ ( R , u_quatsb [ EP ] ) ; EM += EQ * EJ ( S , u_quatsb [ EP ] ) ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"int EP = int ( EO [ 0 ] ) ; float EQ = fract ( EO [ 0 ] ) ; iV += EQ * ED ( O , u_quatsb [ EP ] , u_quatsa [ EP ] , u_transb [ EP ] , u_transa [ EP ] , EK ) ; EP = int ( EO [ 1 ] ) ; EQ = fract ( EO [ 1 ] ) ; iV += EQ * ED ( O , u_quatsb [ EP ] , u_quatsa [ EP ] , u_transb [ EP ] , u_transa [ EP ] , EK ) ; EP = int ( EO [ 2 ] ) ; EQ = fract ( EO [ 2 ] ) ; iV += EQ * ED ( O , u_quatsb [ EP ] , u_quatsa [ EP ] , u_transb [ EP ] , u_transa [ EP ] , EK ) ; EP = int ( EO [ 3 ] ) ; EQ = fract ( EO [ 3 ] ) ; iV += EQ * ED ( O , u_quatsb [ EP ] , u_quatsa [ EP ] , u_transb [ EP ] , u_transa [ EP ] , EK ) ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"O = iV ; Q = EN ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_TANGENT_SKINNING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"R = EL ; S = EM ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"} if ( ! ( a_influence . y > 0.0 ) ) { int ER = int ( a_influence [ 0 ] - 1.0 ) ; if ( ER > - 1 ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["FRAMES_BLENDING"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = ED ( O , u_quatsb [ ER ] , u_quatsa [ ER ] , u_transb [ ER ] , u_transa [ ER ] , EK ) ; R = EJ ( R , u_quatsb [ ER ] , u_quatsa [ ER ] , EK ) ; S = EJ ( S , u_quatsb [ ER ] , u_quatsa [ ER ] , EK ) ; Q = EJ ( Q , u_quatsb [ ER ] , u_quatsa [ ER ] , EK ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = ED ( O , u_quatsb [ ER ] , u_transb [ ER ] ) ; Q = EJ ( Q , u_quatsb [ ER ] ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DISABLE_TANGENT_SKINNING",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"R = EJ ( R , u_quatsb [ ER ] ) ; S = EJ ( S , u_quatsb [ ER ] ) ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:["}","}","}"]}]}}]}]}}]}]};a["include/sky_blending.glslf"]={TYPE:"grp",PARTS:[{TYPE:"cond",
PARTS:[{TYPE:"ifndef",NAME:"SKY_BLENDING_GLSLF",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"SKY_BLENDING_GLSLF",TOKENS:[""]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"include",FILE:"blending.glslf"},{TYPE:"var",NAME:"WO_SKYREAL",TOKENS:["0"]},{TYPE:"var",NAME:"WO_SKYBLEND",TOKENS:["0"]},{TYPE:"var",NAME:"BLENDTYPE",TOKENS:["MIX"]},{TYPE:"var",NAME:"MTEX_RGBTOINT",TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_HORIZ",TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_ZENUP",TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_ZENDOWN",
TOKENS:["0"]},{TYPE:"var",NAME:"WOMAP_BLEND",TOKENS:["0"]},{TYPE:"var",NAME:"MTEX_NEGATIVE",TOKENS:["0"]},{TYPE:"txt",TOKENS:"vec3 ES ( vec3 jC , vec3 jD , float aF , float kb ) { float jE = aF * kb ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLENDTYPE","MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jF ( jD , jC , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","ADD",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"return jG ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SUBTRACT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jH ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","MULTIPLY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jJ ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SCREEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"return jK ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","OVERLAY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jL ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIFFERENCE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jM ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIVIDE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"return jN ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DARKEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jO ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","LIGHTEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jP ( jC , jD , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","HUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jT ( jD , jC , jE ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["BLENDTYPE","SATURATION",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jU ( jD , jC , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","VALUE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jV ( jD , jC , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","COLOR",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jW ( jD , jC , jE ) ;".split(" ")}]}},{TYPE:"elif",
EXPRESSION:["BLENDTYPE","SOFT_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jY ( jD , jC , jE ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","LINEAR_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jZ ( jD , jC , jE ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float ET ( float j_ , float ka , float aF , float kb ) { vec3 jC = vec3 ( j_ ) , jD = vec3 ( ka ) ; float jE = aF * kb ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BLENDTYPE","MIX",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jF ( jD , jC , jE ) . x ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","ADD",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jG ( jC , jD , jE ) . x ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SUBTRACT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jH ( jC , jD , jE ) . x ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["BLENDTYPE","MULTIPLY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return kc ( j_ , ka , jE , kb ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SCREEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return kd ( j_ , ka , jE , kb ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","OVERLAY",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return ke ( j_ , ka , jE , kb ) ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIFFERENCE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jM ( jC , jD , jE ) . x ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DIVIDE",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jN ( jC , jD , jE ) . x ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","DARKEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jO ( jC , jD , jE ) . x ;".split(" ")}]}},
{TYPE:"elif",EXPRESSION:["BLENDTYPE","LIGHTEN",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jP ( jC , jD , jE ) . x ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","SOFT_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jY ( jD , jC , jE ) . x ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BLENDTYPE","LINEAR_LIGHT",{TYPE:"equal_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"return jZ ( jD , jC , jE ) . x ;".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"return 0.0 ; } vec3 dR ( vec3 dN , vec3 dO , vec4 dQ , float dM , vec3 dP ) { float EU = 1.0 ; EU = dQ . a ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_RGBTOINT"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EU = fu ( dQ ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_NEGATIVE"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_RGBTOINT",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"dQ = vec4 ( vec3 ( 1.0 ) - dQ . rgb , dQ . a ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EU = 1.0 - EU ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",{TYPE:"logical_or_expr",PLACES:3}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MTEX_RGBTOINT"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dQ = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",
PARTS:[{TYPE:"txt",TOKENS:"EU = dQ . a ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_HORIZ"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"dN = ES ( dQ . rgb , dN , EU , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENUP","WOMAP_ZENDOWN",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["float","EV","=","0.0",";"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYREAL"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"if ( dot ( dP , vec3 ( 0.0 , 0.0 , 1.0 ) ) >= 0.0 ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENUP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EV = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:[";"]}]}}]},{TYPE:"txt",TOKENS:["}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENDOWN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"else EV = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",
PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_ZENUP"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EV = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["WOMAP_ZENDOWN"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EV = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{TYPE:"txt",TOKENS:"if ( EV != 0.0 ) dO = ES ( dQ . rgb , dO , EU , EV ) ;".split(" ")}]}}]}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WOMAP_BLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["MTEX_RGBTOINT",{TYPE:"logic_negative_expr",PLACES:1}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"EU = dot ( dQ . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"dM = ET ( u_sky_tex_dvar , dM , EU , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WO_SKYBLEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 dL = mix ( dN , dO , dM ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:["vec3",
"dL","=","dN",";"]}]}}]},{TYPE:"txt",TOKENS:["return","dL",";","}"]}]}}]}]};a["include/std.glsl"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"STD_ENUMS_GLSL",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"STD_ENUMS_GLSL",TOKENS:[""]},{TYPE:"var",NAME:"CONSTANTS_HACK",TOKENS:["0"]},{TYPE:"define",NAME:"TEXTURE_COORDS_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"TEXTURE_COORDS_UV_ORCO",TOKENS:["1"]},{TYPE:"define",NAME:"TEXTURE_COORDS_NORMAL",TOKENS:["2"]},{TYPE:"define",NAME:"TEXTURE_BLEND_TYPE_MIX",
TOKENS:["1"]},{TYPE:"define",NAME:"TEXTURE_BLEND_TYPE_MULTIPLY",TOKENS:["2"]},{TYPE:"define",NAME:"SHADOW_SRC_NONE",TOKENS:["1"]},{TYPE:"define",NAME:"SHADOW_SRC_DEPTH",TOKENS:["2"]},{TYPE:"define",NAME:"SHADOW_SRC_MASK",TOKENS:["3"]},{TYPE:"define",NAME:"SHADOW_DST_NONE",TOKENS:["1"]},{TYPE:"define",NAME:"SHADOW_DST_DEPTH",TOKENS:["2"]},{TYPE:"define",NAME:"SHADOW_DST_MASK",TOKENS:["3"]},{TYPE:"define",NAME:"NO_SHADOWS",TOKENS:["1"]},{TYPE:"define",NAME:"SHADOW_CASTING",TOKENS:["2"]},{TYPE:"define",
NAME:"SHADOW_MASK_GENERATION",TOKENS:["3"]},{TYPE:"define",NAME:"SHADOW_MAPPING_OPAQUE",TOKENS:["4"]},{TYPE:"define",NAME:"SHADOW_MAPPING_BLEND",TOKENS:["5"]},{TYPE:"define",NAME:"POISSON_X_16",TOKENS:["4"]},{TYPE:"define",NAME:"POISSON_X_8",TOKENS:["2"]},{TYPE:"define",NAME:"POISSON_X_4",TOKENS:["1"]},{TYPE:"define",NAME:"NO_SOFT_SHADOWS",TOKENS:["0"]},{TYPE:"define",NAME:"SPECULAR_PHONG",TOKENS:["1"]},{TYPE:"define",NAME:"SPECULAR_COOKTORR",TOKENS:["2"]},{TYPE:"define",NAME:"SPECULAR_WARDISO",TOKENS:["3"]},
{TYPE:"define",NAME:"SPECULAR_BLINN",TOKENS:["4"]},{TYPE:"define",NAME:"SPECULAR_TOON",TOKENS:["5"]},{TYPE:"define",NAME:"DIFFUSE_LAMBERT",TOKENS:["1"]},{TYPE:"define",NAME:"DIFFUSE_OREN_NAYAR",TOKENS:["2"]},{TYPE:"define",NAME:"DIFFUSE_FRESNEL",TOKENS:["3"]},{TYPE:"define",NAME:"DIFFUSE_MINNAERT",TOKENS:["4"]},{TYPE:"define",NAME:"DIFFUSE_TOON",TOKENS:["5"]},{TYPE:"define",NAME:"MIX",TOKENS:["0"]},{TYPE:"define",NAME:"ADD",TOKENS:["1"]},{TYPE:"define",NAME:"SUBTRACT",TOKENS:["2"]},{TYPE:"define",
NAME:"MULTIPLY",TOKENS:["3"]},{TYPE:"define",NAME:"SCREEN",TOKENS:["4"]},{TYPE:"define",NAME:"OVERLAY",TOKENS:["5"]},{TYPE:"define",NAME:"DIFFERENCE",TOKENS:["6"]},{TYPE:"define",NAME:"DIVIDE",TOKENS:["7"]},{TYPE:"define",NAME:"DARKEN",TOKENS:["8"]},{TYPE:"define",NAME:"LIGHTEN",TOKENS:["9"]},{TYPE:"define",NAME:"HUE",TOKENS:["10"]},{TYPE:"define",NAME:"SATURATION",TOKENS:["11"]},{TYPE:"define",NAME:"VALUE",TOKENS:["12"]},{TYPE:"define",NAME:"COLOR",TOKENS:["13"]},{TYPE:"define",NAME:"SOFT_LIGHT",
TOKENS:["14"]},{TYPE:"define",NAME:"LINEAR_LIGHT",TOKENS:["15"]},{TYPE:"define",NAME:"REFL_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"REFL_MIRRORMAP",TOKENS:["1"]},{TYPE:"define",NAME:"REFL_PLANE",TOKENS:["2"]},{TYPE:"define",NAME:"REFL_CUBE",TOKENS:["3"]},{TYPE:"define",NAME:"INVERSE_QUADRATIC",TOKENS:["0"]},{TYPE:"define",NAME:"LINEAR",TOKENS:["1"]},{TYPE:"define",NAME:"QUADRATIC",TOKENS:["2"]},{TYPE:"define",NAME:"HEMI",TOKENS:["1"]},{TYPE:"define",NAME:"SPOT",TOKENS:["2"]},{TYPE:"define",NAME:"POINT",
TOKENS:["3"]},{TYPE:"define",NAME:"SUN",TOKENS:["4"]},{TYPE:"define",NAME:"DOF_SIMPLE",TOKENS:["0"]},{TYPE:"define",NAME:"DOF_BOKEH",TOKENS:["1"]},{TYPE:"define",NAME:"COC_ALL",TOKENS:["0"]},{TYPE:"define",NAME:"COC_FOREGROUND",TOKENS:["1"]},{TYPE:"define",NAME:"COC_COMBINE",TOKENS:["2"]},{TYPE:"define",NAME:"VT_WORLD_TO_WORLD",TOKENS:["0"]},{TYPE:"define",NAME:"VT_WORLD_TO_OBJECT",TOKENS:["1"]},{TYPE:"define",NAME:"VT_WORLD_TO_CAMERA",TOKENS:["2"]},{TYPE:"define",NAME:"VT_OBJECT_TO_WORLD",TOKENS:["3"]},
{TYPE:"define",NAME:"VT_OBJECT_TO_OBJECT",TOKENS:["4"]},{TYPE:"define",NAME:"VT_OBJECT_TO_CAMERA",TOKENS:["5"]},{TYPE:"define",NAME:"VT_CAMERA_TO_WORLD",TOKENS:["6"]},{TYPE:"define",NAME:"VT_CAMERA_TO_OBJECT",TOKENS:["7"]},{TYPE:"define",NAME:"VT_CAMERA_TO_CAMERA",TOKENS:["8"]},{TYPE:"define",NAME:"VT_POINT",TOKENS:["0"]},{TYPE:"define",NAME:"VT_VECTOR",TOKENS:["1"]},{TYPE:"define",NAME:"VT_NORMAL",TOKENS:["2"]},{TYPE:"define",NAME:"NM_TANGENT",TOKENS:["0"]},{TYPE:"define",NAME:"NM_OBJECT",TOKENS:["1"]},
{TYPE:"define",NAME:"NM_WORLD",TOKENS:["2"]},{TYPE:"define",NAME:"NM_BLENDER_OBJECT",TOKENS:["3"]},{TYPE:"define",NAME:"NM_BLENDER_WORLD",TOKENS:["4"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_VIEW",TOKENS:["1"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_XY",TOKENS:["2"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_YZ",TOKENS:["3"]},{TYPE:"define",NAME:"BILLBOARD_ALIGN_ZX",TOKENS:["4"]},{TYPE:"define",NAME:"POST_EFFECT_NONE",TOKENS:["1"]},{TYPE:"define",NAME:"POST_EFFECT_GRAYSCALE",TOKENS:["2"]},{TYPE:"define",NAME:"POST_EFFECT_BLUR",
TOKENS:["3"]},{TYPE:"define",NAME:"POST_EFFECT_GLOW_BLUR",TOKENS:["4"]},{TYPE:"define",NAME:"POST_EFFECT_DOF_BLUR",TOKENS:["5"]},{TYPE:"define",NAME:"POST_EFFECT_ALPHA_BLUR",TOKENS:["6"]},{TYPE:"define",NAME:"POST_EFFECT_EXTEND",TOKENS:["7"]},{TYPE:"define",NAME:"FLIP_CUBEMAP_COORDS",TOKENS:["8"]},{TYPE:"define",NAME:"DV_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"DV_OPAQUE_WIREFRAME",TOKENS:["1"]},{TYPE:"define",NAME:"DV_TRANSPARENT_WIREFRAME",TOKENS:["2"]},{TYPE:"define",NAME:"DV_FRONT_BACK_VIEW",
TOKENS:["3"]},{TYPE:"define",NAME:"DV_BOUNDINGS",TOKENS:["4"]},{TYPE:"define",NAME:"DV_CLUSTERS_VIEW",TOKENS:["5"]},{TYPE:"define",NAME:"DV_BATCHES_VIEW",TOKENS:["6"]},{TYPE:"define",NAME:"DV_RENDER_TIME",TOKENS:["7"]},{TYPE:"define",NAME:"SSAO_QUALITY_8",TOKENS:["1"]},{TYPE:"define",NAME:"SSAO_QUALITY_16",TOKENS:["2"]},{TYPE:"define",NAME:"SSAO_QUALITY_24",TOKENS:["3"]},{TYPE:"define",NAME:"SSAO_QUALITY_32",TOKENS:["4"]},{TYPE:"define",NAME:"AA_METHOD_FXAA_LIGHT",TOKENS:["1"]},{TYPE:"define",NAME:"AA_METHOD_FXAA_QUALITY",
TOKENS:["2"]},{TYPE:"define",NAME:"AA_QUALITY_LOW",TOKENS:["0"]},{TYPE:"define",NAME:"AA_QUALITY_MEDIUM",TOKENS:["1"]},{TYPE:"define",NAME:"AA_QUALITY_HIGH",TOKENS:["2"]},{TYPE:"define",NAME:"SMAA_RESOLVE",TOKENS:["1"]},{TYPE:"define",NAME:"SMAA_EDGE_DETECTION",TOKENS:["2"]},{TYPE:"define",NAME:"SMAA_BLENDING_WEIGHT_CALCULATION",TOKENS:["3"]},{TYPE:"define",NAME:"SMAA_NEIGHBORHOOD_BLENDING",TOKENS:["4"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_LOW",TOKENS:["1"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_MEDIUM",
TOKENS:["2"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_HIGH",TOKENS:["3"]},{TYPE:"define",NAME:"AA_METHOD_SMAA_ULTRA",TOKENS:["4"]},{TYPE:"define",NAME:"REFL_PASS_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"REFL_PASS_PLANE",TOKENS:["1"]},{TYPE:"define",NAME:"REFL_PASS_CUBE",TOKENS:["2"]},{TYPE:"define",NAME:"SRGB_NONE",TOKENS:["0"]},{TYPE:"define",NAME:"SRGB_SIMPLE",TOKENS:["1"]},{TYPE:"define",NAME:"SRGB_PROPER",TOKENS:["2"]},{TYPE:"define",NAME:"M_PI",TOKENS:["3.14159265359"]},{TYPE:"define",NAME:"M_PI_4",
TOKENS:["0.785398163"]},{TYPE:"define",NAME:"INV_PI",TOKENS:["0.318309886"]},{TYPE:"define",NAME:"UP_VECTOR",TOKENS:"vec3 ( 0.0 , 0.0 , 1.0 )".split(" ")},{TYPE:"define",NAME:"RIGHT_VECTOR",TOKENS:"vec3 ( 1.0 , 0.0 , 0.0 )".split(" ")},{TYPE:"define",NAME:"TOWARD_VECTOR",TOKENS:"vec3 ( 0.0 , - 1.0 , 0.0 )".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["CONSTANTS_HACK"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"float _0_0 = 0.0 ; float _0_5 = 0.5 ; float _1_0 = 1.0 ; float _255_0 = 255.0 ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"_0_0",TOKENS:["0.0"]},{TYPE:"define",NAME:"_0_5",TOKENS:["0.5"]},{TYPE:"define",NAME:"_1_0",TOKENS:["1.0"]},{TYPE:"define",NAME:"_255_0",TOKENS:["255.0"]}]}}]}]}}]}]};a["include/to_world.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"TO_WORLD_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"TO_WORLD_GLSLV",TOKENS:[""]},{TYPE:"include",FILE:"math.glslv"},{TYPE:"var",NAME:"BILLBOARD_ALIGN",TOKENS:["BILLBOARD_ALIGN_VIEW"]},
{TYPE:"var",NAME:"USE_INSTANCED_PARTCLS",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_SPHERICAL",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_RANDOM",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_JITTERED",TOKENS:["0"]},{TYPE:"var",NAME:"BILLBOARD_PRES_GLOB_ORIENTATION",TOKENS:["0"]},{TYPE:"var",NAME:"STATIC_BATCH",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"define",NAME:"MAX_BILLBOARD_ANGLE",TOKENS:["M_PI_4"]},{TYPE:"cond",PARTS:[{TYPE:"if",
EXPRESSION:["BILLBOARD_SPHERICAL","BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 bc ( vec3 EW , mat3 N ) { vec4 EX = vec4 ( N [ 1 ] [ 1 ] , N [ 1 ] [ 2 ] , N [ 2 ] [ 0 ] , N [ 2 ] [ 1 ] ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2}],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 EY = cM ( RIGHT_VECTOR , - M_PI / 2.0 ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 EY = cM ( RIGHT_VECTOR , M_PI / 2.0 ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"EX = pT ( EY , EX ) ; EX = kk ( EX ) ; mat3 bd = cK ( ) ; bd [ 0 ] = EW ; bd = cO ( EX , bd ) ; return bd ; }".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 E_ ( vec3 kM , vec3 EW ) { vec3 EZ = kM - EW ; EZ . z = 0.0 ; EZ = normalize ( EZ ) ; vec4 EX = pY ( EZ , TOWARD_VECTOR ) ; mat3 bd = cK ( ) ; bd [ 0 ] = EW ; bd = cO ( EX , bd ) ; return bd ; }".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_JITTERED"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 aj ( in vec3 Fa , float Fb , float Fc , float Fd , vec3 aU , mat3 T ) { float Fe = fract ( length ( aU ) / 0.17 ) ; float Ff = Fd + Fe / 10.0 ; float Fg = Fe ; if ( Fd != 0.0 ) Fg /= Fd ; Fa *= 1.0 + 0.5 * sin ( Fb ) ; float Fh = length ( Fa ) * Fc * sin ( 2.0 * 3.14 * Fb * Ff + Fg ) ; vec4 Fi = cM ( TOWARD_VECTOR , Fh ) ; vec4 Fj = vec4 ( T [ 1 ] [ 1 ] , T [ 1 ] [ 2 ] , T [ 2 ] [ 0 ] , T [ 2 ] [ 1 ] ) ; Fj = pT ( Fj , Fi ) ; T = cO ( Fj , T ) ; return T ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"mat3 ai ( in vec3 kM , in vec3 af , in mat3 N ) {".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_SPHERICAL","BILLBOARD",{TYPE:"logic_negative_expr",PLACES:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{TYPE:"equal_expr",PLACES:2},{TYPE:"logical_and_expr",PLACES:2},{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 la = bc ( af , N ) ;".split(" ")}]}},{TYPE:"elif",EXPRESSION:["BILLBOARD_RANDOM"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",
TOKENS:"float Fe = fract ( ( af . x * 1.43 - af . z * 0.123 + af . y * 6.1 ) ) ; float Fk = 2.0 * M_PI * Fe ; vec4 Fl = vec4 ( N [ 1 ] [ 1 ] , N [ 1 ] [ 2 ] , N [ 2 ] [ 0 ] , N [ 2 ] [ 1 ] ) ; float Fm = asin ( 2.0 * ( Fl . x * Fl . y - Fl . z * Fl . w ) ) ; float g_ = Fm - Fk ; if ( g_ < 0.0 ) g_ = 2.0 * M_PI + g_ ; float Fn = Fk ; if ( g_ <= MAX_BILLBOARD_ANGLE ) Fn += g_ ; else if ( g_ <= M_PI - MAX_BILLBOARD_ANGLE ) Fn += MAX_BILLBOARD_ANGLE * ( 2.0 * g_ - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( g_ <= M_PI + MAX_BILLBOARD_ANGLE ) Fn += g_ - M_PI ; else if ( g_ <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) Fn += MAX_BILLBOARD_ANGLE * ( 2.0 * g_ - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else Fn += g_ - 2.0 * M_PI ; vec4 Fo = cM ( UP_VECTOR , Fn ) ; mat3 la ; la [ 0 ] = af ; la [ 1 ] [ 0 ] = 1.0 ; la = cO ( Fo , la ) ;".split(" ")}]}},
{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 la = E_ ( kM , af ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["return","la",";","}"]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{TYPE:"logic_negative_expr",PLACES:1},{TYPE:"logical_and_expr",PLACES:2},"USE_INSTANCED_PARTCLS",{TYPE:"logical_or_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"mat3 ah ( in vec3 kM , in vec3 af , in mat3 N , in mat3 T ) { mat3 la = ai ( kM , af , N ) ; T [ 0 ] = vec3 ( 0.0 , 0.0 , 0.0 ) ; la = aS ( la , T ) ; return la ; }".split(" ")}]}}]},
{TYPE:"txt",TOKENS:"ak al ( in vec3 eH , in vec3 Fp , in vec3 Fq , in vec3 Fr , in vec3 Fs , in vec3 Ft , in mat3 T ) { eH = ae ( T , eH ) ; Fp = ae ( T , Fp ) ; Fq = U ( T , Fq ) ; Fr = U ( T , Fr ) ; Fs = U ( T , Fs ) ; Ft = U ( T , Ft ) ; return lb ( ak ( eH , Fp , Fq , Fr , Fs , Ft , vec3 ( 0.0 ) ) ) ; }".split(" ")}]}}]}]};a["include/wind_bending.glslv"]={TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"ifndef",NAME:"WIND_BENDING_GLSLV",GROUP:{TYPE:"grp",PARTS:[{TYPE:"define",NAME:"WIND_BENDING_GLSLV",
TOKENS:[""]},{TYPE:"var",NAME:"WIND_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"MAIN_BEND_COL",TOKENS:["0"]},{TYPE:"var",NAME:"DETAIL_BEND",TOKENS:["0"]},{TYPE:"var",NAME:"BEND_CENTER_ONLY",TOKENS:["0"]},{TYPE:"var",NAME:"REFLECTION_PASS",TOKENS:["REFL_PASS_NONE"]},{TYPE:"var",NAME:"BILLBOARD",TOKENS:["0"]},{TYPE:"include",FILE:"std.glsl"},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["WIND_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"void FG ( inout vec3 bi , in vec3 Fu , in float Fv , in float Fw , in float eO , in vec3 Fa , in float Fx , in mat4 bB ) {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Fy = ( bB * vec4 ( bi , 1.0 ) ) . xyz ; vec3 Fz = ( bB * vec4 ( Fu , 1.0 ) ) . xyz ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Fy = bi ; vec3 Fz = Fu ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float dk = length ( Fz ) ; float FA = Fw * ( 1.0 + 0.1 * fract ( dk ) ) ; float FB = Fv * Fx * ( 1.0 + sin ( 2.0 * 3.14 * eO * FA + dk ) ) ; float FC = ( Fy . z - Fz . z ) * abs ( FB ) ; FC += 1.0 ; FC *= FC ; FC = FC * FC - FC ; vec3 FD = Fy ; FD . xy += Fa . xy * FC * sign ( FB ) ; vec3 FE = FD - Fz ; if ( all ( equal ( FE , vec3 ( 0.0 ) ) ) ) bi = Fu ; else {".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"FE = ( bB * vec4 ( FE , 0.0 ) ) . xyz ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"float FF = length ( Fy - Fz ) ; bi = Fu + normalize ( FE ) * FF ; } }".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec4 FH ( vec4 x ) { return x * x * ( 3.0 - 2.0 * x ) ; } vec4 FI ( vec4 x ) { return abs ( fract ( x + 0.5 ) * 2.0 - 1.0 ) ; } vec4 FJ ( vec4 x ) { return FH ( FI ( x ) ) ; } void FV ( inout vec3 bi , in float eO , in vec3 Q , in vec3 Fa , in vec3 Fu , in float FK , in float FL , in float FM , in vec3 FN , in mat4 bB ) { float FO ; float FP ; float FQ ; vec2 FR ; vec4 FS ; vec2 FT ; vec3 FU ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Fy = ( bB * vec4 ( bi , 1.0 ) ) . xyz ; vec3 Fz = ( bB * vec4 ( Fu , 1.0 ) ) . xyz ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 Fy = bi ; vec3 Fz = Fu ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"FO = dot ( Fz , vec3 ( 1.0 ) ) ; FP = FO + FN . g ; FQ = dot ( Fy , vec3 ( FN . g ) ) ; FR = ( eO + vec2 ( FQ , FP ) ) ; FS = ( ( fract ( ( FR . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( Fa ) * FK ; FS = FJ ( FS ) ; FT = FS . xz + FS . yw ; FT . y = 0.5 - FT . y ; FU = FT . xxy * FN . rrb * vec3 ( FL * Q . x , FL * Q . y , FM ) ;".split(" ")},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"FU = ( bB * vec4 ( FU , 0.0 ) ) . xyz ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["bi","+=","FU",";","}"]}]}}]},{TYPE:"txt",TOKENS:"void an ( inout vec3 O , inout vec3 ad , in vec3 Q , in mat4 bB ) { vec3 FW = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 FX = ad ; vec3 FY = a_emitter_center ;".split(" ")},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["REFLECTION_PASS","REFL_PASS_PLANE",{TYPE:"equal_expr",PLACES:2},"BILLBOARD",{TYPE:"logical_and_expr",PLACES:2}],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"FY = ( bB * vec4 ( FY , 1.0 ) ) . xyz ;".split(" ")}]}}]}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"vec3 FX = O ; vec3 FY = ad ;".split(" ")}]}}]},{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["MAIN_BEND_COL"],
GROUP:{TYPE:"grp",PARTS:[{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["DETAIL_BEND"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"FV ( FX , u_time , Q , FW , FY , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail , bB ) ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:"FG ( FX , FY , au_wind_bending_amp , au_wind_bending_freq , u_time , FW , a_bending_col_main , bB ) ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"FG ( FX , FY , au_wind_bending_amp , au_wind_bending_freq , u_time , FW , 1.0 , bB ) ;".split(" ")}]}}]},
{TYPE:"cond",PARTS:[{TYPE:"if",EXPRESSION:["BEND_CENTER_ONLY"],GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O += FX - ad ; ad = FX ;".split(" ")}]}},{TYPE:"else",GROUP:{TYPE:"grp",PARTS:[{TYPE:"txt",TOKENS:"O = FX ; ad = FY ;".split(" ")}]}}]},{TYPE:"txt",TOKENS:["}"]}]}}]}]}}]}]}};b4w.module.animation=function(a,r){var u=r("__animation"),h=r("__armature"),b=r("__obj_util"),f=r("__print"),l=r("__tsr");a.SLOT_0=u.SLOT_0;a.SLOT_1=u.SLOT_1;a.SLOT_2=u.SLOT_2;a.SLOT_3=u.SLOT_3;a.SLOT_4=u.SLOT_4;a.SLOT_5=u.SLOT_5;a.SLOT_6=u.SLOT_6;a.SLOT_7=u.SLOT_7;a.SLOT_ALL=u.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=u.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=u.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=u.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=u.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=u.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=u.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=u.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=u.AB_CYCLIC;a.AB_FINISH_RESET=u.AB_FINISH_RESET;a.AB_FINISH_STOP=u.AB_FINISH_STOP;var q=l.create();a.is_animated=function(a){return u.is_animated(a)};a.get_anim_names=function(a){return u.obj_is_animatable(a)?u.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!u.is_animated(a))return null;b=b||u.SLOT_0;return u.get_anim_by_slot_num(a,b)};a.apply=function(a,b,h){if(h>u.SLOT_7)f.error("Can't apply animation to slot "+
h+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{h=h||u.SLOT_0;if(u.is_animated(a)){var l=u.get_slot_num_by_anim(a,b);if(-1!=l&&l!=h){f.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+l+'").');return}}u.validate_action_by_name(a,b)?u.apply(a,null,b,h):f.error('No fcurves in action "'+b+'"')}};a.apply_ext=function(a,b,h){if(h>u.SLOT_7)f.error("Can't apply animation to slot "+h+' for object "'+a.name+'". Object can have maximum of 8 animation slots');
else{h=h||u.SLOT_0;var l=b[0];if(u.is_animated(a)){var c=u.get_slot_num_by_anim(a,l);if(-1!=c&&c!=h){f.error('Animation "'+l+'" is already applied to object "'+a.name+'" (slot "'+c+'").');return}}u.validate_action_by_name(a,l)?(b=b.slice(1),u.apply(a,b,l,h)):f.error('No fcurves in action "'+l+'"')}};a.remove=function(a){u.remove(a)};a.remove_slot_animation=function(a,b){u.is_animated(a)&&(b=b||u.SLOT_0,u.remove_slot_animation(a,b))};a.apply_def=function(a){u.apply_def(a)};a.play=function(a,b,h){u.is_animated(a)?
(h=h||u.SLOT_0,u.play(a,b,h),u.update_object_animation(a,0,h,!0)):f.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){u.is_animated(a)&&(b=b||u.SLOT_0,u.stop(a,b))};a.is_play=function(a,b){if(!u.is_animated(a))return!1;b=b||u.SLOT_0;return u.is_play(a,b)};a.set_frame=function(a,b,f){u.is_animated(a)&&(f=f||u.SLOT_0,u.set_frame(a,b,f))};a.set_first_frame=function(a,b){u.is_animated(a)&&u.set_first_frame(a,b)};a.set_last_frame=function(a,b){if(u.is_animated(a)){b=b||u.SLOT_0;
var f=u.get_anim_start_frame(a,b),h=u.get_anim_length(a,b);u.set_frame(a,f+h-u.LAST_FRAME_EPSILON,b)}};a.get_frame=function(a,b){if(!u.is_animated(a))return 0;b=b||u.SLOT_0;return u.get_current_frame_float(a,b)};a.set_speed=function(a,b,f){u.is_animated(a)&&(f=f||u.SLOT_0,u.set_speed(a,b||1,f))};a.get_speed=function(a,b){if(!u.is_animated(a))return 0;b=b||u.SLOT_0;return a.anim_slots[b]?u.get_speed(a,b):0};a.get_anim_start_frame=function(a,b){return u.is_animated(a)&&(b=b||u.SLOT_0,a.anim_slots[b])?
u.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return u.is_animated(a)&&(b=b||u.SLOT_0,a.anim_slots[b])?u.get_anim_length(a,b):-1};a.set_behavior=function(a,b,f){u.is_animated(a)&&(f=f||u.SLOT_0,u.set_behavior(a,b,f))};a.get_behavior=function(a,b){if(!u.is_animated(a))return null;b=b||u.SLOT_0;return u.get_behavior(a,b)};a.apply_smoothing=function(a,b,f,h){h=h||u.SLOT_0;u.is_animated(a)&&u.apply_smoothing(a,b,f,h)};a.frame_to_sec=function(a){return u.frame_to_sec(a)};a.get_bone_translation=
function(a,l,p){f.error_deprecated("get_bone_translation","armature.get_bone_tsr");if(!b.is_armature(a))return null;if(!h.check_bone(a,l))return f.error('There is no bone: "',l,'" in "',a.name,'".'),null;p||(p=new Float32Array(3));h.get_bone_tsr(a,l,!1,!1,q);p[0]=q[0];p[1]=q[1];p[2]=q[2];return p};a.get_first_armature_object=function(a){f.error_once("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return u.is_animated(a)&&b?u.get_slot_num_by_anim(a,b):-1};
a.get_anim_type=function(a,b){return u.is_animated(a)?u.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return u.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.render.anim_mix_factor};a.set_skel_mix_factor=function(a,h,l){b.is_armature(a)?(h=Math.min(Math.max(h,0),1),a.render.anim_mix_factor!=h&&u.set_skel_mix_factor(a,h,l||0)):f.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,r){var u=r("__anchors");r("__print");a.attach_move_cb=u.attach_move_cb;a.detach_move_cb=u.detach_move_cb;a.is_anchor=u.is_anchor;a.get_element_id=u.get_element_id;a.update=function(){u.update(!0)}};b4w.module.armature=function(a,r){var u=r("__armature"),h=r("__obj_util"),b=r("__transform"),f=r("__print");a.get_bone_tsr=function(a,b,e){if(!h.is_armature(a))return null;if(!u.check_bone(a,b))return f.error('There is no bone: "',b,'" in "',a.name,'".'),null;e||(e=new Float32Array(8));u.get_bone_tsr(a,b,!1,!1,e);return e};a.get_bone_tsr_rel=function(a,b,e){if(!h.is_armature(a))return null;if(!u.check_bone(a,b))return f.error('There is no bone: "',b,'" in "',a.name,'".'),null;e||(e=new Float32Array(8));
u.get_bone_tsr(a,b,!1,!0,e);return e};a.set_bone_tsr=function(a,q,e){h.is_armature(a)&&(u.check_bone(a,q)?(u.set_bone_tsr(a,q,e,!1),b.update_transform(a)):f.error('There is no bone: "',q,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,q,e){h.is_armature(a)&&(u.check_bone(a,q)?(u.set_bone_tsr(a,q,e,!0),b.update_transform(a)):f.error('There is no bone: "',q,'" in "',a.name,'".'))}};b4w.module.assets=function(a,r){var u=r("__assets");a.AT_ARRAYBUFFER=u.AT_ARRAYBUFFER;a.AT_JSON=u.AT_JSON;a.AT_TEXT=u.AT_TEXT;a.AT_AUDIOBUFFER=u.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=u.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=u.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,f,l){if(a.length)if(a.id)u.enqueue(a,b,f,l);else{for(var q=[],e=0;e<a.length;e++){var n=a[e];q.push({id:n[0],type:n[1],url:n[2],request:n.request?n.request:"GET",post_type:null,post_data:null,param:n[3]})}u.enqueue(q,b,f,l)}}};b4w.module.camera=function(a,r){function u(a,b){p.error_deprecated("camera.set_pivot","camera.target_set_trans_pivot");h.is_target_camera(a)?(A.copy(b,a.render.pivot),c.update_transform(a),n.sync_transform(a)):p.error("set_pivot(): Wrong object or camera move style")}var h=r("__camera");r("__config");var b=r("__constraints"),f=r("__container"),l=r("__mat4"),q=r("__math"),e=r("__obj_util"),n=r("__physics"),p=r("__print"),B=r("__scenes"),c=r("__transform"),k=r("__tsr"),m=r("__util"),A=r("__vec3"),E=
r("__vec4"),w=new Float32Array(2),v=new Float32Array(3),z=new Float32Array(3),y=new Float32Array(4);new Float32Array(9);var D={},K={};a.MS_STATIC=h.MS_STATIC;a.MS_TARGET_CONTROLS=h.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=h.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=h.MS_HOVER_CONTROLS;a.static_setup=function(a,b){if(e.is_camera(a)){h.wipe_move_style(a);a.render.move_style=h.MS_STATIC;if(b){var f=b.pos||k.get_trans_view(a.render.world_tsr);b.look_at?h.set_look_at(a,f,b.look_at):c.set_translation(a,f)}c.update_transform(a);
n.sync_transform(a);h.init_ortho_props(a)}else p.error("static_setup(): Wrong camera object")};a.static_set_look_at=function(a,b,e){h.is_static_camera(a)?(b=b||k.get_trans_view(a.render.world_tsr),e?h.set_look_at(a,b,e):c.set_translation(a,b),c.update_transform(a),n.sync_transform(a)):p.error("static_set_look_at(): Wrong camera object or camera move style")};a.static_set_rotation=function(a,b){h.is_static_camera(a)?(c.set_rotation(a,b),c.update_transform(a),n.sync_transform(a)):p.error("static_set_rotation(): Wrong camera object or camera move style")};
a.static_get_rotation=function(a,b){if(!h.is_static_camera(a))return p.error("static_get_rotation(): Wrong camera object or camera move style"),null;b=b||new Float32Array(4);return c.get_rotation(a,b)};a.eye_setup=function(a,b){if(e.is_camera(a))if(b&&b.horiz_rot_lim&&("number"!=typeof b.horiz_rot_lim.left||"number"!=typeof b.horiz_rot_lim.right))p.error("eye_setup(): Wrong horizontal limits object.");else if(b&&b.vert_rot_lim&&("number"!=typeof b.vert_rot_lim.down||"number"!=typeof b.vert_rot_lim.up))p.error("eye_setup(): Wrong vertical limits object.");
else{h.wipe_move_style(a);a.render.move_style=h.MS_EYE_CONTROLS;if(b){var f=b.pos||k.get_trans_view(a.render.world_tsr);h.setup_eye_model(a,f,b.look_at,b.horiz_rot_lim,b.vert_rot_lim)}c.update_transform(a);n.sync_transform(a);h.init_ortho_props(a)}else p.error("eye_setup(): Wrong camera object")};a.eye_set_look_at=function(a,e,f){h.is_eye_camera(a)?(e=e||k.get_trans_view(a.render.world_tsr),f?h.set_look_at_corrected(a,e,f):c.set_translation(a,e),b.correct_up(a,a.render.vertical_axis,!0),c.update_transform(a),
n.sync_transform(a)):p.error("eye_set_look_at(): Wrong camera object or camera move style")};a.eye_rotate=function(a,b,e,f,k){h.is_eye_camera(a)?(h.rotate_eye_camera(a,b,e,f||!1,k||!1),c.update_transform(a),n.sync_transform(a)):p.error("eye_rotate(): Wrong camera object or camera move style")};a.eye_set_vertical_limits=function(a,b){h.is_eye_camera(a)?!b||"number"==typeof b.down&&"number"==typeof b.up?(h.set_vertical_rot_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("eye_set_vertical_limits(): Incorrect limits object."):
p.error("eye_set_vertical_limits(): Wrong camera object or camera move style")};a.eye_get_vertical_limits=function(a,b,c){if(!h.is_eye_camera(a))return p.error("eye_get_vertical_limits(): Wrong camera object or camera move style"),null;a=a.render;return a.vertical_limits?(b=b||{},c?(b.down=a.vertical_limits.down_local,b.up=a.vertical_limits.up_local):(b.down=a.vertical_limits.down,b.up=a.vertical_limits.up),b.camera_space=c||!1,b):null};a.eye_set_horizontal_limits=function(a,b){h.is_eye_camera(a)?
!b||"number"==typeof b.left&&"number"==typeof b.right?(h.set_horizontal_rot_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("eye_set_horizontal_limits(): Incorrect limits object."):p.error("eye_set_horizontal_limits(): Wrong camera object or camera move style")};a.eye_get_horizontal_limits=function(a,b,c){if(!h.is_eye_camera(a))return p.error("eye_get_horizontal_limits(): Wrong camera object or camera move style"),null;a=a.render;return a.horizontal_limits?(b=b||{},c?(b.left=a.horizontal_limits.left_local,
b.right=a.horizontal_limits.right_local):(b.left=a.horizontal_limits.left,b.right=a.horizontal_limits.right),b.camera_space=c||!1,b):null};a.target_setup=function(a,b){if(e.is_camera(a))if(!b.horiz_rot_lim||"number"==typeof b.horiz_rot_lim.left&&"number"==typeof b.horiz_rot_lim.right)if(!b.vert_rot_lim||"number"==typeof b.vert_rot_lim.down&&"number"==typeof b.vert_rot_lim.up){if(b.dist_lim){if("number"!=typeof b.dist_lim.min||"number"!=typeof b.dist_lim.max||b.dist_lim.min>b.dist_lim.max){p.error("target_setup(): Wrong distance limits object");
return}b.dist_lim.min=Math.max(b.dist_lim.min,0);b.dist_lim.max=Math.max(b.dist_lim.max,0)}if(b.pivot_lim&&("number"!=typeof b.pivot_lim.min_y||"number"!=typeof b.pivot_lim.max_y||b.pivot_lim.min_y>b.pivot_lim.max_y))p.error("target_setup(): Wrong pivot limits object");else{h.wipe_move_style(a);a.render.move_style=h.MS_TARGET_CONTROLS;var f=b.pos||k.get_trans_view(a.render.world_tsr);h.setup_target_model(a,f,b.pivot,b.horiz_rot_lim,b.vert_rot_lim,b.dist_lim,b.pivot_lim,b.use_panning||!1);c.update_transform(a);
n.sync_transform(a);h.init_ortho_props(a)}}else p.error("target_setup(): Wrong vertical limits object");else p.error("target_setup(): Wrong horizontal limits object");else p.error("target_setup(): Wrong camera object")};a.target_rotate=function(a,b,e,f,k){h.is_target_camera(a)?(h.rotate_target_camera(a,b,e,f||!1,k||!1),c.update_transform(a),n.sync_transform(a)):p.error("target_rotate(): Wrong camera object or camera move style")};a.target_set_trans_pivot=function(a,b,e){h.is_target_camera(a)?(b=b||
k.get_trans_view(a.render.world_tsr),e=e||a.render.pivot,h.set_trans_pivot(a,b,e),c.update_transform(a),n.sync_transform(a)):p.error("target_set_trans_pivot(): Wrong camera object or camera move style")};a.target_set_pivot_translation=function(a,b){h.is_target_camera(a)?(h.set_target_pivot(a,b),c.update_transform(a),n.sync_transform(a)):p.error("target_set_pivot_translation(): Wrong camera object or camera move style")};a.target_set_distance=function(a,b){if(h.is_target_camera(a)){var e=c.obj_point_distance(a,
a.render.pivot),f=Math.max(0,b);c.move_local(a,0,0,f-e);c.update_transform(a);n.sync_transform(a)}else p.error("target_set_distance(): Wrong camera object or camera move style")};a.target_get_distance=function(a){return h.is_target_camera(a)?c.obj_point_distance(a,a.render.pivot):(p.error("target_get_distance(): Wrong camera object or camera move style"),0)};a.target_zoom_object=function(a,b){if(h.is_target_camera(a)){var f=c.get_object_center(b,!1,v),m=c.get_object_size(b),l=B.get_active(),l=e.get_scene_data(a,
l).cameras[0],l=h.get_angular_diameter(l)/2,m=m/Math.sin(l),l=c.obj_point_distance(a,f);h.set_trans_pivot(a,k.get_trans_view(a.render.world_tsr),f);c.update_transform(a);c.move_local(a,0,0,m-l);c.update_transform(a);n.sync_transform(a)}else p.error("target_zoom_object(): Wrong camera object or camera move style")};a.target_get_pivot=function(a,b){if(!h.is_target_camera(a))return p.error("target_get_pivot(): Wrong camera object or camera move style"),null;b=b||new Float32Array(3);A.copy(a.render.pivot,
b);return b};a.target_set_distance_limits=function(a,b){if(h.is_target_camera(a)){if(b){if("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max){p.error("target_set_distance_limits(): Wrong limits object");return}b.min=Math.max(b.min,0);b.max=Math.max(b.max,0)}h.set_distance_limits(a,b);c.update_transform(a);n.sync_transform(a)}else p.error("target_set_distance_limits(): Wrong camera object or camera move style")};a.target_get_distance_limits=function(a,b){if(!h.is_target_camera(a))return p.error("target_get_distance_limits(): Wrong camera object or camera move style"),
null;var c=a.render;return c.distance_limits?(b=b||{},b.min=c.distance_limits.min,b.max=c.distance_limits.max,b):null};a.target_set_vertical_limits=function(a,b){h.is_target_camera(a)?!b||"number"==typeof b.down&&"number"==typeof b.up?(h.set_vertical_rot_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("target_set_vertical_limits(): Wrong limits object"):p.error("target_set_vertical_limits(): Wrong camera object or camera move style")};a.target_get_vertical_limits=function(a,b,c){if(!h.is_target_camera(a))return p.error("target_get_vertical_limits(): Wrong camera object or camera move style"),
null;a=a.render;return a.vertical_limits?(b=b||{},c?(b.down=a.vertical_limits.down_local,b.up=a.vertical_limits.up_local):(b.down=a.vertical_limits.down,b.up=a.vertical_limits.up),b.camera_space=c||!1,b):null};a.target_set_horizontal_limits=function(a,b){h.is_target_camera(a)?!b||"number"==typeof b.left&&"number"==typeof b.right?(h.set_horizontal_rot_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("target_set_horizontal_limits(): Wrong limits object"):p.error("target_set_horizontal_limits(): Wrong camera object or camera move style")};
a.target_get_horizontal_limits=function(a,b,c){if(!h.is_target_camera(a))return p.error("target_get_horizontal_limits(): Wrong camera object or camera move style"),null;a=a.render;return a.horizontal_limits?(b=b||{},c?(b.left=a.horizontal_limits.left_local,b.right=a.horizontal_limits.right_local):(b.left=a.horizontal_limits.left,b.right=a.horizontal_limits.right),b.camera_space=c||!1,b):null};a.target_set_pivot_limits=function(a,b){h.is_target_camera(a)?b&&("number"!=typeof b.min_z||"number"!=typeof b.max_z||
b.min_z>b.max_z)?p.error("target_set_pivot_limits(): Wrong limits object"):(h.set_pivot_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("target_set_pivot_limits(): Wrong camera object or camera move style")};a.target_get_pivot_limits=function(a,b){if(!h.is_target_camera(a))return p.error("target_get_pivot_limits(): Wrong camera object or camera move style"),null;var c=a.render;return c.pivot_limits?(b=b||{},b.min_z=c.pivot_limits.min_z,b.max_z=c.pivot_limits.max_z,b):null};a.target_pan_pivot=
function(a,b,e){if(h.is_target_camera(a)){var f=a.render;f.use_panning&&(v[0]=b,v[1]=-e,v[2]=0,k.transform_dir_vec3(v,f.world_tsr,v),A.add(f.pivot,v,f.pivot),b=k.get_trans_view(f.world_tsr),A.add(b,v,b),c.update_transform(a),n.sync_transform(a))}else p.error("target_pan_pivot(): wrong object")};a.target_switch_panning=function(a,b){if(!h.is_target_camera(a))return p.error("target_switch_panning(): Wrong camera object or camera move style"),null;a.render.use_panning=b};a.hover_setup_rel=function(b,
e){a.hover_setup(b,{pos:e.pos,pivot:e.pivot});var f="undefined"==typeof e.dist_interval?0:Math.max(e.dist_interval,0),k="undefined"==typeof e.angle_interval?0:Math.max(e.angle_interval,0),l="undefined"==typeof e.t?.5:m.clamp(e.t,0,1),g=a.hover_get_distance_limits(b,D);g.min=Math.max(g.min-l*f,0);g.max+=(1-l)*f;f=a.hover_get_vertical_limits(b,K);f.down=m.clamp(f.down+l*k,-Math.PI/2,0);f.up=m.clamp(f.up-(1-l)*k,-Math.PI/2,0);h.hover_set_distance_limits(b,g);h.hover_set_vertical_limits(b,f);c.update_transform(b);
n.sync_transform(b);h.init_ortho_props(b)};a.hover_setup=function(a,b){if(e.is_camera(a)){if(b.dist_lim){if("number"!=typeof b.dist_lim.min||"number"!=typeof b.dist_lim.max||b.dist_lim.min>b.dist_lim.max){p.error("hover_setup(): Wrong distance limits object");return}b.dist_lim.min=Math.max(b.dist_lim.min,0);b.dist_lim.max=Math.max(b.dist_lim.max,0)}if(b.hover_angle_lim&&("number"!=typeof b.hover_angle_lim.down||"number"!=typeof b.hover_angle_lim.up||b.hover_angle_lim.down<b.hover_angle_lim.up))p.error("hover_setup(): Wrong hover angle limits object");
else if(b.horiz_trans_lim&&("number"!=typeof b.horiz_trans_lim.min||"number"!=typeof b.horiz_trans_lim.max||b.horiz_trans_lim.min>b.horiz_trans_lim.max))p.error("hover_setup(): Wrong horizontal translation limits object");else if(b.vert_trans_lim&&("number"!=typeof b.vert_trans_lim.min||"number"!=typeof b.vert_trans_lim.max||b.vert_trans_lim.min>b.vert_trans_lim.max))p.error("hover_setup(): Wrong vertical translation limits object");else{h.wipe_move_style(a);a.render.move_style=h.MS_HOVER_CONTROLS;
var f=b.pos||k.get_trans_view(a.render.world_tsr);h.setup_hover_model(a,f,b.pivot,b.dist_lim,b.hover_angle_lim,b.horiz_trans_lim,b.vert_trans_lim,b.enable_horiz_rot||!1);c.update_transform(a);n.sync_transform(a);h.init_ortho_props(a)}}else p.error("hover_setup(): Wrong camera object")};a.hover_rotate=function(a,b,e,f,k){h.is_hover_camera(a)?(h.rotate_hover_camera(a,b,e,f||!1,k||!1),c.update_transform(a),n.sync_transform(a)):p.error("hover_rotate(): Wrong camera object or camera move style")};a.hover_set_pivot_translation=
function(a,b){h.is_hover_camera(a)?(h.set_hover_pivot(a,b),c.update_transform(a),n.sync_transform(a)):p.error("hover_set_pivot_translation(): Wrong camera object or camera move style")};a.hover_get_pivot=function(a,b){if(!h.is_hover_camera(a))return p.error("hover_get_pivot(): Wrong camera object or camera move style"),null;b=b||new Float32Array(3);A.copy(a.render.hover_pivot,b);return b};a.hover_get_distance=function(a){return h.is_hover_camera(a)?c.obj_point_distance(a,a.render.hover_pivot):(p.error("hover_get_distance(): Wrong camera object or camera move style"),
0)};a.hover_set_vertical_limits=function(a,b){h.is_hover_camera(a)?"number"!=typeof b.down||"number"!=typeof b.up||b.down<b.up?p.error("hover_set_vertical_limits(): Wrong limits object"):(h.hover_set_vertical_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("hover_set_vertical_limits(): Wrong camera object or camera move style")};a.hover_get_vertical_limits=function(a,b){if(!h.is_hover_camera(a))return p.error("hover_get_vertical_limits(): Wrong camera object or camera move style"),
null;var c=a.render;b=b||{};b.down=c.vertical_limits.down;b.up=c.vertical_limits.up;return b};a.hover_set_distance_limits=function(a,b){h.is_hover_camera(a)?"number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max?p.error("hover_set_distance_limits(): Wrong limits object"):(b.min=Math.max(b.min,0),b.max=Math.max(b.max,0),h.hover_set_distance_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("hover_set_distance_limits(): Wrong camera object or camera move style")};a.hover_get_distance_limits=
function(a,b){if(!h.is_hover_camera(a))return p.error("hover_get_distance_limits(): Wrong camera object or camera move style"),null;var c=a.render;b=b||{};b.min=c.distance_limits.min;b.max=c.distance_limits.max;return b};a.hover_set_vert_trans_limits=function(a,b){h.is_hover_camera(a)?b&&("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max)?p.error("hover_set_vert_trans_limits(): Wrong limits object"):(h.set_vert_trans_limits(a,b),c.update_transform(a),n.sync_transform(a)):p.error("hover_set_vert_trans_limits(): Wrong camera object or camera move style")};
a.hover_get_vert_trans_limits=function(a,b){if(!h.is_hover_camera(a))return p.error("hover_get_vert_trans_limits(): Wrong camera object or camera move style"),null;var c=a.render;return c.hover_vert_trans_limits?(b=b||{},b.min=c.hover_vert_trans_limits.min,b.max=c.hover_vert_trans_limits.max,b):null};a.hover_set_horiz_trans_limits=function(a,b){h.is_hover_camera(a)?b&&("number"!=typeof b.min||"number"!=typeof b.max||b.min>b.max)?p.error("hover_set_horiz_trans_limits(): Wrong limits object"):(h.set_hor_trans_limits(a,
b),c.update_transform(a),n.sync_transform(a)):p.error("hover_set_horiz_trans_limits(): Wrong camera object or camera move style")};a.hover_get_horiz_trans_limits=function(a,b){if(!h.is_hover_camera(a))return p.error("hover_get_horiz_trans_limits(): Wrong camera object or camera move style"),null;var c=a.render;return c.hover_horiz_trans_limits?(b=b||{},b.min=c.hover_horiz_trans_limits.min,b.max=c.hover_horiz_trans_limits.max,b):null};a.hover_switch_horiz_rotation=function(a,b){if(!h.is_hover_camera(a))return p.error("hover_switch_horiz_rotation(): Wrong camera object or camera move style"),
null;a.render.enable_hover_hor_rotation=b};a.is_static_camera=h.is_static_camera;a.is_target_camera=h.is_target_camera;a.is_eye_camera=h.is_eye_camera;a.is_hover_camera=h.is_hover_camera;a.set_move_style=function(a,b){if(!e.is_camera(a))return p.error("set_move_style(): Wrong camera object"),!1;if(b!=h.MS_STATIC&&b!=h.MS_EYE_CONTROLS&&b!=h.MS_TARGET_CONTROLS&&b!=h.MS_HOVER_CONTROLS)return p.error("set_move_style(): Wrong move style"),!1;h.set_move_style(a,b);c.update_transform(a);n.sync_transform(a);
return!0};a.get_move_style=function(a){return e.is_camera(a)?h.get_move_style(a):(p.error("get_move_style(): Wrong camera object"),null)};a.set_translation=function(a,b){if(e.is_camera(a)){var f=a.render;if(h.is_target_camera(a)){var m=k.get_trans_view(f.world_tsr),m=A.subtract(b,m,v);A.add(m,f.pivot,f.pivot)}else h.is_hover_camera(a)&&(m=k.get_trans_view(f.world_tsr),m=A.subtract(b,m,v),A.add(m,f.hover_pivot,f.hover_pivot));c.set_translation(a,b);c.update_transform(a);n.sync_transform(a)}else p.error("set_translation(): Wrong camera object")};
a.get_translation=function(a,b){if(!e.is_camera(a))return p.error("get_translation(): Wrong camera object"),null;b=b||new Float32Array(3);return c.get_translation(a,b)};a.rotate_camera=function(a,b,f,k,m){e.is_camera(a)?(k=k||!1,m=m||!1,h.is_target_camera(a)?h.rotate_target_camera(a,b,f,k,m):h.is_eye_camera(a)?h.rotate_eye_camera(a,b,f,k,m):h.is_hover_camera(a)?h.rotate_hover_camera(a,b,f,k,m):h.is_static_camera(a)?p.warn("rotate_camera(): not supported for STATIC cameras"):p.error("rotate_camera(): Wrong camera move style"),
c.update_transform(a),n.sync_transform(a)):p.error("rotate_camera(): Wrong camera object")};a.set_velocities=function(a,b){if(e.is_camera(a)){var c=a.render;"number"==typeof b.trans&&(c.velocity_trans=m.clamp(b.trans,0,Infinity));"number"==typeof b.rot&&(c.velocity_rot=m.clamp(b.rot,0,Infinity));"number"==typeof b.zoom&&(c.velocity_zoom=m.clamp(b.zoom,0,.99))}else p.error("set_velocities(): Wrong camera object")};a.get_velocities=function(a,b){if(!e.is_camera(a))return p.error("get_velocities(): Wrong camera object"),
null;var c=a.render;b=b||{};b.trans=c.velocity_trans;b.rot=c.velocity_rot;b.zoom=c.velocity_zoom;return b};a.is_look_up=function(a){if(!e.is_camera(a))return p.error("is_look_up(): Wrong camera object"),!1;a=k.get_quat_view(a.render.world_tsr);return 0<=m.quat_to_dir(a,m.AXIS_MZ,v)[1]};a.get_camera_angles=function(a,b){if(!e.is_camera(a))return p.error("get_camera_angles(): Wrong camera object"),null;b=b||new Float32Array(2);h.get_camera_angles(a,b);return b};a.get_camera_angles_char=function(a,b){if(!e.is_camera(a))return p.error("get_camera_angles_char(): Wrong camera object"),
null;b=b||new Float32Array(2);h.get_camera_angles_char(a,b);return b};a.set_stereo_distance=function(a,b){if(e.is_camera(a))for(var c=B.get_active(),c=e.get_scene_data(a,c).cameras,f=0;f<c.length;f++){var k=c[f];k.type!=h.TYPE_STEREO_LEFT&&k.type!=h.TYPE_STEREO_RIGHT&&k.type!=h.TYPE_HMD_LEFT&&k.type!=h.TYPE_HMD_RIGHT||h.set_stereo_params(k,b,k.stereo_eye_dist)}else p.error("set_stereo_distance(): Wrong camera object")};a.get_stereo_distance=function(a){if(!e.is_camera(a))return p.error("get_stereo_distance(): Wrong camera object"),
0;var b=B.get_active();a=e.get_scene_data(a,b).cameras;for(b=0;b<a.length;b++){var c=a[b];if(c.type==h.TYPE_STEREO_LEFT||c.type==h.TYPE_STEREO_RIGHT)return c.stereo_conv_dist}return 0};a.set_eye_distance=function(a,b){if(e.is_camera(a)){var c=B.get_active(),c=e.get_scene_data(a,c).cameras;h.set_eye_distance(c,b)}else p.error("set_eye_distance(): Wrong camera object")};a.get_eye_distance=function(a){if(!e.is_camera(a))return p.error("get_eye_distance(): Wrong camera object"),0;var b=B.get_active();
a=e.get_scene_data(a,b).cameras;for(b=0;b<a.length;b++){var c=a[b];if(c.type==h.TYPE_STEREO_LEFT||c.type==h.TYPE_STEREO_RIGHT||c.type==h.TYPE_HMD_LEFT||c.type==h.TYPE_HMD_RIGHT)return c.stereo_eye_dist}return 0};a.set_vertical_axis=function(a,b){e.is_camera(a)?(A.copy(b,a.render.vertical_axis),c.update_transform(a),n.sync_transform(a)):p.error("set_vertical_axis(): Wrong camera object")};a.get_vertical_axis=function(a,b){if(e.is_camera(a))return b||(b=A.create()),A.copy(a.render.vertical_axis,b),
b;p.error("get_vertical_axis(): Wrong camera object")};a.translate_view=function(a,b,c,f){if(e.is_camera(a)){var k=B.get_active();a=e.get_scene_data(a,k).cameras;for(k=0;k<a.length;k++){var g=a[k];g.reflection_plane||h.set_projection(g,g.aspect);var m=v;m[0]=-b;m[1]=-c;m[2]=0;l.translate(g.proj_matrix,m,g.proj_matrix);l.rotateZ(g.proj_matrix,f,g.proj_matrix);h.calc_view_proj_inverse(g);h.calc_sky_vp_inverse(g)}}else p.error("translate_view(): Wrong camera object")};a.get_view_vector=function(a,b){if(!e.is_camera(a))return p.error("get_view_vector(): Wrong camera object"),
null;b=b||new Float32Array(3);var c=k.get_quat_view(a.render.world_tsr);m.quat_to_dir(c,m.AXIS_MZ,b);return b};a.get_fov=function(a){if(!e.is_camera(a))return p.error("get_fov(): Wrong camera object"),0;var b=B.get_active();a=e.get_scene_data(a,b).cameras;return m.deg_to_rad(a[0].fov)};a.set_fov=function(a,b){if(e.is_camera(a))for(var c=B.get_active(),c=e.get_scene_data(a,c).cameras,f=0;f<c.length;f++){var k=c[f];k.fov=m.rad_to_deg(b);k.reflection_plane||h.set_projection(k,k.aspect);h.calc_view_proj_inverse(k);
h.calc_sky_vp_inverse(k)}else p.error("set_fov(): Wrong camera object")};a.set_hmd_fov=function(a,b,c){var f;if(f=!e.is_camera(a)){a:{if(e.is_camera(a)){f=B.get_active();f=e.get_scene_data(a,f).cameras;for(var k=0;k<f.length;k++){var g=f[k];if(g.type==h.TYPE_HMD_LEFT||g.type==h.TYPE_HMD_RIGHT){f=!0;break a}}}else p.error("is_hmd_camera(): Wrong camera object");f=!1}f=!f}f?p.error("set_hmd_fov(): Wrong camera object"):b&&c&&h.set_hmd_fov(a,b,c)};a.correct_up=function(a,f,k){e.is_camera(a)?(f=f||a.render.vertical_axis,
b.correct_up(a,f,k||!1),c.update_transform(a),n.sync_transform(a)):p.error("correct_up(): Wrong camera object")};a.set_ortho_scale=function(a,b){if(e.is_camera(a)&&h.is_ortho_camera(a)){var c=a.render;if(h.is_target_camera(a)){var f=k.get_trans_view(c.world_tsr),f=A.dist(f,c.pivot);c.init_top=b/2*c.init_dist/f}else h.is_hover_camera(a)?(f=k.get_trans_view(c.world_tsr),f=A.distance(f,c.hover_pivot),c.init_top=b/2*c.init_dist/f):(c=B.get_active(),e.get_scene_data(a,c).cameras[0].top=b/2);h.update_ortho_scale(a)}else p.error("set_ortho_scale(): Wrong camera object")};
a.get_ortho_scale=function(a){if(!e.is_camera(a)||!h.is_ortho_camera(a))return p.error("get_ortho_scale(): Wrong camera object"),0;var b=B.get_active();return 2*e.get_scene_data(a,b).cameras[0].top};a.is_ortho_camera=function(a){return e.is_camera(a)?h.is_ortho_camera(a):(p.error("is_ortho_camera(): Wrong camera object"),!1)};a.calc_ray=function(a,b,l,n){if(!e.is_camera(a))return p.error("calc_ray(): Wrong camera object"),null;var r=B.get_active(),g=e.get_scene_data(a,r).cameras[0];n&&3==n.length?
p.error_once('dest parameter in the function "calc_ray" should be type of parametric line.'):n=n||new Float32Array(6);switch(g.type){case h.TYPE_PERSP:case h.TYPE_PERSP_ASPECT:case h.TYPE_STEREO_LEFT:case h.TYPE_STEREO_RIGHT:var u=Math.tan(g.fov*Math.PI/360),E=u*g.aspect,r=v;b=f.canvas_to_viewport_coords(b,l,w,g);r[0]=(2*b[0]/g.width-1)*E;r[1]=(1-2*b[1]/g.height)*u;r[2]=-1;k.transform_dir_vec3(r,a.render.world_tsr,r);A.normalize(r,r);3==n.length?A.copy(r,n):(a=c.get_translation(a,z),q.set_pline_initial_point(n,
a),q.set_pline_directional_vec(n,r));return n;case h.TYPE_ORTHO:return r=v,b=f.canvas_to_viewport_coords(b,l,w,g),r[0]=(2*b[0]/g.width-1)*g.top*g.aspect,r[1]=(1-2*b[1]/g.height)*g.top,r[2]=0,k.transform_vec3(r,a.render.world_tsr,r),A.copy(r,n),a=k.get_quat_view(a.render.world_tsr,y),A.transformQuat(m.AXIS_MZ,a,r),q.set_pline_directional_vec(n,r),n;default:return p.error("calc_ray(): Non-compatible camera"),n}};a.project_point=function(a,b,c){if(!e.is_camera(a))return p.error("project_point(): Wrong camera object"),
null;c=c||new Float32Array(2);return h.project_point(a,b,c)};a.has_distance_limits=function(a){return(h.is_target_camera(a)||h.is_hover_camera(a))&&null!==a.render.distance_limits};a.has_vertical_rot_limits=function(a){return(h.is_eye_camera(a)||h.is_target_camera(a)||h.is_hover_camera(a))&&null!==a.render.vertical_limits};a.has_vertical_limits=function(a){p.error_deprecated("has_vertical_limits","has_vertical_rot_limits");return h.is_target_camera(a)||h.is_eye_camera(a)?null!==a.render.vertical_limits:
(p.error("has_vertical_limits(): Wrong camera object"),!1)};a.has_horizontal_rot_limits=function(a){return(h.is_target_camera(a)||h.is_eye_camera(a))&&null!==a.render.horizontal_limits};a.has_horizontal_limits=function(a){p.error_deprecated("has_horizontal_limits","has_horizontal_rot_limits");return h.is_target_camera(a)||h.is_eye_camera(a)?null!==a.render.horizontal_limits:(p.error("has_horizontal_limits(): Wrong camera object"),!1)};a.has_vertical_trans_limits=function(a){return h.is_hover_camera(a)&&
null!==a.render.hover_vert_trans_limits};a.has_horizontal_trans_limits=function(a){return h.is_hover_camera(a)&&null!==a.render.hover_horiz_trans_limits};a.move_pivot=function(a,b,e){p.error_deprecated("move_pivot","target_pan_pivot");if(h.is_target_camera(a)){var f=a.render;if(f.use_panning){var m=k.get_trans_view(f.world_tsr),g=A.subtract(m,f.pivot,z);v[0]=b;v[1]=0;v[2]=e;A.scale(v,A.len(g),v);k.transform_dir_vec3(v,f.world_tsr,v);A.add(f.pivot,v,f.pivot);A.add(m,v,m);c.update_transform(a);n.sync_transform(a)}}else p.error("move_pivot(): wrong object")};
a.set_velocity_params=function(a,b){p.error_deprecated("set_velocity_params","set_velocities");if(e.is_camera(a)){var c=a.render;c.velocity_trans=m.clamp(b[0],0,Infinity);c.velocity_rot=m.clamp(b[1],0,Infinity);c.velocity_zoom=m.clamp(b[2],0,.99)}else p.error("set_velocity_params(): Wrong camera object")};a.get_velocity_params=function(a,b){p.error_deprecated("get_velocity_params","get_velocities");if(!e.is_camera(a))return p.error("get_velocity_params(): Wrong camera object"),null;b=b||new Float32Array(3);
var c=a.render;b[0]=c.velocity_trans;b[1]=c.velocity_rot;b[2]=c.velocity_zoom;return b};a.clear_horizontal_limits=function(a){p.error_once('camera.clear_horizontal_limits() deprecated, use camera.target_set_horizontal_limits(), camera.eye_set_horizontal_limits() or camera.hover_set_horiz_trans_limits() with passing null as the "limits" argument.');e.is_camera(a)?h.is_target_camera(a)||h.is_eye_camera(a)?a.render.horizontal_limits=null:h.is_hover_camera(a)&&(a.render.hover_horiz_trans_limits=null):
p.error("clear_horizontal_limits(): Wrong camera object")};a.clear_vertical_limits=function(a){p.error_once('camera.clear_vertical_limits() deprecated, use camera.target_set_vertical_limits(), camera.eye_set_vertical_limits() or camera.hover_set_vert_trans_limits() with passing null as the "limits" argument.');e.is_camera(a)?h.is_target_camera(a)||h.is_eye_camera(a)?a.render.vertical_limits=null:h.is_hover_camera(a)&&(a.render.hover_vert_trans_limits=null):p.error("clear_vertical_limits(): Wrong camera object")};
a.clear_hover_angle_limits=function(a){p.error_once("camera.clear_hover_angle_limits() deprecated, HOVER camera always has hover angle limits")};a.set_look_at=function(a,e,f,k){p.error_deprecated_arr("camera.set_look_at",["camera.static_set_look_at","camera.eye_set_look_at"]);k=k||a.render.vertical_axis;h.set_look_at(a,e,f);b.correct_up(a,k,!0);c.update_transform(a);n.sync_transform(a)};a.rotate_eye_camera=function(a,b,e,f,k){p.error_deprecated_arr("camera.rotate_eye_camera",["camera.eye_rotate",
"camera.rotate_camera"]);h.is_eye_camera(a)?(h.rotate_eye_camera(a,b,e,f,k),c.update_transform(a),n.sync_transform(a)):p.error("rotate_eye_camera(): wrong object")};a.rotate_target_camera=function(a,b,e,f,k){p.error_deprecated_arr("camera.rotate_target_camera",["camera.target_rotate","camera.rotate_camera"]);h.is_target_camera(a)?(h.rotate_target_camera(a,b,e,f,k),c.update_transform(a),n.sync_transform(a)):p.error("rotate_target_camera(): wrong object")};a.set_trans_pivot=function(a,b,e){p.error_deprecated("camera.set_trans_pivot",
"camera.target_set_trans_pivot");h.is_target_camera(a)?(h.set_trans_pivot(a,b,e),c.update_transform(a),n.sync_transform(a)):p.error("set_trans_pivot(): Wrong object or camera move style")};a.zoom_object=function(a,b){p.error_deprecated("camera.zoom_object","camera.target_zoom_object");if(h.is_target_camera(a)){c.get_object_center(b,!1,v);u(a,v);c.update_transform(a);var f=c.get_object_size(b),k=B.get_active(),k=e.get_scene_data(a,k).cameras[0],k=h.get_angular_diameter(k)/2,f=f/Math.sin(k),k=c.obj_point_distance(a,
v);c.move_local(a,0,0,f-k);c.update_transform(a);n.sync_transform(a)}else p.error("zoom_object(): wrong object")};a.set_pivot=u;a.rotate_hover_camera=function(a,b,e,f,k){p.error_deprecated("camera.rotate_hover_camera","camera.hover_rotate");h.is_hover_camera(a)?(h.rotate_hover_camera(a,b,e,f,k),c.update_transform(a),n.sync_transform(a)):p.error("rotate_hover_camera(): wrong object")};a.get_hover_cam_pivot=function(a,b){p.error_deprecated("camera.get_hover_cam_pivot","camera.hover_get_pivot");if(!h.is_hover_camera(a))return p.error("get_hover_cam_pivot(): wrong object"),
null;b||(b=new Float32Array(3));A.copy(a.render.hover_pivot,b);return b};a.get_eye=function(a,b){p.error_deprecated("camera.get_eye","camera.get_translation");return e.is_camera(a)?h.get_eye(a,b):(p.error("get_eye(): Wrong object"),null)};a.get_pivot=function(a,b){p.error_deprecated("camera.get_pivot","camera.target_get_pivot");if(!h.is_target_camera(a))return p.error("get_pivot(): Wrong object or camera move style"),null;b||(b=new Float32Array(3));A.copy(a.render.pivot,b);return b};a.hover_cam_set_translation=
function(a,b){p.error_deprecated("camera.hover_cam_set_translation","camera.set_translation");if(h.is_hover_camera(a)){var e=a.render,f=k.get_trans_view(e.world_tsr),f=A.subtract(b,f,v);A.add(f,e.hover_pivot,e.hover_pivot);c.set_translation(a,b);c.update_transform(a);n.sync_transform(a)}else p.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,b){p.error_deprecated("camera.set_hover_pivot","camera.hover_set_pivot_translation");h.is_hover_camera(a)?(h.set_hover_pivot(a,
b),c.update_transform(a),n.sync_transform(a)):p.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_angle_limits=function(a,b){p.error_deprecated("camera.get_hover_angle_limits","camera.hover_get_vertical_limits");if(!h.is_hover_camera(a))return p.error("get_hover_angle_limits(): wrong object"),null;b=b||new Float32Array(2);b[0]=a.render.vertical_limits.down;b[1]=a.render.vertical_limits.up;return b};a.get_cam_dist_limits=function(a,b){p.error_deprecated_arr("camera.get_cam_dist_limits",
["camera.hover_get_distance_limits","camera.target_get_distance_limits"]);if(!h.is_hover_camera(a)&&!h.is_target_camera(a))return p.error("get_cam_dist_limits(): wrong object"),null;if(a.render.distance_limits)b=b||new Float32Array(2),b[0]=a.render.distance_limits.max,b[1]=a.render.distance_limits.min;else return null;return b};a.apply_vertical_limits=function(b,e,f,k){p.error_deprecated_arr("camera.apply_vertical_limits",["camera.eye_set_vertical_limits","camera.target_set_vertical_limits","camera.hover_set_vert_trans_limits"]);
if(h.is_target_camera(b)){var m=D;m.down=e;m.up=f;m.camera_space=k==c.SPACE_LOCAL;a.target_set_vertical_limits(b,m)}else h.is_eye_camera(b)?(m=D,m.down=e,m.up=f,m.camera_space=k==c.SPACE_LOCAL,a.eye_set_vertical_limits(b,m)):h.is_hover_camera(b)?(m=D,m.min=e,m.max=f,a.hover_set_vert_trans_limits(b,m)):p.error("apply_vertical_limits(): wrong object")};a.apply_hover_angle_limits=function(b,c,e){p.error_deprecated("camera.apply_hover_angle_limits","camera.hover_set_vertical_limits");D.down=c;D.up=e;
a.hover_set_vertical_limits(b,D)};a.apply_distance_limits=function(b,c,e){p.error_deprecated_arr("camera.apply_distance_limits",["camera.target_set_distance_limits","camera.hover_set_distance_limits"]);if(h.is_target_camera(b)){var f=D;f.min=c;f.max=e;a.target_set_distance_limits(b,f)}else h.is_hover_camera(b)?(f=D,f.min=c,f.max=e,a.hover_set_distance_limits(b,f)):p.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(b){p.error_deprecated("camera.clear_distance_limits",
"camera.target_set_distance_limits");a.target_set_distance_limits(b,null)};a.get_vertical_limits=function(a,b){p.error_deprecated_arr("camera.get_vertical_limits",["camera.eye_get_vertical_limits","camera.target_get_vertical_limits","camera.hover_get_vert_trans_limits"]);if(!h.is_target_camera(a)&&!h.is_eye_camera(a)&&!h.is_hover_camera(a))return p.error("get_vertical_limits(): wrong object"),null;var c=a.render;b=b||new Float32Array(2);if(h.is_eye_camera(a)||h.is_target_camera(a)){if(c.vertical_limits)return b[0]=
c.vertical_limits.down,b[1]=c.vertical_limits.up,b}else if(h.is_hover_camera(a)&&c.hover_vert_trans_limits)return b[0]=c.hover_vert_trans_limits.min,b[1]=c.hover_vert_trans_limits.max,b;return null};a.apply_horizontal_limits=function(b,e,f,k){p.error_deprecated_arr("camera.apply_horizontal_limits",["camera.eye_set_horizontal_limits","camera.target_set_horizontal_limits","camera.hover_set_horiz_trans_limits"]);if(h.is_target_camera(b)){var m=D;m.left=e;m.right=f;m.camera_space=k==c.SPACE_LOCAL;a.target_set_horizontal_limits(b,
m)}else h.is_eye_camera(b)?(m=D,m.left=e,m.right=f,m.camera_space=k==c.SPACE_LOCAL,a.eye_set_horizontal_limits(b,m)):h.is_hover_camera(b)?(m=D,m.min=e,m.max=f,a.hover_set_horiz_trans_limits(b,m)):p.error("apply_horizontal_limits(): wrong object")};a.get_horizontal_limits=function(a,b){p.error_deprecated_arr("camera.get_horizontal_limits",["camera.eye_get_horizontal_limits","camera.target_get_horizontal_limits","camera.hover_get_horiz_trans_limits"]);if(!h.is_target_camera(a)&&!h.is_eye_camera(a)&&
!h.is_hover_camera(a))return p.error("get_horizontal_limits(): wrong object"),null;var c=a.render;b=b||new Float32Array(2);if(h.is_eye_camera(a)||h.is_target_camera(a)){if(c.horizontal_limits)return b[0]=c.horizontal_limits.left,b[1]=c.horizontal_limits.right,b}else if(h.is_hover_camera(a)&&c.hover_horiz_trans_limits)return b[0]=c.hover_horiz_trans_limits.min,b[1]=c.hover_horiz_trans_limits.max,b;return null};a.get_frustum_planes=function(a,b){if(!e.is_camera(a))return p.error("get_frustum_planes(): Wrong camera object"),
null;var c=B.get_active(),c=e.get_scene_data(a,c).cameras[0].frustum_planes;E.copy(c.left,b.left);E.copy(c.right,b.right);E.copy(c.top,b.top);E.copy(c.bottom,b.bottom);E.copy(c.near,b.near);E.copy(c.far,b.far);return b}};b4w.module.config=function(a,r){var u=r("__config"),h=r("__compat"),b=r("__debug"),f=r("__data"),l=r("__print");a.P_LOW=u.P_LOW;a.P_HIGH=u.P_HIGH;a.P_ULTRA=u.P_ULTRA;a.P_CUSTOM=u.P_CUSTOM;a.P_AUTO=u.P_AUTO;a.set=u.set;a.get=u.get;a.reset=u.reset;a.reset_limits=u.reset_limits;a.get_std_assets_path=u.get_std_assets_path;a.apply_quality=function(a){f.is_primary_loaded()?l.error("Cannot change quality profile after a scene is loaded."):(u.set("quality",a),b.get_gl()&&(u.apply_quality(),h.set_hardware_defaults(b.get_gl(),
!1)))}};b4w.module.controls=function(a,r){var u=r("__controls"),h=r("__print");a.CT_POSITIVE=u.CT_POSITIVE;a.CT_CONTINUOUS=u.CT_CONTINUOUS;a.CT_TRIGGER=u.CT_TRIGGER;a.CT_SHOT=u.CT_SHOT;a.CT_LEVEL=u.CT_LEVEL;a.CT_CHANGE=u.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;
a.KEY_8=56;a.KEY_9=57;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_MULT=106;a.KEY_ADD=107;a.KEY_SUB=109;a.KEY_DEC_POINT=
110;a.KEY_DIV=111;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=u.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=u.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=u.PL_MULTITOUCH_MOVE_PAN;a.PL_MULTITOUCH_MOVE_ROTATE=u.PL_MULTITOUCH_MOVE_ROTATE;a.default_AND_logic_fun=u.default_AND_logic_fun;
a.default_OR_logic_fun=u.default_OR_logic_fun;a.create_gamepad_btn_sensor=u.create_gamepad_btn_sensor;a.create_gamepad_axis_sensor=u.create_gamepad_axis_sensor;a.create_custom_sensor=u.create_custom_sensor;a.create_keyboard_sensor=u.create_keyboard_sensor;a.create_collision_sensor=function(a,f,h){return u.create_collision_sensor(a,f||"ANY",h||!1)};a.create_collision_impulse_sensor=u.create_collision_impulse_sensor;a.create_ray_sensor=function(a,f,h,q,e,n,p){return u.create_ray_sensor(a,f,h,q||"ANY",
e||!1,n||!1,p||!1)};a.create_mouse_click_sensor=u.create_mouse_click_sensor;a.create_mouse_wheel_sensor=u.create_mouse_wheel_sensor;a.create_mouse_move_sensor=u.create_mouse_move_sensor;a.create_touch_move_sensor=u.create_touch_move_sensor;a.create_touch_zoom_sensor=u.create_touch_zoom_sensor;a.create_touch_rotate_sensor=u.create_touch_rotate_sensor;a.create_touch_click_sensor=u.create_touch_click_sensor;a.create_motion_sensor=u.create_motion_sensor;a.create_vertical_velocity_sensor=u.create_vertical_velocity_sensor;
a.create_gyro_angles_sensor=u.create_gyro_angles_sensor;a.create_gyro_quat_sensor=u.create_gyro_quat_sensor;a.create_gyro_delta_sensor=u.create_gyro_delta_sensor;a.create_hmd_quat_sensor=u.create_hmd_quat_sensor;a.create_hmd_position_sensor=u.create_hmd_position_sensor;a.create_timer_sensor=function(a,f){return u.create_timer_sensor(a,f||!1)};a.reset_timer_sensor=u.reset_timer_sensor;a.create_elapsed_sensor=u.create_elapsed_sensor;a.create_timeline_sensor=u.create_timeline_sensor;a.create_selection_sensor=
function(a,f){return u.create_selection_sensor(a,f||!1)};a.create_callback_sensor=function(a,f){return u.create_callback_sensor(a,f||0)};a.set_custom_sensor=function(a,f){u.sensor_set_value(a,f)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=u.get_sensor_value;a.get_sensor_payload=u.get_sensor_payload;a.create_sensor_manifold=function(a,f,h,q,e,n,p){e=e||u.default_AND_logic_fun;u.create_sensor_manifold(a,f,h,q,e,n,void 0===p?null:p)};a.create_kb_sensor_manifold=function(a,f,h,
q,e,n){q=u.create_keyboard_sensor(q);u.create_sensor_manifold(a,f,h,[q],u.default_AND_logic_fun,e,void 0===n?null:n)};a.check_sensor_manifolds=function(a){return u.check_sensor_manifold(a,null)};a.check_sensor_manifold=u.check_sensor_manifold;a.remove_sensor_manifold=u.remove_sensor_manifold;a.reset=u.reset;a.register_keyboard_events=function(){h.error_once("controls.register_keyboard_events() deprecated")};a.register_mouse_events=function(){h.error_once("controls.register_mouse_events() deprecated")};
a.register_wheel_events=function(){h.error_once("controls.register_wheel_events() deprecated")};a.register_touch_events=function(){h.error_once("controls.register_touch_events() deprecated")};a.register_device_orientation=function(){h.error_once("controls.register_device_orientation() deprecated")};a.unregister_keyboard_events=function(){h.error_once("controls.unregister_keyboard_events() deprecated")};a.unregister_mouse_events=function(){h.error_once("controls.unregister_mouse_events() deprecated")};
a.unregister_wheel_events=function(){h.error_once("controls.unregister_wheel_events() deprecated")};a.unregister_touch_events=function(){h.error_once("controls.unregister_touch_events() deprecated")};a.unregister_device_orientation=function(){h.error_once("controls.unregister_device_orientation() deprecated")}};b4w.module.constraints=function(a,r){var u=r("__camera"),h=r("__constraints"),b=r("__obj_util"),f=r("__physics"),l=r("__print"),q=r("__transform");a.append_stiff=function(a,b,l,r,c){c=c||1;b instanceof Array&&2==b.length?h.append_stiff_bone(a,b[0],b[1],l,r,c):h.append_stiff_obj(a,b,l,r,c);q.update_transform(a);f.sync_transform(a)};a.append_semi_stiff=function(a,b,l,r){h.append_semi_stiff_obj(a,b,l,r);q.update_transform(a);f.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,p,r,c,k,m,A){u.is_eye_camera(a)?
(c=c||-Math.PI/2,k=k||Math.PI/2,m=m||Math.PI/2,A=A||-Math.PI/2,h.append_semi_stiff_cam_obj(a,b,p,r,c,k,m,A),q.update_transform(a),f.sync_transform(a)):l.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_semi_soft_cam=function(a,b,p,r){if(u.is_eye_camera(a)){if(!r||0>r)r=.25;h.append_semi_soft_cam_obj(a,b,p,r);q.update_transform(a);f.sync_transform(a)}else l.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};
a.append_stiff_trans=function(a,b,l){h.append_stiff_trans_obj(a,b,l);q.update_transform(a);f.sync_transform(a)};a.append_copy_trans=function(a,b,l){h.append_copy_trans_obj(a,b,l);q.update_transform(a);f.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,l,r){h.append_stiff_trans_rot_obj(a,b,l,r,1);q.update_transform(a);f.sync_transform(a)};a.append_track=function(a,b){3==b.length?h.append_track_point(a,b):h.append_track_obj(a,b);q.update_transform(a);f.sync_transform(a)};a.append_follow=function(a,
b,l,r){3==b.length?h.append_follow_point(a,b,l,r):h.append_follow_obj(a,b,l,r);q.update_transform(a);f.sync_transform(a)};a.append_stiff_viewport=function(a,b,l){h.append_stiff_viewport(a,b,l);q.update_transform(a);f.sync_transform(a)};a.remove=function(a){a.constraint&&h.remove(a)};a.get_parent=function(a){l.error_deprecated("constraints.get_parent","objects.get_parent");return b.get_parent(a)}};b4w.module.container=function(a,r){var u=r("__container"),h=r("__print");a.get_canvas=u.get_canvas;a.get_canvas_hud=u.get_canvas_hud;a.get_container=u.get_container;a.insert_to_container=function(a,f){2!=arguments.length?h.error("insert_to_container(): two arguments required"):a&&f&&u.insert_to_container(a,f)};a.set_canvas_offsets=u.set_canvas_offsets;a.update_canvas_offsets=u.update_canvas_offsets;a.client_to_canvas_coords=u.client_to_canvas_coords;a.force_offsets_updating=u.force_offsets_updating;
a.resize=function(a,f,l){a&&f||h.warn("Wrong canvas container dimensions: "+a+"x"+f+". Zero dimensions aren't allowed. Resized to: "+u.DEFAULT_CANVAS_W+"x"+u.DEFAULT_CANVAS_H+".");u.resize(a,f,l)};a.resize_to_container=function(a){u.resize_to_container(a||!1)}};b4w.module.data=function(a,r){var u=r("__data"),h=r("__loader");r("__print");a.load=u.load;a.unload=function(a){u.unload(a|0)};a.set_debug_resources_root=u.set_debug_resources_root;a.is_primary_loaded=u.is_primary_loaded;a.is_idle=h.is_finished;a.load_and_add_new=u.load;a.cleanup=a.unload;a.activate_media=u.activate_media};b4w.module.debug=function(a,r){function u(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ ?/))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}d=c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];a+=b[e];break;case "ATTRIB":d+=b[e];break;case "ADDRESS":case "PARAM":case "TEMP":case "ALIAS":case "OUTPUT":break;
case "END":break;default:a+=b[e]}b.ALL_OPS=a;b.TEX_OPS=c;b.ATTRIBS=d;return b}function h(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);if(200==c.status)return c.responseText;v.error(c.responseText);throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.fstats.ALL_OPS-a.fstats.ALL_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.fstats,e=c.vstats,g=f(c.cshader),g=g.length?"\t\t("+g.join(", ")+")":"\t\t(NA)";v.groupCollapsed("VERT ->","OPS",e.ALL_OPS,"ATT",e.ATTRIBS,
"TEX",e.TEX_OPS,"\t\tFRAG ->","OPS",d.ALL_OPS,"TEX",d.TEX_OPS,g);v.groupCollapsed("directives");for(var k=c.shaders_info.directives.slice().sort(),g=0;g<k.length;g++){var h=k[g];v.log_raw(h[0],h[1])}v.groupEnd();v.groupCollapsed("node elements");k=c.shaders_info.node_elements;for(g=0;g<k.length;g++)v.log_raw(k[g]);v.groupEnd();v.groupCollapsed("vert source");v.log_raw(c.vsrc);v.groupEnd();v.groupCollapsed("vert translated source");v.log_raw(c.vsrc_trans);v.groupEnd();g=["ALL_OPS","TEX_OPS","ATTRIBS"];
v.groupCollapsed("vert ops stats");for(var m in e)-1==g.indexOf(m)&&v.log_raw(m,e[m]);v.groupEnd();v.groupCollapsed("vert assembly");v.log_raw(c.vout);v.groupEnd();v.groupCollapsed("frag source");v.log_raw(c.fsrc);v.groupEnd();v.groupCollapsed("frag translated source");v.log_raw(c.fsrc_trans);v.groupEnd();v.groupCollapsed("frag ops stats");for(m in d)-1==g.indexOf(m)&&v.log_raw(m,d[m]);v.groupEnd();v.groupCollapsed("frag assembly");v.log_raw(c.fout);v.groupEnd();v.groupEnd()}}function f(a){for(var b=
[],c=y.get_all_scenes(),d=0;d<c.length;d++)for(var e=c[d],g=A.get_scene_objs(e,"MESH",A.DATA_ID_ALL),f=0;f<g.length;f++){var k=E.get_scene_data(g[f],e);if(k&&k.batches.length)for(var k=k.batches,h=0;h<k.length;h++){var m=k[h];if(m.shader==a)for(var l=0;l<m.material_names.length;l++){var n=m.material_names[l];-1==b.indexOf(n)&&b.push(n)}}}return b}function l(a,b){var c=function(){H.push(c);G=b;return a.apply(a,arguments)};return c}function q(a,b,c){if(typeof b!=typeof a)throw"Wrong expected data type.";
if(a.length!=b.length)throw"Wrong expected vector length.";c=c?c:1E-6;for(var d=0;d<a.length;d++)if(b[d]>a[d]+c||b[d]<a[d]-c)throw"Wrong result.";}var e=r("__config"),n=r("__compat"),p=r("__controls"),B=r("__container"),c=r("__debug"),k=r("__extensions"),m=r("__loader"),A=r("__objects"),E=r("__obj_util"),w=r("__physics"),v=r("__print"),z=r("__renderer"),y=r("__scenes"),D=r("__scenegraph"),K=r("__sfx"),d=r("__shaders"),t=r("__subscene"),C=r("__textures"),M=r("__util"),x=r("__vec3"),g=e.defaults,H=
[],G="",ba=!0,L=new Float32Array(2);a.DV_NONE=c.DV_NONE;a.DV_OPAQUE_WIREFRAME=c.DV_OPAQUE_WIREFRAME;a.DV_TRANSPARENT_WIREFRAME=c.DV_TRANSPARENT_WIREFRAME;a.DV_FRONT_BACK_VIEW=c.DV_FRONT_BACK_VIEW;a.DV_BOUNDINGS=c.DV_BOUNDINGS;a.DV_CLUSTERS_VIEW=c.DV_CLUSTERS_VIEW;a.DV_BATCHES_VIEW=c.DV_BATCHES_VIEW;a.DV_RENDER_TIME=c.DV_RENDER_TIME;a.physics_stats=function(){w.debug_workers()};a.physics_id=function(a){v.log("O",w.find_obj_by_body_id(a));for(var b=w.get_active_scene()._physics.bundles,c=0;c<b.length;c++){var d=
b[c];d.physics.body_id==a&&v.log("B",d)}};a.visible_objects=function(){for(var a=y.get_active(),b=A.get_scene_objs(a,"MESH",A.DATA_ID_ALL),a=[y.get_subs(a,t.MAIN_OPAQUE),y.get_subs(a,t.MAIN_BLEND),y.get_subs(a,t.MAIN_GLOW)],c=0;c<a.length;c++){var d=a[c],e=subs.draw_data;if(e.length){v.group(d.type,"DYNAMIC");for(var g=0;g<b.length;g++){var f=b[g],k=f.render;if("DYNAMIC"==k.type)for(var h=!1,m=0;m<e.length;m++){for(var l=e[m].bundles,n=0;n<l.length;n++){var p=l[n];if(p.do_render&&p.obj_render==k){v.log_raw(f.name,
f);h=!0;break}}if(h)break}}v.groupEnd();v.groupCollapsed(d.type,"STATIC");for(g=0;g<b.length;g++)if(f=b[g],k=f.render,"DYNAMIC"!=k.type)for(h=!1,m=0;m<e.length;m++){l=e[m].bundles;for(n=0;n<l.length;n++)if(p=l[n],p.do_render&&p.obj_render==k){v.log_raw(f.name,f);h=!0;break}if(h)break}v.groupEnd()}}};a.object_info=function(a){for(var b=y.get_active(),c=A.get_scene_objs(b,"MESH",A.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];if(e.name==a){v.log("Object",e);for(var g=y.get_all_subscenes(b),f=0;f<g.length;f++){for(var k=
g[f],h=[],m=k.draw_data,l=0;l<m.length;l++)for(var n=m[l].bundles,p=0;p<n.length;p++)n[p].obj_render==e.render&&h.push(n[p]);v.log("Subscene "+k.type,h)}}}};a.objects_stat=function(){var a=y.get_active();console.log("Armatures: "+A.get_scene_objs(a,"ARMATURE",A.DATA_ID_ALL).length);console.log("Cameras: "+A.get_scene_objs(a,"CAMERA",A.DATA_ID_ALL).length);console.log("Curves: "+A.get_scene_objs(a,"CURVE",A.DATA_ID_ALL).length);console.log("Empties: "+A.get_scene_objs(a,"EMPTY",A.DATA_ID_ALL).length);
console.log("Lamps: "+A.get_scene_objs(a,"LAMP",A.DATA_ID_ALL).length);console.log("Meshes: "+A.get_scene_objs(a,"MESH",A.DATA_ID_ALL).length);console.log("Speakers: "+A.get_scene_objs(a,"SPEAKER",A.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=y.get_active(),b=[y.get_subs(b,t.MAIN_OPAQUE),y.get_subs(b,t.MAIN_BLEND),y.get_subs(b,t.MAIN_GLOW)],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.draw_data,e=0;e<d.length;e++)for(var g=d[e].bundles,f=0;f<g.length;f++){var k=g[f].batch;k&&
(a+=k.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=y.get_active(),b=[y.get_subs(b,t.MAIN_OPAQUE),y.get_subs(b,t.MAIN_BLEND),y.get_subs(b,t.MAIN_GLOW)],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.draw_data,e=0;e<d.length;e++)for(var g=d[e].bundles,f=0;f<g.length;f++){var k=g[f].batch;k&&(a+=k.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=y.get_active(),b=y.subs_array(a,[t.MAIN_OPAQUE,t.MAIN_BLEND,t.MAIN_GLOW,t.MAIN_PLANE_REFLECT,t.MAIN_PLANE_REFLECT_BLEND]),
c=0,d=0;d<b.length;d++)for(var e=b[d],e=e.draw_data,g=0;g<e.length;g++)c+=e[g].bundles.length;a=y.subs_array(a,[t.MAIN_CUBE_REFLECT,t.MAIN_CUBE_REFLECT_BLEND]);for(d=0;d<a.length;d++)for(e=a[d],e=e.draw_data,g=0;g<e.length;g++)c+=6*e[g].bundles.length;return c};a.num_shaders=function(){var a=d.get_compiled_shaders();return M.get_dict_length(a)};a.geometry_stats=function(){for(var a=y.get_active(),b=y.get_all_subscenes(a),a={},c=0;c<b.length;c++){var d=b[c];if(d.type!=t.SINK&&d.type!=t.DEBUG_VIEW)for(var e=
d.draw_data,g=0;g<e.length;g++)for(var f=e[g].bundles,k=0;k<f.length;k++){var h=f[k].batch,m=f[k].obj_render;h&&(d.type!=t.COLOR_PICKING&&d.type!=t.OUTLINE_MASK||m.origin_selectable||m.origin_outlining)&&(a[h.id]=h)}}var c=b=0,l;for(l in a)d=a[l].bufs_data,d.debug_ibo_bytes&&(c+=d.debug_ibo_bytes/1048576),b+=d.debug_vbo_bytes/1048576;return{vbo_memory:b,ibo_memory:c}};a.num_textures=function(){for(var a=[],b=0,c=y.get_active(),c=[y.get_subs(c,t.MAIN_OPAQUE),y.get_subs(c,t.MAIN_BLEND),y.get_subs(c,
t.MAIN_GLOW)],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.draw_data,g=0;g<e.length;g++)for(var f=e[g].bundles,k=0;k<f.length;k++){var h=f[k].batch;if(h)for(var h=h.textures,m=0;m<h.length;m++){var l=h[m];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var n=l.w_texture;-1===a.indexOf(n)&&(a.push(n),l=l.width*l.height*4/1048576/l.compress_ratio,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=y.get_active(),c=y.get_all_subscenes(c),d=
0;d<c.length;d++){var e=c[d];if(e.type!=t.SINK){var g=e.camera,f=[g.color_attachment,g.depth_attachment];f.push.apply(f,e.textures_internal);for(e=0;e<f.length;e++){var k=f[e];C.is_texture(k)&&-1==a.indexOf(k)&&(a.push(k),b+=g.width*g.height*C.get_texture_texel_size(k))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=y.get_active();(a=y.get_subs(a,t.MAIN_OPAQUE))&&y.make_frustum_shot(a.camera,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=y.get_active(),
b=y.get_subs(a,t.MAIN_OPAQUE),a=y.subs_array(a,[t.SHADOW_CAST]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}y.make_frustum_shot(d.camera,b,e)}};a.scenegraph_to_dot=function(){for(var a=y.get_all_scenes(),b=0;b<a.length;b++){var c=y.get_graph(a[b]);v.log("\n"+D.debug_convert_to_dot(c))}};a.scenes_to_dot=function(){};a.loading_graph_to_dot=function(a){v.log("\n"+m.graph_to_dot(a|0))};a.controls_info=p.debug;
a.object_distance=function(a,b){var c=m_tsr.get_trans_view(a.render.world_tsr),d=m_tsr.get_trans_view(b.render.world_tsr);return x.dist(c,d)};a.msg=c.msg;a.fbmsg=c.fbmsg;a.print_telemetry=c.print_telemetry;a.plot_telemetry=c.plot_telemetry;a.fbres=function(a,b){b||(b=16);var d=function(){c.fbmsg("FBRES",a());setTimeout(d,b)};d()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),
g=new Float32Array([-1,0,0]),f=new Float32Array([0,-1,0]),k=new Float32Array([0,0,-1]);if(!M.cmp_arr(a,M.VEC3_IDENT))throw"Wrong VEC3_IDENT";if(!M.cmp_arr(b,M.QUAT4_IDENT))throw"Wrong QUAT4_IDENT";if(!M.cmp_arr(c,M.AXIS_X))throw"Wrong AXIS_X";if(!M.cmp_arr(d,M.AXIS_Y))throw"Wrong AXIS_Y";if(!M.cmp_arr(e,M.AXIS_Z))throw"Wrong AXIS_Z";if(!M.cmp_arr(g,M.AXIS_MX))throw"Wrong AXIS_MX";if(!M.cmp_arr(f,M.AXIS_MY))throw"Wrong AXIS_MY";if(!M.cmp_arr(k,M.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=
K.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==K.get_spk_behavior(c)&&K.mute(c,!0)}};a.check_finite=function(a){c.check_finite(a)};a.set_debug_params=function(a){var b=y.get_active();if(b=y.get_subs(b,t.DEBUG_VIEW)){if("number"==typeof a.debug_view_mode)switch(a.debug_view_mode){case c.DV_NONE:case c.DV_OPAQUE_WIREFRAME:case c.DV_TRANSPARENT_WIREFRAME:case c.DV_FRONT_BACK_VIEW:case c.DV_BOUNDINGS:case c.DV_CLUSTERS_VIEW:case c.DV_BATCHES_VIEW:case c.DV_RENDER_TIME:y.set_debug_view_mode(b,
a.debug_view_mode);break;default:v.error("set_debug_params(): Wrong debug view mode")}"number"==typeof a.debug_colors_seed&&y.set_debug_colors_seed(b,a.debug_colors_seed);"number"==typeof a.render_time_threshold&&y.set_render_time_threshold(b,a.render_time_threshold);"object"==typeof a.wireframe_edge_color&&y.set_wireframe_edge_color(b,M.f32(a.wireframe_edge_color))}else v.error("Debugging is not available on the scene.")};a.get_error_quantity=function(){return v.get_error_count()};a.get_warning_quantity=
function(){return v.get_warning_count()};a.clear_errors_warnings=function(){return v.clear_errors_warnings()};a.analyze_shaders=function(a){var e=d.get_compiled_shaders(),g=0,f;for(f in e)a&&-1===f.indexOf(a)||g++;var g="of "+g+" analyzing...",m={};for(f in e)if(!a||-1!==f.indexOf(a)){var l=e[f],p;var q=l.vshader;p=l.fshader;var r=k.get_debug_shaders();if(r){var t=r.getTranslatedShaderSource(q),r=r.getTranslatedShaderSource(p);if(n.detect_mobile())var t=t.replace("#version","#version 300 //"),r=r.replace("#version",
"#version 300 //"),x=h("/analyze_shader/vert_gles",t),A=h("/analyze_shader/frag_gles",r);else t=t.replace("#version","#version 400 //"),r=r.replace("#version","#version 400 //"),x=h("/analyze_shader/vert",t),A=h("/analyze_shader/frag",r);var w=u(x),z=u(A);p={vsrc:c.get_gl().getShaderSource(q),vsrc_trans:t,vout:x,vstats:w,fsrc:c.get_gl().getShaderSource(p),fsrc_trans:r,fout:A,fstats:z}}else v.error("WEBGL_debug_shaders extension not found"),p=void 0;t=l.shaders_info;q=t.vert+" + "+t.frag;p.cshader=
l;p.shaders_info=t;l=m[q]=m[q]||[];l.push(p);v.log_raw(g)}for(q in m)v.group("%c"+q,"color: #800"),l=m[q],b(l),v.groupEnd()};a.fake_load=c.fake_load;a.test_performance=function(b){if(d.check_shaders_loaded())if(k.get_disjoint_timer_query()){var e=g.gl_debug;g.gl_debug=!0;var f=D.create_performance_graph();y.generate_auxiliary_batches(null,f);for(var h=D.find_subs(f,t.PERFORMANCE),m=h.camera,f=0;5>f;f++)z.draw(h);g.gl_debug=e;window.setTimeout(function(){c.process_timer_queries(h);var a=h.debug_render_time,
d=m.width*m.height*40/(a/1E3)/Math.pow(10,9);b(a,d)},100)}else b(0,0);else window.setTimeout(function(){a.test_performance(b)},100)};a.calc_vbo_garbage_byte_size=c.calc_vbo_garbage_byte_size;a.show_vbo_garbage_info=c.show_vbo_garbage_info;a.start_debug=function(a){H=[];ba=!0;a=r(a);for(var b in a)"function"===typeof a[b]&&(a[b]=l(a[b],b))};a.check_debug_result=function(){return ba};a.test=function(a,b){try{return b(),!0}catch(c){return ba=!1,console.error(a+" test was failed. ",c),!1}};a.pix=function(a){var b=
B.get_viewport_width(),c=B.get_viewport_height(),d=b/2,e=c/2;B.resize(b,c,!1);b=y.get_active()._render.graph;(c=D.find_on_screen(b))||M.panic("Couldn't find onscreen subscene");b=c.camera;d=B.canvas_to_viewport_coords(d,e,L,c.camera);d[1]=b.height-d[1];d=z.read_pixels(b.framebuffer,d[0],d[1]);q(a,d,1)};a.eqs=function(a,b){if(JSON.stringify(a)!=JSON.stringify(b))throw"Wrong result. Function: "+G;};a.eqv=q;a.eqf=function(a,b,c){if("number"!=typeof b)throw"Wrong expected data type.";c=c?c:1E-6;if(b>
a+c||b<a-c)throw"Wrong result.";};a.eq=function(a,b){if(a!==b)throw"Wrong result.";};a.stat=function(a){a=r(a);for(var b in a)-1==H.indexOf(a[b])&&console.warn(b+" function wasn't called.")};a.ok=function(a){if(!Boolean(a))throw"Wrong result. Function: "+G;}};b4w.module.geometry=function(a,r){var u=r("__batch"),h=r("__geometry"),b=r("__print"),f=r("__renderer"),l=r("__util");a.extract_vertex_array=function(a,e,f){if(!h.has_dyn_geom(a))return b.error("Wrong object:",a.name),null;if(a=u.find_batch_material(a,e,"MAIN")){if((e=a.bufs_data)&&e.pointers&&e.pointers[f])return h.extract_array(e,f);b.error("Attribute not found:"+f);return null}b.error("Wrong material:",e);return null};a.extract_index_array=function(a,e){if(!h.has_dyn_geom(a))return b.error("Wrong object:",
a.name),null;var f=u.find_batch_material(a,e,"MAIN");if(f){if((f=f.bufs_data)&&f.pointers)return f.ibo_array;b.error("Buffer data not found");return null}b.error("Wrong material:",e);return null};a.update_vertex_array=function(a,e,f,l){if(h.has_dyn_geom(a)){var r=h.get_vbo_type_by_attr_name(f),r=h.get_constructor_by_type(r);if(r!=l.constructor)b.error("Wrong input array type '"+l.constructor.name+"' for the given attribute. Should be '"+r.name+"'.");else for(var r=["MAIN","SHADOW","COLOR_ID"],c=0;c<
r.length;c++){var k=u.find_batch_material(a,e,r[c]);k&&(k=k.bufs_data)&&k.pointers&&k.pointers[f]&&h.update_bufs_data_array(k,f,0,l)}}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,e,n,p,r){if(h.has_dyn_geom(a))if(n instanceof Uint16Array||n instanceof Uint32Array)if(p instanceof Float32Array)for(var c=["MAIN","SHADOW","COLOR_ID"],k=0;k<c.length;k++){var m=c[k],A=u.find_batch_material(a,e,m);if(A){var E=A.bufs_data;if(E){h.update_bufs_data_index_array(E,A.draw_mode,n);var w=
{},v;for(v in E.pointers){var z=E.pointers[v],z=p.length/3*z.num_comp,m=h.get_vbo_type_by_attr_name(v);w[m]||(w[m]=0);w[m]+=z}m=h.init_vbo_source_data(w);E.vbo_source_data=m;w={};for(v in E.pointers)switch(z=E.pointers[v],m=h.get_vbo_type_by_attr_name(v),w[m]||(w[m]=0),v){case "a_position":h.vbo_source_data_set_attr(E.vbo_source_data,"a_position",p,w[m]);z.offset=w[m];z.length=p.length;w[m]+=z.length;break;case "a_tbn_quat":var y;r&&(y=h.calc_shared_indices(n,p,p));var D=h.calc_normals(n,p,y);z.length=
p.length/3*z.num_comp;for(var K=new Float32Array(z.length),d=0;d<K.length;d+=4)K[d]=1,K[d+3]=1;D=l.gen_tbn_quats(D,K);h.vbo_source_data_set_attr(E.vbo_source_data,"a_tbn_quat",D,w[m]);z.offset=w[m];w[m]+=z.length;break;default:z.offset=w[m],z.length=p.length/3*z.num_comp,D=new (h.get_constructor_by_type(m))(z.length),h.vbo_source_data_set_attr(E.vbo_source_data,v,D,w[m]),w[m]+=z.length}h.update_gl_buffers(E);f.assign_attribute_setters(A);(A=u.find_batch_material_forked(a,A))&&A.bufs_data&&(A.bufs_data=
E)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,e,f){h.check_shape_keys(a)?h.has_shape_key(a,e)?(f=parseFloat(f),h.apply_shape_key(a,e,f)):b.error("Wrong key name:",e):b.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return h.check_shape_keys(a)};a.get_shape_keys_names=function(a){return h.check_shape_keys(a)?h.get_shape_keys_names(a):(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=
function(a,e){return h.check_shape_keys(a)?h.has_shape_key(a,e)?h.get_shape_key_value(a,e):(b.error("Wrong key name:",e),null):(b.error("Wrong object:",a.name),null)};a.draw_line=function(a,e,l){l=l||!1;if(e instanceof Float32Array){if(a=u.get_first_batch(a))h.draw_line(a,e,l),f.assign_attribute_setters(a)}else b.error("Wrong positions type")}};b4w.module.hud=function(a,r){var u=r("__hud");r("__print");a.draw_mixer_strip=u.draw_mixer_strip;a.plot_array=u.plot_array};b4w.module.input=function(a,r){function u(a){var d=b.get_device_by_type_element(b.DEVICE_HMD);if(!d||!d.registered)return!1;if(m)return!0;var h=b.get_vector_param(d,b.HMD_FOV_LEFT,c),l=b.get_vector_param(d,b.HMD_FOV_RIGHT,k);f.set_hmd_fov(a,h,l);if(h=b.get_value_param(d,w))l=p.get_active(),a=e.get_scene_data(a,l).cameras,f.set_eye_distance(a,h);a={base_line_factor:.5,inter_lens_factor:.5,enable_hmd_stereo:!0};b.get_value_param(b.HMD_WEBVR_TYPE)!==b.HMD_WEBVR1&&(a.distortion_coefs=[d.distortion_coefs[0],
d.distortion_coefs[1]],a.chromatic_aberration_coefs=[d.chromatic_aberration_coefs[0],d.chromatic_aberration_coefs[1],d.chromatic_aberration_coefs[2],d.chromatic_aberration_coefs[3]],d.webvr_hmd_device||(d.base_line_dist&&d.height_dist&&d.bevel_size?a.base_line_factor=(d.base_line_dist-d.bevel_size)/d.height_dist:d.bevel_size||(a.base_line_factor=d.base_line_dist/d.height_dist)),d.inter_lens_dist&&d.width_dist&&!d.webvr_hmd_device&&(a.inter_lens_factor=d.inter_lens_dist/d.width_dist),A.enabled||(h=
1+d.distortion_coefs[0]+d.distortion_coefs[1],p.multiply_size_mult(h,h)));p.set_hmd_params(a);q.resize_to_container(!0);b.reset_device(d);return m=!0}function h(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=[],c=0;c<a.length;c++)a[c]&&b.push(c);return b}var b=r("__input"),f=r("__camera"),l=r("__config"),q=r("__container"),e=r("__obj_util"),n=r("__print"),p=r("__scenes"),B=r("__vec4"),c=B.create(),k=B.create(),m=!1,A=l.debug_subs,
E=l.defaults;a.GMPD_BUTTON_12=b.GMPD_BUTTON_12;a.GMPD_BUTTON_13=b.GMPD_BUTTON_13;a.GMPD_BUTTON_15=b.GMPD_BUTTON_15;a.GMPD_BUTTON_14=b.GMPD_BUTTON_14;a.GMPD_BUTTON_3=b.GMPD_BUTTON_3;a.GMPD_BUTTON_0=b.GMPD_BUTTON_0;a.GMPD_BUTTON_1=b.GMPD_BUTTON_1;a.GMPD_BUTTON_2=b.GMPD_BUTTON_2;a.GMPD_BUTTON_5=b.GMPD_BUTTON_5;a.GMPD_BUTTON_7=b.GMPD_BUTTON_7;a.GMPD_BUTTON_4=b.GMPD_BUTTON_4;a.GMPD_BUTTON_6=b.GMPD_BUTTON_6;a.GMPD_BUTTON_8=b.GMPD_BUTTON_8;a.GMPD_BUTTON_9=b.GMPD_BUTTON_9;a.GMPD_BUTTON_10=b.GMPD_BUTTON_10;
a.GMPD_BUTTON_11=b.GMPD_BUTTON_11;a.GMPD_BUTTON_16=b.GMPD_BUTTON_16;a.GMPD_BUTTON_17=b.GMPD_BUTTON_17;a.GMPD_BUTTON_18=b.GMPD_BUTTON_18;a.GMPD_BUTTON_19=b.GMPD_BUTTON_19;a.GMPD_BUTTON_20=b.GMPD_BUTTON_20;a.GMPD_BUTTON_21=b.GMPD_BUTTON_21;a.GMPD_BUTTON_22=b.GMPD_BUTTON_22;a.GMPD_BUTTON_23=b.GMPD_BUTTON_23;a.GMPD_BUTTON_24=b.GMPD_BUTTON_24;a.GMPD_BUTTON_25=b.GMPD_BUTTON_25;a.GMPD_AXIS_0=b.GMPD_AXIS_0;a.GMPD_AXIS_1=b.GMPD_AXIS_1;a.GMPD_AXIS_2=b.GMPD_AXIS_2;a.GMPD_AXIS_3=b.GMPD_AXIS_3;a.GMPD_AXIS_4=b.GMPD_AXIS_4;
a.GMPD_AXIS_5=b.GMPD_AXIS_5;a.GMPD_AXIS_6=b.GMPD_AXIS_6;a.GMPD_AXIS_7=b.GMPD_AXIS_7;a.GMPD_AXIS_8=b.GMPD_AXIS_8;a.GMPD_AXIS_9=b.GMPD_AXIS_9;a.GMPD_AXIS_10=b.GMPD_AXIS_10;a.GMPD_AXIS_11=b.GMPD_AXIS_11;a.HMD_ORIENTATION_QUAT=b.HMD_ORIENTATION_QUAT;a.HMD_POSITION=b.HMD_POSITION;a.HMD_WEBVR_TYPE=b.HMD_WEBVR_TYPE;a.HMD_WEBVR_DESKTOP=b.HMD_WEBVR_DESKTOP;a.HMD_WEBVR_MOBILE=b.HMD_WEBVR_MOBILE;a.HMD_NON_WEBVR=b.HMD_NON_WEBVR;a.HMD_WEBVR1=b.HMD_WEBVR1;var w=b.HMD_EYE_DISTANCE;a.HMD_EYE_DISTANCE=w;a.HMD_DISTORTION=
b.HMD_DISTORTION;a.HMD_BASELINE_DIST=b.HMD_BASELINE_DIST;a.HMD_SCREEN_LENSE_DIST=b.HMD_SCREEN_LENSE_DIST;a.HMD_SCREEN_WIDTH=b.HMD_SCREEN_WIDTH;a.HMD_SCREEN_HEIGHT=b.HMD_SCREEN_HEIGHT;a.HMD_BEVEL_SIZE=b.HMD_BEVEL_SIZE;a.MOUSE_LOCATION=b.MOUSE_LOCATION;a.MOUSE_DOWN_WHICH=b.MOUSE_DOWN_WHICH;a.MOUSE_UP_WHICH=b.MOUSE_UP_WHICH;a.MOUSE_WHEEL=b.MOUSE_WHEEL;a.KEYBOARD_UP=b.KEYBOARD_UP;a.KEYBOARD_DOWN=b.KEYBOARD_DOWN;a.TOUCH_START=b.TOUCH_START;a.TOUCH_MOVE=b.TOUCH_MOVE;a.TOUCH_END=b.TOUCH_END;a.GYRO_ORIENTATION_QUAT=
b.GYRO_ORIENTATION_QUAT;a.GYRO_ORIENTATION_ANGLES=b.GYRO_ORIENTATION_ANGLES;var v={};v[b.DEVICE_HMD]=[b.HMD_ORIENTATION_QUAT,b.HMD_POSITION];v[b.DEVICE_MOUSE]=[b.MOUSE_LOCATION];var z={};z[b.DEVICE_HMD]=[b.HMD_WEBVR_TYPE];var y={};y[b.DEVICE_MOUSE]=[b.MOUSE_LOCATION,b.MOUSE_DOWN_WHICH,b.MOUSE_UP_WHICH,b.MOUSE_WHEEL];y[b.DEVICE_KEYBOARD]=[b.KEYBOARD_UP,b.KEYBOARD_DOWN];y[b.DEVICE_TOUCH]=[b.TOUCH_START,b.TOUCH_MOVE,b.TOUCH_END];y[b.DEVICE_GYRO]=[b.GYRO_ORIENTATION_QUAT,b.GYRO_ORIENTATION_ANGLES];var D=
{};D[b.DEVICE_HMD]=[b.HMD_DISTORTION,b.HMD_EYE_DISTANCE,b.HMD_BASELINE_DIST,b.HMD_SCREEN_LENSE_DIST,b.HMD_SCREEN_WIDTH,b.HMD_SCREEN_HEIGHT,b.HMD_BEVEL_SIZE];a.DEVICE_GYRO=b.DEVICE_GYRO;a.DEVICE_HMD=b.DEVICE_HMD;a.DEVICE_MOUSE=b.DEVICE_MOUSE;a.DEVICE_KEYBOARD=b.DEVICE_KEYBOARD;a.DEVICE_TOUCH=b.DEVICE_TOUCH;a.can_use_device=b.can_use_device;a.get_device_by_type_element=b.get_device_by_type_element;a.switch_prevent_default=function(a,c){a&&b.switch_prevent_default(a,c)};a.register_device=function(){n.error_once("input.register_device() deprecated")};
a.reset_device=function(a){a&&a.type==b.DEVICE_HMD?b.reset_device(a):n.error("reset_device is undefined for device.")};a.get_vector_param=function(a,c,e){if(a&&a.type in v&&0<=v[a.type].indexOf(c))return b.get_vector_param(a,c,e);n.error("device hasn't param: ",c)};a.get_value_param=function(a,c){if(a&&a.type in z&&0<=z[a.type].indexOf(c))return b.get_value_param(a,c);n.error("device hasn't param: ",c)};a.attach_param_cb=function(a,c,e){e=e||null;if(a&&a.type in y&&0<=y[a.type].indexOf(c))return b.attach_param_cb(a,
c,e);n.error("device hasn't param: ",c)};a.detach_param_cb=function(a,c,e){e=e||null;if(a&&a.type in y&&0<=y[a.type].indexOf(c))return b.detach_param_cb(a,c,e);n.error("device hasn't param: ",c)};a.set_config=function(a,c,e){if(a&&a.type in D&&0<=D[a.type].indexOf(c))return b.set_config(a,c,e);n.error("device hasn't config: ",c)};a.request_fullscreen_hmd=function(){if(p.check_active()){var a=p.get_camera(p.get_active());if(a&&(u(a),a=b.get_device_by_type_element(b.DEVICE_HMD))){var c=a.webvr_display;
c&&!c.isPresenting&&(c.capabilities.canPresent?(a=q.get_canvas(),c.requestPresent([{source:a}]).then(function(){if(!E.is_mobile_device){var a=c.getEyeParameters("left"),b=c.getEyeParameters("right");q.resize(2*Math.max(a.renderWidth,b.renderWidth),Math.max(a.renderHeight,b.renderHeight),!1)}},function(){n.error("HMD fullscreen request failed.")})):n.error("HMD fullscreen request failed."))}}};a.enable_split_screen=u;a.disable_split_screen=function(){var a=b.get_device_by_type_element(b.DEVICE_HMD);
if(!(m||a&&a.registered))return!1;p.set_hmd_params({enable_hmd_stereo:!1});a=1/(1+a.distortion_coefs[0]+a.distortion_coefs[1]);p.multiply_size_mult(a,a);q.resize_to_container(!0);return!0};a.set_gamepad_key=function(a,c,e){h();switch(a){case 0:a=b.DEVICE_GAMEPAD0;break;case 1:a=b.DEVICE_GAMEPAD1;break;case 2:a=b.DEVICE_GAMEPAD2;break;case 3:a=b.DEVICE_GAMEPAD3;break;default:a=b.DEVICE_GAMEPAD0}a=b.get_device_by_type_element(a);b.set_config(a,c,e)};a.get_pressed_gmpd_btn=b.get_pressed_gmpd_btn;a.get_moved_gmpd_axis=
b.get_moved_gmpd_axis;a.check_enable_gamepad_indices=h};b4w.module.lights=function(a,r){function u(a){for(var h=e.get_active(),m=f.get_scene_objs(h,"LAMP",f.DATA_ID_ALL),l=0;l<m.length;l++){var r=m[l];if("SUN"==r.light.type){var d=r;break}}if(!d)q.error("There is no sun on the scene");else if("number"==typeof a.hor_position&&"number"==typeof a.vert_position){m=B.deg_to_rad(180-a.hor_position);a=B.deg_to_rad(90-a.vert_position);l=d.render;n.set_rotation_euler(d,[a,0,m]);m=new Float32Array(3);r=p.get_quat_view(l.world_tsr);B.quat_to_dir(r,B.AXIS_Z,m);l=
p.get_trans_view(l.world_tsr);l=c.length(l);c.copy(m,k);c.scale(k,l,k);n.set_translation(d,k);n.update_transform(d);m=d.light;if(m.dynamic_intensity){var t=h.world.light_settings.environment_energy,l=h.world.horizon_color,r=h.world.zenith_color,u=Math.cos(Math.abs(a));a=Math.max(Math.min(3*u,1),0)*m.default_energy;t*=Math.max(u,.1);b.set_light_energy(m,a);e.set_environment_colors(h,t,l,r)}e.update_lamp_scene(d,h)}}function h(a){if(l.is_lamp(a))return a.light.type;q.error("get_light_type(): Wrong object");
return!1}var b=r("__lights"),f=r("__objects"),l=r("__obj_util"),q=r("__print"),e=r("__scenes"),n=r("__transform"),p=r("__tsr"),B=r("__util"),c=r("__vec3"),k=new Float32Array(3),m,A,E,w=60;a.get_lamps=function(a){var b=e.get_active(),b=f.get_scene_objs(b,"LAMP",f.DATA_ID_ALL);if(!a)return b;for(var c=[],k=0;k<b.length;k++){var h=b[k];h.light.type===a&&c.push(h)}return c};a.get_sun_params=function(){for(var a=e.get_active(),a=f.get_scene_objs(a,"LAMP",f.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var k=
a[c];if("SUN"==k.light.type){b=k;break}}return b?(b=b.light.direction,a=B.rad_to_deg(Math.atan2(-b[1],b[0]))+90,180<a&&(a-=360),b=B.rad_to_deg(Math.atan2(b[2],Math.sqrt(b[0]*b[0]+b[1]*b[1]))),c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=u;a.set_day_time=function(a){for(var b=e.get_active(),b=f.get_scene_objs(b,"LAMP",f.DATA_ID_ALL),c=0;c<b.length;c++){var k=b[c];if("SUN"==k.light.type){var h=k;break}}h?(h=12>a?15*a:15*(a-24),a=-Math.cos(a/12*Math.PI)*w,b={},b.hor_position=h,b.vert_position=
a,u(b)):q.error("There is no sun on the scene")};a.set_date=function(a){m=a.getDate();A=a.getMonth();E=a.getFullYear();if(m)if(1582==m&&10==a.m&&4<a.d&&15>a.d)q.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!");else{a=m;var b=A,c=E,e,f;2<b?(e=a,f=b+1):(e=a-1,f=b+13);f=Math.floor(Math.floor(365.25*e)+Math.floor(30.6001*f)+c+1720995);588829<=c+31*(b+12*a)&&(a=Math.floor(.01*e),f+=2-a+Math.floor(.25*a));a=1E5*f;b=Math.floor(a);.5<a-b&&++b}else q.error("There is no year 0 in the Julian system!")};
a.set_max_sun_angle=function(a){w=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(l.is_lamp(a))var b=a.light;else return q.error("get_light_params(): Wrong object"),null;if(a=h(a))switch(a){case "SPOT":var c={light_type:a,light_color:new Float32Array(3),light_energy:b.energy,light_spot_blend:b.spot_blend,light_spot_size:b.spot_size,light_distance:b.distance};c.light_color.set(b.color);break;case "POINT":c={light_type:a,light_color:new Float32Array(3),light_energy:b.energy,light_distance:b.distance};
c.light_color.set(b.color);break;default:c={light_type:a,light_color:new Float32Array(3),light_energy:b.energy},c.light_color.set(b.color)}return c?c:null};a.get_light_type=h;a.set_light_params=function(a,c){if(l.is_lamp(a)){var f=a.light,k=e.get_active(),h=!1;"number"==typeof c.light_energy&&b.set_light_energy(f,c.light_energy);"object"==typeof c.light_color&&b.set_light_color(f,c.light_color);"number"==typeof c.light_spot_blend&&(b.set_light_spot_blend(f,c.light_spot_blend),h=!0);"number"==typeof c.light_spot_size&&
(b.set_light_spot_size(f,c.light_spot_size),h=!0);"number"==typeof c.light_distance&&(b.set_light_distance(f,c.light_distance),h=!0);e.update_lamp_scene(a,k);h&&e.update_all_mesh_shaders(k)}else q.error("set_light_params(): Wrong object")};a.get_light_energy=function(a){return l.is_lamp(a)?a.light.energy:(q.error("get_light_energy(): Wrong object"),0)};a.set_light_energy=function(a,c){if(l.is_lamp(a)){var f=e.get_active();b.set_light_energy(a.light,c);e.update_lamp_scene(a,f)}else q.error("set_light_energy(): Wrong object")};
a.get_light_color=function(a,b){if(!l.is_lamp(a))return q.error("get_light_color(): Wrong object"),null;b=b||new Float32Array(3);b.set(a.light.color);return b};a.set_light_color=function(a,c){if(l.is_lamp(a)){var f=e.get_active();b.set_light_color(a.light,c);e.update_lamp_scene(a,f)}else q.error("set_light_color(): Wrong object")}};b4w.module.logic_nodes=function(a,r){var u=r("__logic_nodes");a.append_custom_callback=function(a,b){u.append_custom_cb(a,b)};a.remove_custom_callback=function(a){u.remove_custom_cb(a)};a.run_entrypoint=function(a,b){u.run_ep(a,b)}};b4w.module.material=function(a,r){function u(a,b){for(var c=a.scenes_data[0].batches,e=0;e<c.length;e++){var f=c[e];if(-1<f.material_names.indexOf(b)&&"MAIN"==f.type)return!0}return!1}function h(a,b){var c=f.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[0])}function b(a,b){var c=f.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[1])}var f=r("__batch"),l=r("__config"),q=r("__obj_util"),e=r("__print"),n=r("__shaders"),p=r("__util"),B=r("__scenes"),c=l.defaults;
a.inherit_material=function(a,b,c,h){q.is_dynamic_mesh(c)&&q.is_dynamic_mesh(a)?f.inherit_material(a,b,c,h):e.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.scenes_data;for(var c=0;c<a.length;c++)for(var e=a[c].batches,f=0;f<e.length;f++)for(var h=0;h<e[f].material_names.length;h++)-1==b.indexOf(e[f].material_names[h])&&b.push(e[f].material_names[h]);return b};a.set_diffuse_color=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");h?(h.diffuse_color.set(c),
(a=f.find_batch_material_forked(a,b,"MAIN"))&&a.diffuse_color.set(c)):e.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c){var h=new Float32Array(4);h.set(c.diffuse_color);return h}e.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");if(h){if(h.diffuse_intensity=c,a=f.find_batch_material_forked(a,b,"MAIN"))a.diffuse_intensity=c}else e.error('Couldn\'t set property "diffuse_color"!')};
a.get_diffuse_intensity=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_intensity;e.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");h?(h.specular_color.set(c),(a=f.find_batch_material_forked(a,b,"MAIN"))&&a.specular_color.set(c)):e.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c){var h=Array(3);h[0]=c.specular_color[0];
h[1]=c.specular_color[1];h[2]=c.specular_color[2];return h}e.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");if(h){if(h.specular_color_factor=c,a=f.find_batch_material_forked(a,b,"MAIN"))a.specular_color_factor=c}else e.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c)return c.specular_color_factor;e.error('Couldn\'t get property "specular_color_factor"!')};
a.set_specular_intensity=function(a,b,c){h(a,b)||e.error('Property "specular_intensity" is missing!');f.find_batch_material(a,b,"MAIN").specular_params[0]=c;(a=f.find_batch_material_forked(a,b,"MAIN"))&&(a.specular_params[0]=c)};a.get_specular_intensity=function(a,b){h(a,b)||e.error('Property "specular_intensity" is missing!');return f.find_batch_material(a,b,"MAIN").specular_params[0]};a.check_specular_intensity=h;a.set_specular_hardness=function(a,c,h){b(a,c)||e.error('Property "specular_hardness" is missing!');
f.find_batch_material(a,c,"MAIN").specular_params[1]=h;(a=f.find_batch_material_forked(a,c,"MAIN"))&&(a.specular_params[1]=h)};a.get_specular_hardness=function(a,c){b(a,c)||e.error('Property "specular_hardness" is missing!');return f.find_batch_material(a,c,"MAIN").specular_params[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");if(h){if(h.emit=c,a=f.find_batch_material_forked(a,b,"MAIN"))a.emit=c}else e.error('Couldn\'t set property "emit_factor"!')};
a.get_emit_factor=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c)return c.emit;e.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");if(h){if(h.ambient=c,a=f.find_batch_material_forked(a,b,"MAIN"))a.ambient=c}else e.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c)return c.ambient;e.error('Couldn\'t get property "ambient_factor"!')};
a.set_diffuse_color_factor=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");if(h){if(h.diffuse_color_factor=c,a=f.find_batch_material_forked(a,b,"MAIN"))a.diffuse_color_factor=c}else e.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_color_factor;e.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var h=f.find_batch_material(a,b,"MAIN");if(h){if(h.alpha_factor=
c,a=f.find_batch_material_forked(a,b,"MAIN"))a.alpha_factor=c}else e.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=f.find_batch_material(a,b,"MAIN");if(c)return c.alpha_factor;e.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return e.error("missing arguments in get_material_params"),null;if(!u(a,b))return null;var c=f.find_batch_material(a,b,"MAIN");if(!c)return null;var h={};"MAIN"==c.type&&(h.reflect_factor=
c.reflect_factor,h.fresnel=c.fresnel_params[2],h.fresnel_factor=5*(1-c.fresnel_params[3]),h.parallax_scale=c.parallax_scale,h.parallax_steps=f.get_batch_directive(c,"PARALLAX_STEPS")[1]);return h};a.get_water_material_params=function(a,b){if(!a||!b)return e.error("missing arguments in get_water_material_params"),null;if(!u(a,b))return null;var h=f.find_batch_material(a,b,"MAIN");if(!h||!h.water)return null;if(!h)return e.error("material not found"),null;var l={};if("MAIN"==h.type){if(c.shore_distance){var n=
l.shallow_water_col=Array(3);n[0]=h.shallow_water_col[0];n[1]=h.shallow_water_col[1];n[2]=h.shallow_water_col[2];n=l.shore_water_col=Array(3);n[0]=h.shore_water_col[0];n[1]=h.shore_water_col[1];n[2]=h.shore_water_col[2];l.shallow_water_col_fac=h.shallow_water_col_fac;l.shore_water_col_fac=h.shore_water_col_fac}l.foam_factor=h.foam_factor;l.norm_uv_velocity=h.water_norm_uv_velocity;l.absorb_factor=f.get_batch_directive(h,"ABSORB")[1];l.sss_strength=f.get_batch_directive(h,"SSS_STRENGTH")[1];l.sss_width=
f.get_batch_directive(h,"SSS_WIDTH")[1];l.dst_noise_scale0=f.get_batch_directive(h,"DST_NOISE_SCALE_0")[1];l.dst_noise_scale1=f.get_batch_directive(h,"DST_NOISE_SCALE_1")[1];l.dst_noise_freq0=f.get_batch_directive(h,"DST_NOISE_FREQ_0")[1];l.dst_noise_freq1=f.get_batch_directive(h,"DST_NOISE_FREQ_1")[1];l.dir_min_shore_fac=f.get_batch_directive(h,"DIR_MIN_SHR_FAC")[1];l.dir_freq=f.get_batch_directive(h,"DIR_FREQ")[1];l.dir_noise_scale=f.get_batch_directive(h,"DIR_NOISE_SCALE")[1];l.dir_noise_freq=
f.get_batch_directive(h,"DIR_NOISE_FREQ")[1];l.dir_min_noise_fac=f.get_batch_directive(h,"DIR_MIN_NOISE_FAC")[1];l.dst_min_fac=f.get_batch_directive(h,"DST_MIN_FAC")[1];l.waves_hor_fac=f.get_batch_directive(h,"WAVES_HOR_FAC")[1]}return l};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(u(a,b)){var h=f.find_batch_material(a,b,"MAIN");if(h){var l=[h];(h=f.find_batch_material_forked(a,b,"MAIN"))&&l.push(h);for(a=0;a<l.length;a++)h=l[a],"number"==typeof c.material_reflectivity&&(h.reflect_factor=
c.material_reflectivity),"number"==typeof c.material_fresnel&&(h.fresnel_params[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(h.fresnel_params[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(h.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=n.glsl_value(parseFloat(c.material_parallax_steps)),f.set_batch_directive(h,"PARALLAX_STEPS",b),f.update_shader(h),B.recalculate_draw_data(h))}else e.error("material not found")}else e.error("setting material params is not possible");
else e.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,h){if(a&&b&&h)if(u(a,b)){var l=f.find_batch_material(a,b,"MAIN");if(l){var p=[l];(l=f.find_batch_material_forked(a,b,"MAIN"))&&p.push(l);for(a=0;a<p.length;a++)l=p[a],c.shore_distance&&("object"==typeof h.shallow_water_col&&l.shallow_water_col.set(h.shallow_water_col),"number"==typeof h.shallow_water_col_fac&&(l.shallow_water_col_fac=h.shallow_water_col_fac),"object"==typeof h.shore_water_col&&l.shore_water_col.set(h.shore_water_col),
"number"==typeof h.shore_water_col_fac&&(l.shore_water_col_fac=h.shore_water_col_fac)),c.shore_smoothing&&l.water_shore_smoothing&&("boolean"==typeof h.shore_smoothing&&(h.shore_smoothing?f.set_batch_directive(l,"SHORE_SMOOTHING",1):f.set_batch_directive(l,"SHORE_SMOOTHING",0)),"number"==typeof h.absorb_factor&&(b=n.glsl_value(parseFloat(h.absorb_factor)),f.set_batch_directive(l,"ABSORB",b))),"number"==typeof h.foam_factor&&c.foam&&(l.foam_factor=h.foam_factor),"number"==typeof h.norm_uv_velocity&&
(l.water_norm_uv_velocity=h.norm_uv_velocity),c.water_dynamic&&l.water_dynamic&&("boolean"==typeof h.water_dynamic&&(h.water_dynamic?f.set_batch_directive(l,"DYNAMIC",1):f.set_batch_directive(l,"DYNAMIC",0)),"number"==typeof h.waves_height&&(b=n.glsl_value(parseFloat(h.waves_height)),f.set_batch_directive(l,"WAVES_HEIGHT",b)),"number"==typeof h.waves_length&&(b=n.glsl_value(parseFloat(h.waves_length)),f.set_batch_directive(l,"WAVES_LENGTH",b)),"number"==typeof h.sss_strength&&(b=n.glsl_value(parseFloat(h.sss_strength)),
f.set_batch_directive(l,"SSS_STRENGTH",b)),"number"==typeof h.sss_width&&(b=n.glsl_value(parseFloat(h.sss_width)),f.set_batch_directive(l,"SSS_WIDTH",b)),"number"==typeof h.dst_noise_scale0&&(b=n.glsl_value(parseFloat(h.dst_noise_scale0)),f.set_batch_directive(l,"DST_NOISE_SCALE_0",b)),"number"==typeof h.dst_noise_scale1&&(b=n.glsl_value(parseFloat(h.dst_noise_scale1)),f.set_batch_directive(l,"DST_NOISE_SCALE_1",b)),"number"==typeof h.dst_noise_freq0&&(b=n.glsl_value(parseFloat(h.dst_noise_freq0)),
f.set_batch_directive(l,"DST_NOISE_FREQ_0",b)),"number"==typeof h.dst_noise_freq1&&(b=n.glsl_value(parseFloat(h.dst_noise_freq1)),f.set_batch_directive(l,"DST_NOISE_FREQ_1",b)),"number"==typeof h.dir_min_shore_fac&&(b=n.glsl_value(parseFloat(h.dir_min_shore_fac)),f.set_batch_directive(l,"DIR_MIN_SHR_FAC",b)),"number"==typeof h.dir_freq&&(b=n.glsl_value(parseFloat(h.dir_freq)),f.set_batch_directive(l,"DIR_FREQ",b)),"number"==typeof h.dir_noise_scale&&(b=n.glsl_value(parseFloat(h.dir_noise_scale)),
f.set_batch_directive(l,"DIR_NOISE_SCALE",b)),"number"==typeof h.dir_noise_freq&&(b=n.glsl_value(parseFloat(h.dir_noise_freq)),f.set_batch_directive(l,"DIR_NOISE_FREQ",b)),"number"==typeof h.dir_min_noise_fac&&(b=n.glsl_value(parseFloat(h.dir_min_noise_fac)),f.set_batch_directive(l,"DIR_MIN_NOISE_FAC",b)),"number"==typeof h.dst_min_fac&&(b=n.glsl_value(parseFloat(h.dst_min_fac)),f.set_batch_directive(l,"DST_MIN_FAC",b)),"number"==typeof h.waves_hor_fac&&(b=n.glsl_value(parseFloat(h.waves_hor_fac)),
f.set_batch_directive(l,"WAVES_HOR_FAC",b))),f.update_shader(l),B.recalculate_draw_data(l)}else e.error("material not found")}else e.error("setting water material params is not possible");else e.error("missing arguments in set_water_material_params")};a.set_line_params=function(a,b){var c=f.get_first_batch(a);c?(p.isdef(b.color)&&c.diffuse_color.set(b.color),p.isdef(b.width)&&(c.line_width=b.width)):e.error("Couldn't set line params!")};a.get_line_params=function(a){if(a=f.get_first_batch(a))return{color:new Float32Array(a.diffuse_color),
width:a.line_width};e.error("Couldn't get line params");return null};a.set_nodemat_value=function(a,b,c){if(q.is_dynamic_mesh(a)){var h=b[0],l=f.find_batch_material(a,h,"MAIN");if(null===l)return e.error('Material "'+h+'" was not found in the object "'+a.name+'".'),null;l=f.get_node_ind_by_name_list(l.node_value_inds,b);if(null===l)return e.error('Value node "'+b[b.length-1]+'" was not found in the object "'+a.name+'".'),null;f.set_nodemat_value(a,h,l,c)}else e.error('The type of the object "'+a.name+
'" is not "MESH" or it is not dynamic.')};a.get_nodemat_value=function(a,b){if(!q.is_dynamic_mesh(a))return e.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.'),null;var c=b[0],h=f.find_batch_material(a,c,"MAIN");if(null===h)return e.error('Material "'+c+'" was not found in the object "'+a.name+'".'),null;c=f.get_node_ind_by_name_list(h.node_value_inds,b);return null===c?(e.error('Value node "'+b[b.length-1]+'" was not found in the object "'+a.name+'".'),null):f.get_nodemat_value(h,
c)};a.set_nodemat_rgb=function(a,b,c,h,l){if(q.is_dynamic_mesh(a)){var n=b[0],p=f.find_batch_material(a,n,"MAIN");null===p?e.error('Material "'+n+'" was not found in the object "'+a.name+'".'):(p=f.get_node_ind_by_name_list(p.node_rgb_inds,b),null===p?e.error('RGB node "'+b[b.length-1]+'" was not found in the object "'+a.name+'".'):f.set_nodemat_rgb(a,n,p,c,h,l))}else e.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.')};a.get_nodemat_rgb=function(a,b,c){if(!q.is_dynamic_mesh(a))return e.error('The type of the object "'+
a.name+'" is not "MESH" or it is not dynamic.'),null;var h=b[0],l=f.find_batch_material(a,h,"MAIN");if(null===l)return e.error('Material "'+h+'" was not found in the object "'+a.name+'".'),null;h=f.get_node_ind_by_name_list(l.node_rgb_inds,b);if(null===h)return e.error('RGB node "'+b[b.length-1]+'" was not found in the object "'+a.name+'".'),null;c||(c=new Float32Array(3));return f.get_nodemat_rgb(l,h,c)}};b4w.module.math=function(a,r){var u=r("__vec3"),h=r("__util"),b=r("__math"),f=new Float32Array(3);a.create_pline_from_points=function(a,h){var e=new Float32Array(6);b.set_pline_initial_point(e,a);u.subtract(h,a,f);b.set_pline_directional_vec(e,f);return e};a.create_pline_from_point_vec=function(a,f){var e=new Float32Array(6);b.set_pline_initial_point(e,point1);b.set_pline_directional_vec(e,f);return e};a.create_pline=function(){return new Float32Array(6)};a.get_pline_directional_vec=b.get_pline_directional_vec;
a.get_pline_initial_point=b.get_pline_initial_point;a.set_pline_initial_point=b.set_pline_initial_point;a.set_pline_directional_vec=b.set_pline_directional_vec;a.line_plane_intersect=h.line_plane_intersect;a.calc_pline_point=b.calc_pline_point;a.point_plane_dist=b.point_plane_dist};b4w.module.particles=function(a,r){var u=r("__particles"),h=r("__print");a.set_size=function(a,f,l){u.obj_has_particles(a)?u.set_size(a,f,l):h.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,f,l){u.obj_has_particles(a)?u.set_normal_factor(a,f,l):h.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,f,l){u.obj_has_particles(a)?(l=Math.min(l,1),l=Math.max(l,0),u.set_factor(a,f,l)):h.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,r){function u(a,b,f,h,c){return l.dist_to_triange(a,h[f[0]],h[f[1]],h[f[2]])}function h(a,b,f,h,c){b=Math.abs(a[2]-b[2]);return b<c&&q.is_vector_in_poly(a,f,h)?b:Number.MAX_VALUE}r("__config");var b=r("__physics"),f=r("__print"),l=r("__util"),q=r("__navmesh");r("__vec3");new Float32Array(3);a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.obj_has_physics(a)?b.enable_simulation(a):f.error("No physics for object "+a.name)};a.disable_simulation=
function(a){b.obj_has_physics(a)?b.disable_simulation(a):f.error("No physics for object "+a.name)};a.has_physics=function(a){return b.obj_has_physics(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,h){b.obj_has_physics(a)?b.set_gravity(a,h):f.error("No physics for object "+a.name)};a.set_transform=function(a,h,l){b.obj_has_physics(a)?b.set_transform(a,h,l):f.error("No physics for object "+
a.name)};a.sync_transform=function(a){b.obj_has_physics(a)?b.sync_transform(a):f.error("No physics for object "+a.name)};a.apply_velocity=function(a,h,l,q){b.obj_has_physics(a)?b.apply_velocity(a,h,l,q):f.error("No physics for object "+a.name)};a.apply_velocity_world=function(a,h,l,q){b.obj_has_physics(a)?b.apply_velocity_world(a,h,l,q):f.error("No physics for object "+a.name)};a.apply_force=function(a,h,l,q){b.obj_has_physics(a)?b.apply_force(a,h,l,q,!1):f.error("No physics for object "+a.name)};
a.apply_force_world=function(a,h,l,q){b.obj_has_physics(a)?b.apply_force(a,h,l,q,!0):f.error("No physics for object "+a.name)};a.apply_torque=function(a,h,l,q){b.obj_has_physics(a)?b.apply_torque(a,h,l,q):f.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,h){b.obj_has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||f.error("Wrong object"),b.vehicle_throttle(a,l.clamp(h,-1,1))):f.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,h,p){if(b.obj_has_physics(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||f.error("Wrong object");h=l.clamp(h,0,1);var q=a.vehicle.engine_force;-1==p||1==p?q=Math.max(-1,Math.min(q+p*h,1)):0==p&&0<=q?(q-=h,q=Math.max(0,q)):0==p&&0>q?(q+=h,q=Math.min(0,q)):f.error("Wrong steering direction");b.vehicle_throttle(a,l.clamp(q,-1,1))}else f.error("No physics for object "+a.name)};a.vehicle_steer=function(a,h){b.obj_has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||f.error("Wrong object"),b.vehicle_steer(a,l.clamp(h,-1,1))):f.error("No physics for object "+
a.name)};a.vehicle_steer_inc=function(a,h,p){if(b.obj_has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||f.error("Wrong object");h=l.clamp(h,0,1);var q=a.vehicle.steering;-1==p||1==p?q=Math.max(-1,Math.min(q+p*h,1)):0==p&&0<=q?(q-=h,q=Math.max(0,q)):0==p&&0>q?(q+=h,q=Math.min(0,q)):f.error("Wrong steering direction");b.vehicle_steer(a,l.clamp(q,-1,1))}else f.error("No physics for object "+a.name)};a.vehicle_brake=function(a,h){b.obj_has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||
f.error("Wrong object"),b.vehicle_brake(a,l.clamp(h,0,1))):f.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,h){if(b.obj_has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||f.error("Wrong object");h=l.clamp(h,-1,1);var p=a.vehicle.brake_force;b.vehicle_brake(a,l.clamp(p+p*h,0,1))}else f.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=
function(a){if(!b.obj_has_physics(a))return f.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.vehicle_settings.name;f.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.obj_has_physics(a))return f.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.vehicle.engine_force;f.error("Wrong object");return null};a.get_vehicle_steering=function(a){if(!b.obj_has_physics(a))return f.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.vehicle.steering;f.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.obj_has_physics(a))return f.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.vehicle.brake_force;f.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.obj_has_physics(a))return f.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);
f.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,h,l){b.obj_has_physics(a)?b.set_character_move_dir(a,h,l):f.error("No physics for object "+a.name)};a.set_character_move_type=function(a,h){b.obj_has_physics(a)?b.set_character_move_type(a,h):f.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,h){b.obj_has_physics(a)?b.set_character_walk_velocity(a,h):f.error("No physics for object "+a.name)};a.set_character_run_velocity=
function(a,h){b.obj_has_physics(a)?b.set_character_run_velocity(a,h):f.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,h){b.obj_has_physics(a)?b.set_character_fly_velocity(a,h):f.error("No physics for object "+a.name)};a.character_jump=function(a){b.obj_has_physics(a)?b.character_jump(a):f.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,h,l){b.obj_has_physics(a)?b.character_rotation_inc(a,h,l):f.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,h,l){b.obj_has_physics(a)?b.set_character_rotation(a,h,l):f.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,h){b.obj_has_physics(a)?b.set_character_rotation_v(a,h):f.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,h){b.obj_has_physics(a)?b.set_character_rotation_h(a,h):f.error("No physics for object "+a.name)};a.append_collision_test=function(a,h,l,q){b.obj_has_physics(a)?b.append_collision_test(a,h,l,q||!1):f.error("No physics for object "+
a.name)};a.remove_collision_test=function(a,h,l){b.obj_has_physics(a)?b.remove_collision_test(a,h||"ANY",l):f.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,h){b.obj_has_physics(a)?b.apply_collision_impulse_test(a,h):f.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.obj_has_physics(a)?b.clear_collision_impulse_test(a):f.error("No physics for object "+a.name)};a.append_ray_test=function(a,h,l,q,c,k){a=a||null;if(null==a||b.obj_has_physics(a))return b.append_ray_test(a,
h,l,q,c,k||!1,!1,!1,!1);f.error("No physics for object "+a.name)};a.append_ray_test_ext=function(a,h,l,q,c,k,m,r,u){a=a||null;if(null==a||b.obj_has_physics(a))return b.append_ray_test(a,h,l,q,c,k||!1,m||!1,r||!1,u||!1);f.error("No physics for object "+a.name)};a.remove_ray_test=function(a){b.is_ray_test(a)?b.remove_ray_test(a):f.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,h,l){b.is_ray_test(a)?b.change_ray_test_from_to(a,h,l):f.error("Wrong ray test ID")};a.apply_constraint=function(a,
h,l,q,c,k,m,r,u,w){b.obj_has_physics(h)&&b.obj_has_physics(c)?b.apply_constraint(a,h,l,q,c,k,m,r,u,w):f.error("Wrong objects")};a.clear_constraint=function(a){b.obj_has_physics(a)&&b.has_constraint(a)?b.clear_constraint(a):f.error("Wrong object")};a.pull_to_constraint_pivot=function(a,h,l,q,c,k){b.obj_has_physics(a)&&b.obj_has_physics(q)?b.pull_to_constraint_pivot(a,h,l,q,c,k):f.error("Wrong objects")};a.navmesh_get_island=function(a,b,h){h||(h=u);var l=a.physics.navmesh;return l?q.navmesh_get_island(l,
b,h):(f.error(a.name+" is not a navigation mesh object"),null)};a.navmesh_find_path=function(a,b,l,r,c,k,m,A){k||(k=!1);m||(m=u);A||(A=h);var E=a.physics.navmesh;return E?q.navmesh_find_path(E,b,l,r,c,k,m,A):(f.error(a.name+" is not a navigation mesh object"),null)}};b4w.module.rgb=function(a,r){r("__print");var u=r("__util"),h=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,f,h){var q=new Float32Array(3);q[0]=a;q[1]=f;q[2]=h;return q};a.set=function(a,f,h,q){q[0]=a;q[1]=f;q[2]=h;return q};a.css_to_rgb=function(a,f,h,q){q=q||new Float32Array(3);q[0]=a/255;q[1]=f/255;q[2]=h/255;u.srgb_to_lin(q,q);return q};a.rgb_to_css=function(a){a=u.lin_to_srgb(a,h);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};
a.rgb_to_css_hex=function(a){var f=function(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a};a=u.lin_to_srgb(a,h);return"#"+f(a[0])+f(a[1])+f(a[2])}};
b4w.module.rgba=function(a,r){r("__print");var u=r("__util"),h=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,f,h,q){var e=new Float32Array(4);e[0]=a;e[1]=f;e[2]=h;e[3]=q;return e};a.set=function(a,f,h,q,e){e[0]=a;e[1]=f;e[2]=h;e[3]=q;return e};a.css_to_rgba=function(a,f,h,q,e){e=e||new Float32Array(4);e[0]=a/255;e[1]=f/255;e[2]=h/255;e[3]=q;u.srgb_to_lin(e,e);return e};a.rgba_to_css=function(a){var f=u.lin_to_srgb(a,h);return[Math.round(255*
f[0]),Math.round(255*f[1]),Math.round(255*f[2]),a[3]]}};b4w.module.scenes=function(a,r){var u=r("__batch"),h=r("__camera"),b=r("__data"),f=r("__graph"),l=r("__objects"),q=r("__obj_util"),e=r("__print"),n=r("__scenes"),p=r("__subscene"),B=r("__util");a.DATA_ID_ALL=l.DATA_ID_ALL;a.set_active=function(a){var b=n.get_all_scenes();n.set_active(B.keysearch("name",a,b))};a.get_active=function(){return n.check_active()?n.get_active().name:""};a.get_scenes=function(){for(var a=n.get_all_scenes(),b=[],e=0;e<a.length;e++)b.push(a[e].name);return b};a.get_active_camera=
function(){if(n.check_active())return n.get_camera(n.get_active());e.error("No active scene");return!1};a.get_object_by_name=function(a,b){var f=l.get_object(l.GET_OBJECT_BY_NAME,a,b|0);if(f)return f;e.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,f){if(a=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME,a,b,f|0))return a;e.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var f=l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0);if(f)return f;
e.error("get object "+a+": not found")};a.get_world_by_name=function(a,b){var f=l.get_world_by_name(a,b|0);if(f)return f;e.error("get object "+a+": not found")};a.get_object_data_id=function(a){return q.get_object_data_id(a)};a.pick_object=l.pick_object;a.outlining_is_enabled=function(a){return a&&a.render&&a.render.outlining};a.set_outline_intensity=function(a,b){a&&a.render&&a.render.outlining?l.set_outline_intensity(a,b):e.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=
function(a){if(a&&a.render&&a.render.outlining)return a.render.outline_intensity;e.error("get_outline_intensity(): wrong object")};a.apply_outline_anim=function(a,b,f,h){a&&a.render&&a.render.outlining?l.apply_outline_anim(a,b,f,h):e.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.render&&a.render.outlining){var b=a.render.outline_anim_settings_default;l.apply_outline_anim(a,b.outline_duration,b.outline_period,b.outline_relapses)}else e.error("apply_outline_anim_def(): wrong object")};
a.clear_outline_anim=function(a){a&&a.render&&a.render.outlining?l.clear_outline_anim(a):e.error("clear_outline_anim(): wrong object")};a.set_outline_color=n.set_outline_color;a.get_outline_color=function(a){var b=n.get_active();if(b=n.get_subs(b,p.OUTLINE))return a=a||new Float32Array(3),a.set(b.outline_color),a};a.set_hmd_params=function(a){n.check_active()?a&&(!a.distortion_coefs||a.distortion_coefs instanceof Array||(a.distortion_coefs=null),!a.chromatic_aberration_coefs||a.chromatic_aberration_coefs instanceof
Array||(a.chromatic_aberration_coefs=null),"number"!=typeof a.base_line_factor&&(a.base_line_factor=null),"number"!=typeof a.inter_lens_factor&&(a.inter_lens_factor=null),"boolean"!=typeof a.enable_hmd_stereo&&(a.enable_hmd_stereo=null),n.set_hmd_params(a)):e.error("No active scene")};a.get_shadow_params=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active(),b=n.get_subs(a,p.SHADOW_CAST);if(!b)return null;var f=a._render.shadow_params,h=n.get_subs(a,p.MAIN_OPAQUE),
l=n.get_subs(a,p.SHADOW_RECEIVE),q={};q.csm_resolution=f.csm_resolution;q.self_shadow_polygon_offset=b.self_shadow_polygon_offset;l&&(q.self_shadow_normal_offset=l.self_shadow_normal_offset);q.enable_csm=f.enable_csm;q.csm_num=f.csm_num;q.csm_first_cascade_border=f.csm_first_cascade_border;q.first_cascade_blur_radius=f.first_cascade_blur_radius;q.csm_last_cascade_border=f.csm_last_cascade_border;q.last_cascade_blur_radius=f.last_cascade_blur_radius;q.fade_last_cascade=f.fade_last_cascade;q.blend_between_cascades=
f.blend_between_cascades;f.enable_csm?(q.csm_borders=n.get_csm_borders(a,h.camera),q.blur_radii=new Float32Array(f.csm_num),q.blur_radii.set(h.camera.pcf_blur_radii.subarray(0,f.csm_num))):(q.csm_borders=null,q.blur_radii=null);return q};a.set_shadow_params=function(a){if(n.check_active()){var b=n.get_active();"number"==typeof a.self_shadow_polygon_offset&&f.traverse(b._render.graph,function(b,d){d.type==p.SHADOW_CAST&&(d.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var l=n.get_subs(b,
p.SHADOW_RECEIVE);l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius));var r=n.get_subs(b,p.MAIN_BLEND);r&&("number"==typeof a.self_shadow_normal_offset&&(r.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(r.pcf_blur_radius=a.pcf_blur_radius),r.need_perm_uniforms_update=!0);r=b._render.shadow_params;"number"==typeof a.csm_first_cascade_border&&
(r.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(r.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(r.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(r.last_cascade_blur_radius=a.last_cascade_blur_radius);if(l){for(var B=l.draw_data,w=0;w<B.length;w++)for(var v=B[w].bundles,z=0;z<v.length;z++){var y=v[z];if(y.obj_render.shadow_receive){var D=y.batch;
u.assign_shadow_receive_dirs(D,r);u.update_shader(D);p.append_draw_data(l,y)}}l.need_perm_uniforms_update=!0}l=q.get_scene_data(b._camera,b).cameras;for(w=0;w<l.length;w++)h.update_camera_shadows(l[w],r);n.schedule_shadow_update(b)}else e.error("No active scene")};a.get_environment_colors=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active();return n.get_environment_colors(a)};a.set_environment_colors=function(a,b,f){if(n.check_active()){var h=n.get_active(),l=
n.get_subs(h,p.MAIN_OPAQUE);a=a||0==a?parseFloat(a):l.environment_energy;n.set_environment_colors(h,a,b||0==b?b:l.horizon_color,f||0==f?f:l.zenith_color)}else e.error("No active scene")};a.get_fog_color_density=function(a){if(!n.check_active())return e.error("No active scene"),!1;var b=n.get_active();return n.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(n.check_active()){var b=n.get_active();n.set_fog_color_density(b,a)}else e.error("No active scene")};a.get_fog_params=function(){if(!n.check_active())return e.error("No active scene"),
!1;var a=n.get_active(),b={};b.fog_intensity=n.get_fog_intensity(a);b.fog_depth=n.get_fog_depth(a);b.fog_start=n.get_fog_start(a);b.fog_height=n.get_fog_height(a);return b};a.set_fog_params=function(a){if(n.check_active()){var b=n.get_active();"number"==typeof a.fog_intensity&&n.set_fog_intensity(b,a.fog_intensity);"number"==typeof a.fog_depth&&n.set_fog_depth(b,a.fog_depth);"number"==typeof a.fog_start&&n.set_fog_start(b,a.fog_start);"number"==typeof a.fog_height&&n.set_fog_height(b,a.fog_height)}else e.error("No active scene")};
a.get_ssao_params=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active();return n.get_ssao_params(a)};a.set_ssao_params=function(a){if(n.check_active()){var b=n.get_active();n.set_ssao_params(b,a)}else e.error("No active scene")};a.get_color_correction_params=function(){if(!n.check_active())return e.error("No active scene"),null;var a=n.get_active(),a=n.get_subs(a,p.COMPOSITING);if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=
a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(n.check_active()){var b=n.get_active();if(b=n.get_subs(b,p.COMPOSITING))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.need_perm_uniforms_update=!0}else e.error("No active scene")};a.get_sky_params=function(){if(!n.check_active())return e.error("No active scene"),
!1;var a=n.get_active();return n.get_sky_params(a)};a.set_sky_params=function(a){if(n.check_active()){var b=n.get_active();n.set_sky_params(b,a)}else e.error("No active scene")};a.get_dof_params=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active();return n.get_subs(a,p.DOF)?n.get_dof_params(a):null};a.set_dof_params=function(a){if(n.check_active()){var b=n.get_active();n.set_dof_params(b,a)}else e.error("No active scene")};a.get_god_rays_params=function(){if(!n.check_active())return e.error("No active scene"),
!1;var a=n.get_active();return n.get_subs(a,p.GOD_RAYS)?n.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(n.check_active()){var b=n.get_active();n.set_god_rays_params(b,a)}else e.error("No active scene")};a.get_bloom_params=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active();return n.get_subs(a,p.BLOOM)?n.get_bloom_params(a):null};a.set_bloom_params=function(a){if(n.check_active()){var b=n.get_active();n.set_bloom_params(b,a)}else e.error("No active scene")};
a.get_glow_material_params=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active();return n.get_subs(a,p.GLOW_COMBINE)?n.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(n.check_active()){var b=n.get_active();n.set_glow_material_params(b,a)}else e.error("No active scene")};a.get_wind_params=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active();return n.get_wind_params(a)};a.set_wind_params=function(a){if(n.check_active()){var b=
n.get_active();l.set_wind_params(b,a)}else e.error("No active scene")};a.get_water_surface_level=function(a,b){if(!n.check_active())return e.error("No active scene"),0;var f=n.get_active();return f._render.water_params?n.get_water_surface_level(f,a,b):(e.error("No water parameters on the active scene"),0)};a.set_water_params=function(a){if(n.check_active()){var b=n.get_active();n.set_water_params(b,a)}else e.error("No active scene")};a.get_water_mat_params=function(a){if(n.check_active()){var b=n.get_active();
n.get_water_mat_params(b,a)}else e.error("No active scene")};a.update_scene_materials_params=function(){if(n.check_active()){var a=n.get_active();n.update_scene_permanent_uniforms(a)}else e.error("No active scene")};a.hide_object=function(a,b){b=b||!1;!q.is_mesh(a)&&!q.is_empty(a)||q.is_dynamic(a)?b?n.change_visibility(a,!0):n.change_visibility_rec(a,!0):e.error("show/hide is only supported for dynamic objects.")};a.show_object=function(a,b){b=b||!1;!q.is_mesh(a)&&!q.is_empty(a)||q.is_dynamic(a)?
b?n.change_visibility(a,!1):n.change_visibility_rec(a,!1):e.error("show/hide is only supported for dynamic objects.")};a.is_hidden=function(a){if(q.is_dynamic_mesh(a)||q.is_empty(a)||q.is_lamp(a))return n.is_hidden(a);e.error("show/hide is only supported for dynamic meshes/empties and lamps");return!1};a.is_visible=function(a){return a.render.is_visible};a.check_object=function(a){e.error_deprecated("scenes.check_object","scenes.check_object_by_name");return n.check_active()?l.objects_storage_check(a,
n.get_active()):(e.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return l.get_object(l.GET_OBJECT_BY_NAME,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,e){return l.get_object(l.GET_OBJECT_BY_DUPLI_NAME,a,b,e|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return l.get_object(l.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var e=n.get_active();a||(a="ALL");b||0===b||(b=l.DATA_ID_ALL);return l.get_scene_objs(e,a,b)};a.get_object_name=
function(a){return a?a.origin_name:(e.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return e.error("Wrong object name"),null;for(var b=[];a;)b.push(a.origin_name),a=q.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(e.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){e.error_deprecated("scenes.get_object_dg_parent","objects.get_dg_parent");return q.get_dg_parent(a)};a.get_object_children=function(a){return a.cons_descends.slice(0)};
a.get_first_character=function(){return l.get_first_character(n.get_active())};a.get_shore_dist=function(a,b){b||0===b||(b=1);if(!n.check_active())return e.error("No active scene"),!1;var f=n.get_active();return n.get_shore_dist(f,a,b)};a.get_cam_water_depth=function(){return n.get_cam_water_depth()};a.get_type_mesh_object=function(a){return q.is_mesh(a)?a.render.type:null};a.get_meta_tags=function(){if(!n.check_active())return e.error("No active scene"),!1;var a=n.get_active();return n.get_meta_tags(a)};
a.append_object=function(a,b){if(a.render.is_copied){if(b)var f=n.get_all_scenes(),f=B.keysearch("name",b,f);else f=n.get_active();n.append_object(f,a,!0)}else e.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){(q.is_mesh(a)||q.is_empty(a))&&q.is_dynamic(a)?(l.obj_switch_cleanup_flags(a,!1,a.render.is_copied_deep,!1,!1),b.prepare_object_unloading(a),l.obj_switch_cleanup_flags(a,!0,!0,!0,!0),l.remove_object(a)):e.error("Can't remove object \""+a.name+'". It must be dynamic and type of MESH or EMPTY.')};
a.marker_frame=function(a){var b=n.get_active();if(b.timeline_markers&&a in b.timeline_markers)return n.marker_frame(b,a);e.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=n.get_active();return(a=n.get_subs(a,p.MOTION_BLUR))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=n.get_active();(b=n.get_subs(b,p.MOTION_BLUR))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&
(b.mb_factor=a.mb_factor)):e.error("The motion blur subscene doesn't exist.")};a.can_select_objects=function(){var a=n.get_active();return Boolean(n.get_subs(a,p.COLOR_PICKING))}};b4w.module.sfx=function(a,r){var u=r("__obj_util"),h=r("__scenes"),b=r("__sfx"),f=r("__print");a.play=function(a,f,e){b.play(a,f||0,e||0)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_playing(a)};a.is_playing=function(a){return b.is_playing(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.speaker_pause(a)};a.resume=function(a){b.speaker_resume(a)};a.loop_stop=function(a,f,e){b.loop_stop(a,f||0,e||!1)};a.playrate=function(a,f){b.playrate(a,f)};a.get_playrate=function(a){return b.get_playrate(a)};
a.cyclic=function(a,f){b.cyclic(a,f)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,f){b.listener_stride()};a.listener_stride=function(){b.listener_stride()};a.speaker_reset_speed=function(a,f,e){b.speaker_stride(a)};a.speaker_stride=function(a){b.speaker_stride(a)};a.get_volume=function(a){return a&&"object"===typeof a?b.get_volume(a):b.get_master_volume()};a.set_volume=function(a,f){a&&"object"===typeof a?b.set_volume(a,f):b.set_master_volume(f)};a.mute=function(a,
f){a&&"object"===typeof a?b.mute(a,f):b.mute_master(f)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.is_master_muted()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(h.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(h.get_active())};a.duck=function(a,f,e){a&&"object"===typeof a?b.duck(a,f,e):b.duck_master(f,
e)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.unduck_master()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&
u.is_speaker(a))return b.get_duration(a);f.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,r){var u=r("__print"),h=r("__scenes"),b=r("__textures"),f=r("__obj_util"),l=r("__assets");a.play_video=function(a,e){e||(e=0);h.get_active().b4w_use_nla&&b.video_allow_nla(a,e)?u.error("NLA texture can't be controlled directly through API."):b.play_video(a,e)||u.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,e){e||(e=0);h.get_active().b4w_use_nla&&b.video_allow_nla(a,e)?u.error("NLA texture can't be controlled directly through API."):b.pause_video(a,
e)||u.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,e){e||(e=0);h.get_active().b4w_use_nla&&b.video_allow_nla(a,e)?u.error("NLA texture can't be controlled directly through API."):b.reset_video(a,e)||u.error('Texture with name "'+a+'" not found!')};a.get_canvas_ctx=function(a,e){if(f.is_mesh(a)){var h=b.get_canvas_context_by_object(a,e);if(h)return h;u.error("Couldn't find canvas texture with this name: "+e)}else u.error("Object must be type of mesh.");return null};a.update_canvas_ctx=
function(a,e){if(f.is_mesh(a)){if(b.update_canvas_context_by_object(a,e))return!0;u.error("Couldn't find canvas texture with this name: "+e)}else u.error("Object must be type of mesh.");return!1};a.change_image=function(a,e,f,h){h=h||function(){};l.enqueue([{id:f,type:l.AT_IMAGE_ELEMENT,url:f,request:"GET",post_type:null,post_data:null,optional_param:null}],function(f,c,k,l,n){f&&(b.change_image(a,e,f)?h():u.error("Couldn't find texture with this name: "+e))},null,null)};a.get_texture_names=function(a){if(f.is_mesh(a))return b.get_texture_names(a);
u.error("Object must be type of mesh.")}};b4w.module.time=function(a,r){var u=r("__time");a.set_timeout=u.set_timeout;a.clear_timeout=u.clear_timeout;a.get_timeline=u.get_timeline;a.animate=u.animate;a.clear_animation=u.clear_animation};b4w.module.transform=function(a,r){var u=r("__obj_util"),h=r("__physics"),b=r("__print"),f=r("__quat"),l=r("__transform"),q=r("__tsr"),e=r("__util"),n=q.create(),p=new Float32Array(3),B=new Float32Array(4);a.SPACE_LOCAL=l.SPACE_LOCAL;a.SPACE_WORLD=l.SPACE_WORLD;a.set_translation=function(a,e,f,n){u.is_dynamic(a)?(p[0]=e,p[1]=f,p[2]=n,l.set_translation(a,p),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,e,f,n){u.is_dynamic(a)?
(p[0]=e,p[1]=f,p[2]=n,l.set_translation_rel(a,p),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,e){u.is_dynamic(a)?(l.set_translation(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,e){u.is_dynamic(a)?(l.set_translation_rel(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=
function(a,f,m,n,r){u.is_dynamic(a)?(p[0]=f,p[1]=m,p[2]=n,f=q.get_trans_view(r.render.world_tsr),r=q.get_quat_view(r.render.world_tsr),e.transform_vec3(p,1,r,f,p),l.set_translation(a,p),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));l.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));l.get_translation_rel(a,b);return b};a.set_rotation=function(a,
e,f,n,p){u.is_dynamic(a)?(B[0]=e,B[1]=f,B[2]=n,B[3]=p,l.set_rotation(a,B),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,e,f,n,p){u.is_dynamic(a)?(B[0]=e,B[1]=f,B[2]=n,B[3]=p,l.set_rotation_rel(a,B),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_v=function(a,e){u.is_dynamic(a)?(l.set_rotation(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,e){u.is_dynamic(a)?(l.set_rotation_rel(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_rotation=function(a,b){b||(b=new Float32Array(4));l.get_rotation(a,b);return b};a.get_rotation_rel=function(a,b){b||(b=new Float32Array(4));l.get_rotation_rel(a,b);return b};a.set_rotation_euler=function(a,e,f,n){u.is_dynamic(a)?(p[0]=e,p[1]=f,p[2]=n,l.set_rotation_euler(a,p),l.update_transform(a),
h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_rotation_euler=function(a,b){b||(b=new Float32Array(3));l.get_rotation_euler(a,b);return b};a.get_rotation_euler_rel=function(a,b){b||(b=new Float32Array(3));l.get_rotation_euler_rel(a,b);return b};a.set_rotation_euler_rel=function(a,e,f,n){u.is_dynamic(a)?(p[0]=e,p[1]=f,p[2]=n,l.set_rotation_euler_rel(a,p),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=
function(a,e){u.is_dynamic(a)?(l.set_rotation_euler(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=function(a,e){u.is_dynamic(a)?(l.set_rotation_euler_rel(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,e){u.is_dynamic(a)?(l.set_scale(a,e),l.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,
e){u.is_dynamic(a)?(l.set_scale_rel(a,e),l.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return l.get_scale(a)};a.get_scale_rel=function(a){return l.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)b.error("Wrong object: "+a.name);else{for(var e=0;e<a.cons_descends.length;e++)if(!u.is_dynamic(a.cons_descends[e])){b.error('Wrong object: "'+a.cons_descends[e].name+'" is not dynamic.');return}l.set_translation(a,[0,0,0]);l.set_rotation(a,
[0,0,0,1]);l.set_scale(a,1);l.update_transform(a);h.sync_transform(a)}};a.get_object_size=function(a){return u.is_mesh(a)?l.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,e,f){if(!u.is_mesh(a))return b.error("Wrong object: "+a.name),null;f||(f=new Float32Array(3));return l.get_object_center(a,e,f)};a.move_local=function(a,e,f,n){u.is_dynamic(a)?(l.move_local(a,e,f,n),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.rotate_x_local=function(a,k){if(u.is_dynamic(a)){var m=f.setAxisAngle(e.AXIS_X,k,B);l.rotate_local(a,m);l.update_transform(a);h.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_y_local=function(a,k){if(u.is_dynamic(a)){var m=f.setAxisAngle(e.AXIS_MY,k,B);l.rotate_local(a,m);l.update_transform(a);h.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,k){if(u.is_dynamic(a)){var m=f.setAxisAngle(e.AXIS_Z,k,B);
l.rotate_local(a,m);l.update_transform(a);h.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return l.get_object_bounding_box(a)};a.set_tsr=function(a,e){u.is_dynamic(a)?(l.set_tsr(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,e){u.is_dynamic(a)?(l.set_tsr_rel(a,e),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.get_tsr=function(a,b){b||(b=new Float32Array(8));l.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));l.get_tsr_rel(a,b);return b};a.distance=function(a,b){return l.distance(a,b)};a.set_matrix=function(a,e){u.is_dynamic(a)?(q.from_mat4(e,n),l.set_tsr(a,n),l.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_matrix_rel=function(a,e){u.is_dynamic(a)?(q.from_mat4(e,n),l.set_tsr_rel(a,n),l.update_transform(a),h.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_matrix=function(a,b){b||(b=new Float32Array(16));l.get_tsr(a,n);q.to_mat4(n,b);return b};a.get_matrix_rel=function(a,b){b||(b=new Float32Array(16));l.get_tsr_rel(a,n);q.to_mat4(n,b);return b}};b4w.module.tsr=function(a,r){function u(a,b,e,h){h||(h=f.create());u(a,b,e,h);return h}var h=r("__mat4"),b=r("__print"),f=r("__tsr");a.create=f.create;a.from_values=f.from_values;a.copy=f.copy;a.identity=f.identity;a.create_sep=function(a,f,e,h){b.error_deprecated("create_sep","set_sep");return u(a,f,e,h)};a.set_sep=f.set_sep;a.set_trans=f.set_trans;a.set_scale=f.set_scale;a.set_transcale=f.set_transcale;a.set_quat=f.set_quat;a.get_trans_view=f.get_trans_view;a.get_scale=f.get_scale;a.get_quat_view=
f.get_quat_view;a.invert=f.invert;a.to_mat4=function(a,b){b||(b=h.create());f.to_mat4(a,b);return b};a.from_mat4=f.from_mat4;a.multiply=f.multiply;a.transform_vec3=f.transform_vec3;a.transform_vec3_inv=f.transform_vec3_inv;a.transform_vectors=f.transform_vectors;a.transform_dir_vectors=f.transform_dir_vectors;a.transform_dir_vec3=f.transform_dir_vec3;a.transform_tangents=f.transform_tangents;a.translate=f.translate;a.interpolate=function(a,b,e,h){h||(h=f.create());f.interpolate(a,b,e,h);return h}};b4w.module.util=function(a,r){var u=r("__compat"),h=r("__obj_util"),b=r("__print"),f=r("__quat"),l=r("__util"),q=r("__vec3"),e=new Float32Array(6);a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.XYX=l.XYX;a.YZY=l.YZY;a.ZXZ=l.ZXZ;a.XZX=l.XZX;a.YXY=l.YXY;a.ZYZ=l.ZYZ;a.XYZ=l.XYZ;a.YZX=l.YZX;a.ZXY=l.ZXY;a.XZY=l.XZY;a.YXZ=l.YXZ;a.ZYX=
l.ZYX;a.f32=function(a){return l.f32(a||0)};a.assert=l.assert;a.keyfind=l.keyfind;a.keysearch=l.keysearch;a.matrix_to_quat=function(a){return l.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));return l.euler_to_quat(a,b)};a.ordered_angles_to_quat=function(a,b,e){e||(e=f.create());return l.ordered_angles_to_quat(a,b,e)};a.quat_to_ordered_angles=function(a,b,e){e||(e=q.create());return l.quat_to_ordered_angles(a,b,e)};a.quat_to_euler=function(a,b){b||(b=new Float32Array(3));
return l.quat_to_euler(a,b)};a.sign=l.sign;a.clamp=l.clamp;a.quat_to_dir=l.quat_to_dir;a.ground_project_quat=function(a,b){return l.quat_project(a,l.AXIS_MZ,l.AXIS_Z,l.AXIS_Y,b)};a.cam_quat_to_mesh_quat=function(a,b){return l.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,e,f,c,h){return 0!=q.dot(f,c)?(b.error("Wrong in-plane direction"),null):l.quat_project(a,e,f,c,h)};a.hash_code=l.hash_code;a.smooth=l.smooth;a.smooth_v=l.smooth_v;a.is_vector=l.is_vector;a.correct_cam_quat_up=l.correct_cam_quat_up;
a.quat_to_angle_axis=l.quat_to_angle_axis;a.random_from_array=l.random_from_array;a.horizontal_direction=l.horizontal_direction;a.line_plane_intersect=function(a,f,h,c,k){b.error_deprecated("util.line_plane_intersect","math.line_plane_intersect");e[0]=h[0];e[1]=h[1];e[2]=h[2];e[3]=c[0];e[4]=c[1];e[5]=c[2];return l.line_plane_intersect(a,f,e,k)};a.is_mesh=function(a){b.error_deprecated("util.is_mesh","objects.is_mesh");return h.is_mesh(a)};a.is_armature=function(a){b.error_deprecated("util.is_armature",
"objects.is_armature");return h.is_armature(a)};a.angle_wrap_0_2pi=l.angle_wrap_0_2pi;a.angle_wrap_periodic=l.angle_wrap_periodic;a.smooth_step=l.smooth_step;a.lerp=l.lerp;a.deg_to_rad=l.deg_to_rad;a.rad_to_deg=l.rad_to_deg;a.dir_to_quat=l.dir_to_quat;a.is_ie11=u.is_ie11;a.gen_tbn_quats=l.gen_tbn_quats};"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,r){r("__print");var u=r("__version");a.version=u.version;a.version_str=u.version_str;a.type=u.type;a.date=u.date;a.date_str=u.date_str};"object"==typeof module&&module.exports&&b4w.module.version(exports);b4w.module.objects=function(a,r){var u=r("__geometry"),h=r("__objects"),b=r("__batch"),f=r("__obj_util"),l=r("__print"),q=r("__scenes");a.get_meta_tags=function(a){if(a)return h.get_meta_tags(a)};a.copy=function(a,b,p){return f.is_mesh(a)?f.is_dynamic(a)?u.has_dyn_geom(a)||u.check_shape_keys(a)||!p?-1==h.get_scene_objs(q.get_active(),"MESH",h.DATA_ID_ALL).indexOf(a)?(l.error('object "'+a.name+'" does not belong to the active scene.'),!1):h.copy(a,b||"",p):(l.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(l.error('object "'+a.name+'" is not dynamic.'),!1):(l.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,h,p){l.error_deprecated("set_nodemat_value","material.set_nodemat_value");if(f.is_dynamic_mesh(a)){var q=h[0],c=b.find_batch_material(a,q,"MAIN");if(null===c)return l.error('Material "'+q+'" was not found in the object "'+a.name+'".'),null;c=b.get_node_ind_by_name_list(c.node_value_inds,h);if(null===c)return l.error('Value node "'+h[h.length-1]+'" was not found in the object "'+
a.name+'".'),null;b.set_nodemat_value(a,q,c,p)}else l.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.')};a.get_nodemat_value=function(a,h){l.error_deprecated("get_nodemat_value","material.get_nodemat_value");if(!f.is_dynamic_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.'),null;var p=h[0],q=b.find_batch_material(a,p,"MAIN");if(null===q)return l.error('Material "'+p+'" was not found in the object "'+a.name+'".'),null;p=
b.get_node_ind_by_name_list(q.node_value_inds,h);return null===p?(l.error('Value node "'+h[h.length-1]+'" was not found in the object "'+a.name+'".'),null):b.get_nodemat_value(q,p)};a.set_nodemat_rgb=function(a,h,p,q,c){l.error_deprecated("set_nodemat_rgb","material.set_nodemat_rgb");if(f.is_dynamic_mesh(a)){var k=h[0],m=b.find_batch_material(a,k,"MAIN");null===m?l.error('Material "'+k+'" was not found in the object "'+a.name+'".'):(m=b.get_node_ind_by_name_list(m.node_rgb_inds,h),null===m?l.error('RGB node "'+
h[h.length-1]+'" was not found in the object "'+a.name+'".'):b.set_nodemat_rgb(a,k,m,p,q,c))}else l.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.')};a.get_nodemat_rgb=function(a,h,p){l.error_deprecated("get_nodemat_rgb","material.get_nodemat_rgb");if(!f.is_dynamic_mesh(a))return l.error('The type of the object "'+a.name+'" is not "MESH" or it is not dynamic.'),null;var q=h[0],c=b.find_batch_material(a,q,"MAIN");if(null===c)return l.error('Material "'+q+'" was not found in the object "'+
a.name+'".'),null;q=b.get_node_ind_by_name_list(c.node_rgb_inds,h);if(null===q)return l.error('RGB node "'+h[h.length-1]+'" was not found in the object "'+a.name+'".'),null;p||(p=new Float32Array(3));return b.get_nodemat_rgb(c,q,p)};a.update_boundings=function(a){f.is_mesh(a)?u.has_dyn_geom(a)||u.check_shape_keys(a)?h.update_boundings(a):l.error('object "'+a.name+'" has not dynamic geometry.'):l.error('The type of the object "'+a.name+'" is not "MESH".')};a.get_parent=f.get_parent;a.get_dg_parent=
f.get_dg_parent;a.is_mesh=f.is_mesh;a.is_armature=f.is_armature;a.is_speaker=f.is_speaker;a.is_camera=f.is_camera;a.is_lamp=f.is_lamp;a.is_empty=f.is_empty;a.is_line=f.is_line;a.is_world=f.is_world;a.get_selectable_objects=function(){return h.get_selectable_objects()};a.get_outlining_objects=function(){return h.get_outlining_objects()}};b4w.module.main=function(a,r){function u(){window.performance||(x.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(x.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});F.set_timeline(0)}function h(a,b){for(var c=null,d=b?sa:R,e=0;e<d.length;e++){var g=d[e];try{c=a.getContext(g,ha)}catch(f){}if(c)break}c&&m.detect_tegra_invalid_enum_issue(c);return c}function b(a,b,c){a.addEventListener("webglcontextlost",
function(a){a.preventDefault();x.error("WebGL context lost");l()},!1);z.setup_context(c);var d=z.get_renderer_info();d&&x.log("%cRENDERER INFO:","color: #00a",c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));g.setup_context(c);y.setup_context(c);L.setup_context(c);ba.setup_context(c);v.setup_context(c);A.setup_context(c);w.setup_canvas(a);A.init(a,b);H.setup_dim(a.width,a.height,1);G.init();Aa=n();e()}function f(){ra=function(){}}function l(){q()||(I=performance.now()/
1E3,G.pause(),M.pause(),L.pause(),p.pause())}function q(){return ma<I}function e(){var a="HMD"===Y.stereo&&D.get_webvr_display();a?a.requestAnimationFrame(e):ua(e);var b=performance.now()/1E3;ca||(ca=b);var g=b-ca;if(!(g<1/Y.max_fps)){for(var f=F.get_timeline(),h=0;h<da.length;h++)da[h](f,g);q()||(ma>ca&&(g-=ma-Math.max(I,ca)),f+=g,F.set_timeline(f),v.update(),c.update(),w.update(),h=g,w.is_primary_loaded()&&(K.reset(),U.update(h),t.update(f,h),d.update(f,h),G.update(f,h),h&&B.update(h),w.is_primary_loaded()&&
(M.update(f,h),w.is_primary_loaded()&&(D.update(f),E.update(f,h),w.is_primary_loaded()&&(p.update(!1),C.update(f,h),W.update(),ra(h,f),w.is_primary_loaded()&&(H.update(f,h),p.update_visibility(),S&&(S(Z.toDataURL()),S=null)))))),Aa(g));ca=b;a&&a.isPresenting&&a.submitFrame()}}function n(){var a=60,b=0,c=Y.fps_measurement_interval,d=Y.fps_callback_interval;return function(e){e<1/Y.max_fps||(a=Q.smooth(1/e,a,e,c),e=M.get_fps(),b=(b+1)%d,0==b&&fa(Math.round(a),e))}}var p=r("__anchors"),B=r("__animation"),
c=r("__assets"),k=r("__config"),m=r("__compat"),A=r("__container"),E=r("__controls"),w=r("__data"),v=r("__debug"),z=r("__extensions"),y=r("__geometry"),D=r("__input"),K=r("__hud"),d=r("__nla"),t=r("__logic_nodes"),C=r("__objects"),M=r("__physics"),x=r("__print"),g=r("__renderer"),H=r("__scenes"),G=r("__sfx"),ba=r("__shaders"),L=r("__textures"),F=r("__time"),U=r("__transform"),Q=r("__util"),T=r("__version"),W=r("__particles"),ha=k.context,Y=k.defaults,Z=null,N=null,ca=0,I=0,ma=0,da=[],fa=function(){},
Aa=function(){},ra=function(){},S=null,R=["webgl","experimental-webgl"],sa=["webgl2","experimental-webgl2"],va=null,ua=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/Y.max_fps)}}();a.init=function(a,c){k.set_paths();x.set_verbose(Y.console_verbose);var d=T.version_str()+" "+T.type()+" ("+T.date_str()+")";x.log("%cINIT ENGINE",
"color: #00a",d);x.log("%cUSER AGENT:","color: #00a",navigator.userAgent);if(!window.WebGLRenderingContext)return null;u();Z=a;c?(K.init(c),N=c):(k.defaults.show_hud_debug_info=!1,k.sfx.mix_mode=!1);m.apply_context_alpha_hack();m.check_user_agent("Chrome")||m.check_user_agent("Firefox")||(Y.webgl2=!1);d=h(a,Y.webgl2);!d&&Y.webgl2&&(Y.webgl2=!1,d=h(a,!1));if(!d)return null;x.log("%cINIT WEBGL "+(Y.webgl2?"2":"1"),"color: #00a");va=d;b(Z,N,d);k.apply_quality();m.set_hardware_defaults(d,!0);ba.load_shaders();
Y.ie11_edge_touchscreen_hack&&(a.style["touch-action"]="none");x.log("%cSET PRECISION:","color: #00a",Y.precision);return d};a.resize=function(a,b,c){x.error_deprecated("main.resize","container.resize");A.resize(a,b,c)};a.set_fps_callback=function(a){fa=a};a.clear_fps_callback=function(){fa=function(){}};a.set_render_callback=function(a){ra=a};a.clear_render_callback=function(){f()};a.global_timeline=function(){x.error_deprecated("main.global_timeline","time.get_timeline");return F.get_timeline()};
a.pause=l;a.resume=function(){q()&&(ma=performance.now()/1E3,G.resume(),M.resume(),L.play(!0),p.resume())};a.is_paused=q;a.reset=function(){w.unload(0);w.reset();z.reset();g.reset();y.reset();L.reset_mod();ba.reset();v.reset();A.reset();w.reset();A.reset();F.reset();G.reset();N=Z=null;ma=I=ca=0;fa=function(){};Aa=function(){};ra=function(){};da.length=0;va=null};a.canvas_data_url=function(a){S=a};a.get_canvas_elem=function(){x.error_deprecated("main.get_canvas_elem","container.get_canvas");return Z};
a.detect_mobile=function(){return m.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<da.length;b++)if(da[b]==a)return;da.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<da.length;b++)if(da[b]==a){da.splice(b,1);break}};a.get_renderer_info=function(){var a=z.get_renderer_info();if(!a)return null;var b=va.getParameter(a.UNMASKED_VENDOR_WEBGL),a=va.getParameter(a.UNMASKED_RENDERER_WEBGL);return{vendor:b,renderer:a}}};b4w.module.nla=function(a,r){var u=r("__nla"),h=r("__time"),b=r("__print"),f=r("__util");a.set_frame=function(a){a=f.clamp(a,u.get_frame_start(),u.get_frame_end());u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.set_frame(a,h.get_timeline())};a.get_frame=function(){return u.get_frame(h.get_timeline())};a.stop=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.stop_nla()};a.play=function(a){u.check_logic_nodes()?b.error("The active scene is using NLA script."):
u.play_nla(a)};a.is_play=function(){return u.is_play()};a.get_frame_start=function(){return u.get_frame_start()};a.get_frame_end=function(){return u.get_frame_end()};a.check_nla=function(){return u.check_nla()};a.check_nla_scripts=function(){return u.check_logic_nodes()};a.check_logic_nodes=function(){return u.check_logic_nodes()};a.set_range=function(a,h){u.check_logic_nodes()?b.error("The active scene is using NLA script."):(h=parseFloat(h)||u.get_frame_end(),a=parseFloat(a)||u.get_frame_end(),
h=f.clamp(h,u.get_frame_start(),u.get_frame_end()),a=f.clamp(a,u.get_frame_start(),h),u.set_range(a,h))};a.reset_range=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.reset_range()};a.set_cyclic=function(a){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.set_cyclic(a)};a.clear_callback=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.clear_callback()}};b4w.module.app=function(a,r){function u(){var a=x.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=x.is_paused(),x.pause()):a||x.resume()},!1)}function h(){var a=0,b=K.get_container(),c=x.is_paused(),d=!0;x.append_loop_cb(function(){if(0==a%10){var e=b.getBoundingClientRect();e.top>window.innerHeight||0>e.bottom?(d&&(c=x.is_paused()),x.pause(),d=!1):c||d||(x.resume(),d=!0)}a++})}function b(a,b,c,d){var e=document.createElement("canvas"),g=document.getElementById(a);
g||(H.error('Warning: canvas container "'+a+'" not found, appending to body'),g=document.body);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=g.offsetWidth+"px";e.style.height=g.offsetHeight+"px";e.width=g.offsetWidth*window.devicePixelRatio;e.height=g.offsetHeight*window.devicePixelRatio;b?(a=document.createElement("canvas"),a.style.position="absolute",e.style.left=0,e.style.top=0,a.style.pointerEvents="none"):a=null;g.appendChild(e);if(!x.init(e,a))return c&&w("Browser could not initialize WebGL",
"For more info visit","https://www.blend4web.com/doc/en/problems_and_solutions.html",d),!1;a&&K.insert_to_container(a,"LAST");return!0}function f(a,b){a?(b&&(document.getElementById(b).style.display="block"),Q=document.getElementById(a)):(Q=document.createElement("div"),Q.innerHTML=0,Q.style.cssText="position:absolute;top: 23px;right: 20px;text-shadow: 0px 0px 6px #fff;font-size: 40px;line-height: 50px;font-weight: bold;color: #000;",K.insert_to_container(Q,"JUST_AFTER_CANVAS"))}function l(a,b){var c=
String(a);b&&(c+="/"+String(b));Q.innerHTML=c}function q(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function e(a,b,c){var d=Math.max(z.hover_get_distance(a),1),e=ba.get_rotation(a,I);b=L.quat_to_dir(e,b,N);b[2]=0;F.normalize(b,b);F.scale(b,d*c,b);c=ba.get_translation(a,ca);F.add(c,b,c);z.set_translation(a,c)}function n(a,b){var c=z.hover_get_vertical_limits(a,da);if(c.up!=c.down){var d=z.get_camera_angles(a,Z)[1],c=(c.down-d)/(c.down-c.up),d=z.hover_get_distance_limits(a,
da),c=Math.max(c,2/d.max);z.hover_rotate(a,0,c*b)}}function p(a,b,c,d){ba.move_local(a,5*b,5*c,5*d)}function B(a,b,c){var d=z.target_get_distance(a),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));ba.move_local(a,0,0,0>b?.001<d?-d*c:0:c/(1-c)*d)}function c(a,b,c,d,e){for(a=d*c;0<b;--b)d+=a,e+=a,a=d*c;return e}function k(a,b,d,e,g,f){f?(g=z.target_get_pivot(a,N),f=z.get_translation(a),g=F.dist(g,f)+e,e=0<b?c(a,b,-d,g,e):c(a,-b,d/(1-d),g,e)):e-=b*g*d;return e}function m(a,b,c,f,h){T=a;W=b;ha=c;var l=
G.get_active_camera();A(l);var m=!1,q=null,r=!1;switch(z.get_move_style(l)){case z.MS_TARGET_CONTROLS:m=!a;break;case z.MS_EYE_CONTROLS:q=G.get_first_character();break;case z.MS_STATIC:return;case z.MS_HOVER_CONTROLS:r=!0}var t=z.get_velocities(l,ma);a=d.create_elapsed_sensor();if(g.has_simulated_physics(l)){var v=d.create_collision_sensor(l,null,!0);d.create_sensor_manifold(l,"CAMERA_COLLISION",d.CT_POSITIVE,[v],null,function(a,b,c){c=d.get_sensor_payload(a,b,0).coll_dist;if(0>c){var e=d.get_sensor_payload(a,
b,0).coll_norm;b=N;F.scale(e,-.25*c,b);c=ba.get_translation(a,ca);F.add(c,b,c);ba.set_translation_v(a,c)}})}if(q){var v=ba.get_translation(l),u=ba.get_rotation(l),u=L.cam_quat_to_mesh_quat(u);v[2]-=.5;g.set_transform(q,v,u);D.append_stiff_trans(l,q,[0,0,.5]);var x=new Float32Array(2),w=!0;g.set_character_move_type(q,g.CM_FLY);d.create_kb_sensor_manifold(l,"TOGGLE_CHAR_MOVE_TYPE",d.CT_SHOT,d.KEY_C,function(){w=!w;g.set_character_move_type(q,w?g.CM_FLY:g.CM_WALK)})}var y=function(a,b,c){if(1==c)switch(c=
d.get_sensor_value(a,b,0),z.get_velocities(a,t),b){case "FORWARD":q?x[0]=1:r?(b=z.get_camera_angles(a,Z)[1],b=Math.abs(b)>=Math.PI/4?L.AXIS_Y:L.AXIS_MZ,e(a,b,.5*t.trans*c)):m?B(a,-t.zoom,c):p(a,0,0,-t.trans*c);break;case "BACKWARD":q?x[0]=-1:r?(b=z.get_camera_angles(a,Z)[1],b=Math.abs(b)>=Math.PI/4?L.AXIS_MY:L.AXIS_Z,e(a,b,.5*t.trans*c)):m?B(a,t.zoom,c):p(a,0,0,t.trans*c);break;case "UP":r?n(a,30*-t.zoom*c):q||p(a,0,t.trans*c,0);break;case "DOWN":r?n(a,30*t.zoom*c):q||p(a,0,-t.trans*c,0);break;case "LEFT":q?
x[1]=1:r?e(a,L.AXIS_MX,.5*t.trans*c):p(a,-t.trans*c,0,0);break;case "RIGHT":q?x[1]=-1:r?e(a,L.AXIS_X,.5*t.trans*c):p(a,t.trans*c,0,0);break;case "ROT_LEFT":m?z.target_rotate(a,.75*-t.rot*c,0):z.eye_rotate(a,.75*t.rot*c,0);break;case "ROT_RIGHT":m?z.target_rotate(a,.75*t.rot*c,0):z.eye_rotate(a,.75*-t.rot*c,0);break;case "ROT_UP":m?z.target_rotate(a,0,.75*-t.rot*c):z.eye_rotate(a,0,.75*t.rot*c);break;case "ROT_DOWN":m?z.target_rotate(a,0,.75*t.rot*c):z.eye_rotate(a,0,.75*-t.rot*c)}else switch(b){case "FORWARD":case "BACKWARD":q&&
(x[0]=0);break;case "LEFT":case "RIGHT":q&&(x[1]=0)}q&&(g.set_character_move_dir(q,x[0],x[1]),a=z.get_camera_angles_char(a,Y),g.set_character_rotation(q,a[0],a[1]))},H=M.check_enable_gamepad_indices(),v=H.length?H[H.length-1]:0,C,E,I,K,Q,da;b?C=E=I=K=Q=da=b=v=d.create_custom_sensor(0):(C=d.create_keyboard_sensor(d.KEY_W),E=d.create_keyboard_sensor(d.KEY_S),I=d.create_keyboard_sensor(d.KEY_A),K=d.create_keyboard_sensor(d.KEY_D),Q=d.create_keyboard_sensor(d.KEY_R),da=d.create_keyboard_sensor(d.KEY_F),
b=d.create_gamepad_btn_sensor(M.GMPD_BUTTON_6,v),v=d.create_gamepad_btn_sensor(M.GMPD_BUTTON_7,v));var Ca=d.create_keyboard_sensor(d.KEY_UP),ia=d.create_keyboard_sensor(d.KEY_DOWN),oa=d.create_keyboard_sensor(d.KEY_LEFT),xa=d.create_keyboard_sensor(d.KEY_RIGHT),u=d.create_gamepad_axis_sensor(M.GMPD_AXIS_0,H),La=d.create_gamepad_axis_sensor(M.GMPD_AXIS_1,H),Ha=d.create_gamepad_axis_sensor(M.GMPD_AXIS_2,H),H=d.create_gamepad_axis_sensor(M.GMPD_AXIS_3,H),P=function(a){return a[0]&&(a[1]||a[2]||a[3])},
la=function(a){return a[0]&&(a[1]||.1<a[2])},Ba=function(a){return a[0]&&(a[1]||-.1>a[2])},Ma=function(a){return a[0]&&(a[1]||a[2]||.1<a[3])},Fa=function(a){return a[0]&&(a[1]||a[2]||-.1>a[3])};r||(d.create_sensor_manifold(l,"FORWARD",d.CT_CONTINUOUS,[a,C,La],Ba,y),d.create_sensor_manifold(l,"BACKWARD",d.CT_CONTINUOUS,[a,E,La],la,y));m?(d.create_sensor_manifold(l,"ROT_UP",d.CT_CONTINUOUS,[a,Ca,Q,H],Fa,y),d.create_sensor_manifold(l,"ROT_DOWN",d.CT_CONTINUOUS,[a,ia,da,H],Ma,y),d.create_sensor_manifold(l,
"ROT_LEFT",d.CT_CONTINUOUS,[a,oa,I,Ha],Fa,y),d.create_sensor_manifold(l,"ROT_RIGHT",d.CT_CONTINUOUS,[a,xa,K,Ha],Ma,y)):r?(d.create_sensor_manifold(l,"LEFT",d.CT_CONTINUOUS,[a,oa,I,u],Fa,y),d.create_sensor_manifold(l,"RIGHT",d.CT_CONTINUOUS,[a,xa,K,u],Ma,y),d.create_sensor_manifold(l,"FORWARD",d.CT_CONTINUOUS,[a,Ca,C,La],Fa,y),d.create_sensor_manifold(l,"BACKWARD",d.CT_CONTINUOUS,[a,ia,E,La],Ma,y),d.create_sensor_manifold(l,"UP",d.CT_CONTINUOUS,[a,da,H],la,y),d.create_sensor_manifold(l,"DOWN",d.CT_CONTINUOUS,
[a,Q,H],Ba,y)):(d.create_sensor_manifold(l,"UP",d.CT_CONTINUOUS,[a,Q,b],P,y),d.create_sensor_manifold(l,"DOWN",d.CT_CONTINUOUS,[a,da,v],P,y),d.create_sensor_manifold(l,"LEFT",d.CT_CONTINUOUS,[a,I,u],Ba,y),d.create_sensor_manifold(l,"RIGHT",d.CT_CONTINUOUS,[a,K,u],la,y),d.create_sensor_manifold(l,"ROT_UP",d.CT_CONTINUOUS,[a,Ca,H],Ba,y),d.create_sensor_manifold(l,"ROT_DOWN",d.CT_CONTINUOUS,[a,ia,H],la,y),d.create_sensor_manifold(l,"ROT_LEFT",d.CT_CONTINUOUS,[a,oa,Ha],Ba,y),d.create_sensor_manifold(l,
"ROT_RIGHT",d.CT_CONTINUOUS,[a,xa,Ha],la,y));if(!c){var ta=0;c=d.create_mouse_wheel_sensor(f);var Ka=0,y=d.create_touch_zoom_sensor(f);d.create_sensor_manifold(l,"MOUSE_WHEEL",d.CT_LEVEL,[c],null,function(a,b,c){1==c&&(b=d.get_sensor_value(a,b,0),z.get_velocities(a,t),m||r?ta=k(a,b,t.zoom,ta,2,m):(t.trans*=1+b*t.zoom,z.set_velocities(a,t)))});d.create_sensor_manifold(l,"TOUCH_ZOOM",d.CT_LEVEL,[y],null,function(a,b,c,e){1==c&&(c=d.get_sensor_value(a,b,0),z.get_velocities(a,t),d.get_sensor_payload(a,
b,0)===d.PL_MULTITOUCH_MOVE_ZOOM&&(Ka=k(a,c,.03*t.zoom,Ka,2,m)))});d.create_sensor_manifold(l,"ZOOM_INTERPOL",d.CT_POSITIVE,[a],null,function(a,b,c){if(m||r)1E-5<Math.abs(ta)||1E-5<Math.abs(Ka)?(c=d.get_sensor_value(a,b,0),b=L.smooth(ta,0,c,.1*U),ta-=b,c=L.smooth(Ka,0,c,.15*U),Ka-=c,r?n(a,-(b+c)):(b=z.target_get_distance(a)+b+c,b=Math.max(b,.001),z.target_set_distance(a,b))):Ka=ta=0})}var ka=0,Za=0,qa=0,O=0;c=function(a,b,c,e){if(1==c){c=d.get_sensor_value(a,b,1);z.get_velocities(a,t);if(r)g=.003*
t.trans,f=7.5E-4*t.rot;else var g=.003*t.rot,f=7.5E-4*t.trans;if(1===d.get_sensor_payload(a,b,0).which)ka+="X"==e?-c*g:0,Za+="Y"==e?-c*g:0;else if(2===d.get_sensor_payload(a,b,0).which||3===d.get_sensor_payload(a,b,0).which)qa+="X"==e?-c*f:0,O+="Y"==e?-c*f:0}};var Ia=0,Sa=0,y=function(a,b,c){z.get_velocities(a,t);Ia+=.002*t.trans};C=function(a,b,c){z.get_velocities(a,t);Sa+=.05*t.zoom};E=function(a,b,c){z.get_velocities(a,t);Ia-=.002*t.trans};I=function(a,b,c){z.get_velocities(a,t);Sa-=.05*t.zoom};
m?(d.create_sensor_manifold(l,"GMPD_PAN_Y_POS",d.CT_CONTINUOUS,[b],null,C),d.create_sensor_manifold(l,"GMPD_PAN_Y_NEG",d.CT_CONTINUOUS,[v],null,I),d.create_sensor_manifold(l,"GMPD_PAN_X_POS",d.CT_CONTINUOUS,[u],function(a){return-.1>a[0]},E),d.create_sensor_manifold(l,"GMPD_PAN_X_NEG",d.CT_CONTINUOUS,[u],function(a){return.1<a[0]},y)):r&&(d.create_sensor_manifold(l,"GMPD_PAN_X_POS",d.CT_CONTINUOUS,[Ha],function(a){return-.1>a[0]},E),d.create_sensor_manifold(l,"GMPD_PAN_X_NEG",d.CT_CONTINUOUS,[Ha],
function(a){return.1<a[0]},y));if(h){h=d.create_mouse_move_sensor("X",window);b=d.create_mouse_move_sensor("Y",window);var v=d.create_mouse_click_sensor(f),u=d.create_mouse_click_sensor(window),Ja=!1,Ha=function(a){a[2]?Ja=!0:a[0]||(Ja=!1);return Ja&&a[0]};d.create_sensor_manifold(l,"MOUSE_X",d.CT_POSITIVE,[u,h,v],Ha,c,"X");d.create_sensor_manifold(l,"MOUSE_Y",d.CT_POSITIVE,[u,b,v],Ha,c,"Y");h=M.get_device_by_type_element(M.DEVICE_MOUSE,window);M.switch_prevent_default(h,!1)}else h=d.create_mouse_move_sensor("X",
f),b=d.create_mouse_move_sensor("Y",f),v=d.create_mouse_click_sensor(f),d.create_sensor_manifold(l,"MOUSE_X",d.CT_POSITIVE,[v,h],null,c,"X"),d.create_sensor_manifold(l,"MOUSE_Y",d.CT_POSITIVE,[v,b],null,c,"Y");var Ta=0,eb=0,Va=0,Da=0;h=d.create_touch_move_sensor("X",f);f=d.create_touch_move_sensor("Y",f);b=function(a,b,c,e){if(1==c){z.get_velocities(a,t);var g=r?.003*t.trans:.003*t.rot;c=d.get_sensor_value(a,b,0);d.get_sensor_payload(a,b,0).gesture===d.PL_SINGLE_TOUCH_MOVE?(Ta+="X"==e?-c*g:0,eb+=
"Y"==e?-c*g:0):d.get_sensor_payload(a,b,0).gesture===d.PL_MULTITOUCH_MOVE_PAN&&(a=r?.003*t.rot:7.5E-4*t.trans,Va+="X"==e?-c*a:0,Da+="Y"==e?-c*a:0)}};d.create_sensor_manifold(l,"TOUCH_X",d.CT_POSITIVE,[h],null,b,"X");d.create_sensor_manifold(l,"TOUCH_Y",d.CT_POSITIVE,[f],null,b,"Y");d.create_sensor_manifold(l,"ROT_TRANS_INTERPOL",d.CT_POSITIVE,[a],null,function(a,b,c){if(1E-5<Math.abs(ka)||1E-5<Math.abs(Za)||1E-5<Math.abs(Ta)||1E-5<Math.abs(eb)||1E-5<Math.abs(qa)||1E-5<Math.abs(O)||1E-5<Math.abs(Va)||
1E-5<Math.abs(Da)||1E-5<Math.abs(Ia)||1E-5<Math.abs(Sa)){var f=d.get_sensor_value(a,b,0),h=L.smooth(ka,0,f,.08*U),k=L.smooth(Za,0,f,.08*U);ka-=h;Za-=k;var l=L.smooth(Ta,0,f,.12*U),n=L.smooth(eb,0,f,.12*U);Ta-=l;eb-=n;b=L.smooth(qa,0,f,.08*U);var p=L.smooth(O,0,f,.08*U);qa-=b;O-=p;c=L.smooth(Va,0,f,.12*U);var t=L.smooth(Da,0,f,.12*U);Va-=c;Da-=t;var v=L.smooth(Ia,0,f,.08*U),f=L.smooth(Sa,0,f,.08*U);Ia-=v;Sa-=f;m?(z.target_rotate(a,h+l,k+n),k=z.target_get_distance(a),z.target_pan_pivot(a,k*(b+c+v),
k*(p+t+f))):r?(h+l&&e(a,L.AXIS_X,.2*(h+l)),k+n&&(p=z.get_camera_angles(a,Z)[1],p=Math.abs(p)>Math.PI/4?L.AXIS_MY:L.AXIS_Z,e(a,p,.2*(k+n))),z.hover_rotate(a,b+c+v,0)):(z.eye_rotate(a,.5*(h+l),.5*(k+n)),q&&(a=z.get_camera_angles_char(a,Y),g.set_character_rotation(q,a[0],a[1])))}});d.create_kb_sensor_manifold(l,"DEC_STEREO_DIST",d.CT_SHOT,d.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=z.get_stereo_distance(a);z.set_stereo_distance(a,.9*b)});d.create_kb_sensor_manifold(l,"INC_STEREO_DIST",d.CT_SHOT,d.KEY_RIGHT_SQ_BRACKET,
function(a,b,c){b=z.get_stereo_distance(a);z.set_stereo_distance(a,1.1*b)})}function A(a){var b=z.get_move_style(a),c=d.create_callback_sensor(function(){var c=z.get_move_style(a),d=c!=b;b=c;return d});d.create_sensor_manifold(a,"CHANGE_MOVE_STYLE",d.CT_POSITIVE,[c],null,function(a,b,c){E();m(T,W,ha)})}function E(){var a=G.get_active_camera();d.check_sensor_manifold(a,"TOGGLE_CHAR_MOVE_TYPE")&&G.get_first_character()&&D.remove(a);for(var b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL CHANGE_MOVE_STYLE TOGGLE_CHAR_MOVE_TYPE".split(" "),
c=0;c<b.length;c++)d.remove_sensor_manifold(a,b[c])}function w(a,b,c,d){var e=document.createElement("div"),g=document.createElement("div"),f=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";g.style.cssText="color:#fff;font-size:24px;";f.style.cssText="color:#fff;font-size:20px;";g.innerHTML=a;f.innerHTML=
b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(g);e.appendChild(f);document.body.appendChild(e)}function v(a,b,c,d,e){function g(){var h=performance.now()-f;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&x.remove_loop_cb(g)}var f=performance.now();x.append_loop_cb(g)}r("animation");var z=r("camera"),y=r("config"),D=r("constraints"),K=r("container"),d=r("controls"),t=r("data"),C=r("debug"),M=r("input"),x=r("main"),g=r("physics"),H=r("print"),
G=r("scenes"),ba=r("transform"),L=r("util"),F=r("vec3"),U=1,Q=null,T=!1,W=!1,ha=!1,Y=new Float32Array(2),Z=new Float32Array(2),N=new Float32Array(3),ca=new Float32Array(3);new Float32Array(3);var I=new Float32Array(4),ma={},da={};a.init=function(a){a=a||{};var c=!1,e=null,g=function(){},k=null,m=null,n=0,p=null,q=!0,r=!1,v=!0,w=!0,z=!1,A=!1,B=!1,G=!1,F=y.get("quality"),D;for(D in a)switch(D){case "canvas_container_id":e=a.canvas_container_id;break;case "callback":g=a.callback;break;case "autoresize":c=
a.autoresize;break;case "show_hud_debug_info":B=a.show_hud_debug_info;break;case "sfx_mix_mode":z=a.sfx_mix_mode;break;case "show_fps":A=a.show_fps;break;case "track_container_position":G=a.track_container_position;break;case "fps_wrapper_id":p=a.fps_wrapper_id;break;case "fps_elem_id":m=a.fps_elem_id;break;case "error_purge_elements":k=a.error_purge_elements;break;case "report_init_failure":w=a.report_init_failure;break;case "pause_invisible":v=a.pause_invisible;break;case "key_pause_enabled":q=
a.key_pause_enabled;break;case "force_container_ratio":n=a.force_container_ratio;break;case "min_capabilities":r=a.min_capabilities;break;case "quality":F=a.quality;break;default:y.set(D,a[D])}a=function(a){a.keyCode==d.KEY_P&&(x.is_paused()?x.resume():x.pause())};q&&document.addEventListener("keydown",a,!1);y.set("show_hud_debug_info",B);y.set("sfx_mix_mode",z);var E=B||z||null,q=function(){var a=b(e,E,w,k),d=K.get_canvas();if(a){var q=K.get_container();K.resize_to_container();A&&(f(m,p),x.set_fps_callback(l));
v&&(u(),h());n&&x.append_loop_cb(function(){q.style.height=q.clientWidth/n+"px"});c&&x.append_loop_cb(function(){K.resize_to_container()});G&&x.append_loop_cb(function(){K.force_offsets_updating()});r&&y.reset_limits();F==y.P_AUTO?C.test_performance(function(a,b){0==a?(H.log("QUALITY TEST RESULT: UNSUPPORTED, using HIGH"),y.apply_quality(y.P_HIGH)):1.5>b?(H.log("QUALITY TEST RESULT: LOW ("+b.toFixed(1)+" GB/s)"),y.apply_quality(y.P_LOW)):(H.log("QUALITY TEST RESULT: HIGH ("+b.toFixed(1)+" GB/s)"),
y.apply_quality(y.P_HIGH));g(d,!0)}):g(d,!0)}else g(d,!1)};"complete"==document.readyState?window.setTimeout(q,0):window.addEventListener("load",q,!1);window.addEventListener("unload",function(){t.cleanup()},!1)};a.resize_to_container=function(){H.error_deprecated("app.resize_to_container","container.resize_to_container");K.resize_to_container()};a.set_onclick=function(a,b){var c=q(a);c.addEventListener("mouseup",function(a){b(c.value)},!1)};a.set_onchange=function(a,b){var c=q(a);c.addEventListener("change",
function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=q(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=m;a.disable_camera_controls=E;a.set_camera_move_style=function(a){H.error_deprecated_arr("app.set_camera_move_style",["camera.static_setup","camera.eye_setup","camera.target_setup","camera.hover_setup","camera.hover_setup_rel"]);var b=G.get_active_camera();z.set_move_style(b,a)};a.enable_object_controls=function(a,
b){var c=g.is_vehicle_chassis(a)||g.is_vehicle_hull(a),e=function(a,b,e){if(1==e)switch(e=d.get_sensor_value(a,b,0),b){case "FORWARD":c?g.vehicle_throttle(a,1):ba.move_local(a,0,-1*e,0);break;case "BACKWARD":c?g.vehicle_throttle(a,-1):ba.move_local(a,0,1*e,0);break;case "LEFT":c?g.vehicle_steer(a,-1):ba.move_local(a,1*e,0,0);break;case "RIGHT":c?g.vehicle_steer(a,1):ba.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":c&&g.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":c&&
g.vehicle_steer(a,0)}},f=d.create_elapsed_sensor(),h=d.create_keyboard_sensor(d.KEY_W),k=d.create_keyboard_sensor(d.KEY_S),l=d.create_keyboard_sensor(d.KEY_A),m=d.create_keyboard_sensor(d.KEY_D),n=d.create_keyboard_sensor(d.KEY_UP),p=d.create_keyboard_sensor(d.KEY_DOWN),q=d.create_keyboard_sensor(d.KEY_LEFT),r=d.create_keyboard_sensor(d.KEY_RIGHT),t=function(a){return a[0]&&(a[1]||a[2])};d.create_sensor_manifold(a,"FORWARD",d.CT_CONTINUOUS,[f,h,n],t,e);d.create_sensor_manifold(a,"BACKWARD",d.CT_CONTINUOUS,
[f,k,p],t,e);d.create_sensor_manifold(a,"LEFT",d.CT_CONTINUOUS,[f,l,q],t,e);d.create_sensor_manifold(a,"RIGHT",d.CT_CONTINUOUS,[f,m,r],t,e)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)d.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){H.error_once("app.enable_controls() deprecated")};a.disable_controls=function(){H.error_once("app.disable_controls() deprecated")};a.enable_debug_controls=function(){d.create_kb_sensor_manifold(null,
"CAMERA_SHOT",d.CT_SHOT,d.KEY_K,function(){C.make_camera_frustum_shot()});d.create_kb_sensor_manifold(null,"LIGHT_SHOT",d.CT_SHOT,d.KEY_L,function(){C.make_light_frustum_shot()});d.create_kb_sensor_manifold(null,"TELEMETRY",d.CT_SHOT,d.KEY_T,function(){C.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",
d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||
a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen?a.requestFullScreen():H.error("B4W App: request fullscreen method is not supported")};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;"function"!=typeof a&&H.error("B4W App: exit fullscreen method is not supported");a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||
window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=w;a.get_url_params=function(a){a=!!a;var b=decodeURIComponent(location.href.toString());if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),g=e[0];1<e.length?(e=e[1],a?g in c?c[g].push(e):c[g]=[e]:c[g]=e):a?g in c||(c[g]=[]):c[g]=""}return c};a.css_animate=function(a,b,c,d,e,g,f,h){function k(e){a&&(l[b]=g+e+f,c>d&&e<=d||c<d&&e>=d)&&
(l[b]=g+d+f,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){g=g||"";f=f||"";h=h||function(){};var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;v(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,g){function f(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),g())}a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(g=g||function(){},v(a,
c,d,e,f))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,g=c.from,f=c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,g,f,h,k,l,m):"attr"==c.type&&a.attr_animate(d,e,g,f,h,m)}};a.set_camera_smooth_factor=function(a){U=a};a.get_camera_smooth_factor=function(){return U}};b4w.module.camera_anim=function(a,r){function u(a,b,c,d,e){c=p.angle_wrap_0_2pi(b-c);c=Math.min(c,2*Math.PI-c);b=p.angle_wrap_0_2pi(d-b);b=Math.min(b,2*Math.PI-b);if(1E-6>Math.abs(c)||1E-6>2*Math.PI-Math.abs(c))c=0;if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;h.is_eye_camera(a)?(e[0]=b,e[1]=c):(e[0]=c,e[1]=b);return e}var h=r("camera"),b=r("controls"),f=r("print"),l=r("scenes"),q=r("time"),e=r("transform"),n=r("tsr"),p=r("util"),B=r("vec3"),c=r("quat"),k=new Float32Array(2),m=new Float32Array(2),
A=new Float32Array(3),E=new Float32Array(3),w=new Float32Array(3),v=new Float32Array(4),z=n.create(),y=n.create(),D=n.create(),K={},d=!1,t=!1,C=!1,M=!1;a.track_to_target=function(a,d,l,m,n,q,r,t){if(!h.is_eye_camera(a))f.error("track_to_target(): wrong object");else if(a&&d){if(p.is_vector(d))var u=d;else u=w,e.get_object_center(d,!1,u);d=l||1;l=m||2;var y=n||1;n=q||1;E[0]=0;E[1]=-1;E[2]=0;var z=e.get_rotation(a);q=p.quat_to_dir(z,E);m=h.get_camera_angles(a,k);var C=e.get_translation(a);B.subtract(u,
C,A);B.normalize(A,A);var D=c.rotationTo(q,A,c.create());c.multiply(D,z,v);p.correct_cam_quat_up(v,!1);B.subtract(u,C,E);var M=B.length(E)*(1-1/l),u=Math.asin(A[1]);l=Math.acos(-A[2]/Math.abs(Math.cos(u)));0<A[0]&&(l=2*Math.PI-l);var K=l-m[0],ca=u-m[1];w[0]=0;w[1]=0;w[2]=-1;l=e.get_rotation(a);0>p.quat_to_dir(l,w)[1]?(ca=0<q[1]?u-Math.PI+m[1]:u+Math.PI+m[1],K=0<K?-Math.PI+K:Math.PI+K):Math.abs(K)>Math.PI&&(K=0<K?K-2*Math.PI:K+2*Math.PI);var I=0,u=b.create_elapsed_sensor();q=Math.abs(K/d);d=Math.abs(ca/
d);var ma=q>d?q:d,da=ma+y,fa=da+n,Aa=fa+y,ra=K,S=ca,R=M,sa=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");r&&r()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[u],null,function(a,c,d){if(d)if(h.is_eye_camera(a))if(d=b.get_sensor_value(a,c,0),I+=d,I<ma){var g=K/ma*d;d*=ca/ma;c=I/ma;c=6*c*(1-c);g*=c;d*=c;ra-=g;S-=d;h.eye_rotate(a,g,d)}else I<da?(ra&&(h.eye_rotate(a,ra,S),ra=0,t&&t()),c=(I-ma)/y,d=-M*d/y,R-=g,e.move_local(a,0,6*d*c*(1-c),0)):I<fa?R&&(e.move_local(a,0,R,0),R=
0):I<Aa?(c=(I-fa)/y,d=M*d/y,d=6*d*c*(1-c),e.move_local(a,0,d,0)):(e.set_translation_v(a,C),sa());else sa()})}};a.auto_rotate=function(a,c,d){function e(c,d,g){if(1==g)if(g=h.get_move_style(c),g==h.MS_STATIC)n();else if(g!=h.MS_TARGET_CONTROLS&&g!=h.MS_EYE_CONTROLS||!h.has_horizontal_rot_limits(c))r=null,d=b.get_sensor_value(c,d,0),h.rotate_camera(c,d*a,0);else{g=g==h.MS_EYE_CONTROLS?h.eye_get_horizontal_limits(c,K):h.target_get_horizontal_limits(c,K);if(null===r||g.left!=r.left||g.right!=r.right){r=
r||{};r.left=g.left;r.right=g.right;t=Math.min(.2,p.angle_wrap_0_2pi(r.right-r.left)/2);g=q;var f=r,l=h.get_camera_angles(g,k)[0];g=u(g,l,f.left,f.right,m);v=a*Math.min(1,g[0]/.2,g[1]/.2)}d=b.get_sensor_value(c,d,0);g=h.get_camera_angles(c,k)[0];g=u(c,g,r.left,r.right,m);g[1]>t&&g[0]>t?v=p.sign(v)*a:g[1]<t?v-=Math.pow(a,2)/.4*d:g[0]<t&&(v+=Math.pow(a,2)/.4*d);h.rotate_camera(c,d*v,0)}}function n(){b.remove_sensor_manifold(q,"AUTO_ROTATE");b.remove_sensor_manifold(q,"DISABLE_AUTO_ROTATE");c()}c=c||
function(){};var q=l.get_active_camera();if(h.is_static_camera(q))f.error("auto_rotate(): Wrong camera move style");else{var r={},t=0,v=0;if(b.check_sensor_manifold(q,"AUTO_ROTATE"))n();else{var w=b.create_mouse_move_sensor("X"),y=b.create_mouse_move_sensor("Y"),z=b.create_mouse_click_sensor(),A=b.create_touch_move_sensor(),B=b.create_touch_zoom_sensor(),C=b.create_elapsed_sensor();d=d?b.create_mouse_wheel_sensor():b.create_custom_sensor(0);b.create_sensor_manifold(q,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,
[w,y,z,A,B,d],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]||a[5]},n);b.create_sensor_manifold(q,"AUTO_ROTATE",b.CT_CONTINUOUS,[C],function(a){return a[0]},e)}}};a.is_auto_rotate=function(){var a=l.get_active_camera();return b.check_sensor_manifold(a,"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=l.get_active_camera();return h.get_move_style(a)==h.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,c,k,l){if(h.get_move_style(a)!=h.MS_STATIC)f.error("move_camera_to_point(): wrong camera type");
else if(!d)if(a)if(b){c=c||1;k=k||.01;var m=p.is_vector(a)?a:e.get_tsr(a,z),r=p.is_vector(b)?b:e.get_tsr(b,y);b=B.distance(n.get_trans_view(m),n.get_trans_view(r))/c;c=p.quat_to_dir(n.get_quat_view(m),p.AXIS_MZ,A);var t=p.quat_to_dir(n.get_quat_view(r),p.AXIS_MZ,E);c=Math.min(Math.abs(B.dot(c,t)),1);k=Math.acos(c)/k;k=1E3*Math.max(b,k);d=!0;var v=q.animate(0,1,k,function(b){var c=n.interpolate(m,r,p.smooth_step(b),D);C?(q.clear_animation(v),d=C=!1):(e.set_tsr(a,c),1==b&&(d=!1,l&&l()))})}else f.error("move_camera_to_point(): you must specify the point object");
else f.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=function(a,b,c,d,e){if(h.get_move_style(a)==h.MS_STATIC)f.error("rotate_camera(): not supported for STATIC cameras");else if(!t)if(a)if(b||c){t=!0;var k=0,l=0,m=0!=b?b:c,n=q.animate(0,m,d||1E3,function(d){M?(q.clear_animation(n),t=M=!1):(k-=d,l-=d,c&&b?h.rotate_camera(a,k,l):c?h.rotate_camera(a,0,l):b&&h.rotate_camera(a,k,0),l=k=d,d==m&&(t=!1,e&&e()))})}else f.error("rotate_camera(): you must specify the rotation angle");
else f.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){C=!0};a.stop_cam_rotating=function(){M=!0};a.is_moving=function(){return d};a.is_rotating=function(){return t}};b4w.module.gp_conf=function(a,r){function u(){g.length=0;for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],b=0;b<a.length;b++)a[b]&&g.push(a[b]);return g}function h(a){var b=A.get(a+"_gmpd_stngs","b4w");if(b){var b=JSON.parse(b),c;for(c in b)m.set_gamepad_key(a,c,b[c])}else c=JSON.stringify(w),A.set(a+"_gmpd_stngs",c,"b4w")}function b(a){L=!0;var b=document.createElement("div"),c=document.createElement("div"),e=document.createElement("div"),
g=document.createElement("div"),f=document.createElement("div"),h=document.createElement("div"),k=document.createElement("div"),l=document.createElement("div"),p=document.createElement("div"),q=document.createElement("div"),r=document.createElement("div"),t=document.createElement("div"),u=document.createElement("div"),x=document.createElement("div"),w=document.createElement("div"),y=document.createElement("div"),z=document.createElement("div"),A=document.createElement("div"),B=document.createElement("div"),
F=document.createElement("div"),C=document.createElement("div"),D=document.createElement("div");d=b;b.style.cssText="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg26627" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="128.51mm" viewBox="0 0 636.63517 455.33329" width="179.67mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/"><defs id="defs26629"><linearGradient id="linearGradient4691"><stop id="stop4693" offset="0"/><stop id="stop4695" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4358"><stop id="stop4360" stop-color="#2e2e2e" offset="0"/><stop id="stop4362" stop-color="#2e2e2e" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4364" x1="1141.5" xlink:href="#linearGradient4358" gradientUnits="userSpaceOnUse" y1="255.95" gradientTransform="matrix(-1 0 0 1 1531.4 560.1)" x2="1165.2" y2="309.88"/><linearGradient id="linearGradient4368" x1="1141.5" xlink:href="#linearGradient4358" gradientUnits="userSpaceOnUse" y1="255.95" gradientTransform="translate(-896.37 560.1)" x2="1165.2" y2="309.88"/><linearGradient id="linearGradient4430" x1="959.32" gradientUnits="userSpaceOnUse" y1="653.07" gradientTransform="matrix(-1 0 0 1 1531.4 70.097)" x2="1467.6" y2="653.07"><stop id="stop4426" stop-color="#4f4f4f" offset="0"/><stop id="stop4428" stop-color="#4f4f4f" stop-opacity="0" offset="1"/></linearGradient><linearGradient id="linearGradient4701" x1="529.91" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="111.1" gradientTransform="translate(-52.276 546.89)" x2="481.49" y2="85.746"/><linearGradient id="linearGradient4713" x1="529.91" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="111.1" gradientTransform="matrix(-1 0 0 1 689.01 546.89)" x2="481.49" y2="85.746"/><linearGradient id="linearGradient4725" x1="367.39" xlink:href="#linearGradient4691" gradientUnits="userSpaceOnUse" y1="125.6" gradientTransform="matrix(-1.3272 0 0 .68317 806.95 579.14)" x2="367.39" y2="116.11"/></defs><metadata id="metadata26632"><rdf:RDF><cc:Work rdf:about="">    <dc:format>image/svg+xml</dc:format>    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>    <dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -597.03)"><g id="g20" fill-rule="evenodd"><path id="path4209" fill="#434343" d="m576.71 1052.4c42.015-1.9097 64.296-46.468 59.204-122.86-5.0928-76.387-27.374-175.69-44.562-224.7-17.188-49.015-25.501-62.531-26.737-65.565-3.7697-9.2504-11.278-19.949-62.379-27.691-28.97-4.3891-16.697-7.9577-27.084-9.4696-17.96-2.6141-43.609-1.229-52.203 1.6354-8.594 2.8645-12.709 29.16-24.486 35.207-11.777 6.0473-19.416 10.185-80.149 10.185s-68.372-4.1376-80.149-10.185c-11.777-6.0473-18.113-32.099-25.736-36.993-11.183-7.1796-26.985-5.6722-54.891-0.57481-5.64 1.0302-1.1304 7.6212-18.165 12.509-32.913 9.4438-52.094 3.7056-65.087 20.831-1.9807 2.6106-11.822 21.096-29.01 70.111-17.179 48.95-39.46 148.25-44.553 224.64-5.0929 76.39 17.188 120.99 59.204 122.89 73.339-1.7 55.219-116.53 258.4-116.53s185.05 114.82 258.4 116.49z"/><path id="path4366" fill="url(#linearGradient4368)" d="m249.77 838.51c-107.76 0-171.55 96.288-176.84 121.23-5.2294 24.634-17.658 55.705 3.8195 53.789 9.6996-0.8655 18.053-15.713 37.559-38.193 18.78-21.643 41.379-54.425 96.763-54.425s73.209-44.877 75.119-53.152c1.9098-8.2752 2.4146-27.976-36.418-29.25z"/><path id="path4217" fill="url(#linearGradient4364)" d="m385.23 838.51c107.76 0 171.55 96.288 176.84 121.23 5.2293 24.634 17.658 55.705-3.8195 53.789-9.6996-0.8655-18.053-15.713-37.559-38.193-18.78-21.643-41.379-54.425-96.763-54.425s-73.209-44.877-75.119-53.152c-1.9098-8.2752-2.4146-27.976 36.418-29.25z"/><path id="path4370" fill="url(#linearGradient4430)" d="m572.06 654.81c-60.48-19.09-76.79-18.6-89.84-17.96-13.05 0.63657-22.638 16.617-45.237 49.4s-67.48 125.27-116.23 125.27c-48.746 0-93.626-92.491-116.23-125.27-22.599-32.783-32.008-48.942-45.059-49.579-13.05-0.63648-35.251 1.8354-95.728 20.932l1.1161-2.3404c60.494-19.1 81.754-20.83 94.804-20.19 13.05 0.63657 22.281 13.049 44.88 45.832s67.48 123.49 116.23 123.49c48.746 0 93.626-90.709 116.23-123.49 22.599-32.783 31.83-45.195 44.88-45.832 13.05-0.63648 28.783-1.6248 89.26 17.472"/><path id="path4315" fill="#343434" d="m570.99 652.48c-60.477-19.097-76.074-18.269-89.124-17.633-13.05 0.63658-22.281 14.832-44.88 47.614-22.599 32.783-67.48 125.27-116.23 125.27-48.746 0-93.626-92.491-116.23-125.27-22.599-32.783-31.83-46.978-44.88-47.614-13.05-0.63648-34.715 1.2996-95.192 20.396l1.1161-2.3404c60.474-19.1 81.024-22.26 94.074-21.62 13.05 0.63658 22.281 13.049 44.88 45.832s67.48 123.49 116.23 123.49c48.746 0 93.626-90.709 116.23-123.49 22.599-32.783 31.83-45.195 44.88-45.832 13.05-0.63647 27.71-0.17274 88.186 18.924"/></g><g id="g15645" transform="matrix(.75439 0 0 1 1558.5 -6638.3)" fill-rule="evenodd"><rect id="rect15584" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="2" ry="1.8461" height="44.307" width="570" y="6558.3" x="100.71" fill="#4164bb"/><rect id="rect15331" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="2" ry="1.8461" height="44.307" width="570" y="6554.6" x="100.71" fill="#5276cf"/></g><text id="text15623-9" style="word-spacing:0px;letter-spacing:0px" font-weight="300" xml:space="preserve" font-size="22px" line-height="430.99999428%" y="-53.755863" x="1792.7805" font-family="&apos;Noto Sans CJK TC&apos;" fill="#ffffff"><tspan id="tspan15625-5" y="-53.755863" x="1792.7805"/></text><text id="text15657" style="word-spacing:0px;letter-spacing:0px" font-weight="300" xml:space="preserve" font-size="13px" line-height="430.99999428%" y="-3.7607465" x="1670.2437" font-family="&apos;Noto Sans CJK TC&apos;" fill="#828282"><tspan id="tspan15659" y="-3.7607465" x="1670.2437"/></text><g id="g34" fill-rule="evenodd"><path id="path4675" fill="#303030" d="m551.75 628.4c9.3003 4.1796 8.2375 11.558 2.1302 9.9581-6.1073-1.6003-33.792-9.1405-46.239-11.577-12.446-2.4363-34.904-3.0623-36.951-4.0165-2.0474-0.95416 0.93313-7.7247 5.491-7.3449 23.258 0.91012 59.905 6.0339 75.569 12.98z"/><path id="path4677" fill="#303030" d="m474.88 602.61c3.6488 0.63684 4.1169 1.3708 2.4115 5.2499-0.80967 1.8416-1.261 3.904-3.4715 3.7336-4.456-0.34344-16.578-1.2846-25.692-1.3764-9.1139-0.0918-23.83 1.217-25.307 0.79399-1.4771-0.42301-1.8834-4.9141 1.7769-6.7458 4.6221-1.3593 38.698-3.2021 50.281-1.6553z"/><path id="path4699" opacity=".384" fill="url(#linearGradient4701)" d="m475.53 611.7c-11.693-0.63604-8.4597-0.73151-44.068 54.448-6.5182 8.6489-22.874 37.231-36.865 35.326-6.7491-1.4177 15.436-67.299 22.724-75.767 11.112-12.911 19.255-16.122 58.209-14.007z"/><path id="path4703" fill="#303030" d="m84.068 628.4c-9.3003 4.1796-8.2375 11.558-2.1302 9.9581 6.1073-1.6003 33.792-9.1405 46.239-11.577 12.446-2.4363 34.904-3.0623 36.951-4.0165 2.0474-0.95416-0.93313-7.7247-5.491-7.3449-23.258 0.91012-59.905 6.0339-75.569 12.98z"/><path id="path4705" fill="#303030" d="m161.86 602.61c-3.6488 0.63684-4.1169 1.3708-2.4115 5.2499 0.80967 1.8416 1.261 3.904 3.4715 3.7336 4.456-0.34344 16.578-1.2846 25.692-1.3764 9.1139-0.0918 23.83 1.217 25.307 0.79399 1.4771-0.42301 1.8834-4.9141-1.7769-6.7458-4.6221-1.3593-38.698-3.2021-50.281-1.6553z"/><path id="path4711" opacity=".384" fill="url(#linearGradient4713)" d="m161.2 611.7c11.693-0.63604 8.4597-0.73151 44.068 54.448 6.5182 8.6489 22.874 37.231 36.865 35.326 6.7491-1.4177-15.436-67.299-22.724-75.767-11.112-12.911-19.255-16.122-58.209-14.007z"/><path id="path4717" opacity=".115" fill="url(#linearGradient4725)" d="m413.37 645.84c-9.0496 10.007-29.401 19.937-36.775 19.937h-52.205c-31.171 0-37.359 0.34506-47.75 0.51758-10.39 0.17253-18.682 0.65628-23.653-3.278-5.0513-3.9977-24-15.425-24-15.425 53.346 4.1464 144.49 4.3368 184.38-1.7523z"/></g></g><g id="layer1-0" fill-rule="evenodd" transform="translate(159.08 -720.76)"><g id="g4527-3" transform="translate(-961.22,330.69)"><ellipse id="circle4233-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="circle4235-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="circle4237-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g><g id="g4523-1" transform="translate(-961.22,330.69)"><ellipse id="circle4239-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="circle4243-3" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g><g id="g3506" transform="translate(-961.22,330.69)"><ellipse id="ellipse3508" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="ellipse3510" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="ellipse3512" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g></g><g id="layer1-7" fill-rule="evenodd" transform="translate(352.57 -719.72)"><g id="g4527-3-4" transform="translate(-961.22,330.69)"><ellipse id="circle4233-8-8" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="circle4235-8-9" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="circle4237-7-3" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g><g id="g4523-1-1" transform="translate(-961.22,330.69)"><ellipse id="circle4239-4-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="circle4243-3-5" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g><g id="g3506-2" transform="translate(-961.22,330.69)"><ellipse id="ellipse3508-1" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="66.284" ry="66.279" cy="655.39" cx="1027.5" fill="#303030"/><ellipse id="ellipse3510-1" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="62.007" ry="62.003" cy="655.39" cx="1027.5" fill="#4c4c4c"/><ellipse id="ellipse3512-4" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="43.41" ry="43.408" cy="655.39" cx="1027.5" fill="#303030"/></g></g></svg>')+
"');width: 637px;height: 455px;background-size: 100% 100%;left: 50%;margin-bottom: 40px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);bottom: 0px;";c.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3904" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="35.924mm" width="35.926mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 127.29808 127.28933"><metadata id="metadata3909"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -925.07)"><ellipse id="circle4330" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="63.649" ry="63.645" cy="988.72" cx="63.649" fill="#303030"/><ellipse id="circle4223" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="59.705" ry="59.701" cy="988.72" cx="63.649" fill="#4c4c4c"/></g></svg>')+
"');position: absolute;top: 47px;left: 65px;width: 135px;height: 135px;";e.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4326" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1017.1c-15.254-3.8172-24.634-1.7612-34.31 0v16.247h0.015c-0.013 0.097-0.013 0.1951-0.015 0.2928 0.0006 9.4753 7.6813 18.256 17.156 18.256 9.4739-0.0005 17.154-8.7813 17.154-18.256 0-0.097-0.014-0.1952-0.014-0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 36px;height: 38px;left: 49px;top: 8px;position: absolute;";g.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m35.298 1017.6c3.8175 15.253 1.7611 24.633 0 34.308h-16.248v-0.015c-0.098 0.01-0.1952 0.01-0.2928 0.015-9.476-0.0006-18.258-7.6807-18.257-17.154 0.0005-9.4733 8.7818-17.153 18.257-17.153 0.098 0 0.1952 0.01 0.2928 0.011v-0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 38px;height: 36px;top: 47px;left: 84px;position: absolute;";f.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4328" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1049.7c-15.254 3.8172-24.634 1.7612-34.31 0v-16.247h0.015c-0.013-0.097-0.013-0.1951-0.015-0.2928 0.0006-9.4753 7.6813-18.256 17.156-18.256 9.4739 0.0005 17.154 8.7813 17.154 18.256 0 0.097-0.014 0.1952-0.014 0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 36px;height: 38px;bottom: 11px;left: 51px;position: absolute;";h.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m2.6552 1051.9c-3.8175-15.253-1.7611-24.633 0-34.308h16.248v0.015c0.098-0.01 0.1952-0.01 0.2928-0.015 9.476 0.0006 18.258 7.6807 18.257 17.154-0.0005 9.4733-8.7818 17.153-18.257 17.153-0.098 0-0.1952-0.01-0.2928-0.011v0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>')+
"');width: 38px;height: 36px;top: 47px;left: 13px;position: absolute;";k.style.cssText="position: absolute;top: 55px;left: 434px;width: 150px;height: 150px;";l.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;left: 53px;top: 0px;position: absolute;";p.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;left: 107px;top: 51px;position: absolute;";q.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;left: 53px;bottom: 0px;position: absolute;";r.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>')+
"');width: 50px;height: 50px;top: 51px;position: absolute;";t.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>')+
"');position: absolute;top: 222px;left: 183px;width: 85px;height: 85px;";u.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>')+
"');position: absolute;top: 223px;left: 376px;width: 85px;height: 85px;";x.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>')+
"');position: absolute;top: 76px;left: 227px;width: 34px;height: 34px;";w.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>')+
"');position: absolute;top: 76px;left: 376px;width: 34px;height: 34px;";y.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="21.241671mm" height="8.8544388mm" viewBox="0 0 75.265762 31.373996" id="svg3447" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="l1.svg"><defs id="defs3449" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.4" inkscape:cx="-254.57869" inkscape:cy="228.81952" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(1.5000945e-8,-1020.9882)"><path style="fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 11.026383,1051.1651 c -7.4440599,1.9144 -7.5133499,2.2466 -9.7963799,-4.4934 -1.81058997,-5.3452 -2.44278,-8.8152 4.01547,-12.116 2.74038,-1.4007 13.7365799,-5.877 38.4768299,-10.72 24.26031,-4.749 25.16653,-2.7967 26.79132,0.3418 1.15503,2.2311 1.8961,4.1561 2.94279,6.651 3.08552,8.5188 2.92609,8.5778 -6.08214,9.5501 -19.09891,2.1414 -37.95723,5.8307 -56.34789,10.7865 z" id="path4289" inkscape:connector-curvature="0" sodipodi:nodetypes="cssssccc" /></g></svg>')+
"');position: absolute;top: 4px;left: 78px;width: 79px;height: 33px;";z.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3447" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="8.8544mm" width="21.242mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 75.265762 31.373996"><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(1.5001e-8 -1021)"><path id="path4715" d="m64.239 1051.2c7.4441 1.9144 7.5134 2.2466 9.7964-4.4934 1.8106-5.3452 2.4428-8.8152-4.0155-12.116-2.7404-1.4007-13.737-5.877-38.477-10.72-24.26-4.749-25.167-2.7967-26.791 0.3418-1.155 2.2311-1.8961 4.1561-2.9428 6.651-3.0855 8.5188-2.9261 8.5778 6.0822 9.5501 19.099 2.1414 37.957 5.8307 56.348 10.786z" fill-rule="evenodd" fill="#5276cf"/></g></svg>')+
"');position: absolute;top: 4px;left: 477px;width: 79px;height: 33px;";A.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>')+
"');position: absolute;top: -7px;left: 425px;width: 50px;height: 17px;";B.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>')+
"');position: absolute;top: -7px;left: 164px;width: 50px;height: 17px;";F.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="24.603382mm" height="24.601696mm" viewBox="0 0 87.177338 87.171363" id="svg3640" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="main.svg"><defs id="defs3642" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.979899" inkscape:cx="61.113463" inkscape:cy="69.71796" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3645"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(0,-965.19093)"><ellipse ry="43.585682" rx="43.588669" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#2e2e2e;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="ellipse4372" cx="43.588669" cy="1008.7766" /><ellipse cy="1008.7766" cx="43.588669" id="circle4239-1" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:#4364b2;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" rx="40.056705" ry="40.053959" /><ellipse style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#434343;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="circle4243-0" cx="43.588669" cy="1008.7766" rx="31.455994" ry="31.453836" /></g></svg>')+
"');position: absolute;top: 68px;left: 274px;width: 92px;height: 92px;";C.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>')+
"');position: absolute;top: 186px;left: 148px;width: 157px;height: 157px;";D.style.cssText="background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>')+
"');position: absolute;top: 187px;left: 339px;width: 157px;height: 157px;";b.appendChild(C);b.appendChild(D);c.appendChild(e);c.appendChild(g);c.appendChild(f);c.appendChild(h);b.appendChild(c);k.appendChild(l);k.appendChild(p);k.appendChild(q);k.appendChild(r);b.appendChild(k);b.appendChild(t);b.appendChild(u);b.appendChild(x);b.appendChild(w);b.appendChild(y);b.appendChild(z);b.appendChild(A);a.appendChild(b);b.appendChild(B);b.appendChild(F);H.length=0;v.length=0;G.length=0;ba.length=0;H.push(q,
p,r,l,y,z,B,A,x,w,t,u,e,f,h,g,F);v.push('<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg id="svg3548" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="13.417mm" width="13.418mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 47.543997 47.542"><metadata id="metadata3553"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1004.8)"><ellipse id="circle4271" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="23.772" ry="23.771" cy="1028.6" cx="23.772" fill="#303030"/><ellipse id="circle4273" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="18.668" ry="18.667" stroke="#3b63c9" cy="1028.6" cx="23.772" fill="#5276cf"/></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="21.241671mm" height="8.8544388mm" viewBox="0 0 75.265762 31.373996" id="svg3447" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="l1.svg"><defs id="defs3449" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.4" inkscape:cx="-254.57869" inkscape:cy="228.81952" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(1.5000945e-8,-1020.9882)"><path style="fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 11.026383,1051.1651 c -7.4440599,1.9144 -7.5133499,2.2466 -9.7963799,-4.4934 -1.81058997,-5.3452 -2.44278,-8.8152 4.01547,-12.116 2.74038,-1.4007 13.7365799,-5.877 38.4768299,-10.72 24.26031,-4.749 25.16653,-2.7967 26.79132,0.3418 1.15503,2.2311 1.8961,4.1561 2.94279,6.651 3.08552,8.5188 2.92609,8.5778 -6.08214,9.5501 -19.09891,2.1414 -37.95723,5.8307 -56.34789,10.7865 z" id="path4289" inkscape:connector-curvature="0" sodipodi:nodetypes="cssssccc" /></g></svg>',
'<svg id="svg3447" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="8.8544mm" width="21.242mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 75.265762 31.373996"><metadata id="metadata3452"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(1.5001e-8 -1021)"><path id="path4715" d="m64.239 1051.2c7.4441 1.9144 7.5134 2.2466 9.7964-4.4934 1.8106-5.3452 2.4428-8.8152-4.0155-12.116-2.7404-1.4007-13.737-5.877-38.477-10.72-24.26-4.749-25.167-2.7967-26.791 0.3418-1.155 2.2311-1.8961 4.1561-2.9428 6.651-3.0855 8.5188-2.9261 8.5778 6.0822 9.5501 19.099 2.1414 37.957 5.8307 56.348 10.786z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',
'<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',
'<svg id="svg3560" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="4.7796mm" width="13.57mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 48.082162 16.935645"><metadata id="metadata3565"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1035.4)"><path id="path4727" d="m42.857 1052.2c4.7071 0.4081 4.7981 0.6563 5.1414-4.9139 0.16344-2.6517 0.16699-6.1108-0.72615-8.0342-0.59471-1.2808-1.7793-2.049-3.7642-2.4662-2.5264-0.531-16.253-1.4345-26.685-1.3241-15.118 0.16-15.362 1.4769-15.855 4.1522-0.35071 1.9018-0.5016 3.5056-0.74837 5.5967-0.55261 7.0693-0.44908 7.0921 5.0452 6.5411 11.661-1.1062 25.929-0.7359 37.592 0.4484z" fill-rule="evenodd" fill="#5276cf"/></g></svg>',
'<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>',
'<svg id="svg3699" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2811mm" width="9.2817mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.8879 32.88565"><metadata id="metadata3704"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" fill-rule="evenodd" transform="translate(0 -1019.5)"><ellipse id="ellipse4575" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="16.444" ry="16.443" cy="1035.9" cx="16.444" fill="#2e2e2e"/><ellipse id="ellipse4577" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" stroke-linecap="round" rx="15.112" ry="15.11" stroke="#4364b2" cy="1035.9" cx="16.444" fill="#5276cf"/><ellipse id="ellipse4579" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="11.867" ry="11.866" cy="1035.9" cx="16.444" fill="#434343"/></g></svg>',
'<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>',
'<svg id="svg3461" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="22.608mm" width="22.61mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 80.114398 80.108405"><metadata id="metadata3466"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(.0000019915 -972.25)"><g id="g3514-7" fill-rule="evenodd" transform="translate(-987.45 356.91)"><ellipse id="ellipse3516-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="40.057" ry="40.054" cy="655.39" cx="1027.5" fill="#3b63c9"/><ellipse id="ellipse3518-7" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" rx="36.23" ry="36.228" cy="655.39" cx="1027.5" fill="#5276cf"/></g></g></svg>',
'<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4326" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1017.1c-15.254-3.8172-24.634-1.7612-34.31 0v16.247h0.015c-0.013 0.097-0.013 0.1951-0.015 0.2928 0.0006 9.4753 7.6813 18.256 17.156 18.256 9.4739-0.0005 17.154-8.7813 17.154-18.256 0-0.097-0.014-0.1952-0.014-0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg id="svg3754" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.711mm" width="9.9653mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 35.3101 37.950677"><metadata id="metadata3759"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1014.4)"><path id="path4328" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m34.81 1049.7c-15.254 3.8172-24.634 1.7612-34.31 0v-16.247h0.015c-0.013-0.097-0.013-0.1951-0.015-0.2928 0.0006-9.4753 7.6813-18.256 17.156-18.256 9.4739 0.0005 17.154 8.7813 17.154 18.256 0 0.097-0.014 0.1952-0.014 0.2928h0.014z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m2.6552 1051.9c-3.8175-15.253-1.7611-24.633 0-34.308h16.248v0.015c0.098-0.01 0.1952-0.01 0.2928-0.015 9.476 0.0006 18.258 7.6807 18.257 17.154-0.0005 9.4733-8.7818 17.153-18.257 17.153-0.098 0-0.1952-0.01-0.2928-0.011v0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg id="svg3790" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.9646mm" width="10.711mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 37.953175 35.3077"><metadata id="metadata3795"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1017.1)"><path id="path4324" stroke-linejoin="round" style="color-rendering:auto;color:#000000;isolation:auto;mix-blend-mode:normal;shape-rendering:auto;solid-color:#000000;image-rendering:auto" d="m35.298 1017.6c3.8175 15.253 1.7611 24.633 0 34.308h-16.248v-0.015c-0.098 0.01-0.1952 0.01-0.2928 0.015-9.476-0.0006-18.258-7.6807-18.257-17.154 0.0005-9.4733 8.7818-17.153 18.257-17.153 0.098 0 0.1952 0.01 0.2928 0.011v-0.011z" fill-rule="evenodd" stroke="#4364b2" stroke-linecap="round" fill="#5276cf"/></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="24.603382mm" height="24.601696mm" viewBox="0 0 87.177338 87.171363" id="svg3640" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="main.svg"><defs id="defs3642" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.979899" inkscape:cx="61.113463" inkscape:cy="69.71796" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3645"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(0,-965.19093)"><ellipse ry="43.585682" rx="43.588669" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#2e2e2e;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="ellipse4372" cx="43.588669" cy="1008.7766" /><ellipse cy="1008.7766" cx="43.588669" id="circle4239-1" style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#5276cf;fill-opacity:1;fill-rule:evenodd;stroke:#4364b2;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" rx="40.056705" ry="40.053959" /><ellipse style="color:#000000;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;fill:#434343;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.99999994;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" id="circle4243-0" cx="43.588669" cy="1008.7766" rx="31.455994" ry="31.453836" /></g></svg>');
G.push(t,t,u,u);ba.push(C,D);for(a=0;a<H.length;a++)H[a].setAttribute("id","pad_btn_"+a),H[a].setAttribute("data-colorstate","B"),H[a].setAttribute("data-key",a),H[a].setAttribute("data-svgid",a);C.setAttribute("id","pad_left_axis");C.setAttribute("data-colorstate","GR");C.setAttribute("data-key",m.GMPD_AXIS_0);C.setAttribute("data-svgid",v.length);D.setAttribute("id","pad_right_axis");D.setAttribute("data-colorstate","GR");D.setAttribute("data-key",m.GMPD_AXIS_2);D.setAttribute("data-svgid",v.length+
1);v.push('<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>',
'<svg id="svg3407" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="41.787mm" width="41.786mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 148.0624 148.06251"><metadata id="metadata3412"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -904.3)" fill="#e6e6e6"><path id="rect4545" d="m74.031 904.3-14.469 22.156h8.0313v8.2187h12.875v-8.2187h8.0625l-14.5-22.156z"/><path id="rect4603" d="m125.94 963.86v8.0313h-8.25v12.906h8.25v8.0313l22.125-14.5-22.125-14.469z"/><path id="rect4609" d="m67.594 1022v8.25h-8.0313l14.469 22.125 14.5-22.125h-8.0625v-8.25h-12.875z"/><path id="rect4615" d="m22.156 963.86-22.156 14.47l22.156 14.5v-8.2188h8.2188v-12.906h-8.2188v-7.8438z"/><path id="path4619" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m54.393 924.58c-15.821 5.7885-28.404 18.385-34.188 34.219h11.156c4.6667-10.175 12.865-18.361 23.031-23.031v-11.188zm39.219 0.031v11.156c10.167 4.6713 18.361 12.86 23.031 23.031h11.156c-5.7846-15.821-18.379-28.393-34.188-34.188zm-73.375 73.438c5.7899 15.816 18.348 28.403 34.156 34.188v-11.156c-10.163-4.6691-18.364-12.861-23.031-23.031h-11.125zm96.406 0c-4.6712 10.167-12.868 18.361-23.031 23.031v11.125c15.796-5.7901 28.366-18.352 34.156-34.156h-11.125z"/></g></svg>');
n(H,E);n(ba,"#e6e6e6")}function f(a){return[k.create_gamepad_btn_sensor(m.GMPD_BUTTON_0,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_1,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_2,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_3,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_4,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_5,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_6,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_7,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_8,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_9,
a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_10,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_11,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_12,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_13,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_14,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_15,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_16,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_17,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_18,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_19,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_20,
a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_21,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_22,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_23,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_24,a),k.create_gamepad_btn_sensor(m.GMPD_BUTTON_25,a)]}function l(a){return[k.create_gamepad_axis_sensor(m.GMPD_AXIS_0,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_1,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_2,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_3,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_4,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_5,
a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_6,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_7,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_8,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_9,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_10,a),k.create_gamepad_axis_sensor(m.GMPD_AXIS_11,a)]}function q(a,b){var c=document.createElement("input");c.style.cssText="display: inline-block;position = relative;";c.setAttribute("type","radio");c.setAttribute("name","choice");var d=document.createElement("label");d.textContent=
b;d.style.cssText="position = relative;display: inline-block;color: white;";a.appendChild(c);a.appendChild(d);return c}function e(a){K.removeChild(d);d=null;switch(a){case "PAD":M.checked=!0;b(K);break;case "WHEEL":C.checked=!0;var c=K;L=!1;var e=document.createElement("div"),g=document.createElement("div"),f=document.createElement("div"),h=document.createElement("div"),k=document.createElement("div"),l=document.createElement("div"),p=document.createElement("div"),q=document.createElement("div"),
r=document.createElement("div"),t=document.createElement("div"),u=document.createElement("div"),x=document.createElement("div"),w=document.createElement("div"),y=document.createElement("div"),z=document.createElement("div"),A=document.createElement("div"),B=document.createElement("div"),F=document.createElement("div"),D=document.createElement("div"),na=document.createElement("div"),za=document.createElement("div"),V=document.createElement("div"),wa=document.createElement("div"),ga=document.createElement("div");
document.createElement("div");document.createElement("div");a=document.createElement("div");var X=document.createElement("div"),ea=document.createElement("div"),aa=document.createElement("div"),Ga=document.createElement("div"),ja=document.createElement("div");d=e;var pa="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>')+
"');width: 19px;height: 19px;background-size: 100% 100%;";e.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="112.08413mm" height="128.46834mm" viewBox="0 0 397.14849 455.20277" id="svg3440" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel.svg"><defs id="defs3442" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="0.98994949" inkscape:cx="421.01508" inkscape:cy="52.510802" inkscape:document-units="px" inkscape:current-layer="g87" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3445"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title /></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-2.3645008e-8,-597.15942)"><path inkscape:connector-curvature="0" style="fill:#4d4d4d;stroke:#6e6e6e;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path4140" d="m 307.84153,715.52552 c -4.35995,43.11849 -2.78952,86.66385 -15.90234,128.54337 -10.85452,25.86023 -13.33477,47.2976 6.91492,61.09536 7.23778,50.7442 78.38013,47.39232 82.20535,0 23.06079,-14.19054 13.49405,-42.79138 6.91492,-61.09536 -17.40045,-40.83001 -4.82581,-86.43019 -15.90235,-128.54337 -8.3177,-20.33228 -56.75348,-20.7661 -64.22927,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#cccccc;stroke:#1a1a1a;stroke-width:2.09465766;stroke-miterlimit:4;stroke-dasharray:none" id="path4266" d="m 313.11812,724.1957 -3.84514,68.80568 c 4.64168,13.40814 62.19981,10.8172 61.83082,0 l -3.84515,-68.80568 c -4.46942,-24.00369 -52.58756,-18.95946 -54.13979,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#353535;stroke:#2c2c2c;stroke-width:2.11880326;stroke-miterlimit:4;stroke-dasharray:none" id="path4156" d="m 304.91419,870.673 c -12.36924,67.40381 80.42804,69.69607 70.55134,0 -6.57605,-36.5947 -65.0964,-34.8253 -70.55134,0 z m 60.53812,3.9862 c 8.65841,48.24354 -57.58987,49.86644 -50.52489,0 4.7009,-26.27069 46.6394,-24.84292 50.52489,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#e6e6e6;stroke:#969696;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path4011" d="m 106.04576,696.97906 c -11.197076,4.25792 -17.123706,8.24834 -17.123706,8.24834 l -66.18493,16.33946 1.40291,30.64619 46.54715,-7.67623 c 17.00932,-1.6438 32.551896,8.94676 38.302026,23.34506 l 2.78663,65.4778 27.6363,0 2.78663,-65.4778 c 8.0428,-15.3291 20.46247,-27.10803 38.30202,-23.34506 l 46.54716,7.67623 1.40291,-30.64619 -66.18493,-16.33946 c 0,0 -5.92627,-3.99074 -17.12371,-8.24834 -13.45408,-4.31874 -26.62772,-4.20804 -39.08982,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#252525;stroke:#6e6e6e;stroke-width:2.99125171;stroke-miterlimit:4;stroke-dasharray:none" id="path2996" d="m 38.311064,931.09899 c -8.01574,5.05649 -22.76006,21.74743 -26.34852,58.0567 -4.1290804,35.18581 -4.8394604,60.59901 28.55878,61.68771 l 162.934726,0 c 39.19437,1.1693 30.46155,-41.5992 28.55878,-61.68771 -3.58839,-36.30927 -18.33277,-52.99983 -26.34851,-58.0567 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#373737;stroke:#6e6e6e;stroke-width:2.83429575;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" id="path3019" d="m 26.230254,979.1291 c -11.50334,14.44882 -11.98241,47.3999 -0.33519,57.1202 l 191.802226,0 c 12.10111,-12.3068 9.93082,-46.99573 -0.33518,-57.1202 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#808080;stroke:#1a1a1a;stroke-width:2.14882827;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path4133" d="m 360.82498,854.6914 a 20.634815,21.265151 0 1 1 -41.269,0 20.634815,21.265151 0 1 1 41.269,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#333333;stroke:#000000;stroke-width:2.11880326;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path4280" d="m 351.64051,761.132 a 11.444622,11.75148 0 1 1 -22.88896,0 11.444622,11.75148 0 1 1 22.88896,0 z" stroke-miterlimit="4" /><path inkscape:connector-curvature="0" style="fill:#313131;stroke:#565656;stroke-width:2.93434715;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0" id="path3993" d="m 125.52855,598.62659 c -68.528026,0 -124.0613764,57.81925 -124.0613764,129.13695 0,71.31265 55.5370404,129.13696 124.0613764,129.13696 68.52804,0 124.07984,-57.81926 124.07984,-129.13696 0,-71.31264 -55.55611,-129.13695 -124.07984,-129.13695 z m -1.00095,23.63932 c 10.01261,0.0734 20.238,1.32074 28.95237,3.51006 11.62203,3.80301 21.53624,8.52304 31.01135,16.15381 26.21752,19.0207 43.36275,50.36277 43.36275,85.83029 0,58.01564 -45.80548,105.05244 -102.30928,105.05244 -56.500726,0 -102.309276,-47.03364 -102.309276,-105.05244 0,-32.14848 14.06783,-60.91918 36.22336,-80.19121 11.45168,-11.11714 23.14136,-17.13322 37.3943,-21.79731 7.855846,-2.48302 17.655666,-3.5835 27.668276,-3.51006 z" stroke-miterlimit="4" /><g style="stroke-miterlimit:4;stroke-dasharray:none" id="g4127" stroke-miterlimit="4" transform="matrix(0.61498728,0,0,0.63147657,-18.171616,453.28593)"><g id="g4111"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="rect3040" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path3024" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g><g id="g4115" transform="translate(97.984785,0)"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="path4117" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path4119" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g><g id="g4121" transform="translate(195.96959,0)"><path style="fill:#808080;stroke:#373737;stroke-width:3.56837296" inkscape:connector-curvature="0" id="path4123" d="m 110.97,771.16 31.694,4.8776 1.3007,44.257 -32.995,0 z" /><path style="fill:#b3b3b3;stroke:#565656;stroke-width:3.4000001;stroke-linecap:butt;stroke-linejoin:miter" inkscape:connector-curvature="0" id="path4125" d="m 96.83,686.82 58.353,-5.0761 c 15.608,27.569 6.8304,64.333 -5.0761,90.545 l -53.841,-2.538 z" /></g></g><g style="fill:#666666;stroke:#969696;stroke-width:3.99777174;stroke-miterlimit:4;stroke-dasharray:none" id="g4051" transform="translate(-42.878584,98.083591)" stroke-miterlimit="4"><g id="g4437" transform="matrix(0.74686368,0,0,0.74686368,-73.374214,285.30447)"><path inkscape:connector-curvature="0" id="rect4348" style="color:#000000;text-indent:0;text-transform:none;block-progression:tb;fill:#ffffff" d="m 567.31,584.22 0,42.25 0,3.4062 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.375,0 0,-42.25 27.062,0 0,42.25 3.4062,0 0,-43.969 0,-1.6875 -1.7188,0 -28.75,0 0,-42.25 -3.375,0 0,42.25 -27.062,0 0,-42.25 -3.375,0 0,42.25 -27.062,0 0,-42.25 -3.375,0 z" /><g style="fill:#a02c2c;stroke:#ffffff;stroke-width:3.4000001;stroke-linecap:square" id="g87" /></g></g></g></svg>')+
"');width: 397px;height: 455px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);transform: translateX(-50%);background-size: 100% 100%;left: 50%;margin-left: 25px;margin-bottom: 40px;bottom: 0px;";g.style.cssText=pa+"top: 132px;left: 331px;";f.style.cssText=pa+"top: 122px;left: 315px;";h.style.cssText=pa+"top: 122px;left: 347px;";k.style.cssText=pa+"top: 113px;left: 331px;";l.style.cssText="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+
btoa('<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4049" d="m26.584 1016.1c-12.631 0-23.15 9.858-25.478 22.922l50.705 12.18c0.47921-2.1565 0.73023-4.4099 0.73023-6.7204 0-15.677-11.621-28.382-25.957-28.382z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>')+
"');width: 54px;height: 37px;background-size: 100% 100%;top: 84px;left: 166px;";p.style.cssText="position: absolute;height: auto;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4033" d="m26.92 1016.1c-14.337 0-25.957 12.707-25.957 28.382 0 2.3225 0.26742 4.5784 0.74876 6.7386l50.681-12.18c-2.321-13.072-12.841-22.944-25.476-22.944z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>')+
"');width: 54px;height: 37px;background-size: 100% 100%;top: 84px;left: 36px;";q.style.cssText=pa+"top: 107px;left: 141px;";r.style.cssText=pa+"top: 107px;left: 90px;";t.style.cssText=pa+"top: 185px;left: 321px;";u.style.cssText=pa+"top: 185px;left: 340px;";x.style.cssText=pa+"top: 179px;left: 358px;";w.style.cssText=pa+"top: 178px;left: 303px;";y.style.cssText=pa+"top: 210px;left: 299px;";z.style.cssText=pa+"top: 279px;left: 299px;";A.style.cssText=pa+"top: 210px;left: 321px;";B.style.cssText=pa+
"top: 279px;left: 321px;";F.style.cssText=pa+"top: 210px;left: 344px;";D.style.cssText=pa+"top: 278px;left: 344px;";na.style.cssText=pa+"top: 124px;left: 147px;";za.style.cssText=pa+"top: 138px;left: 133px;";V.style.cssText=pa+"top: 124px;left: 82px;";wa.style.cssText=pa+"top: 138px;left: 96px;";ga.style.cssText=pa+"top: 278px;left: 367px;";pa="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>')+
"');width: 19px;height: 46px;background-size: 100% 100%;";a.style.cssText=pa+"top: 291px;left: 50px;";X.style.cssText=pa+"top: 291px;left: 111px;";ea.style.cssText=pa+"top: 291px;left: 171px;";aa.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3458" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="50.447mm" width="83.899mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 297.28131 178.75"><metadata id="metadata3463"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -873.61)" fill="#e6e6e6"><path id="path4535" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m33.875 873.61-18.5 8.8125 5.0626 3.0625c-12.899 22.78-20.438 49.17-20.438 77.44 0 28.284 7.5315 54.691 20.438 77.469l-5.0626 3.0625 18.5 8.8125 0.6563-20.469-5.531 3.3c-12.002-21.2-18.937-45.8-18.937-72.18 0-26.362 6.9415-50.99 18.937-72.188l5.5313 3.3438-0.6563-20.469z"/><path id="path4551" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m263.38 873.71-0.6562 20.469 5.5312-3.3438c11.996 21.198 18.969 45.825 18.969 72.188 0 26.371-6.9672 51.011-18.969 72.219l-5.5312-3.3437 0.6562 20.469 18.5-8.8125-5.0312-3.0625c12.906-22.778 20.438-49.184 20.438-77.469 0-28.275-7.5391-54.665-20.438-77.438l5.0312-3.0625-18.5-8.8125z"/></g></svg>')+
"');width: 297px;height: 179px;background-size: 100% 100%;top: 43px;left: -25px;";Ga.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="2.9016mm" width="9.2516mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.781198 10.281199"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1042.1)"><path id="rect4585" d="m32.781 1047.2-7.875-5.125v2.8437h-17.031v-2.8437l-7.875 5.1 7.875 5.1562v-2.8437h17.031v2.8437z" fill="#e6e6e6"/></g></svg>')+
"');width: 33px;height: 10px;background-size: 100% 100%;top: 159px;left: 324px;";ja.style.cssText="position: absolute;background-image: url('data:image/svg+xml;base64,"+btoa('<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2516mm" width="2.9016mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 10.281248 32.7812"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1019.6)"><path id="rect4585" d="m5.125 1019.6-5.125 7.9h2.8437v17.031h-2.8437l5.125 7.875 5.1562-7.875h-2.8438v-17.031h2.8438z" fill="#e6e6e6"/></g></svg>')+
"');width: 10px;height: 33px;background-size: 100% 100%;top: 148px;left: 335px;";c.appendChild(e);e.appendChild(a);e.appendChild(X);e.appendChild(ea);e.appendChild(aa);e.appendChild(Ga);e.appendChild(ja);e.appendChild(g);e.appendChild(f);e.appendChild(h);e.appendChild(k);e.appendChild(l);e.appendChild(p);e.appendChild(q);e.appendChild(r);e.appendChild(t);e.appendChild(u);e.appendChild(x);e.appendChild(w);e.appendChild(y);e.appendChild(z);e.appendChild(A);e.appendChild(B);e.appendChild(F);e.appendChild(D);
e.appendChild(na);e.appendChild(za);e.appendChild(V);e.appendChild(wa);e.appendChild(ga);H.length=0;v.length=0;G.length=0;ba.length=0;H.push(g,f,h,k,l,p,q,r,t,u,x,w,y,z,A,B,F,D,na,za,V,wa,ga);v.push('<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4049" d="m26.584 1016.1c-12.631 0-23.15 9.858-25.478 22.922l50.705 12.18c0.47921-2.1565 0.73023-4.4099 0.73023-6.7204 0-15.677-11.621-28.382-25.957-28.382z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>',
'<svg id="svg3400" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="10.507mm" width="15.1mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 53.504016 37.228838"><metadata id="metadata3405"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(-2.847e-7 -1015.1)"><path id="path4033" d="m26.92 1016.1c-14.337 0-25.957 12.707-25.957 28.382 0 2.3225 0.26742 4.5784 0.74876 6.7386l50.681-12.18c-2.321-13.072-12.841-22.944-25.476-22.944z" stroke="#5276cf" stroke-linecap="square" stroke-width="1.9247" fill="#666"/></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>',
'<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="5.4777083mm" height="5.5003009mm" viewBox="0 0 19.409203 19.489255" id="svg3402" version="1.1" inkscape:version="0.91 r13725" sodipodi:docname="wheel_btn.svg"><defs id="defs3404" /><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="22.4" inkscape:cx="4.7324003" inkscape:cy="15.245372" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:window-width="1920" inkscape:window-height="1134" inkscape:window-x="0" inkscape:window-y="27" inkscape:window-maximized="1" /><metadata id="metadata3407"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(8.5754969e-8,-1032.873)"><path inkscape:connector-curvature="0" style="fill:#5276cf;stroke:#000000;stroke-width:3.4000001;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;fill-opacity:1" id="path4272" d="m 17.709101,1042.6176 a 8.0046,8.0046 0 1 1 -16.0089998,0 8.0046,8.0046 0 1 1 16.0089998,0 z" stroke-miterlimit="4" /></g></svg>');
ba.push(aa,a,ea,X,Ga,ja);for(c=0;c<H.length;c++)H[c].setAttribute("id","wheel_btn_"+c),H[c].setAttribute("data-colorstate","B"),H[c].setAttribute("data-key",c),H[c].setAttribute("data-svgid",c);for(c=0;c<ba.length;c++)H[c].setAttribute("id","wheel_axis_"+c),H[c].setAttribute("data-colorstate","GR");aa.setAttribute("data-key",m.GMPD_AXIS_0);aa.setAttribute("data-svgid",v.length);a.setAttribute("data-key",m.GMPD_AXIS_1);a.setAttribute("data-svgid",v.length+1);ea.setAttribute("data-key",m.GMPD_AXIS_2);
ea.setAttribute("data-svgid",v.length+2);X.setAttribute("data-key",m.GMPD_AXIS_3);X.setAttribute("data-svgid",v.length+3);Ga.setAttribute("data-key",m.GMPD_AXIS_4);Ga.setAttribute("data-svgid",v.length+4);ja.setAttribute("data-key",m.GMPD_AXIS_5);ja.setAttribute("data-svgid",v.length+5);v.push('<svg id="svg3458" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="50.447mm" width="83.899mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 297.28131 178.75"><metadata id="metadata3463"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -873.61)" fill="#e6e6e6"><path id="path4535" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m33.875 873.61-18.5 8.8125 5.0626 3.0625c-12.899 22.78-20.438 49.17-20.438 77.44 0 28.284 7.5315 54.691 20.438 77.469l-5.0626 3.0625 18.5 8.8125 0.6563-20.469-5.531 3.3c-12.002-21.2-18.937-45.8-18.937-72.18 0-26.362 6.9415-50.99 18.937-72.188l5.5313 3.3438-0.6563-20.469z"/><path id="path4551" style="color:#000000;text-indent:0;block-progression:tb;text-decoration-line:none;text-transform:none" d="m263.38 873.71-0.6562 20.469 5.5312-3.3438c11.996 21.198 18.969 45.825 18.969 72.188 0 26.371-6.9672 51.011-18.969 72.219l-5.5312-3.3437 0.6562 20.469 18.5-8.8125-5.0312-3.0625c12.906-22.778 20.438-49.184 20.438-77.469 0-28.275-7.5391-54.665-20.438-77.438l5.0312-3.0625-18.5-8.8125z"/></g></svg>',
'<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3386" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="12.859mm" width="5.2917mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 18.749999 45.562501"><metadata id="metadata3391"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1006.8)"><path id="rect4575" d="m9.3125 1006.8-9.3125 14.25h5.3125v17.094h-5.1875l9.3125 14.219 9.3125-14.219h-5.1562v-17.094h5.0312l-9.3125-14.25z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="2.9016mm" width="9.2516mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 32.781198 10.281199"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1042.1)"><path id="rect4585" d="m32.781 1047.2-7.875-5.125v2.8437h-17.031v-2.8437l-7.875 5.1 7.875 5.1562v-2.8437h17.031v2.8437z" fill="#e6e6e6"/></g></svg>',
'<svg id="svg3378" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns="http://www.w3.org/2000/svg" height="9.2516mm" width="2.9016mm" version="1.1" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 10.281248 32.7812"><metadata id="metadata3383"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata><g id="layer1" transform="translate(0 -1019.6)"><path id="rect4585" d="m5.125 1019.6-5.125 7.9h2.8437v17.031h-2.8437l5.125 7.875 5.1562-7.875h-2.8438v-17.031h2.8438z" fill="#e6e6e6"/></g></svg>');
n(H,E);n(ba,"#e6e6e6")}}function n(a,b){for(var c=function(a){a=a.target;if(!(0>z||"G"==a.dataset.colorstate))if(0!=D){if("R"==a.dataset.colorstate&&(y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller",D=0),"B"==a.dataset.colorstate||"GR"==a.dataset.colorstate){var c=parseFloat(y.dataset.svgid);y.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(v[c])+"')";y.setAttribute("data-colorstate",a.dataset.colorstate);y=a;c=parseFloat(a.dataset.svgid);
a.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(v[c].replace(b,"#ff0000"))+"')";a.setAttribute("data-colorstate","R")}}else{var c=parseFloat(a.dataset.svgid),d="B"==a.dataset.colorstate?1:2;D=d;a.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(v[c].replace(b,"#ff0000"))+"')";a.setAttribute("data-colorstate","R");1==d?document.getElementById("action_label").textContent="Now press the button on the device":document.getElementById("action_label").textContent="Now move the axis on the device";
y=a}},d=0;d<a.length;d++)a[d].addEventListener("click",c,!1)}function p(a){var b=document.createElement("label");b.style.cssText="position: relative;display: inline-block;width: 50px;color: white;margin: 0 10px;font-size: 36px;line-height: 50px;background-color: black;border: 3px solid white;border-radius: 5px;height: 50px;";b.textContent=a;return b}function B(){var a=window.innerWidth,b=window.innerHeight;K.style.zoom=750>=b&&400<b||750>=a&&400<a?"0.5":400>=a||400>=b?"0.3":"1"}var c=r("container"),
k=r("controls"),m=r("input"),A=r("storage"),E=/#5276cf/g,w={};w[m.GMPD_BUTTON_12]=m.GMPD_BUTTON_12;w[m.GMPD_BUTTON_13]=m.GMPD_BUTTON_13;w[m.GMPD_BUTTON_15]=m.GMPD_BUTTON_15;w[m.GMPD_BUTTON_14]=m.GMPD_BUTTON_14;w[m.GMPD_BUTTON_3]=m.GMPD_BUTTON_3;w[m.GMPD_BUTTON_0]=m.GMPD_BUTTON_0;w[m.GMPD_BUTTON_1]=m.GMPD_BUTTON_1;w[m.GMPD_BUTTON_2]=m.GMPD_BUTTON_2;w[m.GMPD_BUTTON_5]=m.GMPD_BUTTON_5;w[m.GMPD_BUTTON_7]=m.GMPD_BUTTON_7;w[m.GMPD_BUTTON_4]=m.GMPD_BUTTON_4;w[m.GMPD_BUTTON_6]=m.GMPD_BUTTON_6;w[m.GMPD_BUTTON_8]=
m.GMPD_BUTTON_8;w[m.GMPD_BUTTON_9]=m.GMPD_BUTTON_9;w[m.GMPD_BUTTON_10]=m.GMPD_BUTTON_10;w[m.GMPD_BUTTON_11]=m.GMPD_BUTTON_11;w[m.GMPD_BUTTON_16]=m.GMPD_BUTTON_16;var v=[],z=-1,y=null,D=0,K=null,d=null,t=null,C=null,M=null,x=null,g=[],H=[],G=[],ba=[],L=!0,F={};F[m.GMPD_AXIS_0]=-2;F[m.GMPD_AXIS_1]=-2;F[m.GMPD_AXIS_2]=-2;F[m.GMPD_AXIS_3]=-2;F[m.GMPD_AXIS_4]=-2;F[m.GMPD_AXIS_5]=-2;F[m.GMPD_AXIS_6]=-2;F[m.GMPD_AXIS_7]=-2;F[m.GMPD_AXIS_8]=-2;F[m.GMPD_AXIS_9]=-2;F[m.GMPD_AXIS_10]=-2;F[m.GMPD_AXIS_11]=-2;
a.show=function(){var a=document.createElement("div");K=a;a.style.cssText="position: absolute;width: 720px;height: 750px;top: 50%;left: 50%;-moz-transform: translateY(-50%) translateX(-50%);-ms-transform: translateY(-50%) translateX(-50%);-webkit-transform: translateY(-50%) translateX(-50%);transform: translateY(-50%) translateX(-50%);background-color: black;border: 4px solid white;border-radius: 35px;box-shadow: 0px 0px 20px 0px rgba(50, 50, 50, 1);";c.insert_to_container(a,"LAST");b(a);var d=document.createElement("div");
d.style.cssText="position: absolute;width: 637px;top: 0px;font-family: sans-serif;text-align: center;margin-top: 40px;-moz-transform: translateX(-50%);-ms-transform: translateX(-50%);-webkit-transform: translateX(-50%);transform: translateX(-50%);left: 50%;";var g=document.createElement("div");g.innerHTML="Select a device";g.style.cssText="color: #fff;display: inline-block;";d.appendChild(g);for(g=0;4>g;g++){var n=f(g),r=function(){return!0},w=function(a,b,c){if(b==z)for(c=0;c<H.length;c++){var d=
H[c],e=k.get_sensor_value(a,b,c),g=c;if(0==D){if(e&&"B"==d.dataset.colorstate){var f=v[g];d.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(f.replace(E,"#00ff00"))+"')";d.setAttribute("data-colorstate","G")}e||"B"==d.dataset.colorstate||(f=v[g],d.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(f)+"')",d.setAttribute("data-colorstate","B"))}else e=m.get_pressed_gmpd_btn(z),0<=e&&y&&1==D&&(d=y.dataset.key,m.set_gamepad_key(z,d,e),g=A.get(z+"_gmpd_stngs","b4w")||"{}",g=JSON.parse(g),
g[d]=e,A.set(z+"_gmpd_stngs",JSON.stringify(g),"b4w"),y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller",D=0)}};k.create_sensor_manifold(null,g,k.CT_CONTINUOUS,n,r,w)}0<u().length&&(z=0);var Z=[],g=document.createElement("div");g.style.cssText="margin-top: 20px;";for(n=0;4>n;n++)w=p(n),n==z&&(w.style.backgroundColor="green",t=w),h(n),g.appendChild(w),w.setAttribute("data-device_type","PAD"),Z.push(w),w.addEventListener("click",function(a){var b=
u();a=a.target;for(var c=0;c<b.length;c++)Z[c]==a&&(z=c,t=a,h(z),e(a.dataset.device_type))},!1);d.appendChild(g);x=document.createElement("label");x.style.cssText="position: relative;display: block;color: white;";d.appendChild(x);g=document.createElement("div");g.style.cssText="margin-top: 20px;";n=q(g,"Pad");w=q(g,"Wheel");n.setAttribute("checked","true");n.onchange=function(){e("PAD");t&&t.setAttribute("data-device_type","PAD")};w.onchange=function(){e("WHEEL");t&&t.setAttribute("data-device_type",
"WHEEL")};n.setAttribute("id","test");M=n;C=w;n=document.createElement("label");n.style.cssText+="color: #fff;display: block;";g.appendChild(n);n.textContent="Click on the buttons & arrows to setup your controller";n.setAttribute("id","action_label");d.appendChild(g);a.appendChild(d);a=k.create_elapsed_sensor();k.create_sensor_manifold(null,"UPDATE_GAMEPAD_DATA",k.CT_CONTINUOUS,[a],r,function(a,b,c){a=u();b=a.length;-1==z&&a.length&&(z=a[0].index,t=Z[z]);for(c=0;c<Z.length;c++)c<b?(Z[c].textContent=
a[c].index,Z[c]==t?(Z[c].style.backgroundColor="green",x.textContent="Selected device: "+a[c].index+". Data: "+a[c].id):Z[c].style.backgroundColor="blue"):Z[c].style.backgroundColor="black";b||(z=-1,x.textContent="")});for(g=0;4>g;g++)n=l(g),r=function(){return!0},w=function(a,b,c){if(b=="AXES"+z){for(c=0;c<G.length;c+=2){var d=G[c],e=a,g=b,f=c,h=20*k.get_sensor_value(e,g,f),e=20*k.get_sensor_value(e,g,f+1);d.style.transform="translate3d("+h+"px, "+e+"px, 0px) rotate(0rad)"}if(L)for(c=0;12>c;c+=2){if(e=
a,g=b,d=c,!(d+1>2*ba.length)){h=k.get_sensor_value(e,g,d);e=k.get_sensor_value(e,g,d+1);if(-2<F[d]){var l=h-F[d],n=e-F[d+1],g=ba[Math.floor(d/2)],f=g.dataset.svgid;0==D?g.style.backgroundImage=l||n?"url('data:image/svg+xml;base64,"+btoa(v[f].replace("#e6e6e6","#00ff00"))+"')":"url('data:image/svg+xml;base64,"+btoa(v[f])+"')":2==D&&(l=m.get_moved_gmpd_axis(z),0<=l&&(0!=l%2&&l--,D=0,g.style.backgroundImage="url('data:image/svg+xml;base64,"+btoa(v[f])+"')",g=parseFloat(y.dataset.key),m.set_gamepad_key(z,
g,l),m.set_gamepad_key(z,g+1,l+1),y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller"))}F[d]=h;F[d+1]=e}}else for(c=0;12>c;c++)d=c,d>=ba.length||(h=k.get_sensor_value(a,b,d),-2<F[d]&&(f=h-F[d],e=ba[d],g=e.dataset.svgid,0==D?e.style.backgroundImage=f?"url('data:image/svg+xml;base64,"+btoa(v[g].replace("#e6e6e6","#00ff00"))+"')":"url('data:image/svg+xml;base64,"+btoa(v[g])+"')":2==D&&(f=m.get_moved_gmpd_axis(z),0<=f&&(D=0,e.style.backgroundImage=
"url('data:image/svg+xml;base64,"+btoa(v[g])+"')",e=parseFloat(y.dataset.key),m.set_gamepad_key(z,e,f),y=null,document.getElementById("action_label").textContent="Click on the buttons & arrows to setup your controller"))),F[d]=h)}},k.create_sensor_manifold(null,"AXES"+g,k.CT_CONTINUOUS,n,r,w);B();window.addEventListener("resize",B)};a.hide=function(){D=0;z=-1;M=C=y=t=null;G.length=0;H.length=0;ba.length=0;c.get_container().removeChild(K);K=null;k.remove_sensor_manifold(null,"UPDATE_GAMEPAD_DATA");
for(var a=0;4>a;a++)k.remove_sensor_manifold(null,a),k.remove_sensor_manifold(null,"AXES"+a);window.removeEventListener("resize",B)};a.update=function(){for(var a=0;4>a;a++)h(a)}};b4w.module.gyroscope=function(a,r){function u(a){var f=b.create_gyro_angles_sensor(),r=b.create_gyro_quat_sensor(),u=!0;b.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",b.CT_CONTINUOUS,[f,r],null,function(a,f,r){if(0<r)if(h.is_eye_camera(a))f=b.get_sensor_payload(a,f,1),r=e.transformQuat(q.AXIS_MY,f,B),h.set_vertical_axis(a,r),l.set_rotation_v(a,f);else{p=b.get_sensor_payload(a,f,0);u&&(n[0]=p[0],n[1]=p[1],n[2]=p[2],u=!1);r=f=0;0==window.orientation&&(f=p[1]-n[1],r=p[0]-n[0],p[1]>k&&p[1]<c&&(r=0));
if(180==window.orientation){f=p[1]-n[1];0>p[1]&&(f=-f);r=n[0]-p[0];if(f>Math.PI/2||f<-Math.PI/2)f=0;p[1]>-c&&p[1]<-k&&(r=0)}if(-90==window.orientation){f=p[0]-n[0];if(f>Math.PI/2||f<-Math.PI/2)f=0;r=n[1]-p[1];if(p[0]>m||p[0]<A)r=0}if(90==window.orientation){f=n[0]-p[0];if(f>Math.PI/2||f<-Math.PI/2)f=0;r=p[1]-n[1];if(p[0]>m||p[0]<A)r=0}h.rotate_camera(a,r,f);n[0]=p[0];n[1]=p[1];n[2]=p[2]}})}var h=r("camera"),b=r("controls"),f=r("scenes"),l=r("transform"),q=r("util"),e=r("vec3"),n=new Float32Array(3),
p=new Float32Array(3),B=e.create(),c=q.deg_to_rad(110),k=q.deg_to_rad(70),m=q.deg_to_rad(70),A=-q.deg_to_rad(70);a.enable_camera_rotation=function(){var a=f.get_active_camera();u(a)};a.disable_camera_rotation=function(){var a=f.get_active_camera();b.remove_sensor_manifold(a,"CAMERA_ROTATE_GYRO")}};b4w.module.hmd_conf=function(a,r){function u(a){a=a.target.value;var b=d[a],c;for(c in D)if(c in b){var e=document.getElementById(c+"_slider");e&&(e.disabled="custom"!==a,e.value=b[c]);if(e=document.getElementById(c+"_number"))e.disabled="custom"!==a,e.value=b[c]}}function h(){B.remove_sensor_manifold(null,"UPDATE_HMD_RENDERING");f();q();E&&(E=!1,p.get_container().removeChild(w),document.head.removeChild(v),v=z=w=null)}function b(){f(!0);q();for(var a in D){var b=document.getElementById(a+"_slider");
b&&(b.value=D[a]);if(b=document.getElementById(a+"_number"))b.value=D[a]}}function f(a){var b=navigator.userAgent||navigator.vendor||window.opera,c=Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio,d=Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio,e=0,f=0,h=0;a:{var l=C;if(1==l.format&&l.devices&&l.devices.length)for(var n=0;n<l.devices.length;n++){var p=l.devices[n];if(p.rules&&("ios"==p.type&&K||"android"==p.type)){for(var q=!1,r=0;r<p.rules.length;r++){var t=
p.rules[r],v=c,u=d;if(t.ua&&0<=b.indexOf(t.ua)||!t.ua&&t.res&&t.res[0]&&t.res[1]&&Math.min(v,u)==Math.min(t.res[0],t.res[1])&&Math.max(v,u)==Math.max(t.res[0],t.res[1])){q=!0;break}}if(q){b=n;break a}}}else k.error("DPDB isn't correct.");b=-1}-1!=b&&(h=C.devices[b],f=h.dpi[1]||h.dpi,e=Math.round(25.4*c/(h.dpi[0]||h.dpi)),f=Math.round(25.4*d/f),h=Math.round(h.bw));c=m.get("hmd_conf","b4w");c=JSON.parse(c?c:"{}");a?(D.first_distortion=.34,D.second_distortion=.55,D.bevel_size=h||4,D.screen_width=e||
110,D.screen_height=f||65,D.screen_lense=50,D.ipd=64,D.baseline=32):(D.first_distortion="first_distortion"in c?parseFloat(c.first_distortion):.34,D.second_distortion="second_distortion"in c?parseFloat(c.second_distortion):.55,D.bevel_size="bevel_size"in c?parseFloat(c.bevel_size):h||4,D.screen_width="screen_width"in c?parseFloat(c.screen_width):e||110,D.screen_height="screen_height"in c?parseFloat(c.screen_height):f||65,D.screen_lense="screen_lense"in c?parseFloat(c.screen_lense):50,D.ipd="ipd"in
c?parseFloat(c.ipd):64,D.baseline="baseline"in c?parseFloat(c.baseline):32);y=!0}function l(){m.set("hmd_conf",JSON.stringify(D),"b4w");h()}function q(){if(y){var a=c.get_device_by_type_element(c.DEVICE_HMD);a&&(c.set_config(a,c.HMD_DISTORTION,[D.first_distortion,D.second_distortion]),c.get_value_param(a,c.HMD_WEBVR_TYPE)!=c.HMD_WEBVR_DESKTOP&&(c.set_config(a,c.HMD_BEVEL_SIZE,.001*D.bevel_size),c.set_config(a,c.HMD_SCREEN_WIDTH,.001*D.screen_width),c.set_config(a,c.HMD_SCREEN_HEIGHT,.001*D.screen_height),
c.set_config(a,c.HMD_SCREEN_LENSE_DIST,.001*D.screen_lense),c.set_config(a,c.HMD_EYE_DISTANCE,.001*D.ipd),c.set_config(a,c.HMD_BASELINE_DIST,.001*D.baseline)));y=!1}}function e(a){var b=a.target.id.split("_"),b=b.splice(0,b.length-1).join("_");b in D&&D[b]!=a.target.value&&(y=!0,D[b]=a.target.value,document.getElementById(b+"_slider").value=a.target.value,document.getElementById(b+"_number").value=a.target.value)}function n(a,b){var c=document.createElement("button");c.onclick=a;c.style.cssText="display: inline-block;";
c.innerHTML=b;return c}var p=r("container"),B=r("controls"),c=r("input"),k=r("print"),m=r("storage"),A=r("util"),E=!1,w=null,v=null,z=null,y=!0,D={profile:"custom",first_distortion:0,second_distortion:0,bevel_size:0,screen_width:0,screen_height:0,screen_lense:0,ipd:0,baseline:0},K=/iPad|iPhone|iPod/.test(navigator.platform),d={oculus_dk2:{name:"Oculus Rift DK2",type:2,first_distortion:.22,second_distortion:.28},cardboard_1:{name:"Cardboard (2014)",type:1,ipd:60,baseline:35,screen_lense:42,first_distortion:.441,
second_distortion:.156},cardboard_2:{name:"Cardboard (2015)",type:1,ipd:64,baseline:35,screen_lense:39,first_distortion:.34,second_distortion:.55},custom:{name:"Custom",type:0,ipd:64,baseline:35,screen_lense:39,first_distortion:0,second_distortion:0}},t=[{label:"Tray to lens-center distance.",is_mobile:!0,inputs:[{id:"baseline",max:"50",step:"0.5"}]},{label:"Interpupillary distance.",is_mobile:!0,inputs:[{id:"ipd",max:"100",step:"1"}]},{label:"Screen to lense distance.",is_mobile:!0,inputs:[{id:"screen_lense",
max:"100",step:"1"}]},{label:"Screen height.",is_mobile:!0,inputs:[{id:"screen_height",max:"150",step:"1"}]},{label:"Screen width.",is_mobile:!0,inputs:[{id:"screen_width",max:"200",step:"1"}]},{label:"Bevel width.",is_mobile:!0,inputs:[{id:"bevel_size",max:"20",step:"1"}]},{label:"Distortion coefficients.",inputs:[{id:"first_distortion",max:"1.0",step:"0.01"},{id:"second_distortion",max:"1.0",step:"0.01"}]}];a.check=function(){return c.can_use_device(c.DEVICE_HMD)};a.show=function(a){v=document.createElement("style");
v.innerHTML="html{-webkit-tap-highlight-color:rgba(0,0,0,0);}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{width:100%;height:8.4px;cursor:pointer;box-shadow:0 0 10px 0 rgba(50,50,50,1);background:#000;border-radius:1.3px;border:.2px solid #010101}input[type=range]::-webkit-slider-thumb{box-shadow:0 0 10px 0 rgba(50,50,50,1);border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer;-webkit-appearance:none;margin-top:-14px}input[type=range]:focus::-webkit-slider-runnable-track{background:#000}input[type=range]::-moz-range-track{width:100%;height:8.4px;cursor:pointer;box-shadow:0 0 10px 0 rgba(50,50,50,1);background:#000;border-radius:1.3px;border:.2px solid #010101}input[type=range]::-moz-range-thumb{box-shadow:0 0 10px 0 rgba(50,50,50,1);border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer}input[type=range]::-ms-track{width:100%;height:8.4px;cursor:pointer;background:0 0;border-color:transparent;color:transparent}input[type=range]::-ms-fill-lower{background:#000;border:.2px solid #010101;border-radius:2.6px;box-shadow:0 0 10px 0 rgba(50,50,50,1)}input[type=range]::-ms-fill-upper{background:#000;border:.2px solid #010101;border-radius:2.6px;box-shadow:0 0 10px 0 rgba(50,50,50,1)}input[type=range]::-ms-thumb{box-shadow:0 0 10px 0 rgba(50,50,50,1);border:1px solid #000;height:36px;width:16px;border-radius:3px;background:#fff;cursor:pointer}.text_label,.value_label{display:inline-block;text-decoration:none;height:30px;line-height:28px;position:relative;text-align:center;font-family:Arial;font-size:15px}input[type=range]:focus::-ms-fill-lower{background:#000}input[type=range]:focus::-ms-fill-upper{background:#000}.text_label{float:left;color:#fff;width:auto;padding:0 10px;background-color:#000;border:3px solid #fff;border-radius:15px;box-shadow:0 0 10px 0 rgba(50,50,50,1);margin-right:15px}.input_text,.value_label{border:3px solid #fff;background-color:#000;color:#fff;box-shadow:0 0 10px 0 rgba(50,50,50,1)}.value_label{right:0;width:40px;border-radius:15px;margin-left:15px}.slider{position:relative;cursor:pointer}.border{position:relative;width:100%;height:50px}.input_slider,.input_text{margin:13.8px 0;-webkit-appearance:none;width:50%;position:relative;display:inline-block}.input_text{border-radius:4px;padding-left:4px}.input_slider,_:-moz-tree-row(hover){-webkit-appearance:none;width:50%;margin:-4.8px 0;position:relative;display:inline-block}:root .input_slider,_:-ms-fullscreen{-webkit-appearance:none;width:50%;margin:-2.8px 0;position:relative;display:inline-block}button,select{display:block}button{background-color:#000;color:#fff;width:100px;border:3px solid #fff;text-align:center;font-family:Arial;border-radius:15px;box-shadow:0 0 10px 0 rgba(50,50,50,1);font-size:15px;line-height:30px;margin-right:10px}select{clear:both}";
document.head.appendChild(v);var k=c.get_device_by_type_element(c.DEVICE_HMD);if(!E&&k){E=!0;f();var g=p.get_container(),r=c.get_device_by_type_element(c.DEVICE_MOUSE,g);c.switch_prevent_default(r,!1);r=c.get_device_by_type_element(c.DEVICE_TOUCH,g);c.switch_prevent_default(r,!1);w=document.createElement("div");w.class=a;g.appendChild(w);z=document.createElement("div");w.appendChild(z);z.style.cssText="position: absolute;background-color: #fff;left: 10px;top: 10px;right: 10px;bottom: 10px;bottom: 10px;min-width: 300px;overflow: auto;padding: 10px;border: 1px solid #ddd;border-radius: 4px;bottom: 10px;";
a=m.get("hmd_conf","b4w");a=JSON.parse(a?a:"{}").profile||"custom";g=document.createElement("div");r=document.createElement("label");r.innerHTML="Profile: ";r.className="text_label";g.appendChild(r);r=document.createElement("select");g.appendChild(r);g.style.cssText="margin: 20px 0;padding: 10px;";var y=c.get_device_by_type_element(c.DEVICE_HMD);if(y)for(var C in d)if(0==d[C].type||c.get_value_param(y,c.HMD_WEBVR_TYPE)==c.HMD_WEBVR_DESKTOP^1==d[C].type){var L=document.createElement("option");L.value=
C;L.text=d[C].name;r.appendChild(L)}r.value=a;A.is_ie11()?r.onchange=u:r.oninput=u;z.appendChild(g);for(C=0;C<t.length;C++)if(c.get_value_param(k,c.HMD_WEBVR_TYPE)!=c.HMD_WEBVR_DESKTOP||!t[C].is_mobile){a=t[C];g=document.createElement("div");r=document.createElement("label");r.className="text_label";r.textContent=a.label;g.appendChild(r);g.style.cssText="margin: 20px 0;float: left;display: inline-block;width: 50%;border: 1px solid #ddd;box-sizing: border-box;-webkit-box-sizing: border-box;padding: 10px;";
for(r=0;r<a.inputs.length;r++){y=a.inputs[r];L=document.createElement("div");L.style.cssText+="clear: both; margin-bottom: 10px;";var F=document.createElement("input");F.className="input_slider";F.setAttribute("id",y.id+"_slider");F.setAttribute("type","range");F.setAttribute("min","0.00");F.setAttribute("step",y.step);F.setAttribute("value",D[y.id]);F.setAttribute("max",y.max);F.style.cssText="float: left;";L.appendChild(F);var K=document.createElement("input");K.className="input_text";K.setAttribute("id",
y.id+"_number");K.setAttribute("type","number");K.setAttribute("min","0.00");K.setAttribute("step",y.step);K.setAttribute("value",D[y.id]);K.setAttribute("max",y.max);L.appendChild(K);A.is_ie11()?(F.onchange=e,K.onchange=e):(F.oninput=e,K.oninput=e);g.appendChild(L)}z.appendChild(g)}k=document.createElement("div");C=n(l,"SAVE");a=n(h,"CANCEL");g=n(b,"RESET");k.style.clear="both";k.appendChild(C);k.appendChild(a);k.appendChild(g);z.appendChild(k);k=B.create_timeline_sensor();B.create_sensor_manifold(null,
"UPDATE_HMD_RENDERING",B.CT_CONTINUOUS,[k],null,q)}};a.hide=h;a.reset=b;a.update=function(){f();q()};var C={_comment:"AUTOMATICALLY GENERATED BY generate_dpdb.py. DO NOT EDIT.",format:1,last_updated:"2016-01-26T23:11:18Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,
443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},
{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,
401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,
255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",
rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},
{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],
dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],
dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,
136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],
dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},
{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,
328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1E3}]}};b4w.module.hmd=function(a,r){function u(a,d){if(d){var r=q.get_active_camera();if(r){h.is_eye_camera(r)||(k=h.is_target_camera(r),m=h.is_hover_camera(r),A=h.is_static_camera(r),h.eye_setup(r));var r=b.create_elapsed_sensor(),u=!1;b.create_sensor_manifold(null,"HMD_ROTATE_CAMERA",b.CT_CONTINUOUS,[r,d],null,function(d,k,g){if(0<g&&(g=q.get_active_camera())&&(!u&&f.enable_split_screen(g)&&(B=e.get_rotation(g,B),u=!0),u&&h.is_eye_camera(g)&&(d=b.get_sensor_payload(d,k,1))))if(1==a){var m=p.transformQuat(n.AXIS_MY,
d,E);h.set_vertical_axis(g,m);e.set_rotation_v(g,d)}else if(2==a||3==a){k=e.get_rotation(g,y);k=l.invert(k,y);var r=l.multiply(B,k,y);k=h.get_vertical_axis(g,E);Math.abs(k[2])<Math.PI/4?m=p.cross(k,n.AXIS_MY,w):Math.abs(k[1])<Math.PI/4&&(m=p.cross(k,n.AXIS_Z,w));p.normalize(m,m);var r=p.transformQuat(m,r,v),t=p.dot(k,r),r=p.scaleAndAdd(r,k,-t,v);p.normalize(r,r);k=p.cross(k,m,E);m=Math.acos(n.clamp(p.dot(m,r),0,1));k=n.sign(p.dot(r,k));c+=m*k;m=l.setAxisAngle(n.AXIS_Z,-c,y);3!=a&&(k=n.quat_project(d,
n.AXIS_MZ,n.AXIS_Z,n.AXIS_Y,D),k=l.invert(k,D),d=l.multiply(k,d,D));d=l.multiply(m,d,z);m=p.transformQuat(n.AXIS_MY,d,E);h.set_vertical_axis(g,m);e.set_rotation_v(g,d);l.copy(d,B)}})}}}var h=r("camera"),b=r("controls"),f=r("input"),l=r("quat"),q=r("scenes"),e=r("transform"),n=r("util"),p=r("vec3"),B=l.create(),c=0,k=!1,m=!1,A=!1,E=p.create(),w=p.create(),v=p.create(),z=l.create(),y=l.create(),D=l.create();a.HMD_NONE_MOUSE_ALL_AXES=0;a.HMD_ALL_AXES_MOUSE_NONE=1;a.HMD_ROLL_PITCH_MOUSE_YAW=2;a.HMD_ALL_AXES_MOUSE_YAW=
3;a.enable_hmd=function(a){var c=null;if(c=f.get_device_by_type_element(f.DEVICE_HMD))c=f.get_value_param(c,f.HMD_WEBVR_TYPE)==f.HMD_WEBVR_DESKTOP||f.get_value_param(c,f.HMD_WEBVR_TYPE)==f.HMD_WEBVR1?b.create_hmd_quat_sensor():b.create_gyro_quat_sensor(),u(a,c)};a.check_browser_support=function(){return Boolean(f.can_use_device(f.DEVICE_HMD))};a.get_hmd_device=function(){return null};a.reset=function(){f.reset_device(f.DEVICE_HMD)};a.disable_hmd=function(){b.remove_sensor_manifold(null,"HMD_ROTATE_CAMERA");
f.disable_split_screen();var a=q.get_active_camera();k?h.target_setup(a):m?h.hover_setup(a):A&&h.static_setup(a);h.set_vertical_axis(a,n.AXIS_Z);var c=e.get_rotation(a,z);e.set_rotation_v(a,c)}};b4w.module.mixer=function(a,r){function u(){v=w.length=0;z=h(100);y=new Float32Array(z.length);D=new Float32Array(z.length);var a=m.get_speaker_objects();if(a.length){w.push(b());for(var c=0;c<a.length;c++)w.push(l(a[c]));w.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function h(a){for(var b=new Float32Array(a),c=0,e=0;e<a;e++)b[e]=20*Math.pow(1E3,c),c+=1/
(a-1);return b}function b(){var a=f("MASTER"),b=m.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.params.push(["VOLUME",m.get_volume(null),0,1,50,!1]);a.mute=m.is_muted(null)?1:0;a.solo=-1;return a}function f(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function l(a){var b=
f(k.get_object_name(a));b.mute=m.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function q(a){if(a.speaker){a.params.length=0;var b=m.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=m.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",b.Q,0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);
a.params.push(["VOLUME",m.get_volume(a.speaker),0,1,50,!1]);A.clamp(a.active_param,0,a.params.length-1)}}function e(a){for(var b=0;b<w.length;b++){var c=w[b];if(c!=a&&1==c.solo)return!0}return!1}function n(a){for(var b=0;b<w.length;b++){var c=w[b];c!=a&&0==c.mute&&0==c.solo&&m.mute(c.speaker,!1)}}function p(){if(0==w.length)return[0,-1];var a=8*Math.floor(v/8),b=a+7,a=A.clamp(a,0,w.length-1),b=A.clamp(b,0,w.length-1);return[a,b]}var B=r("controls"),c=r("hud"),k=r("scenes"),m=r("sfx"),A=r("__util"),
E="SWITCH_STRIP SWITCH_STRIP_HOLD SWITCH_PARAM INC_DEC INC_DEC_HOLD MUTE_SOLO".split(" "),w=[],v=0,z=null,y=null,D=null;a.enable_mixer_controls=function(){u();var a=B.create_keyboard_sensor(B.KEY_NUM4),b=B.create_keyboard_sensor(B.KEY_NUM6),f=B.create_keyboard_sensor(B.KEY_NUM8),h=B.create_keyboard_sensor(B.KEY_NUM2),k=B.create_keyboard_sensor(B.KEY_ADD),l=B.create_keyboard_sensor(B.KEY_SUB),g=B.create_keyboard_sensor(B.KEY_NUM7),r=B.create_keyboard_sensor(B.KEY_NUM9),G=B.create_timer_sensor(.15,
!0),E=B.create_timer_sensor(.05,!0),a=[a,b,G],b=function(a,b,c){if(1==c){c=Boolean(B.get_sensor_value(a,b,0))?-1:1;if(w.length){1==c&&v<w.length-1?v++:-1==c&&0<v&&v--;c=p();for(var d=c[0];d<=c[1];d++)q(w[d])}"SWITCH_STRIP"==b?B.reset_timer_sensor(a,b,2,.15+.3):B.reset_timer_sensor(a,b,2,.15)}else B.reset_timer_sensor(a,b,2,10)};B.create_sensor_manifold(null,"SWITCH_STRIP",B.CT_TRIGGER,a,function(a){return a[0]||a[1]},b);B.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",B.CT_SHOT,a,function(a){return(a[0]||
a[1])&&a[2]},b);B.create_sensor_manifold(null,"SWITCH_PARAM",B.CT_SHOT,[f,h],function(a){return a[0]||a[1]},function(a,b,c){a=Boolean(B.get_sensor_value(a,b,0))?-1:1;(b=w[v])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});f=[l,k,E];h=function(a,b,c){if(1==c){var d=Boolean(B.get_sensor_value(a,b,0))?-1:1,e=w[v];if(e)switch(c=e.params[e.active_param],c[1]=c[5]?c[1]*Math.pow(c[3]/c[2],d/c[4]):c[1]+(c[3]-c[2])/c[4]*d,c[1]=A.clamp(c[1],c[2],c[3]),
c[0]){case "VOLUME":"MASTER"!=e.id?m.set_volume(e.speaker,c[1]):m.set_volume(null,c[1]);break;case "DIST_REF":d=m.get_positional_params(e.speaker);d.dist_ref=c[1];m.set_positional_params(e.speaker,d);break;case "ATTENUATION":d=m.get_positional_params(e.speaker);d.attenuation=c[1];m.set_positional_params(e.speaker,d);break;case "DIST_MAX":d=m.get_positional_params(e.speaker);d.dist_max=c[1];m.set_positional_params(e.speaker,d);break;case "EQ_FREQ":d=m.get_filter_params(e.speaker);d.freq=c[1];m.set_filter_params(e.speaker,
d);break;case "EQ_Q":d=m.get_filter_params(e.speaker);d.Q=c[1];m.set_filter_params(e.speaker,d);break;case "EQ_GAIN":d=m.get_filter_params(e.speaker);d.gain=c[1];m.set_filter_params(e.speaker,d);break;case "THRESHOLD":e=m.get_compressor_params();e.threshold=c[1];m.set_compressor_params(e);break;case "KNEE":e=m.get_compressor_params();e.knee=c[1];m.set_compressor_params(e);break;case "RATIO":e=m.get_compressor_params();e.ratio=c[1];m.set_compressor_params(e);break;case "ATTACK":e=m.get_compressor_params();
e.attack=c[1];m.set_compressor_params(e);break;case "RELEASE":e=m.get_compressor_params();e.release=c[1];m.set_compressor_params(e);break;default:A.panic("Unknown strip param")}"INC_DEC"==b?B.reset_timer_sensor(a,b,2,.35):B.reset_timer_sensor(a,b,2,.05)}else B.reset_timer_sensor(a,b,2,10)};B.create_sensor_manifold(null,"INC_DEC",B.CT_TRIGGER,f,function(a){return a[0]||a[1]},h);B.create_sensor_manifold(null,"INC_DEC_HOLD",B.CT_SHOT,f,function(a){return(a[0]||a[1])&&a[2]},h);B.create_sensor_manifold(null,
"MUTE_SOLO",B.CT_SHOT,[g,r],function(a){return a[0]||a[1]},function(a,b,c){if(Boolean(B.get_sensor_value(a,b,0)))(a=w[v])&&0<=a.mute&&("MASTER"!=a.id?0==a.mute?(a.mute=1,m.mute(a.speaker,!0),1==a.solo&&(a.solo=0,e(a)||n(a))):(a.mute=0,e(a)||m.mute(a.speaker,!1)):0==a.mute?(a.mute=1,m.mute(null,!0)):(a.mute=0,m.mute(null,!1)));else if((a=w[v])&&0<=a.solo)if(0==a.solo)for(a.solo=1,m.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<w.length;b++)c=w[b],c!=a&&0==c.mute&&0==c.solo&&m.mute(c.speaker,!0);else a.solo=
0,e(a)?m.mute(a.speaker,!0):n(a)});g=B.create_elapsed_sensor();B.create_sensor_manifold(null,"MIXER_DRAW",B.CT_CONTINUOUS,[g],null,function(){if(w[v])for(var a=p(),b=a[0];b<=a[1];b++){var d=w[b];c.draw_mixer_strip(d.id,b==v,b%8,d.params,d.active_param,d.mute,d.solo);if(d.speaker&&m.get_filter_params(d.speaker)){m.get_filter_freq_response(d.speaker,z,y,D);for(d=0;d<y.length;d++)y[d]=20*Math.log(y[d])/Math.LN10;c.plot_array("EQ",b%8,y,20,2E4,-10,10)}}});g=B.create_timer_sensor(1,!0);B.create_sensor_manifold(null,
"MIXER_UPDATE",B.CT_TRIGGER,[g],null,function(){for(var a=p(),b=a[0];b<=a[1];b++)q(w[b])})};a.disable_mixer_controls=function(){for(var a=0;E.length;a++)B.remove_sensor_manifold(null,E[a])}};b4w.module.npc_ai=function(a,r){function u(a,b){var c=b.destination,f=w;k.get_translation(b.empty,f);var h=v;k.get_translation(b.collider,h);var l=0,n=h[2];c[2]=n;switch(b.type){case t:if(b.random&&b.reached){c[0]=(12*Math.random()-6)*b.speed+f[0];c[1]=-(12*Math.random()-6)*b.speed+f[1];var r=K,f=z,u=b.speed,B=b.rot_speed;k.get_rotation(b.collider,r);A.transformQuat(m.AXIS_MY,r,f);f[2]=0;A.normalize(f,f);r=Math.sin(B/2);u=.5*u/r;h=A.dist(c,h);h<2*u&&A.scaleAndAdd(c,f,2*u-h,c);b.reached=!1}b.ground_level&&
(l=b.ground_level-n,h=b.speed*a,l>h?l=h:l<-h&&(l=-h));b.vert_correction=l;break;case C:case M:b.vert_cor_water?l=b.vert_cor_water:b.vert_correction&&(l=b.vert_correction,b.type==M&&(l*=a)),b.random&&b.reached&&(b.type==M?(b.speed=Math.random()+.1,h=b.max_depth-b.min_depth):h=b.max_height-b.min_height,c[0]=10*Math.random()-5+f[0],c[1]=10*Math.random()-5+f[1],c[2]=n-(Math.random()*h-.5*h),b.reached=!1)}l&&(c[2]=n+l);var c=w,f=v,u=z,l=d,B=b.rig,h=b.collider,n=b.destination,E=b.speed,ha=b.actions,Y=e.get_current_anim_name(B);
if(!e.is_play(B)||!ha.idle||-1==ha.idle.indexOf(Y)){k.get_translation(h,c);var r=n[0]-c[0],Z=n[1]-c[1],r=Math.sqrt(r*r+Z*Z);if(r>2*E*a)b.state=20,m.horizontal_direction(n,c,u),ha=b.rig,e.is_animated(ha)&&(B=b.speed,E=e.get_frame(ha),ha=e.get_anim_length(ha),B*=ha/24*(1-E/ha),.9>r/B&&A.scaleAndAdd(n,u,B-r,n)),r=K,B=y,k.get_rotation(b.collider,r),A.transformQuat(m.AXIS_MY,r,f),B[0]=f[0],B[1]=f[1],B[2]=0,A.normalize(B,B),E=A.dot(B,u),ha=Math.acos(E),ha=Math.abs(ha)/Math.PI,ha=a/ha*b.rot_speed*b.rotation_mult,
p.rotationTo(B,u,l),p.rotationTo(m.AXIS_MY,B,r),1<=Math.abs(E)?p.copy(r,l):(p.multiply(l,r,l),p.slerp(r,l,Math.min(ha,1),l)),u=a,b.type!=C&&(u=Math.max(u,1/60),r=D,B=K,f=Math.asin(-f[2]),p.setAxisAngle(m.AXIS_X,-f,B),f=Math.atan(b.vert_correction/(b.speed*u)),p.setAxisAngle(m.AXIS_X,-f,r),p.slerp(B,r,u,r),p.multiply(l,r,l)),k.set_rotation_v(h,l),h=z,f=y,m.quat_to_dir(l,m.AXIS_MY,h),A.scale(h,b.speed*a,f),A.add(f,c,f),f[2]=b.type!=t?(n[2]-c[2])*a*.1+c[2]:n[2],k.set_translation_v(b.collider,f);else if(b.type==
t)ha.move?Y&&-1!=ha.move.indexOf(Y)&&e.is_play(B)?b.state=20:(b.state=10,b.reached=!0):(b.state=10,b.reached=!0);else if(b.type==M||b.type==C)b.reached=!0;if(q(b)&&(c=b.rig,!e.is_play(c))){l=null;switch(b.state){case 10:l=b.actions;l=l.idle?m.random_from_array(l.idle):null;break;case 20:l=e.get_current_anim_name(b.rig),h=n=b.actions,h.move_blends&&-1==h.move_blends.indexOf(l)&&h.move&&-1!=h.move.indexOf(l)&&.33<Math.random()?(n=b.actions,l=n.move.indexOf(l),l=n.move_blends[l]):(h=b.actions,h.move&&
(-1!=h.move.indexOf(l)||!h.move_blends&&!h.move_start||!h.move_start&&!l||h.move_blends&&-1!=h.move_blends.indexOf(l)||h.move_start&&-1!=h.move_start.indexOf(l))?(n=b.actions,n.move_blends?(h=n.move_blends.indexOf(l),-1!=h?(l=h+1,l=l<n.move.length?l:0,l=n.move[l]):l=-1!=n.move.indexOf(l)?l:m.random_from_array(n.move)):l=m.random_from_array(n.move)):(h=b.actions,l=h.move_start&&-1==h.move_start.indexOf(l)&&h.move&&-1==h.move.indexOf(l)?m.random_from_array(n.move_start):null))}l&&(e.apply(c,l),e.set_behavior(c,
e.AB_FINISH_RESET),e.set_frame(c,0),e.play(c))}}}function h(a,b,c,d){if(d)if(1==c)switch(d.type){case C:a:{for(var e=0;3>e;e++)if(c=n.get_sensor_payload(a,b,e).hit_fract){b=c;break a}b=void 0}e=100*b;d.vert_correction=e<d.min_height?10:e>d.max_height?-10:0;break;case t:a=n.get_sensor_payload(a,b,0);d.ground_level=a.hit_pos[2];break;case M:a=n.get_sensor_payload(a,b,0),"CLOSE_GROUND"==b?(d.vert_correction=100*a.hit_fract-1,d.vert_correction=.1>d.vert_correction?.05:0):"CLOSE_WATER"==b&&(d.vert_cor_water=
100*e,d.vert_cor_water=d.vert_cor_water<d.min_depth?-.02:d.vert_cor_water>d.max_depth?.02:0)}else d.vert_correction=0}function b(){for(var a=0;a<E.length;a++){var b=E[a];f(b);l(b);b.rig&&e.get_current_anim_name(b.rig)&&e.play(b.rig)}}function f(a){var b=A.create(),c=a.collider;switch(a.type){case C:var d=n.create_ray_sensor(c,b,[0,0,-100],"TERRAIN",!0,!0),e=n.create_ray_sensor(c,b,[0,0,-100],"STONE",!0,!0),b=n.create_ray_sensor(c,b,[0,0,-100],"WATER",!0,!0),d=[d,e,b];n.create_sensor_manifold(c,"CLOSE_GROUND",
n.CT_CONTINUOUS,d,function(a){return a[0]||a[1]||a[2]},h,a);break;case t:d=n.create_ray_sensor(c,[0,0,1],[0,0,-99],"TERRAIN",!0,!0);d=[d];n.create_sensor_manifold(c,"CLOSE_GROUND",n.CT_CONTINUOUS,d,null,h,a);break;case M:d=n.create_ray_sensor(c,[0,0,1],[0,0,-99],"TERRAIN",!0,!0),b=n.create_ray_sensor(c,b,[0,0,100],"WATER",!0,!0),d=[d],n.create_sensor_manifold(c,"CLOSE_WATER",n.CT_CONTINUOUS,[b],null,h,a),n.create_sensor_manifold(c,"CLOSE_GROUND",n.CT_CONTINUOUS,d,null,h,a)}}function l(a){function b(c,
d,e){1==e?(k.get_translation(a.empty,a.destination),a.rotation_mult=4):a.rotation_mult=1}var c=a.collider;if(a.type==t){var d=n.create_collision_sensor(c,"CONSTRUCTION",!1);n.create_sensor_manifold(c,"CONSTRUCTION_COLL",n.CT_CONTINUOUS,[d],null,b)}}function q(a){var b=a.rig;if(!e.is_play(b))return!0;b=e.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.idle)return!1;if(-1==c.idle.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.move_start&&-1!=
c.move_start.indexOf(b)||c.move_blends&&-1!=c.move_blends.indexOf(b))return!1;break;default:return!1}return!0}var e=r("animation"),n=r("controls"),p=r("quat"),B=r("scenes"),c=r("time"),k=r("transform"),m=r("util"),A=r("vec3"),E=[];new Float32Array(9);var w=new Float32Array(3),v=new Float32Array(3),z=new Float32Array(3),y=new Float32Array(3),D=new Float32Array(4),K=new Float32Array(4),d=new Float32Array(4),t=a.NT_WALKING=10,C=a.NT_FLYING=20,M=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=
new Float32Array(3);a.start=[];a.ended=[];a.fired=[];a.ground_level=0;a.vert_correction=0;a.vert_cor_water=0;a.reached=!0;a.rotation_mult=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.fired[b]=!1;E.push(a)};a.enable_animation=function(){if(E.length){b();var a=n.create_elapsed_sensor();n.create_sensor_manifold(E[0].collider,"ELAPSED",n.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,d){if(1==d)for(a=n.get_sensor_value(a,b,0),b=0;b<E.length;b++){d=E[b];var e=a;
if(B.is_visible(d.obj))if(d.random)u(e,d);else{for(var f=c.get_timeline(),h=0;h<d.path.length;h++)if(!d.ended[h]){d.fired[h]||(d.fired[h]=!0,d.destination[0]=d.path[h][0],d.destination[1]=d.path[h][1],d.destination[2]=d.path[h][2],d.start[h]=f+d.delay[h]);if(f<d.start[h])break;u(e,d);d.ended[h]=d.reached;break}e=void 0;a:{for(e=0;e<d.path.length;e++)if(0==d.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<d.path.length;e++)d.fired[e]=!1,d.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=E.length))for(var a=
0;a<E.length;a++){var b=E[a];n.check_sensor_manifolds(b.collider)&&n.remove_sensor_manifold(b.collider);e.is_play(b.rig)&&e.stop(b.rig)}}};b4w.module.mouse=function(a,r){function u(){1==C&&(C=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);c.remove_sensor_manifold(A.get_active_camera(),"SMOOTH_PL")}function h(a){2==C&&(C=0);a.removeEventListener("mousedown",f,!1);a.removeEventListener("mouseup",l,!1);a.removeEventListener("mousemove",b,!1);c.remove_sensor_manifold(A.get_active_camera(),"SMOOTH_DRAG")}function b(a){d()&&(D[0]+=2*(a.clientX-z),D[1]+=
2*(a.clientY-y),z=a.clientX,y=a.clientY);a.preventDefault()}function f(a){z=a.clientX;y=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function l(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function q(a,b,d,e){if(.01<Math.abs(D[0])||.01<Math.abs(D[1]))b=c.get_sensor_value(a,b,0),a=E.smooth(D[0],0,b,.1*v),b=E.smooth(D[1],0,b,.1*v),D[0]-=a,D[1]-=b,e(4E-4*-a,4E-4*-b)}function e(a,b){var c=A.get_first_character(),d=A.get_active_camera();
p.eye_rotate(d,a,b);c&&(d=p.get_camera_angles_char(d,K),k.set_character_rotation(c,d[0],d[1]))}function n(a){a=B.client_to_canvas_coords(a.clientX,a.clientY,K);(a=A.pick_object(a[0],a[1]))?(A.outlining_is_enabled(a)&&A.set_outline_intensity(a,1),A.outlining_is_enabled(t)&&a!=t&&A.set_outline_intensity(t,0)):A.outlining_is_enabled(t)&&A.set_outline_intensity(t,0);t=a}var p=r("camera"),B=r("container"),c=r("controls"),k=r("physics"),m=r("print"),A=r("scenes"),E=r("util"),w=r("main"),v=1,z=0,y=0,D=new Float32Array(2),
K=new Float32Array(2),d=null,t=null,C=0;a.request_pointerlock=function(a,b,d,f,k,l){function n(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){h(a);a.addEventListener("mousemove",f,!1);var e=A.get_active_camera();if(!c.check_sensor_manifold(e,"SMOOTH_PL")){var k=c.create_elapsed_sensor();c.create_sensor_manifold(e,"SMOOTH_PL",c.CT_CONTINUOUS,[k],null,q,l)}b()}else a.removeEventListener("mousemove",f,!1),C=0,document.removeEventListener("pointerlockchange",
n,!1),document.removeEventListener("webkitpointerlockchange",n,!1),document.removeEventListener("mozpointerlockchange",n,!1),d()}if(1!=C){C=1;b=b||function(){};d=d||function(){};l=l||e;k=k||function(){return!0};f=f||function(a){if(k()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;D[0]+=b;D[1]+=a}};document.addEventListener("pointerlockchange",
n,!1);document.addEventListener("webkitpointerlockchange",n,!1);document.addEventListener("mozpointerlockchange",n,!1);var p=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof p?p.apply(a):m.error("Pointer lock is not available")}};a.exit_pointerlock=u;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b,g){2!=C&&(C=2,u(),d=b||function(){return!0},
g=g||e,a.addEventListener("mousedown",f,!1),a.addEventListener("mouseup",l,!1),a=A.get_active_camera(),c.check_sensor_manifold(a,"SMOOTH_DRAG")||(b=c.create_elapsed_sensor(),c.create_sensor_manifold(a,"SMOOTH_DRAG",c.CT_CONTINUOUS,[b],null,q,g)))};a.exit_mouse_drag=h;a.enable_mouse_hover_outline=function(){w.detect_mobile()||B.get_canvas().addEventListener("mousemove",n)};a.disable_mouse_hover_outline=function(){w.detect_mobile()||(B.get_canvas().removeEventListener("mousemove",n),t&&A.set_outline_intensity(t,
0))};a.get_coords_x=function(a,b){var c=b?a.targetTouches:a.touches;return"clientX"in a?a.clientX:c&&"clientX"in c[0]?c[0].clientX:-1};a.get_coords_y=function(a,b){var c=b?a.targetTouches:a.touches;return"clientY"in a?a.clientY:c&&"clientY"in c[0]?c[0].clientY:-1};a.set_plock_smooth_factor=function(a){v=a};a.get_plock_smooth_factor=function(){return v}};b4w.module.preloader=function(a,r){var u=r("container"),h,b,f,l,q,e,n,p,B=null;a.create_preloader=function(a){var e="#000",m="#5276cf",n="#fff",p="#fff",q;for(q in a)switch(q){case "container_color":e=a.container_color;break;case "bar_color":m=a.bar_color;break;case "frame_color":n=a.frame_color;break;case "font_color":p=a.font_color}a=document.createElement("div");q=a.cloneNode();var r=a.cloneNode(),z=a.cloneNode(),y=u.get_container();r.appendChild(q);r.appendChild(z);a.appendChild(r);y.appendChild(a);
a.style.cssText="background-color: "+e+";width: 100%;height: 100%;position: absolute;top: 0;left: 0;";r.style.cssText="position: absolute;left: 50%;top: 50%;margin-left: -150px;margin-top: -30px;width: 300px;height: 28px;border: 2px solid "+n+";";q.style.cssText="position: absolute;width: 0%;top: 0;left: 0;background-color: "+m+";height: 100%;";z.style.cssText="font-family: Arial, sans-serif;line-height: 28px;height: 100%;width: 100%;top: 0;left: 0;text-align: center;position: absolute;font-size: 16px;color: "+
p+";";h=q;b=z;f=a;l="DEFAULT"};a.create_simple_preloader=function(a){var e=null,m=null,n="#bf9221",p="#000",r;for(r in a)switch(r){case "canvas_container_id":e=a.canvas_container_id;break;case "background_container_id":m=a.background_container_id;break;case "bg_color":p=a.bg_color;break;case "bar_color":n=a.bar_color}a=document.createElement("div");r=document.createElement("div");a.id="simple_preloader_container";var u=document.createElement("div"),z=document.createElement("div"),m=document.getElementById(m);
B=document.getElementById(e);a.style.cssText="z-index: 4;background-color: "+p+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";r.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";u.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+n+";border-radius: 0px;";z.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+
r.appendChild(u);r.appendChild(z);a.appendChild(r);document.body.appendChild(a);l="SIMPLE";f=a;h=u;b=z;q=m};a.create_rotation_preloader=function(a){var h=null,m=null,n="rgba(0,0,0,0)",p="",r="",u="rgba(0,0,0,0)",z;for(z in a)switch(z){case "canvas_container_id":h=a.canvas_container_id;break;case "background_container_id":m=a.background_container_id;break;case "frame_bg_color":n=a.frame_bg_color;break;case "bg_color":u=a.bg_color;break;case "frame_class":p=a.frame_class;break;case "anim_elem_class":r=
a.anim_elem_class}a=document.createElement("div");z=document.createElement("div");var y=document.createElement("div"),D=document.createElement("div"),m=document.getElementById(m);B=document.getElementById(h);a.style.cssText="z-index: 4;background-color: "+u+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";z.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+n+";";y.style.cssText=
"position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";D.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";y.className=r;z.appendChild(y);z.className=p;z.appendChild(D);a.appendChild(z);B.appendChild(a);l="ROTATION";f=a;e=y;b=D;q=m};a.create_advanced_preloader=function(a){var e=a.preloader_width,m=a.canvas_container_id,
e=e/(e-a.img_width),r=document.getElementById(a.preloader_bar_id),u=document.getElementById(a.fill_band_id),w=document.getElementById(a.preloader_caption_id),v=document.getElementById(a.preloader_container_id);a=document.getElementById(a.background_container_id);B=document.getElementById(m);l="ADVANCED";h=r;n=u;p=e;b=w;f=v;q=a};a.update_preloader=function(a){b.innerHTML=a+"%";"SIMPLE"==l?h.style.width=a+"%":"ADVANCED"==l?(h.style.width=a/p+"%",n.style.width=100-a+"%"):"ROTATION"==l?e.style.transform=
"rotate("+a+"deg)":"DEFAULT"==l&&(h.style.width=a+"%");100==a&&(f.parentNode.removeChild(f),q&&q.parentNode.removeChild(q))}};b4w.module.storage=function(a,r){function u(a){return f[a?a:b]?JSON.parse(f[a?a:b]):{}}var h=r("__print"),b="b4w",f=null;a.init=function(a){a?"b4w"!==a?b=a:h.error("b4w prefix denied"):h.warn("Prefix should be a string. Last declared storage prefix will be used.")};a.set=function(a,h,l){var q=u(l);q[a]=String(h);f[l?l:b]=JSON.stringify(q)};a.cleanup=function(a){delete f[a?a:b]};a.get=function(a,b){var f=u(b);return f[a]?f[a]:""};a.debug=function(a){h.log(u(a?a:b))};try{f=window.localStorage;try{f.tmp=
null,delete f.tmp}catch(l){h.warn("localStorage quota is limited. Disabling localStorage"),f=null}}catch(q){h.warn("Applying chrome localStorage bug workaround"),f=null}f||(h.warn("localStorage is not available, initializing temporary storage"),f={})};b4w.module.screenshooter=function(a,r){var u=r("main");a.shot=function(){u.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
